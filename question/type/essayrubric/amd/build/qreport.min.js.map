{"version":3,"file":"qreport.min.js","sources":["../src/qreport.js"],"sourcesContent":["/* eslint-disable promise/catch-or-return */\r\n/* eslint-disable camelcase */\r\n/* eslint-disable jsdoc/require-jsdoc */\r\n/* eslint-disable require-jsdoc */\r\n/* eslint-disable promise/always-return */\r\n/* eslint-disable no-unused-vars */\r\n/* eslint-disable babel/object-curly-spacing */\r\n/* eslint-disable space-before-function-paren */\r\n/* eslint-disable capitalized-comments */\r\ndefine([\r\n  \"jquery\",\r\n  \"https://unpkg.com/tabulator-tables/dist/js/tabulator.min.js\",\r\n], function ($, Tabulator) {\r\n  return {\r\n    init: function (questionid, data) {\r\n      var lang = $(\"html\")[0].lang;\r\n      var searchInput = $(\"#searchInput\");\r\n      var currenturl = \"\";\r\n      var sortcolumnsids;\r\n      var colTitles;\r\n\r\n      var table = new Tabulator(\"#questionattempts\", {\r\n        last_page: data.last_page,\r\n        pagination: true,\r\n        paginationMode: \"remote\",\r\n        paginationSize: 20,\r\n        paginationSizeSelector: [20, 40, 100, 1000],\r\n        ajaxContentType: \"json\",\r\n\r\n        autoColumns: true,\r\n        autoColumnsDefinitions: function (definitions) {\r\n          definitions.forEach((column, index) => {\r\n            column.headerSort = index < 4 ? true : false;\r\n          });\r\n\r\n          return definitions;\r\n        },\r\n\r\n        ajaxResponse: function (url, params, response) {\r\n          sortcolumnsids = response.sortcolumnsids;\r\n          colTitles = response.coltitles;\r\n          var tableData2 = response.attempts.map(function (row) {\r\n            var rowData = {};\r\n            colTitles.forEach(function (title, index) {\r\n              rowData[title] = row[index];\r\n            });\r\n\r\n            return rowData;\r\n          });\r\n          return {\r\n            data: tableData2,\r\n            last_page: response.last_page,\r\n          };\r\n        },\r\n        filterMode: \"remote\",\r\n        sortMode: \"remote\",\r\n        ajaxLoader: true,\r\n        ajaxLoaderLoading: \"Fetching data from server...\",\r\n        ajaxURLGenerator: function (url, config, params) {\r\n          url =\r\n            M.cfg.wwwroot +\r\n            \"/question/type/essayrubric/questionreportajax.php\";\r\n          url += \"?id=\" + questionid;\r\n\r\n          if (params.sort.length > 0) {\r\n            url += \"&sort=\" + params.sort[0].dir;\r\n            url += \"&col=\" + sortcolumnsids[params.sort[0].field];\r\n          }\r\n          if (searchInput.val()) {\r\n            url += \"&search=\" + searchInput.val();\r\n          }\r\n          currenturl = url + \"&limit=0\";\r\n          url += \"&limit=\" + params.size;\r\n          url += \"&offset=\" + (params.page - 1) * params.size;\r\n          return url;\r\n        },\r\n        ajaxURL:\r\n          M.cfg.wwwroot +\r\n          \"/question/type/essayrubric/questionreportajax.php\" +\r\n          \"?id=\" +\r\n          questionid,\r\n      });\r\n      searchInput.on(\"keyup\", function () {\r\n        table.setData(\r\n          M.cfg.wwwroot +\r\n            \"/question/type/essayrubric/questionreportajax.php\" +\r\n            \"?id=\" +\r\n            questionid\r\n        );\r\n      });\r\n      function downloadFullData() {\r\n        fetch(currenturl)\r\n          .then((response) => response.json())\r\n          .then((data) => {\r\n            exportDataAsCsv(data);\r\n          });\r\n      }\r\n      $(\"#downloadFullDataButton\").click(function () {\r\n        downloadFullData();\r\n      });\r\n      function exportDataAsCsv(data) {\r\n        const colTitles = data.coltitles;\r\n        const attempts = data.attempts;\r\n        let csv = colTitles.map((title) => `\"${title}\"`).join(\",\") + \"\\n\";\r\n        attempts.forEach((attempt) => {\r\n          attempt.forEach((field, index) => {\r\n            if (field === null || field === undefined) {\r\n              csv += `\"\"`;\r\n            } else {\r\n              field = field.toString().replace(/\"/g, '\"\"');\r\n              csv += `\"${field}\"`;\r\n            }\r\n            if (index < attempt.length - 1) {\r\n              csv += \",\";\r\n            }\r\n          });\r\n          csv += \"\\n\";\r\n        });\r\n        const blob = new Blob([csv], { type: \"text/csv;charset=utf-8\" });\r\n        const link = document.createElement(\"a\");\r\n        link.href = window.URL.createObjectURL(blob);\r\n        link.setAttribute(\"download\", \"data.csv\");\r\n        document.body.appendChild(link);\r\n        link.click();\r\n        document.body.removeChild(link);\r\n      }\r\n    },\r\n  };\r\n});\r\n"],"names":["define","$","Tabulator","init","questionid","data","lang","sortcolumnsids","colTitles","searchInput","currenturl","table","last_page","pagination","paginationMode","paginationSize","paginationSizeSelector","ajaxContentType","autoColumns","autoColumnsDefinitions","definitions","forEach","column","index","headerSort","ajaxResponse","url","params","response","coltitles","attempts","map","row","rowData","title","filterMode","sortMode","ajaxLoader","ajaxLoaderLoading","ajaxURLGenerator","config","M","cfg","wwwroot","sort","length","dir","field","val","size","page","ajaxURL","downloadFullData","fetch","then","json","csv","join","attempt","toString","replace","blob","Blob","type","link","document","createElement","href","window","URL","createObjectURL","setAttribute","body","appendChild","click","removeChild","exportDataAsCsv","on","setData"],"mappings":"AASAA,mCAAO,CACL,SACA,gEACC,SAAUC,EAAGC,iBACP,CACLC,KAAM,SAAUC,WAAYC,MACfJ,EAAE,QAAQ,GAAGK,SAGpBC,eACAC,UAHAC,YAAcR,EAAE,gBAChBS,WAAa,GAIbC,MAAQ,IAAIT,UAAU,oBAAqB,CAC7CU,UAAWP,KAAKO,UAChBC,YAAY,EACZC,eAAgB,SAChBC,eAAgB,GAChBC,uBAAwB,CAAC,GAAI,GAAI,IAAK,KACtCC,gBAAiB,OAEjBC,aAAa,EACbC,uBAAwB,SAAUC,oBAChCA,YAAYC,SAAQ,CAACC,OAAQC,SAC3BD,OAAOE,WAAaD,MAAQ,KAGvBH,aAGTK,aAAc,SAAUC,IAAKC,OAAQC,iBACnCrB,eAAiBqB,SAASrB,eAC1BC,UAAYoB,SAASC,UASd,CACLxB,KATeuB,SAASE,SAASC,KAAI,SAAUC,SAC3CC,QAAU,UACdzB,UAAUa,SAAQ,SAAUa,MAAOX,OACjCU,QAAQC,OAASF,IAAIT,UAGhBU,WAIPrB,UAAWgB,SAAShB,YAGxBuB,WAAY,SACZC,SAAU,SACVC,YAAY,EACZC,kBAAmB,+BACnBC,iBAAkB,SAAUb,IAAKc,OAAQb,eACvCD,IACEe,EAAEC,IAAIC,QACN,oDACFjB,KAAO,OAAStB,WAEZuB,OAAOiB,KAAKC,OAAS,IACvBnB,KAAO,SAAWC,OAAOiB,KAAK,GAAGE,IACjCpB,KAAO,QAAUnB,eAAeoB,OAAOiB,KAAK,GAAGG,QAE7CtC,YAAYuC,QACdtB,KAAO,WAAajB,YAAYuC,OAElCtC,WAAagB,IAAM,WACnBA,KAAO,UAAYC,OAAOsB,KAC1BvB,KAAO,YAAcC,OAAOuB,KAAO,GAAKvB,OAAOsB,MAGjDE,QACEV,EAAEC,IAAIC,QAANF,wDAGArC,sBAUKgD,mBACPC,MAAM3C,YACH4C,MAAM1B,UAAaA,SAAS2B,SAC5BD,MAAMjD,iBAOcA,YACjBG,UAAYH,KAAKwB,UACjBC,SAAWzB,KAAKyB,aAClB0B,IAAMhD,UAAUuB,KAAKG,kBAAcA,aAAUuB,KAAK,KAAO,KAC7D3B,SAAST,SAASqC,UAChBA,QAAQrC,SAAQ,CAAC0B,MAAOxB,SAClBwB,MAAAA,MACFS,WAEAT,MAAQA,MAAMY,WAAWC,QAAQ,KAAM,MACvCJ,gBAAWT,YAETxB,MAAQmC,QAAQb,OAAS,IAC3BW,KAAO,QAGXA,KAAO,cAEHK,KAAO,IAAIC,KAAK,CAACN,KAAM,CAAEO,KAAM,2BAC/BC,KAAOC,SAASC,cAAc,KACpCF,KAAKG,KAAOC,OAAOC,IAAIC,gBAAgBT,MACvCG,KAAKO,aAAa,WAAY,YAC9BN,SAASO,KAAKC,YAAYT,MAC1BA,KAAKU,QACLT,SAASO,KAAKG,YAAYX,MA9BtBY,CAAgBvE,SAZtBI,YAAYoE,GAAG,SAAS,WACtBlE,MAAMmE,QACJrC,EAAEC,IAAIC,QAANF,wDAGErC,eAUNH,EAAE,2BAA2ByE,OAAM,WACjCtB"}