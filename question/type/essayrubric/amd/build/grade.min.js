define("qtype_essayrubric/grade",["exports","core/ajax"],(function(_exports,_ajax){var obj;Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_ajax=(obj=_ajax)&&obj.__esModule?obj:{default:obj};var _default={init:function(qid,qaid,maxmark,minfraction,maxfraction,usageid,slot){_ajax.default.call([{methodname:"qtype_essayrubric_get_grades",args:{qaid:qaid,qid:qid},done:function(result){result=JSON.parse(result.result),render(result)},fail:{}}]);const render=data=>{const manualgradingform=document.getElementById("manualgradingform");manualgradingform.addEventListener("submit",(event=>{_ajax.default.call([{methodname:"qtype_essayrubric_store_grades",args:{data:JSON.stringify(data),qaid:qaid},done:function(result){},fail:{}}])}));const gradeInputs=document.getElementsByClassName("gradeinput");for(const gradeInput of gradeInputs)gradeInput.addEventListener("change",(event=>{recalcGrade(manualgradingform,qaid)}));const recalcGrade=(manualgradingform,qaid)=>{for(const input of manualgradingform.querySelectorAll('[name^="indicator_'+qaid+'_"]')){const indicatorId=input.name.split("_")[2];if(data.isgradestypescalar=Number(data.isgradestypescalar),data.isgradestypescalar){const indicatorValue=input.value;data.indicatorlist[indicatorId].checked=+indicatorValue,data.indicatorlist[indicatorId].weightedGrade=indicatorValue/5*data.indicatorlist[indicatorId].normalizedWeight,data.indicatorlist[indicatorId].normalizedGrade=0==data.indicatorlist[indicatorId].weightedGrade?0:data.indicatorlist[indicatorId].weightedGrade/data.indicatorlist[indicatorId].normalizedWeight*100}else{const indicatorValue=input.checked;data.indicatorlist[indicatorId].checked=+indicatorValue,data.indicatorlist[indicatorId].weightedGrade=indicatorValue*data.indicatorlist[indicatorId].normalizedWeight,data.indicatorlist[indicatorId].normalizedGrade=0===data.indicatorlist[indicatorId].weightedGrade?0:100*indicatorValue*data.indicatorlist[indicatorId].normalizedWeight/data.indicatorlist[indicatorId].weightedGrade}}let questionGradeMarkEl=document.getElementById("q"+usageid+":"+slot+"_-mark"),totalGrade=0;data.indicatorlist.forEach((element=>{let weighted=element.weightedGrade;totalGrade+=weighted})),totalGrade=totalGrade*maxmark/100,totalGrade=Number(totalGrade.toFixed(2)),questionGradeMarkEl.value=totalGrade,data.grade=totalGrade};let totalWeight=0;data.indicatorlist.length;data.indicatorlist=data.indicatorlist.map(((ind,key)=>{let indWeight=null==ind.weight||""==ind.weight?0:+ind.weight;return totalWeight+=indWeight,ind.weight=indWeight,ind})),data.indicatorlist=data.indicatorlist.map(((ind,key)=>(ind.normalizedWeight=ind.weight/totalWeight*100,ind)))}}};return _exports.default=_default,_exports.default}));

//# sourceMappingURL=grade.min.js.map