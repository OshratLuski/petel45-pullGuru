define("qtype_mlnlpessay/qreport",["jquery","https://unpkg.com/tabulator-tables/dist/js/tabulator.min.js"],function($,Tabulator){return{init:function(questionid,data){$("html")[0].lang;var sortcolumnsids,colTitles,searchInput=$("#searchInput"),currenturl="",table=new Tabulator("#questionattempts",{last_page:data.last_page,pagination:!0,paginationMode:"remote",paginationSize:20,paginationSizeSelector:[20,40,100,1e3],ajaxContentType:"json",autoColumns:!0,autoColumnsDefinitions:function(definitions){return definitions.forEach((column,index)=>{column.headerSort=index<4}),definitions},ajaxResponse:function(url,params,response){return sortcolumnsids=response.sortcolumnsids,colTitles=response.coltitles,{data:response.attempts.map(function(row){var rowData={};return colTitles.forEach(function(title,index){rowData[title]=row[index]}),rowData}),last_page:response.last_page}},filterMode:"remote",sortMode:"remote",ajaxLoader:!0,ajaxLoaderLoading:"Fetching data from server...",ajaxURLGenerator:function(url,config,params){return url=M.cfg.wwwroot+"/question/type/mlnlpessay/questionreportajax.php",url+="?id="+questionid,params.sort.length>0&&(url+="&sort="+params.sort[0].dir,url+="&col="+sortcolumnsids[params.sort[0].field]),searchInput.val()&&(url+="&search="+searchInput.val()),currenturl=url,url+="&limit="+params.size,url+="&offset="+(params.page-1)*params.size},ajaxURL:M.cfg.wwwroot+"/question/type/mlnlpessay/questionreportajax.php?id="+questionid});function downloadFullData(){fetch(currenturl+"&limit=0").then(response=>response.json()).then(data=>{!function(data){const colTitles=data.coltitles,attempts=data.attempts;let csv=colTitles.map(title=>`"${title}"`).join(",")+"\n";attempts.forEach(attempt=>{attempt.forEach((field,index)=>{null==field?csv+='""':(field=field.toString().replace(/"/g,'""'),csv+=`"${field}"`),index<attempt.length-1&&(csv+=",")}),csv+="\n"});const blob=new Blob([csv],{type:"text/csv;charset=utf-8"}),link=document.createElement("a");link.href=window.URL.createObjectURL(blob),link.setAttribute("download","data.csv"),document.body.appendChild(link),link.click(),document.body.removeChild(link)}(data)})}searchInput.on("keyup",function(){table.setData(M.cfg.wwwroot+"/question/type/mlnlpessay/questionreportajax.php?id="+questionid)}),$("#downloadFullDataButton").click(function(){downloadFullData()})}}});

//# sourceMappingURL=qreport.min.js.map