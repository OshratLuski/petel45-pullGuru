{"version":3,"file":"qreport.min.js","sources":["../src/qreport.js"],"sourcesContent":["/* eslint-disable promise/catch-or-return */\n/* eslint-disable camelcase */\n/* eslint-disable jsdoc/require-jsdoc */\n/* eslint-disable require-jsdoc */\n/* eslint-disable promise/always-return */\n/* eslint-disable no-unused-vars */\n/* eslint-disable babel/object-curly-spacing */\n/* eslint-disable space-before-function-paren */\n/* eslint-disable capitalized-comments */\ndefine([\n  \"jquery\",\n  \"https://unpkg.com/tabulator-tables/dist/js/tabulator.min.js\",\n], function ($, Tabulator) {\n  return {\n    init: function (questionid, data) {\n      var lang = $(\"html\")[0].lang;\n      var searchInput = $(\"#searchInput\");\n      var currenturl = \"\";\n      var sortcolumnsids;\n      var colTitles;\n\n      var table = new Tabulator(\"#questionattempts\", {\n        last_page: data.last_page,\n        // layout: \"fitColumns\",\n        pagination: true,\n        paginationMode: \"remote\",\n        paginationSize: 20,\n        paginationSizeSelector: [20, 40, 100, 1000],\n        ajaxContentType: \"json\",\n        // columns: columnDefinitions,\n\n        autoColumns: true,\n        autoColumnsDefinitions: function (definitions) {\n          definitions.forEach((column, index) => {\n            column.headerSort = index < 4 ? true : false;\n          });\n\n          return definitions;\n        },\n\n        ajaxResponse: function (url, params, response) {\n          sortcolumnsids = response.sortcolumnsids;\n\n          colTitles = response.coltitles;\n\n          var tableData2 = response.attempts.map(function (row) {\n            var rowData = {};\n            colTitles.forEach(function (title, index) {\n              rowData[title] = row[index];\n            });\n            return rowData;\n          });\n          return {\n            data: tableData2,\n            last_page: response.last_page,\n          };\n        },\n        filterMode: \"remote\",\n        sortMode: \"remote\",\n        ajaxLoader: true,\n        ajaxLoaderLoading: \"Fetching data from server...\",\n        ajaxURLGenerator: function (url, config, params) {\n          url =\n            M.cfg.wwwroot + \"/question/type/mlnlpessay/questionreportajax.php\";\n          url += \"?id=\" + questionid;\n\n          if (params.sort.length > 0) {\n            url += \"&sort=\" + params.sort[0].dir;\n            url += \"&col=\" + sortcolumnsids[params.sort[0].field];\n          }\n          if (searchInput.val()) {\n            url += \"&search=\" + searchInput.val();\n          }\n          currenturl = url;\n          url += \"&limit=\" + params.size;\n          url += \"&offset=\" + (params.page - 1) * params.size;\n          return url;\n        },\n        ajaxURL:\n          M.cfg.wwwroot +\n          \"/question/type/mlnlpessay/questionreportajax.php\" +\n          \"?id=\" +\n          questionid,\n      });\n      searchInput.on(\"keyup\", function () {\n        table.setData(\n          M.cfg.wwwroot +\n            \"/question/type/mlnlpessay/questionreportajax.php\" +\n            \"?id=\" +\n            questionid\n        );\n      });\n      function downloadFullData() {\n        fetch(currenturl + '&limit=0')\n          .then((response) => response.json())\n          .then((data) => {\n            exportDataAsCsv(data);\n          });\n      }\n      $(\"#downloadFullDataButton\").click(function () {\n        downloadFullData();\n      });\n      function exportDataAsCsv(data) {\n        const colTitles = data.coltitles;\n        const attempts = data.attempts;\n        let csv = colTitles.map((title) => `\"${title}\"`).join(\",\") + \"\\n\";\n        attempts.forEach((attempt) => {\n          attempt.forEach((field, index) => {\n            if (field === null || field === undefined) {\n              csv += `\"\"`;\n            } else {\n              field = field.toString().replace(/\"/g, '\"\"');\n              csv += `\"${field}\"`;\n            }\n            if (index < attempt.length - 1) {\n              csv += \",\";\n            }\n          });\n          csv += \"\\n\";\n        });\n        const blob = new Blob([csv], { type: \"text/csv;charset=utf-8\" });\n        const link = document.createElement(\"a\");\n        link.href = window.URL.createObjectURL(blob);\n        link.setAttribute(\"download\", \"data.csv\");\n        document.body.appendChild(link);\n        link.click();\n        document.body.removeChild(link);\n      }\n    },\n  };\n});\n"],"names":["define","$","Tabulator","init","questionid","data","lang","sortcolumnsids","colTitles","searchInput","currenturl","table","last_page","pagination","paginationMode","paginationSize","paginationSizeSelector","ajaxContentType","autoColumns","autoColumnsDefinitions","definitions","forEach","column","index","headerSort","ajaxResponse","url","params","response","coltitles","attempts","map","row","rowData","title","filterMode","sortMode","ajaxLoader","ajaxLoaderLoading","ajaxURLGenerator","config","M","cfg","wwwroot","sort","length","dir","field","val","size","page","ajaxURL","downloadFullData","fetch","then","json","csv","join","attempt","toString","replace","blob","Blob","type","link","document","createElement","href","window","URL","createObjectURL","setAttribute","body","appendChild","click","removeChild","exportDataAsCsv","on","setData"],"mappings":"AASAA,OAAM,2BAAC,CACL,SACA,+DACC,SAAUC,EAAGC,WACd,MAAO,CACLC,KAAM,SAAUC,WAAYC,MACfJ,EAAE,QAAQ,GAAGK,KAAxB,IAGIC,eACAC,UAHAC,YAAcR,EAAE,gBAChBS,WAAa,GAIbC,MAAQ,IAAIT,UAAU,oBAAqB,CAC7CU,UAAWP,KAAKO,UAEhBC,YAAY,EACZC,eAAgB,SAChBC,eAAgB,GAChBC,uBAAwB,CAAC,GAAI,GAAI,IAAK,KACtCC,gBAAiB,OAGjBC,aAAa,EACbC,uBAAwB,SAAUC,aAKhC,OAJAA,YAAYC,QAAQ,CAACC,OAAQC,SAC3BD,OAAOE,WAAaD,MAAQ,IAGvBH,WACR,EAEDK,aAAc,SAAUC,IAAKC,OAAQC,UAYnC,OAXArB,eAAiBqB,SAASrB,eAE1BC,UAAYoB,SAASC,UASd,CACLxB,KAReuB,SAASE,SAASC,IAAI,SAAUC,KAC/C,IAAIC,QAAU,CAAA,EAId,OAHAzB,UAAUa,QAAQ,SAAUa,MAAOX,OACjCU,QAAQC,OAASF,IAAIT,MACvB,GACOU,OACT,GAGErB,UAAWgB,SAAShB,UAEvB,EACDuB,WAAY,SACZC,SAAU,SACVC,YAAY,EACZC,kBAAmB,+BACnBC,iBAAkB,SAAUb,IAAKc,OAAQb,QAevC,OAdAD,IACEe,EAAEC,IAAIC,QAAU,mDAClBjB,KAAO,OAAStB,WAEZuB,OAAOiB,KAAKC,OAAS,IACvBnB,KAAO,SAAWC,OAAOiB,KAAK,GAAGE,IACjCpB,KAAO,QAAUnB,eAAeoB,OAAOiB,KAAK,GAAGG,QAE7CtC,YAAYuC,QACdtB,KAAO,WAAajB,YAAYuC,OAElCtC,WAAagB,IACbA,KAAO,UAAYC,OAAOsB,KAC1BvB,KAAO,YAAcC,OAAOuB,KAAO,GAAKvB,OAAOsB,IAEhD,EACDE,QACEV,EAAEC,IAAIC,QAANF,uDAGArC,aAUJ,SAASgD,mBACPC,MAAM3C,WAAa,YAChB4C,KAAM1B,UAAaA,SAAS2B,QAC5BD,KAAMjD,QAOX,SAAyBA,MACvB,MAAMG,UAAYH,KAAKwB,UACjBC,SAAWzB,KAAKyB,SACtB,IAAI0B,IAAMhD,UAAUuB,IAAKG,OAAU,IAAIA,UAAUuB,KAAK,KAAO,KAC7D3B,SAAST,QAASqC,UAChBA,QAAQrC,QAAQ,CAAC0B,MAAOxB,SAClBwB,YACFS,KAAO,MAEPT,MAAQA,MAAMY,WAAWC,QAAQ,KAAM,MACvCJ,KAAO,IAAIT,UAETxB,MAAQmC,QAAQb,OAAS,IAC3BW,KAAO,OAGXA,KAAO,OAET,MAAMK,KAAO,IAAIC,KAAK,CAACN,KAAM,CAAEO,KAAM,2BAC/BC,KAAOC,SAASC,cAAc,KACpCF,KAAKG,KAAOC,OAAOC,IAAIC,gBAAgBT,MACvCG,KAAKO,aAAa,WAAY,YAC9BN,SAASO,KAAKC,YAAYT,MAC1BA,KAAKU,QACLT,SAASO,KAAKG,YAAYX,KAC5B,CA/BMY,CAAgBvE,OAEtB,CAdAI,YAAYoE,GAAG,QAAS,WACtBlE,MAAMmE,QACJrC,EAAEC,IAAIC,QAANF,uDAGErC,WAEN,GAQAH,EAAE,2BAA2ByE,MAAM,WACjCtB,kBACF,EA2BF,EAEJ"}