{"version":3,"file":"input.min.js","sources":["../src/input.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n\n/**\n * @module     qtype_shortmath/input\n * @package    qtype_shortmath\n * @author     Andr√© Storhaug <andr3.storhaug@gmail.com>\n * @copyright  2018 NTNU\n */\nimport VisualMath from \"qtype_shortmath/visual-math-input\";\nimport {getShortmathEditorconfig} from \"./api_helpers\";\nimport $ from 'jquery';\n\nexport const initialize = async(inputname, readonly, questionId, customscale = false) => {\n    let readOnly = readonly;\n    inputname = inputname.replaceAll(\":\", \"\\\\:\");\n    let shortanswerInput = document.querySelector(`#${inputname}`);\n    // Remove class \"d-inline\" added in shortanswer renderer class, which prevents input from being hidden.\n    shortanswerInput.classList.remove('d-inline');\n    let parent = shortanswerInput.parentElement;\n\n    let input = new VisualMath.Input(shortanswerInput, parent);\n    input.rawInput.style.display = \"none\";\n\n    if (!readonly) {\n        input.onEdit = function($input, field) {\n            $input.value = field.latex();\n            $input.dispatchEvent(new Event('change')); // Event firing needs to be on a vanilla dom object.\n        };\n\n    } else {\n        readOnly = true;\n        input.disabled = true;\n        input.disable();\n    }\n\n    if (shortanswerInput.value.length > 0) {\n        input.mathInput.write(\n            shortanswerInput.value\n        );\n    }\n\n    if (!readOnly) {\n        const template = await getShortmathEditorconfig(parseInt(questionId));\n        let controlsWrapper = shortanswerInput.closest('.shortmath').querySelector('.controls_wrapper');\n        let controls = new VisualMath.ControlList(controlsWrapper);\n\n        // Set single input.\n        controls.bindInput(input);\n\n        if (template === null) {\n            controls.defineDefault();\n        } else {\n            template.forEach(value => {\n                let html = value.button;\n                let command = value.expression;\n                controls.define(command, html, field => field.write(command));\n            });\n        }\n        controls.enableAll();\n\n        // Custom scale.\n        if (customscale) {\n            let scale = $(controls)[0].wrapper;\n\n            $(scale).hide();\n            $(scale).addClass('customscale');\n\n            // Add icon.\n            let inputblock = $(parent).parent();\n            inputblock.after('<span class=\"open-icon-visual-math mr-2 ml-2\"><i class=\"fas fa-keyboard\"></i></span>');\n\n            //$(parent).find('.visual-math-input-field').add(inputblock.parent().find('.open-icon-visual-math')).click(function() {\n            inputblock.parent().find('.open-icon-visual-math').click(function() {\n\n                let flagopened = false;\n                if ($(scale).is(\":visible\")) {\n                    flagopened = true;\n                }\n\n                $('.visual-math-input-wrapper').each(function() {\n                    if ($(this).hasClass('customscale')) {\n                        $(this).hide();\n                    }\n                });\n\n                if (flagopened) {\n                    $(scale).hide();\n                } else {\n                    $(scale).show();\n                }\n\n            });\n        }\n\n    }\n};\n"],"names":["initialize","inputname","readonly","questionId","customscale","readOnly","replaceAll","shortanswerInput","document","querySelector","classList","remove","parent","parentElement","input","VisualMath","Input","rawInput","style","display","disabled","disable","onEdit","$input","field","value","latex","dispatchEvent","Event","length","mathInput","write","parseInt","template","controlsWrapper","closest","controls","ControlList","bindInput","defineDefault","forEach","html","button","command","expression","define","enableAll","scale","wrapper","hide","addClass","inputblock","after","find","click","flagopened","is","each","this","hasClass","show"],"mappings":"gpBA0BaA,wCAAa,iBAAMC,UAAWC,SAAUC,8OAAYC,wDACzDC,SAAWH,SACfD,UAAYA,UAAUK,WAAW,IAAK,QAClCC,iBAAmBC,SAASC,yBAAkBR,aAEjCS,UAAUC,OAAO,YAC9BC,OAASL,iBAAiBM,eAE1BC,MAAQ,IAAIC,yBAAWC,MAAMT,iBAAkBK,SAC7CK,SAASC,MAAMC,QAAU,OAE1BjB,UAODG,UAAW,EACXS,MAAMM,UAAW,EACjBN,MAAMO,WARNP,MAAMQ,OAAS,SAASC,OAAQC,OAC5BD,OAAOE,MAAQD,MAAME,QACrBH,OAAOI,cAAc,IAAIC,MAAM,YASnCrB,iBAAiBkB,MAAMI,OAAS,GAChCf,MAAMgB,UAAUC,MACZxB,iBAAiBkB,OAIpBpB,0DACsB,yCAAyB2B,SAAS7B,qBAAnD8B,uBACFC,gBAAkB3B,iBAAiB4B,QAAQ,cAAc1B,cAAc,sBACvE2B,SAAW,IAAIrB,yBAAWsB,YAAYH,kBAGjCI,UAAUxB,OAEF,OAAbmB,SACAG,SAASG,gBAETN,SAASO,SAAQ,SAAAf,WACTgB,KAAOhB,MAAMiB,OACbC,QAAUlB,MAAMmB,WACpBR,SAASS,OAAOF,QAASF,MAAM,SAAAjB,cAASA,MAAMO,MAAMY,eAG5DP,SAASU,YAGL1C,cACI2C,OAAQ,mBAAEX,UAAU,GAAGY,4BAEzBD,OAAOE,2BACPF,OAAOG,SAAS,gBAGdC,YAAa,mBAAEvC,QAAQA,UAChBwC,MAAM,wFAGjBD,WAAWvC,SAASyC,KAAK,0BAA0BC,OAAM,eAEjDC,YAAa,GACb,mBAAER,OAAOS,GAAG,cACZD,YAAa,uBAGf,8BAA8BE,MAAK,YAC7B,mBAAEC,MAAMC,SAAS,oCACfD,MAAMT,UAIZM,+BACER,OAAOE,2BAEPF,OAAOa"}