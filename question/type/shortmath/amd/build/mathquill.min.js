define("qtype_shortmath/mathquill",["exports","jquery"],(function(_exports,_jquery){var e;Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_jquery=(e=_jquery)&&e.__esModule?e:{default:e},window.jQuery=_jquery.default,function(){var jQuery=window.jQuery,mqBlockId="mathquill-block-id",min=Math.min,max=Math.max;if(!jQuery)throw"MathQuill requires jQuery 1.5.2+ to be loaded first";function noop(){}var __slice=[].slice;function variadic(fn){var numFixedArgs=fn.length-1;return function(){var args=__slice.call(arguments,0,numFixedArgs),varArg=__slice.call(arguments,numFixedArgs);return fn.apply(this,args.concat([varArg]))}}var send=variadic((function(method,args){return variadic((function(obj,moreArgs){if(method in obj)return obj[method].apply(obj,args.concat(moreArgs))}))}));function iterator(generator){return variadic((function(fn,args){"function"!=typeof fn&&(fn=send(fn));return generator.call(this,(function(obj){return fn.apply(obj,[obj].concat(args))}))}))}function bind(cons){var args=__slice.call(arguments,1);return function(){return cons.apply(this,args)}}function pray(message,cond){if(!cond)throw new Error("prayer failed: "+message)}var P=function(prototype,ownProperty){function isObject(o){return"object"==typeof o}function isFunction(f){return"function"==typeof f}function SuperclassBare(){}return function P(_superclass,definition){function C(){var self=new Bare;return isFunction(self.init)&&self.init.apply(self,arguments),self}function Bare(){}undefined===definition&&(definition=_superclass,_superclass=Object),C.Bare=Bare;var extensions,_super=SuperclassBare.prototype=_superclass.prototype,proto=Bare.prototype=C.prototype=C.p=new SuperclassBare;return proto.constructor=C,C.extend=function(def){return P(C,def)},(C.open=function(def){if(extensions={},isFunction(def)?extensions=def.call(C,proto,_super,C,_superclass):isObject(def)&&(extensions=def),isObject(extensions))for(var ext in extensions)ownProperty.call(extensions,ext)&&(proto[ext]=extensions[ext]);return isFunction(proto.init)||(proto.init=_superclass),C})(definition)}}(0,{}.hasOwnProperty),L=-1;function prayDirection(dir){pray("a direction was passed",dir===L||1===dir)}var $=P(jQuery,(function(_){_.insDirOf=function(dir,el){return dir===L?this.insertBefore(el.first()):this.insertAfter(el.last())},_.insAtDirEnd=function(dir,el){return dir===L?this.prependTo(el):this.appendTo(el)}})),Point=P((function(_){_.parent=0,_[L]=0,_[1]=0,_.init=function(parent,leftward,rightward){this.parent=parent,this[L]=leftward,this[1]=rightward},this.copy=function(pt){return Point(pt.parent,pt[L],pt[1])}})),Node=P((function(_){_[L]=0,_[1]=0,_.parent=0;var id=0;this.byId={},_.init=function(){this.id=id+=1,Node.byId[this.id]=this,this.ends={},this.ends[L]=0,this.ends[1]=0},_.dispose=function(){delete Node.byId[this.id]},_.toString=function(){return"{{ MathQuill Node #"+this.id+" }}"},_.jQ=$(),_.jQadd=function(jQ){return this.jQ=this.jQ.add(jQ)},_.jQize=function(jQ){jQ=$(jQ||this.html());function jQadd(el){if(el.getAttribute){var cmdId=el.getAttribute("mathquill-command-id"),blockId=el.getAttribute("mathquill-block-id");cmdId&&Node.byId[cmdId].jQadd(el),blockId&&Node.byId[blockId].jQadd(el)}for(el=el.firstChild;el;el=el.nextSibling)jQadd(el)}for(var i=0;i<jQ.length;i+=1)jQadd(jQ[i]);return jQ},_.createDir=function(dir,cursor){prayDirection(dir);return this.jQize(),this.jQ.insDirOf(dir,cursor.jQ),cursor[dir]=this.adopt(cursor.parent,cursor[L],cursor[1]),this},_.createLeftOf=function(el){return this.createDir(L,el)},_.selectChildren=function(leftEnd,rightEnd){return Selection(leftEnd,rightEnd)},_.bubble=iterator((function(yield_){for(var ancestor=this;ancestor;ancestor=ancestor.parent){if(!1===yield_(ancestor))break}return this})),_.postOrder=iterator((function(yield_){return function recurse(descendant){descendant.eachChild(recurse),yield_(descendant)}(this),this})),_.isEmpty=function(){return 0===this.ends[L]&&0===this.ends[1]},_.isStyleBlock=function(){return!1},_.children=function(){return Fragment(this.ends[L],this.ends[1])},_.eachChild=function(){var children=this.children();return children.each.apply(children,arguments),this},_.foldChildren=function(fold,fn){return this.children().fold(fold,fn)},_.withDirAdopt=function(dir,parent,withDir,oppDir){return Fragment(this,this).withDirAdopt(dir,parent,withDir,oppDir),this},_.adopt=function(parent,leftward,rightward){return Fragment(this,this).adopt(parent,leftward,rightward),this},_.disown=function(){return Fragment(this,this).disown(),this},_.remove=function(){return this.jQ.remove(),this.postOrder("dispose"),this.disown()}}));function prayWellFormed(parent,leftward,rightward){pray("a parent is always present",parent),pray("leftward is properly set up",leftward?leftward[1]===rightward&&leftward.parent===parent:parent.ends[L]===rightward),pray("rightward is properly set up",rightward?rightward[L]===leftward&&rightward.parent===parent:parent.ends[1]===leftward)}var Fragment=P((function(_){_.init=function(withDir,oppDir,dir){if(undefined===dir&&(dir=L),prayDirection(dir),pray("no half-empty fragments",!withDir==!oppDir),this.ends={},withDir){pray("withDir is passed to Fragment",withDir instanceof Node),pray("oppDir is passed to Fragment",oppDir instanceof Node),pray("withDir and oppDir have the same parent",withDir.parent===oppDir.parent),this.ends[dir]=withDir,this.ends[-dir]=oppDir;var accum=this.fold([],(function(accum,el){return accum.push.apply(accum,el.jQ.get()),accum}));this.jQ=this.jQ.add(accum)}},_.jQ=$(),_.withDirAdopt=function(dir,parent,withDir,oppDir){return dir===L?this.adopt(parent,withDir,oppDir):this.adopt(parent,oppDir,withDir)},_.adopt=function(parent,leftward,rightward){prayWellFormed(parent,leftward,rightward);this.disowned=!1;var leftEnd=this.ends[L];if(!leftEnd)return this;var rightEnd=this.ends[1];return leftward||(parent.ends[L]=leftEnd),rightward?rightward[L]=rightEnd:parent.ends[1]=rightEnd,this.ends[1][1]=rightward,this.each((function(el){el[L]=leftward,el.parent=parent,leftward&&(leftward[1]=el),leftward=el})),this},_.disown=function(){var leftEnd=this.ends[L];if(!leftEnd||this.disowned)return this;this.disowned=!0;var rightEnd=this.ends[1],parent=leftEnd.parent;return prayWellFormed(parent,leftEnd[L],leftEnd),prayWellFormed(parent,rightEnd,rightEnd[1]),leftEnd[L]?leftEnd[L][1]=rightEnd[1]:parent.ends[L]=rightEnd[1],rightEnd[1]?rightEnd[1][L]=leftEnd[L]:parent.ends[1]=leftEnd[L],this},_.remove=function(){return this.jQ.remove(),this.each("postOrder","dispose"),this.disown()},_.each=iterator((function(yield_){var el=this.ends[L];if(!el)return this;for(;el!==this.ends[1][1];el=el[1]){if(!1===yield_(el))break}return this})),_.fold=function(fold,fn){return this.each((function(el){fold=fn.call(this,fold,el)})),fold}})),LatexCmds={},CharCmds={},Cursor=P(Point,(function(_){_.init=function(initParent,options){this.parent=initParent,this.options=options;var jQ=this.jQ=this._jQ=$('<span class="mq-cursor">&#8203;</span>');this.blink=function(){jQ.toggleClass("mq-blink")},this.upDownCache={}},_.show=function(){return this.jQ=this._jQ.removeClass("mq-blink"),"intervalId"in this?clearInterval(this.intervalId):(this[1]?this.selection&&this.selection.ends[L][L]===this[L]?this.jQ.insertBefore(this.selection.jQ):this.jQ.insertBefore(this[1].jQ.first()):this.jQ.appendTo(this.parent.jQ),this.parent.focus()),this.intervalId=setInterval(this.blink,500),this},_.hide=function(){return"intervalId"in this&&clearInterval(this.intervalId),delete this.intervalId,this.jQ.detach(),this.jQ=$(),this},_.withDirInsertAt=function(dir,parent,withDir,oppDir){var oldParent=this.parent;this.parent=parent,this[dir]=withDir,this[-dir]=oppDir,oldParent!==parent&&oldParent.blur&&oldParent.blur(this)},_.insDirOf=function(dir,el){return prayDirection(dir),this.jQ.insDirOf(dir,el.jQ),this.withDirInsertAt(dir,el.parent,el[dir],el),this.parent.jQ.addClass("mq-hasCursor"),this},_.insLeftOf=function(el){return this.insDirOf(L,el)},_.insRightOf=function(el){return this.insDirOf(1,el)},_.insAtDirEnd=function(dir,el){return prayDirection(dir),this.jQ.insAtDirEnd(dir,el.jQ),this.withDirInsertAt(dir,el,0,el.ends[dir]),el.focus(),this},_.insAtLeftEnd=function(el){return this.insAtDirEnd(L,el)},_.insAtRightEnd=function(el){return this.insAtDirEnd(1,el)},_.jumpUpDown=function(from,to){this.upDownCache[from.id]=Point.copy(this);var cached=this.upDownCache[to.id];if(cached)cached[1]?this.insLeftOf(cached[1]):this.insAtRightEnd(cached.parent);else{var pageX=this.offset().left;to.seek(pageX,this)}},_.offset=function(){var offset=this.jQ.removeClass("mq-cursor").offset();return this.jQ.addClass("mq-cursor"),offset},_.unwrapGramp=function(){var gramp=this.parent.parent,greatgramp=gramp.parent,rightward=gramp[1],leftward=gramp[L];if(gramp.disown().eachChild((function(uncle){uncle.isEmpty()||(uncle.children().adopt(greatgramp,leftward,rightward).each((function(cousin){cousin.jQ.insertBefore(gramp.jQ.first())})),leftward=uncle.ends[1])})),!this[1])if(this[L])this[1]=this[L][1];else for(;!this[1];){if(this.parent=this.parent[1],!this.parent){this[1]=gramp[1],this.parent=greatgramp;break}this[1]=this.parent.ends[L]}this[1]?this.insLeftOf(this[1]):this.insAtRightEnd(greatgramp),gramp.jQ.remove(),gramp[L].siblingDeleted&&gramp[L].siblingDeleted(this.options,1),gramp[1].siblingDeleted&&gramp[1].siblingDeleted(this.options,L)},_.startSelection=function(){for(var anticursor=this.anticursor=Point.copy(this),ancestors=anticursor.ancestors={},ancestor=anticursor;ancestor.parent;ancestor=ancestor.parent)ancestors[ancestor.parent.id]=ancestor},_.endSelection=function(){delete this.anticursor},_.select=function(){var anticursor=this.anticursor;if(this[L]===anticursor[L]&&this.parent===anticursor.parent)return!1;for(var ancestor=this;ancestor.parent;ancestor=ancestor.parent)if(ancestor.parent.id in anticursor.ancestors){var lca=ancestor.parent;break}pray("cursor and anticursor in the same tree",lca);var leftEnd,rightEnd,antiAncestor=anticursor.ancestors[lca.id],dir=1;if(ancestor[L]!==antiAncestor)for(var rightward=ancestor;rightward;rightward=rightward[1])if(rightward[1]===antiAncestor[1]){dir=L,leftEnd=ancestor,rightEnd=antiAncestor;break}return 1===dir&&(leftEnd=antiAncestor,rightEnd=ancestor),leftEnd instanceof Point&&(leftEnd=leftEnd[1]),rightEnd instanceof Point&&(rightEnd=rightEnd[L]),this.hide().selection=lca.selectChildren(leftEnd,rightEnd),this.insDirOf(dir,this.selection.ends[dir]),this.selectionChanged(),!0},_.clearSelection=function(){return this.selection&&(this.selection.clear(),delete this.selection,this.selectionChanged()),this},_.deleteSelection=function(){this.selection&&(this[L]=this.selection.ends[L][L],this[1]=this.selection.ends[1][1],this.selection.remove(),this.selectionChanged(),delete this.selection)},_.replaceSelection=function(){var seln=this.selection;return seln&&(this[L]=seln.ends[L][L],this[1]=seln.ends[1][1],delete this.selection),seln},_.depth=function(){for(var node=this,depth=0;node=node.parent;)depth+=node instanceof MathBlock?1:0;return depth},_.isTooDeep=function(offset){if(undefined!==this.options.maxDepth)return this.depth()+(offset||0)>this.options.maxDepth}})),Selection=P(Fragment,(function(_,super_){_.init=function(){super_.init.apply(this,arguments),this.jQ=this.jQ.wrapAll('<span class="mq-selection"></span>').parent()},_.adopt=function(){return this.jQ.replaceWith(this.jQ=this.jQ.children()),super_.adopt.apply(this,arguments)},_.clear=function(){return this.jQ.replaceWith(this.jQ[0].childNodes),this},_.join=function(methodName){return this.fold("",(function(fold,child){return fold+child[methodName]()}))}})),Controller=P((function(_){_.init=function(root,container,options){this.id=root.id,this.data={},this.root=root,this.container=container,this.options=options,root.controller=this,this.cursor=root.cursor=Cursor(root,options)},_.handle=function(name,dir){var handlers=this.options.handlers;if(handlers&&handlers.fns[name]){var mq=handlers.APIClasses[this.KIND_OF_MQ](this);dir===L||1===dir?handlers.fns[name](dir,mq):handlers.fns[name](mq)}};var notifyees=[];this.onNotify=function(f){notifyees.push(f)},_.notify=function(){for(var i=0;i<notifyees.length;i+=1)notifyees[i].apply(this.cursor,arguments);return this}})),API={},Options=P(),optionProcessors={},Progenote=P(),EMBEDS={};function insistOnInterVer(){window.console&&console.warn('You are using the MathQuill API without specifying an interface version, which will fail in v1.0.0. Easiest fix is to do the following before doing anything else:\n\n    MathQuill = MathQuill.getInterface(1);\n    // now MathQuill.MathField() works like it used to\n\nSee also the "`dev` branch (2014–2015) → v0.10.0 Migration Guide" at\n  https://github.com/mathquill/mathquill/wiki/%60dev%60-branch-(2014%E2%80%932015)-%E2%86%92-v0.10.0-Migration-Guide')}function MathQuill(el){return insistOnInterVer(),MQ1(el)}MathQuill.prototype=Progenote.p,MathQuill.VERSION="v0.10.1",MathQuill.interfaceVersion=function(v){if(1!==v)throw"Only interface version 1 supported. You specified: "+v;return(insistOnInterVer=function(){window.console&&console.warn('You called MathQuill.interfaceVersion(1); to specify the interface version, which will fail in v1.0.0. You can fix this easily by doing this before doing anything else:\n\n    MathQuill = MathQuill.getInterface(1);\n    // now MathQuill.MathField() works like it used to\n\nSee also the "`dev` branch (2014–2015) → v0.10.0 Migration Guide" at\n  https://github.com/mathquill/mathquill/wiki/%60dev%60-branch-(2014%E2%80%932015)-%E2%86%92-v0.10.0-Migration-Guide')})(),MathQuill},MathQuill.getInterface=getInterface;var MIN=getInterface.MIN=1,MAX=getInterface.MAX=2;function getInterface(v){if(!(MIN<=v&&v<=MAX))throw"Only interface versions between "+MIN+" and "+MAX+" supported. You specified: "+v;function MQ(el){if(!el||!el.nodeType)return null;var blockId=$(el).children(".mq-root-block").attr(mqBlockId),ctrlr=blockId&&Node.byId[blockId].controller;return ctrlr?APIClasses[ctrlr.KIND_OF_MQ](ctrlr):null}var APIClasses={};function config(currentOptions,newOptions){for(var name in newOptions&&newOptions.handlers&&(newOptions.handlers={fns:newOptions.handlers,APIClasses:APIClasses}),newOptions)if(newOptions.hasOwnProperty(name)){var value=newOptions[name],processor=optionProcessors[name];currentOptions[name]=processor?processor(value):value}}MQ.L=L,MQ.R=1,MQ.saneKeyboardEvents=saneKeyboardEvents,MQ.config=function(opts){return config(Options.p,opts),this},MQ.registerEmbed=function(name,options){if(!/^[a-z][a-z0-9]*$/i.test(name))throw"Embed name must start with letter and be only letters and digits";EMBEDS[name]=options};var AbstractMathQuill=APIClasses.AbstractMathQuill=P(Progenote,(function(_){_.init=function(ctrlr){this.__controller=ctrlr,this.__options=ctrlr.options,this.id=ctrlr.id,this.data=ctrlr.data},_.__mathquillify=function(classNames){var ctrlr=this.__controller,root=ctrlr.root,el=ctrlr.container;ctrlr.createTextarea();var contents=el.addClass(classNames).contents().detach();root.jQ=$('<span class="mq-root-block"/>').attr(mqBlockId,root.id).appendTo(el),this.latex(contents.text()),this.revert=function(){return el.empty().unbind(".mathquill").removeClass("mq-editable-field mq-math-mode mq-text-mode").append(contents)}},_.config=function(opts){return config(this.__options,opts),this},_.el=function(){return this.__controller.container[0]},_.text=function(){return this.__controller.exportText()},_.latex=function(latex){return arguments.length>0?(this.__controller.renderLatexMath(latex),this.__controller.blurred&&this.__controller.cursor.hide().parent.blur(),this):this.__controller.exportLatex()},_.html=function(){return this.__controller.root.jQ.html().replace(/ mathquill-(?:command|block)-id="?\d+"?/g,"").replace(/<span class="?mq-cursor( mq-blink)?"?>.?<\/span>/i,"").replace(/ mq-hasCursor|mq-hasCursor ?/,"").replace(/ class=(""|(?= |>))/g,"")},_.reflow=function(){return this.__controller.root.postOrder("reflow"),this}}));for(var kind in MQ.prototype=AbstractMathQuill.prototype,APIClasses.EditableField=P(AbstractMathQuill,(function(_,super_){_.__mathquillify=function(){return super_.__mathquillify.apply(this,arguments),this.__controller.editable=!0,this.__controller.delegateMouseEvents(),this.__controller.editablesTextareaEvents(),this},_.focus=function(){return this.__controller.textarea.focus(),this},_.blur=function(){return this.__controller.textarea.blur(),this},_.write=function(latex){return this.__controller.writeLatex(latex),this.__controller.scrollHoriz(),this.__controller.blurred&&this.__controller.cursor.hide().parent.blur(),this},_.empty=function(){var root=this.__controller.root,cursor=this.__controller.cursor;return root.eachChild("postOrder","dispose"),root.ends[L]=root.ends[1]=0,root.jQ.empty(),delete cursor.selection,cursor.insAtRightEnd(root),this},_.cmd=function(cmd){var ctrlr=this.__controller.notify(),cursor=ctrlr.cursor;if(/^\\[a-z]+$/i.test(cmd)&&!cursor.isTooDeep()){cmd=cmd.slice(1);var klass=LatexCmds[cmd];klass&&(cmd=klass(cmd),cursor.selection&&cmd.replaces(cursor.replaceSelection()),cmd.createLeftOf(cursor.show()),this.__controller.scrollHoriz())}else cursor.parent.write(cursor,cmd);return ctrlr.blurred&&cursor.hide().parent.blur(),this},_.select=function(){var ctrlr=this.__controller;for(ctrlr.notify("move").cursor.insAtRightEnd(ctrlr.root);ctrlr.cursor[L];)ctrlr.selectLeft();return this},_.clearSelection=function(){return this.__controller.cursor.clearSelection(),this},_.moveToDirEnd=function(dir){return this.__controller.notify("move").cursor.insAtDirEnd(dir,this.__controller.root),this},_.moveToLeftEnd=function(){return this.moveToDirEnd(L)},_.moveToRightEnd=function(){return this.moveToDirEnd(1)},_.keystroke=function(keys){keys=keys.replace(/^\s+|\s+$/g,"").split(/\s+/);for(var i=0;i<keys.length;i+=1)this.__controller.keystroke(keys[i],{preventDefault:noop});return this},_.typedText=function(text){for(var i=0;i<text.length;i+=1)this.__controller.typedText(text.charAt(i));return this},_.dropEmbedded=function(pageX,pageY,options){var clientX=pageX-$(window).scrollLeft(),clientY=pageY-$(window).scrollTop(),el=document.elementFromPoint(clientX,clientY);this.__controller.seek($(el),pageX,pageY),Embed().setOptions(options).createLeftOf(this.__controller.cursor)},_.clickAt=function(clientX,clientY,target){target=target||document.elementFromPoint(clientX,clientY);var ctrlr=this.__controller,root=ctrlr.root;return jQuery.contains(root.jQ[0],target)||(target=root.jQ[0]),ctrlr.seek($(target),clientX+pageXOffset,clientY+pageYOffset),ctrlr.blurred&&this.focus(),this},_.ignoreNextMousedown=function(fn){return this.__controller.cursor.options.ignoreNextMousedown=fn,this}})),MQ.EditableField=function(){throw"wtf don't call me, I'm 'abstract'"},MQ.EditableField.prototype=APIClasses.EditableField.prototype,API)!function(kind,defAPIClass){var APIClass=APIClasses[kind]=defAPIClass(APIClasses);MQ[kind]=function(el,opts){var mq=MQ(el);if(mq instanceof APIClass||!el||!el.nodeType)return mq;var ctrlr=Controller(APIClass.RootBlock(),$(el),Options());return ctrlr.KIND_OF_MQ=kind,APIClass(ctrlr).__mathquillify(opts,v)},MQ[kind].prototype=APIClass.prototype}(kind,API[kind]);return MQ}MathQuill.noConflict=function(){return window.MathQuill=origMathQuill,MathQuill};var origMathQuill=window.MathQuill;function RootBlockMixin(_){for(var names="moveOutOf deleteOutOf selectOutOf upOutOf downOutOf".split(" "),i=0;i<names.length;i+=1)!function(name){_[name]=function(dir){this.controller.handle(name,dir)}}(names[i]);_.reflow=function(){this.controller.handle("reflow"),this.controller.handle("edited"),this.controller.handle("edit")}}window.MathQuill=MathQuill;var KEY_VALUES,saneKeyboardEvents=(KEY_VALUES={8:"Backspace",9:"Tab",10:"Enter",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Esc",32:"Spacebar",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",45:"Insert",46:"Del",144:"NumLock"},function(el,handlers){var timeoutId,keydown=null,keypress=null,textarea=jQuery(el),target=jQuery(handlers.container||textarea),checkTextarea=noop;function checkTextareaFor(checker){checkTextarea=checker,clearTimeout(timeoutId),timeoutId=setTimeout(checker)}function checkTextareaOnce(checker){checkTextareaFor((function(e){checkTextarea=noop,clearTimeout(timeoutId),checker(e)}))}target.bind("keydown keypress input keyup focusout paste",(function(e){checkTextarea(e)}));var shouldBeSelected=!1;function handleKey(){handlers.keystroke(function(evt){var key,which=evt.which||evt.keyCode,keyVal=KEY_VALUES[which],modifiers=[];return evt.ctrlKey&&modifiers.push("Ctrl"),evt.originalEvent&&evt.originalEvent.metaKey&&modifiers.push("Meta"),evt.altKey&&modifiers.push("Alt"),evt.shiftKey&&modifiers.push("Shift"),key=keyVal||String.fromCharCode(which),modifiers.length||keyVal?(modifiers.push(key),modifiers.join("-")):key}(keydown),keydown)}function typedText(){if(!("selectionStart"in(dom=textarea[0]))||dom.selectionStart===dom.selectionEnd){var dom,text=textarea.val();1===text.length?(textarea.val(""),handlers.typedText(text)):text&&textarea[0].select&&textarea[0].select()}}function pastedText(){var text=textarea.val();textarea.val(""),text&&handlers.paste(text)}return target.bind({keydown:function(e){e.target===textarea[0]&&(keydown=e,keypress=null,shouldBeSelected&&checkTextareaOnce((function(e){e&&"focusout"===e.type||!textarea[0].select||textarea[0].select()})),handleKey())},keypress:function(e){e.target===textarea[0]&&(keydown&&keypress&&handleKey(),keypress=e,checkTextareaFor(typedText))},keyup:function(e){e.target===textarea[0]&&keydown&&!keypress&&checkTextareaFor(typedText)},focusout:function(){keydown=keypress=null},cut:function(){checkTextareaOnce((function(){handlers.cut()}))},copy:function(){checkTextareaOnce((function(){handlers.copy()}))},paste:function(e){e.target===textarea[0]&&(document.activeElement!==textarea[0]&&textarea.focus(),checkTextareaFor(pastedText))}}),{select:function(text){checkTextarea(),checkTextarea=noop,clearTimeout(timeoutId),textarea.val(text),text&&textarea[0].select&&textarea[0].select(),shouldBeSelected=!!text}}}),Parser=P((function(_,super_,Parser){function parseError(stream,message){throw"Parse Error: "+message+" at "+(stream=stream?"'"+stream+"'":"EOF")}_.init=function(body){this._=body},_.parse=function(stream){return this.skip(eof)._(""+stream,(function(stream,result){return result}),parseError)},_.or=function(alternative){pray("or is passed a parser",alternative instanceof Parser);var self=this;return Parser((function(stream,onSuccess,onFailure){return self._(stream,onSuccess,(function(newStream){return alternative._(stream,onSuccess,onFailure)}))}))},_.then=function(next){var self=this;return Parser((function(stream,onSuccess,onFailure){return self._(stream,(function(newStream,result){var nextParser=next instanceof Parser?next:next(result);return pray("a parser is returned",nextParser instanceof Parser),nextParser._(newStream,onSuccess,onFailure)}),onFailure)}))},_.many=function(){var self=this;return Parser((function(stream,onSuccess,onFailure){for(var xs=[];self._(stream,success,failure););return onSuccess(stream,xs);function success(newStream,x){return stream=newStream,xs.push(x),!0}function failure(){return!1}}))},_.times=function(min,max){arguments.length<2&&(max=min);var self=this;return Parser((function(stream,onSuccess,onFailure){for(var failure,xs=[],result=!0,i=0;i<min;i+=1)if(!(result=self._(stream,success,firstFailure)))return onFailure(stream,failure);for(;i<max&&result;i+=1)result=self._(stream,success,secondFailure);return onSuccess(stream,xs);function success(newStream,x){return xs.push(x),stream=newStream,!0}function firstFailure(newStream,msg){return failure=msg,stream=newStream,!1}function secondFailure(newStream,msg){return!1}}))},_.result=function(res){return this.then(succeed(res))},_.atMost=function(n){return this.times(0,n)},_.atLeast=function(n){var self=this;return self.times(n).then((function(start){return self.many().map((function(end){return start.concat(end)}))}))},_.map=function(fn){return this.then((function(result){return succeed(fn(result))}))},_.skip=function(two){return this.then((function(result){return two.result(result)}))};this.string=function(str){var len=str.length,expected="expected '"+str+"'";return Parser((function(stream,onSuccess,onFailure){var head=stream.slice(0,len);return head===str?onSuccess(stream.slice(len),head):onFailure(stream,expected)}))};var regex=this.regex=function(re){pray("regexp parser is anchored","^"===re.toString().charAt(1));var expected="expected "+re;return Parser((function(stream,onSuccess,onFailure){var match=re.exec(stream);if(match){var result=match[0];return onSuccess(stream.slice(result.length),result)}return onFailure(stream,expected)}))},succeed=Parser.succeed=function(result){return Parser((function(stream,onSuccess){return onSuccess(stream,result)}))},eof=(Parser.fail=function(msg){return Parser((function(stream,_,onFailure){return onFailure(stream,msg)}))},Parser.letter=regex(/^[a-z]/i),Parser.letters=regex(/^[a-z]*/i),Parser.digit=regex(/^[0-9]/),Parser.digits=regex(/^[0-9]*/),Parser.whitespace=regex(/^\s+/),Parser.optWhitespace=regex(/^\s*/),Parser.any=Parser((function(stream,onSuccess,onFailure){return stream?onSuccess(stream.slice(1),stream.charAt(0)):onFailure(stream,"expected any character")})),Parser.all=Parser((function(stream,onSuccess,onFailure){return onSuccess("",stream)})),Parser.eof=Parser((function(stream,onSuccess,onFailure){return stream?onFailure(stream,"expected EOF"):onSuccess(stream,stream)})))}));Controller.open((function(_){_.focusBlurEvents=function(){var blurTimeout,ctrlr=this,root=ctrlr.root,cursor=ctrlr.cursor;function windowBlur(){clearTimeout(blurTimeout),cursor.selection&&cursor.selection.jQ.addClass("mq-blur"),blur()}function blur(){cursor.hide().parent.blur(),ctrlr.container.removeClass("mq-focused"),$(window).unbind("blur",windowBlur)}ctrlr.textarea.focus((function(){ctrlr.blurred=!1,clearTimeout(blurTimeout),ctrlr.container.addClass("mq-focused"),cursor.parent||cursor.insAtRightEnd(root),cursor.selection?(cursor.selection.jQ.removeClass("mq-blur"),ctrlr.selectionChanged()):cursor.show()})).blur((function(){ctrlr.blurred=!0,blurTimeout=setTimeout((function(){root.postOrder("intentionalBlur"),cursor.clearSelection().endSelection(),blur()})),$(window).bind("blur",windowBlur)})),ctrlr.blurred=!0,cursor.hide().parent.blur()},_.unbindFocusBlurEvents=function(){this.textarea.unbind("focus blur")}})),Controller.open((function(_,super_){_.exportText=function(){return this.root.foldChildren("",(function(text,child){return text+child.text()}))}})),Controller.open((function(_){Options.p.ignoreNextMousedown=noop,_.delegateMouseEvents=function(){var ultimateRootjQ=this.root.jQ;this.container.bind("mousedown.mathquill",(function(e){var target,rootjQ=$(e.target).closest(".mq-root-block"),ctrlr=Node.byId[rootjQ.attr(mqBlockId)||ultimateRootjQ.attr(mqBlockId)].controller,cursor=ctrlr.cursor,blink=cursor.blink,textareaSpan=ctrlr.textareaSpan,textarea=ctrlr.textarea;(e.preventDefault(),e.target.unselectable=!0,cursor.options.ignoreNextMousedown(e))||(cursor.options.ignoreNextMousedown=noop,ctrlr.blurred&&(ctrlr.editable||rootjQ.prepend(textareaSpan),textarea.focus()),cursor.blink=noop,ctrlr.seek($(e.target),e.pageX,e.pageY).cursor.startSelection(),rootjQ.mousemove(mousemove),$(e.target.ownerDocument).mousemove(docmousemove).mouseup((function mouseup(e){cursor.blink=blink,cursor.selection||(ctrlr.editable?cursor.show():textareaSpan.detach()),rootjQ.unbind("mousemove",mousemove),$(e.target.ownerDocument).unbind("mousemove",docmousemove).unbind("mouseup",mouseup)})));function mousemove(e){target=$(e.target)}function docmousemove(e){cursor.anticursor||cursor.startSelection(),ctrlr.seek(target,e.pageX,e.pageY).cursor.select(),target=undefined}}))}})),Controller.open((function(_){_.seek=function(target,pageX,pageY){var cursor=this.notify("select").cursor;if(target){var nodeId=target.attr(mqBlockId)||target.attr("mathquill-command-id");if(!nodeId){var targetParent=target.parent();nodeId=targetParent.attr(mqBlockId)||targetParent.attr("mathquill-command-id")}}var node=nodeId?Node.byId[nodeId]:this.root;return pray("nodeId is the id of some Node that exists",node),cursor.clearSelection().show(),node.seek(pageX,cursor),this.scrollHoriz(),this}})),Controller.open((function(_){_.keystroke=function(key,evt){this.cursor.parent.keystroke(key,evt,this)}})),Node.open((function(_){_.keystroke=function(key,e,ctrlr){var cursor=ctrlr.cursor;switch(key){case"Ctrl-Shift-Backspace":case"Ctrl-Backspace":ctrlr.ctrlDeleteDir(L);break;case"Shift-Backspace":case"Backspace":ctrlr.backspace();break;case"Esc":case"Tab":return void ctrlr.escapeDir(1,key,e);case"Shift-Tab":case"Shift-Esc":return void ctrlr.escapeDir(L,key,e);case"End":ctrlr.notify("move").cursor.insAtRightEnd(cursor.parent);break;case"Ctrl-End":ctrlr.notify("move").cursor.insAtRightEnd(ctrlr.root);break;case"Shift-End":for(;cursor[1];)ctrlr.selectRight();break;case"Ctrl-Shift-End":for(;cursor[1]||cursor.parent!==ctrlr.root;)ctrlr.selectRight();break;case"Home":ctrlr.notify("move").cursor.insAtLeftEnd(cursor.parent);break;case"Ctrl-Home":ctrlr.notify("move").cursor.insAtLeftEnd(ctrlr.root);break;case"Shift-Home":for(;cursor[L];)ctrlr.selectLeft();break;case"Ctrl-Shift-Home":for(;cursor[L]||cursor.parent!==ctrlr.root;)ctrlr.selectLeft();break;case"Left":ctrlr.moveLeft();break;case"Shift-Left":ctrlr.selectLeft();break;case"Ctrl-Left":break;case"Right":ctrlr.moveRight();break;case"Shift-Right":ctrlr.selectRight();break;case"Ctrl-Right":break;case"Up":ctrlr.moveUp();break;case"Down":ctrlr.moveDown();break;case"Shift-Up":if(cursor[L])for(;cursor[L];)ctrlr.selectLeft();else ctrlr.selectLeft();case"Shift-Down":if(cursor[1])for(;cursor[1];)ctrlr.selectRight();else ctrlr.selectRight();case"Ctrl-Up":case"Ctrl-Down":break;case"Ctrl-Shift-Del":case"Ctrl-Del":ctrlr.ctrlDeleteDir(1);break;case"Shift-Del":case"Del":ctrlr.deleteForward();break;case"Meta-A":case"Ctrl-A":for(ctrlr.notify("move").cursor.insAtRightEnd(ctrlr.root);cursor[L];)ctrlr.selectLeft();break;default:return}e.preventDefault(),ctrlr.scrollHoriz()},_.moveOutOf=_.moveTowards=_.deleteOutOf=_.deleteTowards=_.unselectInto=_.selectOutOf=_.selectTowards=function(){pray("overridden or never called on this node")}})),Controller.open((function(_){function moveUpDown(self,dir){var cursor=self.notify("upDown").cursor,dirInto=dir+"Into",dirOutOf=dir+"OutOf";return cursor[1][dirInto]?cursor.insAtLeftEnd(cursor[1][dirInto]):cursor[L][dirInto]?cursor.insAtRightEnd(cursor[L][dirInto]):cursor.parent.bubble((function(ancestor){var prop=ancestor[dirOutOf];if(prop&&("function"==typeof prop&&(prop=ancestor[dirOutOf](cursor)),prop instanceof Node&&cursor.jumpUpDown(ancestor,prop),!0!==prop))return!1})),self}this.onNotify((function(e){"move"!==e&&"upDown"!==e||this.show().clearSelection()})),_.escapeDir=function(dir,key,e){prayDirection(dir);var cursor=this.cursor;if(cursor.parent!==this.root&&e.preventDefault(),cursor.parent!==this.root)return cursor.parent.moveOutOf(dir,cursor),this.notify("move")},optionProcessors.leftRightIntoCmdGoes=function(updown){if(updown&&"up"!==updown&&"down"!==updown)throw'"up" or "down" required for leftRightIntoCmdGoes option, got "'+updown+'"';return updown},_.moveDir=function(dir){prayDirection(dir);var cursor=this.cursor,updown=cursor.options.leftRightIntoCmdGoes;return cursor.selection?cursor.insDirOf(dir,cursor.selection.ends[dir]):cursor[dir]?cursor[dir].moveTowards(dir,cursor,updown):cursor.parent.moveOutOf(dir,cursor,updown),this.notify("move")},_.moveLeft=function(){return this.moveDir(L)},_.moveRight=function(){return this.moveDir(1)},_.moveUp=function(){return moveUpDown(this,"up")},_.moveDown=function(){return moveUpDown(this,"down")},this.onNotify((function(e){"upDown"!==e&&(this.upDownCache={})})),this.onNotify((function(e){"edit"===e&&this.show().deleteSelection()})),_.deleteDir=function(dir){prayDirection(dir);var cursor=this.cursor,hadSelection=cursor.selection;return this.notify("edit"),hadSelection||(cursor[dir]?cursor[dir].deleteTowards(dir,cursor):cursor.parent.deleteOutOf(dir,cursor)),cursor[L].siblingDeleted&&cursor[L].siblingDeleted(cursor.options,1),cursor[1].siblingDeleted&&cursor[1].siblingDeleted(cursor.options,L),cursor.parent.bubble("reflow"),this},_.ctrlDeleteDir=function(dir){prayDirection(dir);var cursor=this.cursor;return!cursor[dir]||cursor.selection?this.deleteDir(dir):(this.notify("edit"),dir===L?Fragment(cursor.parent.ends[L],cursor[L]).remove():Fragment(cursor[1],cursor.parent.ends[1]).remove(),cursor.insAtDirEnd(dir,cursor.parent),cursor[L].siblingDeleted&&cursor[L].siblingDeleted(cursor.options,1),cursor[1].siblingDeleted&&cursor[1].siblingDeleted(cursor.options,L),cursor.parent.bubble("reflow"),this)},_.backspace=function(){return this.deleteDir(L)},_.deleteForward=function(){return this.deleteDir(1)},this.onNotify((function(e){"select"!==e&&this.endSelection()})),_.selectDir=function(dir){var cursor=this.notify("select").cursor,seln=cursor.selection;prayDirection(dir),cursor.anticursor||cursor.startSelection();var node=cursor[dir];node?seln&&seln.ends[dir]===node&&cursor.anticursor[-dir]!==node?node.unselectInto(dir,cursor):node.selectTowards(dir,cursor):cursor.parent.selectOutOf(dir,cursor),cursor.clearSelection(),cursor.select()||cursor.show()},_.selectLeft=function(){return this.selectDir(L)},_.selectRight=function(){return this.selectDir(1)}})),Controller.open((function(_){Options.p.substituteTextarea=function(){return $("<textarea autocapitalize=off autocomplete=off autocorrect=off spellcheck=false x-palm-disable-ste-all=true />")[0]},_.createTextarea=function(){var textareaSpan=this.textareaSpan=$('<span class="mq-textarea"></span>'),textarea=this.options.substituteTextarea();if(!textarea.nodeType)throw"substituteTextarea() must return a DOM element, got "+textarea;textarea=this.textarea=$(textarea).appendTo(textareaSpan);var ctrlr=this;ctrlr.cursor.selectionChanged=function(){ctrlr.selectionChanged()}},_.selectionChanged=function(){var ctrlr=this;forceIERedraw(ctrlr.container[0]),undefined===ctrlr.textareaSelectionTimeout&&(ctrlr.textareaSelectionTimeout=setTimeout((function(){ctrlr.setTextareaSelection()})))},_.setTextareaSelection=function(){this.textareaSelectionTimeout=undefined;var latex="";this.cursor.selection&&(latex=this.cursor.selection.join("latex"),this.options.statelessClipboard&&(latex="$"+latex+"$")),this.selectFn(latex)},_.staticMathTextareaEvents=function(){var ctrlr=this,cursor=(ctrlr.root,ctrlr.cursor),textarea=ctrlr.textarea,textareaSpan=ctrlr.textareaSpan;function detach(){textareaSpan.detach(),ctrlr.blurred=!0}this.container.prepend(jQuery('<span class="mq-selectable">').text("$"+ctrlr.exportLatex()+"$")),ctrlr.blurred=!0,textarea.bind("cut paste",!1).bind("copy",(function(){ctrlr.setTextareaSelection()})).focus((function(){ctrlr.blurred=!1})).blur((function(){cursor.selection&&cursor.selection.clear(),setTimeout(detach)})),ctrlr.selectFn=function(text){textarea.val(text),text&&textarea.select()}},Options.p.substituteKeyboardEvents=saneKeyboardEvents,_.editablesTextareaEvents=function(){var textarea=this.textarea,textareaSpan=this.textareaSpan,keyboardEventsShim=this.options.substituteKeyboardEvents(textarea,this);this.selectFn=function(text){keyboardEventsShim.select(text)},this.container.prepend(textareaSpan),this.focusBlurEvents()},_.unbindEditablesEvents=function(){var textarea=this.textarea,textareaSpan=this.textareaSpan;this.selectFn=function(text){textarea.val(text),text&&textarea.select()},textareaSpan.remove(),this.unbindFocusBlurEvents(),this.blurred=!0,textarea.bind("cut paste",!1)},_.typedText=function(ch){if("\n"===ch)return this.handle("enter");var cursor=this.notify().cursor;cursor.parent.write(cursor,ch),this.scrollHoriz()},_.cut=function(){var ctrlr=this,cursor=ctrlr.cursor;cursor.selection&&setTimeout((function(){ctrlr.notify("edit"),cursor.parent.bubble("reflow")}))},_.copy=function(){this.setTextareaSelection()},_.paste=function(text){this.options.statelessClipboard&&(text="$"===text.slice(0,1)&&"$"===text.slice(-1)?text.slice(1,-1):"\\text{"+text+"}"),this.writeLatex(text).cursor.show()}}));var latexMathParser=function(){function joinBlocks(blocks){for(var firstBlock=blocks[0]||MathBlock(),i=1;i<blocks.length;i+=1)blocks[i].children().adopt(firstBlock,firstBlock.ends[1],0);return firstBlock}var string=Parser.string,regex=Parser.regex,letter=Parser.letter,any=Parser.any,optWhitespace=Parser.optWhitespace,succeed=Parser.succeed,fail=Parser.fail,variable=letter.map((function(c){return Letter(c)})),symbol=regex(/^[^${}\\_^]/).map((function(c){return VanillaSymbol(c)})),command=regex(/^[^\\a-eg-zA-Z]/).or(string("\\").then(regex(/^[a-z]+/i).or(regex(/^\s+/).result(" ")).or(any))).then((function(ctrlSeq){var cmdKlass=LatexCmds[ctrlSeq];return cmdKlass?cmdKlass(ctrlSeq).parser():fail("unknown command: \\"+ctrlSeq)})).or(variable).or(symbol),mathGroup=string("{").then((function(){return mathSequence})).skip(string("}")),mathBlock=optWhitespace.then(mathGroup.or(command.map((function(cmd){var block=MathBlock();return cmd.adopt(block,0,0),block})))),mathSequence=mathBlock.many().map(joinBlocks).skip(optWhitespace),optMathBlock=string("[").then(mathBlock.then((function(block){return"]"!==block.join("latex")?succeed(block):fail()})).many().map(joinBlocks).skip(optWhitespace)).skip(string("]")),latexMath=mathSequence;return latexMath.block=mathBlock,latexMath.optBlock=optMathBlock,latexMath}();Controller.open((function(_,super_){_.exportLatex=function(){return this.root.latex().replace(/(\\[a-z]+) (?![a-z])/gi,"$1")},optionProcessors.maxDepth=function(depth){return"number"==typeof depth?depth:undefined},_.writeLatex=function(latex){var cursor=this.notify("edit").cursor;return cursor.parent.writeLatex(cursor,latex),this},_.renderLatexMath=function(latex){var root=this.root,cursor=this.cursor,jQ=(cursor.options,root.jQ),all=Parser.all,eof=Parser.eof,block=latexMathParser.skip(eof).or(all.result(!1)).parse(latex);if(root.eachChild("postOrder","dispose"),root.ends[L]=root.ends[1]=0,block&&block.prepareInsertionAt(cursor)){block.children().adopt(root,0,0);var html=block.join("html");jQ.html(html),root.jQize(jQ.children()),root.finalizeInsert(cursor.options)}else jQ.empty();delete cursor.selection,cursor.insAtRightEnd(root)},_.renderLatexText=function(latex){var root=this.root,cursor=this.cursor;root.jQ.children().slice(1).remove(),root.eachChild("postOrder","dispose"),root.ends[L]=root.ends[1]=0,delete cursor.selection,cursor.show().insAtRightEnd(root);var regex=Parser.regex,string=Parser.string,eof=Parser.eof,all=Parser.all,mathMode=string("$").then(latexMathParser).skip(string("$").or(eof)).map((function(block){var rootMathCommand=RootMathCommand(cursor);rootMathCommand.createBlocks();var rootMathBlock=rootMathCommand.ends[L];return block.children().adopt(rootMathBlock,0,0),rootMathCommand})),textChar=string("\\$").result("$").or(regex(/^[^$]/)).map(VanillaSymbol),commands=mathMode.or(textChar).many().skip(eof).or(all.result(!1)).parse(latex);if(commands){for(var i=0;i<commands.length;i+=1)commands[i].adopt(root,root.ends[1],0);root.jQize().appendTo(root.jQ),root.finalizeInsert(cursor.options)}}})),Controller.open((function(_){_.scrollHoriz=function(){var cursor=this.cursor,seln=cursor.selection,rootRect=this.root.jQ[0].getBoundingClientRect();if(seln){var rect=seln.jQ[0].getBoundingClientRect(),overLeft=rect.left-(rootRect.left+20),overRight=rect.right-(rootRect.right-20);if(seln.ends[L]===cursor[1])if(overLeft<0)scrollBy=overLeft;else{if(!(overRight>0))return;if(rect.left-overRight<rootRect.left+20)scrollBy=overLeft;else scrollBy=overRight}else if(overRight>0)scrollBy=overRight;else{if(!(overLeft<0))return;if(rect.right-overLeft>rootRect.right-20)scrollBy=overRight;else scrollBy=overLeft}}else{var x=cursor.jQ[0].getBoundingClientRect().left;if(x>rootRect.right-20)var scrollBy=x-(rootRect.right-20);else{if(!(x<rootRect.left+20))return;var scrollBy=x-(rootRect.left+20)}}this.root.jQ.stop().animate({scrollLeft:"+="+scrollBy},100)}}));var MathElement=P(Node,(function(_,super_){_.finalizeInsert=function(options,cursor){this.postOrder("finalizeTree",options),this.postOrder("contactWeld",cursor),this.postOrder("blur"),this.postOrder("reflow"),this[1].siblingCreated&&this[1].siblingCreated(options,L),this[L].siblingCreated&&this[L].siblingCreated(options,1),this.bubble("reflow")},_.prepareInsertionAt=function(cursor){var maxDepth=cursor.options.maxDepth;if(undefined!==maxDepth){var cursorDepth=cursor.depth();if(cursorDepth>maxDepth)return!1;this.removeNodesDeeperThan(maxDepth-cursorDepth)}return!0},_.removeNodesDeeperThan=function(cutoff){for(var current,depth=0,queue=[[this,depth]];queue.length;)(current=queue.shift())[0].children().each((function(child){var i=child instanceof MathBlock?1:0;(depth=current[1]+i)<=cutoff?queue.push([child,depth]):(i?child.children():child).remove()}))}})),MathCommand=P(MathElement,(function(_,super_){_.init=function(ctrlSeq,htmlTemplate,textTemplate){super_.init.call(this),this.ctrlSeq||(this.ctrlSeq=ctrlSeq),htmlTemplate&&(this.htmlTemplate=htmlTemplate),textTemplate&&(this.textTemplate=textTemplate)},_.replaces=function(replacedFragment){replacedFragment.disown(),this.replacedFragment=replacedFragment},_.isEmpty=function(){return this.foldChildren(!0,(function(isEmpty,child){return isEmpty&&child.isEmpty()}))},_.parser=function(){var block=latexMathParser.block,self=this;return block.times(self.numBlocks()).map((function(blocks){self.blocks=blocks;for(var i=0;i<blocks.length;i+=1)blocks[i].adopt(self,self.ends[1],0);return self}))},_.createLeftOf=function(cursor){var replacedFragment=this.replacedFragment;this.createBlocks(),super_.createLeftOf.call(this,cursor),replacedFragment&&(replacedFragment.adopt(this.ends[L],0,0),replacedFragment.jQ.appendTo(this.ends[L].jQ),this.placeCursor(cursor),this.prepareInsertionAt(cursor)),this.finalizeInsert(cursor.options),this.placeCursor(cursor)},_.createBlocks=function(){for(var numBlocks=this.numBlocks(),blocks=this.blocks=Array(numBlocks),i=0;i<numBlocks;i+=1){(blocks[i]=MathBlock()).adopt(this,this.ends[1],0)}},_.placeCursor=function(cursor){cursor.insAtRightEnd(this.foldChildren(this.ends[L],(function(leftward,child){return leftward.isEmpty()?leftward:child})))},_.moveTowards=function(dir,cursor,updown){var updownInto=updown&&this[updown+"Into"];cursor.insAtDirEnd(-dir,updownInto||this.ends[-dir])},_.deleteTowards=function(dir,cursor){this.isEmpty()?cursor[dir]=this.remove()[dir]:this.moveTowards(dir,cursor,null)},_.selectTowards=function(dir,cursor){cursor[-dir]=this,cursor[dir]=this[dir]},_.selectChildren=function(){return Selection(this,this)},_.unselectInto=function(dir,cursor){cursor.insAtDirEnd(-dir,cursor.anticursor.ancestors[this.id])},_.seek=function(pageX,cursor){function getBounds(node){var bounds={};return bounds[L]=node.jQ.offset().left,bounds[1]=bounds[L]+node.jQ.outerWidth(),bounds}var cmd=this,cmdBounds=getBounds(cmd);if(pageX<cmdBounds[L])return cursor.insLeftOf(cmd);if(pageX>cmdBounds[1])return cursor.insRightOf(cmd);var leftLeftBound=cmdBounds[L];cmd.eachChild((function(block){var blockBounds=getBounds(block);return pageX<blockBounds[L]?(pageX-leftLeftBound<blockBounds[L]-pageX?block[L]?cursor.insAtRightEnd(block[L]):cursor.insLeftOf(cmd):cursor.insAtLeftEnd(block),!1):pageX>blockBounds[1]?void(block[1]?leftLeftBound=blockBounds[1]:cmdBounds[1]-pageX<pageX-blockBounds[1]?cursor.insRightOf(cmd):cursor.insAtRightEnd(block)):(block.seek(pageX,cursor),!1)}))},_.numBlocks=function(){var matches=this.htmlTemplate.match(/&\d+/g);return matches?matches.length:0},_.html=function(){var blocks=this.blocks,cmdId=" mathquill-command-id="+this.id,tokens=this.htmlTemplate.match(/<[^<>]+>|[^<>]+/g);pray("no unmatched angle brackets",tokens.join("")===this.htmlTemplate);for(var i=0,token=tokens[0];token;token=tokens[i+=1])if("/>"===token.slice(-2))tokens[i]=token.slice(0,-2)+cmdId+"/>";else if("<"===token.charAt(0)){pray("not an unmatched top-level close tag","/"!==token.charAt(1)),tokens[i]=token.slice(0,-1)+cmdId+">";var nesting=1;do{pray("no missing close tags",token=tokens[i+=1]),"</"===token.slice(0,2)?nesting-=1:"<"===token.charAt(0)&&"/>"!==token.slice(-2)&&(nesting+=1)}while(nesting>0)}return tokens.join("").replace(/>&(\d+)/g,(function($0,$1){return" mathquill-block-id="+blocks[$1].id+">"+blocks[$1].join("html")}))},_.latex=function(){return this.foldChildren(this.ctrlSeq,(function(latex,child){return latex+"{"+(child.latex()||" ")+"}"}))},_.textTemplate=[""],_.text=function(){var cmd=this,i=0;return cmd.foldChildren(cmd.textTemplate[i],(function(text,child){i+=1;var child_text=child.text();return text&&"("===cmd.textTemplate[i]&&"("===child_text[0]&&")"===child_text.slice(-1)?text+child_text.slice(1,-1)+cmd.textTemplate[i]:text+child_text+(cmd.textTemplate[i]||"")}))}})),Symbol=P(MathCommand,(function(_,super_){_.init=function(ctrlSeq,html,text){text||(text=ctrlSeq&&ctrlSeq.length>1?ctrlSeq.slice(1):ctrlSeq),super_.init.call(this,ctrlSeq,html,[text])},_.parser=function(){return Parser.succeed(this)},_.numBlocks=function(){return 0},_.replaces=function(replacedFragment){replacedFragment.remove()},_.createBlocks=noop,_.moveTowards=function(dir,cursor){cursor.jQ.insDirOf(dir,this.jQ),cursor[-dir]=this,cursor[dir]=this[dir]},_.deleteTowards=function(dir,cursor){cursor[dir]=this.remove()[dir]},_.seek=function(pageX,cursor){pageX-this.jQ.offset().left<this.jQ.outerWidth()/2?cursor.insLeftOf(this):cursor.insRightOf(this)},_.latex=function(){return this.ctrlSeq},_.text=function(){return this.textTemplate},_.placeCursor=noop,_.isEmpty=function(){return!0}})),VanillaSymbol=P(Symbol,(function(_,super_){_.init=function(ch,html){super_.init.call(this,ch,"<span>"+(html||ch)+"</span>")}})),BinaryOperator=P(Symbol,(function(_,super_){_.init=function(ctrlSeq,html,text){super_.init.call(this,ctrlSeq,'<span class="mq-binary-operator">'+html+"</span>",text)}})),MathBlock=P(MathElement,(function(_,super_){_.join=function(methodName){return this.foldChildren("",(function(fold,child){return fold+child[methodName]()}))},_.html=function(){return this.join("html")},_.latex=function(){return this.join("latex")},_.text=function(){return this.ends[L]===this.ends[1]&&0!==this.ends[L]?this.ends[L].text():this.join("text")},_.keystroke=function(key,e,ctrlr){return!ctrlr.options.spaceBehavesLikeTab||"Spacebar"!==key&&"Shift-Spacebar"!==key?super_.keystroke.apply(this,arguments):(e.preventDefault(),void ctrlr.escapeDir("Shift-Spacebar"===key?L:1,key,e))},_.moveOutOf=function(dir,cursor,updown){!(updown&&this.parent[updown+"Into"])&&this[dir]?cursor.insAtDirEnd(-dir,this[dir]):cursor.insDirOf(dir,this.parent)},_.selectOutOf=function(dir,cursor){cursor.insDirOf(dir,this.parent)},_.deleteOutOf=function(dir,cursor){cursor.unwrapGramp()},_.seek=function(pageX,cursor){var node=this.ends[1];if(!node||node.jQ.offset().left+node.jQ.outerWidth()<pageX)return cursor.insAtRightEnd(this);if(pageX<this.ends[L].jQ.offset().left)return cursor.insAtLeftEnd(this);for(;pageX<node.jQ.offset().left;)node=node[L];return node.seek(pageX,cursor)},_.chToCmd=function(ch,options){var cons;return ch.match(/^[a-eg-zA-Z]$/)?Letter(ch):/^\d$/.test(ch)?Digit(ch):options&&options.typingSlashWritesDivisionSymbol&&"/"===ch?LatexCmds["÷"](ch):options&&options.typingAsteriskWritesTimesSymbol&&"*"===ch?LatexCmds["×"](ch):(cons=CharCmds[ch]||LatexCmds[ch])?cons(ch):VanillaSymbol(ch)},_.write=function(cursor,ch){var cmd=this.chToCmd(ch,cursor.options);cursor.selection&&cmd.replaces(cursor.replaceSelection()),cursor.isTooDeep()||cmd.createLeftOf(cursor.show())},_.writeLatex=function(cursor,latex){var all=Parser.all,eof=Parser.eof,block=latexMathParser.skip(eof).or(all.result(!1)).parse(latex);block&&!block.isEmpty()&&block.prepareInsertionAt(cursor)&&(block.children().adopt(cursor.parent,cursor[L],cursor[1]),block.jQize().insertBefore(cursor.jQ),cursor[L]=block.ends[1],block.finalizeInsert(cursor.options,cursor),block.ends[1][1].siblingCreated&&block.ends[1][1].siblingCreated(cursor.options,L),block.ends[L][L].siblingCreated&&block.ends[L][L].siblingCreated(cursor.options,1),cursor.parent.bubble("reflow"))},_.focus=function(){return this.jQ.addClass("mq-hasCursor"),this.jQ.removeClass("mq-empty"),this},_.blur=function(){return this.jQ.removeClass("mq-hasCursor"),this.isEmpty()&&this.jQ.addClass("mq-empty"),this}}));Options.p.mouseEvents=!0,API.StaticMath=function(APIClasses){return P(APIClasses.AbstractMathQuill,(function(_,super_){this.RootBlock=MathBlock,_.__mathquillify=function(opts,interfaceVersion){return this.config(opts),super_.__mathquillify.call(this,"mq-math-mode"),this.__options.mouseEvents&&(this.__controller.delegateMouseEvents(),this.__controller.staticMathTextareaEvents()),this},_.init=function(){super_.init.apply(this,arguments),this.__controller.root.postOrder("registerInnerField",this.innerFields=[],APIClasses.InnerMathField)},_.latex=function(){var returned=super_.latex.apply(this,arguments);return arguments.length>0&&this.__controller.root.postOrder("registerInnerField",this.innerFields=[],APIClasses.InnerMathField),returned}}))};var RootMathBlock=P(MathBlock,RootBlockMixin);API.MathField=function(APIClasses){return P(APIClasses.EditableField,(function(_,super_){this.RootBlock=RootMathBlock,_.__mathquillify=function(opts,interfaceVersion){return this.config(opts),interfaceVersion>1&&(this.__controller.root.reflow=noop),super_.__mathquillify.call(this,"mq-editable-field mq-math-mode"),delete this.__controller.root.reflow,this}}))},API.InnerMathField=function(APIClasses){return P(APIClasses.MathField,(function(_,super_){_.makeStatic=function(){this.__controller.editable=!1,this.__controller.root.blur(),this.__controller.unbindEditablesEvents(),this.__controller.container.removeClass("mq-editable-field")},_.makeEditable=function(){this.__controller.editable=!0,this.__controller.editablesTextareaEvents(),this.__controller.cursor.insAtRightEnd(this.__controller.root),this.__controller.container.addClass("mq-editable-field")}}))};var TextBlock=P(Node,(function(_,super_){function fuseChildren(self){self.jQ[0].normalize();var textPcDom=self.jQ[0].firstChild;if(textPcDom){pray("only node in TextBlock span is Text node",3===textPcDom.nodeType);var textPc=TextPiece(textPcDom.data);return textPc.jQadd(textPcDom),self.children().disown(),textPc.adopt(self,0,0)}}_.ctrlSeq="\\text",_.replaces=function(replacedText){replacedText instanceof Fragment?this.replacedText=replacedText.remove().jQ.text():"string"==typeof replacedText&&(this.replacedText=replacedText)},_.jQadd=function(jQ){super_.jQadd.call(this,jQ),this.ends[L]&&this.ends[L].jQadd(this.jQ[0].firstChild)},_.createLeftOf=function(cursor){if(super_.createLeftOf.call(this,cursor),cursor.insAtRightEnd(this),this.replacedText)for(var i=0;i<this.replacedText.length;i+=1)this.write(cursor,this.replacedText.charAt(i));this[1].siblingCreated&&this[1].siblingCreated(cursor.options,L),this[L].siblingCreated&&this[L].siblingCreated(cursor.options,1),this.bubble("reflow")},_.parser=function(){var textBlock=this,string=Parser.string,regex=Parser.regex;return Parser.optWhitespace.then(string("{")).then(regex(/^[^}]*/)).skip(string("}")).map((function(text){return 0===text.length?Fragment():(TextPiece(text).adopt(textBlock,0,0),textBlock)}))},_.textContents=function(){return this.foldChildren("",(function(text,child){return text+child.text}))},_.text=function(){return'"'+this.textContents()+'"'},_.latex=function(){var contents=this.textContents();return 0===contents.length?"":"\\text{"+contents.replace(/\\/g,"\\backslash ").replace(/[{}]/g,"\\$&")+"}"},_.html=function(){return'<span class="mq-text-mode" mathquill-command-id='+this.id+">"+this.textContents()+"</span>"},_.moveTowards=function(dir,cursor){cursor.insAtDirEnd(-dir,this)},_.moveOutOf=function(dir,cursor){cursor.insDirOf(dir,this)},_.unselectInto=_.moveTowards,_.selectTowards=MathCommand.prototype.selectTowards,_.deleteTowards=MathCommand.prototype.deleteTowards,_.selectOutOf=function(dir,cursor){cursor.insDirOf(dir,this)},_.deleteOutOf=function(dir,cursor){this.isEmpty()&&cursor.insRightOf(this)},_.write=function(cursor,ch){if(cursor.show().deleteSelection(),"$"!==ch)cursor[L]?cursor[L].appendText(ch):TextPiece(ch).createLeftOf(cursor);else if(this.isEmpty())cursor.insRightOf(this),VanillaSymbol("\\$","$").createLeftOf(cursor);else if(cursor[1])if(cursor[L]){var leftBlock=TextBlock(),leftPc=this.ends[L];leftPc.disown().jQ.detach(),leftPc.adopt(leftBlock,0,0),cursor.insLeftOf(this),super_.createLeftOf.call(leftBlock,cursor)}else cursor.insLeftOf(this);else cursor.insRightOf(this);this.bubble("reflow")},_.writeLatex=function(cursor,latex){cursor[L]?cursor[L].appendText(latex):TextPiece(latex).createLeftOf(cursor),this.bubble("reflow")},_.seek=function(pageX,cursor){cursor.hide();var textPc=fuseChildren(this),avgChWidth=this.jQ.width()/this.text.length,approxPosition=Math.round((pageX-this.jQ.offset().left)/avgChWidth);approxPosition<=0?cursor.insAtLeftEnd(this):approxPosition>=textPc.text.length?cursor.insAtRightEnd(this):cursor.insLeftOf(textPc.splitRight(approxPosition));for(var displ=pageX-cursor.show().offset().left,dir=displ&&displ<0?L:1,prevDispl=dir;cursor[dir]&&displ*prevDispl>0;)cursor[dir].moveTowards(dir,cursor),prevDispl=displ,displ=pageX-cursor.offset().left;if(dir*displ<-dir*prevDispl&&cursor[-dir].moveTowards(-dir,cursor),cursor.anticursor){if(cursor.anticursor.parent===this){var cursorPosition=cursor[L]&&cursor[L].text.length;if(this.anticursorPosition===cursorPosition)cursor.anticursor=Point.copy(cursor);else{if(this.anticursorPosition<cursorPosition){var newTextPc=cursor[L].splitRight(this.anticursorPosition);cursor[L]=newTextPc}else newTextPc=cursor[1].splitRight(this.anticursorPosition-cursorPosition);cursor.anticursor=Point(this,newTextPc[L],newTextPc)}}}else this.anticursorPosition=cursor[L]&&cursor[L].text.length},_.blur=function(cursor){MathBlock.prototype.blur.call(this),cursor&&(""===this.textContents()?(this.remove(),cursor[L]===this?cursor[L]=this[L]:cursor[1]===this&&(cursor[1]=this[1])):fuseChildren(this))},_.focus=MathBlock.prototype.focus})),TextPiece=P(Node,(function(_,super_){function endChar(dir,text){return text.charAt(dir===L?0:-1+text.length)}_.init=function(text){super_.init.call(this),this.text=text},_.jQadd=function(dom){this.dom=dom,this.jQ=$(dom)},_.jQize=function(){return this.jQadd(document.createTextNode(this.text))},_.appendText=function(text){this.text+=text,this.dom.appendData(text)},_.prependText=function(text){this.text=text+this.text,this.dom.insertData(0,text)},_.insTextAtDirEnd=function(text,dir){prayDirection(dir),1===dir?this.appendText(text):this.prependText(text)},_.splitRight=function(i){var newPc=TextPiece(this.text.slice(i)).adopt(this.parent,this,this[1]);return newPc.jQadd(this.dom.splitText(i)),this.text=this.text.slice(0,i),newPc},_.moveTowards=function(dir,cursor){prayDirection(dir);var ch=endChar(-dir,this.text),from=this[-dir];return from?from.insTextAtDirEnd(ch,dir):TextPiece(ch).createDir(-dir,cursor),this.deleteTowards(dir,cursor)},_.latex=function(){return this.text},_.deleteTowards=function(dir,cursor){this.text.length>1?1===dir?(this.dom.deleteData(0,1),this.text=this.text.slice(1)):(this.dom.deleteData(-1+this.text.length,1),this.text=this.text.slice(0,-1)):(this.remove(),this.jQ.remove(),cursor[dir]=this[dir])},_.selectTowards=function(dir,cursor){prayDirection(dir);var anticursor=cursor.anticursor,ch=endChar(-dir,this.text);if(anticursor[dir]===this){var newPc=TextPiece(ch).createDir(dir,cursor);anticursor[dir]=newPc,cursor.insDirOf(dir,newPc)}else{var from=this[-dir];if(from)from.insTextAtDirEnd(ch,dir);else(newPc=TextPiece(ch).createDir(-dir,cursor)).jQ.insDirOf(-dir,cursor.selection.jQ);1===this.text.length&&anticursor[-dir]===this&&(anticursor[-dir]=this[-dir])}return this.deleteTowards(dir,cursor)}}));function makeTextBlock(latex,tagName,attrs){return P(TextBlock,{ctrlSeq:latex,htmlTemplate:"<"+tagName+" "+attrs+">&0</"+tagName+">"})}LatexCmds.text=LatexCmds.textnormal=LatexCmds.textrm=LatexCmds.textup=LatexCmds.textmd=TextBlock,LatexCmds.em=LatexCmds.italic=LatexCmds.italics=LatexCmds.emph=LatexCmds.textit=LatexCmds.textsl=makeTextBlock("\\textit","i",'class="mq-text-mode"'),LatexCmds.strong=LatexCmds.bold=LatexCmds.textbf=makeTextBlock("\\textbf","b",'class="mq-text-mode"'),LatexCmds.sf=LatexCmds.textsf=makeTextBlock("\\textsf","span",'class="mq-sans-serif mq-text-mode"'),LatexCmds.tt=LatexCmds.texttt=makeTextBlock("\\texttt","span",'class="mq-monospace mq-text-mode"'),LatexCmds.textsc=makeTextBlock("\\textsc","span",'style="font-variant:small-caps" class="mq-text-mode"'),LatexCmds.uppercase=makeTextBlock("\\uppercase","span",'style="text-transform:uppercase" class="mq-text-mode"'),LatexCmds.lowercase=makeTextBlock("\\lowercase","span",'style="text-transform:lowercase" class="mq-text-mode"');var RootMathCommand=P(MathCommand,(function(_,super_){_.init=function(cursor){super_.init.call(this,"$"),this.cursor=cursor},_.htmlTemplate='<span class="mq-math-mode">&0</span>',_.createBlocks=function(){super_.createBlocks.call(this),this.ends[L].cursor=this.cursor,this.ends[L].write=function(cursor,ch){"$"!==ch?MathBlock.prototype.write.call(this,cursor,ch):this.isEmpty()?(cursor.insRightOf(this.parent),this.parent.deleteTowards(dir,cursor),VanillaSymbol("\\$","$").createLeftOf(cursor.show())):cursor[1]?cursor[L]?MathBlock.prototype.write.call(this,cursor,ch):cursor.insLeftOf(this.parent):cursor.insRightOf(this.parent)}},_.latex=function(){return"$"+this.ends[L].latex()+"$"}})),RootTextBlock=P(RootMathBlock,(function(_,super_){_.keystroke=function(key){if("Spacebar"!==key&&"Shift-Spacebar"!==key)return super_.keystroke.apply(this,arguments)},_.write=function(cursor,ch){var html;(cursor.show().deleteSelection(),"$"===ch)?RootMathCommand(cursor).createLeftOf(cursor):("<"===ch?html="&lt;":">"===ch&&(html="&gt;"),VanillaSymbol(ch,html).createLeftOf(cursor))}}));API.TextField=function(APIClasses){return P(APIClasses.EditableField,(function(_,super_){this.RootBlock=RootTextBlock,_.__mathquillify=function(){return super_.__mathquillify.call(this,"mq-editable-field mq-text-mode")},_.latex=function(latex){return arguments.length>0?(this.__controller.renderLatexText(latex),this.__controller.blurred&&this.__controller.cursor.hide().parent.blur(),this):this.__controller.exportLatex()}}))};CharCmds["\\"]=P(MathCommand,(function(_,super_){_.ctrlSeq="\\",_.replaces=function(replacedFragment){this._replacedFragment=replacedFragment.disown(),this.isEmpty=function(){return!1}},_.htmlTemplate='<span class="mq-latex-command-input mq-non-leaf">\\<span>&0</span></span>',_.textTemplate=["\\"],_.createBlocks=function(){super_.createBlocks.call(this),this.ends[L].focus=function(){return this.parent.jQ.addClass("mq-hasCursor"),this.isEmpty()&&this.parent.jQ.removeClass("mq-empty"),this},this.ends[L].blur=function(){return this.parent.jQ.removeClass("mq-hasCursor"),this.isEmpty()&&this.parent.jQ.addClass("mq-empty"),this},this.ends[L].write=function(cursor,ch){cursor.show().deleteSelection(),ch.match(/[a-z]/i)?VanillaSymbol(ch).createLeftOf(cursor):(this.parent.renderCommand(cursor),"\\"===ch&&this.isEmpty()||cursor.parent.write(cursor,ch))},this.ends[L].keystroke=function(key,e,ctrlr){return"Tab"===key||"Enter"===key||"Spacebar"===key?(this.parent.renderCommand(ctrlr.cursor),void e.preventDefault()):super_.keystroke.apply(this,arguments)}},_.createLeftOf=function(cursor){if(super_.createLeftOf.call(this,cursor),this._replacedFragment){var el=this.jQ[0];this.jQ=this._replacedFragment.jQ.addClass("mq-blur").bind("mousedown mousemove",(function(e){return $(e.target=el).trigger(e),!1})).insertBefore(this.jQ).add(this.jQ)}},_.latex=function(){return"\\"+this.ends[L].latex()+" "},_.renderCommand=function(cursor){this.jQ=this.jQ.last(),this.remove(),this[1]?cursor.insLeftOf(this[1]):cursor.insAtRightEnd(this.parent);var latex=this.ends[L].latex();latex||(latex=" ");var cmd=LatexCmds[latex];cmd?(cmd=cmd(latex),this._replacedFragment&&cmd.replaces(this._replacedFragment),cmd.createLeftOf(cursor)):((cmd=TextBlock()).replaces(latex),cmd.createLeftOf(cursor),cursor.insRightOf(cmd),this._replacedFragment&&this._replacedFragment.remove())}}));var scale,transformPropName,forceIERedraw=noop,div_style=document.createElement("div").style;for(var prop in{transform:1,WebkitTransform:1,MozTransform:1,OTransform:1,msTransform:1})if(prop in div_style){transformPropName=prop;break}transformPropName?scale=function(jQ,x,y){jQ.css(transformPropName,"scale("+x+","+y+")")}:"filter"in div_style?(forceIERedraw=function(el){el.className=el.className},scale=function(jQ,x,y){x/=1+(y-1)/2,jQ.css("fontSize",y+"em"),jQ.hasClass("mq-matrixed-container")||jQ.addClass("mq-matrixed-container").wrapInner('<span class="mq-matrixed"></span>');var innerjQ=jQ.children().css("filter","progid:DXImageTransform.Microsoft.Matrix(M11="+x+",SizingMethod='auto expand')");function calculateMarginRight(){jQ.css("marginRight",(innerjQ.width()-1)*(x-1)/x+"px")}calculateMarginRight();var intervalId=setInterval(calculateMarginRight);$(window).load((function(){clearTimeout(intervalId),calculateMarginRight()}))}):scale=function(jQ,x,y){jQ.css("fontSize",y+"em")};var Style=P(MathCommand,(function(_,super_){_.init=function(ctrlSeq,tagName,attrs){super_.init.call(this,ctrlSeq,"<"+tagName+" "+attrs+">&0</"+tagName+">")}}));LatexCmds.mathrm=bind(Style,"\\mathrm","span",'class="mq-roman mq-font"'),LatexCmds.mathit=bind(Style,"\\mathit","i",'class="mq-font"'),LatexCmds.mathbf=bind(Style,"\\mathbf","b",'class="mq-font"'),LatexCmds.mathsf=bind(Style,"\\mathsf","span",'class="mq-sans-serif mq-font"'),LatexCmds.mathtt=bind(Style,"\\mathtt","span",'class="mq-monospace mq-font"'),LatexCmds.underline=bind(Style,"\\underline","span",'class="mq-non-leaf mq-underline"'),LatexCmds.overline=LatexCmds.bar=bind(Style,"\\overline","span",'class="mq-non-leaf mq-overline"'),LatexCmds.overrightarrow=bind(Style,"\\overrightarrow","span",'class="mq-non-leaf mq-overarrow mq-arrow-right"'),LatexCmds.overleftarrow=bind(Style,"\\overleftarrow","span",'class="mq-non-leaf mq-overarrow mq-arrow-left"'),LatexCmds.overleftrightarrow=bind(Style,"\\overleftrightarrow","span",'class="mq-non-leaf mq-overarrow mq-arrow-both"'),LatexCmds.overarc=bind(Style,"\\overarc","span",'class="mq-non-leaf mq-overarc"'),LatexCmds.dot=P(MathCommand,(function(_,super_){_.init=function(){super_.init.call(this,"\\dot",'<span class="mq-non-leaf"><span class="mq-dot-recurring-inner"><span class="mq-dot-recurring">&#x2d9;</span><span class="mq-empty-box">&0</span></span></span>')}}));LatexCmds.textcolor=P(MathCommand,(function(_,super_){_.setColor=function(color){this.color=color,this.htmlTemplate='<span class="mq-textcolor" style="color:'+color+'">&0</span>'},_.latex=function(){return"\\textcolor{"+this.color+"}{"+this.blocks[0].latex()+"}"},_.parser=function(){var self=this,optWhitespace=Parser.optWhitespace,string=Parser.string,regex=Parser.regex;return optWhitespace.then(string("{")).then(regex(/^[#\w\s.,()%-]*/)).skip(string("}")).then((function(color){return self.setColor(color),super_.parser.call(self)}))},_.isStyleBlock=function(){return!0}})),LatexCmds.class=P(MathCommand,(function(_,super_){_.parser=function(){var self=this,string=Parser.string,regex=Parser.regex;return Parser.optWhitespace.then(string("{")).then(regex(/^[-\w\s\\\xA0-\xFF]*/)).skip(string("}")).then((function(cls){return self.cls=cls||"",self.htmlTemplate='<span class="mq-class '+cls+'">&0</span>',super_.parser.call(self)}))},_.latex=function(){return"\\class{"+this.cls+"}{"+this.blocks[0].latex()+"}"},_.isStyleBlock=function(){return!0}}));var SupSub=P(MathCommand,(function(_,super_){_.ctrlSeq="_{...}^{...}",_.createLeftOf=function(cursor){if(this.replacedFragment||cursor[L]||!cursor.options.supSubsRequireOperand)return super_.createLeftOf.apply(this,arguments)},_.contactWeld=function(cursor){for(var dir=L;dir;dir=dir===L&&1)if(this[dir]instanceof SupSub){for(var supsub="sub";supsub;supsub="sub"===supsub&&"sup"){var src=this[supsub],dest=this[dir][supsub];if(src){if(dest)if(src.isEmpty())pt=Point(dest,0,dest.ends[L]);else{src.jQ.children().insAtDirEnd(-dir,dest.jQ);var children=src.children().disown(),pt=Point(dest,children.ends[1],dest.ends[L]);dir===L?children.adopt(dest,dest.ends[1],0):children.adopt(dest,0,dest.ends[L])}else this[dir].addBlock(src.disown());this.placeCursor=function(dest,src){return function(cursor){cursor.insAtDirEnd(-dir,dest||src)}}(dest,src)}}this.remove(),cursor&&cursor[L]===this&&(1===dir&&pt?pt[L]?cursor.insRightOf(pt[L]):cursor.insAtLeftEnd(pt.parent):cursor.insRightOf(this[dir]));break}},Options.p.charsThatBreakOutOfSupSub="",_.finalizeTree=function(){this.ends[L].write=function(cursor,ch){if(cursor.options.autoSubscriptNumerals&&this===this.parent.sub){if("_"===ch)return;var cmd=this.chToCmd(ch,cursor.options);return cmd instanceof Symbol?cursor.deleteSelection():cursor.clearSelection().insRightOf(this.parent),cmd.createLeftOf(cursor.show())}cursor[L]&&!cursor[1]&&!cursor.selection&&cursor.options.charsThatBreakOutOfSupSub.indexOf(ch)>-1&&cursor.insRightOf(this.parent),MathBlock.p.write.apply(this,arguments)}},_.moveTowards=function(dir,cursor,updown){cursor.options.autoSubscriptNumerals&&!this.sup?cursor.insDirOf(dir,this):super_.moveTowards.apply(this,arguments)},_.deleteTowards=function(dir,cursor){if(cursor.options.autoSubscriptNumerals&&this.sub){var cmd=this.sub.ends[-dir];cmd instanceof Symbol?cmd.remove():cmd&&cmd.deleteTowards(dir,cursor.insAtDirEnd(-dir,this.sub)),this.sub.isEmpty()&&(this.sub.deleteOutOf(L,cursor.insAtLeftEnd(this.sub)),this.sup&&cursor.insDirOf(-dir,this))}else super_.deleteTowards.apply(this,arguments)},_.latex=function(){function latex(prefix,block){var l=block&&block.latex();return block?prefix+(1===l.length?l:"{"+(l||" ")+"}"):""}return latex("_",this.sub)+latex("^",this.sup)},_.text=function(){function text(prefix,block){var l=block&&block.text();return block?prefix+(1===l.length?l:"("+(l||" ")+")"):""}return text("_",this.sub)+text("^",this.sup)},_.addBlock=function(block){"sub"===this.supsub?(this.sup=this.upInto=this.sub.upOutOf=block,block.adopt(this,this.sub,0).downOutOf=this.sub,block.jQ=$('<span class="mq-sup"/>').append(block.jQ.children()).attr(mqBlockId,block.id).prependTo(this.jQ)):(this.sub=this.downInto=this.sup.downOutOf=block,block.adopt(this,0,this.sup).upOutOf=this.sup,block.jQ=$('<span class="mq-sub"></span>').append(block.jQ.children()).attr(mqBlockId,block.id).appendTo(this.jQ.removeClass("mq-sup-only")),this.jQ.append('<span style="display:inline-block;width:0">&#8203;</span>'));for(var i=0;i<2;i+=1)!function(cmd,supsub,oppositeSupsub,updown){cmd[supsub].deleteOutOf=function(dir,cursor){if(cursor.insDirOf(this[dir]?-dir:dir,this.parent),!this.isEmpty()){var end=this.ends[dir];this.children().disown().withDirAdopt(dir,cursor.parent,cursor[dir],cursor[-dir]).jQ.insDirOf(-dir,cursor.jQ),cursor[-dir]=end}cmd.supsub=oppositeSupsub,delete cmd[supsub],delete cmd[updown+"Into"],cmd[oppositeSupsub][updown+"OutOf"]=insLeftOfMeUnlessAtEnd,delete cmd[oppositeSupsub].deleteOutOf,"sub"===supsub&&$(cmd.jQ.addClass("mq-sup-only")[0].lastChild).remove(),this.remove()}}(this,"sub sup".split(" ")[i],"sup sub".split(" ")[i],"down up".split(" ")[i])},_.reflow=function(){var $block=this.jQ,$prev=$block.prev();if($prev.length){var $sup=$block.children(".mq-sup");if($sup.length){var sup_fontsize=parseInt($sup.css("font-size")),needed=$sup.offset().top+$sup.height()-$prev.offset().top-.7*sup_fontsize,cur_margin=parseInt($sup.css("margin-bottom"));$sup.css("margin-bottom",cur_margin+needed)}}}}));function insLeftOfMeUnlessAtEnd(cursor){var cmd=this.parent,ancestorCmd=cursor;do{if(ancestorCmd[1])return cursor.insLeftOf(cmd);ancestorCmd=ancestorCmd.parent.parent}while(ancestorCmd!==cmd);cursor.insRightOf(cmd)}LatexCmds.subscript=LatexCmds._=P(SupSub,(function(_,super_){_.supsub="sub",_.htmlTemplate='<span class="mq-supsub mq-non-leaf"><span class="mq-sub">&0</span><span style="display:inline-block;width:0">&#8203;</span></span>',_.textTemplate=["_"],_.finalizeTree=function(){this.downInto=this.sub=this.ends[L],this.sub.upOutOf=insLeftOfMeUnlessAtEnd,super_.finalizeTree.call(this)}})),LatexCmds.superscript=LatexCmds.supscript=LatexCmds["^"]=P(SupSub,(function(_,super_){_.supsub="sup",_.htmlTemplate='<span class="mq-supsub mq-non-leaf mq-sup-only"><span class="mq-sup">&0</span></span>',_.textTemplate=["^(",")"],_.finalizeTree=function(){this.upInto=this.sup=this.ends[1],this.sup.downOutOf=insLeftOfMeUnlessAtEnd,super_.finalizeTree.call(this)}}));var SummationNotation=P(MathCommand,(function(_,super_){_.init=function(ch,html){var htmlTemplate='<span class="mq-large-operator mq-non-leaf"><span class="mq-to"><span>&1</span></span><big>'+html+'</big><span class="mq-from"><span>&0</span></span></span>';Symbol.prototype.init.call(this,ch,htmlTemplate)},_.createLeftOf=function(cursor){super_.createLeftOf.apply(this,arguments),cursor.options.sumStartsWithNEquals&&(Letter("n").createLeftOf(cursor),Equality().createLeftOf(cursor))},_.latex=function(){function simplify(latex){return 1===latex.length?latex:"{"+(latex||" ")+"}"}return this.ctrlSeq+"_"+simplify(this.ends[L].latex())+"^"+simplify(this.ends[1].latex())},_.parser=function(){for(var string=Parser.string,optWhitespace=Parser.optWhitespace,succeed=Parser.succeed,block=latexMathParser.block,self=this,blocks=self.blocks=[MathBlock(),MathBlock()],i=0;i<blocks.length;i+=1)blocks[i].adopt(self,self.ends[1],0);return optWhitespace.then(string("_").or(string("^"))).then((function(supOrSub){var child=blocks["_"===supOrSub?0:1];return block.then((function(block){return block.children().adopt(child,child.ends[1],0),succeed(self)}))})).many().result(self)},_.finalizeTree=function(){this.downInto=this.ends[L],this.upInto=this.ends[1],this.ends[L].upOutOf=this.ends[1],this.ends[1].downOutOf=this.ends[L]}}));LatexCmds["∑"]=LatexCmds.sum=LatexCmds.summation=bind(SummationNotation,"\\sum ","&sum;"),LatexCmds["∏"]=LatexCmds.prod=LatexCmds.product=bind(SummationNotation,"\\prod ","&prod;"),LatexCmds.coprod=LatexCmds.coproduct=bind(SummationNotation,"\\coprod ","&#8720;"),LatexCmds["∫"]=LatexCmds.int=LatexCmds.integral=P(SummationNotation,(function(_,super_){_.init=function(){Symbol.prototype.init.call(this,"\\int ",'<span class="mq-int mq-non-leaf"><big>&int;</big><span class="mq-supsub mq-non-leaf"><span class="mq-sup"><span class="mq-sup-inner">&1</span></span><span class="mq-sub">&0</span><span style="display:inline-block;width:0">&#8203</span></span></span>')},_.createLeftOf=MathCommand.p.createLeftOf}));var Fraction=LatexCmds.frac=LatexCmds.dfrac=LatexCmds.cfrac=LatexCmds.fraction=P(MathCommand,(function(_,super_){_.ctrlSeq="\\frac",_.htmlTemplate='<span class="mq-fraction mq-non-leaf"><span class="mq-numerator">&0</span><span class="mq-denominator">&1</span><span style="display:inline-block;width:0">&#8203;</span></span>',_.textTemplate=["(",")/(",")"],_.finalizeTree=function(){this.upInto=this.ends[1].upOutOf=this.ends[L],this.downInto=this.ends[L].downOutOf=this.ends[1]}})),LiveFraction=LatexCmds.over=CharCmds["/"]=P(Fraction,(function(_,super_){_.createLeftOf=function(cursor){if(!this.replacedFragment){for(var leftward=cursor[L];leftward&&!(leftward instanceof BinaryOperator||leftward instanceof(LatexCmds.text||noop)||leftward instanceof SummationNotation||"\\ "===leftward.ctrlSeq||/^[,;:]$/.test(leftward.ctrlSeq));)leftward=leftward[L];leftward instanceof SummationNotation&&leftward[1]instanceof SupSub&&(leftward=leftward[1])[1]instanceof SupSub&&leftward[1].ctrlSeq!=leftward.ctrlSeq&&(leftward=leftward[1]),leftward===cursor[L]||cursor.isTooDeep(1)||(this.replaces(Fragment(leftward[1]||cursor.parent.ends[L],cursor[L])),cursor[L]=leftward)}super_.createLeftOf.call(this,cursor)}}));LatexCmds.underset=P(MathCommand,(function(_,super_){_.ctrlSeq="\\underset",_.htmlTemplate='<span class="mq-underset mq-overunder mq-non-leaf"><span class="mq-over">&1</span><span class="mq-under">&0</span></span>',_.textTemplate=["[","|","]"],_.finalizeTree=function(){this.downInto=this.ends[L].upOutOf=this.ends[1],this.upInto=this.ends[1].downOutOf=this.ends[L]}})),LatexCmds.overset=P(MathCommand,(function(_,super_){_.ctrlSeq="\\overset",_.htmlTemplate='<span class="mq-overset mq-overunder mq-non-leaf"><span class="mq-over">&0</span><span class="mq-under">&1</span></span>',_.textTemplate=["[","|","]"],_.finalizeTree=function(){this.downInto=this.ends[1].upOutOf=this.ends[L],this.upInto=this.ends[L].downOutOf=this.ends[1]}}));var SquareRoot=LatexCmds.sqrt=LatexCmds["√"]=P(MathCommand,(function(_,super_){_.ctrlSeq="\\sqrt",_.htmlTemplate='<span class="mq-non-leaf"><span class="mq-scaled mq-sqrt-prefix">&radic;</span><span class="mq-non-leaf mq-sqrt-stem">&0</span></span>',_.textTemplate=["sqrt(",")"],_.parser=function(){return latexMathParser.optBlock.then((function(optBlock){return latexMathParser.block.map((function(block){var nthroot=NthRoot();return nthroot.blocks=[optBlock,block],optBlock.adopt(nthroot,0,0),block.adopt(nthroot,optBlock,0),nthroot}))})).or(super_.parser.call(this))},_.reflow=function(){var block=this.ends[1].jQ;scale(block.prev(),1,block.innerHeight()/+block.css("fontSize").slice(0,-2)-.1)}})),NthRoot=(LatexCmds.hat=P(MathCommand,(function(_,super_){_.ctrlSeq="\\hat",_.htmlTemplate='<span class="mq-non-leaf"><span class="mq-hat-prefix">^</span><span class="mq-hat-stem">&0</span></span>',_.textTemplate=["hat(",")"]})),LatexCmds.nthroot=P(SquareRoot,(function(_,super_){_.htmlTemplate='<sup class="mq-nthroot mq-non-leaf">&0</sup><span class="mq-scaled"><span class="mq-sqrt-prefix mq-scaled">&radic;</span><span class="mq-sqrt-stem mq-non-leaf">&1</span></span>',_.textTemplate=["sqrt[","](",")"],_.latex=function(){return"\\sqrt["+this.ends[L].latex()+"]{"+this.ends[1].latex()+"}"}}))),DiacriticAbove=P(MathCommand,(function(_,super_){_.init=function(ctrlSeq,symbol,textTemplate){var htmlTemplate='<span class="mq-non-leaf"><span class="mq-diacritic-above">'+symbol+'</span><span class="mq-diacritic-stem">&0</span></span>';super_.init.call(this,ctrlSeq,htmlTemplate,textTemplate)}}));function DelimsMixin(_,super_){_.jQadd=function(){super_.jQadd.apply(this,arguments),this.delimjQs=this.jQ.children(":first").add(this.jQ.children(":last")),this.contentjQ=this.jQ.children(":eq(1)")},_.reflow=function(){var height=this.contentjQ.outerHeight()/parseFloat(this.contentjQ.css("fontSize"));scale(this.delimjQs,min(1+.2*(height-1),1.2),1.2*height)}}LatexCmds.vec=bind(DiacriticAbove,"\\vec","&rarr;",["vec(",")"]),LatexCmds.tilde=bind(DiacriticAbove,"\\tilde","~",["tilde(",")"]);var Bracket=P(P(MathCommand,DelimsMixin),(function(_,super_){_.init=function(side,open,close,ctrlSeq,end){super_.init.call(this,"\\left"+ctrlSeq,undefined,[open,close]),this.side=side,this.sides={},this.sides[L]={ch:open,ctrlSeq:ctrlSeq},this.sides[1]={ch:close,ctrlSeq:end}},_.numBlocks=function(){return 1},_.html=function(){return this.htmlTemplate='<span class="mq-non-leaf"><span class="mq-scaled mq-paren'+(1===this.side?" mq-ghost":"")+'">'+this.sides[L].ch+'</span><span class="mq-non-leaf">&0</span><span class="mq-scaled mq-paren'+(this.side===L?" mq-ghost":"")+'">'+this.sides[1].ch+"</span></span>",super_.html.call(this)},_.latex=function(){return"\\left"+this.sides[L].ctrlSeq+this.ends[L].latex()+"\\right"+this.sides[1].ctrlSeq},_.matchBrack=function(opts,expectedSide,node){return node instanceof Bracket&&node.side&&node.side!==-expectedSide&&(!opts.restrictMismatchedBrackets||OPP_BRACKS[this.sides[this.side].ch]===node.sides[node.side].ch||{"(":"]","[":")"}[this.sides[L].ch]===node.sides[1].ch)&&node},_.closeOpposing=function(brack){brack.side=0,brack.sides[this.side]=this.sides[this.side],brack.delimjQs.eq(this.side===L?0:1).removeClass("mq-ghost").html(this.sides[this.side].ch)},_.createLeftOf=function(cursor){if(!this.replacedFragment){var opts=cursor.options;if("|"===this.sides[L].ch)var brack=this.matchBrack(opts,1,cursor[1])||this.matchBrack(opts,L,cursor[L])||this.matchBrack(opts,0,cursor.parent.parent);else brack=this.matchBrack(opts,-this.side,cursor[-this.side])||this.matchBrack(opts,-this.side,cursor.parent.parent)}if(brack){var side=this.side=-brack.side;this.closeOpposing(brack),brack===cursor.parent.parent&&cursor[side]&&Fragment(cursor[side],cursor.parent.ends[side],-side).disown().withDirAdopt(-side,brack.parent,brack,brack[side]).jQ.insDirOf(side,brack.jQ),brack.bubble("reflow")}else side=(brack=this).side,brack.replacedFragment?brack.side=0:cursor[-side]&&(brack.replaces(Fragment(cursor[-side],cursor.parent.ends[-side],side)),cursor[-side]=0),super_.createLeftOf.call(brack,cursor);side===L?cursor.insAtLeftEnd(brack.ends[L]):cursor.insRightOf(brack)},_.placeCursor=noop,_.unwrap=function(){this.ends[L].children().disown().adopt(this.parent,this,this[1]).jQ.insertAfter(this.jQ),this.remove()},_.deleteSide=function(side,outward,cursor){var parent=this.parent,sib=this[side],farEnd=parent.ends[side];if(side===this.side)return this.unwrap(),void(sib?cursor.insDirOf(-side,sib):cursor.insAtDirEnd(side,parent));var opts=cursor.options,wasSolid=!this.side;if(this.side=-side,this.matchBrack(opts,side,this.ends[L].ends[this.side])){this.closeOpposing(this.ends[L].ends[this.side]);var origEnd=this.ends[L].ends[side];this.unwrap(),origEnd.siblingCreated&&origEnd.siblingCreated(cursor.options,side),sib?cursor.insDirOf(-side,sib):cursor.insAtDirEnd(side,parent)}else{if(this.matchBrack(opts,side,this.parent.parent))this.parent.parent.closeOpposing(this),this.parent.parent.unwrap();else{if(outward&&wasSolid)return this.unwrap(),void(sib?cursor.insDirOf(-side,sib):cursor.insAtDirEnd(side,parent));this.sides[side]={ch:OPP_BRACKS[this.sides[this.side].ch],ctrlSeq:OPP_BRACKS[this.sides[this.side].ctrlSeq]},this.delimjQs.removeClass("mq-ghost").eq(side===L?0:1).addClass("mq-ghost").html(this.sides[side].ch)}if(sib){origEnd=this.ends[L].ends[side];Fragment(sib,farEnd,-side).disown().withDirAdopt(-side,this.ends[L],origEnd,0).jQ.insAtDirEnd(side,this.ends[L].jQ.removeClass("mq-empty")),origEnd.siblingCreated&&origEnd.siblingCreated(cursor.options,side),cursor.insDirOf(-side,sib)}else outward?cursor.insDirOf(side,this):cursor.insAtDirEnd(side,this.ends[L])}},_.deleteTowards=function(dir,cursor){this.deleteSide(-dir,!1,cursor)},_.finalizeTree=function(){this.ends[L].deleteOutOf=function(dir,cursor){this.parent.deleteSide(dir,!0,cursor)},this.finalizeTree=this.intentionalBlur=function(){this.delimjQs.eq(this.side===L?1:0).removeClass("mq-ghost"),this.side=0}},_.siblingCreated=function(opts,dir){dir===-this.side&&this.finalizeTree()}})),OPP_BRACKS={"(":")",")":"(","[":"]","]":"[","{":"}","}":"{","\\{":"\\}","\\}":"\\{","&lang;":"&rang;","&rang;":"&lang;","\\langle ":"\\rangle ","\\rangle ":"\\langle ","|":"|","\\lVert ":"\\rVert ","\\rVert ":"\\lVert "};function bindCharBracketPair(open,ctrlSeq){ctrlSeq=ctrlSeq||open;var close=OPP_BRACKS[open],end=OPP_BRACKS[ctrlSeq];CharCmds[open]=bind(Bracket,L,open,close,ctrlSeq,end),CharCmds[close]=bind(Bracket,1,open,close,ctrlSeq,end)}bindCharBracketPair("("),bindCharBracketPair("["),bindCharBracketPair("{","\\{"),LatexCmds.langle=bind(Bracket,L,"&lang;","&rang;","\\langle ","\\rangle "),LatexCmds.rangle=bind(Bracket,1,"&lang;","&rang;","\\langle ","\\rangle "),CharCmds["|"]=bind(Bracket,L,"|","|","|","|"),LatexCmds.lVert=bind(Bracket,L,"&#8741;","&#8741;","\\lVert ","\\rVert "),LatexCmds.rVert=bind(Bracket,1,"&#8741;","&#8741;","\\lVert ","\\rVert "),LatexCmds.left=P(MathCommand,(function(_){_.parser=function(){var regex=Parser.regex,string=Parser.string,optWhitespace=(Parser.succeed,Parser.optWhitespace);return optWhitespace.then(regex(/^(?:[([|]|\\\{|\\langle(?![a-zA-Z])|\\lVert(?![a-zA-Z]))/)).then((function(ctrlSeq){var open="\\"===ctrlSeq.charAt(0)?ctrlSeq.slice(1):ctrlSeq;return"\\langle"==ctrlSeq&&(open="&lang;",ctrlSeq+=" "),"\\lVert"==ctrlSeq&&(open="&#8741;",ctrlSeq+=" "),latexMathParser.then((function(block){return string("\\right").skip(optWhitespace).then(regex(/^(?:[\])|]|\\\}|\\rangle(?![a-zA-Z])|\\rVert(?![a-zA-Z]))/)).map((function(end){var close="\\"===end.charAt(0)?end.slice(1):end;"\\rangle"==end&&(close="&rang;",end+=" "),"\\rVert"==end&&(close="&#8741;",end+=" ");var cmd=Bracket(0,open,close,ctrlSeq,end);return cmd.blocks=[block],block.adopt(cmd,0,0),cmd}))}))}))}})),LatexCmds.right=P(MathCommand,(function(_){_.parser=function(){return Parser.fail("unmatched \\right")}}));var Binomial=LatexCmds.binom=LatexCmds.binomial=P(P(MathCommand,DelimsMixin),(function(_,super_){_.ctrlSeq="\\binom",_.htmlTemplate='<span class="mq-non-leaf"><span class="mq-paren mq-scaled">(</span><span class="mq-non-leaf"><span class="mq-array mq-non-leaf"><span>&0</span><span>&1</span></span></span><span class="mq-paren mq-scaled">)</span></span>',_.textTemplate=["choose(",",",")"]}));LatexCmds.choose=P(Binomial,(function(_){_.createLeftOf=LiveFraction.prototype.createLeftOf}));LatexCmds.editable=LatexCmds.MathQuillMathField=P(MathCommand,(function(_,super_){_.ctrlSeq="\\MathQuillMathField",_.htmlTemplate='<span class="mq-editable-field"><span class="mq-root-block">&0</span></span>',_.parser=function(){var self=this,string=Parser.string,regex=Parser.regex,succeed=Parser.succeed;return string("[").then(regex(/^[a-z][a-z0-9]*/i)).skip(string("]")).map((function(name){self.name=name})).or(succeed()).then(super_.parser.call(self))},_.finalizeTree=function(options){var ctrlr=Controller(this.ends[L],this.jQ,options);ctrlr.KIND_OF_MQ="MathField",ctrlr.editable=!0,ctrlr.createTextarea(),ctrlr.editablesTextareaEvents(),ctrlr.cursor.insAtRightEnd(ctrlr.root),RootBlockMixin(ctrlr.root)},_.registerInnerField=function(innerFields,MathField){innerFields.push(innerFields[this.name]=MathField(this.ends[L].controller))},_.latex=function(){return this.ends[L].latex()},_.text=function(){return this.ends[L].text()}}));var Embed=LatexCmds.embed=P(Symbol,(function(_,super_){_.setOptions=function(options){function noop(){return""}return this.text=options.text||noop,this.htmlTemplate=options.htmlString||"",this.latex=options.latex||noop,this},_.parser=function(){var self=this,string=Parser.string,regex=Parser.regex,succeed=Parser.succeed;return string("{").then(regex(/^[a-z][a-z0-9]*/i)).skip(string("}")).then((function(name){return string("[").then(regex(/^[-\w\s]*/)).skip(string("]")).or(succeed()).map((function(data){return self.setOptions(EMBEDS[name](data))}))}))}}));LatexCmds.notin=LatexCmds.cong=LatexCmds.equiv=LatexCmds.oplus=LatexCmds.otimes=P(BinaryOperator,(function(_,super_){_.init=function(latex){super_.init.call(this,"\\"+latex+" ","&"+latex+";")}})),LatexCmds["≠"]=LatexCmds.ne=LatexCmds.neq=bind(BinaryOperator,"\\ne ","&ne;"),LatexCmds["∗"]=LatexCmds.ast=LatexCmds.star=LatexCmds.loast=LatexCmds.lowast=bind(BinaryOperator,"\\ast ","&lowast;"),LatexCmds.therefor=LatexCmds.therefore=bind(BinaryOperator,"\\therefore ","&there4;"),LatexCmds.cuz=LatexCmds.because=bind(BinaryOperator,"\\because ","&#8757;"),LatexCmds.prop=LatexCmds.propto=bind(BinaryOperator,"\\propto ","&prop;"),LatexCmds["≈"]=LatexCmds.asymp=LatexCmds.approx=bind(BinaryOperator,"\\approx ","&asymp;"),LatexCmds.isin=LatexCmds.in=bind(BinaryOperator,"\\in ","&isin;"),LatexCmds.ni=LatexCmds.contains=bind(BinaryOperator,"\\ni ","&ni;"),LatexCmds.notni=LatexCmds.niton=LatexCmds.notcontains=LatexCmds.doesnotcontain=bind(BinaryOperator,"\\not\\ni ","&#8716;"),LatexCmds.sub=LatexCmds.subset=bind(BinaryOperator,"\\subset ","&sub;"),LatexCmds.sup=LatexCmds.supset=LatexCmds.superset=bind(BinaryOperator,"\\supset ","&sup;"),LatexCmds.nsub=LatexCmds.notsub=LatexCmds.nsubset=LatexCmds.notsubset=bind(BinaryOperator,"\\not\\subset ","&#8836;"),LatexCmds.nsup=LatexCmds.notsup=LatexCmds.nsupset=LatexCmds.notsupset=LatexCmds.nsuperset=LatexCmds.notsuperset=bind(BinaryOperator,"\\not\\supset ","&#8837;"),LatexCmds.sube=LatexCmds.subeq=LatexCmds.subsete=LatexCmds.subseteq=bind(BinaryOperator,"\\subseteq ","&sube;"),LatexCmds.supe=LatexCmds.supeq=LatexCmds.supsete=LatexCmds.supseteq=LatexCmds.supersete=LatexCmds.superseteq=bind(BinaryOperator,"\\supseteq ","&supe;"),LatexCmds.nsube=LatexCmds.nsubeq=LatexCmds.notsube=LatexCmds.notsubeq=LatexCmds.nsubsete=LatexCmds.nsubseteq=LatexCmds.notsubsete=LatexCmds.notsubseteq=bind(BinaryOperator,"\\not\\subseteq ","&#8840;"),LatexCmds.nsupe=LatexCmds.nsupeq=LatexCmds.notsupe=LatexCmds.notsupeq=LatexCmds.nsupsete=LatexCmds.nsupseteq=LatexCmds.notsupsete=LatexCmds.notsupseteq=LatexCmds.nsupersete=LatexCmds.nsuperseteq=LatexCmds.notsupersete=LatexCmds.notsuperseteq=bind(BinaryOperator,"\\not\\supseteq ","&#8841;"),LatexCmds.mathbb=P(MathCommand,(function(_){_.createLeftOf=noop,_.numBlocks=function(){return 1},_.parser=function(){var string=Parser.string,regex=Parser.regex,optWhitespace=Parser.optWhitespace;return optWhitespace.then(string("{")).then(optWhitespace).then(regex(/^[NPZQRCH]/)).skip(optWhitespace).skip(string("}")).map((function(c){return LatexCmds[c]()}))}})),LatexCmds.N=LatexCmds.naturals=LatexCmds.Naturals=bind(VanillaSymbol,"\\mathbb{N}","&#8469;"),LatexCmds.P=LatexCmds.primes=LatexCmds.Primes=LatexCmds.projective=LatexCmds.Projective=LatexCmds.probability=LatexCmds.Probability=bind(VanillaSymbol,"\\mathbb{P}","&#8473;"),LatexCmds.Z=LatexCmds.integers=LatexCmds.Integers=bind(VanillaSymbol,"\\mathbb{Z}","&#8484;"),LatexCmds.Q=LatexCmds.rationals=LatexCmds.Rationals=bind(VanillaSymbol,"\\mathbb{Q}","&#8474;"),LatexCmds.R=LatexCmds.reals=LatexCmds.Reals=bind(VanillaSymbol,"\\mathbb{R}","&#8477;"),LatexCmds.C=LatexCmds.complex=LatexCmds.Complex=LatexCmds.complexes=LatexCmds.Complexes=LatexCmds.complexplane=LatexCmds.Complexplane=LatexCmds.ComplexPlane=bind(VanillaSymbol,"\\mathbb{C}","&#8450;"),LatexCmds.H=LatexCmds.Hamiltonian=LatexCmds.quaternions=LatexCmds.Quaternions=bind(VanillaSymbol,"\\mathbb{H}","&#8461;"),LatexCmds.quad=LatexCmds.emsp=bind(VanillaSymbol,"\\quad ","    "),LatexCmds.qquad=bind(VanillaSymbol,"\\qquad ","        "),LatexCmds.diamond=bind(VanillaSymbol,"\\diamond ","&#9671;"),LatexCmds.bigtriangleup=bind(VanillaSymbol,"\\bigtriangleup ","&#9651;"),LatexCmds.ominus=bind(VanillaSymbol,"\\ominus ","&#8854;"),LatexCmds.uplus=bind(VanillaSymbol,"\\uplus ","&#8846;"),LatexCmds.bigtriangledown=bind(VanillaSymbol,"\\bigtriangledown ","&#9661;"),LatexCmds.sqcap=bind(VanillaSymbol,"\\sqcap ","&#8851;"),LatexCmds.triangleleft=bind(VanillaSymbol,"\\triangleleft ","&#8882;"),LatexCmds.sqcup=bind(VanillaSymbol,"\\sqcup ","&#8852;"),LatexCmds.triangleright=bind(VanillaSymbol,"\\triangleright ","&#8883;"),LatexCmds.odot=LatexCmds.circledot=bind(VanillaSymbol,"\\odot ","&#8857;"),LatexCmds.bigcirc=bind(VanillaSymbol,"\\bigcirc ","&#9711;"),LatexCmds.dagger=bind(VanillaSymbol,"\\dagger ","&#0134;"),LatexCmds.ddagger=bind(VanillaSymbol,"\\ddagger ","&#135;"),LatexCmds.wr=bind(VanillaSymbol,"\\wr ","&#8768;"),LatexCmds.amalg=bind(VanillaSymbol,"\\amalg ","&#8720;"),LatexCmds.models=bind(VanillaSymbol,"\\models ","&#8872;"),LatexCmds.prec=bind(VanillaSymbol,"\\prec ","&#8826;"),LatexCmds.succ=bind(VanillaSymbol,"\\succ ","&#8827;"),LatexCmds.preceq=bind(VanillaSymbol,"\\preceq ","&#8828;"),LatexCmds.succeq=bind(VanillaSymbol,"\\succeq ","&#8829;"),LatexCmds.simeq=bind(VanillaSymbol,"\\simeq ","&#8771;"),LatexCmds.mid=bind(VanillaSymbol,"\\mid ","&#8739;"),LatexCmds.ll=bind(VanillaSymbol,"\\ll ","&#8810;"),LatexCmds.gg=bind(VanillaSymbol,"\\gg ","&#8811;"),LatexCmds.parallel=bind(VanillaSymbol,"\\parallel ","&#8741;"),LatexCmds.nparallel=bind(VanillaSymbol,"\\nparallel ","&#8742;"),LatexCmds.bowtie=bind(VanillaSymbol,"\\bowtie ","&#8904;"),LatexCmds.sqsubset=bind(VanillaSymbol,"\\sqsubset ","&#8847;"),LatexCmds.sqsupset=bind(VanillaSymbol,"\\sqsupset ","&#8848;"),LatexCmds.smile=bind(VanillaSymbol,"\\smile ","&#8995;"),LatexCmds.sqsubseteq=bind(VanillaSymbol,"\\sqsubseteq ","&#8849;"),LatexCmds.sqsupseteq=bind(VanillaSymbol,"\\sqsupseteq ","&#8850;"),LatexCmds.doteq=bind(VanillaSymbol,"\\doteq ","&#8784;"),LatexCmds.frown=bind(VanillaSymbol,"\\frown ","&#8994;"),LatexCmds.vdash=bind(VanillaSymbol,"\\vdash ","&#8870;"),LatexCmds.dashv=bind(VanillaSymbol,"\\dashv ","&#8867;"),LatexCmds.nless=bind(VanillaSymbol,"\\nless ","&#8814;"),LatexCmds.ngtr=bind(VanillaSymbol,"\\ngtr ","&#8815;"),LatexCmds.longleftarrow=bind(VanillaSymbol,"\\longleftarrow ","&#8592;"),LatexCmds.longrightarrow=bind(VanillaSymbol,"\\longrightarrow ","&#8594;"),LatexCmds.Longleftarrow=bind(VanillaSymbol,"\\Longleftarrow ","&#8656;"),LatexCmds.Longrightarrow=bind(VanillaSymbol,"\\Longrightarrow ","&#8658;"),LatexCmds.longleftrightarrow=bind(VanillaSymbol,"\\longleftrightarrow ","&#8596;"),LatexCmds.updownarrow=bind(VanillaSymbol,"\\updownarrow ","&#8597;"),LatexCmds.Longleftrightarrow=bind(VanillaSymbol,"\\Longleftrightarrow ","&#8660;"),LatexCmds.Updownarrow=bind(VanillaSymbol,"\\Updownarrow ","&#8661;"),LatexCmds.mapsto=bind(VanillaSymbol,"\\mapsto ","&#8614;"),LatexCmds.nearrow=bind(VanillaSymbol,"\\nearrow ","&#8599;"),LatexCmds.hookleftarrow=bind(VanillaSymbol,"\\hookleftarrow ","&#8617;"),LatexCmds.hookrightarrow=bind(VanillaSymbol,"\\hookrightarrow ","&#8618;"),LatexCmds.searrow=bind(VanillaSymbol,"\\searrow ","&#8600;"),LatexCmds.leftharpoonup=bind(VanillaSymbol,"\\leftharpoonup ","&#8636;"),LatexCmds.rightharpoonup=bind(VanillaSymbol,"\\rightharpoonup ","&#8640;"),LatexCmds.swarrow=bind(VanillaSymbol,"\\swarrow ","&#8601;"),LatexCmds.leftharpoondown=bind(VanillaSymbol,"\\leftharpoondown ","&#8637;"),LatexCmds.rightharpoondown=bind(VanillaSymbol,"\\rightharpoondown ","&#8641;"),LatexCmds.nwarrow=bind(VanillaSymbol,"\\nwarrow ","&#8598;"),LatexCmds.ldots=bind(VanillaSymbol,"\\ldots ","&#8230;"),LatexCmds.cdots=bind(VanillaSymbol,"\\cdots ","&#8943;"),LatexCmds.vdots=bind(VanillaSymbol,"\\vdots ","&#8942;"),LatexCmds.ddots=bind(VanillaSymbol,"\\ddots ","&#8945;"),LatexCmds.surd=bind(VanillaSymbol,"\\surd ","&#8730;"),LatexCmds.triangle=bind(VanillaSymbol,"\\triangle ","&#9651;"),LatexCmds.ell=bind(VanillaSymbol,"\\ell ","&#8467;"),LatexCmds.top=bind(VanillaSymbol,"\\top ","&#8868;"),LatexCmds.flat=bind(VanillaSymbol,"\\flat ","&#9837;"),LatexCmds.natural=bind(VanillaSymbol,"\\natural ","&#9838;"),LatexCmds.sharp=bind(VanillaSymbol,"\\sharp ","&#9839;"),LatexCmds.wp=bind(VanillaSymbol,"\\wp ","&#8472;"),LatexCmds.bot=bind(VanillaSymbol,"\\bot ","&#8869;"),LatexCmds.clubsuit=bind(VanillaSymbol,"\\clubsuit ","&#9827;"),LatexCmds.diamondsuit=bind(VanillaSymbol,"\\diamondsuit ","&#9826;"),LatexCmds.heartsuit=bind(VanillaSymbol,"\\heartsuit ","&#9825;"),LatexCmds.spadesuit=bind(VanillaSymbol,"\\spadesuit ","&#9824;"),LatexCmds.parallelogram=bind(VanillaSymbol,"\\parallelogram ","&#9649;"),LatexCmds.square=bind(VanillaSymbol,"\\square ","&#11036;"),LatexCmds.oint=bind(VanillaSymbol,"\\oint ","&#8750;"),LatexCmds.bigcap=bind(VanillaSymbol,"\\bigcap ","&#8745;"),LatexCmds.bigcup=bind(VanillaSymbol,"\\bigcup ","&#8746;"),LatexCmds.bigsqcup=bind(VanillaSymbol,"\\bigsqcup ","&#8852;"),LatexCmds.bigvee=bind(VanillaSymbol,"\\bigvee ","&#8744;"),LatexCmds.bigwedge=bind(VanillaSymbol,"\\bigwedge ","&#8743;"),LatexCmds.bigodot=bind(VanillaSymbol,"\\bigodot ","&#8857;"),LatexCmds.bigotimes=bind(VanillaSymbol,"\\bigotimes ","&#8855;"),LatexCmds.bigoplus=bind(VanillaSymbol,"\\bigoplus ","&#8853;"),LatexCmds.biguplus=bind(VanillaSymbol,"\\biguplus ","&#8846;"),LatexCmds.lfloor=bind(VanillaSymbol,"\\lfloor ","&#8970;"),LatexCmds.rfloor=bind(VanillaSymbol,"\\rfloor ","&#8971;"),LatexCmds.lceil=bind(VanillaSymbol,"\\lceil ","&#8968;"),LatexCmds.rceil=bind(VanillaSymbol,"\\rceil ","&#8969;"),LatexCmds.opencurlybrace=LatexCmds.lbrace=bind(VanillaSymbol,"\\lbrace ","{"),LatexCmds.closecurlybrace=LatexCmds.rbrace=bind(VanillaSymbol,"\\rbrace ","}"),LatexCmds.lbrack=bind(VanillaSymbol,"["),LatexCmds.rbrack=bind(VanillaSymbol,"]"),LatexCmds.slash=bind(VanillaSymbol,"/"),LatexCmds.vert=bind(VanillaSymbol,"|"),LatexCmds.perp=LatexCmds.perpendicular=bind(VanillaSymbol,"\\perp ","&perp;"),LatexCmds.nabla=LatexCmds.del=bind(VanillaSymbol,"\\nabla ","&nabla;"),LatexCmds.hbar=bind(VanillaSymbol,"\\hbar ","&#8463;"),LatexCmds.AA=LatexCmds.Angstrom=LatexCmds.angstrom=bind(VanillaSymbol,"\\text\\AA ","&#8491;"),LatexCmds.ring=LatexCmds.circ=LatexCmds.circle=bind(VanillaSymbol,"\\circ ","&#8728;"),LatexCmds.bull=LatexCmds.bullet=bind(VanillaSymbol,"\\bullet ","&bull;"),LatexCmds.setminus=LatexCmds.smallsetminus=bind(VanillaSymbol,"\\setminus ","&#8726;"),LatexCmds.not=LatexCmds["¬"]=LatexCmds.neg=bind(VanillaSymbol,"\\neg ","&not;"),LatexCmds["…"]=LatexCmds.dots=LatexCmds.ellip=LatexCmds.hellip=LatexCmds.ellipsis=LatexCmds.hellipsis=bind(VanillaSymbol,"\\dots ","&hellip;"),LatexCmds.converges=LatexCmds.darr=LatexCmds.dnarr=LatexCmds.dnarrow=LatexCmds.downarrow=bind(VanillaSymbol,"\\downarrow ","&darr;"),LatexCmds.dArr=LatexCmds.dnArr=LatexCmds.dnArrow=LatexCmds.Downarrow=bind(VanillaSymbol,"\\Downarrow ","&dArr;"),LatexCmds.diverges=LatexCmds.uarr=LatexCmds.uparrow=bind(VanillaSymbol,"\\uparrow ","&uarr;"),LatexCmds.uArr=LatexCmds.Uparrow=bind(VanillaSymbol,"\\Uparrow ","&uArr;"),LatexCmds.to=bind(BinaryOperator,"\\to ","&rarr;"),LatexCmds.rarr=LatexCmds.rightarrow=bind(VanillaSymbol,"\\rightarrow ","&rarr;"),LatexCmds.implies=bind(BinaryOperator,"\\Rightarrow ","&rArr;"),LatexCmds.rArr=LatexCmds.Rightarrow=bind(VanillaSymbol,"\\Rightarrow ","&rArr;"),LatexCmds.gets=bind(BinaryOperator,"\\gets ","&larr;"),LatexCmds.larr=LatexCmds.leftarrow=bind(VanillaSymbol,"\\leftarrow ","&larr;"),LatexCmds.impliedby=bind(BinaryOperator,"\\Leftarrow ","&lArr;"),LatexCmds.lArr=LatexCmds.Leftarrow=bind(VanillaSymbol,"\\Leftarrow ","&lArr;"),LatexCmds.harr=LatexCmds.lrarr=LatexCmds.leftrightarrow=bind(VanillaSymbol,"\\leftrightarrow ","&harr;"),LatexCmds.iff=bind(BinaryOperator,"\\Leftrightarrow ","&hArr;"),LatexCmds.hArr=LatexCmds.lrArr=LatexCmds.Leftrightarrow=bind(VanillaSymbol,"\\Leftrightarrow ","&hArr;"),LatexCmds.Re=LatexCmds.Real=LatexCmds.real=bind(VanillaSymbol,"\\Re ","&real;"),LatexCmds.Im=LatexCmds.imag=LatexCmds.image=LatexCmds.imagin=LatexCmds.imaginary=LatexCmds.Imaginary=bind(VanillaSymbol,"\\Im ","&image;"),LatexCmds.part=LatexCmds.partial=bind(VanillaSymbol,"\\partial ","&part;"),LatexCmds.infty=LatexCmds.infin=LatexCmds.infinity=bind(VanillaSymbol,"\\infty ","&infin;"),LatexCmds.pounds=bind(VanillaSymbol,"\\pounds ","&pound;"),LatexCmds.alef=LatexCmds.alefsym=LatexCmds.aleph=LatexCmds.alephsym=bind(VanillaSymbol,"\\aleph ","&alefsym;"),LatexCmds.xist=LatexCmds.xists=LatexCmds.exist=LatexCmds.exists=bind(VanillaSymbol,"\\exists ","&exist;"),LatexCmds.nexists=LatexCmds.nexist=bind(VanillaSymbol,"\\nexists ","&#8708;"),LatexCmds.and=LatexCmds.land=LatexCmds.wedge=bind(BinaryOperator,"\\wedge ","&and;"),LatexCmds.or=LatexCmds.lor=LatexCmds.vee=bind(BinaryOperator,"\\vee ","&or;"),LatexCmds.o=LatexCmds.O=LatexCmds.empty=LatexCmds.emptyset=LatexCmds.oslash=LatexCmds.Oslash=LatexCmds.nothing=LatexCmds.varnothing=bind(BinaryOperator,"\\varnothing ","&empty;"),LatexCmds.cup=LatexCmds.union=bind(BinaryOperator,"\\cup ","&cup;"),LatexCmds.cap=LatexCmds.intersect=LatexCmds.intersection=bind(BinaryOperator,"\\cap ","&cap;"),LatexCmds.deg=LatexCmds.degree=bind(VanillaSymbol,"\\degree ","&deg;"),LatexCmds.ang=LatexCmds.angle=bind(VanillaSymbol,"\\angle ","&ang;"),LatexCmds.measuredangle=bind(VanillaSymbol,"\\measuredangle ","&#8737;");var Digit=P(VanillaSymbol,(function(_,super_){_.createLeftOf=function(cursor){cursor.options.autoSubscriptNumerals&&cursor.parent!==cursor.parent.parent.sub&&(cursor[L]instanceof Variable&&!1!==cursor[L].isItalic||cursor[L]instanceof SupSub&&cursor[L][L]instanceof Variable&&!1!==cursor[L][L].isItalic)?(LatexCmds._().createLeftOf(cursor),super_.createLeftOf.call(this,cursor),cursor.insRightOf(cursor.parent.parent)):super_.createLeftOf.call(this,cursor)}})),Variable=P(Symbol,(function(_,super_){_.init=function(ch,html){super_.init.call(this,ch,"<var>"+(html||ch)+"</var>")},_.text=function(){var text=this.ctrlSeq;return this.isPartOfOperator?"\\"==text[0]?text=text.slice(1,text.length):" "==text[text.length-1]&&(text=text.slice(0,-1)):(!this[L]||this[L]instanceof Variable||this[L]instanceof BinaryOperator||"\\ "===this[L].ctrlSeq||(text="*"+text),!this[1]||this[1]instanceof BinaryOperator||this[1]instanceof SupSub||(text+="*")),text}}));Options.p.autoCommands={_maxLength:0},optionProcessors.autoCommands=function(cmds){if(!/^[a-z]+(?: [a-z]+)*$/i.test(cmds))throw'"'+cmds+'" not a space-delimited list of only letters';for(var list=cmds.split(" "),dict={},maxLength=0,i=0;i<list.length;i+=1){var cmd=list[i];if(cmd.length<2)throw'autocommand "'+cmd+'" not minimum length of 2';if(LatexCmds[cmd]===OperatorName)throw'"'+cmd+'" is a built-in operator name';dict[cmd]=1,maxLength=max(maxLength,cmd.length)}return dict._maxLength=maxLength,dict};var Letter=P(Variable,(function(_,super_){function shouldOmitPadding(node){return!node||node instanceof BinaryOperator||node instanceof SummationNotation}_.init=function(ch){return super_.init.call(this,this.letter=ch)},_.createLeftOf=function(cursor){super_.createLeftOf.apply(this,arguments);var autoCmds=cursor.options.autoCommands,maxLength=autoCmds._maxLength;if(maxLength>0){for(var str="",l=this,i=0;l instanceof Letter&&l.ctrlSeq===l.letter&&i<maxLength;)str=l.letter+str,l=l[L],i+=1;for(;str.length;){if(autoCmds.hasOwnProperty(str)){for(i=1,l=this;i<str.length;i+=1,l=l[L]);return Fragment(l,this).remove(),cursor[L]=l[L],LatexCmds[str](str).createLeftOf(cursor)}str=str.slice(1)}}},_.italicize=function(bool){return this.isItalic=bool,this.isPartOfOperator=!bool,this.jQ.toggleClass("mq-operator-name",!bool),this},_.finalizeTree=_.siblingDeleted=_.siblingCreated=function(opts,dir){dir!==L&&this[1]instanceof Letter||this.autoUnItalicize(opts)},_.autoUnItalicize=function(opts){var autoOps=opts.autoOperatorNames;if(0!==autoOps._maxLength){for(var str=this.letter,l=this[L];l instanceof Letter;l=l[L])str=l.letter+str;for(var r=this[1];r instanceof Letter;r=r[1])str+=r.letter;Fragment(l[1]||this.parent.ends[L],r[L]||this.parent.ends[1]).each((function(el){el.italicize(!0).jQ.removeClass("mq-first mq-last mq-followed-by-supsub"),el.ctrlSeq=el.letter}));outer:for(var i=0,first=l[1]||this.parent.ends[L];i<str.length;i+=1,first=first[1])for(var len=min(autoOps._maxLength,str.length-i);len>0;len-=1){var word=str.slice(i,i+len);if(autoOps.hasOwnProperty(word)){for(var j=0,letter=first;j<len;j+=1,letter=letter[1]){letter.italicize(!1);var last=letter}var isBuiltIn=BuiltInOpNames.hasOwnProperty(word);if(first.ctrlSeq=(isBuiltIn?"\\":"\\operatorname{")+first.ctrlSeq,last.ctrlSeq+=isBuiltIn?" ":"}",TwoWordOpNames.hasOwnProperty(word)&&last[L][L][L].jQ.addClass("mq-last"),shouldOmitPadding(first[L])||first.jQ.addClass("mq-first"),!shouldOmitPadding(last[1]))if(last[1]instanceof SupSub){var supsub=last[1];(supsub.siblingCreated=supsub.siblingDeleted=function(){supsub.jQ.toggleClass("mq-after-operator-name",!(supsub[1]instanceof Bracket))})()}else last.jQ.toggleClass("mq-last",!(last[1]instanceof Bracket));i+=len-1,first=last;continue outer}}}}})),BuiltInOpNames={},AutoOpNames=Options.p.autoOperatorNames={_maxLength:9},TwoWordOpNames={limsup:1,liminf:1,projlim:1,injlim:1};!function(){for(var mostOps="arg deg det dim exp gcd hom inf ker lg lim ln log max min sup limsup liminf injlim projlim Pr".split(" "),i=0;i<mostOps.length;i+=1)BuiltInOpNames[mostOps[i]]=AutoOpNames[mostOps[i]]=1;var builtInTrigs="sin cos tan arcsin arccos arctan sinh cosh tanh sec csc cot coth".split(" ");for(i=0;i<builtInTrigs.length;i+=1)BuiltInOpNames[builtInTrigs[i]]=1;var autoTrigs="sin cos tan sec cosec csc cotan cot ctg".split(" ");for(i=0;i<autoTrigs.length;i+=1)AutoOpNames[autoTrigs[i]]=AutoOpNames["arc"+autoTrigs[i]]=AutoOpNames[autoTrigs[i]+"h"]=AutoOpNames["ar"+autoTrigs[i]+"h"]=AutoOpNames["arc"+autoTrigs[i]+"h"]=1;var moreNonstandardOps="gcf hcf lcm proj span".split(" ");for(i=0;i<moreNonstandardOps.length;i+=1)AutoOpNames[moreNonstandardOps[i]]=1}(),optionProcessors.autoOperatorNames=function(cmds){if(!/^[a-z]+(?: [a-z]+)*$/i.test(cmds))throw'"'+cmds+'" not a space-delimited list of only letters';for(var list=cmds.split(" "),dict={},maxLength=0,i=0;i<list.length;i+=1){var cmd=list[i];if(cmd.length<2)throw'"'+cmd+'" not minimum length of 2';dict[cmd]=1,maxLength=max(maxLength,cmd.length)}return dict._maxLength=maxLength,dict};var OperatorName=P(Symbol,(function(_,super_){_.init=function(fn){this.ctrlSeq=fn},_.createLeftOf=function(cursor){for(var fn=this.ctrlSeq,i=0;i<fn.length;i+=1)Letter(fn.charAt(i)).createLeftOf(cursor)},_.parser=function(){for(var fn=this.ctrlSeq,block=MathBlock(),i=0;i<fn.length;i+=1)Letter(fn.charAt(i)).adopt(block,block.ends[1],0);return Parser.succeed(block.children())}}));for(var fn in AutoOpNames)AutoOpNames.hasOwnProperty(fn)&&(LatexCmds[fn]=OperatorName);LatexCmds.operatorname=P(MathCommand,(function(_){_.createLeftOf=noop,_.numBlocks=function(){return 1},_.parser=function(){return latexMathParser.block.map((function(b){return b.children()}))}})),LatexCmds.f=P(Letter,(function(_,super_){_.init=function(){Symbol.p.init.call(this,this.letter="f",'<var class="mq-f">f</var>')},_.italicize=function(bool){return this.jQ.html("f").toggleClass("mq-f",bool),super_.italicize.apply(this,arguments)}})),LatexCmds[" "]=LatexCmds.space=bind(VanillaSymbol,"\\ ","&nbsp;"),LatexCmds["'"]=LatexCmds.prime=bind(VanillaSymbol,"'","&prime;"),LatexCmds["″"]=LatexCmds.dprime=bind(VanillaSymbol,"″","&Prime;"),LatexCmds.backslash=bind(VanillaSymbol,"\\backslash ","\\"),CharCmds["\\"]||(CharCmds["\\"]=LatexCmds.backslash),LatexCmds.$=bind(VanillaSymbol,"\\$","$");var NonSymbolaSymbol=P(Symbol,(function(_,super_){_.init=function(ch,html){super_.init.call(this,ch,'<span class="mq-nonSymbola">'+(html||ch)+"</span>")}}));LatexCmds["@"]=NonSymbolaSymbol,LatexCmds["&"]=bind(NonSymbolaSymbol,"\\&","&amp;"),LatexCmds["%"]=bind(NonSymbolaSymbol,"\\%","%"),LatexCmds.alpha=LatexCmds.beta=LatexCmds.gamma=LatexCmds.delta=LatexCmds.zeta=LatexCmds.eta=LatexCmds.theta=LatexCmds.iota=LatexCmds.kappa=LatexCmds.mu=LatexCmds.nu=LatexCmds.xi=LatexCmds.rho=LatexCmds.sigma=LatexCmds.tau=LatexCmds.chi=LatexCmds.psi=LatexCmds.omega=P(Variable,(function(_,super_){_.init=function(latex){super_.init.call(this,"\\"+latex+" ","&"+latex+";")}})),LatexCmds.phi=bind(Variable,"\\phi ","&#981;"),LatexCmds.phiv=LatexCmds.varphi=bind(Variable,"\\varphi ","&phi;"),LatexCmds.epsilon=bind(Variable,"\\epsilon ","&#1013;"),LatexCmds.epsiv=LatexCmds.varepsilon=bind(Variable,"\\varepsilon ","&epsilon;"),LatexCmds.piv=LatexCmds.varpi=bind(Variable,"\\varpi ","&piv;"),LatexCmds.sigmaf=LatexCmds.sigmav=LatexCmds.varsigma=bind(Variable,"\\varsigma ","&sigmaf;"),LatexCmds.thetav=LatexCmds.vartheta=LatexCmds.thetasym=bind(Variable,"\\vartheta ","&thetasym;"),LatexCmds.upsilon=LatexCmds.upsi=bind(Variable,"\\upsilon ","&upsilon;"),LatexCmds.gammad=LatexCmds.Gammad=LatexCmds.digamma=bind(Variable,"\\digamma ","&#989;"),LatexCmds.kappav=LatexCmds.varkappa=bind(Variable,"\\varkappa ","&#1008;"),LatexCmds.rhov=LatexCmds.varrho=bind(Variable,"\\varrho ","&#1009;"),LatexCmds.pi=LatexCmds["π"]=bind(NonSymbolaSymbol,"\\pi ","&pi;"),LatexCmds.lambda=bind(NonSymbolaSymbol,"\\lambda ","&lambda;"),LatexCmds.Upsilon=LatexCmds.Upsi=LatexCmds.upsih=LatexCmds.Upsih=bind(Symbol,"\\Upsilon ",'<var style="font-family: serif">&upsih;</var>'),LatexCmds.Gamma=LatexCmds.Delta=LatexCmds.Theta=LatexCmds.Lambda=LatexCmds.Xi=LatexCmds.Pi=LatexCmds.Sigma=LatexCmds.Phi=LatexCmds.Psi=LatexCmds.Omega=LatexCmds.forall=P(VanillaSymbol,(function(_,super_){_.init=function(latex){super_.init.call(this,"\\"+latex+" ","&"+latex+";")}}));var LatexFragment=P(MathCommand,(function(_){_.init=function(latex){this.latex=latex},_.createLeftOf=function(cursor){var block=latexMathParser.parse(this.latex);block.children().adopt(cursor.parent,cursor[L],cursor[1]),cursor[L]=block.ends[1],block.jQize().insertBefore(cursor.jQ),block.finalizeInsert(cursor.options,cursor),block.ends[1][1].siblingCreated&&block.ends[1][1].siblingCreated(cursor.options,L),block.ends[L][L].siblingCreated&&block.ends[L][L].siblingCreated(cursor.options,1),cursor.parent.bubble("reflow")},_.parser=function(){var frag=latexMathParser.parse(this.latex).children();return Parser.succeed(frag)}}));LatexCmds["¹"]=bind(LatexFragment,"^1"),LatexCmds["²"]=bind(LatexFragment,"^2"),LatexCmds["³"]=bind(LatexFragment,"^3"),LatexCmds["¼"]=bind(LatexFragment,"\\frac14"),LatexCmds["½"]=bind(LatexFragment,"\\frac12"),LatexCmds["¾"]=bind(LatexFragment,"\\frac34");var PlusMinus=P(BinaryOperator,(function(_){_.init=VanillaSymbol.prototype.init,_.contactWeld=_.siblingCreated=_.siblingDeleted=function(opts,dir){if(1!==dir)return this.jQ[0].className=function determineOpClassType(node){return node[L]?node[L]instanceof BinaryOperator||/^[,;:\(\[]$/.test(node[L].ctrlSeq)?"":"mq-binary-operator":node.parent&&node.parent.parent&&node.parent.parent.isStyleBlock()?determineOpClassType(node.parent.parent):""}(this),this}}));LatexCmds["+"]=bind(PlusMinus,"+","+"),LatexCmds["–"]=LatexCmds["-"]=bind(PlusMinus,"-","&minus;"),LatexCmds["±"]=LatexCmds.pm=LatexCmds.plusmn=LatexCmds.plusminus=bind(PlusMinus,"\\pm ","&plusmn;"),LatexCmds.mp=LatexCmds.mnplus=LatexCmds.minusplus=bind(PlusMinus,"\\mp ","&#8723;"),CharCmds["*"]=LatexCmds.sdot=LatexCmds.cdot=bind(BinaryOperator,"\\cdot ","&middot;","*");var Inequality=P(BinaryOperator,(function(_,super_){_.init=function(data,strict){this.data=data,this.strict=strict;var strictness=strict?"Strict":"";super_.init.call(this,data["ctrlSeq"+strictness],data["html"+strictness],data["text"+strictness])},_.swap=function(strict){this.strict=strict;var strictness=strict?"Strict":"";this.ctrlSeq=this.data["ctrlSeq"+strictness],this.jQ.html(this.data["html"+strictness]),this.textTemplate=[this.data["text"+strictness]]},_.deleteTowards=function(dir,cursor){if(dir===L&&!this.strict)return this.swap(!0),void this.bubble("reflow");super_.deleteTowards.apply(this,arguments)}})),less={ctrlSeq:"\\le ",html:"&le;",text:"≤",ctrlSeqStrict:"<",htmlStrict:"&lt;",textStrict:"<"},greater={ctrlSeq:"\\ge ",html:"&ge;",text:"≥",ctrlSeqStrict:">",htmlStrict:"&gt;",textStrict:">"};LatexCmds["<"]=LatexCmds.lt=bind(Inequality,less,!0),LatexCmds[">"]=LatexCmds.gt=bind(Inequality,greater,!0),LatexCmds["≤"]=LatexCmds.le=LatexCmds.leq=bind(Inequality,less,!1),LatexCmds["≥"]=LatexCmds.ge=LatexCmds.geq=bind(Inequality,greater,!1);var Equality=P(BinaryOperator,(function(_,super_){_.init=function(){super_.init.call(this,"=","=")},_.createLeftOf=function(cursor){if(cursor[L]instanceof Inequality&&cursor[L].strict)return cursor[L].swap(!1),void cursor[L].bubble("reflow");super_.createLeftOf.apply(this,arguments)}}));LatexCmds["="]=Equality,LatexCmds["×"]=LatexCmds.times=bind(BinaryOperator,"\\times ","&times;","[x]"),LatexCmds["÷"]=LatexCmds.div=LatexCmds.divide=LatexCmds.divides=bind(BinaryOperator,"\\div ","&divide;","[/]"),CharCmds["~"]=LatexCmds.sim=bind(BinaryOperator,"\\sim ","~","~");var MQ1=getInterface(1);for(var key in MQ1)!function(key,val){"function"==typeof val?(MathQuill[key]=function(){return insistOnInterVer(),val.apply(this,arguments)},MathQuill[key].prototype=val.prototype):MathQuill[key]=val}(key,MQ1[key])}();var _default=MathQuill;return _exports.default=_default,_exports.default}));

//# sourceMappingURL=mathquill.min.js.map