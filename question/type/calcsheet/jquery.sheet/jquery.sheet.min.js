jQuery.fn.extend({sheet:function(a){return a=a||{},jQuery(this).each(function(){var e=jQuery(this),t={editable:!0,editableNames:!0,barMenus:!0,freezableCells:!0,allowToggleState:!0,menuLeft:null,newColumnWidth:120,title:null,menuRight:null,calcOff:!1,log:!1,lockFormulas:!1,parent:e,colMargin:18,boxModelCorrection:2,formulaFunctions:{},formulaVariables:{},cellSelectModel:"excel",autoAddCells:!0,resizableCells:!0,resizableSheet:!0,autoFiller:!0,minSize:{rows:1,cols:1},alertFormulaErrors:!1,error:function(e){return e.error},encode:function(e){switch(typeof e){case"object":return e;case"number":return Globalize.format(e).replace(/[\.,]00$/,"")}if(!e)return e||"";if(!e.replace)return e||"";var t=+$.trim(e);return isNaN(t)?e.replace(/&/gi,"&amp;").replace(/>/gi,"&gt;").replace(/</gi,"&lt;").replace(/\n/g,"\n<br>").replace(/\t/g,"&nbsp;&nbsp;&nbsp ").replace(/  /g,"&nbsp; "):Globalize.format(t).replace(/[\.,]00$/,"")},frozenAt:[],contextmenuTop:{"Toggle freeze columns to here":function(e){var t=e.getTdLocation(e.obj.cellActive()).col;e.frozenAt().col=e.frozenAt().col==t?0:t},"Insert column after":function(e){return e.controlFactory.addColumn(e.colLast),!1},"Insert column before":function(e){return e.controlFactory.addColumn(e.colLast,!0),!1},"Add column to end":function(e){return e.controlFactory.addColumn(),!1},"Delete this column":function(e){return e.deleteColumn(),!1},"Hide column":function(e){return e.toggleHide.column(),!1}},contextmenuLeft:{"Toggle freeze rows to here":function(e){var t=e.getTdLocation(e.obj.cellActive()).row;e.frozenAt().row=e.frozenAt().row==t?0:t},"Insert row after":function(e){return e.controlFactory.addRow(e.rowLast),!1},"Insert row before":function(e){return e.controlFactory.addRow(e.rowLast,!0),!1},"Add row to end":function(e){return e.controlFactory.addRow(),!1},"Delete this row":function(e){return e.deleteRow(),!1},"Hide row":function(e){return e.toggleHide.row(),!1}},contextmenuCell:{Copy:!1,Cut:!1,"Insert column after":function(e){return e.controlFactory.addColumn(e.colLast),!1},"Insert column before":function(e){return e.controlFactory.addColumn(e.colLast,!0),!1},"Add column to end":function(e){return e.controlFactory.addColumn(),!1},"Delete this column":function(e){return e.deleteColumn(),!1},line1:"line","Insert row after":function(e){return e.controlFactory.addRow(),!1},"Insert row before":function(e){return e.controlFactory.addRow(e.rowLast,!0),!1},"Add row to end":function(e){return e.controlFactory.addRow(),!1},"Delete this row":function(e){return e.deleteRow(),!1},line2:"line","Add spreadsheet":function(e){e.addSheet("5x10")},"Delete spreadsheet":function(e){e.deleteSheet()}},hiddenRows:[],hiddenColumns:[],cellStartingHandlers:{$:function(e,t){this.formula="",this.value=e,this.valueOverride=jFN.DOLLAR.apply(this,[e.substring(1).replace(n.s.numberGroupingChar,""),2,t||"$"]).value,this.td.removeData("formula").html(e)},"£":function(e){n.s.cellStartingHandlers.$.apply(this,[e,"£"])}},radixPointChar:".",numberGroupingChar:","},r=jQuery.sheet.events,n=e.getSheet();if(n){var o=e.children().detach();for(var l in n.kill(),e.html(o),r)a[r[l]]&&e.unbind(r[l])}for(var l in r)a[r[l]]&&e.bind(r[l],a[r[l]]);jQuery.sheet.instance.length||(jQuery.sheet.instance=$([])),n=jQuery.sheet.createInstance(jQuery,jQuery.extend(t,a),jQuery.sheet.instance.length),jQuery.sheet.instance=jQuery.sheet.instance.add(n)}),this},disableSelectionSpecial:function(){return this.each(function(){this.onselectstart=function(){return!1},this.unselectable="on",jQuery(this).css("-moz-user-select","none")}),this},getSheet:function(){return jQuery(this).data("sheetInstance")},getCellValue:function(e,t,r){var n=jQuery(this).getSheet();r=r||0;try{return n.updateCellValue(r,e,t)}catch(e){return""}},setCellValue:function(e,t,r,n){var o=jQuery(this).getSheet();n=n||0;try{return o.spreadsheets[n][t][r].value=e,o.updateCellValue(n,t,r)}catch(e){}},setCellFormula:function(e,t,r,n){var o=jQuery(this).getSheet();n=n||0;try{return o.spreadsheets[n][t][r].formula=e,o.updateCellValue(n,t,r)}catch(e){}},setCellHtml:function(e,t,r,n){var o=jQuery(this).getSheet();n=n||0;try{return o.spreadsheets[n][t][r].html=[e],o.updateCellValue(n,t,r)}catch(e){}},isSheetFullScreen:function(){return!!$(this).getSheet().obj.fullScreen().is(":visible")},serializeCellInputs:function(e){var t=$(this).getSheet().obj.sheets().find(":input");return e?t.serializeArray():t.serialize()}}),jQuery.sheet={instance:[],dependencies:{coreCss:{css:"jquery.sheet.css"},globalize:{script:"plugins/globalize.js"},formulaParser:{script:"parser/formula/formula.js"},tsvParser:{script:"parser/tsv/tsv.js"},mousewheel:{script:"plugins/jquery.mousewheel.min.js"},nearest:{script:"plugins/jquery.nearest.min.js"}},optional:{globalizeCultures:{script:"plugins/globalize.cultures.js"},raphael:{script:"plugins/raphael-min.js"},gRaphael:{script:"plugins/g.raphael-min.js"},colorPicker:{script:"plugins/jquery.colorPicker.min.js"},elastic:{script:"plugins/jquery.elastic.min.js"},advancedfn:{script:"plugins/jquery.sheet.advancedfn.js"},financefn:{script:"plugins/jquery.sheet.financefn.js"},dts:{script:"plugins/jquery.sheet.dts.js"},zeroclipboard:{script:"plugins/ZeroClipboard.js"}},events:["sheetAddRow","sheetAddColumn","sheetSwitch","sheetRename","sheetTabSortStart","sheetTabSortUpdate","sheetCellEdit","sheetCellEdited","sheetCalculation","sheetAdd","sheetDelete","sheetDeleteRow","sheetDeleteColumn","sheetOpen","sheetAllOpened","sheetSave","sheetFullScreen","sheetFormulaKeydown"],preLoad:function(e,t){e=e||"",t=$.extend({skip:["globalizeCultures"]},t);function r(){this.script?document.write('<script src="'+e+this.script+'"><\/script>'):this.css&&document.write('<link rel="stylesheet" type="text/css" href="'+e+this.css+'"></link>')}for(var n in t.skip)this.dependencies[t.skip[n]]&&(this.dependencies[t.skip[n]]=null),this.optional[t.skip[n]]&&(this.optional[t.skip[n]]=null);$.each(this.dependencies,function(){r.apply(this)}),$.each(this.optional,function(){r.apply(this)})},repeat:function(e,t){for(var r="";0<t;)1&t&&(r+=e),t>>=1,e+=e;return r},nthCss:function(e,t,r,n,o,l){var a=[];if(l=l||"{display: none;}",r.styleSheet){for(var i in n)n[i]>o&&a.push(t+" "+e+":first-child"+jQuery.sheet.repeat("+"+e,n[i]-1));if(a.length)return a.join(",")+l}else{for(var i in n)n[i]>o&&a.push(t+" "+e+":nth-child("+n[i]+")");if(a.length)return a.join(",")+l}return""},createInstance:function(E,v,s){var x={version:"3.0",i:0,I:s,sheetCount:0,scrolledArea:[],spreadsheets:[],controls:{autoFiller:[],bar:{helper:[],corner:[],x:{controls:[],handleFreeze:[],menu:[],menuParent:[],parent:[],scroll:[],td:[],tds:function(){var e=E([]);for(var t in this.td[x.i])e=e.add(this.td[x.i][t]);return e}},y:{controls:[],handleFreeze:[],menu:[],parent:[],scroll:[],td:[],tds:function(){var e=E([]);for(var t in this.td[x.i])e=e.add(this.td[x.i][t]);return e}}},barMenuLeft:[],barMenuTop:[],barLeft:[],barTop:[],barTopParent:[],chart:[],cellMenu:[],enclosure:[],enclosures:null,formula:null,fullScreen:[],header:null,inPlaceEdit:[],label:null,menuLeft:[],menuRight:[],pane:[],panes:null,scroll:[],scrolls:null,sheet:[],sheets:null,tab:[],tabContainer:null,tabs:null,title:null,toggleHide:{x:[],y:[]},ui:null},obj:{autoFiller:function(){return x.controls.autoFiller[x.i]||E([])},barCorner:function(){return x.controls.bar.corner[x.i]||E([])},barHelper:function(){return x.controls.bar.helper[x.i]||(x.controls.bar.helper[x.i]=E([]))},barLeft:function(e){return x.controls.bar.y.td[x.i]&&x.controls.bar.y.td[x.i][e]?x.controls.bar.y.td[x.i][e]:E([])},barLeftControls:function(){return x.controls.bar.y.controls[x.i]||E([])},barLefts:function(){return x.controls.bar.y.tds()},barHandleFreezeLeft:function(){return x.controls.bar.y.handleFreeze[x.i]||E([])},barMenuLeft:function(){return x.controls.bar.y.menu[x.i]||E([])},barTop:function(e){return x.controls.bar.x.td[x.i]&&x.controls.bar.x.td[x.i][e]?x.controls.bar.x.td[x.i][e]:E([])},barTopControls:function(){return x.controls.bar.x.controls[x.i]||E([])},barTops:function(){return x.controls.bar.x.tds()},barTopParent:function(){return x.controls.bar.x.parent[x.i]||E([])},barHandleFreezeTop:function(){return x.controls.bar.x.handleFreeze[x.i]||E([])},barMenuParentTop:function(){return x.controls.bar.x.menuParent[x.i]||E([])},barMenuTop:function(){return x.controls.bar.x.menu[x.i]||E([])},cellActive:function(){return x.cellLast.td||E([])},cellMenu:function(){return x.controls.cellMenu[x.i]||E([])},cellHighlighted:function(){return x.highlightedLast.td||E([])},chart:function(){return x.controls.chart[x.i]||E([])},enclosure:function(){return x.controls.enclosure[x.i]||E([])},enclosures:function(){return x.controls.enclosures||E([])},formula:function(){return x.controls.formula||E([])},fullScreen:function(){return x.controls.fullScreen[x.i]||E([])},header:function(){return x.controls.header||E([])},menuRight:function(){return x.controls.menuRight[x.i]||E([])},inPlaceEdit:function(){return x.controls.inPlaceEdit[x.i]||E([])},label:function(){return x.controls.label||E([])},menuLeft:function(){return x.controls.menuLeft[x.i]||E([])},pane:function(){return x.controls.pane[x.i]||E([])},panes:function(){return x.controls.panes||E([])},parent:function(){return v.parent},scrollStyleX:function(){return x.controls.bar.x.scroll[x.i]||E([])},scrollStyleY:function(){return x.controls.bar.y.scroll[x.i]||E([])},scroll:function(){return x.controls.scroll[x.i]||E([])},scrolls:function(){return x.controls.scrolls||E([])},sheet:function(){return x.controls.sheet[x.i]||E([])},sheets:function(){return x.controls.sheets||E([])},tab:function(){return x.controls.tab[x.i]||E([])},tabs:function(){return x.controls.tabs||E([])},tabContainer:function(){return x.controls.tabContainer||E([])},toggleHideStyleX:function(){return x.controls.toggleHide.x[x.i]||E([])},toggleHideStyleY:function(){return x.controls.toggleHide.y[x.i]||E([])},title:function(){return x.controls.title||E([])},ui:function(){return x.controls.ui||E([])}},id:{sheet:"jS_"+s+"_"},cl:{autoFiller:"jSAutoFiller",autoFillerHandle:"jSAutoFillerHandle",autoFillerCover:"jSAutoFillerCover",barCorner:"jSBarCorner",barController:"jSBarController",barHelper:"jSBarHelper",barLeft:"jSBarLeft",barHandleFreezeLeft:"jSBarHandleFreezeLeft",barTop:"jSBarTop",barHandleFreezeTop:"jSBarHandleFreezeTop",barTopParent:"jSBarTopParent",chart:"jSChart",formula:"jSFormula",formulaParent:"jSFormulaParent",header:"jSHeader",fullScreen:"jSFullScreen",inPlaceEdit:"jSInPlaceEdit",menu:"jSMenu",menuFixed:"jSMenuFixed",parent:"jSParent",scroll:"jSScroll",sheet:"jS",label:"jSLoc",pane:"jSEditPane",tab:"jSTab",tabContainer:"jSTabContainer",title:"jSTitle",enclosure:"jSEnclosure",ui:"jSUI",uiAutoFiller:"ui-state-active",uiBar:"ui-widget-header",uiBarHighlight:"ui-state-active",uiBarHandleFreezeLeft:"ui-state-default",uiBarHandleFreezeTop:"ui-state-default",uiBarMenuTop:"ui-state-default",uiCellActive:"ui-state-active",uiCellHighlighted:"ui-state-highlight",uiControl:"ui-widget-header ui-corner-top",uiControlTextBox:"ui-widget-content",uiFullScreen:"ui-widget-content ui-corner-all",uiInPlaceEdit:"ui-state-highlight",uiMenu:"ui-widget-header",uiMenuUl:"ui-widget-header",uiMenuLi:"ui-widget-header",uiParent:"ui-widget-content ui-corner-all",uiSheet:"ui-widget-content",uiTab:"ui-widget-header",uiTabActive:"ui-state-highlight"},msg:{addRowMulti:"How many rows would you like to add?",addColumnMulti:"How many columns would you like to add?",cellFind:"What are you looking for in this spreadsheet?",cellNoFind:"No results found.",dragToFreezeCol:"Drag to freeze column",dragToFreezeRow:"Drag to freeze row",newSheet:"What size would you like to make your spreadsheet? Example: '5x10' creates a sheet that is 5 columns by 10 rows.",openSheet:"Are you sure you want to open a different sheet?  All unsaved changes will be lost.",toggleHideRow:"No row selected.",toggleHideColumn:"Now column selected.",loopDetected:"Loop Detected",newSheetTitle:"What would you like the sheet's title to be?",notFoundColumn:"Column not found",notFoundRow:"Row not found",notFoundSheet:"Sheet not found",setCellRef:"Enter the name you would like to reference the cell by.",sheetTitleDefault:"Spreadsheet {index}"},kill:function(){for(var e in c.unbind("keydown"),x.obj.fullScreen().remove(),x.obj.inPlaceEdit().trigger("destroy"),v.parent.removeClass(x.cl.uiParent).html("").removeData("sheetInstance"),E.sheet.events)v.parent.unbind(E.sheet.events[e]);E.sheet.instance[s]=null,x=null},trigger:function(e,t){t=t||[],v.parent.trigger(e,[x].concat(t))},spreadsheetsToArray:function(e){return!e&&0!=x.spreadsheets.length||x.cycleCellsAll(function(e,t,r){var n=E(this);x.createCell(n,e,t,r,n.text(),n.data("formula"))}),x.spreadsheets},spreadsheetToArray:function(e,t){t=t||x.i,!e&&x.spreadsheets[t]||x.cycleCells(function(e,t,r){var n=E(this);x.createCell(n,e,t,r,n.text(),n.data("formula"))})},createCell:function(e,t,r,n,o,l,a,i,s){return x.spreadsheets[t]||(x.spreadsheets[t]=[]),x.spreadsheets[t][r]||(x.spreadsheets[t][r]=[]),x.spreadsheets[t][r][n]={td:e,formula:l||"",value:o||"",calcCount:a||0,calcLast:i||-1,calcDependenciesLast:s||-1,html:[],sheet:t},x.controls.bar.y.td[t]||(x.controls.bar.y.td[t]=[]),x.controls.bar.y.td[t][r]||(x.controls.bar.y.td[t][r]=e.parent().children().first()),x.controls.bar.x.td[t]||(x.controls.bar.x.td[t]=[]),x.controls.bar.x.td[t][n]||(x.controls.bar.x.td[t][n]=E(e[0].parentNode.parentNode.children[0].children[n])),x.spreadsheets[t][r][n]},nav:!1,setNav:function(e){E.sheet.instance.each(function(){this.nav=!1}),x.nav=e},controlFactory:{addRowMulti:function(e,t,r,n){(t=t||prompt(x.msg.addRowMulti))&&(isNaN(t)||(x.controlFactory.addCells(e,r,parseInt(t),"row",n),x.trigger("sheetAddRow",[e,r,t])))},addColumnMulti:function(e,t,r,n){(t=t||prompt(x.msg.addColumnMulti))&&(isNaN(t)||(x.controlFactory.addCells(e,r,parseInt(t),"col",n),x.trigger("sheetAddColumn",[e,r,t])))},addCells:function(i,s,c,e,t){x.autoFillerHide(),x.setDirty(!0),x.setChanged(!0),x.obj.barHelper().remove();var n,u=x.obj.sheet(),r=(u.width(),!1);switch(c=c||1,e=e||"col",i==b&&(i="row"==e?x.sheetSize().rows:x.sheetSize().cols,r=!0),e){case"row":n={cells:function(){var e=x.rowTds(u,i);return e&&e[0]?e[0].parentNode:[]},col:function(){return""},size:function(){return n.cells().children.length-1},loc:function(){var e=n.cells();return x.getTdLocation(e.children[0])},newCells:function(){for(var e=n.size(),t="",r=0;r<=e;r++)t+=0==r?'<td class="'+x.cl.barLeft+" "+x.cl.barLeft+"_"+x.i+" "+x.cl.uiBar+'" data-entity="left" data-type="bar">':"<td />";return'<tr style="height: '+v.colMargin+'px;">'+t+"</tr>"},newCol:"",offset:{row:c,col:0},start:function(){return{row:s?i:i+c}},createCells:function(e){e.each(function(t){var e=E(this).children(),r=(s?0:1)+i;x.spreadsheets[x.i].splice(t+r,0,[]),e.each(function(e){x.controls.bar.y.td[x.i];0==e?x.controls.bar.y.td[x.i].splice(t+r,0,E(this)):x.createCell(E(this),x.i,t+r,e)})}),x.refreshRowLabels(i)}};break;case"col":n={cells:function(){for(var e=x.rowTds(u,1)[i],t=x.rowTds(u),r=t[t.length-1],n=x.getTdLocation(e),o=x.getTdLocation(r),l=(l=E([])).add(x.obj.barTop(n.col)),a=1;a<=o.row;a++)l=l.add(x.getTd(x.i,a,n.col));return l},col:function(){return x.col(u,i)},newCol:"<col />",loc:function(e){return e=e||n.cells(),x.getTdLocation(e.first())},newCells:function(){return"<td />"},offset:{row:0,col:c},start:function(){return{col:s?i:i+c}},createCells:function(e,t){t.width(x.s.newColumnWidth);for(var r=x.rows(u),n=0;n<r.length;n++)for(var o=(s?0:1)+i,l=o+c;o<l;o++){var a=E(u[0].children[1].children[n].children[o]);0==n?(x.controls.bar.x.td[x.i].splice(o,0,a),a.addClass(x.cl.barTop+" "+x.cl.barTop+"_"+x.i+" "+x.cl.uiBar).data("type","bar").data("entity","top").text(jSE.columnLabelString(o))):(x.spreadsheets[x.i][n].splice(o,0,{}),x.createCell(a,x.i,n,o))}x.refreshColumnLabels(i)}}}for(var o=E(n.cells()),l=n.loc(o),a=n.col(),d=n.newCells(),h=n.newCol,f="",p="",g=0;g<c;g++)f+=h,p+=d;f=E(f),p=E(p),s?(o.before(p),E(a).before(f)):(o.after(p),E(a).after(f)),n.createCells(p,f),t||1==r||x.offsetFormulas(l,n.offset,s),x.obj.pane().trigger("resizeScroll")},addRow:function(e,t){x.controlFactory.addCells(e,t,1,"row"),x.trigger("sheetAddRow",[e,t,1])},addColumn:function(e,t){x.controlFactory.addCells(e,t,1,"col"),x.trigger("sheetAddColumn",[e,t,1])},barLeft:function(e){x.obj.barLefts().remove(),e.children("tbody").children("tr").each(function(e){0<e&&E(this).prepend("<td  />")})},barTop:function(e){var t=e.children("colgroup");E("<col />").attr("width",v.colMargin).css("width",v.colMargin+"px").prependTo(t);x.obj.barTops().remove();var r=E('<tr class="'+x.cl.barTopParent+'" />');x.controls.barTopParent[x.i]=r;var n=e.children("tbody").children("tr:first");return r.append("<td />"),n.children("td").each(function(e){r.append("<td />")}),r.insertBefore(n),r},barHandleFreeze:{top:function(n){if(x.isBusy())return!1;if(!(x.scrolledTo().col.end<=x.frozenAt().col+1))return!1;x.obj.barHelper().remove();var e=x.obj.barTop(x.frozenAt().col+1).position(),o=E('<div class="'+x.cl.uiBarHandleFreezeTop+" "+x.cl.barHelper+" "+x.cl.barHandleFreezeTop+'" />').height(v.colMargin+v.boxModelCorrection).css("top",e.top+"px").css("left",e.left+"px").attr("title",x.msg.dragToFreezeCol).prependTo(n);x.controls.bar.helper[x.i]=x.obj.barHelper().add(o),x.controls.bar.x.handleFreeze[x.i]=o,x.draggable(o,{axis:"x",start:function(){x.setBusy(!0)},stop:function(e,t){x.setBusy(!1),x.setDirty(!0);var r=x.nearest(o,x.controls.bar.x.tds());x.obj.barHelper().remove(),x.frozenAt().col=x.getTdLocation(r).col-1,x.evt.scroll.start("x",n)},containment:"parent"})},left:function(n){if(x.isBusy())return!1;if(!(x.scrolledTo().row.end<=x.frozenAt().row+1))return!1;x.obj.barHelper().remove();var e=x.obj.barLeft(x.frozenAt().row+1).position(),o=E('<div class="'+x.cl.uiBarHandleFreezeLeft+" "+x.cl.barHelper+" "+x.cl.barHandleFreezeLeft+'" />').width(v.colMargin).css("top",e.top+"px").css("left",e.left+"px").attr("title",x.msg.dragToFreezeRow).prependTo(n);x.controls.bar.helper[x.i]=x.obj.barHelper().add(o),x.controls.bar.y.handleFreeze[x.i]=o,x.draggable(o,{axis:"y",start:function(){x.setBusy(!0)},stop:function(e,t){x.setBusy(!1),x.setDirty(!0);var r=x.nearest(o,x.controls.bar.y.tds());x.obj.barHelper().remove(),x.frozenAt().row=x.getTdLocation(r).row-1,x.evt.scroll.start("y",n)},containment:"parent"})},corner:function(){}},makeMenu:function(e,t){var r;switch(e){case"top":r=E('<div class="'+x.cl.uiMenu+" "+x.cl.menu+'" />'),x.controls.bar.x.menu[x.i]=r;break;case"left":r=E('<div class="'+x.cl.uiMenu+" "+x.cl.menu+'" />'),x.controls.bar.y.menu[x.i]=r;break;case"cell":r=E('<div class="'+x.cl.uiMenu+" "+x.cl.menu+'" />'),x.controls.cellMenu[x.i]=r}for(var n in r.mouseleave(function(){r.hide()}).appendTo(u).hide(),t)t[n]&&(E.isFunction(t[n])?E("<div />").text(n).data("msg",n).click(function(){return t[E(this).data("msg")].apply(this,[x]),!1}).appendTo(r):"line"==t[n]&&E("<hr />").appendTo(r));return r},barMenu:{top:function(e,t,r){if(x.isBusy())return!1;var n=x.obj.barMenuTop().hide();if(n.length||(n=x.controlFactory.makeMenu("top",v.contextmenuTop)),!r)return n.css("left",e.pageX-5+"px").css("top",e.pageY-5+"px").show(),n;var o=x.obj.barMenuParentTop().hide();o.length||(o=E('<div class="'+x.cl.uiBarMenuTop+" "+x.cl.barHelper+'"><span class="ui-icon ui-icon-triangle-1-s" /></span></div>').mousedown(function(e){o.parent().mousedown().mouseup();o.offset();n.css("left",e.pageX-5+"px").css("top",e.pageY-5+"px").show()}).blur(function(){n&&n.hide()}).css("padding-left",r.position().left+r.width()-v.colMargin).bind("destroy",function(){o.remove(),x.controls.bar.x.menuParent[x.i]=null}),x.controls.bar.x.menuParent[x.i]=o),o.prependTo(r).show()},left:function(e,t){return!x.isBusy()&&(x.obj.barMenuLeft().hide(),t&&x.obj.barHandleFreezeLeft().remove(),(r=x.obj.barMenuLeft()).length||(r=x.controlFactory.makeMenu("left",v.contextmenuLeft)),r.css("left",e.pageX-5+"px").css("top",e.pageY-5+"px").show(),!0);var r},corner:function(){}},cellMenu:function(e){if(x.isBusy())return!1;x.obj.cellMenu().hide();var t=x.obj.cellMenu();t.length||(t=x.controlFactory.makeMenu("cell",v.contextmenuCell)),t.css("left",e.pageX-5+"px").css("top",e.pageY-5+"px").show()},header:function(){x.obj.header().remove(),x.obj.tabContainer().remove();var e,t,r,n=x.controls.header=E('<div class="'+x.cl.header+'"></div>'),o=E("<table><tr /></table>").prependTo(n),l=E("<tr />");function a(e){return(e=E.isFunction(e)?E(e(x)):E(e)).is("ul")&&(e.find("ul").hide().addClass(x.cl.uiMenuUl),e.find("li").addClass(x.cl.uiMenuLi).hover(function(){E(this).find("ul:first").hide().show()},function(){E(this).find("ul:first").hide()})),e}return v.title&&(E.isFunction(v.title)&&(v.title=x.title(x,s)),l.append(x.controls.title=E('<td class="'+x.cl.title+'" />').html(v.title))),x.isSheetEditable()&&(v.menuLeft&&(x.controls.menuLeft[x.i]=E('<td class="'+x.cl.menu+" "+x.cl.menuFixed+'" />').append(a(v.menuLeft)).prependTo(l),x.controls.menuLeft[x.i].find("img").load(function(){x.sheetSyncSize()})),v.menuRight&&(x.controls.menuRight[x.i]=E('<td class="'+x.cl.menu+" "+x.cl.menuFixed+'" />').append(a(v.menuRight)).appendTo(l),x.controls.menuRight[x.i].find("img").load(function(){x.sheetSyncSize()})),e=E('<td class="'+x.cl.label+'"></td>'),x.controls.label=e,t=E('<textarea class="'+x.cl.formula+'"></textarea>').keydown(x.evt.keydownHandler.formulaKeydown).keyup(function(){x.obj.inPlaceEdit().val(x.obj.formula().val())}).change(function(){x.obj.inPlaceEdit().val(x.obj.formula().val())}).bind("paste",x.evt.pasteOverCells).focus(function(){x.setNav(!1)}).focusout(function(){x.setNav(!0)}).blur(function(){x.setNav(!0)}),x.controls.formula=t,E('<table cellpadding="0" cellspacing="0" border="0"></table>').appendTo(n).append(E("<tr></tr>").append(e).append(E('<td class="'+x.cl.formulaParent+'"></td>').append(t))),r=E("<span />"),x.resizableSheet(x.obj.formula().wrap(r).parent(),{minHeight:x.obj.formula().height(),maxHeight:78,handles:"s",resize:function(e,t){x.obj.formula().height(t.size.height),x.sheetSyncSize()}}),E.sheet.instance.each(function(){this.nav=!1}),x.setNav(!0),c.keydown(x.evt.keydownHandler.documentKeydown)),l.appendTo(o),n},ui:function(){return x.controls.ui=E('<div class="'+x.cl.ui+'">')},tabContainer:function(){var r,e=x.controls.tabContainer=E('<div class="'+x.cl.tabContainer+'"></div>').mousedown(function(e){var t=+E(e.target).data("i");return 0<=t&&x.trigger("sheetSwitch",[t]),!1}).dblclick(function(e){return 0<=+E(e.target).data("i")&&x.trigger("sheetRename",[+E(e.target).data("i")]),!1});return x.isSheetEditable()?(E('<span class="'+x.cl.uiTab+' ui-corner-bottom" title="Add a spreadsheet" data-i="-1">+</span>').click(function(){x.addSheet({rows:25,cols:10})}).appendTo(e),E.fn.sortable&&e.sortable({placeholder:"ui-state-highlight",axis:"x",forceHelperSize:!0,forcePlaceholderSize:!0,opacity:.6,cancel:'span[i="-1"]',start:function(e,t){r=t.item.index(),x.trigger("sheetTabSortStart",[e,t])},update:function(e,t){x.trigger("sheetTabSortUpdate",[e,t,r])}})):E("<span />").appendTo(e),e},scroll:function(e,t,r){var i=x.controls.scroll[x.i]=E('<div class="'+x.cl.scroll+'"><div></div></div>').scroll(function(){x.isBusy()||(x.evt.scroll.scrollTo({axis:"x",pixel:this.scrollLeft},0),x.evt.scroll.scrollTo({axis:"y",pixel:this.scrollTop},0),x.autoFillerGoToTd())}).prependTo(e).disableSelectionSpecial().mousedown(function(){x.obj.barHelper().remove()}),o=0,l=0;x.controls.scrolls=x.obj.scrolls().add(i);var n,a,s=i.children(),c=x.controls.bar.x.scroll[x.i]=E('<style type="text/css"></style>').bind("updateStyle",function(e,t,r){var n;(t=t||[]).length!=o&&(o=t.length,n=r||E.sheet.nthCss("col","#"+x.id.sheet+x.i,this,t,x.frozenAt().col+1)+E.sheet.nthCss("td","#"+x.id.sheet+x.i+" tr",this,t,x.frozenAt().col+1),this.styleSheet?this.styleSheet.cssText=n:c.text(n),x.scrolledTo(),x.scrolledArea[x.i].col.start=t[0]||1,x.scrolledArea[x.i].col.end=t.pop()||1,x.obj.barHelper().remove())}),u=x.controls.bar.y.scroll[x.i]=E('<style type="text/css"></style>').bind("updateStyle",function(e,t,r){var n;(t=t||[]).length!=l&&(l=t.length,n=r||E.sheet.nthCss("tr","#"+x.id.sheet+x.i,this,t,x.frozenAt().row+1),this.styleSheet?this.styleSheet.cssText=n:u.text(n),x.scrolledTo(),x.scrolledArea[x.i].row.start=t[0]||1,x.scrolledArea[x.i].row.end=t.pop()||1,x.obj.barHelper().remove())});function d(e){return e&&e[0]&&e[0].styleSheet?e[0].styleSheet.cssText:e.text()}t.append(c).append(u).bind("resizeScroll",function(){n=d(c),a=d(u),c.trigger("updateStyle"),u.trigger("updateStyle"),s.height(r.height()).width(r.width()),i.height(e.height()).width(e.width()),x.evt.scroll.start("x",t,r),x.evt.scroll.start("y",t,r),c.trigger("updateStyle",[null,n]),u.trigger("updateStyle",[null,a])}),E.fn.mousewheel&&t.mousewheel(function(e,t){function r(e,t){return 0!=e%t?e:e/t}var n=e.originalEvent;if("mousewheel"==n.type){var o=r(-n.wheelDelta,1);n.wheelDeltaX!==b?i.scrollTop(i[0].scrollTop+r(-n.wheelDeltaY,1)).scrollLeft(i[0].scrollLeft+r(-n.wheelDeltaX,1)).scroll():i.scrollTop(i[0].scrollTop+o).scroll()}else{100<(e=n.detail)?e=3:e<-100&&(e=-3);var l=0,a=0;switch(e){case 1:case-1:a=50*e;break;case 3:case-3:l=15*e}i.scrollTop(i[0].scrollTop+l).scrollLeft(i[0].scrollLeft+a).scroll()}return!1})},hide:function(e,t,r){t=t||x.obj.pane();var n=x.controls.toggleHide.x[x.i]=E("<style></style>").appendTo(t).bind("updateStyle",function(e){var t=E.sheet.nthCss("col","#"+x.id.sheet+x.i,this,x.toggleHide.hiddenColumns[x.i],0)+E.sheet.nthCss("td","#"+x.id.sheet+x.i+" tr",this,x.toggleHide.hiddenColumns[x.i],0);this.styleSheet?this.styleSheet.cssText=t:n.text(t),x.autoFillerGoToTd()}),o=x.controls.toggleHide.y[x.i]=E("<style></style>").appendTo(t).bind("updateStyle",function(e){var t=E.sheet.nthCss("tr","#"+x.id.sheet+x.i,this,x.toggleHide.hiddenRows[x.i],0);this.styleSheet?this.styleSheet.cssText=t:o.text(t),x.autoFillerGoToTd()});if(v.hiddenColumns[x.i]=v.hiddenColumns[x.i]||[],v.hiddenRows[x.i]=v.hiddenRows[x.i]||[],v.hiddenColumns[x.i].length&&v.hiddenRows[x.i].length||(v.hiddenRows[x.i]=arrHelpers.toNumbers((r.data("hiddenrows")||"").split(",")),v.hiddenColumns[x.i]=arrHelpers.toNumbers((r.data("hiddencolumns")||"").split(","))),x.s.hiddenRows[x.i])for(var l in x.s.hiddenRows[x.i])x.toggleHide.row(x.s.hiddenRows[x.i][l]);if(v.hiddenColumns[x.i])for(var a in v.hiddenColumns[x.i])x.toggleHide.column(v.hiddenColumns[x.i][a])},sheetUI:function(o,e){e?(x.sheetCount++,x.i=e):(x.sheetCount=0,x.i=0),x.tuneTableForSheetUse(o),x.readOnly[e]=o.hasClass("readonly");var t,r=x.controlFactory.enclosure().appendTo(x.obj.ui()),l=x.obj.pane().html(o);return x.controlFactory.scroll(r,l,o),!x.isSheetEditable()||(t=x.controlFactory.autoFiller())&&l.append(t),x.sheetDecorate(o),x.controlFactory.barTop(o),x.controlFactory.barLeft(o),x.sheetTab(!0),x.isSheetEditable()&&(x.obj.formula(),l.mousedown(function(e){return x.setNav(!0),!x.isBusy()&&(x.isTd(e.target)?(x.evt.cellOnMouseDown(e),!1):x.isBar(e.target)?(x.evt.barInteraction.select(e.target),!1):void 0)}).mouseover(function(e){if(x.isBusy())return!1;if(x.isBar(e.target)){var t=E(e.target),r=t.data("entity"),n=x.getBarIndex[r](e.target);if(n<0)return!1;x.evt.barInteraction.selecting?(x.evt.barInteraction.last=n,x.cellSetActiveBar(r,x.evt.barInteraction.first,x.evt.barInteraction.last)):(x.resizeBar[r](t,n,l,o),x.isSheetEditable()&&(x.controlFactory.barHandleFreeze[r](l),"top"==r&&x.controlFactory.barMenu[r](e,n,t)))}}).bind("contextmenu",function(e){if(x.isBusy())return!1;if(x.isBar(e.target)){var t=E(e.target).data("entity"),r=x.getBarIndex[t](e.target);if(r<0)return!1;x.evt.barInteraction.first==x.evt.barInteraction.last&&x.controlFactory.barMenu[t](e,r)}else x.controlFactory.cellMenu(e);return!1}).disableSelectionSpecial().bind("cellEdit",x.evt.cellEdit).dblclick(x.evt.cellOnDblClick)),x.themeRoller.start(o),x.resizableSheet(v.parent,{minWidth:.1*v.width,minHeight:.1*v.height,start:function(){r.hide()},stop:function(){r.show(),v.width=v.parent.width(),v.height=v.parent.height(),l.trigger("resizeScroll")}}),x.createSpreadsheet(o,x.i),x.checkMinSize(o),x.controlFactory.tab(),x.controlFactory.hide(r,l,o),x.setChanged(!0),o},enclosure:function(){var e=x.controls.pane[x.i]=E('<div class="'+x.cl.pane+'"></div>'),t=x.controls.enclosure[x.i]=E('<div class="'+x.cl.enclosure+'"></div>').append(e);return x.controls.panes=x.obj.panes().add(e),x.controls.enclosures=x.obj.enclosures().add(t),t},tab:function(){var e=x.controls.tab[x.i]=E('<span class="'+x.cl.uiTab+' ui-corner-bottom"><a class="'+x.cl.tab+'" data-i="'+x.i+'">'+x.sheetTab(!0)+"</a></span>").insertBefore(x.obj.tabContainer().find("span:last"));return x.controls.tabs=x.obj.tabs().add(e),e},inPlaceEdit:function(e,t){(e=e||x.obj.cellActive()).length||(e=E(x.rowTds(null,1)[1]),x.cellEdit(e)),x.obj.inPlaceEdit().trigger("destroy");var r,n=x.obj.formula(),o=e.offset(),l=(e.attr("style"),e.width()),a=e.height(),i=n.val();o&&(r=x.controls.inPlaceEdit[x.i]=E('<textarea class="'+x.cl.inPlaceEdit+" "+x.cl.uiInPlaceEdit+'" data-i="'+x.i+'"/>').css("left",o.left).css("top",o.top).width(l).height(a).keydown(x.evt.inPlaceEditOnKeyDown).keyup(function(){n.val(r.val())}).change(function(){n.val(r.val())}).focus(function(){x.setNav(!1)}).focusout(function(){x.setNav(!0)}).blur(function(){x.setNav(!0)}).bind("paste",x.evt.pasteOverCells).appendTo(u).val(n.val()).focus().bind("destroy",function(){x.cellLast.isEdit=r.val()!=i,r.remove(),x.controls.inPlaceEdit[r.data("i")]=!1}),t||r.select(),E.fn.elastic&&r.elastic())},autoFiller:function(){return v.autoFiller?(x.controls.autoFiller[x.i]=E('<div class="'+x.cl.autoFiller+" "+x.cl.uiAutoFiller+'"><div class="'+x.cl.autoFillerHandle+'" /><div class="'+x.cl.autoFillerCover+'" /></div>').mousedown(function(e){var r,t=x.obj.cellActive();t&&(r=x.getTdLocation(t),x.cellSetActive(t,r,!0,x.autoFillerNotGroup,function(){var e=x.obj.cellHighlighted(),t=x.getTdLocation(e.first());x.fillUpOrDown(t.row<r.row||t.col<r.col),x.autoFillerGoToTd(e.last()),x.autoFillerNotGroup=!1}))}),x.controls.autoFiller[x.i]):null}},autoFillerNotGroup:!0,updateCellsAfterPasteToFormula:function(e){var t=x.obj.formula();new Date;e=e||t.val();var r={row:x.cellLast.row,col:x.cellLast.col},n=t.val(),o=n;if(0==r.row&&0==r.col)return!1;var l=tsv.parse(n);if(!E.isArray(l))return t.val(l),x.fillUpOrDown(!1,!1,l),!0;for(var a=0;a<l.length;a++){x.cellLast.isEdit=!0;for(var i=l[a],s=0;s<i.length;s++){0;var c=x.getTd(x.i,a+r.row,s+r.col);if(c.row=r.row,c.col=r.col,c.length){if(!x.spreadsheets[x.i]||!x.spreadsheets[x.i][a+r.row]||!x.spreadsheets[x.i][a+r.row][s+r.col])continue;var u=x.spreadsheets[x.i][a+r.row][s+r.col];u&&(v.parent.one("sheetPreCalculation",function(){"="==(i[s]+"").charAt(0)?(u.formula=i[s].substring(1),u.value="",c.data("formula",i[s])):(u.formula="",u.value=i[s],c.removeData("formula"))}),x.calcDependencies(x.i,a+r.row,s+r.col),0==a&&0==s&&(o=i[s]))}}}n!=o&&t.val(o),x.fillUpOrDown(!1,!1,o),x.evt.cellEditDone(!0)},evt:{keydownHandler:{enterOnInPlaceEdit:function(e){return!!e.shiftKey||x.evt.cellSetFocusFromKeyCode(e)},enter:function(e){return x.cellLast.isEdit||e.ctrlKey?this.enterOnInPlaceEdit(e):(x.obj.cellActive().dblclick(),!1)},tab:function(e){return x.evt.cellSetFocusFromKeyCode(e)},findCell:function(e){return!e.ctrlKey||(x.cellFind(),!1)},redo:function(e){return!(e.ctrlKey&&!x.cellLast.isEdit)||(x.cellUndoable.undoOrRedo(),!1)},undo:function(e){return!(e.ctrlKey&&!x.cellLast.isEdit)||(x.cellUndoable.undoOrRedo(!0),!1)},copy:function(e,t){var r=x.obj.cellHighlighted(),n=x.obj.formula(),o=n.val(),l=x.tdsToTsv(r,t);return n.val(l).focus().select(),c.one("keyup",function(){t?n.val(""):n.val(o)}),!0},cut:function(e){return this.copy(e,!0)},pageUpDown:function(e){var t,r=x.sheetSize(),n=x.obj.pane().height(),o=0;if(e)for(var l=x.cellLast.row;0<l&&o<n;l--)!(t=x.getTd(x.i,l,1)).data("hidden")&&t.is(":hidden")&&t.show(),o+=t.parent().height();else for(l=x.cellLast.row;l<r.rows&&o<n;l++)o+=(t=x.getTd(x.i,l,1)).parent().height();return x.cellEdit(t),!1},formulaKeydown:function(e){if(x.readOnly[x.i])return!1;if(x.cellLast.row<0||x.cellLast.col<0)return!1;switch(x.trigger("sheetFormulaKeydown",[!1]),e.keyCode){case key.C:return e.ctrlKey?x.evt.keydownHandler.copy(e):(x.obj.cellActive().dblclick(),!0);case key.X:return e.ctrlKey?x.evt.keydownHandler.cut(e):(x.obj.cellActive().dblclick(),!0);case key.Y:return e.ctrlKey?(x.evt.keydownHandler.redo(e),!1):(x.obj.cellActive().trigger("cellEdit"),!0);case key.Z:return e.ctrlKey?(x.evt.keydownHandler.undo(e),!1):(x.obj.cellActive().trigger("cellEdit"),!0);case key.ESCAPE:x.evt.cellEditAbandon();break;case key.ENTER:return x.evt.cellSetFocusFromKeyCode(e),!1;default:x.cellLast.isEdit=!0}},formulaKeydownIf:function(e,t){return!!e&&(x.obj.cellActive().dblclick(),!0)},documentKeydown:function(e){if(x.readOnly[x.i])return!1;if(x.cellLast.row<0||x.cellLast.col<0)return!1;if(x.nav){switch(e.keyCode){case key.DELETE:x.tdsToTsv(null,!0),x.obj.formula().val("");break;case key.TAB:x.evt.keydownHandler.tab(e);break;case key.ENTER:case key.LEFT:case key.UP:case key.RIGHT:case key.DOWN:e.shiftKey?x.evt.cellSetHighlightFromKeyCode(e):x.evt.cellSetFocusFromKeyCode(e);break;case key.PAGE_UP:x.evt.keydownHandler.pageUpDown(!0);break;case key.PAGE_DOWN:x.evt.keydownHandler.pageUpDown();break;case key.HOME:case key.END:x.evt.cellSetFocusFromKeyCode(e);break;case key.V:return e.ctrlKey?x.evt.keydownHandler.formulaKeydownIf(!x.evt.pasteOverCells(e),e):(x.obj.cellActive().trigger("cellEdit"),!0);case key.Y:return e.ctrlKey?(x.evt.keydownHandler.redo(e),!1):(x.obj.cellActive().trigger("cellEdit"),!0);case key.Z:return e.ctrlKey?(x.evt.keydownHandler.undo(e),!1):(x.obj.cellActive().trigger("cellEdit"),!0);case key.ESCAPE:x.evt.cellEditAbandon();break;case key.F:return e.ctrlKey?x.evt.keydownHandler.formulaKeydownIf(x.evt.keydownHandler.findCell(e),e):(x.obj.cellActive().trigger("cellEdit"),!0);case key.CAPS_LOCK:case key.SHIFT:case key.ALT:break;case key.CONTROL:return x.obj.formula().focus().select(),!0;default:return x.obj.cellActive().trigger("cellEdit"),!0}return!1}}},pasteOverCells:function(e){if(e.ctrlKey||"paste"==e.type){var t=function(){x.updateCellsAfterPasteToFormula()},r=c.one("keyup",function(){t(),t=function(){},r.mouseup()}).one("mouseup",function(){t(),t=function(){},r.keyup()});return x.setDirty(!0),x.setChanged(!0),!0}},inPlaceEditOnKeyDown:function(e){switch(x.trigger("sheetFormulaKeydown",[!0]),e.keyCode){case key.ENTER:return x.evt.keydownHandler.enterOnInPlaceEdit(e);case key.TAB:return x.evt.keydownHandler.tab(e);case key.ESCAPE:return x.evt.cellEditAbandon(),!1}},cellEditDone:function(e){var t,r,n,o;x.obj.inPlaceEdit().trigger("destroy"),(x.cellLast.isEdit||e)&&(t=x.obj.formula(),r=x.obj.cellActive(),x.isFormulaEditable(r)&&r&&0<x.cellLast.row&&0<x.cellLast.col&&(n=t.val(),o=x.spreadsheets[x.i][x.cellLast.row][x.cellLast.col],v.parent.one("sheetPreCalculation",function(){"="==n.charAt(0)?(r.data("formula",n),o.value=n,o.formula=n):(r.removeData("formula"),o.value=n,o.formula="")}),x.calcDependencies(x.i,x.cellLast.row,x.cellLast.col),x.cellLast.isEdit=!1,x.trigger("sheetCellEdited",[o])))},cellEditAbandon:function(e){return x.obj.inPlaceEdit().trigger("destroy"),x.themeRoller.bar.clearActive(),x.themeRoller.cell.clearHighlighted(),e||x.calc(),x.cellLast.td=E([]),x.cellLast.row=0,x.cellLast.col=0,x.rowLast=0,x.colLast=0,x.labelUpdate("",!0),x.obj.formula().val(""),x.autoFillerHide(),!1},cellSetFocusFromXY:function(e,t){var r=x.getTdFromXY(e,t);return!x.isTd(r)||(r=E(r),x.cellEdit(r),!1)},cellSetHighlightFromKeyCode:function(e){var t=x.highlightedLast.colLast,r=x.highlightedLast.rowLast,n=x.sheetSize();switch(x.obj.cellActive().mousedown(),dir=E("html").attr("dir"),e.keyCode){case key.UP:r--;break;case key.DOWN:r++;break;case key.LEFT:"ltr"===dir?t--:t++;break;case key.RIGHT:"ltr"===dir?t++:t--}function o(e,t){return e<1?1:t<e?t:e}return r=o(r,n.rows),t=o(t,n.cols),x.themeRoller.cell.clearHighlighted(),x.highlightedLast.colEnd=r,x.highlightedLast.rowEnd=t,x.highlightedLast.td=x.cycleCellsAndMaintainPoint(x.themeRoller.cell.setHighlighted,x.getTdLocation(x.obj.cellActive()),{row:r,col:t}),x.getTd(x.i,r,t).mousemove().mouseup(),x.highlightedLast.rowLast=r,x.highlightedLast.colLast=t,!1},cellSetFocusFromKeyCode:function(e){var t=x.cellLast.col,r=x.cellLast.row,n=!1,o=E("html").attr("dir");switch(e.keyCode){case key.UP:r--;break;case key.DOWN:r++;break;case key.LEFT:"ltr"===o?t--:t++;break;case key.RIGHT:"ltr"===o?t++:t--;break;case key.ENTER:if(r++,n=!0,1<x.highlightedLast.td.length){var l=x.obj.inPlaceEdit(),a=l.val();return l.trigger("destroy"),x.updateCellsAfterPasteToFormula(a),!0}v.autoAddCells&&x.cellLast.row==x.sheetSize().rows&&x.controlFactory.addRow();break;case key.TAB:n=!0,e.shiftKey?"ltr"===o?t--:t++:"ltr"===o?t++:t--,v.autoAddCells&&x.cellLast.col==x.sheetSize().cols&&x.controlFactory.addColumn();break;case key.HOME:t=1;break;case key.END:t=x.obj.cellActive().parent().children("td").length-1}if(t=t||1,r=r||1,!x.cellLast.isEdit||n){var i=x.getTd(x.i,r,t);if(i)return x.cellEdit(i),!1}return!0},cellOnMouseDown:function(e){x.obj.formula().blur(),e.shiftKey?x.getTdRange(e,x.obj.formula().val()):x.cellEdit(E(e.target),!0)},cellOnDblClick:function(e){if(x.isBusy())return!1;x.controlFactory.inPlaceEdit(null,!0)},cellEdit:function(e){if(x.isBusy())return!1;x.controlFactory.inPlaceEdit()},barInteraction:{first:0,last:0,selecting:!1,select:function(e){if(e&&x.isBar(e)){var t=(e=E(e)).data("entity"),r=x.getBarIndex[t](e[0]);return r<0?!1:(x[t+"Last"]=r,x.evt.barInteraction.last=x.evt.barInteraction.first=r,x.cellSetActiveBar(t,x.evt.barInteraction.first,x.evt.barInteraction.last),x.evt.barInteraction.first=x.evt.barInteraction.last=x[t+"Last"]=r,x.evt.barInteraction.selecting=!0,c.one("mouseup",function(){x.evt.barInteraction.selecting=!1}),!1)}}},scroll:{axis:{x:{},y:{}},size:{},td:{},start:function(e,t,r){x.autoFillerHide(),t=t||x.obj.pane(),r=r||x.obj.sheet();var n=x.evt.scroll;switch(n.size=x.sheetSize(r),n.td=x.obj.cellActive(),n.axis[e].v=[],n.axis[e].p=[],e||"x"){case"x":var o=n.axis.x;o.max=n.size.cols,o.min=1,o.scrollStyle=x.obj.scrollStyleX().trigger("updateStyle"),o.area=t.width(),o.sheetArea=r.width(),o.scrollUpdate=function(e){(e=e||x.obj.scroll()).scrollLeft(o.value*(e.width()/n.size.cols))};break;case"y":var l=n.axis.y;l.max=n.size.rows,l.min=1,l.scrollStyle=x.obj.scrollStyleY().trigger("updateStyle"),l.area=t.height(),l.sheetArea=r.height(),l.scrollUpdate=function(e){(e=e||x.obj.scroll()).scrollTop(l.value*(e.height()/n.size.rows))}}n.axis[e].gridSize=100/(n.axis[e].max-n.axis[e].min);for(var a=n.axis[e].min;a<=n.axis[e].max;a++)n.axis[e].v[a]=n.axis[e].gridSize*a,n.axis[e].p[n.axis[e].gridSize*a]=a+1},scrollTo:function(e){(e=e||{}).axis=e.axis||"x",e.value=e.value||0,e.pixel=e.pixel||1,x.evt.scroll.axis||x.evt.scroll.start(e.axis);var t=x.evt.scroll.axis[e.axis];if(!e.value){if(!t.p)return;e.value=t.p[arrHelpers.closest(t.v,100*Math.abs(e.pixel/(t.sheetArea-t.area)),t.min)]}e.max=e.max||t.max;for(var r=t.min,n=[];r<=e.value||r<=e.max;)r<e.value&&r>=t.min&&n.push(r),r++;n.length?t.scrollStyle&&t.scrollStyle.trigger("updateStyle",[n]):t.scrollStyle&&t.scrollStyle.trigger("updateStyle"),t.value=e.value},stop:function(){this.axis.x.scrollUpdate&&this.axis.x.scrollUpdate(),this.axis.y.scrollUpdate&&this.axis.y.scrollUpdate(),x.evt.scroll.td&&(x.evt.scroll.td=null,x.autoFillerGoToTd())}}},refreshColumnLabels:function(e){e=e||0,x.obj.barMenuParentTop().trigger("destroy");var t=x.controls.bar.x.td[x.i];if(t)for(var r=e;r<t.length;r++)r&&E(t[r]).text(jSE.columnLabelString(r))},refreshRowLabels:function(e){e=e||0;var t=x.controls.bar.y.td[x.i];if(t)for(var r=e;r<t.length;r++)r&&E(t[r]).text(r)},isTd:function(e){return!!e&&!!((e=e[0]?e[0]:[e])[0]&&!isNaN(e[0].cellIndex)&&0<e[0].cellIndex&&0<e[0].parentNode.rowIndex)},isBar:function(e){return!!e&&!(!(e=e[0]?e[0]:[e])[0]||isNaN(e[0].cellIndex)||0!=e[0].cellIndex&&0!=e[0].parentNode.rowIndex)},readOnly:[],isSheetEditable:function(e){return e=e||x.i,1==v.editable&&!x.readOnly[e]},isFormulaEditable:function(e){return!v.lockFormulas||e.data("formula")===b},toggleFullScreen:function(){var e,t,r,n;x&&(x.evt.cellEditDone(),(e=x.obj.fullScreen()).is(":visible")?(u.removeClass("bodyNoScroll"),v.parent=e.data("parent"),t=v.parent.width(),r=v.parent.height(),v.width=t,v.height=r,v.parent.append(e.children()),e.remove(),x.sheetSyncSize(),x.obj.pane().trigger("resizeScroll"),x.trigger("sheetFullScreen",[!1])):(u.addClass("bodyNoScroll"),t=o.width()-15,r=o.height()-15,n=v.parent,v.width=t,v.height=r,v.parent=x.controls.fullScreen[x.i]=E('<div class="'+x.cl.fullScreen+" "+x.cl.uiFullScreen+'" />').append(v.parent.children()).appendTo(u).data("parent",v.parent),x.obj.pane().trigger("resizeScroll"),x.sheetSyncSize(),n.trigger("sheetFullScreen",[!0])))},renameSheet:function(e){if(isNaN(e))return!1;-1<e&&x.sheetTab()},switchSheet:function(e){if(isNaN(e))return!1;-1==e?x.addSheet("5x10"):e!=x.i&&(x.setActiveSheet(e),x.calc(e))},tuneTableForSheetUse:function(e){x.controls.sheet[x.i]=e.addClass(x.cl.sheet).attr("id",x.id.sheet+x.i).attr("border","1px").attr("cellpadding","0").attr("cellspacing","0"),x.controls.sheets=x.obj.sheets().add(e);var t=e.data("frozenatrow"),r=e.data("frozenatcol");return x.s.frozenAt[x.i]||(x.s.frozenAt[x.i]={row:0,col:0}),t&&(x.s.frozenAt[x.i].row=t),r&&(x.s.frozenAt[x.i].col=r),e},createSpreadsheet:function(e,n,t){e=e||x.obj.sheet(),n=n||x.i,t=E.extend({row:0,col:0},t),x.spreadsheets[n]=[];var r=x.rows(e);E(r).each(function(r){E(this).children().each(function(e){var t=E(this);0<r&&0<e?x.createCell(t,n,r,e,t.text(),t.data("formula")):(0==e&&0<r&&t.data("type","bar").data("entity","left").text(r).attr("class",x.cl.barLeft+" "+x.cl.barLeft+"_"+x.i+" "+x.cl.uiBar),0==r&&0<e&&t.data("type","bar").data("entity","top").text(jSE.columnLabelString(e)).attr("class",x.cl.barTop+" "+x.cl.barTop+"_"+x.i+" "+x.cl.uiBar),0==r&&0==e&&(x.controls.bar.corner[x.i]=t.data("type","bar").data("entity","corner").attr("class",x.cl.uiBar+"  "+x.cl.barCorner)))})})},toggleHide:{hiddenRows:[],row:function(e){var t,r;(e=e||x.rowLast)&&(t=x.rows()[e],r=E(t),this.hiddenRows[x.i]||(this.hiddenRows[x.i]=[]),r.length&&E.inArray(e+1,this.hiddenRows[x.i])<0?this.hiddenRows[x.i].push(e+1):this.hiddenRows[x.i].splice(this.hiddenRows[x.i].indexOf(e+1),1),x.obj.toggleHideStyleY().trigger("updateStyle"))},rowShowAll:function(){E.each(this.hiddenRows[x.i],function(e){E(this).removeData("hidden")}),x.obj.toggleHideStyleY().html(""),this.hiddenRows[x.i]=[]},hiddenColumns:[],columnIndexOffset:[],column:function(e){var t,r;(e=e||x.colLast)&&(t=x.cols()[e],r=E(t),this.hiddenColumns[x.i]||(this.hiddenColumns[x.i]=[]),r.length&&E.inArray(e+1,this.hiddenColumns[x.i])<0?this.hiddenColumns[x.i].push(e+1):this.hiddenColumns[x.i].splice(this.hiddenColumns[x.i].indexOf(e+1),1),x.obj.toggleHideStyleX().trigger("updateStyle"))},columnShowAll:function(){x.obj.toggleHideStyleX().html(""),this.hiddenColumns[x.i]=[]}},merged:[],merge:function(){var e=[],t=x.obj.cellHighlighted(),r=x.getTdLocation(t.first()),n=x.getTdLocation(t.last()),o=0,l=0,a=x.spreadsheets[x.i][r.row][r.col],i=new Date;if(1<t.length&&r.row){x.setDirty(!0),x.setChanged(!0),x.merged[x.i+"_"+r.row+"_"+r.col]||(x.merged[x.i+"_"+r.row+"_"+r.col]=[]);for(var s=x.merged[x.i+"_"+r.row+"_"+r.col],c=r.row;c<=n.row;c++){c&&l++;for(var u=r.col;u<=n.col;u++){c==r.row&&o++;var d=x.getTd(x.i,c,u),h=x.spreadsheets[x.i][c][u],f=x.spreadsheets[x.i][c][r.col-1]||x.spreadsheets[x.i][c][r.col],p=x.spreadsheets[x.i][c][n.col+1]||x.spreadsheets[x.i][c][n.col],g=x.spreadsheets[x.i][n.row-1][n.col]||x.spreadsheets[x.i][n.row][n.col],b=x.spreadsheets[x.i][n.row+1][n.col]||x.spreadsheets[x.i][n.row][n.col];s.push(h),e.push(h.formula?"("+h.formula.substring(1)+")":h.value),v.parent.one("sheetPreCalculation",function(){u==r.col&&c==r.row||(h.formula=null,h.value="",h.html="",h.defer=a,h.right=p,h.down=b,h.left=f,h.up=g,d.removeData("formula").html("").hide())}),x.calcDependencies(x.i,c,u,i)}}a.value=e.join(" "),a.formula=a.formula?e.join(" "):"",t.first().show().attr("rowSpan",l).attr("colSpan",o),x.calcDependencies(x.i,r.row,r.col),x.evt.cellEditDone()}},unmerge:function(){for(var e=x.obj.cellHighlighted().first(),t=x.getTdLocation(e),r=(x.spreadsheets[x.i][t.row][t.col],e.data("formula"),new Date),n=Math.max(+e.attr("rowSpan"),1),o=Math.max(+e.attr("colSpan"),1),l=t.row;l<=t.row+n;l++)for(var a=t.col;a<=t.col+o;a++){var e=x.getTd(x.i,l,a).show().removeAttr("colSpan").removeAttr("rowSpan"),i=x.spreadsheets[x.i][l][a];i.up=i.down=i.left=i.right=i.defer=null,x.calcDependencies(x.i,l,a,r)}},fillUpOrDown:function(n,e,o){var t=x.obj.cellHighlighted(),r=x.obj.cellActive(),l=new Date,a=(r.hasClass(x.cl.uiCellHighlighted),x.getTdLocation(t.first())),i=x.getTdLocation(t.last());o=o||x.obj.formula().val();var s,c={row:0,col:0},u=o,d="="==o.charAt(0)?function(e,t,r){n?(c.row=-i.row+t,c.col=-i.col+r):(c.row=t-a.row,c.col=r-a.col),u=x.reparseFormula(o,c),v.parent.one("sheetPreCalculation",function(){(s=x.spreadsheets[e][t][r]).formula=u,s.value="",s.td.data("formula",u)}),x.calcDependencies(e,t,r,l)}:(n&&!isNaN(u)&&(u*=1,u-=i.row,u-=i.col),function(e,t,r){v.parent.one("sheetPreCalculation",function(){(s=x.spreadsheets[e][t][r]).formula="",s.value=u,s.td.removeData("formula")}),x.calcDependencies(e,t,r,l),isNaN(u)||""==u||u++});x.cycleCells(d,a,i)},tdsToTsv:function(o,r,l){o=o||x.obj.cellHighlighted(),l=l||function(e,t){r&&(v.parent.one("sheetPreCalculation",function(){t.formula="",t.value=""}),x.calcDependencies(x.i,e.row,e.col,n))};var a=[],i=(x.obj.formula().val(),0),n=new Date;for(var e in o.each(function(e){var t=x.getTdLocation(o[e]),r=x.spreadsheets[x.i][t.row][t.col],n=r.formula?"="+r.formula:r.value;i=i||t.row,a[t.row-i]||(a[t.row-i]=[]),(n+"").match(/\n/)&&(n='"'+n+'"'),a[t.row-i].push(n||""),l.apply(this,[t,r])}),a)a[e]=a[e].join("\t");return a.join("\n")},offsetFormulas:function(l,a,n){var e=x.sheetSize(),t=(e.rows,e.cols,{first:{row:0,col:0},last:{row:e.rows,col:e.cols}});function i(e,t){var r=!1;return n?t<=e&&(r=!0):t<e&&(r=!0),r}x.log("offsetFormulas from - Col:"+l.col+",Row:"+l.row),x.log("Is before loc:"+(n?"true":"false")),x.log("Offset: - Col:"+a.col+",Row:"+a.row),x.cycleCells(function(e,t,r){var n=E(this),o=n.data("formula");o&&x.isFormulaEditable(n)&&(o=x.reparseFormula(o,a,function(e){return{row:i(e.row,l.row),col:i(e.col,l.col)}}),x.spreadsheets[e][t][r].formula=o,n.data("formula",o))},t.first,t.last),x.evt.cellEditDone(),x.calc()},reparseFormula:function(e,a,i){return e.replace(jSE.regEx.cell,function(e,t,r,n){if("SHEET"==t)return e;var o=jSE.parseLocation(e);if(!i)return x.makeFormula(o,a);var l=i(o);return l.col||l.row?(l.col&&(o.col+=a.col),l.row&&(o.row+=a.row),x.makeFormula(o)):e})},makeFormula:function(e,t){return t=E.extend({row:0,col:0},t),e.col+=t.col,e.row+=t.row,e.col<0&&(e.col=0),e.row<0&&(e.row=0),jSE.parseCellName(e.col,e.row)},cycleCells:function(e,t,r,n){var o;n=n||x.i,t=t||{row:0,col:0},r||(r={row:(o=x.sheetSize(E("#"+x.id.sheet+n))).rows,col:o.cols});for(var l=t.row;l<=r.row;l++)for(var a=t.col;a<=r.col;a++){var i=x.getTd(n,l,a);i&&e.apply(i,[n,l,a])}},cycleCellsAll:function(e){for(var t=0;t<=x.sheetCount;t++){var r=x.sheetSize(E("#"+x.id.sheet+t)),n={row:r.rows,col:r.cols};x.cycleCells(e,{row:0,col:0},n,t)}},cycleCellsAndMaintainPoint:function(e,t,r){for(var n=E([]),o=Math.min(t.row,r.row),l=Math.min(t.col,r.col),a=Math.max(t.row,r.row),i=Math.max(t.col,r.col),s=o;s<=a;s++)for(var c=l;c<=i;c++)e((n=n.add(x.getTd(x.i,s,c)))[n.length-1]);return n},sheetDecorate:function(e){x.formatSheet(e),x.sheetDecorateRemove(!1,e)},formatSheet:function(e){var t=v.newColumnWidth,r=v.colMargin,n=e.children("tbody");n.length<1&&(n=E("<tbody />"),e.wrapInner(n));var o=e.children("colgroup");(o.length<1||o.children("col").length<1)&&(e.remove("colgroup"),o=E("<colgroup />").prependTo(e),n.children("tr:first").children().each(function(){E("<col />").width(t).css("width",t+"px").attr("width",t+"px").appendTo(o)}),n.children("tr").each(function(){E(this).height(r).css("height",r+"px").attr("height",r+"px")})),e.removeAttr("width").css("width","")},checkMinSize:function(e){var t=x.sheetSize(e);t.cols<v.minSize.cols&&x.controlFactory.addColumnMulti(null,v.minSize.cols-t.cols),t.rows<v.minSize.rows&&x.controlFactory.addRowMulti(null,v.minSize.rows-t.rows)},themeRoller:{start:function(e){v.parent.addClass(x.cl.uiParent),e.addClass(x.cl.uiSheet),x.obj.header().addClass(x.cl.uiControl),x.obj.label().addClass(x.cl.uiControl),x.obj.formula().addClass(x.cl.uiControlTextBox)},cell:{setHighlighted:function(e){E(e).addClass(x.cl.uiCellHighlighted)},isHighlighted:function(){return!!x.highlightedLast.td.length},clearHighlighted:function(){x.themeRoller.cell.isHighlighted()&&x.obj.cellHighlighted().removeClass(x.cl.uiCellHighlighted),x.highlightedLast.rowStart=0,x.highlightedLast.colStart=0,x.highlightedLast.rowEnd=0,x.highlightedLast.colEnd=0,x.highlightedLast.td=E([])}},bar:{style:function(e){E(e).addClass(x.cl.uiBar)},setActive:function(e,t){switch(e){case"top":x.obj.barTop(t).addClass(x.cl.uiBarHighlight);break;case"left":x.obj.barLeft(t).addClass(x.cl.uiBarHighlight)}},clearActive:function(){x.obj.barTops().removeClass(x.cl.uiBarHighlight),x.obj.barLefts().removeClass(x.cl.uiBarHighlight)}},tab:{setActive:function(e){this.clearActive(),x.obj.tab().addClass(x.cl.uiTabActive)},clearActive:function(){x.obj.tabContainer().find("span."+x.cl.uiTabActive).removeClass(x.cl.uiTabActive)}}},resizable:function(e,t){e.data("resizable")||e.resizable(t)},frozenAt:function(){return x.s.frozenAt[x.i]||(x.s.frozenAt[x.i]={row:0,col:0}),x.s.frozenAt[x.i]},scrolledTo:function(){return x.scrolledArea[x.i]||(x.scrolledArea[x.i]={col:{start:x.frozenAt().col,end:x.frozenAt().col},row:{start:x.frozenAt().row,end:x.frozenAt().row}}),x.scrolledArea[x.i]},busy:[],setBusy:function(e){e?x.busy.push(e):x.busy.pop()},isBusy:function(){return 0<x.busy.length},draggable:function(e,t){e.data("jSdraggable")||e.data("jSdraggable",!0).draggable(t)},nearest:function(e,t){return E(e).nearest(t)},resizeBar:{top:function(e,r,n,o){x.obj.barTopControls().remove();var t=E('<div class="'+x.cl.barController+'" />').width(e.width()).height(0).prependTo(e);x.controls.bar.x.controls[x.i]=x.obj.barTopControls().add(t),x.resizableCells(t,{handles:"e",start:function(e,t){x.autoFillerHide(),x.setBusy(!0),this.col=E(x.col(o,r))},resize:function(e,t){this.col.width(t.size.width).attr("width",t.size.width+"px").css("width",t.size.width+"px")},stop:function(e,t){x.setBusy(!1),n.trigger("resizeScroll"),x.followMe(),x.setDirty(!0)}})},left:function(e,t,r,n){x.obj.barLeftControls().remove();var o=e.offset(),l=E('<div class="'+x.cl.barController+'"></div>').prependTo(e).offset({top:o.top,left:o.left});x.controls.bar.y.controls[x.i]=x.obj.barLeftControls().add(l);var a=E('<div class="barControllerChild"></div>').height(e.height()).prependTo(l),i=e.parent().add(e).add(l);x.resizableCells(a,{handles:"s",start:function(){x.autoFillerHide(),x.setBusy(!0)},resize:function(e,t){i.height(t.size.height).attr("height",t.size.height).css("height",t.size.height+"px")},stop:function(e,t){x.setBusy(!1),r.trigger("resizeScroll"),x.followMe(),x.setDirty(!0)}})},corner:function(){}},sheetDecorateRemove:function(e,t){return t=t||x.obj.sheets(),(t=e?t.clone():t).find("td."+x.cl.uiCellActive).removeClass(x.cl.uiCellActive),t.find("td."+x.cl.uiCellHighlighted).removeClass(x.cl.uiCellHighlighted),t},sheetBarsRemove:function(e){return(e=E(e||x.obj.sheets())).find("tr."+x.cl.barTopParent).remove(),e.find("td."+x.cl.barLeft).remove(),e},labelUpdate:function(e,t){(t||(e=jSE.parseCellName(e.col,e.row)))&&x.obj.label().text(e)},cellEdit:function(e,t){var r,n,o;e.is(x.cellLast.td)||(x.autoFillerNotGroup=!0,x.evt.cellEditDone(),r=x.getTdLocation(e),x.spreadsheets[x.i]&&x.spreadsheets[x.i][r.row]&&x.spreadsheets[x.i][r.row][r.col]&&(n=x.spreadsheets[x.i][r.row][r.col],x.trigger("sheetCellEdit",[n]),x.followMe(e),x.labelUpdate(r),o=n.formula?"="+n.formula:n.value,x.obj.formula().val(o).blur(),x.cellSetActive(e,r,t)))},cellSetActive:function(e,n,t,o,r){if(n.col!=b){var l,a,i;switch(x.cellLast.td=e,x.cellLast.row=x.rowLast=n.row,x.cellLast.col=x.colLast=n.col,x.themeRoller.bar.clearActive(),x.themeRoller.cell.clearHighlighted(),x.highlightedLast.td=e,x.themeRoller.cell.setHighlighted(e),x.themeRoller.bar.setActive("left",x.cellLast.row),x.themeRoller.bar.setActive("top",x.cellLast.col),x.highlightedLast.rowStart=n.row,x.highlightedLast.colStart=n.col,x.highlightedLast.rowLast=n.row,x.highlightedLast.colLast=n.col,v.cellSelectModel){case"excel":case"gdrive":l=function(){},a=x.themeRoller.cell.clearHighlighted;break;case"oo":l=function(e){var t=E(e);x.isTd(t)&&x.cellEdit(t)},a=function(){}}t&&(i=n,x.obj.pane().mousemove(function(e){if(x.isBusy())return!1;var t=x.getTdLocation(e.target);if(t.col<1||t.row<1)return!1;var r=!0;o&&(r=!1,n.col!=t.col&&n.row!=t.row||(r=!0)),i.col==t.col&&i.row==t.row||!r||(a(),x.highlightedLast.colEnd=t.col,x.highlightedLast.rowEnd=t.row,l(e.target),x.highlightedLast.td=x.cycleCellsAndMaintainPoint(x.themeRoller.cell.setHighlighted,n,t)),i=t}),c.one("mouseup",function(){x.obj.pane().unbind("mousemove").unbind("mouseup"),E.isFunction(r)&&r()}))}},colLast:0,rowLast:0,cellLast:{td:E([]),row:0,col:0,isEdit:!1},highlightedLast:{td:E([]),rowStart:0,colStart:0,rowEnd:0,colEnd:0},cellStyleToggle:function(e,t){x.setDirty(!0);var r=x.obj.cellHighlighted();return t&&r.removeClass(t),r.hasClass(e)?r.removeClass(e):r.addClass(e),!1},fontReSize:function(e){var n=0;switch(e){case"up":n=1;break;case"down":n=-1}x.obj.cellHighlighted().each(function(e){cell=E(this);var t=(cell.css("font-size")+"").replace("px",""),r=parseInt(t||10)+n;cell.css("font-size",r+"px")})},callStack:0,updateCellValue:function(e,t,r){if(!x.spreadsheets[e])return v.error({error:x.msg.notFoundSheet});if(!x.spreadsheets[e][t])return v.error({error:x.msg.notFoundRow});if(!x.spreadsheets[e][t][r])return v.error({error:x.msg.notFoundColumn});var n,o,l=x.spreadsheets[e][t][r];switch(l.oldValue=l.value,l.result&&delete l.result,l.state){case"updating":return v.error({error:x.msg.loopDetected});case"updatingDependencies":return l.valueOverride||l.value}if(l.defer)return this.updateCellValue(l.defer.sheet,l.defer.row,l.defer.col);if(l.state="updating",l.html=[],l.fnCount=0,l.result=null,l.calcLast!=x.calcLast||l.calcDependenciesLast!=x.calcDependenciesLast)if(l.valueOverride=null,l.calcLast=x.calcLast,l.calcDependenciesLast=x.calcDependenciesLast,l.calcCount++,l.formula){try{"="==l.formula.charAt(0)&&(l.formula=l.formula.substring(1)),o=x.callStack?(l.formulaParser||(l.formulaParser=new x.formulaParser),l.formulaParser):x.FormulaParser,x.callStack++,o.lexer.obj={type:"cell",sheet:e,row:t,col:r,obj:l,s:v,editable:v.editable,jS:x,error:v.error},o.lexer.handler=x.cellHandler,l.result=o.parse(l.formula)}catch(e){l.result=e.toString(),x.alertFormulaError(l.value)}x.callStack--,l=x.filterValue(l,e,t,r)}else(n=x.s.cellStartingHandlers[l.value.charAt(0)])?n.apply(l,[l.value]):l=x.filterValue(l,e,t,r);return l.state=null,l.valueOverride||l.value},updateCellDependencies:function(e,t,r){var n=x.spreadsheets[e][t][r];if(!n.state){n.state="updatingDependencies";var o=E.extend({},n.dependencies);for(var l in n.dependencies=[],o){var a=o[l],i=x.getTdLocation(a.td);x.updateCellValue(a.sheet,i.row,i.col),i.row&&i.col&&x.updateCellDependencies(a.sheet,i.row,i.col)}n.state=null}},filterValue:function(e,t,r,n){return(e=e||{}).result!=b?(e.value=e.result,x.getTd(t,r,n).html(0<e.html.length?e.html:v.encode(e.value))):0<e.html.length?x.getTd(t,r,n).html(e.html):x.getTd(t,r,n).html(v.encode(e.value)),e},cellHandler:{variable:function(){if(arguments.length){var e=arguments[0],t=arguments[1];switch(e.toLowerCase()){case"true":return jFN.TRUE();case"false":return jFN.FALSE()}return x.s.formulaVariables[e]&&!t?x.s.formulaVariables[e]:x.s.formulaVariables[e]&&t?x.s.formulaVariables[e][t]:""}},time:function(e,t){return times.fromString(e,t)},concatenate:function(){return x.spreadsheets[this.sheet][this.row][this.col].html=[],jFN.CONCATENATE.apply(this,arguments).value},cellValue:function(e){var t=jSE.parseLocation(e);return x.cellHandler.createDependency.apply(this,[this.sheet,t]),x.updateCellValue(this.sheet,t.row,t.col)},createDependency:function(e,t){x.spreadsheets[e]&&x.spreadsheets[e][t.row]&&x.spreadsheets[e][t.row][t.col]&&x.spreadsheets[this.sheet]&&x.spreadsheets[this.sheet][this.row]&&x.spreadsheets[this.sheet][this.row][this.col]&&(x.spreadsheets[e][t.row][t.col].dependencies||(x.spreadsheets[e][t.row][t.col].dependencies={}),x.spreadsheets[e][t.row][t.col].dependencies[this.sheet+"_"+this.row+"_"+this.col]=x.spreadsheets[this.sheet][this.row][this.col])},cellRangeValue:function(e,t){e=jSE.parseLocation(e),t=jSE.parseLocation(t);for(var r=[],n=e.row;n<=t.row;n++)for(var o=e.col;o<=t.col;o++)x.cellHandler.createDependency.apply(this,[this.sheet,{row:n,col:o}]),r.push(x.updateCellValue(this.sheet,n,o));return[r]},fixedCellValue:function(e){return e=e.replace(/\$/g,""),x.cellHandler.cellValue.apply(this,[e])},fixedCellRangeValue:function(e,t){return e=e.replace(/\$/g,""),t=t.replace(/\$/g,""),x.cellHandler.cellRangeValue.apply(this,[e,t])},remoteCellValue:function(e,t){var r=jSE.parseLocation(t);return e=jSE.parseSheetLocation(e),x.cellHandler.createDependency.apply(this,[e,r]),x.updateCellValue(e,r.row,r.col)},remoteCellRangeValue:function(e,t,r){e=jSE.parseSheetLocation(e),t=jSE.parseLocation(t),r=jSE.parseLocation(r);for(var n=[],o=t.row;o<=r.row;o++)for(var l=t.col;l<=r.col;l++)n.push(x.updateCellValue(e,o,l));return[n]},callFunction:function(e,t,r){if(e=e.toUpperCase(),t=t?E.isArray(t)?t.reverse():[t]:[""],E.sheet.fn[e]){x.spreadsheets[r.sheet][r.row][r.col].fnCount++;var n=[],o=[];for(i in t)t[i]&&(t[i].value||t[i].html?(n.push(t[i].value),o.push(t[i].html)):(n.push(t[i]),o.push(t[i])));r.html=o;var l=E.sheet.fn[e].apply(r,n);return null!=l&&(l.html!=b&&(x.spreadsheets[r.sheet][r.row][r.col].html=l.html),l.value!=b)?l.value:l}return v.error({error:"Function "+e+" Not Found"})}},cellLookupHandlers:{fixedCellValue:function(e){return[x.sheet,jSE.parseLocation(e),jSE.parseLocation(e)]},fixedCellRangeValue:function(e,t,r){return[jSE.parseSheetLocation(e),jSE.parseLocation(t),jSE.parseLocation(r)]},cellValue:function(e){},cellRangeValue:function(e,t,r){return[x.sheet,jSE.parseLocation(t),jSE.parseLocation(r)]},remoteCellValue:function(e,t){return[x.sheet,jSE.parseLocation(t),jSE.parseLocation(t)]},remoteCellRangeValue:function(e,t,r){return[jSE.parseSheetLocation(e),jSE.parseLocation(t),jSE.parseLocation(r)]},callFunction:function(){if("VLOOKUP"==arguments[0]||"HLOOKUP"==arguments[0]&&arguments[1])return arguments[1].reverse()[1]}},cellLookup:function(){var e=new x.formulaParser;e.lexer.obj=this.obj,e.lexer.handler=E.extend(e.lexer.handler,x.cellLookupHandlers);for(var t=e.parse(this.obj.formula),r=[],n=t[1].row;n<=t[2].row;n++)for(var o=t[1].col;o<=t[2].col;o++)r.push({sheet:t[0],row:n,col:o});return r},alertFormulaError:function(t){alert("cell:"+row+" ;"+col+'\nvalue: "'+cell.formula+'"\nerror: \n'+e)},calcLast:0,calcDependenciesLast:0,calc:function(e){e=e||x.i,x.readOnly[e]||!1===x.isChanged()||(x.log("Calculation Started"),x.calcLast=new Date,jSE.calc(e,x.spreadsheetsToArray()[e],x.updateCellValue),x.trigger("sheetCalculation",[{which:"speadsheet"}]),x.setChanged(!1),x.log("Calculation Ended"))},calcDependencies:function(e,t,r,n,o){n=n||new Date,x.calcDependenciesLast=n,o||x.cellUndoable.add(n,e,t,r),x.trigger("sheetPreCalculation",[{which:"cell",sheet:e,row:t,cell:r}]),x.setDirty(!0),x.setChanged(!0),x.updateCellValue(e,t,r),x.updateCellDependencies(e,t,r),x.trigger("sheetCalculation",[{which:"cell",sheet:e,row:t,cell:r}]),o||x.cellUndoable.add(n,e,t,r,!0)},addSheet:function(e){e||(e=(e=prompt(x.msg.newSheet)).toLowerCase().split("x"),e={cols:+E.trim(e[0]),rows:+E.trim(e[1])}),e&&(x.evt.cellEditAbandon(),x.setDirty(!0),x.controlFactory.sheetUI(E.sheet.makeTable.fromSize(e),x.sheetCount+1),x.setActiveSheet(x.sheetCount),x.sheetSyncSize(),x.obj.pane().trigger("resizeScroll"),x.trigger("sheetAdd",[x.i]))},deleteSheet:function(e){var t=e||x.i;x.obj.barHelper().remove(),x.obj.pane().remove(),x.obj.tabContainer().children().eq(x.i).remove(),x.spreadsheets[t]=null,x.i=0,x.sheetCount--,x.setActiveSheet(x.i),x.setDirty(!0),x.setChanged(!0),x.trigger("sheetDelete",[t])},deleteRow:function(e){x.getTd(x.i,x.rowLast,1).parent().remove(),x.controls.bar.y.td[x.i].splice(x.rowLast,1),x.spreadsheets[x.i].splice(x.rowLast,1),x.refreshRowLabels(x.rowLast),x.setChanged(!0),x.offsetFormulas({row:x.rowLast,col:0},{row:-1,col:0}),x.setDirty(!0),x.evt.cellEditAbandon(),x.obj.pane().trigger("resizeScroll"),x.trigger("sheetDeleteRow",x.rowLast)},deleteColumn:function(e){if(!(x.colLast<1)){x.obj.barHelper().remove();for(var t=x.obj.sheet(),r=x.sheetSize(t),n=1;n<=r.rows;n++)x.getTd(x.i,n,x.colLast).remove();for(var o in x.obj.barTop(x.colLast).remove(),x.controls.bar.x.td[x.i].splice(x.colLast,1),x.spreadsheets[x.i])x.spreadsheets[x.i][o].splice(x.colLast,1);E(x.col(t,x.colLast)).remove(),x.refreshColumnLabels(x.colLast),x.setChanged(!0),x.offsetFormulas({row:0,col:x.colLast},{row:0,col:-1}),x.setDirty(!0),x.evt.cellEditAbandon(),x.obj.pane().trigger("resizeScroll"),x.trigger("sheetDeleteColumn",x.colLast)}},sheetTab:function(e){var t,r="";return e?r=(r=x.obj.sheet().attr("title"))||x.msg.sheetTitleDefault.replace(/[{]index[}]/gi,x.i+1):x.isSheetEditable()&&v.editableNames&&((t=prompt(x.msg.newSheetTitle,x.sheetTab(!0)))?(x.setDirty(!0),x.obj.sheet().attr("title",t),x.obj.tab().html(t),r=t):t=(r=x.obj.sheet().attr("title"))||x.msg.sheetTitleDefault.replace(/[{]index[}]/gi,x.i+1)),E("<div />").text(r).html()},print:function(e){var t=window.open();t.document.write("<html><body><xmp>"+e+"\n</xmp></body></html>"),t.document.close()},viewSource:function(e){var t=x.tables(),t=x.sheetBarsRemove(t),r="";return e?E(t).each(function(){r+=x.HTMLtoPrettySource(this)}):r+=E("<div />").html(t).html(),x.print(r),!1},HTMLtoCompactSource:function(e){var t="";if(1==e.nodeType){t+="<"+e.tagName,0;for(var r,n=e.attributes.length,o=0;o<n;o++){var l=e.attributes[o].name,a=e.getAttribute(l);if(a){if("contentEditable"==l&&"inherit"==a)continue;"string"==typeof a?t+=" "+l+'="'+a.replace(/"/g,"'")+'"':"style"==l&&a.cssText&&(t+=' style="'+a.cssText+'"')}}"COL"==e.tagName?t+="/>":(t+=">",r="",E(e.childNodes).each(function(){r+=x.HTMLtoCompactSource(this)}),t+=r,t+="</"+e.tagName+">")}else 3==e.nodeType&&(t+=e.data.replace(/^\s*(.*)\s*$/g,"$1"));return t},HTMLtoPrettySource:function(e,t){t=t||"";var r="";if(1==e.nodeType){r+="\n"+t+"<"+e.tagName;for(var n=e.attributes.length,o=0;o<n;o++){var l=e.attributes[o].name,a=e.getAttribute(l);if(a){if("contentEditable"==l&&"inherit"==a)continue;"string"==typeof a?r+=" "+l+'="'+a.replace(/"/g,"'")+'"':"style"==l&&a.cssText&&(r+=' style="'+a.cssText+'"')}}if(e.childNodes.length<=0)r+="/>";else{r+=">";for(var i="",n=e.childNodes.length,o=0;o<n;o++)i+=x.HTMLtoPrettySource(e.childNodes[o],t+"  ");r+=i,0<=i.indexOf("\n")&&(r+="\n"+t),r+="</"+e.tagName+">"}}else 3==e.nodeType&&(r+=e.data.replace(/^\s*(.*)\s*$/g,"$1"));return r},followMe:function(e,t){if((e=e||x.obj.cellActive()).length){var r=x.obj.pane(),n=r.height(),o=r.width(),l=r.offset(),a=(l.top,l.top+n),i=(l.left,l.left+o),s=!0,c=0,u=0,d=0,h=e.offset(),f=e.width(),p=e.height(),g=(h.top,h.top+p),b=(h.left,h.left+f),v=e.parent(),m=E(x.rowTds()[x.getTdLocation(e).col]),w=0,y=0,S={up:!0,down:!0,left:!0,right:!0},j=x.scrolledTo();if(!(n<p||o<f)){for(x.setBusy(!0);1==s&&c<5;){var C,T=x.getTd(x.i,j.row.end+d,j.col.end+u),L=m.is(":hidden"),s=!1;if((C={up:v.is(":hidden"),down:a<g-w,left:L,right:i<b-y}).left?t?S.left=!1:(u--,s=!0,x.evt.scroll.scrollTo({axis:"x",value:j.col.end+u})):C.right&&(t?S.right=!1:(u++,s=!0)),C.up?t?S.up=!1:(d--,s=!0,x.evt.scroll.scrollTo({axis:"y",value:j.row.end+d})):C.down&&(t?S.down=!1:(d++,s=!0)),t)return x.setBusy(!1),S;w+=T.height(),y+=T.width(),c++}0<u&&(x.evt.scroll.scrollTo({axis:"x",value:j.col.end+1+u}),x.evt.scroll.stop()),0<d&&(x.evt.scroll.scrollTo({axis:"y",value:j.row.end+1+d}),x.evt.scroll.stop()),setTimeout(function(){x.setBusy(!1)},100),x.autoFillerGoToTd(e,p,f)}}},autoFillerGoToTd:function(e,t,r){var n;v.autoFiller&&(e=e||x.obj.cellActive(),t=t||e.height(),r=r||e.width(),x.isTd(e[0])&&e.is(":visible")?(n=e.position(),x.obj.autoFiller().show().css("top",n.top+(t||e.height())-3+"px").css("left",n.left+(r||e.width())-3+"px")):x.autoFillerHide())},autoFillerHide:function(){v.autoFiller&&x.obj.autoFiller().hide()},setActiveSheet:function(e){e=e||0,(0<x.cellLast.row||0<x.cellLast.col)&&(x.evt.cellEditDone(),x.obj.formula().val("")),x.obj.enclosures().hide(),x.i=e,x.obj.enclosure().show(),x.themeRoller.tab.setActive(),x.readOnly[e]=x.obj.sheet().hasClass("readonly"),x.obj.pane().trigger("resizeScroll")},openSheet:function(e){if(x.isDirty&&!confirm(x.msg.openSheet))return!1;x.setBusy(!0);var t=x.controlFactory.header(),r=x.controlFactory.ui(),n=x.controlFactory.tabContainer();return v.parent.append(t).append(r).append(n),e.each(function(e){x.controlFactory.sheetUI(E(this),e),x.calc(e),x.trigger("sheetOpened",[e])}),x.sheetSyncSize(),x.setActiveSheet(0),x.setDirty(!1),x.setBusy(!1),x.trigger("sheetAllOpened"),!0},newSheet:function(){var e=prompt(x.msg.newSheet);e&&x.openSheet(E.sheet.makeTable.fromSize(e))},importRow:function(t){x.controlFactory.addRow();var r="";x.obj.sheet().find("tr:last td").each(function(e){E(this).removeData("formula");try{"="==(t[e]+"").charAt(0)?E(this).data("formula",t[e]):E(this).html(t[e])}catch(e){r+=e+";\n"}}),r&&alert(r),x.calc()},importColumn:function(r){x.controlFactory.addColumn();var n="";x.obj.sheet().find("tr").each(function(e){var t=E(this).find("td:last");try{"="==(r[e]+"").charAt(0)?t.data("formula",r[e]):t.html(r[e])}catch(e){n+=e+";\n"}}),n&&alert(n),x.calc()},sheetSyncSize:function(){var e=v.height;e?e<200&&(e=200):e=400,v.parent.height(e).width(v.width);var t=v.width;e-=x.obj.header().outerHeight(),e-=x.obj.tabContainer().outerHeight()+x.s.boxModelCorrection,x.obj.panes().height(e-window.scrollBarSize.height-v.boxModelCorrection).width(t-window.scrollBarSize.width),x.obj.enclosures().height(e).width(t),x.obj.scrolls().height(e).width(t),x.obj.ui().height(e).width(t)},cellChangeStyle:function(e,t){x.setDirty(this),x.cellUndoable.add(x.obj.cellHighlighted()),x.obj.cellHighlighted().css(e,t),x.cellUndoable.add(x.obj.cellHighlighted(),!0)},cellFind:function(e){e=e||prompt(x.msg.cellFind);var t,r=x.obj.sheet().children("tbody").children("tr");e&&((t=r.children('td:contains("'+e+'")')).length<1&&(t=r.children('td:contains("'+e.toLowerCase()+'")')),t.length<1&&(t=r.children('td:contains("'+e.toUpperCase()+'")')),0<(t=t.eq(0)).length?x.cellEdit(t):alert(x.msg.cellNoFind))},cellSetActiveBar:function(e,t,r){var n=x.sheetSize(),o=Math.min(t,r),l=Math.max(t,r),a={},i={},s={},c={},u=E([]),d=x.scrolledTo();switch(e){case"top":a.start=1,a.end=n.rows,c.start=c.end=d.row.end,i.start=o,i.end=l,s.start=t,s.end=r;break;case"left":a.start=o,a.end=l,c.start=t,c.end=r,i.start=1,i.end=n.cols,s.start=s.end=d.col.end;break;case"corner":i.start=1,i.end=n.cols,a.start=1,a.end=n.rows}for(var h=a.start;h<=a.end;h++)for(var f=i.start;f<=i.end;f++)u=u.add(x.getTd(x.i,h,f));!function(){switch(v.cellSelectModel){case"oo":x.cellEdit(x.getTd(x.i,c.end,s.end));break;default:x.cellEdit(x.getTd(x.i,c.start,s.start))}}(),x.themeRoller.cell.clearHighlighted(),x.themeRoller.cell.setHighlighted(u),x.highlightedLast.td=u,x.highlightedLast.rowStart=a.start,x.highlightedLast.rowEnd=a.end,x.highlightedLast.colStart=i.start,x.highlightedLast.colEnd=i.end},getTdRange:function(e,a,i,t){x.cellLast.isEdit=!0;function r(e){var t,r=(t=e).first.col>t.last.col||t.first.row>t.last.row?{first:jSE.parseCellName(t.last.col,t.last.row),last:jSE.parseCellName(t.first.col,t.first.row)}:{first:jSE.parseCellName(t.first.col,t.first.row),last:jSE.parseCellName(t.last.col,t.last.row)},n=(n=a+"").match(/=/)?n:"="+n;!i&&"("==n.charAt(n.length-1)||(n=n+(i||"")+"(");var o="",l=r.first!=r.last?r.first+":"+r.last:r.first;return"("==n.charAt(n.length-1)&&(o=")"),n+l+o}var n="";if(!e){var o=x.obj.cellHighlighted().not(x.obj.cellActive());if(o.length){l={first:x.getTdLocation(o.first()),last:x.getTdLocation(o.last())},n=r(l);return t||(x.obj.formula().val(n),x.obj.inPlaceEdit().val(n)),n}return""}var l={first:x.getTdLocation([e.target])},s=x.obj.sheet().mousemove(function(e){l.last=x.getTdLocation([e.target]),n=r(l),t||(x.obj.formula().val(n),x.obj.inPlaceEdit().val(n))});c.one("mouseup",function(){return s.unbind("mousemove"),n})},getTd:function(e,t,r){return x.spreadsheets[e]&&x.spreadsheets[e][t]&&x.spreadsheets[e][t][r]&&x.spreadsheets[e][t][r].td?x.spreadsheets[e][t][r].td:E("<td />")},getTdLocation:function(e){var t={col:0,row:0};return!(e=e||"")&&!e[0]||(e=e[0]||e).cellIndex==b||e.parentNode==b||e.parentNode.rowIndex==b?t:{col:parseInt(e.cellIndex),row:parseInt(e.parentNode.rowIndex)}},getTdFromXY:function(e,t,r){var n=x.obj.pane(),o=n.offset();if(t+=o.top,e+=o.left,t>=o.top&&t<=o.top+n.height()&&e>=o.left&&e<=o.left+n.width()){var l=E.nearest({x:e,y:t},x.obj.sheet().children("tbody").children("tr").children("td"));return x.isTd(l)?l:!(!r||!x.isBar(l))&&l}return!1},getBarIndex:{left:function(e){return!(e=e||{}).parentNode||isNaN(e.parentNode.rowIndex)?-1:e.parentNode.rowIndex},top:function(e){return e=e||{},isNaN(e.cellIndex)?-1:e.cellIndex},corner:function(){return 0}},time:{now:new Date,last:new Date,diff:function(){return Math.abs(Math.ceil(this.last.getTime()-this.now.getTime())/1e3).toFixed(5)},set:function(){this.last=this.now,this.now=new Date},get:function(){return this.now.getHours()+":"+this.now.getMinutes()+":"+this.now.getSeconds()}},log:function(e){x.time.set(),console.log(x.time.get()+", "+x.time.diff()+"; "+e)},changed:[],isChanged:function(){return x.changed[x.i]},setChanged:function(e){x.changed[x.i]=e},isDirty:!1,setDirty:function(e){x.dirty=e},appendToFormula:function(e){var t=x.obj.formula(),r=t.val();"="!=r.charAt(0)&&(r="="+r),t.val(r+e)},cellUndoable:{stacks:[],undoOrRedo:function(e){if(this.stacks[x.i]){x.autoFillerHide();var t,r=this.stack();for(var n in e?r.moveBackward():r.moveForward(),t=r.getCells()){var o=t[n].td,l=x.getTdLocation(o);x.spreadsheets[x.i][l.row][l.col]=t[n],o.data("formula",t[n].formula).attr("style",t[n].style).addClass(t[n].cl),x.cellLast.td=E([]),x.calcDependencies(x.i,l.row,l.col,null,!0)}}},stack:function(){return this.stacks[x.i]||(this.stacks[x.i]={i:0,max:20,lasts:[],lastsCells:[],getCells:function(e){var t=e?E.inArray(e,this.lasts):this.i;return t<0&&(this.i=this.lasts.length,this.lasts.push(e),t=this.lasts.length-1,this.lastsCells[t]=[]),this.lastsCells[t]},cleanAhead:function(){this.lasts.splice(this.i+1,this.lasts.length-this.i),this.lastsCells.splice(this.i+1,this.lasts.length-this.i)},cleanBehind:function(){for(;this.lasts.length>this.max;)this.lasts.shift(),this.lastsCells.shift()},moveForward:function(){this.i+=1,this.i=Math.min(this.i,this.lasts.length-1)},moveBackward:function(){--this.i,this.i=Math.max(this.i,0)}}),this.stacks[x.i]},add:function(e,t,r,n,o){var l=this.stack(),a=l.getCells(e.valueOf()+(o?1:0));if(l.cleanAhead(),0<r&0<n){var i={},s=x.spreadsheets[t][r][n];for(var c in s)i[c]=s[c];i.style=s.td.attr("style"),i.cl=(s.td.attr("class")||"").replace(x.cl.uiCellActive,"").replace(x.cl.uiCellHighlighted,""),i.sheet=t}a.push(i),l.cleanBehind()}},cols:function(e){return(e=e||x.obj.sheet())[0]&&e[0].children&&e[0].children[0]&&e[0].children[0].children?e[0].children[0].children:[]},tables:function(e){return(e=(e=e||x.obj.sheets()).clone()).find("."+x.cl.barTopParent).remove(),e.find("."+x.cl.barLeft).remove(),e.children("colgroup").children("col:first").remove(),e=x.sheetDecorateRemove(!1,e)},col:function(e,t){e=e||x.obj.sheet();var r=x.cols(e);return t===b&&(t=r.length-1),r[t]},rowTds:function(e,t){e=e||x.obj.sheet();var r=x.rows(e);return t==b&&(t=r.length-1),r[t]&&r[t].children?r[t].children:{}},rows:function(e){return(e=e||x.obj.sheet())[0]&&e[0].children&&e[0].children[1]&&e[0].children[1].children?e[0].children[1].children:{}},sheetSize:function(e){e=e||x.obj.sheet();var t=x.rowTds(e),r=x.getTdLocation(t[t.length-1]);return{cols:r.col,rows:r.row}},toggleState:function(e){var t;v.allowToggleState&&(t=e||x.tables().detach(),v.editable&&(x.evt.cellEditAbandon(),x.trigger("sheetSave",[t])),x.setDirty(!1),x.setChanged(!0),v.editable=!v.editable,x.kill(),v.parent.html(t).sheet(v),v=null)},setCellRef:function(e){var t=x.obj.cellActive(),r=x.getTdLocation(t),n=e||prompt(x.msg.setCellRef);n&&(x.s.formulaVariables[n]=x.updateCellValue(x.i,r.row,r.col))}};x.setBusy(!0),v.parent.data("sheetInstance",x),window.console||(window.console={log:function(){}}),window.scrollBarSize||(window.scrollBarSize=E.sheet.getScrollBarSize());function t(){}var o=E(window),c=E(document),u=E("body"),b=void 0;return x.formulaLexer=function(){},x.formulaLexer.prototype=formula.lexer,x.formulaParser=function(){this.lexer=new x.formulaLexer,this.yy={}},x.formulaParser.prototype=formula,x.FormulaParser=new x.formulaParser,v.origHtml=v.parent.children().detach(),v.parent.addClass(x.cl.parent),v.parent.unbind("sheetSwitch").bind("sheetSwitch",function(e,t,r){x.switchSheet(r)}).unbind("sheetRename").bind("sheetRename",function(e,t,r){x.renameSheet(r)}),v.width=v.width?v.width:v.parent.width(),v.height=v.height?v.height:v.parent.height(),v.log||(x.log=t),E.nearest||(x.nearest=t),x.resizableCells=x.resizableSheet=x.resizable,E.ui?(v.resizableCells||(x.resizableCells=t),v.resizableSheet||(x.resizableSheet=t)):x.resizable=x.draggable=t,E.support.boxModel||(v.boxModelCorrection=0),v.barMenus||(x.controlFactory.barMenuTop=x.controlFactory.barMenuLeft=t),v.freezableCells||(x.controlFactory.barHandleFreeze.top=x.controlFactory.barHandleFreeze.left=t),v.calcOff&&(x.calc=t),window.Raphael||(jSE.chart=t),o.resize(function(){x&&!x.isBusy()&&(v.width=v.parent.width(),v.height=v.parent.height(),x.sheetSyncSize())}),E.sheet.fn&&(E.sheet.fn=E.extend(E.sheet.fn,v.formulaFunctions),E.sheet.advancedfn&&(E.sheet.fn=E.extend(E.sheet.fn,E.sheet.advancedfn)),E.sheet.financefn&&(E.sheet.fn=E.extend(E.sheet.fn,E.sheet.financefn))),v.alertFormulaErrors||(x.alertFormulaError=t),v.title=v.title||v.parent.attr("title")||"",(x.s=v).origHtml.length&&x.openSheet(v.origHtml),x.setBusy(!1),x},makeTable:{fromSize:function(e){e=e||{rows:25,cols:10};var t=jQuery("<table />");td="<td></td>",tds="";for(var r=e.cols;1<=r;r--)tds+=td;for(var n='<tr style="height: 15px;">'+tds+"</tr>",o="",r=e.rows;1<=r;r--)o+=n;return t.html("<tbody>"+o+"</tbody>")}},killAll:function(){jQuery.sheet&&jQuery.sheet.instance&&(jQuery.sheet.instance.each(function(){this.kill&&this.kill()}),jQuery.sheet.instance=$([]))},scrollLocker:function(n){jQuery.sheet.instance[n].obj.scrolls().each(function(t){var r=this;$(this).bind("scroll",function(){jQuery.sheet.instance.each(function(e){e!=n&&this.controls.scroll[t].scrollLeft(r.scrollLeft).scrollTop(r.scrollTop)})})})},switchSheetLocker:function(e){jQuery.sheet.instance.each(function(){this.s.parent.bind("switch",function(e,t,r){jQuery.sheet.instance.each(function(){this.setActiveSheet(r)})})})},I:function(){var e=0;return this.instance?e=0===this.instance.length?0:this.instance.length-1:this.instance=[],e},getScrollBarSize:function(){var e=$("<p></p>").css({width:"100%",height:"100%"}),t=$("<div></div>").css({position:"absolute",width:"100px",height:"100px",top:"0",left:"0",visibility:"hidden",overflow:"hidden"}).append(e);jQuery(document.body).append(t);var r=e.width(),n=e.height();t.css("overflow","scroll");var o=e.width(),l=e.height();return r==o&&t[0].clientWidth&&(o=t[0].clientWidth),n==l&&t[0].clientHeight&&(l=t[0].clientHeight),t.detach(),{width:r-o,height:n-l}},debugPositionBox:function(e,t,r,n,o){if(n=n||"#"+Math.floor(16777215*Math.random()).toString(16),r){var l=jQuery([]);return l=(l=(l=(l=l.add(this.debugPositionBox(r.left,r.top,null,n,"top-left"))).add(this.debugPositionBox(r.right,r.top,null,n,"top-right"))).add(this.debugPositionBox(r.left,r.bottom,null,n,"bottom-left"))).add(this.debugPositionBox(r.right,r.bottom,null,n,"bottom-right"))}return jQuery('<div style="width: 10px; height: 10px; position: absolute;"></div>').css("top",t-5+"px").css("left",e+5+"px").css("background-color",n).click(function(){console.log(o||"none")}).appendTo("body")}};var jSE=jQuery.sheet.engine={calc:function(e,t,r){for(var n=1;n<t.length;n++)for(var o=1;o<t[n].length;o++)r(e,n,o)},parseLocation:function(e){for(var t=0;t<e.length&&!(e.charCodeAt(t)<=57);t++);return{row:parseInt(e.substring(t)),col:jSE.columnLabelIndex(e.substring(0,t))}},parseSheetLocation:function(e){return(e+"").replace("SHEET","")-1},parseCellName:function(e,t){return jSE.columnLabelString(e)+(t||"")},columnLabels:"ABCDEFGHIJKLMNOPQRSTUVWXYZ",columnLabelIndex:function(e){for(var t=0,e=e.toUpperCase(),r=0;r<e.length;r++)t=26*t+this.columnLabels.indexOf(e[r]);return(0<=t?t:0)+1},columnIndexes:[],columnLabelString:function(e){if(!this.columnIndexes.length)for(var t,r,n="",o=t=r=-1,l=1;l<16385;++l)n="",26==++r&&(r=0,26==++t&&(t=0,++o)),0<=o&&(n+=this.columnLabels[o]),0<=t&&(n+=this.columnLabels[t]),0<=r&&(n+=this.columnLabels[r]),this.columnIndexes[l]=n;return this.columnIndexes[e]||""},regEx:{n:/[\$,\s]/g,cell:/\$?([a-zA-Z]+)\$?([0-9]+)/gi,range:/\$?([a-zA-Z]+)\$?([0-9]+):\$?([a-zA-Z]+)\$?([0-9]+)/gi,remoteCell:/\$?(SHEET+)\$?([0-9]+)[:!]\$?([a-zA-Z]+)\$?([0-9]+)/gi,remoteCellRange:/\$?(SHEET+)\$?([0-9]+)[:!]\$?([a-zA-Z]+)\$?([0-9]+):\$?([a-zA-Z]+)\$?([0-9]+)/gi,sheet:/SHEET/i,amp:/&/g,gt:/</g,lt:/>/g,nbsp:/&nbsp;/g},chart:function(n){var e=this.jS;function t(e,t){return e=e?t?arrHelpers.toNumbers(e):arrHelpers.flatten(e):t?0:""}return n=jQuery.extend({x:{legend:"",data:[0]},y:{legend:"",data:[0]},title:"",data:[0],legend:"",td:e.getTd(this.sheet,this.row,this.col),chart:jQuery('<div class="'+e.cl.chart+'" />').mousedown(function(){n.td.mousedown()}),gR:{}},n),e.controls.chart[e.i]=e.obj.chart().add(n.chart),n.data=t(n.data,!0),n.x.data=t(n.x.data,!0),n.y.data=t(n.y.data,!0),n.legend=t(n.legend),n.x.legend=t(n.x.legend),n.y.legend=t(n.y.legend),n.legend=n.legend?n.legend:n.data,this.s.parent.one("sheetCalculation",function(){var e=n.chart.width(),t=n.chart.height(),r=Raphael(n.chart[0]);switch(n.title&&r.text(e/2,10,n.title).attr({"font-size":20}),n.type){case"bar":n.gR=r.barchart(e/8,t/8,.8*e,.8*t,n.data,n.legend).hover(function(){this.flag=r.popup(this.bar.x,this.bar.y,this.bar.value||"0").insertBefore(this)},function(){this.flag.animate({opacity:0},300,function(){this.remove()})});break;case"hbar":n.gR=r.hbarchart(e/8,t/8,.8*e,.8*t,n.data,n.legend).hover(function(){this.flag=r.popup(this.bar.x,this.bar.y,this.bar.value||"0").insertBefore(this)},function(){this.flag.animate({opacity:0},300,function(){this.remove()})});break;case"line":n.gR=r.linechart(e/8,t/8,.8*e,.8*t,n.x.data,n.y.data,{nostroke:!1,axis:"0 0 1 1",symbol:"circle",smooth:!0}).hoverColumn(function(){if(this.tags=r.set(),this.symbols.length)for(var e=0,t=this.y.length;e<t;e++)this.tags.push(r.tag(this.x,this.y[e],this.values[e],160,10).insertBefore(this).attr([{fill:"#fff"},{fill:this.symbols[e].attr("fill")}]))},function(){this.tags&&this.tags.remove()});break;case"pie":n.gR=r.piechart(e/2,t/2,(e<t?e:t)/2,n.data,{legend:n.legend}).hover(function(){this.sector.stop(),this.sector.scale(1.1,1.1,this.cx,this.cy),this.label&&(this.label[0].stop(),this.label[0].attr({r:7.5}),this.label[1].attr({"font-weight":800}))},function(){this.sector.animate({transform:"s1 1 "+this.cx+" "+this.cy},500,"bounce"),this.label&&(this.label[0].animate({r:5},500,"bounce"),this.label[1].attr({"font-weight":400}))});break;case"dot":n.gR=r.dotchart(e/8,t/8,.8*e,.8*t,n.x.data,n.y.data,n.data,{symbol:"o",max:10,heat:!0,axis:"0 0 1 1",axisxstep:n.x.data.length-1,axisystep:n.y.data.length-1,axisxlabels:n.x.legend?n.x.legend:n.x.data,axisylabels:n.y.legend?n.y.legend:n.y.data,axisxtype:" ",axisytype:" "}).hover(function(){this.marker=this.marker||r.tag(this.x,this.y,this.value,0,this.r+2).insertBefore(this),this.marker.show()},function(){this.marker&&this.marker.hide()})}n.gR.mousedown(function(){n.td.mousedown().mouseup()}),n.chart.mousemove(function(){return n.td.mousemove(),!1})}),n.chart}},jFN=jQuery.sheet.fn={ISNUMBER:function(e){return isNaN(e)?jFN.FALSE():jFN.TRUE()},N:function(e){return null==e?0:e instanceof Date?e.getTime():("object"==typeof e&&(e=e.toString()),"string"==typeof e&&(e=parseFloat(e.replace(jSE.regEx.n,""))),isNaN(e)?0:"number"==typeof e?e:1==e?1:0)},VERSION:function(){return this.jS.version},ABS:function(e){return Math.abs(jFN.N(e))},CEILING:function(e,t){return t=t||1,parseInt(e/t)*t+t},EVEN:function(e){return(e=Math.round(e))%2==0||(0<e?e++:e--),e},EXP:function(e){return Math.exp(e)},FLOOR:function(e,t){return t=t||1,e<0&&0<t||0<e&&t<0?{value:0,html:"#NUM"}:0<=e?Math.floor(e/t)*t:Math.ceil(e/t)*t},INT:function(e){return Math.floor(jFN.N(e))},LN:function(e){return Math.log(e)},LOG:function(e,t){return t=t||10,Math.log(e)/Math.log(t)},LOG10:function(e){return jFN.LOG(e)},MOD:function(e,t){var r=e%t;return t<0&&(r*=-1),r},ODD:function(e){var t=!1;0<e?(e=Math.floor(Math.round(e)),t=!0):e=Math.ceil(e);var r=Math.abs(e);return r%2==0&&r++,t?r:-r},PI:function(){return Math.PI},POWER:function(e,t){return Math.pow(e,t)},SQRT:function(e){return Math.sqrt(e)},RAND:function(){return Math.random()},RND:function(){return Math.random()},ROUND:function(e,t){return jFN.FIXED(e,t||0,!1)},ROUNDDOWN:function(e,t){var r=e<0;return e=Math.abs(e),t=t||0,e=Math.floor(e*Math.pow(10,t))/Math.pow(10,t),r?-e:e},ROUNDUP:function(e,t){var r=e<0;return e=Math.abs(e),t=t||0,e=Math.ceil(e*Math.pow(10,t))/Math.pow(10,t),r?-e:e},SUM:function(){var e=0,t=arrHelpers.toNumbers(arguments);for(i in t)e+=+t[i];return e},TRUNC:function(e,t){return e+="",0==(t=t||0)?e.split(".").shift():(e.match(".")&&(1==t?e=e.substr(0,e.length-1):-1==t&&(e=(e=e.split(".").shift()).substr(0,e.length-1)+"0")),e)},AVERAGE:function(e){return jFN.SUM(arguments)/jFN.COUNT(arguments)},AVG:function(e){return jFN.AVERAGE(e)},COUNT:function(){var e=0,t=arrHelpers.toNumbers(arguments);for(i in t)null!=t[i]&&e++;return e},COUNTA:function(){var e=0,t=arrHelpers.flatten(arguments);for(i in t)t[i]&&e++;return e},MAX:function(){var e=arrHelpers.toNumbers(arguments),t=e[0];for(i in e)t=e[i]>t?e[i]:t;return t},MIN:function(){var e=arrHelpers.toNumbers(arguments),t=e[0];for(i in e)t=e[i]<t?e[i]:t;return t},ASC:function(e){return e.charCodeAt(0)},CHAR:function(e){return String.fromCharCode(e)},CLEAN:function(e){var t=new RegExp("[cGcLcJcMcIcK\f\n\r\t\v]","g");return e.replace(t,"")},CODE:function(e){return jFN.ASC(e)},CONCATENATE:function(){var t=arrHelpers.flatten(arguments),r="";return jQuery.each(t,function(e){r+=t[e]}),{value:r,html:r}},DOLLAR:function(e,t,r){t=t||2,r=r||"$";var n=jFN.FIXED(e,t,!1),o=0<=e?r+n:"-"+r+n.slice(1);return{value:e,html:o}},FIXED:function(e,t,r){return t=t||2,Globalize.format(e,"n"+t)},LEFT:function(e,t){return t=t||1,e.substring(0,t)},LEN:function(e){return e?e.length:0},LOWER:function(e){return e.toLowerCase()},MID:function(e,t,r){return e&&t&&r?e.substring(t-1,r+t-1):this.error({error:"ERROR"})},REPLACE:function(e,t,r,n){if(!(e&&t&&r&&n))return this.error({error:"ERROR"});var o=e.split("");return o.splice(t-1,r),o.splice(t-1,0,n),o.join("")},REPT:function(e,t){for(var r="",n=0;n<t;n++)r+=e;return r},RIGHT:function(e,t){return t=t||1,e.substring(e.length-t,e.length)},SEARCH:function(e,t,r){(r=r||0)&&((t=t.split("")).splice(0,r-1),t=t.join(""));var n=t.search(e);return n<0?this.error({error:"#VALUE!"}):r+(r?0:1)+n},SUBSTITUTE:function(e,t,l,a){a=a||0,t=new RegExp(t,"g");var i=1;return e=e.replace(t,function(e,t,r,n){var o=!a||a<=i?l:e;return i++,o})},TEXT:function(){return this.error({error:"Not Yet Implemented"})},UPPER:function(e){return e.toUpperCase()},VALUE:function(e){return jQuery.isNumeric(e)?+e:this.error({error:"#VALUE!"})},NOW:function(){var e=new Date;return{value:e,html:dates.toString(e)}},TODAY:function(){var e=new Date;return{value:dates.toCentury(e)-1,html:dates.toString(e,"d")}},WEEKENDING:function(e){var t=new Date;return{value:t=new Date(t.getFullYear(),t.getMonth(),t.getDate()+5-t.getDay()-7*(e||0)),html:dates.toString(t,"d")}},WEEKDAY:function(e,t){var r=(e=dates.get(e)).getDay();switch(t=t||1){case 3:switch(r){case 0:return 7;case 1:return 1;case 2:return 2;case 3:return 3;case 4:return 4;case 5:return 5;case 6:return 6}break;case 2:switch(r){case 0:return 6;case 1:return 0;case 2:return 1;case 3:return 2;case 4:return 3;case 5:return 4;case 6:return 5}break;case 1:r++}return r},WEEKNUM:function(e){return e=dates.get(e),dates.week(e)+1},YEAR:function(e){return(e=dates.get(e)).getFullYear()},DAYSFROM:function(e,t,r){return Math.floor((new Date-new Date(e,t-1,r))/dates.dayDiv)},DAYS:function(e,t){var r=dates.get(e),n=dates.get(t);return Math.round(Math.abs(r.getTime()-n.getTime())/864e5)},DAY:function(e){return(e=dates.get(e)).getDate()},DAYS360:function(e,t,r){e=dates.get(e),t=dates.get(t);var n=e.getDate(),o=t.getDate(),l=dates.isLastDayOfMonth(e),a=dates.isLastDayOfMonth(t),i=dates.diffMonths(e,t);return r?(n=Math.min(n,30),o=Math.min(o,30)):(l&&(n=30),a&&(o=n<30?(i++,1):30)),30*i+(o-n)},DATE:function(e,t,r){var n=new Date(e,t-1,r);return{html:dates.toString(n,"d"),value:dates.toCentury(n)}},DATEVALUE:function(e){return e=dates.get(e),{html:dates.toString(e,"d"),value:dates.toCentury(e)}},EDATE:function(e,t){return(e=dates.get(e)).setMonth(e.getMonth()+t),{html:dates.toString(e,"d"),value:dates.toCentury(e)}},EOMONTH:function(e,t){return(e=dates.get(e)).setMonth(e.getMonth()+t+1),e=new Date(e.getFullYear(),e.getMonth(),0),{html:dates.toString(e,"d"),value:dates.toCentury(e)}},HOUR:function(e){return times.fromMath(e).hour},MINUTE:function(e){return times.fromMath(e).minute},MONTH:function(e){return(e=dates.get(e)).getMonth()+1},SECOND:function(e){return times.fromMath(e).second},TIME:function(e,t,r){var n,o;new Date;return t=t||0,e=e||0,(r=r||0)&&60<r&&(r-=60*(n=+(r/60+"").split(".")[0]),t+=n),t&&60<t&&(t-=60*(o=+(t/60+"").split(".")[0]),e+=o),(60*e*60*1e3+60*t*1e3+1e3*r)/dates.dayDiv},TIMEVALUE:function(e){return isNaN(e)?/([0]?[1-9]|1[0-2])[:][0-5][0-9]([:][0-5][0-9])?[ ]?(AM|am|aM|Am|PM|pm|pM|Pm)/.test(e)?times.fromString(e,!0):/([0]?[0-9]|1[0-9]|2[0-3])[:][0-5][0-9]([:][0-5][0-9])?/.test(e)?times.fromString(e):0:e},WORKDAY:function(e,t,r){var n,o={1:!0,2:!0,3:!0,4:!0,5:!0},e=dates.get(e),t=t&&!isNaN(t)?t:0,l=0,a=new Date,a=e;for(r=r?(jQuery.isArray(r)||(r=[r]),r=arrHelpers.flatten(r),n={},jQuery.each(r,function(e){r[e]&&(n[dates.toString(dates.get(r[e]),"d")]=!0)}),n):{};l<t;)o[(a=new Date(a.setDate(a.getDate()+1))).getDay()]&&(r[dates.toString(a,"d")]||l++),0;return{html:dates.toString(a,"d"),value:dates.toCentury(a)}},YEARFRAC:function(e,t,r){return e=dates.get(e),t=dates.get(t),e&&t?(r=r||0,dates.diff(e,t,r)/dates.calcAnnualBasis(e,t,r)):this.error({error:"#VALUE!"})},AND:function(){var t,r=arguments;return jQuery.each(r,function(e){!0!==r[e]&&null==t&&(t=jFN.FALSE())}),t=t||jFN.TRUE()},FALSE:function(){return{value:!1,html:"FALSE"}},IF:function(e,t,r){var n,o=e?(n=t,this.html[1]):(n=r,this.html[2]);return{value:n,html:o}},NOT:function(e){return e?jFN.FALSE():jFN.TRUE()},OR:function(){var t,r=arguments;return jQuery.each(r,function(e){!0===r[e]&&null==t&&(t=jFN.TRUE())}),t=t||jFN.FALSE()},TRUE:function(){return{value:!0,html:"TRUE"}},IMG:function(e){return{html:jQuery("<img />").attr("src",e)}},GETHTML:function(){return this.html[0]},TRIM:function(e){return"string"==typeof e&&(e=jQuery.trim(e)),e},HYPERLINK:function(e,t){return t=t||"LINK",{html:jQuery('<a href="'+e+'" target="_new">'+t+"</a>")}},DROPDOWN:function(){var e=this.obj,t=this.jS,r=arrHelpers.flatten(arguments),n=t.getTdLocation(e.td),r=arrHelpers.unique(r);if(this.s.editable){for(var o="dropdown"+this.sheet+"_"+n.row+"_"+n.col+"_"+this.jS.I,l=jQuery('<select style="width: 100%;" name="'+o+'" id="'+o+'" />').mousedown(function(){t.cellEdit(jQuery(this).parent(),null,!0)}).change(function(){e.value=jQuery(this).val(),t.calcDependencies(e.sheet,n.row,n.col)}),a=0;a<(r.length<=50?r.length:50);a++)r[a]&&l.append('<option value="'+r[a]+'">'+r[a]+"</option>");0==t.getTd(this.sheet,this.row,this.col).find("#"+o).length&&(e.value=t.spreadsheets[this.sheet][this.row][this.col].value),l.val(e.value)}return{value:e.value,html:l}},RADIO:function(){var e=this.obj,t=this.jS,r=arrHelpers.flatten(arguments),n=t.getTdLocation(e.td),r=arrHelpers.unique(r);if(this.s.editable){for(var o,l="radio"+this.sheet+"_"+n.row+"_"+n.col+"_"+this.jS.I,a=jQuery("<span />").mousedown(function(){t.cellEdit(jQuery(this).parent())}),i=0;i<(r.length<=25?r.length:25);i++){r[i]&&(o=jQuery('<input type="radio" name="'+l+'" class="'+l+'" />').val(r[i]).change(function(){e.value=jQuery(this).val(),t.calcDependencies(e.sheet,n.row,n.col)}),r[i]==e.value&&o.attr("checked","true"),a.append(o).append("<span>"+r[i]+"</span>").append("<br />"))}0==t.getTd(this.sheet,this.row,this.col).find("."+l).length&&(e.value=t.spreadsheets[this.sheet][this.row][this.col].value)}return{value:e.value,html:a}},CHECKBOX:function(e){jQuery.isArray(e)&&(e=e[0]);var t,r,n,o,l,a=this.obj,i=this.jS,s=i.getTdLocation(a.td);return this.s.editable&&(t="checkbox"+this.sheet+"_"+s.row+"_"+s.col+"_"+this.jS.I,r=jQuery('<input type="checkbox" name="'+t+'" class="'+t+'" />').val(e).change(function(){a.value=jQuery(this).is(":checked")?jQuery(this).val():"",i.calcDependencies(a.sheet,s.row,s.col)}),n=jQuery("<span />").append(r).append("<span>"+e+"</span><br />").mousedown(function(){i.cellEdit(jQuery(this).parent())}),e==a.value&&r.attr("checked",!0),(o=i.getTd(this.sheet,this.row,this.col)).children().length||o.html()==a.value&&r.attr("checked",!0),0==i.getTd(this.sheet,this.row,this.col).find("."+t).length&&(l=i.spreadsheets[this.sheet][this.row][this.col].value,a.value="true"==l||1==l?e:"")),{value:a.value,html:n}},BARCHART:function(e,t,r){return{value:"",html:jSE.chart.apply(this,[{type:"bar",data:e,legend:t,title:r}])}},HBARCHART:function(e,t,r){return{value:"",html:jSE.chart.apply(this,[{type:"hbar",data:e,legend:t,title:r}])}},LINECHART:function(e,t){return{value:"",html:jSE.chart.apply(this,[{type:"line",x:{data:e},y:{data:t},title:""}])}},PIECHART:function(e,t,r){return{value:"",html:jSE.chart.apply(this,[{type:"pie",data:e,legend:t,title:r}])}},DOTCHART:function(e,t,r,n,o,l){return{value:"",html:jSE.chart.apply(this,[{type:"dot",data:r||e,x:{data:e,legend:n},y:{data:t||e,legend:o||n},title:l}])}},CELLREF:function(e){return this.jS.spreadsheets[e]?this.jS.spreadsheets[e]:"Cell Reference Not Found"},CALCTIME:function(){var e=this;return this.s.parent.one("sheetCalculation",function(){e.jS.getTd(e.sheet,e.row,e.col).text(e.jS.time.diff())}),""},HLOOKUP:function(e,t,r,n){for(var o=this.jS.cellLookup.apply(this),l=0;l<t[0].length;l++)if(t[0][l]==e)return this.jS.updateCellValue(o[l].sheet,r-1,o[l].col);return n},VLOOKUP:function(e,t,r,n){for(var o=this.jS.cellLookup.apply(this),l=0;l<t[0].length;l++)if(t[0][l]==e)return this.jS.updateCellValue(o[l].sheet,o[l].row,r);return n},THISROWCELL:function(e){return isNaN(e)&&(e=jSE.columnLabelIndex(e)),this.jS.updateCellValue(this.sheet,this.row,e)},THISCOLCELL:function(e){return this.jS.updateCellValue(this.sheet,e,this.col)}},key={BACKSPACE:8,CAPS_LOCK:20,COMMA:188,CONTROL:17,ALT:18,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,INSERT:45,LEFT:37,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SHIFT:16,SPACE:32,TAB:9,UP:38,C:67,F:70,V:86,X:88,Y:89,Z:90},arrHelpers={toNumbers:function(e){for(i in e=this.flatten(e))e[i]?(e[i]=jQuery.trim(e[i]),isNaN(e[i])?e[i]=0:e[i]=+e[i]):e[i]=0;return e},unique:function(e){for(var t=[],r=e.length,n=0;n<r;n++){for(var o=n+1;o<r;o++)e[n]===e[o]&&(o=++n);t.push(e[n])}return t},flatten:function(e){for(var t=[],r=0,n=e.length;r<n;r++){var o=Object.prototype.toString.call(e[r]).split(" ").pop().split("]").shift().toLowerCase();o&&(t=t.concat(/^(array|collection|arguments|object)$/.test(o)?this.flatten(e[r]):e[r]))}return t},insertAt:function(e,t,r){return jQuery(t).each(function(){-1<r&&r<=e.length&&e.splice(r,0,this)}),e},closest:function(e,t,r){t=t||0;for(var n=(e=e||[])[r=r||0],o=Math.abs(t-n),l=r;l<e.length;l++){var a=Math.abs(t-e[l]);a<o&&(o=a,n=e[l])}return n}},dates={dayDiv:864e5,toCentury:function(e){return Math.round(Math.abs(new Date(1900,0,-1)-e)/this.dayDiv)},get:function(e){return e.getMonth?e:isNaN(e)?new Date(Globalize.parseDate(e)):(e*=this.dayDiv,e+=+new Date(1900,0,-1),e=new Date(e))},week:function(e){var t=new Date(e.getFullYear(),0,1);return Math.ceil(((e-t)/this.dayDiv+t.getDay()+1)/7)},toString:function(e,t){return t?Globalize.format(e,Globalize.culture().calendar.patterns[t]):Globalize.format(e)},diff:function(e,t,r){switch(r){case 0:return this.days360Nasd(e,t,0,!0);case 1:case 2:case 3:return Math.abs(t-e)/this.dayDiv;case 4:return this.days360Euro(e,t)}},diffMonths:function(e,t){var r=12*(t.getFullYear()-e.getFullYear());return r-=e.getMonth()+1,r+=t.getMonth()+1},days360:function(e,t,r,n,o,l){return 360*(t-e)+30*(n-r)+(l-o)},days360Nasd:function(e,t,r,n){var o=e.getDate(),l=e.getMonth(),a=e.getFullYear(),i=t.getDate(),s=t.getMonth(),c=t.getFullYear();return 2==s&&this.isEndOfMonth(i,s,c)&&(2==l&&this.isEndOfMonth(o,l,a)||3==r)&&(i=30),31==i&&(30<=o||3==r)&&(i=30),31==o&&(o=30),n&&2==l&&this.isEndOfMonth(o,l,a)&&(o=30),this.days360(a,c,l,s,o,i)},days360Euro:function(e,t){var r=e.getDate(),n=e.getMonth(),o=e.getFullYear(),l=t.getDate(),a=t.getMonth(),i=t.getFullYear();return 31==r&&(r=30),31==l&&(l=30),this.days360(o,i,n,a,r,l)},isEndOfMonth:function(e,t,r){return e==new Date(r,t+1,0,23,59,59).getDate()},isLeapYear:function(e){return 1==new Date(e,1,29).getMonth()},calcAnnualBasis:function(e,t,r){switch(r){case 0:case 2:case 4:return 360;case 3:return 365;case 1:var n,o=e.getDate(),l=e.getMonth(),a=e.getFullYear(),i=t.getDate(),s=t.getMonth(),c=t.getFullYear();if(a==c)n=this.isLeapYear(a)?366:365;else if(c-1==a&&(s<l||l==s&&i<=o))n=this.isLeapYear(a)?l<2||2==l&&o<=29?366:365:this.isLeapYear(c)&&(2<s||2==s&&29==i)?366:365;else{for(var u=a;u<=c;u++)this.isLeapYear(u)?n+=366:n+=365;n/=c-a+1}return n}},lastDayOfMonth:function(e){return e.setDate(0),e.getDate()},isLastDayOfMonth:function(e){return e.getDate()==this.lastDayOfMonth(e)}},times={fromMath:function(e){var t,r,n={};return n.hour=(24*e+"").split(".")[0],n.minute=(t=e,r=0,(t=((t=Math.round(24*t*100)/100)+"").split("."))[1]&&(t[1].length<2&&(t[1]+="0"),r=.6*t[1]),Math.round(r)),n.second=function(e){if((e=((e=Math.round(24*e*1e4)/1e4)+"").split("."))[1]){for(var t=0;t<4;t++)e[1].charAt(t)||(e[1]+="0");var r=(.006*e[1]+"").split(".");if(r[1])return r[1]&&2<r[1].length&&(r[1]=r[1].substr(0,2)),Math.round(.6*r[1])}return 0}(e),n},fromString:function(e,t){new Date;var r,n,o,l,a=e;return t&&(l=a.substr(-2).toLowerCase(),a=a.replace(/(am|pm)/i,"")),r=+(a=a.split(":"))[0],n=+a[1],o=+(a[2]?a[2]:0),t&&"pm"==l&&(r+=12),jFN.TIME(r,n,o)}},math={log10:function(e){return Math.log(e)/2.302585092994046},signum:function(e){return e/Math.abs(e)||e}};