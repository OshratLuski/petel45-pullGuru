{"version":3,"file":"dragdrop.min.js","sources":["../src/dragdrop.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * JavaScript code for the gapfill question type.\n *\n * @copyright  2020 Marcus Green\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nexport const init = (singleuse) => {\n  Window.singleuse = singleuse;\n  var draggables = document.querySelectorAll('span[class*=\"draggable\"]');\n  draggables.forEach(function(e) {\n    e.addEventListener('dragstart', dragStart);\n  });\n\n  document.querySelectorAll('span.droptarget').forEach(function(el) {\n    el.addEventListener(\"dblclick\", function() {\n      if (Window.singleuse) {\n        dragShow(this);\n      }\n      const dropTarget = this.classList.contains('droptarget') ? this : this.closest(\".droptarget\");\n      const parent = dropTarget.closest(\".droptarget-wrapper\");\n      const dropTargetInput = parent.querySelector(\"input\");\n      dropTargetInput.setAttribute('value', \"\");\n      dropTarget.dataset.contentValue = '';\n      dropTarget.innerHTML = '';\n    });\n\n    el.addEventListener(\"drop\", drop);\n    if (el.innerHTML.length > 0) {\n      const width = parseInt(el.offsetWidth);\n      const parentWidth = parseInt(el.closest('.droptarget-wrapper').offsetWidth);\n      if (width > parentWidth) {\n        el.closest('.droptarget-wrapper').style.width = width + 'px';\n      }\n    }\n  });\n\n  /**\n   *\n   * @param {*} that\n   */\n  function dragShow(that) {\n    const dropTarget = that.classList.contains('droptarget') ? that : that.closest(\".droptarget\");\n    const dropTargetInput = dropTarget.nextElementSibling;\n    var targetVal = dropTargetInput.value;\n\n    draggables.forEach(function(e) {\n\n      if (e.innerText.trim() === targetVal.trim()) {\n        e.classList.remove(\"hide\");\n      }\n    });\n  }\n\n  /**\n   * Stops strange things happening on ios drop event\n   * @param {*} e\n   */\n  document.addEventListener('dragover', function(e) {\n    e.preventDefault();\n  });\n\n\n  /**\n   *\n   * @param {*} e\n   */\n  function drop(e) {\n    dragShow(this);\n    e.stopPropagation();\n    e.preventDefault();\n    const dropTarget = e.currentTarget.classList.contains('droptarget') ? e.currentTarget : e.currentTarget.closest(\".droptarget\");\n    const parent = dropTarget.closest(\".droptarget-wrapper\");\n    const dropTargetInput = parent.querySelector(\"input\");\n\n    dropTargetInput.setAttribute('value', e.dataTransfer.getData('text/plain'));\n    dropTarget.dataset.contentValue = e.dataTransfer.getData('content');\n    dropTarget.innerHTML = e.dataTransfer.getData('content');\n\n    var sourceId = e.dataTransfer.getData(\"sourceId\");\n    var sourceEl = document.getElementById(sourceId);\n\n    if (sourceEl.offsetWidth > parent.offsetWidth) {\n      parent.style.width = sourceEl.offsetWidth + 10 + 'px';\n    }\n\n    if (Window.singleuse) {\n      sourceEl.classList.add('hide');\n      e.preventDefault();\n    }\n    e.preventDefault();\n  }\n  /**\n   *\n   * @param {*} e\n   */\n  function dragStart(e) {\n    e.dataTransfer.setData('text/plain', e.target.innerText);\n    e.dataTransfer.setData('content', e.target.innerHTML);\n    e.dataTransfer.setData('sourceId', this.id);\n    e.dataTransfer.effectAllowed = \"move\";\n    e.dataTransfer.dropEffect = \"move\";\n  }\n\n  /**\n   * Check is mobile.\n   * @returns {any}\n   */\n  function isMobile() {\n    const regex = /Mobi|Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i;\n    return regex.test(navigator.userAgent);\n  }\n\n  let temp = {};\n\n  if (isMobile()) {\n    const dragableAnswers = document.querySelectorAll('.draggable.answers');\n    const droptargets = document.querySelectorAll('.droptarget-wrapper');\n    dragableAnswers.forEach(function(el) {\n      el.addEventListener('click', (e) => copyValue(e.currentTarget));\n    });\n    droptargets.forEach(function(el) {\n      el.addEventListener('click', (e) => setValue(e.currentTarget));\n    });\n  }\n\n  /**\n   * Copy target text value into temp object.\n   * @param {any} target\n   * @returns {any}\n   */\n  function copyValue(target) {\n    temp.innerText = target.innerText;\n    temp.content = target.innerHTML;\n    temp.sourceId = target.id;\n    temp.elWidth = target.offsetWidth;\n    target.classList.add('bg-info');\n  }\n\n  /**\n   * Set temp object values into input.\n   * @param {any} target\n   * @returns {any}\n   */\n  function setValue(target) {\n    if (Object.keys(temp).length > 0) {\n\n      const dropTargetInput = target.querySelector('input');\n      const droptarget = target.querySelector('.droptarget');\n      const sourceEl = document.getElementById(temp.sourceId);\n\n      dropTargetInput.value = temp.innerText;\n      dropTargetInput.dataset.contentValue = temp.content;\n      droptarget.innerHTML = temp.content;\n      sourceEl.classList.remove('bg-info');\n\n      if (temp.elWidth > dropTargetInput.offsetWidth) {\n        dropTargetInput.style.width = temp.elWidth + 10 + 'px';\n      }\n\n      if (Window.singleuse) {\n        sourceEl.classList.add('hide');\n      }\n    }\n\n    temp = {};\n  }\n};\n\n"],"names":["singleuse","Window","draggables","document","querySelectorAll","dragShow","that","targetVal","classList","contains","closest","nextElementSibling","value","forEach","e","innerText","trim","remove","drop","this","stopPropagation","preventDefault","dropTarget","currentTarget","parent","querySelector","setAttribute","dataTransfer","getData","dataset","contentValue","innerHTML","sourceId","sourceEl","getElementById","offsetWidth","style","width","add","dragStart","setData","target","id","effectAllowed","dropEffect","addEventListener","el","length","parseInt","temp","test","navigator","userAgent","dragableAnswers","droptargets","copyValue","content","elWidth","Object","keys","dropTargetInput","droptarget","setValue"],"mappings":"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"}