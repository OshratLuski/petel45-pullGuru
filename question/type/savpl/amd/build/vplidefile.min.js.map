{"version":3,"file":"vplidefile.min.js","sources":["../src/vplidefile.js"],"sourcesContent":["// This file is part of VPL for Moodle - http://vpl.dis.ulpgc.es/\r\n//\r\n// VPL for Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// VPL for Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with VPL for Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * File management\r\n *\r\n * @copyright 2013 Juan Carlos Rodríguez-del-Pino\r\n * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n * @author Juan Carlos Rodríguez-del-Pino <jcrodriguez@dis.ulpgc.es>\r\n */\r\n\r\ndefine(\r\n    [\r\n        'jquery',\r\n        'jqueryui',\r\n        'qtype_savpl/vplutil',\r\n        'qtype_savpl/vplui',\r\n        'qtype_savpl/vplidecodefile',\r\n        'qtype_savpl/vplideblocklyfile',\r\n        'qtype_savpl/vplidebinaryfile',\r\n    ],\r\n    function($, jqui, VPLUtil, VPLUI, codeExtension, blocklyExtension, binaryExtension) {\r\n        return function(id, name, value, fileManager, vplIdeInstance) {\r\n            var tid = \"#vpl_file\" + id;\r\n            var tabnameid = \"#vpl_tab_name\" + id;\r\n            var fileName = name;\r\n            var modified = true;\r\n            var opened = false;\r\n            var langType = 'text';\r\n            var self = this;\r\n            this.getContent = function() {\r\n                return value;\r\n            };\r\n            this.setContent = function(c) {\r\n                value = c;\r\n            };\r\n            this.getFileManager = function() {\r\n                return fileManager;\r\n            };\r\n            this.getFileName = function() {\r\n                return fileName;\r\n            };\r\n            this.getId = function() {\r\n                return id;\r\n            };\r\n            this.getTabNameId = function() {\r\n                return tabnameid;\r\n            };\r\n            this.getTId = function() {\r\n                return tid;\r\n            };\r\n            this.getFileName = function() {\r\n                return fileName;\r\n            };\r\n            this.isModified = function() {\r\n                return modified;\r\n            };\r\n            this.resetModified = function() {\r\n                modified = false;\r\n                this.showFileName();\r\n            };\r\n            this.setModified = function() {\r\n                modified = true;\r\n                this.showFileName();\r\n            };\r\n            this.getTabPos = function() {\r\n                return fileManager.getTabPos(this);\r\n            };\r\n            this.setLang = function(lang) {\r\n                langType = lang;\r\n            };\r\n            this.getLang = function() {\r\n                return langType;\r\n            };\r\n            this.isOpen = function() {\r\n                return opened;\r\n            };\r\n            this.setOpen = function(openState) {\r\n                opened = openState;\r\n            };\r\n            this.getVPLIDE = function() {\r\n                return vplIdeInstance;\r\n            };\r\n            this.change = function() {\r\n                if (!modified) {\r\n                    this.setModified();\r\n                    fileManager.generateFileList();\r\n                    this.showFileName();\r\n                    VPLUtil.longDelay('setModified', fileManager.setModified);\r\n                }\r\n            };\r\n            this.setFileName = function(name) {\r\n                if (!VPLUtil.validPath(name)) {\r\n                    return false;\r\n                }\r\n                if (name != fileName) {\r\n                    fileName = name;\r\n                    self.change();\r\n                }\r\n                this.setReadOnly(fileManager.isReadOnly(name));\r\n                if (!this.isOpen()) {\r\n                    return true;\r\n                }\r\n                this.showFileName();\r\n                this.langSelection();\r\n                return true;\r\n            };\r\n            this.showFileName = function() {\r\n                var name = this.getFileName();\r\n                var fn = VPLUtil.getFileName(name);\r\n                if (fn.length > 20) {\r\n                    fn = fn.substring(0, 16) + '...';\r\n                }\r\n                var html = (modified ? VPLUI.iconModified() : '') + fn;\r\n                if (this.isReadOnly()) {\r\n                    html = html + VPLUI.iconReadOnly();\r\n                } else if (this.getId() < fileManager.minNumberOfFiles) {\r\n                    html = html + VPLUI.iconRequired();\r\n                }\r\n                html = html + VPLUI.iconClose();\r\n                $(tabnameid + ' a').html(html);\r\n                if (fn != name) {\r\n                    $(tabnameid + ' a').attr('title', name);\r\n                }\r\n                VPLUtil.afterAll('adjustTabsTitles' + self.id, function() {\r\n                    fileManager.adjustTabsTitles(true);\r\n                    VPLUtil.delay('adjustTabsTitles' + self.id, function() {\r\n                        self.adjustSize();\r\n                    });\r\n                });\r\n            };\r\n\r\n            this.destroy = function() {\r\n                $(tabnameid).remove();\r\n                $(tid).remove();\r\n            };\r\n\r\n            this.adjustSize = function() {\r\n                if (!this.isOpen()) {\r\n                    return false;\r\n                }\r\n                var editTag = $(tid);\r\n                var tabs = editTag.parent();\r\n                if (editTag.length === 0) {\r\n                    return false;\r\n                }\r\n                var editorHeight = editTag.height();\r\n                var editorWidth = editTag.width();\r\n                var newHeight = tabs.height();\r\n                newHeight -= editTag.position().top;\r\n                var newWidth = $('#vpl_tabs_scroll').width();\r\n                if (newHeight != editorHeight || newWidth != editorWidth) {\r\n                    $(editTag).height(newHeight);\r\n                    $(editTag).width(newWidth);\r\n                    return true;\r\n                }\r\n                return false;\r\n            };\r\n            this.updateStatus = VPLUI.hideIDEStatus;\r\n            this.gotoLine = VPLUtil.doNothing;\r\n            this.setReadOnly = VPLUtil.doNothing;\r\n            this.isReadOnly = VPLUtil.returnFalse;\r\n            this.focus = VPLUI.hideIDEStatus;\r\n            this.blur = VPLUtil.doNothing;\r\n            this.undo = VPLUtil.doNothing;\r\n            this.redo = VPLUtil.doNothing;\r\n            this.selectAll = VPLUtil.doNothing;\r\n            this.open = VPLUtil.doNothing;\r\n            this.hasUndo = VPLUtil.returnFalse;\r\n            this.hasRedo = VPLUtil.returnFalse;\r\n            this.hasSelectAll = VPLUtil.returnFalse;\r\n            this.hasFind = VPLUtil.returnFalse;\r\n            this.hasFindReplace = VPLUtil.returnFalse;\r\n            this.hasNext = VPLUtil.returnFalse;\r\n            this.find = VPLUtil.doNothing;\r\n            this.replace = VPLUtil.doNothing;\r\n            this.next = VPLUtil.doNothing;\r\n            this.getAnnotations = function() {\r\n                return [];\r\n            };\r\n            this.setAnnotations = VPLUtil.doNothing;\r\n            this.setFontSize = VPLUtil.doNothing;\r\n            this.setTheme = VPLUtil.doNothing;\r\n            this.clearAnnotations = VPLUtil.doNothing;\r\n            this.langSelection = VPLUtil.doNothing;\r\n            this.isBinary = VPLUtil.returnFalse;\r\n            // Adds support for current extensions\r\n            this.extendToCodeEditor = codeExtension;\r\n            this.extendToBlockly = blocklyExtension;\r\n            this.extendToBinary = binaryExtension;\r\n        };\r\n    }\r\n);\r\n"],"names":["define","$","jqui","VPLUtil","VPLUI","codeExtension","blocklyExtension","binaryExtension","id","name","value","fileManager","vplIdeInstance","tid","tabnameid","fileName","modified","opened","langType","self","this","getContent","setContent","c","getFileManager","getFileName","getId","getTabNameId","getTId","isModified","resetModified","showFileName","setModified","getTabPos","setLang","lang","getLang","isOpen","setOpen","openState","getVPLIDE","change","generateFileList","longDelay","setFileName","validPath","setReadOnly","isReadOnly","langSelection","fn","length","substring","html","iconModified","iconReadOnly","minNumberOfFiles","iconRequired","iconClose","attr","afterAll","adjustTabsTitles","delay","adjustSize","destroy","remove","editTag","tabs","parent","editorHeight","height","editorWidth","width","newHeight","position","top","newWidth","updateStatus","hideIDEStatus","gotoLine","doNothing","returnFalse","focus","blur","undo","redo","selectAll","open","hasUndo","hasRedo","hasSelectAll","hasFind","hasFindReplace","hasNext","find","replace","next","getAnnotations","setAnnotations","setFontSize","setTheme","clearAnnotations","isBinary","extendToCodeEditor","extendToBlockly","extendToBinary"],"mappings":"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"}