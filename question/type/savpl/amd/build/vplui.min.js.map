{"version":3,"file":"vplui.min.js","sources":["../src/vplui.js"],"sourcesContent":["// This file is part of VPL for Moodle - http://vpl.dis.ulpgc.es/\r\n//\r\n// VPL for Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// VPL for Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with VPL for Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * Tools for the VPL IDE\r\n *\r\n * @copyright 2016 Juan Carlos Rodríguez-del-Pino\r\n * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n * @author Juan Carlos Rodríguez-del-Pino <jcrodriguez@dis.ulpgc.es>\r\n */\r\n\r\n/* globals JUnzip */\r\n/* globals JSInflate */\r\n\r\ndefine(\r\n    [\r\n        'jquery',\r\n        'jqueryui',\r\n        'qtype_savpl/vplutil',\r\n    ],\r\n    function($, jqui, VPLUtil) {\r\n        var VPLUI = {};\r\n        // Get scrollBarWidth.\r\n        VPLUI.scrollBarWidth = function() {\r\n            var parent, child, width;\r\n            parent = $('<div style=\"width:50px;height:50px;overflow:auto\"><div/></div>').appendTo('body');\r\n            child = parent.children();\r\n            width = child.innerWidth() - child.height(99).innerWidth();\r\n            parent.remove();\r\n            return width;\r\n        };\r\n        VPLUI.readZipFile = function(data, save, progressBar, end) {\r\n            if (!end) {\r\n                end = VPLUtil.doNothing;\r\n            }\r\n            if (typeof JUnzip == 'undefined') {\r\n                VPLUtil.loadScript(['/zip/inflate.js', '/zip/unzip.js']\r\n                , function() {\r\n                    VPLUI.readZipFile(data, save, progressBar, end);\r\n                });\r\n                return;\r\n            }\r\n            var ab = VPLUtil.ArrayBuffer2String(data);\r\n            var unzipper = new JUnzip(ab);\r\n            if (!unzipper.isZipFile()) {\r\n                VPLUtil.log('Not a ZIP file');\r\n                end();\r\n                return;\r\n            }\r\n            unzipper.readEntries();\r\n            var out = unzipper.entries.length;\r\n            /**\r\n             * Process each entry in the zip file.\r\n             * Recursive process.\r\n             * @param {int} i Entry to process.\r\n             */\r\n            function process(i) {\r\n                if (i >= out || progressBar.isClosed()) {\r\n                    end();\r\n                    return;\r\n                }\r\n                var entry = unzipper.entries[i];\r\n                var fileName = entry.fileName;\r\n                var data;\r\n                // Is directory entry then skip.\r\n                if (fileName.match(/\\/$/)) {\r\n                    process(i + 1);\r\n                } else {\r\n                    progressBar.processFile(fileName);\r\n                    var uncompressed = '';\r\n                    if (entry.compressionMethod === 0) {\r\n                        // Plain file.\r\n                        uncompressed = entry.data;\r\n                    } else if (entry.compressionMethod === 8) {\r\n                        uncompressed = JSInflate.inflate(entry.data);\r\n                    }\r\n                    if (VPLUtil.isBinary(fileName)) {\r\n                        // If binary use as arrayBuffer.\r\n                        save({name: fileName, contents: btoa(uncompressed), encoding: 1});\r\n                        // TODO Show message when error.\r\n                        process(i + 1);\r\n                    } else {\r\n                        data = VPLUtil.String2ArrayBuffer(uncompressed);\r\n                        var blob = new Blob([data], {\r\n                            type: 'text/plain'\r\n                        });\r\n                        var fr = new FileReader();\r\n                        fr.onload = function(e) {\r\n                            save({name: fileName, contents: e.target.result, encoding: 0});\r\n                            process(i + 1);\r\n                        };\r\n                        fr.onerror = function(e) {\r\n                            VPLUtil.log(e);\r\n                            i = out;\r\n                            process(i + 1);\r\n                            // TODO Show message when error.\r\n                        };\r\n                        fr.readAsText(blob);\r\n                    }\r\n                }\r\n            }\r\n            process(0);\r\n        };\r\n\r\n        VPLUI.readSelectedFiles = function(filesToRead, save, end) {\r\n            // Process all File objects.\r\n            var pb = new VPLUI.progressBar('import', 'import');\r\n            var errorsMessages = '';\r\n            if (!end) {\r\n                end = VPLUtil.doNothing;\r\n            }\r\n            pb.processFile = function(name) {\r\n                pb.setLabel(name);\r\n            };\r\n            /**\r\n             * Read each file in filesToReas\r\n             * Recursive process.\r\n             * @param {int} sec secuencial file to read\r\n             */\r\n            function readSecuencial(sec) {\r\n                if (sec >= filesToRead.length || pb.isClosed()) {\r\n                    end();\r\n                    pb.close();\r\n                    if (errorsMessages > '') {\r\n                        VPLUI.showErrorMessage(errorsMessages);\r\n                    }\r\n                    return;\r\n                }\r\n                var f = filesToRead[sec];\r\n                pb.processFile(f.name);\r\n                var binary = VPLUtil.isBinary(f.name);\r\n                var reader = new FileReader();\r\n                var ext = VPLUtil.fileExtension(f.name).toLowerCase();\r\n                reader.onload = function(e) {\r\n                    if (binary) {\r\n                        if (ext == 'zip') {\r\n                            try {\r\n                                VPLUI.readZipFile(e.target.result, save, pb, function() {\r\n                                                                                  readSecuencial(sec + 1);\r\n                                                                               });\r\n                                return;\r\n                            } catch (ex) {\r\n                                VPLUI.showErrorMessage(ex + \" : \" + f.name);\r\n                            }\r\n                        } else {\r\n                            var data = VPLUtil.dataFromURLData(e.target.result);\r\n                            save({name: f.name, contents: data, encoding: 1});\r\n                        }\r\n                    } else {\r\n                        save({name: f.name, contents: e.target.result, encoding: 0});\r\n                    }\r\n                    readSecuencial(sec + 1);\r\n                };\r\n                reader.onerror = function(e) {\r\n                    errorsMessages += \"Error \\\"\" + e.target.error + \"\\\" reading \" + f.name + \"\\n\";\r\n                    readSecuencial(sec + 1);\r\n                };\r\n                if (binary) {\r\n                    if (ext == 'zip') {\r\n                        reader.readAsArrayBuffer(f);\r\n                    } else {\r\n                        reader.readAsDataURL(f);\r\n                    }\r\n                } else {\r\n                    reader.readAsText(f);\r\n                }\r\n            }\r\n            readSecuencial(0);\r\n        };\r\n        VPLUI.dialogbaseOptions = {\r\n            minWidth: 200,\r\n            autoOpen: false,\r\n            width: 'auto',\r\n            closeText: VPLUtil.str('cancel'),\r\n            modal: true,\r\n            dialogClass: 'vpl_ide vpl_ide_dialog'\r\n        };\r\n        VPLUI.iconModified = function() {\r\n            var html = '<span title=\"' + VPLUtil.str('modified') + '\" class=\"vpl_ide_charicon\">';\r\n            html += '<i class=\"fa fa-star\"></i>' + '</span> ';\r\n            return html;\r\n        };\r\n        VPLUI.iconDelete = function() {\r\n            var html = ' <span title=\"' + VPLUtil.str('delete') + '\" class=\"vpl_ide_charicon vpl_ide_delicon\">';\r\n            html += '<i class=\"fa fa-trash\"></i>' + '</span> ';\r\n            return html;\r\n        };\r\n        VPLUI.iconClose = function() {\r\n            var html = ' <span title=\"' + VPLUtil.str('closebuttontitle');\r\n            html += '\" class=\"vpl_ide_charicon vpl_ide_closeicon\">' + '<i class=\"fa fa-remove\"></i>' + '</span> ';\r\n            return html;\r\n        };\r\n        VPLUI.iconRequired = function() {\r\n            var html = ' <span title=\"' + VPLUtil.str('required') + '\" class=\"vpl_ide_charicon\">';\r\n            html += '<i class=\"fa fa-shield\"></i>' + '</span> ';\r\n            return html;\r\n        };\r\n        VPLUI.iconReadOnly = function() {\r\n            var html = ' <span title=\"' + VPLUtil.str('readOnly') + '\" class=\"vpl_ide_charicon\">';\r\n            html += '<i class=\"fa fa-lock\"></i>' + '</span> ';\r\n            return html;\r\n        };\r\n        VPLUI.iconFolder = function() {\r\n            return '<i class=\"fa fa-folder-open-o\"></i>';\r\n        };\r\n        (function() {\r\n            var menuIcons = {\r\n                'filelist': 'folder-open-o',\r\n                'filelistclose': 'folder-o',\r\n                'new': 'file-code-o',\r\n                'rename': 'pencil',\r\n                'delete': 'trash',\r\n                'multidelete': 'trash|list',\r\n                'close': 'remove',\r\n                'comments': 'commenting',\r\n                'import': 'upload',\r\n                'print': 'print',\r\n                'edit': 'edit',\r\n                'undo': 'undo',\r\n                'redo': 'repeat',\r\n                'select_all': 'location-arrow',\r\n                'find': 'search',\r\n                'find_replace': 'exchange',\r\n                'next': 'search-plus',\r\n                'resetfiles': 'refresh',\r\n                'download': 'download',\r\n                'fullscreen': 'expand',\r\n                'regularscreen': 'compress',\r\n                'save': 'save',\r\n                'shortcuts': 'flash',\r\n                'sort': 'list-ol',\r\n                'run': 'rocket',\r\n                'running': 'rocket fa-spin',\r\n                'debug': 'bug',\r\n                'evaluate': 'check-square-o',\r\n                'console': 'terminal',\r\n                'about': 'question',\r\n                'info': 'info-circle',\r\n                'alert': 'warning',\r\n                'trash': 'trash',\r\n                'retrieve': 'download',\r\n                'spinner': 'refresh fa-spin',\r\n                'keyboard': 'keyboard-o',\r\n                'clipboard': 'clipboard',\r\n                'timeleft': 'clock-o',\r\n                'copy': 'copy',\r\n                'paste': 'paste',\r\n                'more': 'plus-square',\r\n                'less': 'minus-square',\r\n                'resize': 'arrows-alt',\r\n                'graphic': 'picture-o',\r\n                'send': 'send',\r\n                'theme':  'paint-brush',\r\n                'user': 'user',\r\n                'fontsize': 'text-height',\r\n                'close-rightpanel': 'caret-square-o-right',\r\n                'open-rightpanel': 'caret-square-o-left'\r\n            };\r\n            VPLUI.genIcon = function(icon, size) {\r\n                if (!menuIcons[icon]) {\r\n                    return '';\r\n                }\r\n                var classes = 'fa fa-';\r\n                if (!size) {\r\n                    classes += 'lg';\r\n                } else {\r\n                    classes += size;\r\n                }\r\n                var icons = menuIcons[icon].split('|');\r\n                var ret = '';\r\n                for (var i = 0; i < icons.length; i++) {\r\n                    ret += \"<i class='\" + classes + ' fa-' + icons[i] + \"'></i>\";\r\n                }\r\n                return ret;\r\n            };\r\n        })();\r\n        // UI operations.\r\n        VPLUI.setTitleBar = function(dialog, type, icon, buttons, handler) {\r\n            var title = $(dialog).parent().find(\"span.ui-dialog-title\");\r\n            /**\r\n             * Generate HTML for a button with icon\r\n             * @param {string} e name of botton.\r\n             * @returns {string} Html tag <a> as a button.\r\n             */\r\n            function genButton(e) {\r\n                var html = \"<a id='vpl_\" + type + \"_\" + e + \"' href='#' title='\" + VPLUtil.str(e) + \"'>\";\r\n                html += VPLUI.genIcon(e, 'fw') + \"</a>\";\r\n                return html;\r\n            }\r\n            var html = VPLUI.genIcon(icon);\r\n            html += \" <span class='\" + type + \"-title-buttons'></span>\";\r\n            html += \"<span class='\" + type + \"-title-text'></span>\";\r\n            title.html(html);\r\n            var titleButtons = title.find(\"span.\" + type + \"-title-buttons\");\r\n            var titleText = title.find(\"span.\" + type + \"-title-text\");\r\n            html = \"\";\r\n            for (var i = 0; i < buttons.length; i++) {\r\n                html += genButton(buttons[i]);\r\n            }\r\n            titleButtons.html(html);\r\n            for (var ih = 0; ih < handler.length; ih++) {\r\n                var button = title.find('#vpl_' + type + '_' + buttons[ih]);\r\n                button.button().click(handler[ih]);\r\n                button.css('padding', '1px 3px');\r\n            }\r\n            titleButtons.on('focus', '*', function() {\r\n                                              $(this).blur();\r\n                                          });\r\n            return titleText;\r\n        };\r\n        VPLUI.setDialogTitleIcon = function(dialog, icon) {\r\n            var title = $(dialog).parent().find(\"span.ui-dialog-title\");\r\n            title.html(VPLUI.genIcon(icon) + ' ' + title.html());\r\n        };\r\n        VPLUI.progressBar = function(title, message, onUserClose) {\r\n            var labelHTML = '<span class=\"vpl_ide_progressbarlabel\"></span>';\r\n            var sppiner = '<div class=\"vpl_ide_progressbaricon\">' + VPLUI.genIcon('spinner') + '</div>';\r\n            var pbHTML = ' <div class=\"vpl_ide_progressbar\">' + sppiner + labelHTML + '</div>';\r\n            var HTML = '<div class=\"vpl_ide_dialog\" style=\"display:none;\">' + pbHTML + '</div>';\r\n            var dialog = $(HTML);\r\n            $('body').append(dialog);\r\n            var progressbar = dialog.find('.vpl_ide_progressbar');\r\n            var label = progressbar.find('.vpl_ide_progressbarlabel');\r\n            dialog.dialog({\r\n                'title': VPLUtil.str(title),\r\n                resizable: false,\r\n                autoOpen: false,\r\n                width: 200,\r\n                height: 20,\r\n                minHeight: 20,\r\n                modal: true,\r\n                dialogClass: 'vpl_ide vpl_ide_dialog',\r\n                close: function(event) {\r\n                    if (dialog) {\r\n                        if (onUserClose && event.originalEvent) {\r\n                            onUserClose();\r\n                        }\r\n                        onUserClose = false;\r\n                    }\r\n                }\r\n            });\r\n            this.setLabel = function(t, icon) {\r\n                if (dialog) {\r\n                    label.text(t);\r\n                    if (icon) {\r\n                        label.html(VPLUI.genIcon(icon) + ' ' + label.html());\r\n                    }\r\n                }\r\n            };\r\n            this.close = function() {\r\n                if (dialog) {\r\n                    dialog.dialog('destroy');\r\n                    $(dialog).remove();\r\n                    dialog = false;\r\n                }\r\n            };\r\n            this.isClosed = function() {\r\n                return dialog === false;\r\n            };\r\n            var titleTag = dialog.siblings().find('.ui-dialog-title');\r\n            titleTag.html(VPLUI.genIcon(title) + ' ' + titleTag.html());\r\n            this.setLabel(VPLUtil.str(message));\r\n            dialog.dialog('open');\r\n            dialog.dialog('option', 'height', 'auto');\r\n        };\r\n        /**\r\n         * Shows a dialog with a message.\r\n         * @param {string} message\r\n         * @param {Object} initialoptions icon, title, actions handler (ok, yes, no, close)\r\n         * @returns {JQuery} JQueryUI Dialog object already open\r\n         */\r\n        VPLUI.showMessage = function(message, initialoptions) {\r\n            var options = $.extend({}, VPLUI.dialogbaseOptions, initialoptions);\r\n            var messageDialog = $('<div class=\"vpl_ide_dialog\" style=\"display:none\"></div>');\r\n            var icon = '';\r\n            var contents = ' <span class=\"dmessage\">' + message.replace(/\\n/g, '<br>') + '</span>';\r\n            messageDialog.html(contents);\r\n            if (typeof options.icon == 'undefined') {\r\n                icon = 'info';\r\n            } else {\r\n                icon = options.icon;\r\n                delete options.icon;\r\n            }\r\n            if (!options.title) {\r\n                options.title = VPLUtil.str('warning');\r\n            }\r\n            $('body').append(messageDialog);\r\n            var messageButtons = {};\r\n            if (typeof initialoptions.ok == 'function') {\r\n                messageButtons[VPLUtil.str('ok')] = function() {\r\n                    $(this).dialog('close');\r\n                    initialoptions.ok();\r\n                };\r\n                messageButtons[VPLUtil.str('cancel')] = function() {\r\n                    $(this).dialog('close');\r\n                };\r\n                delete options.ok;\r\n            } else if (typeof initialoptions.yes == 'function') {\r\n                messageButtons[VPLUtil.str('yes')] = function() {\r\n                    $(this).dialog('close');\r\n                    initialoptions.yes();\r\n                };\r\n                messageButtons[VPLUtil.str('no')] = function() {\r\n                    $(this).dialog('close');\r\n                };\r\n                delete options.yes;\r\n            } else {\r\n                messageButtons[VPLUtil.str('close')] = function() {\r\n                    $(this).dialog('close');\r\n                };\r\n            }\r\n            if (options.next) {\r\n                messageButtons[VPLUtil.str('next')] = function() {\r\n                    $(this).dialog('close');\r\n                    initialoptions.next();\r\n                };\r\n            }\r\n            options.close = function() {\r\n                    $(this).remove();\r\n                    if (initialoptions.close) {\r\n                        initialoptions.close();\r\n                    }\r\n            };\r\n            options.buttons = messageButtons;\r\n\r\n            messageDialog.dialog(options);\r\n            var titleTag = messageDialog.siblings().find('.ui-dialog-title');\r\n            titleTag.html(VPLUI.genIcon(icon) + ' ' + titleTag.html());\r\n\r\n            messageDialog.setMessage = function(men) {\r\n                $(messageDialog).find('.dmessage').html(men.replace(/\\n/g, '<br>'));\r\n            };\r\n\r\n            messageDialog.dialog('open');\r\n            return messageDialog;\r\n        };\r\n        VPLUI.showErrorMessage = function(message, options) {\r\n            var currentOptions = $.extend({}, VPLUI.dialogbaseOptions, {\r\n                title: VPLUtil.str('error'),\r\n                icon: 'alert'\r\n            });\r\n            if (options) {\r\n                currentOptions = $.extend(currentOptions, options);\r\n            }\r\n            return VPLUI.showMessage(message, currentOptions);\r\n        };\r\n        /**\r\n         * Request an action to de server: save, run, debug, evaluate, update, getresult, etc.\r\n         * @param {string} action Name of action to request.\r\n         * @param {string} title The title that shows the progress dialog\r\n         * @param {object} data Data to send to the server\r\n         * @param {string} URL URL to the server entry point, lacking action\r\n         * @param {boolean} noDialog If true then no dialog is shown\r\n         * @returns {deferred} Defferred object\r\n         */\r\n        VPLUI.requestAction = function(action, title, data, URL, noDialog) {\r\n            var deferred = $.Deferred();\r\n            var request = null;\r\n            var xhr = false;\r\n            var apb = false;\r\n            if (!noDialog) {\r\n                if (title === '') {\r\n                    title = 'connecting';\r\n                }\r\n                apb = new VPLUI.progressBar(action, title, function() {\r\n                    if (request.readyState != 4) {\r\n                        if (xhr && xhr.abort) {\r\n                            xhr.abort();\r\n                        }\r\n                    }\r\n                });\r\n            }\r\n            request = $.ajax({\r\n                beforeSend: function(jqXHR) {\r\n                    xhr = jqXHR;\r\n                    return true;\r\n                },\r\n                async: true,\r\n                type: \"POST\",\r\n                url: URL + action,\r\n                'data': JSON.stringify(data),\r\n                contentType: \"application/json; charset=utf-8\",\r\n                dataType: \"json\"\r\n            }).always(function() {\r\n                if (!noDialog) {\r\n                    apb.close();\r\n                }\r\n            }).done(function(response) {\r\n                if (!response.success) {\r\n                    deferred.reject(response.error);\r\n                } else {\r\n                    deferred.resolve(response.response);\r\n                }\r\n            }).fail(function(jqXHR, textStatus, errorThrown) {\r\n                var message = VPLUtil.str('connection_fail') + ': ' + textStatus;\r\n                if (window.VPLDebugMode && errorThrown.message != undefined) {\r\n                    message += ': ' + errorThrown.message;\r\n                }\r\n                VPLUtil.log(message);\r\n                deferred.reject(message);\r\n            });\r\n            return deferred;\r\n        };\r\n        VPLUI.clickServer = function(e) {\r\n            var w = 550;\r\n            var h = 450;\r\n            var left = (screen.width / 2) - (w / 2);\r\n            var top = (screen.height / 2) - (h / 2);\r\n            try {\r\n                var features = 'toolbar=no, location=no, directories=no, status=no, menubar=no';\r\n                features += ', resizable=yes, scrollbars=yes, copyhistory=no, width=' + w;\r\n                features += ', height=' + h + ', top=' + top + ', left=' + left;\r\n                var win = window.open($(this).attr('href'), '_blank', features);\r\n                if (!win) {\r\n                    return true;\r\n                }\r\n            } catch (ex) {\r\n                VPLUtil.log(ex);\r\n                return true;\r\n            }\r\n            e.preventDefault();\r\n            $(this).parent().hide();\r\n            return false;\r\n        };\r\n\r\n        VPLUI.acceptCertificates = function(servers, getLastAction) {\r\n            if (servers.length > 0) {\r\n                // Generate links dialog.\r\n                var html = VPLUtil.str('acceptcertificatesnote');\r\n                html += '<ol>';\r\n                var i;\r\n                for (i in servers) {\r\n                    if (servers.hasOwnProperty(i)) {\r\n                        var n = 1 + i;\r\n                        html += '<li><a href=\"' + servers[i] + '\" target=\"_blank\">Server ';\r\n                        html += n + '</a></li>';\r\n                    }\r\n                }\r\n                html += '</ol>';\r\n                var m = VPLUI.showMessage(html, {\r\n                    ok: function() {\r\n                        var action = getLastAction();\r\n                        if (action) {\r\n                            action();\r\n                        }\r\n                    },\r\n                    icon: 'unlocked',\r\n                    title: VPLUtil.str('acceptcertificates')\r\n                });\r\n                $(m).find('a').on('click keypress', VPLUI.clickServer);\r\n            } else {\r\n                VPLUtil.log('servers.length == 0');\r\n                VPLUI.showErrorMessage(VPLUtil.str('connection_fail'));\r\n            }\r\n        };\r\n        VPLUI.monitorRunning = VPLUtil.returnFalse;\r\n        VPLUI.webSocketMonitor = function(coninfo, title, running, externalActions) {\r\n            VPLUtil.setProtocol(coninfo);\r\n            VPLUtil.setProcessId(coninfo.processid);\r\n            var ws = null;\r\n            var pb = null;\r\n            var deferred = $.Deferred();\r\n            var defail = function(m) {\r\n                deferred.reject(m);\r\n                if (ws !== null) {\r\n                    ws.close();\r\n                }\r\n            };\r\n            var delegated = false;\r\n            var messageActions = {\r\n                'message': function(content) {\r\n                    var parsed = /^([^:]*):?([^]*)/.exec(content);\r\n                    var state = VPLUtil.sanitizeText(parsed[1]);\r\n                    var detail = VPLUtil.sanitizeText(parsed[2]);\r\n                    if (state == 'running') {\r\n                        state = running;\r\n                    }\r\n                    var text = VPLUtil.str(state);\r\n                    if (detail > '') {\r\n                        text += ': ' + detail;\r\n                    }\r\n                    console.log('webSocketMonitor externalActions.isopen');\r\n                    console.log(externalActions.getConsole().isOpen());\r\n                    if (pb !== null && !pb.isClosed()) {\r\n                        pb.setLabel(text);\r\n                    } else if (externalActions.getConsole && externalActions.getConsole().isOpen()) {\r\n                        externalActions.getConsole().setMessage(text);\r\n                    } else {\r\n                        VPLUtil.log('Error: no dialogo. Message not shown: ' + text);\r\n                    }\r\n                },\r\n                'compilation': function(content) {\r\n                    if (externalActions.setResult) {\r\n                        externalActions.setResult({\r\n                            'compilation': content,\r\n                        }, false);\r\n                    }\r\n                },\r\n                'retrieve': function() {\r\n                    var data = {\"processid\": coninfo.processid};\r\n                    pb.close();\r\n                    delegated = true;\r\n                    VPLUI.requestAction('retrieve', '', data, externalActions.ajaxurl)\r\n                    .done(\r\n                        function(response) {\r\n                            deferred.resolve();\r\n                            if (externalActions.setResult) {\r\n                                externalActions.setResult(response, true);\r\n                            }\r\n                        }\r\n                   ).fail(defail);\r\n                },\r\n                'run': function(content) {\r\n                    console.log('run content');\r\n                    console.log(content);\r\n                    pb.close();\r\n                    externalActions.run(content, coninfo, ws);\r\n                },\r\n                'close': function() {\r\n                    VPLUtil.log('ws close message from jail');\r\n                    ws.close();\r\n                    var data = {\"processid\": coninfo.processid};\r\n                    VPLUI.requestAction('cancel', '', data, externalActions.ajaxurl, true);\r\n                }\r\n            };\r\n            try {\r\n                if (VPLUtil.supportWebSocket()) {\r\n                    ws = new WebSocket(coninfo.monitorURL);\r\n                } else {\r\n                    VPLUtil.log('ws not available');\r\n                    deferred.reject(VPLUtil.str('browserupdate'));\r\n                    return deferred;\r\n                }\r\n            } catch (e) {\r\n                VPLUtil.log('ws new say ' + e);\r\n                deferred.reject(e.message);\r\n                return deferred;\r\n            }\r\n            pb = new VPLUI.progressBar(title, 'connecting', function() {\r\n                deferred.reject('Stopped by user');\r\n                ws.close();\r\n            });\r\n            ws.notOpen = true;\r\n            ws.onopen = function() {\r\n                ws.notOpen = false;\r\n                pb.setLabel(VPLUtil.str('connected'));\r\n                if (externalActions.open) {\r\n                    externalActions.open();\r\n                }\r\n            };\r\n            ws.onerror = function(event) {\r\n                VPLUtil.log('ws error ' + event);\r\n                pb.close();\r\n                if (coninfo.secure && ws.notOpen) {\r\n                    VPLUI.requestAction('getjails', 'retrieve', {}, externalActions.ajaxurl)\r\n                    .done(function(response) {\r\n                        VPLUI.acceptCertificates(response.servers, function() {\r\n                            return externalActions.getLastAction();\r\n                        });\r\n                    })\r\n                    .fail(defail);\r\n                } else {\r\n                    deferred.reject(VPLUtil.str('connection_fail'));\r\n                }\r\n                if (externalActions.close) {\r\n                    VPLUtil.delay('externalActions.close', externalActions.close);\r\n                }\r\n            };\r\n            ws.onclose = function() {\r\n                if (externalActions.getConsole) {\r\n                    externalActions.getConsole().disconnect();\r\n                }\r\n                if (!ws.notOpen) {\r\n                    pb.close();\r\n                    if (!delegated && deferred.state() != 'rejected') {\r\n                        deferred.resolve();\r\n                    }\r\n                }\r\n                if (externalActions.close) {\r\n                    externalActions.close();\r\n                }\r\n            };\r\n\r\n            ws.onmessage = function(event) {\r\n                console.log('VPLUI ws.onmessage');\r\n                console.log(ws);\r\n                console.log('event.data');\r\n                console.log(event.data);\r\n                var message = /^([^:]+):([^]*)/.exec(event.data);\r\n                if (message !== null) {\r\n                    var action = message[1];\r\n                    var content = message[2];\r\n                    if (messageActions[action]) {\r\n                        messageActions[action](content);\r\n                    }\r\n                } else {\r\n                    pb.setLabel(VPLUtil.str('error') + ': ' + event.data);\r\n                }\r\n            };\r\n            VPLUI.monitorRunning = function() {\r\n                return ws !== null && ws.readyState != WebSocket.CLOSED;\r\n            };\r\n            return deferred;\r\n        };\r\n\r\n        VPLUI.hideIDEStatus = function() {\r\n            VPLUtil.delay('updateIDEStatus', function() {\r\n                $('.vpl_ide_status').hide();\r\n            });\r\n        };\r\n\r\n        VPLUI.showIDEStatus = function(status) {\r\n            VPLUtil.delay('updateIDEStatus', function() {\r\n                $('.vpl_ide_status').text(status);\r\n                $('.vpl_ide_status').show();\r\n            });\r\n        };\r\n\r\n        VPLUtil.init = VPLUtil.doNothing;\r\n        // Needs global use of VPLUtil for view source? Review.\r\n        window.VPLUI = VPLUI;\r\n        return VPLUI;\r\n    }\r\n);\r\n"],"names":["define","$","jqui","VPLUtil","menuIcons","VPLUI","scrollBarWidth","parent","child","width","appendTo","children","innerWidth","height","remove","readZipFile","data","save","progressBar","end","doNothing","JUnzip","ab","ArrayBuffer2String","unzipper","isZipFile","log","readEntries","out","entries","length","process","i","isClosed","entry","fileName","match","processFile","uncompressed","compressionMethod","JSInflate","inflate","isBinary","name","contents","btoa","encoding","String2ArrayBuffer","blob","Blob","type","fr","FileReader","onload","e","target","result","onerror","readAsText","loadScript","readSelectedFiles","filesToRead","pb","errorsMessages","setLabel","readSecuencial","sec","close","showErrorMessage","f","binary","reader","ext","fileExtension","toLowerCase","ex","dataFromURLData","error","readAsArrayBuffer","readAsDataURL","dialogbaseOptions","minWidth","autoOpen","closeText","str","modal","dialogClass","iconModified","html","iconDelete","iconClose","iconRequired","iconReadOnly","iconFolder","filelist","filelistclose","new","rename","delete","multidelete","comments","import","print","edit","undo","redo","select_all","find","find_replace","next","resetfiles","download","fullscreen","regularscreen","shortcuts","sort","run","running","debug","evaluate","console","about","info","alert","trash","retrieve","spinner","keyboard","clipboard","timeleft","copy","paste","more","less","resize","graphic","send","theme","user","fontsize","genIcon","icon","size","classes","icons","split","ret","setTitleBar","dialog","buttons","handler","title","genButton","titleButtons","titleText","ih","button","click","css","on","this","blur","setDialogTitleIcon","message","onUserClose","sppiner","append","label","resizable","minHeight","event","originalEvent","t","text","titleTag","siblings","showMessage","initialoptions","options","extend","messageDialog","replace","messageButtons","ok","yes","setMessage","men","currentOptions","requestAction","action","URL","noDialog","deferred","Deferred","request","xhr","apb","readyState","abort","ajax","beforeSend","jqXHR","async","url","JSON","stringify","contentType","dataType","always","done","response","success","resolve","reject","fail","textStatus","errorThrown","window","VPLDebugMode","undefined","clickServer","left","screen","w","top","h","features","open","attr","preventDefault","hide","acceptCertificates","servers","getLastAction","hasOwnProperty","n","m","monitorRunning","returnFalse","webSocketMonitor","coninfo","externalActions","setProtocol","setProcessId","processid","ws","defail","delegated","messageActions","content","parsed","exec","state","sanitizeText","detail","getConsole","isOpen","compilation","setResult","ajaxurl","supportWebSocket","WebSocket","monitorURL","notOpen","onopen","secure","delay","onclose","disconnect","onmessage","CLOSED","hideIDEStatus","showIDEStatus","status","show","init"],"mappings":"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"}