/**
 * Provides utility method to communicate with a VPL (this is an API wrapper to use VPLUtil and VPLUI)
 * @copyright  Astor Bizard, 2019
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("qtype_savpl/vplservice",["jquery","core/url"],(function($,url){function getAjaxUrl(questionId,userId,file){return void 0===file&&(file="edit"),url.relativeUrl("/question/type/savpl/ajax")+"/"+file+".json.php?id="+questionId+"&userId="+userId+"&action="}var VPLService={},cache={reqfile:[],execfiles:[]};return VPLService.info=function(filesType,questionId){return null!=cache[filesType][questionId]?$.Deferred().resolve(cache[filesType][questionId]).promise():("reqfile"==filesType?VPLUI.requestAction("resetfiles","",{},getAjaxUrl(questionId,"")):VPLUI.requestAction("load","",{},getAjaxUrl(questionId,"","executionfiles"))).then((function(response){var files="reqfile"==filesType?response.files[0]:response.files;return cache[filesType][questionId]=files,files})).promise()},VPLService.save=function(questionId,answer,filestype){return $.ajax(url.relativeUrl("/question/type/savpl/ajax/save.json.php"),{data:{qid:questionId,answer:answer,filestype:filestype},method:"POST"}).promise()},VPLService.exec=function(action,questionId,userId,terminal,callback){var options={ajaxurl:getAjaxUrl(questionId,userId),resultSet:!1,errorCause:"unknown",setResult:function(result){this.resultSet=!0,callback(result)},close:function(){var _this=this;setTimeout((function(){_this.resultSet||callback({execerror:M.util.get_string("execerrordetails","qtype_savpl")})}),600)},getConsole:function(){return terminal},run:function(type,conInfo,ws){var _this=this;terminal.connect(conInfo.executionURL,(function(){ws.close(),_this.resultSet||callback({})}))}};return VPLUI.progressBar=function(){var closed=!1;this.setLabel=function(message){["timeout","outofmemory"].forEach((function(cause){var pattern="{"+cause+"}";-1!==message.indexOf(pattern)&&(options.errorCause=cause+message.substring(message.indexOf(pattern)+pattern.length))}))},this.close=function(){closed=!0},this.isClosed=function(){return closed}},VPLUI.requestAction(action,"",{},options.ajaxurl).done((function(response){VPLUI.webSocketMonitor(response,"","",options)})).promise()},{call:function(service){VPLUI.progressBar=function(){this.setLabel=function(){},this.close=function(){},this.isClosed=function(){return!0}};for(var _len=arguments.length,args=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++)args[_key-1]=arguments[_key];return VPLService[service](...args)},langOfFile:function(fileName){return VPLUtil.langType(fileName.split(".").pop())},isBinary:function(fileName){return VPLUtil.isBinary(fileName)}}}));

//# sourceMappingURL=vplservice.min.js.map