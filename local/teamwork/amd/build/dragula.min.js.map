{"version":3,"file":"dragula.min.js","sources":["../src/dragula.js"],"sourcesContent":["define([\r\n    'jquery',\r\n    'core/str',\r\n    'core/ajax',\r\n    'local_teamwork/render',\r\n    'local_teamwork/popup',\r\n    'local_teamwork/loading',\r\n    'local_teamwork/dragulasource',\r\n    'core/modal_factory',\r\n    'core/modal_events',\r\n    'local_teamwork/keyboardnav',\r\n    'core/notification',\r\n], function ($, Str, Ajax, render, popup, loadingIcon, dragula, ModalFactory, ModalEvents, Keyboardnav, Notification) {\r\n    'use strict';\r\n\r\n    const renderPageAfterDrag = (el, removeteam, callback) => {\r\n\r\n        const allTeamsBlocks = Array.from(document.querySelectorAll('div[data-team_id]'));\r\n        const allTeams = [];\r\n        const draguserid = el.dataset.student_id;\r\n\r\n        let teamid;\r\n        allTeamsBlocks.forEach((item) => {\r\n            let team = {};\r\n            team.teamid = item.dataset.team_id;\r\n            team.studentid = [];\r\n\r\n            let allStudents = Array.from(item.querySelectorAll('.teamwork_student'));\r\n            allStudents.forEach((student) => {\r\n                team.studentid.push(student.dataset.student_id);\r\n            });\r\n            allTeams.push(team);\r\n        });\r\n\r\n        loadingIcon.show();\r\n        Ajax.call([{\r\n            methodname: 'local_teamwork_drag_student_card',\r\n            args: {\r\n                courseid: Number(render.data.courseid),\r\n                activityid: Number(render.data.activityid),\r\n                moduletype: render.data.moduletype,\r\n                selectgroupid: render.data.selectgroupid,\r\n                newteamspost: JSON.stringify(allTeams),\r\n                draguserid: Number(draguserid),\r\n                removeteam: removeteam,\r\n            },\r\n            done: function (data) {\r\n                loadingIcon.remove();\r\n                callback(data);\r\n            },\r\n            fail: function () {\r\n                loadingIcon.remove();\r\n                popup.error();\r\n            }\r\n        }]);\r\n    };\r\n\r\n    const checkOverflowAndRender = (el, target, source) => {\r\n\r\n        let maxCount = source.dataset.max_count;\r\n\r\n        if (target.childElementCount === maxCount) {\r\n            target.classList.add('stop-drag');\r\n        }\r\n        if (source.childElementCount < maxCount) {\r\n            source.classList.remove('stop-drag');\r\n        }\r\n\r\n        // If drag to student list.\r\n        if($(target).hasClass('teamwork_students')){\r\n            let item = $(source).parent().find('.teamwork_team-inner');\r\n\r\n            renderPageAfterDrag(el, true, function () {\r\n                render.setDefaultData();\r\n                render.studentList();\r\n                render.teamsCard();\r\n            });\r\n\r\n            // Delete user submission.\r\n            // if ($(el).find('.delete_user_submit-btn').length) {\r\n            //     $(el).find('.delete_user_submit-btn')[0].click();\r\n            // } else {\r\n            //     renderPageAfterDrag(el, false, function () {\r\n            //         render.setDefaultData();\r\n            //         render.studentList();\r\n            //         render.teamsCard();\r\n            //     });\r\n            // }\r\n\r\n            // Close popup \"remove teamcard\".\r\n            // if(item.find('.teamwork_student').length === 0){\r\n            //     Str.get_strings([\r\n            //         { key: 'titlepopupremoveteam', component: 'local_teamwork' },\r\n            //         { key: 'contentpopupremoveteam', component: 'local_teamwork' },\r\n            //         { key: 'buttonpopupremoveteam', component: 'local_teamwork' },\r\n            //     ]).done(function (strings) {\r\n            //\r\n            //         var modalPromise = ModalFactory.create({\r\n            //             type: ModalFactory.types.SAVE_CANCEL,\r\n            //             title: strings[0],\r\n            //             body: strings[1]\r\n            //         });\r\n            //\r\n            //         $.when(modalPromise).then(function (fmodal) {\r\n            //\r\n            //             fmodal.setSaveButtonText(strings[2]);\r\n            //\r\n            //             // Handle save event.\r\n            //             fmodal.getRoot().on(ModalEvents.save, function (e) {\r\n            //                 e.preventDefault();\r\n            //\r\n            //                 renderPageAfterDrag(el, true, function () {\r\n            //                     render.setDefaultData();\r\n            //                     render.studentList();\r\n            //                     render.teamsCard();\r\n            //                 });\r\n            //\r\n            //                 fmodal.destroy();\r\n            //             });\r\n            //\r\n            //             fmodal.getRoot().on(ModalEvents.hidden, function () {\r\n            //\r\n            //                 renderPageAfterDrag(el, false, function () {\r\n            //                     render.setDefaultData();\r\n            //                     render.studentList();\r\n            //                     render.teamsCard();\r\n            //                 });\r\n            //\r\n            //                 fmodal.destroy();\r\n            //             });\r\n            //\r\n            //             return fmodal;\r\n            //         }).done(function (modal) {\r\n            //             modal.show();\r\n            //         }).fail(Notification.exception);\r\n            //     })\r\n            // }else{\r\n            //     renderPageAfterDrag(el, false, function () {\r\n            //         render.setDefaultData();\r\n            //         render.studentList();\r\n            //         render.teamsCard();\r\n            //     });\r\n            // }\r\n        }else{\r\n\r\n\r\n            let item = $(source).parent().find('.teamwork_team-inner');\r\n\r\n            // Delete user submission.\r\n            // if ($(el).find('.delete_user_submit-btn').length) {\r\n            //\r\n            //     Str.get_strings([\r\n            //         {key: 'titlepopupremoveuser', component: 'local_teamwork'},\r\n            //         {key: 'contentpopupremoveuser', component: 'local_teamwork'},\r\n            //         {key: 'buttonpopupremoveuser', component: 'local_teamwork'},\r\n            //     ]).done(function(strings) {\r\n            //         var modalPromise = ModalFactory.create({\r\n            //             type: ModalFactory.types.SAVE_CANCEL,\r\n            //             title: strings[0],\r\n            //             body: strings[1]\r\n            //         });\r\n            //\r\n            //         $.when(modalPromise).then(function(fmodal) {\r\n            //\r\n            //             fmodal.setSaveButtonText(strings[2]);\r\n            //\r\n            //             // Handle save event.\r\n            //             fmodal.getRoot().on(ModalEvents.save, function(e) {\r\n            //                 e.preventDefault();\r\n            //\r\n            //                 renderPageAfterDrag(el, false, function () {\r\n            //                     render.setDefaultData();\r\n            //                     render.studentList();\r\n            //                     render.teamsCard();\r\n            //                     $('.skin.shadow').removeAttr(\"style\");\r\n            //                     fmodal.destroy();\r\n            //                 });\r\n            //             });\r\n            //\r\n            //             fmodal.getRoot().on(ModalEvents.cancel, function(e) {\r\n            //                 render.setDefaultData();\r\n            //                 render.studentList();\r\n            //                 render.teamsCard();\r\n            //                 $('.skin.shadow').removeAttr(\"style\");\r\n            //                 fmodal.destroy();\r\n            //                 Keyboardnav.setFocusOnPrevfocusedElement();\r\n            //             });\r\n            //\r\n            //             var root = fmodal.getRoot();\r\n            //             root.on(ModalEvents.shown, function() {\r\n            //                 $('.skin.shadow').css(\"z-index\", \"1000\");\r\n            //             });\r\n            //\r\n            //             root.on(ModalEvents.hidden, function() {\r\n            //                 render.setDefaultData();\r\n            //                 render.studentList();\r\n            //                 render.teamsCard();\r\n            //                 $('.skin.shadow').removeAttr(\"style\");\r\n            //                 fmodal.destroy();\r\n            //                 Keyboardnav.setFocusOnPrevfocusedElement();\r\n            //             });\r\n            //\r\n            //             return fmodal;\r\n            //         }).done(function(modal) {\r\n            //             modal.show();\r\n            //         }).fail(Notification.exception);\r\n            //     });\r\n            // } else {\r\n            //     renderPageAfterDrag(el, false, function () {\r\n            //         render.setDefaultData();\r\n            //         render.studentList();\r\n            //         render.teamsCard();\r\n            //     });\r\n            // }\r\n\r\n            renderPageAfterDrag(el, false, function () {\r\n                render.setDefaultData();\r\n                render.studentList();\r\n                render.teamsCard();\r\n            });\r\n        }\r\n    };\r\n\r\n    const drag = {\r\n        startDrag: function () {\r\n            dragula({\r\n                isContainer: function (el) {\r\n                    return el.classList.contains('draggable');\r\n                },\r\n                accepts: function (el, target) {\r\n                    if (!target.classList.contains('stop-drag')) {\r\n                        return target;\r\n                    }\r\n\r\n                },\r\n                invalid: function (el, handle) {\r\n                    if (el.classList.contains('stop-drag-item')) {\r\n                        return true;\r\n                    }\r\n                }\r\n            }).on('drop', checkOverflowAndRender)\r\n        }\r\n    };\r\n\r\n    return drag;\r\n});\r\n"],"names":["define","$","Str","Ajax","render","popup","loadingIcon","dragula","ModalFactory","ModalEvents","Keyboardnav","Notification","renderPageAfterDrag","el","removeteam","callback","allTeamsBlocks","Array","from","document","querySelectorAll","allTeams","draguserid","dataset","student_id","forEach","item","team","teamid","team_id","studentid","student","push","show","call","methodname","args","courseid","Number","data","activityid","moduletype","selectgroupid","newteamspost","JSON","stringify","done","remove","fail","error","checkOverflowAndRender","target","source","maxCount","max_count","childElementCount","classList","add","hasClass","parent","find","setDefaultData","studentList","teamsCard","startDrag","isContainer","contains","accepts","invalid","handle","on"],"mappings":"AAAAA,gCAAO,CACH,SACA,WACA,YACA,wBACA,uBACA,yBACA,+BACA,qBACA,oBACA,6BACA,sBACD,SAAUC,EAAGC,IAAKC,KAAMC,OAAQC,MAAOC,YAAaC,QAASC,aAAcC,YAAaC,YAAaC,oBAG9FC,oBAAsB,CAACC,GAAIC,WAAYC,kBAEnCC,eAAiBC,MAAMC,KAAKC,SAASC,iBAAiB,sBACtDC,SAAW,GACXC,WAAaT,GAAGU,QAAQC,WAG9BR,eAAeS,SAASC,WAChBC,KAAO,GACXA,KAAKC,OAASF,KAAKH,QAAQM,QAC3BF,KAAKG,UAAY,GAECb,MAAMC,KAAKQ,KAAKN,iBAAiB,sBACvCK,SAASM,UACjBJ,KAAKG,UAAUE,KAAKD,QAAQR,QAAQC,eAExCH,SAASW,KAAKL,SAGlBrB,YAAY2B,OACZ9B,KAAK+B,KAAK,CAAC,CACPC,WAAY,mCACZC,KAAM,CACFC,SAAUC,OAAOlC,OAAOmC,KAAKF,UAC7BG,WAAYF,OAAOlC,OAAOmC,KAAKC,YAC/BC,WAAYrC,OAAOmC,KAAKE,WACxBC,cAAetC,OAAOmC,KAAKG,cAC3BC,aAAcC,KAAKC,UAAUxB,UAC7BC,WAAYgB,OAAOhB,YACnBR,WAAYA,YAEhBgC,KAAM,SAAUP,MACZjC,YAAYyC,SACZhC,SAASwB,OAEbS,KAAM,WACF1C,YAAYyC,SACZ1C,MAAM4C,aAKZC,uBAAyB,CAACrC,GAAIsC,OAAQC,cAEpCC,SAAWD,OAAO7B,QAAQ+B,aAE1BH,OAAOI,oBAAsBF,UAC7BF,OAAOK,UAAUC,IAAI,aAErBL,OAAOG,kBAAoBF,UAC3BD,OAAOI,UAAUT,OAAO,aAIzB9C,EAAEkD,QAAQO,SAAS,qBAAqB,CAC5BzD,EAAEmD,QAAQO,SAASC,KAAK,wBAEnChD,oBAAoBC,IAAI,GAAM,WAC1BT,OAAOyD,iBACPzD,OAAO0D,cACP1D,OAAO2D,mBAoEV,CAGU9D,EAAEmD,QAAQO,SAASC,KAAK,wBAqEnChD,oBAAoBC,IAAI,GAAO,WAC3BT,OAAOyD,iBACPzD,OAAO0D,cACP1D,OAAO2D,uBAKN,CACTC,UAAW,WACPzD,QAAQ,CACJ0D,YAAa,SAAUpD,WACZA,GAAG2C,UAAUU,SAAS,cAEjCC,QAAS,SAAUtD,GAAIsC,YACdA,OAAOK,UAAUU,SAAS,oBACpBf,QAIfiB,QAAS,SAAUvD,GAAIwD,WACfxD,GAAG2C,UAAUU,SAAS,yBACf,KAGhBI,GAAG,OAAQpB"}