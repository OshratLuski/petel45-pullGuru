define("local_diagnostic/activities",["jquery","core/templates","core/str","core/ajax","core/notification"],(function($,Templates,Str,Ajax,Notification){return class{constructor(p_,translateObj,shapesItems,CircleAnimation,courseId){this.p_={...p_},this.translateObj=translateObj,this.modal,this.currentCluster,this.data={},this.shapesItems=shapesItems,this.CircleAnimation=CircleAnimation,this.courseId=courseId,this.clustersIds=[],this.init()}init(){let self=this;for(let i=1;i<this.shapesItems.length;i++){let obj=this.shapesItems[i];obj&&obj.data&&obj.data.id&&self.clustersIds.push(obj.data.id)}this.actions()}getData(){return console.log("data ",this.data),this.data}isDataEmpty(){let data=this.data,result=!0;if(0!==Object.keys(data).length)for(let key in data)0!==data[key].cmidsRepo.length&&(result=!1),0!==data[key].cmidsCourse.length&&(result=!1),0!==data[key].cmidsRecom.length&&(result=!1);else result=!0;return result}checkParrentCheckbox(){$('div.local-diagnostic-base-block #local_diagnostic_activities_modal ul input.parent[type="checkbox"]').each((function(){const parentUl=$(this).closest("ul");let allChecked=!0;parentUl.find("input.child").each((function(){$(this).is(":checked")||(allChecked=!1)})),allChecked?parentUl.find("input.parent").prop("checked",!0):parentUl.find("input.parent").prop("checked",!1)}))}async circleSelectAll(){for(let i=0;i<this.clustersIds.length;i++){let key=this.clustersIds[i],cmidsArr=this.data[key].cmidsCourse,repoArr=this.data[key].cmidsRepo,recomArr=this.data[key].cmidsRecom,description=this.data[key].description,translateCmids=await Str.get_string("selected_from_my_courses","local_diagnostic",cmidsArr.length),translateRecom=await Str.get_string("selected_from_recom","local_diagnostic",cmidsArr.length),translateRepo=await Str.get_string("selected_from_repository","local_diagnostic",repoArr.length),borderColor="#FFFFFF";(cmidsArr.length>0||repoArr.length>0)&&(borderColor="#4B7F3E",$(".popup-local-diagnostic g.claster-".concat(key," rect")).remove()),$(".popup-local-diagnostic g.claster-".concat(key," circle")).css("stroke",borderColor),cmidsArr.length>0?($(".popup-local-diagnostic g.claster-".concat(key," .bottom-block .text-under-claster")).css("display","block"),$(".popup-local-diagnostic g.claster-".concat(key," .bottom-block .text-under-claster")).html(translateCmids)):$(".popup-local-diagnostic g.claster-".concat(key," .bottom-block .text-under-claster")).css("display","none"),repoArr.length>0?($(".popup-local-diagnostic g.claster-".concat(key," .bottom-block .text-under-claster-repo")).css("display","block"),$(".popup-local-diagnostic g.claster-".concat(key," .bottom-block .text-under-claster-repo")).html(translateRepo)):$(".popup-local-diagnostic g.claster-".concat(key," .bottom-block .text-under-claster-repo")).css("display","none"),recomArr.length>0?($(".popup-local-diagnostic g.claster-".concat(key," .bottom-block .text-under-claster-repo")).css("display","block"),$(".popup-local-diagnostic g.claster-".concat(key," .bottom-block .text-under-claster-repo")).html(translateRecom)):$(".popup-local-diagnostic g.claster-".concat(key," .bottom-block .text-under-claster-repo")).css("display","none"),(description||""===description)&&$(".popup-local-diagnostic g.claster-".concat(key," .bottom-block .description-cluster")).html(description),this.shapesItems[key].p_&&(this.shapesItems[key].p_.backBorderColor=borderColor,cmidsArr.length>0&&(this.shapesItems[key].p_.activities=translateCmids),repoArr.length>0&&(this.shapesItems[key].p_.activitiesRepo=translateRepo),recomArr.length>0&&(this.shapesItems[key].p_.activitiesRecom=translateRecom),(description||""===description)&&(this.shapesItems[key].p_.description=description))}}async circleSelect(activitiesArr,repoArr,recomArr,description){let translateCourse,translateRepo,translateRecom;translateCourse=activitiesArr.length>0?await Str.get_string("selected_from_my_courses","local_diagnostic",activitiesArr.length):"",translateRepo=repoArr.length>0?await Str.get_string("selected_from_repository","local_diagnostic",repoArr.length):"",translateRecom=recomArr.length>0?await Str.get_string("selected_from_recom","local_diagnostic",recomArr.length):"";let borderColor="#FFFFFF";(activitiesArr.length>0||repoArr.length>0||recomArr.length>0)&&(borderColor="#4B7F3E",$(".popup-local-diagnostic g.claster-".concat(this.currentCluster," rect")).remove()),$(".popup-local-diagnostic g.claster-".concat(this.currentCluster," circle")).css("stroke",borderColor),activitiesArr.length>0?($(".popup-local-diagnostic g.claster-".concat(this.currentCluster," .bottom-block .text-under-claster")).css("display","block"),$(".popup-local-diagnostic g.claster-".concat(this.currentCluster," .bottom-block .text-under-claster")).html(translateCourse)):$(".popup-local-diagnostic g.claster-".concat(this.currentCluster," .bottom-block .text-under-claster")).css("display","none"),repoArr.length>0?($(".popup-local-diagnostic g.claster-".concat(this.currentCluster," .bottom-block .text-under-claster-repo")).css("display","block"),$(".popup-local-diagnostic g.claster-".concat(this.currentCluster," .bottom-block .text-under-claster-repo")).html(translateRepo)):$(".popup-local-diagnostic g.claster-".concat(this.currentCluster," .bottom-block .text-under-claster-repo")).css("display","none"),recomArr.length>0?($(".popup-local-diagnostic g.claster-".concat(this.currentCluster," .bottom-block .text-under-claster-recom")).css("display","block"),$(".popup-local-diagnostic g.claster-".concat(this.currentCluster," .bottom-block .text-under-claster-recom")).html(translateRecom)):$(".popup-local-diagnostic g.claster-".concat(this.currentCluster," .bottom-block .text-under-claster-recom")).css("display","none"),$(".popup-local-diagnostic g.claster-".concat(this.currentCluster," .bottom-block .description-cluster")).html(description);let shapesItem=null;this.shapesItems.forEach((function(objshape){objshape.clusternum===self.currentCluster&&(shapesItem=objshape)})),shapesItem.p_&&(shapesItem.p_.backBorderColor=borderColor,shapesItem.p_.activities=translateCourse,shapesItem.p_.activitiesRepo=translateRepo,shapesItem.p_.activitiesRecom=translateRecom,shapesItem.p_.description=description)}async clearData(){let self=this;self.data={};for(let i=0;i<self.shapesItems.length;i++)self.currentCluster=i,await self.circleSelect([],[],"")}changeDataAll(){let cmidsCourse=arguments.length>0&&void 0!==arguments[0]&&arguments[0],cmidsRepo=arguments.length>1&&void 0!==arguments[1]&&arguments[1],cmidsRecom=arguments.length>2&&void 0!==arguments[2]&&arguments[2],description=arguments.length>3&&void 0!==arguments[3]&&arguments[3],recommend=arguments.length>4&&void 0!==arguments[4]&&arguments[4],self=this;for(let i=0;i<self.clustersIds.length;i++){let key=self.clustersIds[i];key in self.data?(cmidsCourse&&(self.data[key].cmidsCourse=cmidsCourse),cmidsRepo&&(self.data[key].cmidsRepo=cmidsRepo),cmidsRecom&&(self.data[key].cmidsRecom=cmidsRecom),(description||""===description)&&(self.data[key].description=description),self.data[key].recommend=recommend):self.data[key]={cmidsCourse:cmidsCourse||[],cmidsRepo:cmidsRepo||[],cmidsRecom:cmidsRecom||[],description:description||"",recommend:recommend}}self.circleSelectAll(),self.isDataEmpty()?$("div.popup-local-diagnostic-main-modal .modal-footer").css("display","none"):$("div.popup-local-diagnostic-main-modal .modal-footer").css("display","flex")}changeData(){let cmidsCourse=arguments.length>0&&void 0!==arguments[0]&&arguments[0],cmidsRepo=arguments.length>1&&void 0!==arguments[1]&&arguments[1],cmidsRecom=arguments.length>2&&void 0!==arguments[2]&&arguments[2],description=arguments.length>3&&void 0!==arguments[3]&&arguments[3],recommend=arguments.length>4&&void 0!==arguments[4]&&arguments[4],self=this;self.currentCluster in self.data?(cmidsCourse&&(self.data[self.currentCluster].cmidsCourse=cmidsCourse),cmidsRepo&&(self.data[self.currentCluster].cmidsRepo=cmidsRepo),cmidsRecom&&(self.data[self.currentCluster].cmidsRecom=cmidsRecom),(""===description||description)&&(self.data[self.currentCluster].description=description),self.data[self.currentCluster].recommend=recommend):self.data[self.currentCluster]={cmidsCourse:cmidsCourse||[],cmidsRepo:cmidsRepo||[],cmidsRecom:cmidsRecom||[],description:description||"",recommend:recommend};let cmidsReroArr=self.data[self.currentCluster].cmidsRepo,cmidsCourseArr=self.data[self.currentCluster].cmidsCourse,cmidsRecomArr=self.data[self.currentCluster].cmidsRecom;self.circleSelect(cmidsCourseArr,cmidsReroArr,cmidsRecomArr,self.data[self.currentCluster].description),self.isDataEmpty()?$("div.popup-local-diagnostic-main-modal .modal-footer").css("display","none"):$("div.popup-local-diagnostic-main-modal .modal-footer").css("display","flex")}async actions(){const self=this,p_=self.p_;var promise=Ajax.call([{methodname:"local_diagnostic_get_all_course_quizzes",args:{courseid:self.courseId}}]);const checkboxesText=await promise[0].done((function(data){return data})).fail((function(ex){return console.log(ex),!1})),openModalEl=$("".concat(p_.htmlRootElement," .svgСharts-tooltip-select div.activity-course"));openModalEl.off("click"),openModalEl.on("click",(async function(){let parentEl=$(this).closest(".svgСharts-tooltip-select");if(self.currentCluster=parentEl.attr("data-claster"),"all"===self.currentCluster)return void actionActivityCourseAll();let clusterName="",clusterInfo="";self.shapesItems.forEach((function(objshape){objshape.clusternum===self.currentCluster&&(clusterName=objshape.data.clustername,clusterInfo=objshape.data.info)})),Templates.render("local_diagnostic/activities-body",{title:self.translateObj.share_activities_course_title,data:checkboxesText||"",clusterName:clusterName}).done((function(html,js){Templates.replaceNodeContents("#local_diagnostic_activities_modal .modal-body",html,js);var zindex=$(".popup-local-diagnostic-main-modal").css("z-index");zindex+=1,$("#local_diagnostic_activities_modal").css("z-index",zindex),$("#local_diagnostic_activities_modal").modal("show")})).fail(Notification.exception),$("#local_diagnostic_description_modal textarea").val(""),$("#local_diagnostic_description_modal div.description-info").html(clusterInfo),$("#local_diagnostic_description_modal div.modal-body-description h3 b").html(clusterName),self.data&&self.data[self.currentCluster]&&self.data[self.currentCluster].cmidsCourse&&(self.data[self.currentCluster].cmidsCourse.forEach((el=>{$("div.local-diagnostic-base-block #local_diagnostic_activities_modal ul input[data-id=".concat(el,"]")).prop("checked",!0)})),self.checkParrentCheckbox(),self.data[self.currentCluster].description&&$("#local_diagnostic_description_modal textarea").val(self.data[self.currentCluster].description),self.data[self.currentCluster].recommend&&$('#local_diagnostic_description_modal .modal-body-recommend input[type="checkbox"]').val(self.data[self.currentCluster].recommend))})),$("body").off("click","div.popup-local-diagnostic .activities-diagnostic .parent"),$("body").on("click","div.popup-local-diagnostic .activities-diagnostic .parent",(function(){const parentUl=$(this).closest("ul");$(this).is(":checked")?parentUl.find("input").prop("checked",!0):parentUl.find("input").prop("checked",!1)})),$("body").off("click","div.popup-local-diagnostic .activities-diagnostic input.child"),$("body").on("click","div.popup-local-diagnostic .activities-diagnostic input.child",(function(){const parentUl=$(this).closest("ul");let allChecked=!0;parentUl.find("input.child").each((function(){$(this).is(":checked")||(allChecked=!1)})),allChecked?parentUl.find("input.parent").prop("checked",!0):parentUl.find("input.parent").prop("checked",!1)})),$("body").off("click","#local_diagnostic_activities_modal #submit"),$("body").on("click","#local_diagnostic_activities_modal #submit",(async function(){var zindex=$("#local_diagnostic_activities_modal").css("z-index");zindex+=1,$("#local_diagnostic_description_modal").css("z-index",zindex),$("div.popup-local-diagnostic-main-modal").css("visibility","hidden"),$("#local_diagnostic_description_modal").modal("show")})),$("body").off("click","#local_diagnostic_description_modal #description_submit"),$("body").on("click","#local_diagnostic_description_modal #description_submit",(function(){const checkboxes=$('div.popup-local-diagnostic .activities-diagnostic ul input.child[type="checkbox"]');let cmidsArr=[];checkboxes.each((function(){let this_=$(this),id=this_.attr("data-id");this_.is(":checked")&&cmidsArr.push(id)}));const description=$("#local_diagnostic_description_modal textarea").val(),recommend=$("#local_diagnostic_description_modal input.recommend").is(":checked");"all"===self.currentCluster?self.changeDataAll(cmidsArr,!1,!1,description,recommend):self.changeData(cmidsArr,!1,!1,description,recommend),$("#local_diagnostic_description_modal").modal("hide"),$("#local_diagnostic_activities_modal").modal("hide"),$("div.popup-local-diagnostic-main-modal").css("visibility","visible")})),$("body").off("click","#local_diagnostic_description_modal .description-close"),$("body").on("click","#local_diagnostic_description_modal .description-close",(function(){$("div.popup-local-diagnostic-main-modal").css("visibility","visible")}));const openRecomModalTraverse=$("".concat(p_.htmlRootElement," .svgСharts-tooltip-select div.activity-recom"));openRecomModalTraverse.off("click"),openRecomModalTraverse.on("click",(async function(){let parentEl=$(this).closest(".svgСharts-tooltip-select");if(self.currentCluster=parentEl.attr("data-claster"),"all"===self.currentCluster)return void actionActivityCourseAll();let clusterName="";self.shapesItems[self.currentCluster]&&self.shapesItems[self.currentCluster].data&&self.shapesItems[self.currentCluster].data.clustername&&(clusterName=self.shapesItems[self.currentCluster].data.clustername),self.shapesItems[self.currentCluster]&&self.shapesItems[self.currentCluster].data&&self.shapesItems[self.currentCluster].data.clusternum&&(clusterName=self.shapesItems[self.currentCluster].data.clusternum),Templates.render("local_diagnostic/recommend-body",{title:self.translateObj.share_activities_recom_title,titletext:self.translateObj.share_activities_recom_titletext,data:self.p_.data[self.currentCluster].recommend?self.p_.data[self.currentCluster].recommend:"",clusterName:clusterName}).done((function(html,js){Templates.replaceNodeContents("#local_diagnostic_recommend_modal .modal-body",html,js);var zindex=$(".popup-local-diagnostic-main-modal").css("z-index");zindex+=1,$("#local_diagnostic_recommend_modal").css("z-index",zindex),$("#local_diagnostic_recommend_modal").modal("show")})).fail(Notification.exception),$("#local_diagnostic_description_recom_modal textarea").val(""),$("#local_diagnostic_description_recom_modal div.description-info").html(self.shapesItems[self.currentCluster].data.info),$("#local_diagnostic_description_recom_modal div.modal-body-description-recom h3 b").html(clusterName),self.data&&self.data[self.currentCluster]&&self.data[self.currentCluster].cmidsRecom&&(self.data[self.currentCluster].cmidsRecom.forEach((el=>{$("div.local-diagnostic-base-block #local_diagnostic_recommend_modal ul input[data-id=".concat(el,"]")).prop("checked",!0)})),self.checkParrentCheckbox(),self.data[self.currentCluster].description&&$("#local_diagnostic_description_recom_modal textarea").val(self.data[self.currentCluster].description),self.data[self.currentCluster].recommend&&$('#local_diagnostic_description_recom_modal .modal-body-recommend input[type="checkbox"]').val(self.data[self.currentCluster].recommend))})),$("body").off("click","div.popup-local-diagnostic .recommend-diagnostic .selectall"),$("body").on("click","div.popup-local-diagnostic .recommend-diagnostic .selectall",(function(){const parentContainer=$(this).closest(".recommend-diagnostic");$(this).is(":checked")?parentContainer.find("input").prop("checked",!0):parentContainer.find("input").prop("checked",!1)})),$("body").off("click","div.popup-local-diagnostic .recommend-diagnostic input.child"),$("body").on("click","div.popup-local-diagnostic .recommend-diagnostic input.child",(function(){const parentContainer=$(this).closest(".recommend-diagnostic");let allChecked=!0;parentContainer.find("input.child").each((function(){$(this).is(":checked")||(allChecked=!1)})),allChecked?parentContainer.find("input.parent").prop("checked",!0):parentContainer.find("input.parent").prop("checked",!1)})),$("body").off("click","div.popup-local-diagnostic .recommend-diagnostic .toggle-descr"),$("body").off("click","div.popup-local-diagnostic .recommend-diagnostic .recom-body-outer"),$("body").on("click","div.popup-local-diagnostic .recommend-diagnostic .recom-body-outer",(function(){$(this).find(".toggle-descr").toggleClass("fa-caret-down"),$(this).find(".toggle-descr").toggleClass("fa-caret-up");let outer=$(this).closest(".recom-body-outer");outer.find(".recom-body-descr-inner").toggleClass("hidden"),outer.toggleClass("opened")})),$("body").off("click","#local_diagnostic_recommend_modal #submit"),$("body").on("click","#local_diagnostic_recommend_modal #submit",(async function(){var zindex=$("#local_diagnostic_recommend_modal").css("z-index");zindex+=1,$("#local_diagnostic_description_recom_modal").css("z-index",zindex),$("div.popup-local-diagnostic-main-modal").css("visibility","hidden"),$("#local_diagnostic_description_recom_modal").modal("show")})),$("body").off("click","#local_diagnostic_description_recom_modal #description_submit"),$("body").on("click","#local_diagnostic_description_recom_modal #description_submit",(function(){const checkboxes=$('div.popup-local-diagnostic .recommend-diagnostic input.child[type="checkbox"]');let cmidsRecom=[];checkboxes.each((function(){let this_=$(this),id=this_.attr("data-id");this_.is(":checked")&&cmidsRecom.push(id)}));const description=$("#local_diagnostic_description_recom_modal textarea").val(),recommend=$("#local_diagnostic_description_recom_modal input.recommend").is(":checked");"all"===self.currentCluster?self.changeDataAll(!1,!1,cmidsRecom,description,recommend):self.changeData(!1,!1,cmidsRecom,description,recommend),$("#local_diagnostic_description_recom_modal").modal("hide"),$("#local_diagnostic_recommend_modal").modal("hide"),$("div.popup-local-diagnostic-main-modal").css("visibility","visible")})),$("body").off("click","#local_diagnostic_description_recom_modal .description-close"),$("body").on("click","#local_diagnostic_description_recom_modal .description-close",(function(){$("div.popup-local-diagnostic-main-modal").css("visibility","visible")}));const activityRepoModalEl=$("".concat(p_.htmlRootElement," .svgСharts-tooltip-select div.activity-repo"));async function actionActivityCourseAll(){Templates.render("local_diagnostic/activities-body",{title:self.translateObj.share_activities_course_title_all,data:checkboxesText||"",clusterName:self.translateObj.all_clusters}).done((function(html,js){Templates.replaceNodeContents("#local_diagnostic_activities_modal .modal-body",html,js);var zindex=$(".popup-local-diagnostic-main-modal").css("z-index");zindex+=1,$("#local_diagnostic_activities_modal").css("z-index",zindex),$("#local_diagnostic_activities_modal").modal("show")})).fail(Notification.exception),$("#local_diagnostic_description_modal textarea").val("");for(let i=0;i<self.clustersIds.length-1;i++)if(!self.data||!self.data[self.clustersIds[i]]||!self.data[self.clustersIds[i]].cmidsCourse)return;let commonArr=[],description=self.data[self.clustersIds[0]].description;for(let i=0;i<self.clustersIds.length-1;i++){0===i&&(commonArr=self.data[self.clustersIds[i]].cmidsCourse);let arrTwo=self.data[self.clustersIds[i+1]].cmidsCourse;commonArr=commonArr.filter((x=>-1!==arrTwo.indexOf(x))),self.data[self.clustersIds[i]].description!==self.data[self.clustersIds[i+1]].description&&(description=!1)}commonArr.forEach((el=>{$("div.local-diagnostic-base-block #local_diagnostic_activities_modal ul input[data-id=".concat(el,"]")).prop("checked",!0)})),self.checkParrentCheckbox(),description&&$("#local_diagnostic_description_modal textarea").val(description)}activityRepoModalEl.off("click"),activityRepoModalEl.on("click",(async function(){let parentEl=$(this).closest(".svgСharts-tooltip-select");self.currentCluster=parentEl.attr("data-claster");let clusterName="",clusterInfo="";"all"===self.currentCluster?clusterName=self.translateObj.all_clusters:self.shapesItems.forEach((function(objshape){objshape.clusternum===self.currentCluster&&(clusterName=objshape.data.clustername,clusterInfo=objshape.data.info)})),$("div.popup-local-diagnostic-main-modal").css("visibility","hidden");let url="".concat(self.p_.wwwRoot,"/local/community/plugins/oer/iframe.php?plugin=activity");$("#local_diagnostic_repository_modal .activities-diagnostic-title b").html(clusterName),$("#local_diagnostic_description_repo_modal div.description-info").html(clusterInfo),$("#local_diagnostic_description_repo_modal div.modal-body-description-repo h3 b").html(clusterName),$("#local_diagnostic_repository_modal iframe").attr("src",url);var zindex=$(".popup-local-diagnostic-main-modal").css("z-index");zindex+=1,$("#local_diagnostic_repository_modal").css("z-index",zindex),$("#local_diagnostic_repository_modal").modal("show")})),$("#local_diagnostic_repository_modal").on("hidden.bs.modal",(function(){$("div.popup-local-diagnostic-main-modal").css("visibility","visible")})),$("#local_diagnostic_repository_modal #repository_submit").off("click"),$("#local_diagnostic_repository_modal #repository_submit").on("click",(function(){let clusterName="",clusterInfo="",clusterDescription="",recommend=0;self.shapesItems.forEach((function(objshape){objshape.clusternum==self.currentCluster&&(clusterName=objshape.data.clustername,clusterInfo=objshape.data.info,clusterDescription=objshape.data.description,recommend=objshape.data.recommend)})),$("#local_diagnostic_description_repo_modal textarea").val(""),$("#local_diagnostic_description_modal div.repo-description-info").html(clusterInfo),clusterDescription&&$("#local_diagnostic_description_repo_modal textarea").val(clusterDescription),recommend&&$('#local_diagnostic_description_repo_modal .modal-body-recommend input[type="checkbox"]').val(recommend);var zindex=$("#local_diagnostic_repository_modal").css("z-index");zindex+=1,$("#local_diagnostic_description_repo_modal").css("z-index",zindex),$("div.popup-local-diagnostic-main-modal").css("visibility","hidden"),$("#local_diagnostic_description_repo_modal").modal("show")})),$("#local_diagnostic_description_repo_modal #description_submit_repo").off("click"),$("#local_diagnostic_description_repo_modal #description_submit_repo").on("click",(function(){let iframeEl=$("#local_diagnostic_repository_modal #repository_iframe"),checkedEl=$("#oer_activity_items_selected",iframeEl.contents()),repActivitiesArr=[];try{repActivitiesArr=JSON.parse(checkedEl.val())}catch(e){}const description=$("#local_diagnostic_description_repo_modal textarea").val(),recommend=$("#local_diagnostic_description_repo_modal input.recommend").is(":checked");"all"===self.currentCluster?self.changeDataAll(!1,repActivitiesArr,!1,description,recommend):self.changeData(!1,repActivitiesArr,!1,description,recommend),$("#local_diagnostic_repository_modal").modal("hide"),$("#local_diagnostic_description_repo_modal").modal("hide"),$("div.popup-local-diagnostic-main-modal").css("visibility","visible")}))}}}));

//# sourceMappingURL=activities.min.js.map