{"version":3,"file":"question-list.min.js","sources":["../src/question-list.js"],"sourcesContent":["define(['jquery', 'core/templates','core/ajax'], function($, Templates, Ajax) {\r\n  class QuestionList {\r\n    constructor(data, popupElement, adParams) {\r\n      this.data = {...data};\r\n      this.data.table = data.table;\r\n      this.popupElement = popupElement;\r\n      this.adParams = adParams;\r\n    }\r\n\r\n    dataChange() {\r\n      let objectLast = [];\r\n      for (const [mid, clustertablebymid] of Object.entries(this.data.table)) {\r\n        let objectTable = {\r\n          rows: [],\r\n          clusters: [],\r\n          name: clustertablebymid.name,\r\n          repocmid: clustertablebymid.repocmid,\r\n          midurl: this.data.midurl,\r\n          midfilename: this.data.midfilename,\r\n          mid: this.data.mid,\r\n          hasimportant: clustertablebymid.hasimportant\r\n        };\r\n        let questionsIds = [];\r\n        for (const [clusterkey, clustertable] of Object.entries(clustertablebymid.data)) {\r\n          for (const [partOfKey, value] of Object.entries(clustertable.table)) {\r\n            if (!questionsIds.find(el => el === partOfKey)) {\r\n              questionsIds.push(partOfKey);\r\n            }\r\n            let findEl = objectTable.rows.find(obj => obj.question === partOfKey);\r\n            if (!findEl) {\r\n              objectTable.rows.push({\r\n                question: partOfKey,\r\n                qname: value.qname,\r\n                repocmid: this.data.repocmid,\r\n                slot: value.slot,\r\n                number: value.number,\r\n                important: value.important,\r\n                qid: value.qid,\r\n                value: [{\r\n                  clasterId: clusterkey,\r\n                  clustername: clustertable.clustername,\r\n                  color: value.color,\r\n                  prc: value.prc\r\n                }]\r\n              });\r\n            } else {\r\n              findEl.value.push({\r\n                clasterId: clusterkey,\r\n                clustername: clustertable.clustername,\r\n                color: value.color,\r\n                prc: value.prc,\r\n              });\r\n            }\r\n          }\r\n\r\n          objectTable.clusters.push({name: clustertable.clustername, prc: clustertable.avg});\r\n        }\r\n        objectLast.push(objectTable);\r\n      }\r\n      console.log(objectLast);\r\n      return {tabledata: objectLast};\r\n    }\r\n\r\n    addAction(bubbleObject) {\r\n      let self = this;\r\n      $(`${self.popupElement} .question-list`).css('display', 'none');\r\n      $(`${self.popupElement} .q-lright-icon i`).removeClass('rotate-0');\r\n\r\n      $(document).ready(function() {\r\n        $(\"html\").off(\"click\", `${self.popupElement} .question-list-button`);\r\n        $(\"html\").on(\"click\", `${self.popupElement} .question-list-button`, function() {\r\n          let popiEl = $(`${self.popupElement} .q-lright-icon i`);\r\n          let questionListEl = $(`${self.popupElement} .question-list`);\r\n          let qScrollTable = $(`${self.popupElement} .question-scroll-table`);\r\n          if (questionListEl.css(\"display\") != 'block'){\r\n            let promise = Ajax.call([{\r\n              methodname: 'local_diagnostic_user_table',\r\n              args: {\r\n                cmid: self.data.cmid,\r\n                mid: self.data.mid\r\n              }\r\n            }]);\r\n          }\r\n\r\n          questionListEl.toggle(\"slow\", function() {\r\n            afterAnimation();\r\n            questionListEl.stop(true);\r\n            $('.list-table-p-tooltip').tooltip();\r\n          });\r\n\r\n          /**\r\n           *\r\n           */\r\n          function afterAnimation() {\r\n            popiEl.toggleClass(\"rotate-0\");\r\n\r\n            let topBlockXPosition =\r\n            bubbleObject.documentWith - bubbleObject.topBlockWith - bubbleObject.topBlockRightSpace - $(`${self.popupElement} .question-list-block`).width() - 7;\r\n\r\n            let windowWidth = $(window).width();\r\n\r\n            let topBlockYPosition;\r\n            if (windowWidth >= 1200 && windowWidth < 1400) {\r\n              topBlockYPosition = 54;\r\n            } else {\r\n              topBlockYPosition = 0;\r\n            }\r\n\r\n            if (windowWidth >= 1200) {\r\n              if (popiEl.hasClass(\"rotate-0\")) {\r\n                bubbleObject.changePositionCirclesZero(true);\r\n                bubbleObject.changePositionAllCircles();\r\n                bubbleObject.topBlockObj.changePosition(topBlockXPosition, topBlockYPosition);\r\n                bubbleObject.bottomBlockItem.changePosition(topBlockXPosition);\r\n              } else {\r\n                bubbleObject.changePositionCirclesZero(false);\r\n                bubbleObject.changePositionAllCircles();\r\n                bubbleObject.topBlockObj.changePosition();\r\n                bubbleObject.bottomBlockItem.changePosition();\r\n              }\r\n            }\r\n          }\r\n\r\n        });\r\n\r\n        $(\"html\").on(\"click\", `${self.popupElement} div.important-shifter-obj:not(.selected)`, function() {\r\n\r\n          if ($(this).hasClass('allquestions')) {\r\n            let allhdrs = $(`${self.popupElement} td.list-table-p-tooltip`);\r\n            let allvals = $(`${self.popupElement} td.list-table-p-val`);\r\n            allhdrs.removeClass('bold');\r\n            allhdrs.css('opacity', 1);\r\n            allvals.css('color', '');\r\n            allvals.css('background-color', '');\r\n          } else {\r\n            let otherhdrs = $(`${self.popupElement} td.list-table-p-tooltip:not(.importanthdr)`);\r\n            let othervals = $(`${self.popupElement} td.list-table-p-val:not(.importantval)`);\r\n            let importantshdrs = $(`${self.popupElement} .importanthdr`);\r\n            importantshdrs.addClass('bold');\r\n            otherhdrs.css('opacity', 0.3);\r\n            othervals.css('color', '#fff');\r\n            othervals.css('background-color', '#fff');\r\n          }\r\n\r\n          let selected = $(`${self.popupElement} div.important-shifter-obj.selected`);\r\n          selected.removeClass('selected');\r\n          $(this).addClass('selected');\r\n          let backgroundcolor = selected.css('background-color');\r\n          $(this).css('background-color', backgroundcolor);\r\n          selected.css('background-color', '');\r\n\r\n        });\r\n      });\r\n    }\r\n  }\r\n\r\n  return function(data, popupElement, adParams) {\r\n    let questionListItem = new QuestionList(data, popupElement, adParams);\r\n    let listData = questionListItem.dataChange();\r\n\r\n    listData.secondarylight = adParams[1].secondarylight;\r\n    listData.light = adParams[1].light;\r\n    listData.secondary = adParams[1].secondary;\r\n    listData.primary = adParams[1].primary;\r\n\r\n    listData.averagePercent = {\r\n      mediumlevel: data.yellow,\r\n      hightlevel: data.green,\r\n    };\r\n\r\n    Templates.render('local_diagnostic/list', listData).done(function(html) {\r\n      let listEl = $(`${popupElement} .question-list-block`);\r\n\r\n      if (listEl.css('visibility') == 'hidden') {\r\n          listEl.css('visibility', 'visible');\r\n      }\r\n      $(`${popupElement} .question-list`).html(html);\r\n    });\r\n    return questionListItem;\r\n  };\r\n\r\n});"],"names":["define","$","Templates","Ajax","QuestionList","constructor","data","popupElement","adParams","this","table","dataChange","objectLast","mid","clustertablebymid","Object","entries","objectTable","rows","clusters","name","repocmid","midurl","midfilename","hasimportant","questionsIds","clusterkey","clustertable","partOfKey","value","find","el","push","findEl","obj","question","clasterId","clustername","color","prc","qname","slot","number","important","qid","avg","console","log","tabledata","addAction","bubbleObject","self","css","removeClass","document","ready","off","on","popiEl","questionListEl","call","methodname","args","cmid","toggle","toggleClass","topBlockYPosition","topBlockXPosition","documentWith","topBlockWith","topBlockRightSpace","width","windowWidth","window","hasClass","changePositionCirclesZero","changePositionAllCircles","topBlockObj","changePosition","bottomBlockItem","afterAnimation","stop","tooltip","allhdrs","allvals","otherhdrs","othervals","addClass","selected","backgroundcolor","questionListItem","listData","secondarylight","light","secondary","primary","averagePercent","mediumlevel","yellow","hightlevel","green","render","done","html","listEl"],"mappings":"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"}