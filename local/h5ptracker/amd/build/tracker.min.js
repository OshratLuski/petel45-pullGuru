define("local_h5ptracker/tracker",["jquery","core/ajax","core/notification"],(function($,Ajax,Notification){return{init:function(type,cmid){$(document).ready((function(){var selector="";if("h5pactivity"===type)selector=".h5p-player";else selector=".h5p-iframe";var parentiFrame=$(selector);!function($i,successFn,errorFn){try{var iCon=$i.first()[0].contentWindow,bl="about:blank",callCallback=function(){try{var $con=$i.contents();if(0===$con.length)throw new Error("iframe inaccessible");successFn($con)}catch(e){errorFn()}},observeOnload=function(){$i.on("load.jqueryMark",(function(){try{var src=$i.attr("src").trim();iCon.location.href===bl&&src!==bl&&""!==src||($i.off("load.jqueryMark"),callCallback())}catch(e){errorFn()}}))};if("complete"===iCon.document.readyState){var src=$i.attr("src").trim();iCon.location.href===bl&&src!==bl&&""!==src?observeOnload():callCallback()}else observeOnload()}catch(e){errorFn()}}(parentiFrame,(function($contents){var iFrame="h5pactivity"===type?$contents.find(".h5p-iframe"):parentiFrame;if(iFrame[0]&&iFrame[0].contentWindow){var H5P=iFrame[0].contentWindow.H5P;if(H5P&&H5P.instances&&H5P.instances[0]){var iframeVideo=H5P.instances[0].video;iframeVideo.on("stateChange",(function(event){var seconds=iframeVideo.getCurrentTime(),action="undefined";switch(event.data){case H5P.Video.ENDED:action="ended";break;case H5P.Video.PLAYING:action="playing";break;case H5P.Video.PAUSED:action="paused"}Ajax.call([{methodname:"local_h5ptracker_track_actions",args:{cmid:cmid,action:action,seconds:seconds}}])[0].fail(Notification.exception)})),iframeVideo.on("playbackRateChange",(function(event){var seconds=iframeVideo.getCurrentTime();Ajax.call([{methodname:"local_h5ptracker_track_actions",args:{cmid:cmid,action:"playbackrate",seconds:seconds}}])[0].fail(Notification.exception)})),H5P.$body.find(".ui-slider-horizontal").on("click",(function(){var seconds=iframeVideo.getCurrentTime();Ajax.call([{methodname:"local_h5ptracker_track_actions",args:{cmid:cmid,action:"seek",seconds:seconds}}])[0].fail(Notification.exception)}))}}}))}))}}}));

//# sourceMappingURL=tracker.min.js.map