{"version":3,"file":"createcourse.min.js","sources":["../src/createcourse.js"],"sourcesContent":["/* eslint-disable no-undef */\n/* eslint-disable no-implicit-globals */\n/* eslint-disable no-unused-vars */\n/* eslint-disable max-len */\n// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Javascript main event handler.\n *\n * @module     local_petel/init\n * @package    local_petel\n * @copyright  2019 Devlionco <info@devlion.co>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @since      3.6\n */\n\n//import {add as notifyUser} from \"../../../../lib/amd/src/toast\";\n\ndefine([\n    'jquery',\n    'core/str',\n    'core/ajax',\n    'core/notification',\n    'core/modal_events',\n    'core/modal_factory',\n    'core/templates',\n    'core/toast'\n], function ($, Str, Ajax, Notification, ModalEvents, ModalFactory, Templates, toast) {\n\n    var unique_id;\n\n    return {\n        init: function (currentuserid) {\n            let self = this;\n\n            $(document).on('click', '.create_course_template', function () {\n                self.checkUserIdNumber(currentuserid, function(res){\n                    if(res){\n                        self.openPopup(currentuserid);\n                    }else{\n                        self.openMessagePopup();\n                    }\n                })\n            });\n        },\n\n        checkUserIdNumber: function (currentuserid, callback) {\n            var self = this;\n            var data = {\n                currentuserid: currentuserid\n            };\n\n            Ajax.call([{\n                methodname: 'local_petel_check_user_idnumber',\n                args: data,\n                done: function (response) {\n\n                    if (response.result) {\n                        callback(true);\n                    }else{\n                        callback(false);\n                    }\n                },\n                fail: Notification.exception\n            }]);\n        },\n\n        openMessagePopup: function () {\n            var self = this;\n\n            // Set new unique_id.\n            unique_id = Date.now();\n\n            let titlePromise = Str.get_string('error');\n\n            Str.get_strings([\n                { key: 'createcourseerror', component: 'local_petel' }\n            ]).done(function (strings) {\n\n                return ModalFactory.create({\n                    type: ModalFactory.types.CANCEL,\n                    body: strings[0],\n                    title: titlePromise,\n                    buttons: {\n                    },\n                    removeOnClose: true,\n                })\n                    .then(modal => {\n                        modal.show();\n                        return modal;\n                    });\n            });\n        },\n\n        openPopup: function (currentuserid) {\n            var self = this;\n\n            // Set new unique_id.\n            unique_id = Date.now();\n\n            let titlePromise = Str.get_string('createcourseteacher', 'local_petel');\n            let name = 'course_name_' + unique_id;\n\n            Str.get_strings([\n                { key: 'coursename', component: 'local_petel' },\n                { key: 'error' },\n            ]).done(function (strings) {\n\n                let template = '<input id=\"'+name+'\" name=\"'+name+'\"  class=\"w-100\" type=\"text\" placeholder=\"'+strings[0]+'\">';\n                template += '<span style=\"display: none;\" class=\"label text-danger error-block\">'+strings[1]+'</span>';\n\n                return ModalFactory.create({\n                    type: ModalFactory.types.SAVE_CANCEL,\n                    body: template,\n                    title: titlePromise,\n                    buttons: {\n                        save: titlePromise,\n                    },\n                    removeOnClose: true,\n                })\n                    .then(modal => {\n                        modal.getRoot().on(ModalEvents.save, () => self.submitPopup(currentuserid, name));\n                        modal.show();\n                        return modal;\n                    });\n            });\n        },\n\n        submitPopup: function (currentuserid, name) {\n\n            let coursename = $( 'input[name*=\"'+name+'\"]' ).val();\n\n            if(coursename.length != 0) {\n                var data = {\n                    coursename: coursename,\n                    currentuserid: currentuserid\n                };\n\n                Ajax.call([{\n                    methodname: 'local_petel_create_course_for_teacher',\n                    args: data,\n                    done: function (response) {\n\n                        if (response.result) {\n                            Str.get_strings([\n                                {key: 'waitcoursecreate', component: 'local_petel'}\n                            ]).done(function (strings) {\n\n                                // Popup success.\n                                let template = strings[0];\n                                let titlePromise = Str.get_string('createcourseteacher', 'local_petel');\n\n                                return ModalFactory.create({\n                                    type: ModalFactory.types.ALERT,\n                                    body: template,\n                                    title: titlePromise,\n                                    buttons: {\n                                        cancel: Str.get_string('createcoursesubmit', 'local_petel'),\n                                    },\n                                    removeOnClose: true,\n                                }).then(modal => {\n                                    modal.show();\n                                    return modal;\n                                });\n                            })\n                        }\n                    },\n                    fail: Notification.exception\n                }]);\n            }else{\n                $('input[name*=\"'+name+'\"]').parent().find('.error-block').show();\n                return false;\n            }\n        },\n    };\n});"],"names":["define","$","Str","Ajax","Notification","ModalEvents","ModalFactory","Templates","toast","unique_id","init","currentuserid","self","this","document","on","checkUserIdNumber","res","openPopup","openMessagePopup","callback","data","call","methodname","args","done","response","result","fail","exception","Date","now","titlePromise","get_string","get_strings","key","component","strings","create","type","types","CANCEL","body","title","buttons","removeOnClose","then","modal","show","name","template","SAVE_CANCEL","save","getRoot","submitPopup","coursename","val","length","parent","find","ALERT","cancel"],"mappings":";;;;;;;;;AA+BAA,kCAAO,CACH,SACA,WACA,YACA,oBACA,oBACA,qBACA,iBACA,eACD,SAAUC,EAAGC,IAAKC,KAAMC,aAAcC,YAAaC,aAAcC,UAAWC,WAEvEC,gBAEG,CACHC,KAAM,SAAUC,mBACRC,KAAOC,KAEXZ,EAAEa,UAAUC,GAAG,QAAS,2BAA2B,WAC/CH,KAAKI,kBAAkBL,eAAe,SAASM,KACxCA,IACCL,KAAKM,UAAUP,eAEfC,KAAKO,0BAMrBH,kBAAmB,SAAUL,cAAeS,cAEpCC,KAAO,CACPV,cAAeA,eAGnBR,KAAKmB,KAAK,CAAC,CACPC,WAAY,kCACZC,KAAMH,KACNI,KAAM,SAAUC,UAERA,SAASC,OACTP,UAAS,GAETA,UAAS,IAGjBQ,KAAMxB,aAAayB,cAI3BV,iBAAkB,WAIdV,UAAYqB,KAAKC,UAEbC,aAAe9B,IAAI+B,WAAW,SAElC/B,IAAIgC,YAAY,CACZ,CAAEC,IAAK,oBAAqBC,UAAW,iBACxCX,MAAK,SAAUY,gBAEP/B,aAAagC,OAAO,CACvBC,KAAMjC,aAAakC,MAAMC,OACzBC,KAAML,QAAQ,GACdM,MAAOX,aACPY,QAAS,GAETC,eAAe,IAEdC,MAAK,SAAAC,cACFA,MAAMC,OACCD,aAKvB7B,UAAW,SAAUP,mBACbC,KAAOC,KAGXJ,UAAYqB,KAAKC,UAEbC,aAAe9B,IAAI+B,WAAW,sBAAuB,eACrDgB,KAAO,eAAiBxC,UAE5BP,IAAIgC,YAAY,CACZ,CAAEC,IAAK,aAAcC,UAAW,eAChC,CAAED,IAAK,WACRV,MAAK,SAAUY,aAEVa,SAAW,cAAcD,KAAK,WAAWA,KAAK,6CAA6CZ,QAAQ,GAAG,YAC1Ga,UAAY,wEAAwEb,QAAQ,GAAG,UAExF/B,aAAagC,OAAO,CACvBC,KAAMjC,aAAakC,MAAMW,YACzBT,KAAMQ,SACNP,MAAOX,aACPY,QAAS,CACLQ,KAAMpB,cAEVa,eAAe,IAEdC,MAAK,SAAAC,cACFA,MAAMM,UAAUtC,GAAGV,YAAY+C,MAAM,kBAAMxC,KAAK0C,YAAY3C,cAAesC,SAC3EF,MAAMC,OACCD,aAKvBO,YAAa,SAAU3C,cAAesC,UAE9BM,WAAatD,EAAG,gBAAgBgD,KAAK,MAAOO,SAExB,GAArBD,WAAWE,cAsCVxD,EAAE,gBAAgBgD,KAAK,MAAMS,SAASC,KAAK,gBAAgBX,QACpD,MAtCH3B,KAAO,CACPkC,WAAYA,WACZ5C,cAAeA,eAGnBR,KAAKmB,KAAK,CAAC,CACPC,WAAY,wCACZC,KAAMH,KACNI,KAAM,SAAUC,UAERA,SAASC,QACTzB,IAAIgC,YAAY,CACZ,CAACC,IAAK,mBAAoBC,UAAW,iBACtCX,MAAK,SAAUY,aAGVa,SAAWb,QAAQ,GACnBL,aAAe9B,IAAI+B,WAAW,sBAAuB,sBAElD3B,aAAagC,OAAO,CACvBC,KAAMjC,aAAakC,MAAMoB,MACzBlB,KAAMQ,SACNP,MAAOX,aACPY,QAAS,CACLiB,OAAQ3D,IAAI+B,WAAW,qBAAsB,gBAEjDY,eAAe,IAChBC,MAAK,SAAAC,cACJA,MAAMC,OACCD,aAKvBnB,KAAMxB,aAAayB,cAQtC"}