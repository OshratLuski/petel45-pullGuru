/**
 * Some UI stuff for participants page.
 * This is also used by the report/participants/index.php because it has the same functionality.
 *
 * @module     local_petel/assign_participants
 * @package    local_petel
 * @copyright  2017 Damyon Wiese
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @author     Devlion Moodle Development <service@devlion.co>
 */
define("local_petel/assign_participants",["jquery","core/str","core/modal_factory","core/modal_events","core/templates","core/notification","core/ajax"],(function($,Str,ModalFactory,ModalEvents,Templates,Notification,Ajax){var SELECTORS_BULKACTIONSELECT="table",Participants=function Participants(selected){0!==selected.length&&Participants.prototype.showSendMessage(selected).fail(Notification.exception)};return Participants.prototype.modal=null,Participants.prototype.showSendMessage=function(users){if(0===users.length)return $.Deferred().resolve().promise();var titlePromise=null;return titlePromise=1===users.length?Str.get_string("sendbulkmessagesingle","core_message"):Str.get_string("sendbulkmessage","core_message",users.length),$.when(ModalFactory.create({type:ModalFactory.types.SAVE_CANCEL,body:Templates.render("core_user/send_bulk_message",{})}),titlePromise).then(function(modal,title){return this.modal=modal,this.modal.setTitle(title),this.modal.setSaveButtonText(title),this.modal.getRoot().on(ModalEvents.hidden,function(){$(SELECTORS_BULKACTIONSELECT).focus(),this.modal.getRoot().remove()}.bind(this)),this.modal.getRoot().on(ModalEvents.save,this.submitSendMessage.bind(this,users)),this.modal.show(),this.modal}.bind(this))},Participants.prototype.submitSendMessage=function(users){var messageText=this.modal.getRoot().find("form textarea").val(),messages=[],i=0;for(i=0;i<users.length;i++)messages.push({touserid:users[i],text:messageText});return Ajax.call([{methodname:"core_message_send_instant_messages",args:{messages:messages}}])[0].then((function(messageIds){return 1===messageIds.length?Str.get_string("sendbulkmessagesentsingle","core_message"):Str.get_string("sendbulkmessagesent","core_message",messageIds.length)})).then((function(msg){return Notification.addNotification({message:msg,type:"success"}),!0})).catch(Notification.exception)},{init:function(selectedusers){return new Participants(selectedusers)}}}));

//# sourceMappingURL=assign_participants.min.js.map