define("community_sharesequence/uploadPopupActionsPage2",["jquery","core/str","core/templates","core/ajax","core/notification","community_sharesequence/inview","community_sharesequence/jquery-ui"],(function($,Str,Templates,Ajax,Notification,inView){return{PARENT:null,UNIQUEID:null,TRANSLATED_STRINGS:{},SELECTED_ACTIVITIES:{},CREATED_SEQUENCES:{},SELECTORS:{},selectUnselectUnitChecbox:function(el){var target=$(el),targetName=target.data("checkbox-name");"section"!==targetName&&"subsection"!==targetName||$("[data-checbox-parent=".concat(target.attr("id"),"]")).find("input:checkbox").prop("checked",target.prop("checked"));"activity"!==targetName&&"subsection"!==targetName||function checkSelectedParent(target,targetName){var siblings,siblingCheckedCheckboxes,checkboxWrapper=target.closest(".multicollapse"),parentName=target.closest(".multicollapse").data("checbox-parent"),parentCheckbox=$("#".concat(parentName));if("activity"===targetName?siblingCheckedCheckboxes=(siblings=checkboxWrapper.find("[data-checkbox-name=".concat(targetName,"]"))).filter(":checked"):"subsection"===targetName&&(siblingCheckedCheckboxes=(siblings=checkboxWrapper.find("input:checkbox")).filter(":checked")),siblings.length===siblingCheckedCheckboxes.length?parentCheckbox.prop("checked",!0):parentCheckbox.prop("checked",!1),"activity"===targetName)return checkSelectedParent(target=parentCheckbox,targetName="subsection")}(target,targetName),this.updateSequences()},updateSequences:function(){var _this=this,self=this,selectedActivities=$(this.PARENT).find('[data-checkbox-name="activity"]').filter(":checked");if(this.SELECTED_ACTIVITIES={},0===selectedActivities.length){$(this.PARENT).find(this.SELECTORS.SEQUENCE_LIST).find("li").each((function(index,el){$(el).remove()}))}else{selectedActivities.each((function(index,el){var elId=el.id;_this.SELECTED_ACTIVITIES.hasOwnProperty(elId)||(_this.SELECTED_ACTIVITIES[elId]=$(el).data("name"))}));var _createdSequences=$(this.PARENT).find(this.SELECTORS.SEQUENCE_LIST).find("li");for(var key in this.CREATED_SEQUENCES={},_createdSequences.each((function(index,el){var elId=$(el).data("activity_id");_this.CREATED_SEQUENCES.hasOwnProperty(elId)||(_this.CREATED_SEQUENCES[elId]=$(el).data("name"))})),this.SELECTED_ACTIVITIES)if(!this.CREATED_SEQUENCES.hasOwnProperty(key)){var icon=$('[for="'.concat(key,'"]')).find(".activity-item-icon").html(),dataCmid=key.replace("sequence_cm_",""),sequenceTemplate='\n                        <li class="sequence-item d-flex align-items-center justify-content-start border mb-3" data-name="'.concat(this.SELECTED_ACTIVITIES[key],'" data-activity_id="').concat(key,'">\n                            <span class="sequence-item-sort">\n                                <i class="fal fa-arrows"></i>\n                            </span>\n                            <span class="sequence-item-icon activity-icon d-block">').concat(icon,'</span>\n                            <span class="sequence-item-name mr-auto" title="').concat(this.SELECTED_ACTIVITIES[key],'">').concat(this.SELECTED_ACTIVITIES[key],'</span>\n                            <input class="sequence-item-text mr-auto" name="sequence-item-text" type="hidden" value="').concat(this.SELECTED_ACTIVITIES[key],'" data-cmid="').concat(dataCmid,'">\n                            <button class="sequence-item-rename" type="button" aria-label="').concat(this.TRANSLATED_STRINGS.rename_sequence_unit,'">\n                                <i class="fal fa-pencil"></i>\n                            </button>\n                            <label class="sequence-item-delete ml-auto" role="button" aria-label="').concat(this.TRANSLATED_STRINGS.delete_unit_from_sequence,'" for="').concat(key,'">\n                                <i class="fal fa-times"></i>\n                            </label>\n                        </li>');$(sequenceTemplate).appendTo($(this.PARENT).find(this.SELECTORS.SEQUENCE_LIST))}for(var _key in this.CREATED_SEQUENCES){if(!this.SELECTED_ACTIVITIES.hasOwnProperty(_key))$("[data-activity_id=".concat(_key,"]")).remove()}}$(this.PARENT).find(this.SELECTORS.SEQUENCE_LIST).sortable({change:function(event,ui){self.setIndexes($(self.PARENT).find(self.SELECTORS.SEQUENCE_LIST))},create:function(event,ui){self.setIndexes($(self.PARENT).find(self.SELECTORS.SEQUENCE_LIST))}}),$(this.PARENT).find(this.SELECTORS.SEQUENCE_LIST).disableSelection(),this.setIndexes($(this.PARENT).find(this.SELECTORS.SEQUENCE_LIST))},setIndexes:function(target){$(target).find("li.sequence-item").each((function(index,el){$(el).find("input").data("index",index)}))},renameSequence:function(target){var nameInput=target.find("input"),unitName=target.find(this.SELECTORS.SEQUENCE_ITEM_NAME),editBtn=target.find(this.SELECTORS.RENAME_BTN);editBtn.hide(),unitName.hide(),nameInput.show(),nameInput.attr("type","text"),nameInput.focus(),nameInput.on("change keypress focusout",(function(e){if(13===e.which||"change"===e.type||"focusout"===e.type){var value=$(e.target).val();target.data("name",value),unitName.text(value),unitName.show(),unitName.attr("title",value),nameInput.hide(),editBtn.attr("style","")}}))},updateSelectors:function(uniqueid){this.SELECTORS.UNITS_BLOCK=".units-block",this.SELECTORS.SEQUENCE_BLOCK=".sequence-block",this.SELECTORS.SEQUENCE_LIST="#sequence-item-list-"+uniqueid,this.SELECTORS.COLLAPSE_UNIT_BTNS=".check-section-label",this.SELECTORS.COLLAPSE_TOPIC_BTNS=".collapse-subsection-btn",this.SELECTORS.SECTION_CHEKBOX=".check-section-checkbox",this.SELECTORS.SUBSECTION_CHEKBOX=".check-subsection-checkbox",this.SELECTORS.ACTIVITY_CHEKBOX=".check-activity-checkbox",this.SELECTORS.SEQUENCE_ITEM_NAME=".sequence-item-name",this.SELECTORS.RENAME_BTN=".sequence-item-rename"},openInviewSection:function(name){inView(name).on("enter",(function(e){var parent=$(e);if(!parent.hasClass("inview-done")){parent.addClass("inview-done");var sectionid=parent.data("sectionid");Ajax.call([{methodname:"community_sharesequence_get_data_for_section",args:{sectionid:sectionid},done:function(response){var data=JSON.parse(response.data);Templates.render("community_sharesequence/section_data",data).done((function(html,js){Templates.appendNodeContents(parent,html,js)})).fail(Notification.exception)},fail:Notification.exception}])}})).on("exit",(function(el){}))},selectActivities:function(){var _this2=this,self=this;self.updateSelectors(self.UNIQUEID),$(self.PARENT).find(self.SELECTORS.SECTION_CHEKBOX).on("change",(function(e){$(".sequence-item-list-alert").hide(),self.selectUnselectUnitChecbox(e.target)})),$(self.PARENT).find(self.SELECTORS.SUBSECTION_CHEKBOX).on("change",(function(e){$(".sequence-item-list-alert").hide(),self.selectUnselectUnitChecbox(e.target)})),$(self.PARENT).find(self.SELECTORS.ACTIVITY_CHEKBOX).on("change",(function(e){$(".sequence-item-list-alert").hide(),_this2.selectUnselectUnitChecbox(e.target)}))},init:function(parent,uniqid){var self=this;this.PARENT=$(parent),this.UNIQUEID=uniqid;Str.get_strings([{key:"rename_sequence_unit",component:"community_sharesequence"},{key:"delete_unit_from_sequence",component:"community_sharesequence"}]).then((function(results){self.TRANSLATED_STRINGS.rename_sequence_unit=results[0],self.TRANSLATED_STRINGS.delete_unit_from_sequence=results[1]})),self.updateSelectors(self.UNIQUEID),$(self.PARENT).find(self.SELECTORS.COLLAPSE_UNIT_BTNS).on("click",(function(e){$(e.target).closest(".section-item").toggleClass("active")})),$(self.PARENT).on("click",self.SELECTORS.RENAME_BTN,(function(e){var target=$(e.target).closest("li.sequence-item");e.preventDefault(),self.renameSequence(target)})),$("form").submit((function(e){return e.preventDefault(),!1}))}}}));

//# sourceMappingURL=uploadPopupActionsPage2.min.js.map