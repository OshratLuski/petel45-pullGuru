define("community_sharesequence/uploadPopupActionsPage1",["jquery","core/ajax","core/templates","core/str","core/notification"],(function($,Ajax,Templates,str,Notification){var competencies={},maxNumberOfSection=1;function showOercatalogHierarchy(data,dropdownMenu){Templates.render("community_sharesequence/elements/dropdown-category-selector",data).done((function(html,js){Templates.replaceNodeContents(dropdownMenu,html,js),$(document).on("click","a.category-dropdown-item, a.course-dropdown-item",(function(e){e.stopPropagation()}))})).fail(Notification.exception),competencies={},function(data){var unique=Math.floor(Date.now()/1e3);data.categories.forEach((function(cat){void 0!==cat.courses&&cat.courses.forEach((function(course){course.competencies.length>0&&(competencies["course_id-"+course.course_id]=course,competencies["course_id-"+course.course_id].unique=unique)}))}))}(data)}function addSelectedSection(data,parent){var el,root=parent.closest(".section-competency-block"),newBlockId=root.find(".selected-sections-area-wrapper .selected-section-block").length,newBlock='\n        <div class="selected-section-block border border-primary rounded-pill align-items-center py-1 px-2 mb-2 mr-2"\n            id="selected-section-block-'.concat(newBlockId,'" data-cat_id="').concat(data.cat_id,'" data-course_id="').concat(data.course_id,'" \n            data-section_id="').concat(data.section_id,'">\n            <h6 class="text-bold mr-2 mb-0 d-inline-flex">\n                <span class="selected-category-name px-1" id="').concat(data.cat_id,'">').concat(data.cat_name,'</span>|<span\n                    class="selected-course-name px-1" id="').concat(data.course_id,'">').concat(data.course_name,'</span>|<span\n                    class="selected-section-name px-1" id="').concat(data.section_id,'">').concat(data.section_name,'</span>\n            </h6>\n            <button type="button px-2" class="close" aria-label="Close">\n                <span aria-hidden="true">&times;</span>\n            </button>\n        </div>\n        ');($(newBlock).insertAfter(root.find("button.select-section-dropdown-btn")),(el=parent).hasClass("disabled")||el.addClass("disabled"),$.isEmptyObject(competencies))?maxNumberOfSection>1&&$(".section-competency-block").length<maxNumberOfSection?(root.addClass("selected"),root.find(".add-section-competency-block").show()):root.addClass("selected"):function(target,courseid,sectionid){var prop="course_id-"+courseid;if(competencies.hasOwnProperty(prop)){$(".select-competencies-dropdown-wrapper").removeClass("hidden").attr("data-section_id",sectionid);var dropdownMenu=target.find(".select-competency-dropdown-menu");Templates.render("community_sharesequence/elements/dropdown-competency-selector",competencies[prop]).done((function(html,js){Templates.replaceNodeContents(dropdownMenu,html,js),$(document).on("click",".category-dropdown-item",(function(e){e.stopPropagation()}))})).fail(Notification.exception)}else target.closest(".section-competency-block").addClass("selected"),maxNumberOfSection>1&&$(".section-competency-block").length<maxNumberOfSection&&target.closest(".section-competency-block").find(".add-section-competency-block").show()}(parent.closest(".section-competency-block").find(".select-competencies-dropdown-wrapper"),data.course_id,data.section_id)}function checkCompetenciesAreaHeight(target){var btnHeight=+target.find("button.dropdown-toggle").outerHeight()+10,pillsHeight=+target.find(".selected-competencies-area-wrapper").outerHeight(),menu=target.find(".select-competency-dropdown-menu");pillsHeight>btnHeight?menu.css("margin-top",pillsHeight-btnHeight+10):menu.css("margin-top",0)}return{init:function(uniqueid,number_sections){maxNumberOfSection=+number_sections;var form=$("#sharing_sequence_form_"+uniqueid);form.on("show.bs.dropdown",".select-section-dropdown-wrapper",(function(e){var target=$(e.target).find(".dropdown-menu");target.html("");var selected_sections=[];$(".selected-section-block").each((function(){$(this).hasClass("hidden")||selected_sections.push($(this).data("section_id"))}));var json,dropdownMenu,data=JSON.stringify(selected_sections);json=data,dropdownMenu=target,Ajax.call([{methodname:"community_sharesequence_get_oercatalog_hierarchy",args:{selected:json},done:function(response){showOercatalogHierarchy(JSON.parse(response.hierarchy),dropdownMenu)},fail:Notification.exception}])})),form.on("click",".selected-section-block .close",(function(){!function(el){var btn=el.siblings(".dropdown-toggle"),target=el.closest(".section-competency-block").find(".select-competencies-dropdown-wrapper");if(el.closest(".section-competency-block").siblings(".section-competency-block").length>0){var prevBlock=el.closest(".section-competency-block").prev(),nextBlock=el.closest(".section-competency-block").next();prevBlock.length>0&&prevBlock.hasClass("selected")?prevBlock.find(".add-section-competency-block").show():nextBlock.length>0&&nextBlock.hasClass("selected")&&nextBlock.find(".add-section-competency-block").show(),el.closest(".section-competency-block").remove()}else el.remove();!function(target){target.find(".selected-competency-block").remove(),target.find(".select-competency-dropdown-menu").empty(),target.addClass("hidden"),target.siblings(".add-section-competency-block").hide()}(target),function(el){el.hasClass("disabled")&&el.removeClass("disabled")}(btn),btn.closest(".section-competency-block").find(".add-section-competency-block").hide()}($(this).closest(".selected-section-block"))})),form.on("click",".selected-competency-block .close",(function(){var el,comp_id;el=$(this),comp_id=el.closest(".selected-competency-block").data("comp_id"),0===el.closest(".section-competency-block").find(".selected-competency-block").length&&el.closest(".section-competency-block").find(".add-section-competency-block").hide(),el.closest(".select-competencies-dropdown-wrapper").find('.competency-dropdown-item[data-comp_id="'+comp_id+'"] input').trigger("click")})),form.on("click",".section-dropdown-item",(function(e){var btn=$(e.target).closest(".dropdown-menu").siblings(".dropdown-toggle");addSelectedSection({cat_id:$(this).data("cat_id"),cat_name:$(this).data("cat_name"),course_id:$(this).data("course_id"),course_name:$(this).data("course_name"),section_id:$(this).data("section_id"),section_name:$(this).data("section_name")},btn)})),form.on("click",".competency-dropdown-item input",(function(e){var compId=$(e.target).closest(".competency-dropdown-item").data("comp_id"),target=$(e.target).closest(".section-competency-block").find(".select-competencies-dropdown-wrapper");if(target.find("#selected-competency-block-"+compId).length>0)target.find("#selected-competency-block-"+compId).remove(),0===target.find(".selected-competency-block").length&&target.siblings(".add-section-competency-block").hide();else{var parent=$(e.target).closest(".select-competencies-dropdown-wrapper");!function(data,parent){var selectedPill='\n            <div class="selected-competency-block border border-primary rounded-pill align-items-center py-1 px-2 mb-2 mr-2"\n                id="selected-competency-block-'.concat(data.comp_id,'" data-comp_id="').concat(data.comp_id,'" data-section_id="').concat(data.section_id,'">\n                <h6 class="text-bold mr-2 mb-0 d-inline-flex">\n                    <span class="selected-competency-name px-1">').concat(data.comp_name,'</span>\n                </h6>\n                <button type="button px-2" class="close" aria-label="Close">\n                    <span aria-hidden="true">&times;</span>\n                </button>\n            </div>');parent.find(".selected-competencies-area-wrapper").append(selectedPill),parent.closest(".section-competency-block").addClass("selected"),maxNumberOfSection>1&&$(".section-competency-block").length<maxNumberOfSection&&parent.siblings(".add-section-competency-block").show()}({comp_id:$(this).closest(".competency-dropdown-item").data("comp_id"),comp_name:$(this).closest(".competency-dropdown-item").data("comp_name"),section_id:parent.data("section_id")},parent)}checkCompetenciesAreaHeight(target)})),form.on("shown.bs.dropdown",".select-competencies-dropdown-wrapper",(function(e){var target=$(e.target).closest(".section-competency-block");setTimeout((function(){checkCompetenciesAreaHeight(target)}),10)})),form.on("click",".select-competency-dropdown-menu",(function(e){e.stopPropagation()})),form.on("click",".no_copyright",(function(e){$(e.target).closest(".form-group").find(".question-activity-url-wrapper").slideUp()})),form.on("click",".based_on_another_activity",(function(e){$(e.target).closest(".form-group").find(".question-activity-url-wrapper").slideDown()})),form.on("keyup","#competency-auotocmplete",(function(e){var timer;timer&&clearTimeout(timer);var parent=$(e.target).closest(".select-competency-dropdown-menu"),symbol=$(e.target).val();timer=setTimeout((function(){""===symbol?function(parent){parent.find(".competency-dropdown-item").show()}(parent):function(symbol,parent){parent.find(".competency-dropdown-item").each((function(){var el=$(this),string=el.find("label").text(),text=symbol.toLowerCase();-1===string.toLowerCase().indexOf(text)?el.hide():el.show()}))}(symbol,parent)}),500)})),form.on("click",".add-section-competency-btn",(function(e){e.stopPropagation(),e.preventDefault(),function(prevElement){Templates.render("community_sharesequence/elements/section-competency-block",[]).done((function(html,js){Templates.appendNodeContents(prevElement,html,js)})).fail(Notification.exception)}($(e.target).closest(".section-competency-block-wrapper")),$(e.target).closest(".add-section-competency-block").hide()}))},createDefaultSelectedSection:function(uniqueid,number_sections,selected_sections){if(!selected_sections.length)return!1;var maxNumberOfSection=parseInt(number_sections)+1,root=$(".selected-sections-area-wrapper"),sections=JSON.parse(selected_sections);$.each(sections,(function(index,data){addSelectedSection(data,root)})),maxNumberOfSection>1&&$(".section-competency-block").length>=maxNumberOfSection&&root.find(".btn.select-section-dropdown-btn").addClass("disabled")}}}));

//# sourceMappingURL=uploadPopupActionsPage1.min.js.map