{"version":3,"file":"uploadPopupPage1.min.js","sources":["../src/uploadPopupPage1.js"],"sourcesContent":["/* eslint-disable require-jsdoc */\r\ndefine([\r\n    'community_sharesequence/main',\r\n    'jquery',\r\n    'core/ajax',\r\n    'core/str',\r\n    'core/templates',\r\n    'core/notification',\r\n    'core/modal_factory',\r\n    'core/fragment',\r\n    'jqueryui',\r\n\r\n], function(Main, $, Ajax, str, Templates, Notification, ModalFactory, Fragment) {\r\n\r\n    return {\r\n\r\n        init: function(uniqueid) {\r\n            var form = $('#sharing_sequence_form_' + uniqueid),\r\n                self = this;\r\n\r\n            form.on('keydown', 'input[type=\"text\"]', function(e) {\r\n                if (e.keyCode === 13) {\r\n                    e.preventDefault();\r\n                }\r\n            });\r\n\r\n            form.delegate('[data-descr=\"addtag\"]', 'keydown', function(e) {\r\n                if (e.keyCode === 13 && $(this).val()) {\r\n                    var tag = $('<div class = \"tags-item\">' + $(this).val() +\r\n                        '<input type = \"hidden\" name = \"tags[]\" value = \"' + $(this).val() + '\"></div>');\r\n                    tag.css(\"background-color\", self.getRandColor());\r\n                    tag.appendTo($(this).parent());\r\n                    tag.on('click', function() {\r\n                        $(this).remove();\r\n                    });\r\n                    $(this).val('');\r\n                }\r\n            });\r\n\r\n            form.find('.uploadsequencesubmit').click(function(event) {\r\n                self.uploadSequence(event, form);\r\n            });\r\n\r\n            form.find('.uploadsequenceclose').click(function() {\r\n\r\n                // Close modal factory popup.\r\n                self.closeModalFactory(form);\r\n            });\r\n\r\n        },\r\n\r\n        uploadSequence: function(e, form) {\r\n            let self = this;\r\n\r\n            e.preventDefault();\r\n\r\n            // Remove errors.\r\n            form.find('.invalid-feedback').hide();\r\n\r\n            self.addBtnSpinner(form);\r\n\r\n            var serializedForm = form.serializeArray(),\r\n                data = {};\r\n\r\n            serializedForm.forEach(function (item) {\r\n                data[item.name] = data[item.name] ? data[item.name] + ',' + item.value : item.value;\r\n            });\r\n\r\n            // Serialized selected sections.\r\n            let selectedsections = [];\r\n            form.find('.selected-section-block').each(function() {\r\n                if (!$(this).hasClass('hidden')) {\r\n                    selectedsections.push({\r\n                        'cat_id': $(this).data(\"cat_id\"),\r\n                        'course_id': $(this).data(\"course_id\"),\r\n                        'section_id': $(this).data(\"section_id\"),\r\n                        'cat_name': $(this).find(\".selected-category-name\").html(),\r\n                        'course_name': $(this).find(\".selected-course-name\").html(),\r\n                        'section_name': $(this).find(\".selected-section-name\").html(),\r\n                    });\r\n                }\r\n            });\r\n\r\n            data['selected_sections'] = selectedsections;\r\n\r\n            // Serialized selected competencies.\r\n            let selectedcompetencies = [];\r\n            form.find('.selected-competency-block').each(function() {\r\n                if (!$(this).hasClass('hidden')) {\r\n                    selectedcompetencies.push({\r\n                        'competency_id': $(this).data(\"comp_id\"),\r\n                        'section_id': $(this).data(\"section_id\"),\r\n                    });\r\n                }\r\n            });\r\n\r\n            data['selected_competencies'] = selectedcompetencies;\r\n\r\n            var parseResponse = function(response) {\r\n                if (response.result) {\r\n\r\n                    if (!response.validation) {\r\n                        let firstNameError = '';\r\n                        let errors = JSON.parse(response.errors);\r\n                        $.each(errors, function(index, value) {\r\n                            if (index === 0) {\r\n                                firstNameError = value;\r\n                            }\r\n                            form.find('.error-' + value).show();\r\n                        });\r\n                        // Scroll to first error.\r\n                        var parentModal = form.closest('.modal-body');\r\n                        var uploadsequenceOffset = +parentModal.find('.uploadsequence').offset().top * (-1);\r\n                        var targetOffset = parentModal.find('.error-' + firstNameError).closest('.form-group').offset().top * (-1);\r\n                        var result = uploadsequenceOffset - targetOffset;\r\n                        parentModal.closest('.modal-body').animate({scrollTop: result}, 500);\r\n\r\n                        self.removeBtnSpinner(form);\r\n                        return;\r\n                    } else {\r\n\r\n                        // Close modal factory popup.\r\n                        self.closeModalFactory(form);\r\n\r\n                        // Init page 2.\r\n                        Main.init_page_2(data);\r\n                    }\r\n                } else {\r\n\r\n                    // Close modal factory popup.\r\n                    self.closeModalFactory(form);\r\n\r\n                    let title = M.util.get_string('error', 'community_sharesequence');\r\n                    let text = M.util.get_string('system_error_contact_administrator', 'community_sharesequence');\r\n                    self.informationPopup(title, text);\r\n                }\r\n            };\r\n\r\n            Ajax.call([{\r\n                methodname: 'community_sharesequence_submit_sequence_page_1',\r\n                args: {\r\n                    data: JSON.stringify(data)\r\n                },\r\n                done: parseResponse,\r\n                fail: Notification.exception\r\n            }]);\r\n        },\r\n\r\n        getRandColor: function() {\r\n            var color = Math.floor(Math.random() * Math.pow(256, 3)).toString(16);\r\n            while (color.length < 6) {\r\n                color = \"0\" + color;\r\n            }\r\n            return \"#\" + color;\r\n        },\r\n\r\n        informationPopup: function(title, html) {\r\n            var modalPromise = ModalFactory.create({\r\n                type: ModalFactory.types.ALERT,\r\n                title: title,\r\n                body: html\r\n            });\r\n\r\n            $.when(modalPromise).then(function(fmodal) {\r\n                fmodal.show();\r\n                return fmodal;\r\n            }).fail(Notification.exception);\r\n        },\r\n\r\n        closeModalFactory: function(form) {\r\n            form.parent().parent().parent().find('.btn-close').click();\r\n        },\r\n\r\n        /**\r\n         * Show spinner.\r\n         *\r\n         * @method addSpinner\r\n         */\r\n        addBtnSpinner: function(form) {\r\n            form.find('.modalspinner').removeClass('d-none');\r\n            form.find('.modalspinner').addClass('loading');\r\n            form.find('.modalspinner').parent().prop('disabled', true);\r\n        },\r\n\r\n        /**\r\n         * Remove spinner.\r\n         *\r\n         * @method addSpinner\r\n         */\r\n        removeBtnSpinner: function(form) {\r\n            form.find('.modalspinner').removeClass('loading');\r\n            form.find('.modalspinner').addClass('d-none');\r\n            form.find('.modalspinner').parent().prop('disabled', false);\r\n        },\r\n    };\r\n});\r\n"],"names":["define","Main","$","Ajax","str","Templates","Notification","ModalFactory","Fragment","init","uniqueid","form","self","this","on","e","keyCode","preventDefault","delegate","val","tag","css","getRandColor","appendTo","parent","remove","find","click","event","uploadSequence","closeModalFactory","hide","addBtnSpinner","serializedForm","serializeArray","data","forEach","item","name","value","selectedsections","each","hasClass","push","cat_id","course_id","section_id","cat_name","html","course_name","section_name","selectedcompetencies","competency_id","call","methodname","args","JSON","stringify","done","response","result","validation","firstNameError","errors","parse","index","show","parentModal","closest","offset","top","animate","scrollTop","removeBtnSpinner","init_page_2","title","M","util","get_string","text","informationPopup","fail","exception","color","Math","floor","random","pow","toString","length","modalPromise","create","type","types","ALERT","body","when","then","fmodal","removeClass","addClass","prop"],"mappings":"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"}