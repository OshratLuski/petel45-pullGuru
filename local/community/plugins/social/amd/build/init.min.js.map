{"version":3,"file":"init.min.js","sources":["../src/init.js"],"sourcesContent":["define([\r\n    'jquery',\r\n    'core/str',\r\n    'community_social/ajax',\r\n    'community_social/render',\r\n    'community_social/loadingSpinner',\r\n    'community_social/inview',\r\n    'community_social/modal',\r\n    'community_social/lazyLoad',\r\n], function ($, str, ajax, render, loading, inView, SocialModal, lazyLoad) {\r\n    `use strict`;\r\n\r\n    str.get_strings([\r\n        {key: 'disablingsocialarea', component: 'community_social'},\r\n        {key: 'choosingpubliccourses', component: 'community_social'},\r\n        {key: 'editingtheschool', component: 'community_social'},\r\n        {key: 'close', component: 'community_social'},\r\n        {key: 'errormessage', component: 'community_social'},\r\n        {key: 'cancel', component: 'community_social'},\r\n        {key: 'excludeteacher', component: 'community_social'},\r\n        {key: 'warning', component: 'community_social'},\r\n        {key: 'removepeerteacher', component: 'community_social'},\r\n        {key: 'ok', component: 'community_social'}\r\n    ]).done(function () {\r\n    });\r\n\r\n    const mainBlock = document.querySelector(`#region-main .social`);\r\n\r\n    const follow_teacher = (page_userid, current_userid, follow_enable, callback) => {\r\n        loading.show();\r\n\r\n        ajax.data = {\r\n            metod: 'community_social_follow_teacher',\r\n            page_userid: page_userid,\r\n            current_userid: current_userid,\r\n            follow_enable: follow_enable\r\n        };\r\n\r\n        ajax.run(function () {\r\n            callback();\r\n        });\r\n    };\r\n\r\n    const follow_teacher_by_userid = (custom_userid, page_userid, current_userid, callback) => {\r\n        ajax.data = {\r\n            metod: 'community_social_change_follow_teacher_by_user',\r\n            page_userid: page_userid,\r\n            current_userid: current_userid,\r\n            custom_userid: custom_userid\r\n        };\r\n\r\n        ajax.run(function () {\r\n            callback();\r\n        });\r\n    };\r\n\r\n    const teacher_tab = (teacher_tab, search) => {\r\n        let target_block = `#teachers_card_block`;\r\n\r\n        ajax.data = {\r\n            metod: 'community_social_render_teacher_block',\r\n            teacher_tab: teacher_tab,\r\n            target_block: target_block,\r\n            search: search\r\n        };\r\n\r\n        ajax.setHTML(SocialModal.initHandler);\r\n    };\r\n\r\n    const createPill = (query, callback) => {\r\n\r\n        query = query.trim();\r\n\r\n        if (query.length === 0) {\r\n            return;\r\n        }\r\n\r\n        str.get_strings([\r\n            { key: 'removeallpills', component: 'community_oer' },\r\n        ]).done(function (strings) {\r\n\r\n            $('#profile_search').val('');\r\n\r\n            let pillTarget = $('.checked-option-pills');\r\n\r\n            // Add remove all.\r\n            if (!pillTarget.find('button').length) {\r\n                let pillremoveall = $(`\r\n                    <button type=\"button\" data-handler=\"removeallpills\" class=\"removeallpills btn btn-secondary mr-3 py-1 px-3 mb-2\">\r\n                        ${strings[0]}                       \r\n                    </button>`);\r\n\r\n                pillTarget.append(pillremoveall);\r\n            }\r\n\r\n            let simpleword = false;\r\n            if (query.length > 0 && query[0] === '\"' && query[query.length - 1] === '\"') {\r\n                simpleword = true;\r\n                query = query.substring(1, query.length - 1);\r\n            }\r\n\r\n            if (simpleword) {\r\n                let pill = $(`\r\n                <div class=\"checked-option-pill rounded-pill bg-light text-primary border border-primary mr-3 py-1 px-3 mb-2\" data-id=\"${query}\">\r\n                    <span class=\"checked-option-pill-name\">${query}</span>\r\n                    <button type=\"button\" class=\"close ml-3\" aria-label=\"Close\"  data-handler=\"removepill\">\r\n                        <span aria-hidden=\"true\" data-area=\"pillsearch\" data-value=\"${query}\">&times;</span>\r\n                    </button>\r\n                </div>`);\r\n\r\n                pillTarget.append(pill);\r\n            } else {\r\n                query.split(' ').forEach(function(value) {\r\n                    if (value.length > 0) {\r\n                        let pill = $(`\r\n                                <div class=\"checked-option-pill rounded-pill bg-light text-primary border border-primary mr-3 py-1 px-3 mb-2\" data-id=\"${value}\">\r\n                                    <span class=\"checked-option-pill-name\">${value}</span>\r\n                                    <button type=\"button\" class=\"close ml-3\" aria-label=\"Close\"  data-handler=\"removepill\">\r\n                                        <span aria-hidden=\"true\" data-area=\"pillsearch\" data-value=\"${value}\">&times;</span>\r\n                                    </button>\r\n                                </div>`);\r\n\r\n                        pillTarget.append(pill);\r\n                    }\r\n                });\r\n            }\r\n\r\n            callback();\r\n        });\r\n    }\r\n\r\n    const removePillSearch = (object, callback) =>  {\r\n        $(object).parent().remove();\r\n\r\n        // Remove button remove all pills.\r\n        let buttons = $('.checked-option-pills').find('button');\r\n        if (buttons.length === 1) {\r\n            buttons.remove();\r\n        }\r\n\r\n        callback();\r\n    }\r\n\r\n    const removeAllPillSearch = (object, callback) =>  {\r\n        let elementssearch = $(\"*\").filter(function () {\r\n            return ($(this).data(\"area\") === 'pillsearch');\r\n        });\r\n\r\n        $(elementssearch).each(function () {\r\n            removePillSearch($(this).parent(), function (){\r\n\r\n            });\r\n        });\r\n\r\n        callback();\r\n    }\r\n\r\n    return {\r\n        init: function (page_userid, current_userid) {\r\n\r\n            // Add tooltip to page.\r\n            mainBlock.addEventListener(`click`, function (event) {\r\n                let target = event.target;\r\n                while (target !== mainBlock) {\r\n\r\n                    // School settings popup.\r\n                    if (target.dataset.handler === `school-settings`) {\r\n                        SocialModal.school_settings(page_userid);\r\n                        return;\r\n                    }\r\n\r\n                    // Show courses pombim popup.\r\n                    if (target.dataset.handler === `courses_pombim`) {\r\n                        SocialModal.courses_pombim(page_userid);\r\n                        return;\r\n                    }\r\n\r\n                    // Migrate courses pombim popup.\r\n                    if (target.dataset.handler === `migrate_courses_pombim`) {\r\n                        SocialModal.migrate_courses_pombim(page_userid);\r\n                        return;\r\n                    }\r\n\r\n                    // Disable social area popup.\r\n                    if (target.dataset.handler === `social_disable`) {\r\n                        SocialModal.social_disable();\r\n                        return;\r\n                    }\r\n\r\n                    // View followers list popup.\r\n                    if (target.dataset.handler === `user-collegues-list`) {\r\n                        SocialModal.user_collegues_list(page_userid, current_userid);\r\n                        return;\r\n                    }\r\n\r\n                    // View followers list popup.\r\n                    if (target.dataset.handler === `user-follower-list`) {\r\n                        SocialModal.user_follower_list(page_userid, current_userid);\r\n                        return;\r\n                    }\r\n\r\n                    // Request to followed courses popup. Not used.\r\n                    if (target.dataset.handler === `request-followed-courses`) {\r\n                        SocialModal.request_followed_courses(page_userid, current_userid);\r\n                        return;\r\n                    }\r\n\r\n                    // Request to removing teacher from course popup.  Not used.\r\n                    if (target.dataset.handler === `remove-teacher-request`) {\r\n                        let courseid = target.dataset.courseid;\r\n                        let userid = target.dataset.userid;\r\n                        SocialModal.remove_teacher_request(userid, courseid);\r\n                        return;\r\n                    }\r\n\r\n                    // Follow another teacher.  Not used.\r\n                    if (target.dataset.handler === `follow`) {\r\n                        let follow_enable = target.dataset.follow_enable;\r\n                        follow_teacher(page_userid, current_userid, follow_enable, function () {\r\n                            render.userData(page_userid);\r\n                        });\r\n                        return;\r\n                    }\r\n\r\n                    // Follow another teacher by user id.  Not used.\r\n                    if (target.dataset.handler === `follow-user`) {\r\n                        let custom_userid = target.dataset.custom_userid;\r\n                        follow_teacher_by_userid(custom_userid, page_userid, current_userid, function () {\r\n                            render.userData(page_userid);\r\n                            SocialModal.user_follower_list(page_userid, current_userid);\r\n                        });\r\n                        return;\r\n                    }\r\n\r\n                    // Teacher tab + seatch tab.\r\n                    if (target.dataset.handler === `teacher_tab` || target.dataset.handler === `search_teacher`) {\r\n                        let tab_id = target.dataset.tab_id;\r\n                        let search = $('#search_teachers').val();\r\n                        teacher_tab(tab_id, search);\r\n                        return;\r\n                    }\r\n\r\n                    if (target.dataset.handler === `search_profile`) {\r\n                        let search = $('#profile_search').val();\r\n\r\n                        createPill(search, function (){\r\n\r\n                            let arrsearch = [];\r\n                            $(\".checked-option-pill\").each(function(index) {\r\n                                arrsearch.push($(this).data('id'));\r\n                            });\r\n\r\n                            render.searchInProfile(page_userid, arrsearch);\r\n                        });\r\n\r\n                        return;\r\n                    }\r\n\r\n                    if (target.dataset.handler === `removepill`) {\r\n                        removePillSearch(target, function (){\r\n\r\n                            let arrsearch = [];\r\n                            $(\".checked-option-pill\").each(function(index) {\r\n                                arrsearch.push($(this).data('id'));\r\n                            });\r\n\r\n                            render.searchInProfile(page_userid, arrsearch);\r\n                        });\r\n\r\n                        return;\r\n                    }\r\n\r\n                    if (target.dataset.handler === `removeallpills`) {\r\n                        removeAllPillSearch(target, function (){\r\n\r\n                            let arrsearch = [];\r\n                            render.searchInProfile(page_userid, arrsearch);\r\n                        });\r\n\r\n                        return;\r\n                    }\r\n\r\n                    // SlideIn slideOut teachers tag on the course card.\r\n                    if (target.dataset.handler === `slideCourseCard`) {\r\n                        $(target).toggleClass('tc-rotate');\r\n                        let scrollHeight = $(target).hasClass('tc-rotate') ? $(target).parents('.course').prop('scrollHeight') : 195;\r\n                        $(target).parents('.course').css({'height': scrollHeight + 'px'});\r\n                        return;\r\n                    }\r\n\r\n                    // SlideIn slideOut courses on the teachers card.\r\n                    if (target.dataset.handler === `slideTeacherCard`) {\r\n                        $(target).toggleClass('tc-rotate');\r\n                        let scrollHeight = $(target).hasClass('tc-rotate') ? $(target).parents('.tc').prop('scrollHeight') : 140;\r\n                        $(target).parents('.tc').css({'height': scrollHeight + 'px'});\r\n                        return;\r\n                    }\r\n\r\n                    target = target.parentNode;\r\n                }\r\n\r\n            });\r\n\r\n            window.onresize = function (event) {\r\n                SocialModal.initHandler();\r\n            };\r\n\r\n            mainBlock.addEventListener('keydown', function (event) {\r\n                if (event.keyCode === 13 && event.target.id === `search_teachers`) {\r\n                    let tab_id = event.target.nextElementSibling.dataset.tab_id;\r\n                    let search = event.target.value;\r\n                    teacher_tab(tab_id, search);\r\n                }\r\n\r\n                if (event.keyCode === 13 && event.target.id === `profile_search`) {\r\n                    let search = event.target.value;\r\n\r\n                    createPill(search, function (){\r\n\r\n                        let arrsearch = [];\r\n                        $(\".checked-option-pill\").each(function(index) {\r\n                            arrsearch.push($(this).data('id'));\r\n                        });\r\n\r\n                        render.searchInProfile(page_userid, arrsearch);\r\n                    });\r\n                }\r\n            });\r\n\r\n        }\r\n    };\r\n});\r\n"],"names":["define","$","str","ajax","render","loading","inView","SocialModal","lazyLoad","get_strings","key","component","done","mainBlock","document","querySelector","follow_teacher","page_userid","current_userid","follow_enable","callback","show","data","metod","run","follow_teacher_by_userid","custom_userid","teacher_tab","search","target_block","setHTML","initHandler","createPill","query","trim","length","strings","val","pillTarget","find","pillremoveall","append","simpleword","substring","pill","split","forEach","value","removePillSearch","object","parent","remove","buttons","removeAllPillSearch","elementssearch","filter","this","each","init","addEventListener","event","target","dataset","handler","school_settings","courses_pombim","migrate_courses_pombim","social_disable","user_collegues_list","user_follower_list","request_followed_courses","courseid","userid","remove_teacher_request","userData","tab_id","arrsearch","index","push","searchInProfile","toggleClass","scrollHeight","hasClass","parents","prop","css","parentNode","window","onresize","keyCode","id","nextElementSibling"],"mappings":"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"}