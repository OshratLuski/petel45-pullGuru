{"version":3,"file":"sendtoteacher.min.js","sources":["../src/sendtoteacher.js"],"sourcesContent":["define([\n    'jquery',\n    'core/ajax',\n    'core/notification',\n    'community_sharewith/modal',\n    'community_sharewith/storage'\n], function($, Ajax, Notification, modal, St) {\n\n    /** @alias module:community_sharewith/sharewithteacher */\n    return {\n        modalBody: '',\n        addBtn: '',\n        resultBlock: '',\n        tagWrapper: '',\n        input: '',\n\n        init: function(modal) {\n            let self = this;\n            $(modal.body).on(\"click\", 'button[data-handler=\"removeTag\"]', function(e) {\n                e.stopPropagation();\n                var target = e.currentTarget;\n                self.modalBody = $(target).closest('.modal-body');\n                self.removeTag(target);\n            });\n            $(modal.body).on(\"click\", function(e) {\n                if ($('.result-block button').length > 0) {\n                    $('.result-block ').html('');\n                }\n            });\n\n            $(modal.body).on(\"input\", '[data-handler=\"selectTeacher\"]', function(e) {\n                e.stopPropagation();\n                var target = e.currentTarget;\n                self.modalBody = $(target).closest('.modal-body');\n                if (target.value.length >= 3) {\n                    self.autocompleteTeachers(target);\n                }\n            });\n\n        },\n\n        showSearchResult: function(response) {\n            var self = this;\n            self.resultBlock.innerHTML = '';\n            var teachers = JSON.parse(response);\n            teachers.forEach(function(teacher) {\n\n                var unit = document.createElement('button');\n                unit.dataset.teacherid = teacher.teacher_id;\n                unit.dataset.teachername = teacher.teacher_name;\n                unit.dataset.handler = 'addTag';\n                unit.classList.add('btn', 'btn-secondary', 'd-flex', 'mb-1', 'w-100');\n                unit.setAttribute('tabindex', '0');\n                unit.innerHTML = '<div class = \"sw-img\" >' +\n                    '<img src = \"' + M.cfg.wwwroot + teacher.teacher_url + '\" alt = \"\">' +\n                    '</div><span class = \"pl-2\">' + teacher.teacher_name + '</span>';\n\n                $(self.resultBlock).removeClass('d-none');\n                $(self.resultBlock).append(unit);\n            });\n\n            // Focus.\n            self.focusOnTag();\n\n            $('[data-handler=\"addTag\"]').on(\"click\", function(e) {\n                e.stopPropagation();\n                var target = e.currentTarget;\n                self.modalBody = $(target).closest('.modal-body');\n                self.addTag(target);\n            });\n\n            $('[data-handler=\"addTag\"]').keydown(function(e) {\n\n                let keyUp = 38;\n                let keyDown = 40;\n\n                var moves = $(self.modalBody).find(\".result-block .btn\");\n                // Key up function\n                if (e.keyCode === keyDown) {\n                    e.preventDefault();\n                    for (i = 0; i <= moves.length; i++) {\n                        if (moves[i] === $(self.modalBody).find(\".result-block .btn:focus\").get(0)) {\n                           $(moves[i + 1]).focus();\n                            break;\n                        }\n                    }\n                }\n                if (e.keyCode === keyUp) {\n                    e.preventDefault();\n                    for (i = 0; i <= moves.length; i++) {\n                        if (moves[i] === $(self.modalBody).find(\".result-block .btn:focus\").get(0)) {\n                           $(moves[i - 1]).focus();\n                            break;\n                        }\n                    }\n                }\n            });\n        },\n\n        focusOnTag: function() {\n\n            let flag = false;\n            $('[data-handler=\"addTag\"]').each(function(index) {\n                if ($(this).length && !flag) {\n                    $(this).focus();\n                    flag = true;\n                }\n            });\n        },\n\n        autocompleteTeachers: function(target) {\n            var self = this;\n            var inputValue = target.value;\n            self.resultBlock = $(self.modalBody).find('.result-block');\n            self.tagWrapper = $(self.modalBody).find('.tag-wrapper');\n            self.input = $(self.modalBody).find('input[data-handler = \"selectTeacher\"]');\n\n            if (!self.resultBlock.childElementCount && !inputValue) {\n                self.resultBlock.classList.add('d-none');\n            }\n            Ajax.call([{\n                methodname: 'community_sharequestion_autocomplete_teachers',\n                args: {\n                    searchstring: inputValue\n                },\n                done: self.showSearchResult.bind(this),\n                fail: Notification.exception\n            }]);\n        },\n\n        addTag: function(target) {\n            var self = this;\n            var teacherid = target.dataset.teacherid,\n                tag = $(this.tagWrapper).find('[data-teacherid=' + teacherid + ']');\n            if (tag.length) {\n                this.removeTag(tag[0]);\n                return;\n            }\n            var teacherTag = $(this.tagWrapper).find('.example').clone();\n            teacherTag.attr('data-teacherid', teacherid);\n            teacherTag.append('<span>' + target.dataset.teachername + '</span>');\n            teacherTag.removeClass('example d-none');\n            target.remove();\n            $(this.tagWrapper).append(teacherTag);\n            this.input.value = '';\n\n            // Focus.\n            self.focusOnTag();\n        },\n\n        removeTag: function(target) {\n            var teacherid = target.dataset.teacherid;\n            $(this.resultBlock).find('[data-teacherid=' + teacherid + ']')\n                .removeClass('active');\n            $(target).remove();\n        },\n    };\n});\n"],"names":["define","$","Ajax","Notification","modal","St","modalBody","addBtn","resultBlock","tagWrapper","input","init","self","this","body","on","e","stopPropagation","target","currentTarget","closest","removeTag","length","html","value","autocompleteTeachers","showSearchResult","response","innerHTML","JSON","parse","forEach","teacher","unit","document","createElement","dataset","teacherid","teacher_id","teachername","teacher_name","handler","classList","add","setAttribute","M","cfg","wwwroot","teacher_url","removeClass","append","focusOnTag","addTag","keydown","moves","find","keyCode","preventDefault","i","get","focus","flag","each","index","inputValue","childElementCount","call","methodname","args","searchstring","done","bind","fail","exception","tag","teacherTag","clone","attr","remove"],"mappings":"AAAAA,+CAAO,CACH,SACA,YACA,oBACA,4BACA,gCACD,SAASC,EAAGC,KAAMC,aAAcC,MAAOC,UAG/B,CACHC,UAAW,GACXC,OAAQ,GACRC,YAAa,GACbC,WAAY,GACZC,MAAO,GAEPC,KAAM,SAASP,WACPQ,KAAOC,KACXZ,EAAEG,MAAMU,MAAMC,GAAG,QAAS,oCAAoC,SAASC,GACnEA,EAAEC,sBACEC,OAASF,EAAEG,cACfP,KAAKN,UAAYL,EAAEiB,QAAQE,QAAQ,eACnCR,KAAKS,UAAUH,WAEnBjB,EAAEG,MAAMU,MAAMC,GAAG,SAAS,SAASC,GAC3Bf,EAAE,wBAAwBqB,OAAS,GACnCrB,EAAE,kBAAkBsB,KAAK,OAIjCtB,EAAEG,MAAMU,MAAMC,GAAG,QAAS,kCAAkC,SAASC,GACjEA,EAAEC,sBACEC,OAASF,EAAEG,cACfP,KAAKN,UAAYL,EAAEiB,QAAQE,QAAQ,eAC/BF,OAAOM,MAAMF,QAAU,GACvBV,KAAKa,qBAAqBP,YAMtCQ,iBAAkB,SAASC,cACnBf,KAAOC,KACXD,KAAKJ,YAAYoB,UAAY,GACdC,KAAKC,MAAMH,UACjBI,SAAQ,SAASC,aAElBC,KAAOC,SAASC,cAAc,UAClCF,KAAKG,QAAQC,UAAYL,QAAQM,WACjCL,KAAKG,QAAQG,YAAcP,QAAQQ,aACnCP,KAAKG,QAAQK,QAAU,SACvBR,KAAKS,UAAUC,IAAI,MAAO,gBAAiB,SAAU,OAAQ,SAC7DV,KAAKW,aAAa,WAAY,KAC9BX,KAAKL,UAAY,sCACIiB,EAAEC,IAAIC,QAAUf,QAAQgB,YAD5B,yCAEmBhB,QAAQQ,aAAe,UAE3DvC,EAAEW,KAAKJ,aAAayC,YAAY,UAChChD,EAAEW,KAAKJ,aAAa0C,OAAOjB,SAI/BrB,KAAKuC,aAELlD,EAAE,2BAA2Bc,GAAG,SAAS,SAASC,GAC9CA,EAAEC,sBACEC,OAASF,EAAEG,cACfP,KAAKN,UAAYL,EAAEiB,QAAQE,QAAQ,eACnCR,KAAKwC,OAAOlC,WAGhBjB,EAAE,2BAA2BoD,SAAQ,SAASrC,OAKtCsC,MAAQrD,EAAEW,KAAKN,WAAWiD,KAAK,yBAFrB,KAIVvC,EAAEwC,YACFxC,EAAEyC,iBACGC,EAAI,EAAGA,GAAKJ,MAAMhC,OAAQoC,OACvBJ,MAAMI,KAAOzD,EAAEW,KAAKN,WAAWiD,KAAK,4BAA4BI,IAAI,GAAI,CACzE1D,EAAEqD,MAAMI,EAAI,IAAIE,iBATf,KAcR5C,EAAEwC,YACFxC,EAAEyC,iBACGC,EAAI,EAAGA,GAAKJ,MAAMhC,OAAQoC,OACvBJ,MAAMI,KAAOzD,EAAEW,KAAKN,WAAWiD,KAAK,4BAA4BI,IAAI,GAAI,CACzE1D,EAAEqD,MAAMI,EAAI,IAAIE,mBAQnCT,WAAY,eAEJU,MAAO,EACX5D,EAAE,2BAA2B6D,MAAK,SAASC,OACnC9D,EAAEY,MAAMS,SAAWuC,OACnB5D,EAAEY,MAAM+C,QACRC,MAAO,OAKnBpC,qBAAsB,SAASP,YAEvB8C,WAAa9C,OAAOM,MADbX,KAENL,YAAcP,EAFRY,KAEeP,WAAWiD,KAAK,iBAF/B1C,KAGNJ,WAAaR,EAHPY,KAGcP,WAAWiD,KAAK,gBAH9B1C,KAINH,MAAQT,EAJFY,KAISP,WAAWiD,KAAK,yCAJzB1C,KAMDL,YAAYyD,mBAAsBD,YANjCnD,KAOFL,YAAYkC,UAAUC,IAAI,UAEnCzC,KAAKgE,KAAK,CAAC,CACPC,WAAY,gDACZC,KAAM,CACFC,aAAcL,YAElBM,KAdOzD,KAcIa,iBAAiB6C,KAAK1D,MACjC2D,KAAMrE,aAAasE,cAI3BrB,OAAQ,SAASlC,YAETmB,UAAYnB,OAAOkB,QAAQC,UAC3BqC,IAAMzE,EAAEY,KAAKJ,YAAY8C,KAAK,mBAAqBlB,UAAY,QAC/DqC,IAAIpD,YACCD,UAAUqD,IAAI,aAGnBC,WAAa1E,EAAEY,KAAKJ,YAAY8C,KAAK,YAAYqB,QACrDD,WAAWE,KAAK,iBAAkBxC,WAClCsC,WAAWzB,OAAO,SAAWhC,OAAOkB,QAAQG,YAAc,WAC1DoC,WAAW1B,YAAY,kBACvB/B,OAAO4D,SACP7E,EAAEY,KAAKJ,YAAYyC,OAAOyB,iBACrBjE,MAAMc,MAAQ,GAbRX,KAgBNsC,eAGT9B,UAAW,SAASH,YACZmB,UAAYnB,OAAOkB,QAAQC,UAC/BpC,EAAEY,KAAKL,aAAa+C,KAAK,mBAAqBlB,UAAY,KACrDY,YAAY,UACjBhD,EAAEiB,QAAQ4D"}