define("community_sharequestion/copyFromMyCourses",["jquery","core/str","core/modal_factory","core/modal_events","core/ajax","core/templates","core/notification","core/fragment","community_sharequestion/inview"],(function($,Str,ModalFactory,ModalEvents,Ajax,Templates,Notification,Fragment,inView){let uniqueid,cmid,SELECTORS_buttonEvent=".addquestionfrommycourses";function updateCountSelected(){let form=$("#copy_from_my_courses_"+uniqueid),counter=0;form.find(".checkbox-select-question").each((function(index){$(this).prop("checked")&&counter++})),$("#checked-question-counter-num-"+uniqueid).html(counter)}function loadingIcon(target){Templates.render("community_sharequestion/loading",{}).done((function(html,js){Templates.replaceNodeContents(target,html,js)})).fail(Notification.exception)}function renderCoursesForUser(){loadingIcon($("#popup_block_content_courses_"+uniqueid));let search=$("#search_"+uniqueid).val();void 0===search&&(search=""),Ajax.call([{methodname:"community_sharequestion_get_courses_by_user",args:{search:search,uniqueid:uniqueid},done:function(response){let data=JSON.parse(response);Templates.render("community_sharequestion/copy_from_my_courses/courses",data.result).done((function(html,js){Templates.replaceNodeContents($("#popup_block_content_courses_"+uniqueid),html,js),$("#all_checkboxes_"+uniqueid).prop("checked",!1),updateCountSelected()})).fail(Notification.exception)},fail:Notification.exception}])}return{init:function(currentcourseid,currentcoursecontext){const getBody=function(coursemoduleid){uniqueid=Date.now(),cmid=coursemoduleid;let params={cmid:coursemoduleid,uniqueid:uniqueid};return Fragment.loadFragment("community_sharequestion","copy_questions_from_my_courses",currentcoursecontext,params)};$(SELECTORS_buttonEvent).on("click",(function(e){e.preventDefault();let cmid=$(this).data("cmid");Str.get_strings([{key:"copyquestionsfrommycourses",component:"community_sharequestion"},{key:"qshare",component:"community_sharequestion"}]).done((function(strings){var modalPromise=ModalFactory.create({type:ModalFactory.types.SAVE_CANCEL,title:strings[0],body:getBody(cmid)});$.when(modalPromise).then((function(fmodal){fmodal.setSaveButtonText(strings[1]),fmodal.getRoot().on(ModalEvents.save,(function(e){e.preventDefault();let form=$("#copy_from_my_courses_"+uniqueid),selected=[];form.find(".checkbox-select-question").each((function(index){$(this).prop("checked")&&selected.push($(this).data("qid"))})),selected.length?(fmodal.destroy(),Str.get_strings([{key:"popupmessagesuccesstitle",component:"community_sharequestion"},{key:"popupmessagesuccesscontent",component:"community_sharequestion"},{key:"popupbuttondisabled",component:"community_sharequestion"},{key:"popupbuttonenabled",component:"community_sharequestion"}]).done((function(strings){var modalPromise=ModalFactory.create({type:ModalFactory.types.ALERT,title:strings[0],body:strings[1]});$.when(modalPromise).then((function(fmodal){fmodal.show();let root=fmodal.getRoot();return root.on(ModalEvents.cancel,(function(){location.reload()})),root.on(ModalEvents.shown,(function(){root.find('*[data-action="cancel"]').text(strings[2]),root.find('*[data-action="cancel"]').prop("disabled",!0),Ajax.call([{methodname:"community_sharequestion_save_questions_to_quiz",args:{cmid:cmid,qids:JSON.stringify(selected)},done:function(response){JSON.parse(response);root.find('*[data-action="cancel"]').text(strings[3]),root.find('*[data-action="cancel"]').prop("disabled",!1)},fail:Notification.exception}])})),fmodal})).fail(Notification.exception)}))):Str.get_strings([{key:"popupmessagefailtitle",component:"community_sharequestion"},{key:"popupmessagefailcontent",component:"community_sharequestion"}]).done((function(strings){var modalPromise=ModalFactory.create({type:ModalFactory.types.ALERT,title:strings[0],body:strings[1]});$.when(modalPromise).then((function(fmodal){return fmodal.show(),fmodal})).fail(Notification.exception)}))})),fmodal.getModal().addClass("modal-xlg"),fmodal.getModal().addClass("import-questions-modal");var root=fmodal.getRoot();return root.on(ModalEvents.shown,(function(){setTimeout((function(){root.find(".modal-body").animate({scrollTop:0},200),renderCoursesForUser()}),500)})),fmodal})).done((function(modal){modal.show()})).fail(Notification.exception)}))}))},actionsMain:function(){let form=$("#copy_from_my_courses_"+uniqueid),search=$("#search_"+uniqueid);search.change((function(){renderCoursesForUser(),""===search.val()?(search.siblings(".question-search-icon").show(),search.siblings(".question-search-close-icon").hide()):(search.siblings(".question-search-icon").hide(),search.siblings(".question-search-close-icon").show())})),form.find(".question-search-close-icon").on("click keydown",(e=>{if("click"===e.type||"keydown"===e.type&&13===e.which){const targetInput=$("#search_"+uniqueid);$("#search_"+uniqueid).val(""),renderCoursesForUser(),targetInput.siblings(".question-search-close-icon").hide(),targetInput.siblings(".question-search-icon").show()}})),$("#all_checkboxes_"+uniqueid).change((function(){this.checked?form.find(".checkbox-select-question").each((function(index){$(this).prop("checked",!0)})):form.find(".checkbox-select-question").each((function(index){$(this).prop("checked",!1)})),updateCountSelected()}))},actionsCategories:function(){let form=$("#copy_from_my_courses_"+uniqueid);$(form).find(".all-course-categories-wrapper-collapse").on("show.bs.collapse",(function(e){e.stopPropagation();let target=$(e.target),courseid=target.data("courseid"),search=$("#search_"+uniqueid).val();if(!target.hasClass("view-done")&&target.hasClass("all-course-categories-wrapper-collapse"))loadingIcon(target),Ajax.call([{methodname:"community_sharequestion_get_question_categories_by_course",args:{courseid:courseid,uniqueid:uniqueid,search:search},done:function(response){let data=JSON.parse(response);Templates.render("community_sharequestion/copy_from_my_courses/course-categories",data.result).done((function(html,js){Templates.replaceNodeContents(target,html,js),target.addClass("view-done")})).fail(Notification.exception)},fail:Notification.exception}]);else if(!target.hasClass("view-done")&&target.hasClass("cat-wrapper-collapse")){loadingIcon(target);let catid=target.data("catid");Ajax.call([{methodname:"community_sharequestion_get_questions_by_category",args:{catid:catid,uniqueid:uniqueid,search:search},done:function(response){let data=JSON.parse(response);Templates.render("community_sharequestion/copy_from_my_courses/category-questions",data.result).done((function(html,js){Templates.replaceNodeContents(target,html,js),target.addClass("view-done")})).fail(Notification.exception)},fail:Notification.exception}])}}))},actionsBankCategories:function(){let form=$("#copy_from_my_courses_"+uniqueid);$(form).find(".all-bank-categories-wrapper-collapse").on("show.bs.collapse",(function(e){e.stopPropagation();let target=$(e.target),courseid=target.data("courseid"),search=$("#search_"+uniqueid).val();if(!target.hasClass("view-done")&&target.hasClass("all-bank-categories-wrapper-collapse"))loadingIcon(target),Ajax.call([{methodname:"community_sharequestion_get_bank_categories_on_course",args:{courseid:courseid,uniqueid:uniqueid,search:search},done:function(response){let data=JSON.parse(response);Templates.render("community_sharequestion/copy_from_my_courses/bank-categories",data.result).done((function(html,js){Templates.replaceNodeContents(target,html,js),target.addClass("view-done")})).fail(Notification.exception)},fail:Notification.exception}]);else if(!target.hasClass("view-done")&&target.hasClass("bank-categories-wrapper-collapse")){loadingIcon(target);let catid=target.data("catid");Ajax.call([{methodname:"community_sharequestion_get_questions_by_category",args:{catid:catid,uniqueid:uniqueid,search:search},done:function(response){let data=JSON.parse(response);Templates.render("community_sharequestion/copy_from_my_courses/category-questions",data.result).done((function(html,js){Templates.replaceNodeContents(target,html,js),target.addClass("view-done")})).fail(Notification.exception)},fail:Notification.exception}])}}))},actionsQuestions:function(){let form=$("#copy_from_my_courses_"+uniqueid);inView("#copy_from_my_courses_"+uniqueid+" .question-collapse").on("enter",(function(e){let parent=$(e);if(!parent.hasClass("inview-done")){parent.addClass("inview-done");let qid=parent.data("qid"),spinner=parent.find(".raspberry_loading");spinner.show();let html='<iframe id="iframe'+qid+uniqueid+'" scrolling="no" style="width:100%; height:300px;" src="'+M.cfg.wwwroot+"/local/community/plugins/oer/previewquestion.php?id="+qid+'&behaviour=adaptive"></iframe>';parent.find(".question-collapse-inner").html(html),document.querySelector("#iframe"+qid+uniqueid).addEventListener("load",(function(){spinner=parent.find(".raspberry_loading"),spinner.remove();parent.find(".inner-copy-question-btn").show()}))}})).on("exit",(el=>{})),$(".course-wrapper-name").on("click",(function(){const target=$(this);if(!target.hasClass("collapsed")){target.next(".course-wrapper-name-collapse").find(".cat-wrapper-collapse").each((function(el){$(this).collapse("hide")}))}})),$(".type-cell, .name-cell, .create-cell, .create-date-cell, .update-date-cell").on("click",(function(e){$(e.currentTarget).closest(".question-item-wrapper").find(".collapse-question-btn").trigger("click")})),form.find(".checkbox-select-question").change((function(){updateCountSelected();let flagselected=!0;form.find(".checkbox-select-question").each((function(index){!1===$(this).prop("checked")&&(flagselected=!1)})),!1===flagselected?$("#all_checkboxes_"+uniqueid).prop("checked",!1):$("#all_checkboxes_"+uniqueid).prop("checked",!0)}))}}}));

//# sourceMappingURL=copyFromMyCourses.min.js.map