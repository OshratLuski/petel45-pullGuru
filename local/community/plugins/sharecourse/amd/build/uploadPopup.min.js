define("community_sharecourse/uploadPopup",["jquery","core/ajax","core/str","core/templates","core/notification","core/modal_factory","core/fragment","jqueryui"],(function($,Ajax,str,Templates,Notification,ModalFactory,Fragment){return{init:function(uniqueid){var form=$("#sharing_courses_form_"+uniqueid),self=this;form.on("keydown",'input[type="text"]',(function(e){13===e.keyCode&&e.preventDefault()})),form.delegate('[data-descr="addtag"]',"keydown",(function(e){if(13===e.keyCode&&$(this).val()){var tag=$('<div class = "tags-item">'+$(this).val()+'<input type = "hidden" name = "tags[]" value = "'+$(this).val()+'"></div>');tag.css("background-color",self.getRandColor()),tag.appendTo($(this).parent()),tag.on("click",(function(){$(this).remove()})),$(this).val("")}})),form.find(".uploadcoursesubmit").click((function(event){self.uploadCourse(event,form)})),form.find(".uploadcourseclose").click((function(){self.closeModalFactory(form)}))},uploadCourse:function(e,form){let self=this;e.preventDefault(),form.find(".invalid-feedback").hide(),self.addBtnSpinner(form);var serializedForm=form.serializeArray(),data={};serializedForm.forEach((function(item){data[item.name]=data[item.name]?data[item.name]+","+item.value:item.value}));let selectedcourses=[];form.find(".treeview span").each((function(){let courseid=$(this).data("courseid"),checked=$(this).attr("check-value");void 0!==courseid&&"1"===checked&&selectedcourses.push({course_id:courseid})})),data.selected_courses=selectedcourses;Ajax.call([{methodname:"community_sharecourse_submit_upload_course",args:{data:JSON.stringify(data)},done:function(response){if(response.result){if(!response.validation){let firstNameError="",errors=JSON.parse(response.errors);$.each(errors,(function(index,value){0===index&&(firstNameError=value),form.find(".error-"+value).show()}));var parentModal=form.closest(".modal-body"),result=-1*+parentModal.find(".uploadcourse").offset().top- -1*parentModal.find(".error-"+firstNameError).closest(".form-group").offset().top;return parentModal.closest(".modal-body").animate({scrollTop:result},500),void self.removeBtnSpinner(form)}self.closeModalFactory(form),"1"===data.typeshare?str.get_string("eventcourseupload","community_sharecourse").done((function(title){str.get_string("course_upload_to_mr","community_sharecourse",data).done((function(string){Templates.render("community_sharecourse/elements/information-popup",{string:string,rootLink:M.cfg.wwwroot}).done((function(html,js){self.informationPopup(title,html)})).fail(Notification.exception)}))})):window.location.replace(M.cfg.wwwroot+"/course/view.php?id="+data.courseid)}else{self.closeModalFactory(form);let title=M.util.get_string("error","community_sharequestion"),text=M.util.get_string("system_error_contact_administrator","community_sharequestion");self.informationPopup(title,text)}},fail:Notification.exception}])},getRandColor:function(){for(var color=Math.floor(Math.random()*Math.pow(256,3)).toString(16);color.length<6;)color="0"+color;return"#"+color},informationPopup:function(title,html){var modalPromise=ModalFactory.create({type:ModalFactory.types.ALERT,title:title,body:html});$.when(modalPromise).then((function(fmodal){return fmodal.show(),fmodal})).fail(Notification.exception)},closeModalFactory:function(form){form.parent().parent().parent().find(".btn-close").click()},addBtnSpinner:function(form){form.find(".modalspinner").removeClass("d-none"),form.find(".modalspinner").addClass("loading"),form.find(".modalspinner").parent().prop("disabled",!0)},removeBtnSpinner:function(form){form.find(".modalspinner").removeClass("loading"),form.find(".modalspinner").addClass("d-none"),form.find(".modalspinner").parent().prop("disabled",!1)}}}));

//# sourceMappingURL=uploadPopup.min.js.map