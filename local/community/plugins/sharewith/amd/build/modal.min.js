/**
 * Javascript controller for the "Actions" panel at the bottom of the page.
 *
 * @module     community_sharewith/modal
 * @package
 * @copyright  2018 Devlion <info@devlion.co>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @since      3.6
 */
define("community_sharewith/modal",["jquery","core/templates","core/notification","community_sharewith/storage","local_petel/inview"],(function($,Templates,Notification,St,inView){var SELECTORS_modalWrapper="#modalSharewith",SELECTORS_modalContent="#modalContentSharewith",SELECTORS_triggerBtn="#triggerModalSharewith",SELECTORS_sectionTitleTiles=".tile-clickable h3",SELECTORS_shareActivityButton="share-button-activity-area",SELECTORS_shareSectionButton="share-button-section-area";return{template:{modalwrapper:"community_sharewith/modalwrapper",chain:"community_sharewith/chain",selector:"community_sharewith/selector",copyinstance:"community_sharewith/copyinstance",subornot:"community_sharewith/subornot",error:"community_sharewith/error",empty:"community_sharewith/empty",confirm:"community_sharewith/confirm",confirm2:"community_sharewith/confirm2",shareteacher:"community_sharewith/shareteacher",sharecommunity:"community_sharewith/sharecommunity",uploadactivity:"community_sharewith/uploadactivity"},modalInit:!1,triggerBtn:"",modalContent:"",modalWrapper:"",courseFormat:"topic",addShareActivityButton:function(){let attr=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,node=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",self=this;const renderButton=target=>{let shareBtn=self.addSharedBtn(),cmid=target.data("cmid"),cmlink=target.data("cmlink");shareBtn.attr("data-handler","openDialog").attr("data-cmid",cmid).attr("data-cmlink",cmlink);for(const prop in attr)shareBtn.attr("data-".concat(prop),attr[prop]);target.html(shareBtn)};null!==attr&&attr.amit?setTimeout((function(){$("".concat(node,' [data-region="').concat(SELECTORS_shareActivityButton,'"]')).each((function(){renderButton($(this))}))}),2e3):$("".concat(node,' [data-region="').concat(SELECTORS_shareActivityButton,'"]')).each((function(){renderButton($(this))}));let observerNodeTargets=document.querySelectorAll(".section"),observerConfig={attributes:!1,childList:!0,subtree:!1};observerNodeTargets.forEach((function(target){new MutationObserver((function(type){type[0].addedNodes.forEach((node=>{let elem=$(node).find('*[data-region="'+SELECTORS_shareActivityButton+'"]');renderButton(elem)}))})).observe(target,observerConfig)}))},addCopySectionButtonInline:function(){let string=M.util.get_string("eventsectioncopy","community_sharewith"),self=this;const renderButton=target=>{let shareBtn=self.addSharedBtn(string),sectionid=target.data("sectionid");shareBtn.addClass("mr-2 ml-2").attr("data-handler","selectCourseForSection").attr("data-sectionid",sectionid).attr("data-inview","done"),target.append(shareBtn)};$('*[data-region="'+SELECTORS_shareSectionButton+'"]').each((function(){renderButton($(this))})),inView('*[data-region="'+SELECTORS_shareSectionButton+'"]').on("enter",(function(e){"done"!==$(e).find("button").data("inview")&&renderButton($(e))}));let observerNodeTargets=document.querySelectorAll(".flexsections"),observerConfig={attributes:!1,childList:!0,subtree:!1};observerNodeTargets.forEach((function(target){new MutationObserver((function(type){type[0].addedNodes.forEach((node=>{let elem=$(node).find('*[data-region="'+SELECTORS_shareSectionButton+'"]');renderButton(elem)}))})).observe(target,observerConfig)}))},addCopySectionButtonCollegueTeacher:function(){var string=M.util.get_string("eventsectioncopy","community_sharewith"),self=this;"tiles"===this.courseFormat&&$(document).find(SELECTORS_sectionTitleTiles).each((function(){var shareBtn=self.addSharedBtn(string),str=$(this).parents("li.tile-clickable").data("section"),sectionid=$(this).parents(".tile").data("sectionidshare");sectionid&&(shareBtn.attr("data-handler","selectCourseForSection").attr("data-firstcmid",str).attr("data-sectionid",sectionid),shareBtn.insertAfter($(this)))}))},addCopySectionButtonCollegueTeacherInView:function(){var string=M.util.get_string("eventsectioncopy","community_sharewith"),self=this;"tiles"===this.courseFormat&&setInterval((function(){$(".tiles_section_inview").each((function(){if($(this).length&&$(this).is(":visible")&&!$(this).hasClass("inview-selectCourseForSection-done")){var shareBtn=self.addSharedBtn(string),sectionid=$(this).data("sectionid");shareBtn.attr("data-handler","selectCourseForSection").attr("data-sectionid",sectionid).attr("data-amit","true"),shareBtn.addClass("ml-auto mr-2"),shareBtn.appendTo($(this)),$(this).addClass("inview-selectCourseForSection-done")}}))}),500),"grid"===this.courseFormat?inView(".grid_section_inview").on("enter",(function(e){setTimeout((()=>{var sectiontitle=$(e);if(!sectiontitle.hasClass("inview-selectCourseForSection-done")){var shareBtn=self.addSharedBtn(string),sectionid=sectiontitle.data("sectionid");shareBtn.attr("data-handler","selectCourseForSection").attr("data-sectionid",sectionid).attr("data-amit","true"),shareBtn.addClass("ml-auto mr-2"),sectiontitle.find("div.content h2.sectionname").addClass("w-100 d-flex align-items-center"),shareBtn.appendTo(sectiontitle.find("div.content h2.sectionname")),sectiontitle.addClass("inview-selectCourseForSection-done")}}),500)})):"topic"===this.courseFormat?inView(".topics_section_inview").on("enter",(function(e){setTimeout((()=>{var sectiontitle=$(e);if(!sectiontitle.hasClass("inview-selectCourseForSection-done")){var shareBtn=self.addSharedBtn(string),sectionid=sectiontitle.data("sectionid");shareBtn.attr("data-handler","selectCourseForSection").attr("data-sectionid",sectionid).attr("data-amit","true"),shareBtn.addClass("ml-auto mr-2"),sectiontitle.closest("li.section").find("div.content h2.sectionname span").addClass("w-100 d-flex align-items-center"),shareBtn.appendTo(sectiontitle.closest("li.section").find("div.content h2.sectionname span")),sectiontitle.addClass("inview-selectCourseForSection-done")}}),500)})):"flexsections"===this.courseFormat&&inView(".flexsections_section_inview").on("enter",(function(e){setTimeout((()=>{var sectiontitle=$(e);let sectionID=sectiontitle.data(sectionid).sectionid;$('[data-sectionidshare="'.concat(sectionID,'"]'));if(!sectiontitle.hasClass("inview-selectCourseForSection-done")){var shareBtn=self.addSharedBtn(string),sectionid=sectiontitle.data("sectionid");shareBtn.attr("data-handler","selectCourseForSection").attr("data-sectionid",sectionid).attr("data-amit","true"),shareBtn.addClass("ml-auto mr-2"),$(sectiontitle).children("ul.section").find("li").length>0?(sectiontitle.closest(".content").find("h2.sectionname").parent().addClass("w-100 d-flex align-items-center"),shareBtn.appendTo(sectiontitle.closest(".content").find("h2.sectionname").parent())):$(sectiontitle).siblings(".flexsections-level-1").length>0?($(sectiontitle).addClass("w-100 d-flex align-items-center"),shareBtn.appendTo(sectiontitle)):shareBtn.appendTo($(sectiontitle).siblings(".d-flex.align-items-center.justify-content-between")),sectiontitle.addClass("inview-selectCourseForSection-done")}}),500)}))},insertTemplates:function(){var self=this;return Templates.render("community_sharewith/modalwrapper",{}).done((function(html,js){self.modalInit||(Templates.appendNodeContents("body",html,js),self.modalInit=!0,self.modalWrapper=document.querySelector(SELECTORS_modalWrapper),self.modalContent=document.querySelector(SELECTORS_modalContent),self.triggerBtn=document.querySelector(SELECTORS_triggerBtn))})).fail(Notification.exception)},render:function(template,context){var self=this;return context.wwwroot=M.cfg.wwwroot,self.modalContent.innerHTML="",Templates.render(template,context).done((function(html,js){Templates.replaceNodeContents(self.modalContent,html,js)})).fail(Notification.exception)},addActionNode:function(actions){this.checkCourseFormat();var result=0;if(actions.activitycopyenable&&!actions.teachercolleague&&(this.addShareActivityButton(),result++),actions.teachercolleague){var attr={amit:!0},self=this;if(this.addShareActivityButton(attr),"tiles"===this.courseFormat){var observerNodeTargets=document.querySelectorAll(".section.moveablesection"),observerConfig={attributes:!1,childList:!0,subtree:!1};observerNodeTargets.forEach((function(target){new MutationObserver((function(type){type[0].addedNodes.forEach((node=>{$(node).hasClass("content")&&self.addShareActivityButton(attr)}))})).observe(target,observerConfig)}))}result++}return!!result},addBtnSpinner:function(){let obj=$("#modalspinner");obj.removeClass("d-none").addClass("loading"),obj.parent().prop("disabled",!0)},removeBtnSpinner:function(){let obj=$("#modalspinner");obj.removeClass("loading").addClass("d-none"),obj.parent().prop("disabled",!1)},addSharedBtn:function(){let string=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;var text=string||M.util.get_string("share","community_sharewith"),shareBtn=$('<button><i class="fa-light fa-share-nodes"></i></button>');return shareBtn.addClass("sharebtn").attr("data-sharebtn",!0),shareBtn.find(".icon").attr("title",text).attr("aria-label",text),shareBtn},checkCourseFormat:function(){$("body").hasClass("format-tiles")&&(this.courseFormat="tiles"),$("body").hasClass("format-grid")&&(this.courseFormat="grid"),$("body").hasClass("format-topic")&&(this.courseFormat="topic"),$("body").hasClass("format-flexsections")&&(this.courseFormat="flexsections")},goBack:function(){var context={amit:St.amit,haveviewlink:St.haveviewlink};this.render(this.template.selector,context)}}}));

//# sourceMappingURL=modal.min.js.map