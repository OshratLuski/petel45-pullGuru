/**
 * Javascript controller for the "Actions" panel at the bottom of the page.
 *
 * @module     community_sharewith/sharewithcommunity
 * @package
 * @copyright  2018 Devlion <info@devlion.co>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @since      3.6
 */
define("community_sharewith/sharewithcommunity",["jquery","core/ajax","core/notification","community_sharewith/modal","community_sharewith/storage"],(function($,Ajax,Notification,modal,St){return{resultBlock:"",tagWrapper:"",input:"",init:function(){var root=modal.modalWrapper;root.addEventListener("click",function(e){for(var target=e.target;root.contains(target);){switch(target.dataset.handler){case"sendToTeachersCommunity":this.submitCommunity();break;case"shareCommunity":this.shareCommunity()}target=target.parentNode}}.bind(this))},shareCommunity:function(){var self=this;Ajax.call([{methodname:"community_sharewith_get_community",args:{activityid:Number(St.cmid),courseid:Number(St.getCurrentCourse())},done:function(response){var context=JSON.parse(response);modal.render(modal.template.sharecommunity,context).done((function(){self.resultBlock=document.querySelector(".result-block"),self.tagWrapper=document.querySelector(".tag-wrapper"),self.input=document.querySelector('input[data-handler = "selectTeacher"]')}))},fail:Notification.exception}])},submitCommunity:function(){var coursesId=[];if($.each($("#teachers_courses").select2("data"),(function(index,obj){0!==obj.id.length&&coursesId.push(obj.id)})),0!==coursesId.length){modal.addBtnSpinner();var message=$("#message_for_teacher").val();Ajax.call([{methodname:"community_sharewith_submit_teachers",args:{activityid:Number(St.cmid),courseid:Number(St.getCurrentCourse()),teachersid:JSON.stringify([]),coursesid:JSON.stringify(coursesId),message:message,sequence:JSON.stringify(St.activityChain)},done:function(response){var template=modal.template.error,context={title:M.util.get_string("eventcopytoteacher","community_sharewith"),text:M.util.get_string("system_error_contact_administrator","community_sharewith")};response&&(template=modal.template.confirm,context.text=M.util.get_string("succesfullyshared","community_sharewith")),modal.render(template,context)},fail:Notification.exception}])}else $("#error_share_to_community").show()}}}));

//# sourceMappingURL=sharewithcommunity.min.js.map