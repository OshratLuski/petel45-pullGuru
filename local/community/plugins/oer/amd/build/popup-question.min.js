define("community_oer/popup-question",["jquery","core/yui","core/str","core/modal_factory","core/modal_events","core/ajax","core/templates","core/notification"],(function($,Y,Str,ModalFactory,ModalEvents,Ajax,Templates,Notification){var SELECTORS_mainAside=".main-aside",SELECTORS_mainDashboard=".main-dashboard",SELECTORS_mainTitle=".main-title",SELECTORS_filterPills=".checked-option-pills",SELECTORS_filterButtonArea=".activity-filters",SELECTORS_totalItems=".total-activities-block",SELECTORS_blockContent=".activity-blocks-content",SELECTORS_mainTotalElementsActivity=".main-total-elements-activity",SELECTORS_mainTotalElementsQuestion=".main-total-elements-question",SELECTORS_mainTotalElementsSequence=".main-total-elements-sequence",current_aside_question={},prev_search_question={};return{init:function(callback){Ajax.call([{methodname:"community_oer_get_question_instance",args:{},done:function(response){callback(response)},fail:Notification.exception}])},mergeInstanceWithPreset:function(instance_data,preset_data,callback){callback(instance_data)},renderInstance:function(instance_data,current_aside,prev_search,preset_data,callback){var self=this;current_aside_question=current_aside,prev_search_question=prev_search,this.mergeInstanceWithPreset(instance_data,preset_data,(function(data){Templates.render("community_oer/question/popup/aside",data).done((function(html,js){current_aside_question.render_aside&&Templates.replaceNodeContents(SELECTORS_mainAside,html,js),Templates.render("community_oer/question/popup/dashboard",data).done((function(html,js){Templates.replaceNodeContents(SELECTORS_mainDashboard,html,js),prev_search_question.length>0?$.each(prev_search_question,(function(index,value){var param=value;self.createPillSearch(param,value,(function(){self.defaultRenderBlocks(),callback()}))})):(self.defaultRenderBlocks(),callback())})).fail(Notification.exception)})).fail(Notification.exception)}))},defaultRenderBlocks:function(){var elements=$("*").filter((function(){return"question"===$(this).data("plugin")&&"sidemenu"===$(this).data("area")}));$(elements).each((function(){$(this).data("action")===current_aside_question.type&&$(this).data("value")===current_aside_question.value&&void 0===$(this).data("secondaction")&&void 0===current_aside_question.url_params.childcategory&&$(this).click(),$(this).data("action")===current_aside_question.type&&$(this).data("value")===current_aside_question.value&&void 0!==current_aside_question.url_params.childcategory&&$(this).data("childcategory")===parseInt(current_aside_question.url_params.childcategory)&&$(this).click()}))},actionOnClick:function(object){$(".btn-view-selected-questions").hasClass("active")&&($(".btn-view-selected-questions").removeClass("active"),$(".btn-view-selected-questions").removeClass("btn-success"),$(".btn-view-selected-questions").addClass("btn-outline-primary"));var data=$(object).data(),self=this;if("sidemenu"===data.area){var elements=$("*").filter((function(){return"question"===$(this).data("plugin")&&"sidemenu"===$(this).data("area")}));$(elements).each((function(){$(this).removeData("selected")})),$(object).data("selected","1")}if("filters"===data.area)if(void 0!==$(object).data("selected"))$(object).removeData("selected"),this.removePill($(object).attr("id"));else{$(object).data("selected","1");var text=$(object).parent().find("label").html().trim();this.createPill($(object).attr("id"),text)}if("paging"===data.area){var _elements=$("*").filter((function(){return"question"===$(this).data("plugin")&&"paging"===$(this).data("area")}));$(_elements).each((function(){$(this).data("selected",0)})),$(object).data("selected","1")}if("paging"!==data.area){var _elements2=$("*").filter((function(){return"question"===$(this).data("plugin")&&"paging"===$(this).data("area")}));$(_elements2).each((function(){$(this).data("selected",0)}))}if("hidden"===data.area&&(void 0!==$(object).data("selected")?$(object).removeData("selected"):$(object).data("selected","1")),"pill"===data.area){var id=data.value;$(SELECTORS_filterButtonArea).find("#"+id).trigger("click");var buttons=$(SELECTORS_filterPills).find("button");1===buttons.length&&buttons.remove()}if("pillsearch"===data.area&&self.removePillSearch(object),"removeallpills"===data.area){var _elements3=$("*").filter((function(){return"filters"===$(this).data("area")}));$(_elements3).each((function(){$(this).removeData("selected"),$(this).prop("checked",!1),self.removePill($(this).attr("id"))}));var elementssearch=$("*").filter((function(){return"pillsearch"===$(this).data("area")}));$(elementssearch).each((function(){self.removePillSearch(this)}))}if("sorting"===data.area){var flag=!0;1===parseInt($(object).data("selected"))&&(flag=!1);var _elements4=$("*").filter((function(){return"question"===$(this).data("plugin")&&"sorting"===$(this).data("area")}));$(_elements4).each((function(){$(this).data("selected","0")})),flag&&$(object).data("selected","1")}if("sort-column"===data.area&&$(object).data("selected","1"),"mainsearch"===data.area){var param=data.value;this.createPillSearch(param,data.value,(function(){self.renderBlocks()}))}else this.renderBlocks();this.changeTitleBreadcrumbs(object)},returnPreset:function(){var selected=$("*").filter((function(){return"question"===$(this).data("plugin")&&("1"===$(this).data("selected")||1===$(this).data("selected"))})),dataselected={};return $(selected).each((function(index){dataselected[index]=$(this).data()})),dataselected},renderBlocks:function(){var returnpreset=this.returnPreset();$(SELECTORS_blockContent).find(".question-item-wrapper").remove(),$(SELECTORS_blockContent).find(".pagination").remove(),Templates.render("community_oer/loading",{}).done((function(html,js){Templates.replaceNodeContents(SELECTORS_blockContent,html,js)})).fail(Notification.exception),Ajax.call([{methodname:"community_oer_get_question_blocks",args:{presets:JSON.stringify(returnpreset)},done:function(response){var result=JSON.parse(response);Str.get_strings([{key:"resultsearch",component:"community_oer"},{key:"items",component:"community_oer"},{key:"itemshidden",component:"community_oer"}]).done((function(strings){var str="";str=result.if_hidden_items?strings[0]+": "+result.total_blocks_hidden+" "+strings[2]:strings[0]+": "+result.total_blocks+" "+strings[1],$(SELECTORS_totalItems).html(str),$(SELECTORS_mainTotalElementsActivity).html("("+result.activity_total_all_blocks+")"),$(SELECTORS_mainTotalElementsQuestion).html("("+result.question_total_all_blocks+")"),$(SELECTORS_mainTotalElementsSequence).html("("+result.sequence_total_all_blocks+")"),Templates.render("community_oer/question/popup/block",result).done((function(html,js){Templates.replaceNodeContents(SELECTORS_blockContent,html,js),callback()})).fail(Notification.exception)}))},fail:Notification.exception}])},renderSelectedBlocks:function(qids){this.returnPreset();$(SELECTORS_blockContent).find(".question-item-wrapper").remove(),$(SELECTORS_blockContent).find(".pagination").remove(),Templates.render("community_oer/loading",{}).done((function(html,js){Templates.replaceNodeContents(SELECTORS_blockContent,html,js)})).fail(Notification.exception),Ajax.call([{methodname:"community_oer_get_selected_question_blocks",args:{qids:JSON.stringify(qids)},done:function(response){var result=JSON.parse(response);Str.get_strings([{key:"resultselected",component:"community_oer"},{key:"qitems",component:"community_oer"},{key:"itemshidden",component:"community_oer"}]).done((function(strings){var str=strings[0]+": "+result.total_blocks+" "+strings[1];$(SELECTORS_totalItems).html(str),Templates.render("community_oer/question/popup/block",result).done((function(html,js){Templates.replaceNodeContents(SELECTORS_blockContent,html,js),callback()})).fail(Notification.exception)}))},fail:Notification.exception}])},changeTitleBreadcrumbs:function(object){var title=$(object).data("breadcrumbs");$(SELECTORS_mainTitle).html(title)},createPill:function(id,text){Str.get_strings([{key:"removeallpills",component:"community_oer"}]).done((function(strings){var pillTarget=$(SELECTORS_filterPills);if(!pillTarget.find("button").length){var pillremoveall=$('\n                    <button type="button" data-plugin="question" data-area="removeallpills" class="removeallpills btn btn-secondary  mr-3 py-1 px-3  mb-2">\n                        '.concat(strings[0],"                       \n                    </button>"));pillTarget.append(pillremoveall)}var pill=$('\n                <div class="checked-option-pill rounded-pill bg-light text-primary border border-primary mr-3 py-1 px-3 mb-2" data-id="'.concat(id,'">\n                    <span class="checked-option-pill-name">').concat(text,'</span>\n                    <button type="button" class="close ml-3" aria-label="Close">\n                        <span aria-hidden="true" data-plugin="question" data-area="pill" data-value="').concat(id,'">&times;</span>\n                    </button>\n                </div>'));pillTarget.append(pill)}))},removePill:function(id){$(SELECTORS_filterPills).find('[data-id="'.concat(id,'"]')).remove();var buttons=$(SELECTORS_filterPills).find("button");1===buttons.length&&buttons.remove()},createPillSearch:function(query,text,callback){Str.get_strings([{key:"removeallpills",component:"community_oer"}]).done((function(strings){var pillTarget=$(SELECTORS_filterPills);if(!pillTarget.find("button").length){var pillremoveall=$('\n                    <button type="button" data-plugin="question" data-area="removeallpills" class="removeallpills btn btn-secondary mr-3 py-1 px-3 mb-2">\n                        '.concat(strings[0],"                       \n                    </button>"));pillTarget.append(pillremoveall)}var pill=$('\n                <div class="checked-option-pill search-pill rounded-pill bg-light text-primary border border-primary mr-3 py-1 px-3 mb-2" data-id="'.concat(query,'">\n                    <span class="checked-option-pill-name">').concat(text,'</span>\n                    <button type="button" class="close ml-3" aria-label="Close">\n                        <span aria-hidden="true" data-plugin="question" data-area="pillsearch" data-value="').concat(query,'" data-selected="1">&times;</span>\n                    </button>\n                </div>'));pillTarget.append(pill),callback()}))},removePillSearch:function(object){$(object).parent().parent().remove();var buttons=$(SELECTORS_filterPills).find("button");1===buttons.length&&buttons.remove()},singlePage:function(data){Templates.render("community_oer/question/popup/block",data).done((function(html,js){Templates.prependNodeContents("#page-content",html,js)})).fail(Notification.exception)},iframeProperties:function(id){window.addEventListener("load",(function(e){var data=[document.getElementById("region-main").offsetHeight,id];top.postMessage(data),document.getElementById("page-question-preview").style.overflow="scroll",new SimpleBar(document.getElementById("page-question-preview"),{autoHide:!1})}))}}}));

//# sourceMappingURL=popup-question.min.js.map