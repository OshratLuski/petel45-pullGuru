define("community_oer/course",["jquery","core/yui","core/str","core/modal_factory","core/modal_events","core/ajax","core/templates","core/notification","community_sharecourse/main"],(function($,Y,Str,ModalFactory,ModalEvents,Ajax,Templates,Notification,Sharecourse){let SELECTORS_mainAside=".main-aside",SELECTORS_mainDashboard=".main-dashboard",SELECTORS_mainTitle=".main-title",SELECTORS_filterPills=".checked-option-pills",SELECTORS_filterButtonArea=".activity-filters",SELECTORS_totalItems=".total-activities-block",SELECTORS_blockContent=".activity-blocks-content",SELECTORS_mainTotalElementsActivity=".main-total-elements-activity",SELECTORS_mainTotalElementsQuestion=".main-total-elements-question",SELECTORS_mainTotalElementsSequence=".main-total-elements-sequence",SELECTORS_mainTotalElementsCourse=".main-total-elements-course",current_aside_course={},prev_search_course={},default_filters_course={},if_iframe=!1,if_scroll_up=!1;return{init:function(callback){if_iframe=$("#main-page-iframe").val(),Ajax.call([{methodname:"community_oer_get_course_instance",args:{},done:function(response){callback(response)},fail:Notification.exception}])},mergeInstanceWithPreset:function(instance_data,preset_data,callback){callback(instance_data)},renderInstance:function(instance_data,current_aside,prev_search,preset_data,callback){let self=this;default_filters_course=instance_data.default_filters,current_aside_course=current_aside,prev_search_course=prev_search,this.mergeInstanceWithPreset(instance_data,preset_data,(function(data){Templates.render("community_oer/course/aside",data).done((function(html,js){current_aside_course.render_aside&&Templates.replaceNodeContents(SELECTORS_mainAside,html,js),Templates.render("community_oer/course/dashboard",data).done((function(html,js){Templates.replaceNodeContents(SELECTORS_mainDashboard,html,js),prev_search_course.length>0?$.each(prev_search_course,(function(index,value){let param=value='"'+value+'"';self.createPillSearch(param,value,(function(){self.defaultRenderBlocks(),callback()}))})):(self.defaultRenderBlocks(),callback())})).fail(Notification.exception)})).fail(Notification.exception)}))},defaultRenderBlocks:function(){let self=this,filters=$("*").filter((function(){return"course"===$(this).data("plugin")&&"filters"===$(this).data("area")}));$.each(default_filters_course,(function(key,value){$(filters).each((function(){if($(this).data("action")===value.filter&&$(this).data("value")===value.value){$(this).data("selected","1"),$(this).prop("checked",!0);let text=$(this).parent().find("label").html().trim();self.createPill($(this).attr("id"),text)}}))}));let elements=$("*").filter((function(){return"course"===$(this).data("plugin")&&"sidemenu"===$(this).data("area")}));"section"===current_aside_course.type&&(current_aside_course.type="course",current_aside_course.value=current_aside_course.parentcourse),$(elements).each((function(){$(this).data("action")===current_aside_course.type&&$(this).data("value")===current_aside_course.value&&$(this).click()}))},actionOnClick:function(object){let data=$(object).data(),self=this;if("sidemenu"===data.area){let elements=$("*").filter((function(){return"course"===$(this).data("plugin")&&"sidemenu"===$(this).data("area")}));$(elements).each((function(){$(this).removeData("selected")})),$(object).data("selected","1")}if("filters"===data.area)if(void 0!==$(object).data("selected"))$(object).removeData("selected"),this.removePill($(object).attr("id"));else{$(object).data("selected","1");let text=$(object).parent().find("label").html().trim();this.createPill($(object).attr("id"),text)}if("paging"===data.area){let elements=$("*").filter((function(){return"course"===$(this).data("plugin")&&"paging"===$(this).data("area")}));$(elements).each((function(){$(this).data("selected",0)})),$(object).data("selected","1"),if_scroll_up=!0}if("paging"!==data.area){let elements=$("*").filter((function(){return"course"===$(this).data("plugin")&&"paging"===$(this).data("area")}));$(elements).each((function(){$(this).data("selected",0)}))}if("pill"===data.area){let id=data.value;$(SELECTORS_filterButtonArea).find("#"+id).trigger("click");let buttons=$(SELECTORS_filterPills).find("button");1===buttons.length&&buttons.remove()}if("pillsearch"===data.area&&self.removePillSearch(object),"removeallpills"===data.area){let elements=$("*").filter((function(){return"filters"===$(this).data("area")}));$(elements).each((function(){$(this).removeData("selected"),$(this).prop("checked",!1),self.removePill($(this).attr("id"))}));let elementssearch=$("*").filter((function(){return"pillsearch"===$(this).data("area")}));$(elementssearch).each((function(){self.removePillSearch(this)}))}if("sorting"===data.area){let flag=!0;1===parseInt($(object).data("selected"))&&(flag=!1);let elements=$("*").filter((function(){return"course"===$(this).data("plugin")&&"sorting"===$(this).data("area")}));$(elements).each((function(){$(this).data("selected","0")})),flag&&$(object).data("selected","1")}if("mainsearch"===data.area){let param=data.value;this.createPillSearch(param,data.value,(function(){self.renderBlocks()}))}else this.renderBlocks();this.changeTitleBreadcrumbs(object)},returnPreset:function(){let selected=$("*").filter((function(){return"course"===$(this).data("plugin")&&("1"===$(this).data("selected")||1===$(this).data("selected"))})),dataselected={};return $(selected).each((function(index){dataselected[index]=$(this).data()})),dataselected},renderBlocks:function(){let returnpreset=this.returnPreset();$(SELECTORS_blockContent).find(".activity-item").remove(),$(SELECTORS_blockContent).find(".pagination").remove(),Templates.render("community_oer/loading",{}).done((function(html,js){Templates.replaceNodeContents(SELECTORS_blockContent,html,js)})).fail(Notification.exception),Ajax.call([{methodname:"community_oer_get_course_blocks",args:{presets:JSON.stringify(returnpreset)},done:function(response){let result=JSON.parse(response);result.iframe=1===parseInt(if_iframe),Str.get_strings([{key:"resultsearch",component:"community_oer"},{key:"items",component:"community_oer"}]).done((function(strings){let str=strings[0]+": "+result.total_blocks+" "+strings[1];$(SELECTORS_totalItems).html(str),$(SELECTORS_mainTotalElementsActivity).html("("+result.activity_total_all_blocks+")"),$(SELECTORS_mainTotalElementsQuestion).html("("+result.question_total_all_blocks+")"),$(SELECTORS_mainTotalElementsSequence).html("("+result.sequence_total_all_blocks+")"),$(SELECTORS_mainTotalElementsCourse).html("("+result.course_total_all_blocks+")"),Templates.render("community_oer/course/block",result).done((function(html,js){if(Templates.replaceNodeContents(SELECTORS_blockContent,html,js),if_scroll_up){document.querySelector(".activity-block-header").scrollIntoView({behavior:"smooth",block:"end",inline:"nearest"}),if_scroll_up=!1}callback()})).fail(Notification.exception)}))},fail:Notification.exception}])},changeTitleBreadcrumbs:function(object){let title=$(object).data("breadcrumbs");$(SELECTORS_mainTitle).html(title)},createPill:function(id,text){Str.get_strings([{key:"removeallpills",component:"community_oer"}]).done((function(strings){let pillTarget=$(SELECTORS_filterPills);if(!pillTarget.find("button").length){let pillremoveall=$('\n                    <button type="button" data-plugin="course" data-area="removeallpills" class="removeallpills btn btn-secondary mr-3 py-1 px-3 mb-2">\n                        '.concat(strings[0],"                       \n                    </button>"));pillTarget.append(pillremoveall)}let pill=$('\n                <div class="checked-option-pill rounded-pill bg-light text-primary border border-primary mr-3 py-1 px-3 mb-2" data-id="'.concat(id,'">\n                    <span class="checked-option-pill-name">').concat(text,'</span>\n                    <button type="button" class="close ml-3" aria-label="Close">\n                        <span aria-hidden="true" data-plugin="course" data-area="pill" data-value="').concat(id,'">&times;</span>\n                    </button>\n                </div>'));pillTarget.append(pill)}))},removePill:function(id){$(SELECTORS_filterPills).find('[data-id="'.concat(id,'"]')).remove();let buttons=$(SELECTORS_filterPills).find("button");1===buttons.length&&buttons.remove()},createPillSearch:function(query,text,callback){Str.get_strings([{key:"removeallpills",component:"community_oer"}]).done((function(strings){let pillTarget=$(SELECTORS_filterPills);if(!pillTarget.find("button").length){let pillremoveall=$('\n                    <button type="button" data-plugin="course" data-area="removeallpills" class="removeallpills btn btn-secondary mr-3 py-1 px-3 mb-2">\n                        '.concat(strings[0],"                       \n                    </button>"));pillTarget.append(pillremoveall)}let simpleword=!1;if(query.length>0&&'"'===query[0]&&'"'===query[query.length-1]&&(simpleword=!0,query=query.substring(1,query.length-1)),simpleword){let pill=$('\n                        <div class="checked-option-pill search-pill rounded-pill bg-light text-primary border border-primary mr-3 py-1 px-3 mb-2" data-id="'.concat(query,'">\n                            <span class="checked-option-pill-name">').concat(query,'</span>\n                            <button type="button" class="close ml-3" aria-label="Close">\n                                <span aria-hidden="true" data-plugin="course" data-area="pillsearch" data-value="').concat(query,'" data-selected="1">&times;</span>\n                            </button>\n                        </div>'));pillTarget.append(pill)}else query.split(" ").forEach((function(value){if(value.length>0){let pill=$('\n                                <div class="checked-option-pill search-pill rounded-pill bg-light text-primary border border-primary mr-3 py-1 px-3 mb-2" data-id="'.concat(value,'">\n                                    <span class="checked-option-pill-name">').concat(value,'</span>\n                                    <button type="button" class="close ml-3" aria-label="Close">\n                                        <span aria-hidden="true" data-plugin="course" data-area="pillsearch" data-value="').concat(value,'" data-selected="1">&times;</span>\n                                    </button>\n                                </div>'));pillTarget.append(pill)}}));callback()}))},removePillSearch:function(object){$(object).parent().parent().remove();let buttons=$(SELECTORS_filterPills).find("button");1===buttons.length&&buttons.remove()},downloadCourse:function(){$(".copy-course-btn").on("click",(function(){let cid=$(this).data("cid");1===$(this).data("error-category")?Str.get_strings([{key:"error"},{key:"error_category",component:"community_oer"}]).done((function(strings){var modalPromise=ModalFactory.create({type:ModalFactory.types.ALERT,title:strings[0],body:strings[1]});$.when(modalPromise).then((function(fmodal){return fmodal.show(),fmodal})).fail(Notification.exception)})):Sharecourse.download_from_catalog(cid)}))},downloadCoursePombim:function(){$(".copy-course-pombim-btn").on("click",(function(){let cid=$(this).data("cid");1===$(this).data("error-category")?Str.get_strings([{key:"error"},{key:"error_category",component:"community_oer"}]).done((function(strings){var modalPromise=ModalFactory.create({type:ModalFactory.types.ALERT,title:strings[0],body:strings[1]});$.when(modalPromise).then((function(fmodal){return fmodal.show(),fmodal})).fail(Notification.exception)})):Sharecourse.download_from_catalog(cid)}))}}}));

//# sourceMappingURL=course.min.js.map