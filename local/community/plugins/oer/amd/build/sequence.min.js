define("community_oer/sequence",["jquery","core/yui","core/str","core/modal_factory","core/modal_events","core/ajax","core/templates","core/notification"],(function($,Y,Str,ModalFactory,ModalEvents,Ajax,Templates,Notification){let SELECTORS_mainAside=".main-aside",SELECTORS_mainDashboard=".main-dashboard",SELECTORS_mainTitle=".main-title",SELECTORS_filterPills=".checked-option-pills",SELECTORS_filterButtonArea=".activity-filters",SELECTORS_totalItems=".total-sequences-block",SELECTORS_blockContent=".sequence-blocks-content",SELECTORS_mainTotalElementsActivity=".main-total-elements-activity",SELECTORS_mainTotalElementsQuestion=".main-total-elements-question",SELECTORS_mainTotalElementsSequence=".main-total-elements-sequence",SELECTORS_mainTotalElementsCourse=".main-total-elements-course",current_aside_sequence={},prev_search_sequence={},default_filters_sequence={},if_iframe=!1,if_scroll_up=!1;return{init:function(callback){if_iframe=$("#main-page-iframe").val(),Ajax.call([{methodname:"community_oer_get_sequence_instance",args:{},done:function(response){callback(response)},fail:Notification.exception}])},mergeInstanceWithPreset:function(instance_data,preset_data,callback){callback(instance_data)},renderInstance:function(instance_data,current_aside,prev_search,preset_data,callback){let self=this;default_filters_sequence=instance_data.default_filters,current_aside_sequence=current_aside,prev_search_sequence=prev_search,this.mergeInstanceWithPreset(instance_data,preset_data,(function(data){Templates.render("community_oer/sequence/aside",data).done((function(html,js){current_aside_sequence.render_aside&&Templates.replaceNodeContents(SELECTORS_mainAside,html,js),Templates.render("community_oer/sequence/dashboard",data).done((function(html,js){Templates.replaceNodeContents(SELECTORS_mainDashboard,html,js),prev_search_sequence.length>0?$.each(prev_search_sequence,(function(index,value){let param=value='"'+value+'"';self.createPillSearch(param,value,(function(){self.defaultRenderBlocks(),callback()}))})):(self.defaultRenderBlocks(),callback())})).fail(Notification.exception)})).fail(Notification.exception)}))},defaultRenderBlocks:function(){let self=this,filters=$("*").filter((function(){return"sequence"===$(this).data("plugin")&&"filters"===$(this).data("area")}));$.each(default_filters_sequence,(function(key,value){$(filters).each((function(){if($(this).data("action")===value.filter&&$(this).data("value")===value.value){$(this).data("selected","1"),$(this).prop("checked",!0);let text=$(this).parent().find("label").html().trim();self.createPill($(this).attr("id"),text)}}))}));let elements=$("*").filter((function(){return"sequence"===$(this).data("plugin")&&"sidemenu"===$(this).data("area")}));$(elements).each((function(){$(this).data("action")===current_aside_sequence.type&&$(this).data("value")===current_aside_sequence.value&&$(this).click()}))},actionOnClick:function(object){let data=$(object).data(),self=this;if("sidemenu"===data.area){let elements=$("*").filter((function(){return"sequence"===$(this).data("plugin")&&"sidemenu"===$(this).data("area")}));$(elements).each((function(){$(this).removeData("selected")})),$(object).data("selected","1")}if("filters"===data.area)if(void 0!==$(object).data("selected"))$(object).removeData("selected"),this.removePill($(object).attr("id"));else{$(object).data("selected","1");let text=$(object).parent().find("label").html().trim();this.createPill($(object).attr("id"),text)}if("paging"===data.area){let elements=$("*").filter((function(){return"sequence"===$(this).data("plugin")&&"paging"===$(this).data("area")}));$(elements).each((function(){$(this).data("selected",0)})),$(object).data("selected","1"),if_scroll_up=!0}if("paging"!==data.area){let elements=$("*").filter((function(){return"sequence"===$(this).data("plugin")&&"paging"===$(this).data("area")}));$(elements).each((function(){$(this).data("selected",0)}))}if("pill"===data.area){let id=data.value;$(SELECTORS_filterButtonArea).find("#"+id).trigger("click");let buttons=$(SELECTORS_filterPills).find("button");1===buttons.length&&buttons.remove()}if("pillsearch"===data.area&&self.removePillSearch(object),"removeallpills"===data.area){let elements=$("*").filter((function(){return"filters"===$(this).data("area")}));$(elements).each((function(){$(this).removeData("selected"),$(this).prop("checked",!1),self.removePill($(this).attr("id"))}));let elementssearch=$("*").filter((function(){return"pillsearch"===$(this).data("area")}));$(elementssearch).each((function(){self.removePillSearch(this)}))}if("sorting"===data.area){let flag=!0;1===parseInt($(object).data("selected"))&&(flag=!1);let elements=$("*").filter((function(){return"sequence"===$(this).data("plugin")&&"sorting"===$(this).data("area")}));$(elements).each((function(){$(this).data("selected","0")})),flag&&$(object).data("selected","1")}if("mainsearch"===data.area){let param=data.value;this.createPillSearch(param,data.value,(function(){self.renderBlocks()}))}else this.renderBlocks();this.changeTitleBreadcrumbs(object)},returnPreset:function(){let selected=$("*").filter((function(){return"sequence"===$(this).data("plugin")&&("1"===$(this).data("selected")||1===$(this).data("selected"))})),dataselected={};return $(selected).each((function(index){dataselected[index]=$(this).data()})),dataselected},renderBlocks:function(){let returnpreset=this.returnPreset();$(SELECTORS_blockContent).find(".sequence-item").remove(),$(SELECTORS_blockContent).find(".pagination").remove(),Templates.render("community_oer/loading",{}).done((function(html,js){Templates.replaceNodeContents(SELECTORS_blockContent,html,js)})).fail(Notification.exception),Ajax.call([{methodname:"community_oer_get_sequence_blocks",args:{presets:JSON.stringify(returnpreset)},done:function(response){let result=JSON.parse(response);result.iframe=1===parseInt(if_iframe),Str.get_strings([{key:"resultsearch",component:"community_oer"},{key:"items",component:"community_oer"}]).done((function(strings){let str=strings[0]+": "+result.total_blocks+" "+strings[1];$(SELECTORS_totalItems).html(str),$(SELECTORS_mainTotalElementsActivity).html("("+result.activity_total_all_blocks+")"),$(SELECTORS_mainTotalElementsQuestion).html("("+result.question_total_all_blocks+")"),$(SELECTORS_mainTotalElementsSequence).html("("+result.sequence_total_all_blocks+")"),$(SELECTORS_mainTotalElementsCourse).html("("+result.course_total_all_blocks+")"),Templates.render("community_oer/sequence/block",result).done((function(html,js){if(Templates.replaceNodeContents(SELECTORS_blockContent,html,js),if_scroll_up){document.querySelector(".activity-block-header").scrollIntoView({behavior:"smooth",block:"end",inline:"nearest"}),if_scroll_up=!1}callback()})).fail(Notification.exception)}))},fail:Notification.exception}])},changeTitleBreadcrumbs:function(object){let title=$(object).data("breadcrumbs");$(SELECTORS_mainTitle).html(title)},createPill:function(id,text){Str.get_strings([{key:"removeallpills",component:"community_oer"}]).done((function(strings){let pillTarget=$(SELECTORS_filterPills);if(!pillTarget.find("button").length){let pillremoveall=$('\n                    <button type="button" data-plugin="sequence" data-area="removeallpills" class="removeallpills btn btn-secondary mr-3 py-1 px-3 mb-2">\n                        '.concat(strings[0],"                       \n                    </button>"));pillTarget.append(pillremoveall)}let pill=$('\n                <div class="checked-option-pill rounded-pill bg-light text-primary border border-primary mr-3 py-1 px-3 mb-2" data-id="'.concat(id,'">\n                    <span class="checked-option-pill-name">').concat(text,'</span>\n                    <button type="button" class="close ml-3" aria-label="Close">\n                        <span aria-hidden="true" data-plugin="sequence" data-area="pill" data-value="').concat(id,'">&times;</span>\n                    </button>\n                </div>'));pillTarget.append(pill)}))},removePill:function(id){$(SELECTORS_filterPills).find('[data-id="'.concat(id,'"]')).remove();let buttons=$(SELECTORS_filterPills).find("button");1===buttons.length&&buttons.remove()},createPillSearch:function(query,text,callback){Str.get_strings([{key:"removeallpills",component:"community_oer"}]).done((function(strings){let pillTarget=$(SELECTORS_filterPills);if(!pillTarget.find("button").length){let pillremoveall=$('\n                    <button type="button" data-plugin="sequence" data-area="removeallpills" class="removeallpills btn btn-secondary mr-3 py-1 px-3 mb-2">\n                        '.concat(strings[0],"                       \n                    </button>"));pillTarget.append(pillremoveall)}let simpleword=!1;if(query.length>0&&'"'===query[0]&&'"'===query[query.length-1]&&(simpleword=!0,query=query.substring(1,query.length-1)),simpleword){let pill=$('\n                        <div class="checked-option-pill search-pill rounded-pill bg-light text-primary border border-primary mr-3 py-1 px-3 mb-2" data-id="'.concat(query,'">\n                            <span class="checked-option-pill-name">').concat(query,'</span>\n                            <button type="button" class="close ml-3" aria-label="Close">\n                                <span aria-hidden="true" data-plugin="sequence" data-area="pillsearch" data-value="').concat(query,'" data-selected="1">&times;</span>\n                            </button>\n                        </div>'));pillTarget.append(pill)}else query.split(" ").forEach((function(value){if(value.length>0){let pill=$('\n                                <div class="checked-option-pill search-pill rounded-pill bg-light text-primary border border-primary mr-3 py-1 px-3 mb-2" data-id="'.concat(value,'">\n                                    <span class="checked-option-pill-name">').concat(value,'</span>\n                                    <button type="button" class="close ml-3" aria-label="Close">\n                                        <span aria-hidden="true" data-plugin="sequence" data-area="pillsearch" data-value="').concat(value,'" data-selected="1">&times;</span>\n                                    </button>\n                                </div>'));pillTarget.append(pill)}}));callback()}))},removePillSearch:function(object){$(object).parent().parent().remove();let buttons=$(SELECTORS_filterPills).find("button");1===buttons.length&&buttons.remove()},openDropdownMenuForBlock:function(){let DROPDOWN_MENU={};$(".dropdown.copy-sequence-dropdown-wrapper").on("show.bs.dropdown",(function(){!function(target){Templates.render("community_oer/loading",{}).done((function(html,js){Templates.replaceNodeContents(target.find(".copy-sequence-dropdown"),html,js)})).fail(Notification.exception),Ajax.call([{methodname:"community_oer_get_my_courses_and_sections",args:{},done:function(response){!function(resp,target){Templates.render("community_oer/sequence/copy-sequence-dropdown",resp).then((function(html,js){var courses;Templates.replaceNodeContents(target.find(".copy-sequence-dropdown"),html,js),target.find(".preloading-wrapper").hide(),target.find(".dropdown-courses").show(),DROPDOWN_MENU.targetDropdown=target.find(".dropdown"),DROPDOWN_MENU.courses=target.find(".dropdown-item.course-item"),DROPDOWN_MENU.sections=target.find(".dropdown-item.section-item"),DROPDOWN_MENU.closeBtn=target.find("button.close"),DROPDOWN_MENU.backBtn=target.find("button.back"),DROPDOWN_MENU.submitBtn=target.find("button.submit-btn"),DROPDOWN_MENU.topArea=target.find(".drodpdown-menu-top"),DROPDOWN_MENU.width=DROPDOWN_MENU.targetDropdown.outerWidth(),DROPDOWN_MENU.strWidth=1,function(target){target.courses.on("click",(function(){$(this).hasClass("active")||(target.courses.removeClass("active"),$(this).addClass("active"),target.submitBtn.show()),target.submitBtn.parent().show()})),target.closeBtn.on("click",(function(e){target.sections.removeClass("active"),DROPDOWN_MENU.targetDropdown.trigger("click")})),target.submitBtn.on("click",(function(){let button=$(this).parent().parent().parent().find(".copy-sequence-btn"),seqid=$(button).data("seqid"),courseid=$(".dropdown-item.course-item.active").data("id");Ajax.call([{methodname:"community_oer_copy_sequence_to_course",args:{seqid:seqid,courseid:courseid},done:function(response){DROPDOWN_MENU.targetDropdown.dropdown("hide"),$(button).removeClass("btn-primary"),$(button).addClass("btn--white"),$(button).find("span").text("הועתק לסביבה"),Str.get_strings([{key:"sequencecopy",component:"community_oer"},{key:"successcopybody",component:"community_oer"},{key:"approve",component:"community_oer"}]).done((function(strings){ModalFactory.create({type:ModalFactory.types.CANCEL,title:strings[0],body:strings[1]}).done((function(modal){modal.setButtonText("cancel",strings[2]),modal.show()}))}))},fail:Notification.exception}])}))}(DROPDOWN_MENU),courses=DROPDOWN_MENU.courses,DROPDOWN_MENU.strWidth=1,courses.each((function(){var width=$(this).find("span").outerWidth();width>DROPDOWN_MENU.strWidth&&(DROPDOWN_MENU.strWidth=width+30)})),DROPDOWN_MENU.strWidth>DROPDOWN_MENU.width?DROPDOWN_MENU.targetDropdown.find(".copy-sequence-dropdown-inner").css("width",+DROPDOWN_MENU.strWidth+"px"):DROPDOWN_MENU.targetDropdown.find(".copy-sequence-dropdown-inner").css("width",+DROPDOWN_MENU.width+"px")})).fail((function(ex){console.log("ERROR")}))}(JSON.parse(response),target)},fail:Notification.exception}])}($(this).parent().parent())})),$(".dropdown.copy-sequence-dropdown-wrapper").on("hide.bs.dropdown",(function(){DROPDOWN_MENU={};$(this).parent().find(".copy-sequence-dropdown").html("")})),$(".dropdown.copy-sequence-dropdown-wrapper .dropdown-menu").on("click",(function(e){e.stopPropagation()}))},checkPosition:function(el){0==$(el).next().length?$(el).closest(".nav.nav-tabs").find(".nav-control.next").addClass("disabled"):0==$(el).prev().length&&$(el).closest(".nav.nav-tabs").find(".nav-control.prev").addClass("disabled"),$(el).prev().length>0&&$(el).closest(".nav.nav-tabs").find(".nav-control.prev").removeClass("disabled"),$(el).next().length>0&&$(el).closest(".nav.nav-tabs").find(".nav-control.next").removeClass("disabled")},moveRight:function(el,dir){let parent=$(el).closest(".nav.nav-tabs .nav-tabs-wrapper"),btnsLine=parent.find(".nav-tabs-inner"),parentOffsetLeft=parent.offset().left,elOffsetLeft=+$(el).offset().left,elWidth=+$(el).width()+4,parentWidth=parent.width();if("rtl"==dir&&parentOffsetLeft>elOffsetLeft){let num=parentOffsetLeft-elOffsetLeft,newOffset=+ +btnsLine.css("left").replace("px","")+num;btnsLine.css("left","".concat(newOffset)+"px"),btnsLine.css("right","unset")}else if("ltr"==dir&&parentWidth+parentOffsetLeft<elOffsetLeft+elWidth){let newOffset=+ +btnsLine.css("left").replace("px","")-(elOffsetLeft+elWidth-(parentWidth+parentOffsetLeft));btnsLine.css("left","".concat(newOffset)+"px"),btnsLine.css("right","unset")}},moveLeft:function(el,dir){let parent=$(el).closest(".nav.nav-tabs .nav-tabs-wrapper"),btnsLine=parent.find(".nav-tabs-inner"),parentOffsetLeft=parent.offset().left,elOffsetLeft=$(el).offset().left,elWidth=+$(el).width()+4,parentWidth=parent.width();if("rtl"==dir&&parentWidth+parentOffsetLeft<elOffsetLeft+elWidth){let newOffset=+btnsLine.css("left").replace("px","")-(elOffsetLeft+elWidth-(parentWidth+parentOffsetLeft));btnsLine.css("left","".concat(newOffset)+"px")}else if("ltr"==dir&&parentOffsetLeft>elOffsetLeft){let newOffset=+ +btnsLine.css("left").replace("px","")+(parentOffsetLeft-elOffsetLeft);btnsLine.css("left","".concat(newOffset)+"px")}},setActiveActivity:function(el){$("html").attr("dir");$(el).siblings(".nav-link").not($(el)).removeClass("active"),this.checkPosition($(el))},changeActivity:function(el){let direction=$(el).data("direction");const dir=$("html").attr("dir");let currentItem=$(el).closest(".nav.nav-tabs").find(".nav-tabs-inner .nav-link.active"),prevItem=currentItem.prev(),nextItem=currentItem.next();"next"==direction&&nextItem.length>0?(nextItem.siblings(".nav-link").removeClass("active"),nextItem.tab("show"),this.checkPosition(nextItem),this.moveRight(nextItem,dir)):"prev"==direction&&prevItem.length>0&&(prevItem.siblings(".nav-link").removeClass("active"),prevItem.tab("show"),this.checkPosition(prevItem),this.moveLeft(prevItem,dir))},singlePage:function(cmid){Ajax.call([{methodname:"community_oer_sequence_get_single_page",args:{cmid:cmid},done:function(response){let data=JSON.parse(response);Object.keys(data).length&&Templates.render("community_oer/sequence/single-cm",data).done((function(html,js){Templates.prependNodeContents("#page-content",html,js),$("#page-header div").html(""),$(".header.backto").hide(),$("#topofscroll").addClass("wider")})).fail(Notification.exception)},fail:Notification.exception}])}}}));

//# sourceMappingURL=sequence.min.js.map