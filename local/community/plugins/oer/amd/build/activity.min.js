define("community_oer/activity",["jquery","core/yui","core/str","core/modal_factory","core/modal_events","core/ajax","core/templates","core/notification"],(function($,Y,Str,ModalFactory,ModalEvents,Ajax,Templates,Notification){let SELECTORS_mainAside=".main-aside",SELECTORS_mainDashboard=".main-dashboard",SELECTORS_mainTitle=".main-title",SELECTORS_filterPills=".checked-option-pills",SELECTORS_filterButtonArea=".activity-filters",SELECTORS_totalItems=".total-activities-block",SELECTORS_blockContent=".activity-blocks-content",SELECTORS_mainTotalElementsActivity=".main-total-elements-activity",SELECTORS_mainTotalElementsQuestion=".main-total-elements-question",SELECTORS_mainTotalElementsSequence=".main-total-elements-sequence",SELECTORS_mainTotalElementsCourse=".main-total-elements-course",current_aside_activity={},prev_search_activity={},default_filters_activity={},if_iframe=!1,if_scroll_up=!1;return{init:function(callback){if_iframe=$("#main-page-iframe").val(),Ajax.call([{methodname:"community_oer_get_activity_instance",args:{},done:function(response){callback(response)},fail:Notification.exception}])},mergeInstanceWithPreset:function(instance_data,preset_data,callback){callback(instance_data)},renderInstance:function(instance_data,current_aside,prev_search,preset_data,callback){let self=this;default_filters_activity=instance_data.default_filters,current_aside_activity=current_aside,prev_search_activity=prev_search,this.mergeInstanceWithPreset(instance_data,preset_data,(function(data){Templates.render("community_oer/activity/aside",data).done((function(html,js){current_aside_activity.render_aside&&Templates.replaceNodeContents(SELECTORS_mainAside,html,js),Templates.render("community_oer/activity/dashboard",data).done((function(html,js){Templates.replaceNodeContents(SELECTORS_mainDashboard,html,js),prev_search_activity.length>0?$.each(prev_search_activity,(function(index,value){let param=value='"'+value+'"';self.createPillSearch(param,value,(function(){self.defaultRenderBlocks(),callback()}))})):(self.defaultRenderBlocks(),callback())})).fail(Notification.exception)})).fail(Notification.exception)}))},defaultRenderBlocks:function(){let self=this,filters=$("*").filter((function(){return"activity"===$(this).data("plugin")&&"filters"===$(this).data("area")}));$.each(default_filters_activity,(function(key,value){$(filters).each((function(){if($(this).data("action")===value.filter&&$(this).data("value")===value.value){$(this).data("selected","1"),$(this).prop("checked",!0);let text=$(this).parent().find("label").html().trim();self.createPill($(this).attr("id"),text)}}))}));let elements=$("*").filter((function(){return"activity"===$(this).data("plugin")&&"sidemenu"===$(this).data("area")}));$(elements).each((function(){$(this).data("action")===current_aside_activity.type&&$(this).data("value")===current_aside_activity.value&&$(this).click()}))},actionOnClick:function(object){let data=$(object).data(),self=this;if("sidemenu"===data.area){let elements=$("*").filter((function(){return"activity"===$(this).data("plugin")&&"sidemenu"===$(this).data("area")}));$(elements).each((function(){$(this).removeData("selected")})),$(object).data("selected","1")}if("filters"===data.area)if(void 0!==$(object).data("selected"))$(object).removeData("selected"),this.removePill($(object).attr("id"));else{$(object).data("selected","1");let text=$(object).parent().find("label").html().trim();this.createPill($(object).attr("id"),text)}if("paging"===data.area){let elements=$("*").filter((function(){return"activity"===$(this).data("plugin")&&"paging"===$(this).data("area")}));$(elements).each((function(){$(this).data("selected",0)})),$(object).data("selected","1"),if_scroll_up=!0}if("paging"!==data.area){let elements=$("*").filter((function(){return"activity"===$(this).data("plugin")&&"paging"===$(this).data("area")}));$(elements).each((function(){$(this).data("selected",0)}))}if("pill"===data.area){let id=data.value;$(SELECTORS_filterButtonArea).find("#"+id).trigger("click");let buttons=$(SELECTORS_filterPills).find("button");1===buttons.length&&buttons.remove()}if("pillsearch"===data.area&&self.removePillSearch(object),"removeallpills"===data.area){let elements=$("*").filter((function(){return"filters"===$(this).data("area")}));$(elements).each((function(){$(this).removeData("selected"),$(this).prop("checked",!1),self.removePill($(this).attr("id"))}));let elementssearch=$("*").filter((function(){return"pillsearch"===$(this).data("area")}));$(elementssearch).each((function(){self.removePillSearch(this)}))}if("sorting"===data.area){let flag=!0;1===parseInt($(object).data("selected"))&&(flag=!1);let elements=$("*").filter((function(){return"activity"===$(this).data("plugin")&&"sorting"===$(this).data("area")}));$(elements).each((function(){$(this).data("selected","0")})),flag&&$(object).data("selected","1")}if("mainsearch"===data.area){let param=data.value;this.createPillSearch(param,data.value,(function(){self.renderBlocks()}))}else this.renderBlocks();this.changeTitleBreadcrumbs(object)},returnPreset:function(){let selected=$("*").filter((function(){return"activity"===$(this).data("plugin")&&("1"===$(this).data("selected")||1===$(this).data("selected"))})),dataselected={};return $(selected).each((function(index){dataselected[index]=$(this).data()})),dataselected},renderBlocks:function(){let returnpreset=this.returnPreset();$(SELECTORS_blockContent).find(".activity-item").remove(),$(SELECTORS_blockContent).find(".pagination").remove(),Templates.render("community_oer/loading",{}).done((function(html,js){Templates.replaceNodeContents(SELECTORS_blockContent,html,js)})).fail(Notification.exception),Ajax.call([{methodname:"community_oer_get_activity_blocks",args:{presets:JSON.stringify(returnpreset)},done:function(response){let result=JSON.parse(response);if(result.iframe=1===parseInt(if_iframe),result.iframe){let selected=$("#oer_activity_items_selected").val(),data=[];0!==selected.length&&(data=JSON.parse(selected)),$.each(result.blocks,(function(index,value){result.blocks[index].checkbox_selected=!1,$.each(data,(function(index2,value2){value2===value.cmid&&(result.blocks[index].checkbox_selected=!0)}))}))}Str.get_strings([{key:"resultsearch",component:"community_oer"},{key:"items",component:"community_oer"}]).done((function(strings){let str=strings[0]+": "+result.total_blocks+" "+strings[1];$(SELECTORS_totalItems).html(str),$(SELECTORS_mainTotalElementsActivity).html("("+result.activity_total_all_blocks+")"),$(SELECTORS_mainTotalElementsQuestion).html("("+result.question_total_all_blocks+")"),$(SELECTORS_mainTotalElementsSequence).html("("+result.sequence_total_all_blocks+")"),$(SELECTORS_mainTotalElementsCourse).html("("+result.course_total_all_blocks+")"),Templates.render("community_oer/activity/block",result).done((function(html,js){if(Templates.replaceNodeContents(SELECTORS_blockContent,html,js),if_scroll_up){document.querySelector(".activity-block-header").scrollIntoView({behavior:"smooth",block:"end",inline:"nearest"}),if_scroll_up=!1}callback()})).fail(Notification.exception)}))},fail:Notification.exception}])},changeTitleBreadcrumbs:function(object){let title=$(object).data("breadcrumbs");$(SELECTORS_mainTitle).html(title)},createPill:function(id,text){Str.get_strings([{key:"removeallpills",component:"community_oer"}]).done((function(strings){let pillTarget=$(SELECTORS_filterPills);if(!pillTarget.find("button").length){let pillremoveall=$('\n                    <button type="button" data-plugin="activity" data-area="removeallpills" class="removeallpills btn btn-secondary mr-3 py-1 px-3 mb-2">\n                        '.concat(strings[0],"                       \n                    </button>"));pillTarget.append(pillremoveall)}let pill=$('\n                <div class="checked-option-pill rounded-pill bg-light text-primary border border-primary mr-3 py-1 px-3 mb-2" data-id="'.concat(id,'">\n                    <span class="checked-option-pill-name">').concat(text,'</span>\n                    <button type="button" class="close ml-3" aria-label="Close">\n                        <span aria-hidden="true" data-plugin="activity" data-area="pill" data-value="').concat(id,'">&times;</span>\n                    </button>\n                </div>'));pillTarget.append(pill)}))},removePill:function(id){$(SELECTORS_filterPills).find('[data-id="'.concat(id,'"]')).remove();let buttons=$(SELECTORS_filterPills).find("button");1===buttons.length&&buttons.remove()},createPillSearch:function(query,text,callback){Str.get_strings([{key:"removeallpills",component:"community_oer"}]).done((function(strings){let pillTarget=$(SELECTORS_filterPills);if(!pillTarget.find("button").length){let pillremoveall=$('\n                    <button type="button" data-plugin="activity" data-area="removeallpills" class="removeallpills btn btn-secondary mr-3 py-1 px-3 mb-2">\n                        '.concat(strings[0],"                       \n                    </button>"));pillTarget.append(pillremoveall)}let simpleword=!1;if(query.length>0&&'"'===query[0]&&'"'===query[query.length-1]&&(simpleword=!0,query=query.substring(1,query.length-1)),simpleword){let pill=$('\n                        <div class="checked-option-pill search-pill rounded-pill bg-light text-primary border border-primary mr-3 py-1 px-3 mb-2" data-id="'.concat(query,'">\n                            <span class="checked-option-pill-name">').concat(query,'</span>\n                            <button type="button" class="close ml-3" aria-label="Close">\n                                <span aria-hidden="true" data-plugin="activity" data-area="pillsearch" data-value="').concat(query,'" data-selected="1">&times;</span>\n                            </button>\n                        </div>'));pillTarget.append(pill)}else query.split(" ").forEach((function(value){if(value.length>0){let pill=$('\n                                <div class="checked-option-pill search-pill rounded-pill bg-light text-primary border border-primary mr-3 py-1 px-3 mb-2" data-id="'.concat(value,'">\n                                    <span class="checked-option-pill-name">').concat(value,'</span>\n                                    <button type="button" class="close ml-3" aria-label="Close">\n                                        <span aria-hidden="true" data-plugin="activity" data-area="pillsearch" data-value="').concat(value,'" data-selected="1">&times;</span>\n                                    </button>\n                                </div>'));pillTarget.append(pill)}}));callback()}))},removePillSearch:function(object){$(object).parent().parent().remove();let buttons=$(SELECTORS_filterPills).find("button");1===buttons.length&&buttons.remove()},openDropdownMenuForBlock:function(){let DROPDOWN_MENU={};function checkCourseWidth(courses){DROPDOWN_MENU.strWidth=1,courses.each((function(){var width=$(this).find("span").outerWidth();width>DROPDOWN_MENU.strWidth&&(DROPDOWN_MENU.strWidth=width)})),DROPDOWN_MENU.strWidth>DROPDOWN_MENU.width?DROPDOWN_MENU.targetDropdown.find(".copy-activity-dropdown-inner").css("width",+DROPDOWN_MENU.strWidth+"px"):DROPDOWN_MENU.targetDropdown.find(".copy-activity-dropdown-inner").css("width",+DROPDOWN_MENU.width+"px")}$(".dropdown.copy-activity-dropdown-wrapper").on("show.bs.dropdown",(function(){!function(target){Ajax.call([{methodname:"community_oer_get_my_courses_and_sections",args:{},done:function(response){!function(resp,target){Templates.render("community_oer/activity/copy-activity-dropdown",resp).then((function(html,js){Templates.replaceNodeContents(target.find(".copy-activity-dropdown"),html,js),target.find(".preloading-wrapper").hide(),target.find(".dropdown-courses").show(),DROPDOWN_MENU.targetDropdown=target.find(".dropdown"),DROPDOWN_MENU.courses=target.find(".dropdown-item.course-item"),DROPDOWN_MENU.sections=target.find(".dropdown-item.section-item"),DROPDOWN_MENU.closeBtn=target.find("button.close"),DROPDOWN_MENU.backBtn=target.find("button.back"),DROPDOWN_MENU.submitBtn=target.find("button.submit-btn"),DROPDOWN_MENU.topArea=target.find(".drodpdown-menu-top"),DROPDOWN_MENU.width=DROPDOWN_MENU.targetDropdown.outerWidth(),DROPDOWN_MENU.strWidth=1,function(target){target.courses.on("click",(function(){const courseid=$(this).data("id"),course_name=$(this).text();DROPDOWN_MENU.topArea.find(".drodpdown-menu-top-text").text(course_name),courseid&&(target.courses.hide(),target.sections.each((function(){+$(this).data("courseid")==+courseid&&$(this).show()}))),target.backBtn.show(),function(sections){DROPDOWN_MENU.strWidth=1;var topAreaBtns=DROPDOWN_MENU.topArea.find("button"),btnsWidth=0;topAreaBtns.each((function(){btnsWidth+=Math.floor($(this).outerWidth())}));var topAreaWidth=Math.floor(DROPDOWN_MENU.topArea.find("span").outerWidth())+btnsWidth;sections.each((function(){if("display: none;"!=$(this).attr("style")){var width=$(this).find(".section-item-name").outerWidth();width>DROPDOWN_MENU.strWidth&&(DROPDOWN_MENU.strWidth=width+60)}})),+DROPDOWN_MENU.strWidth<=topAreaWidth?DROPDOWN_MENU.targetDropdown.find(".copy-activity-dropdown-inner").css("width","100%"):+DROPDOWN_MENU.strWidth>+DROPDOWN_MENU.width?DROPDOWN_MENU.targetDropdown.find(".copy-activity-dropdown-inner").css("width",+DROPDOWN_MENU.strWidth+"px"):DROPDOWN_MENU.targetDropdown.find(".copy-activity-dropdown-inner").css("width",+DROPDOWN_MENU.width+"px")}(DROPDOWN_MENU.sections)})),target.sections.on("click",(function(){$(this).hasClass("active")||(target.sections.removeClass("active"),$(this).addClass("active"),target.submitBtn.show()),target.submitBtn.parent().show()})),target.backBtn.on("click",(function(e){var back=$(e.target);target.sections.removeClass("active"),DROPDOWN_MENU.submitBtn.hide(),DROPDOWN_MENU.topArea.find(".drodpdown-menu-top-text").text(DROPDOWN_MENU.topArea.data("text")),target.sections.hide(),target.courses.show(),back.hide(),checkCourseWidth(DROPDOWN_MENU.courses)})),target.closeBtn.on("click",(function(e){target.sections.removeClass("active"),DROPDOWN_MENU.targetDropdown.trigger("click")})),target.submitBtn.on("click",(function(){let button=$(this).parent().parent().parent().find(".copy-activity-btn"),cmid=$(button).data("cmid"),referer=$(button).data("referer"),sectionid=$(".dropdown-item.section-item.active").data("sectionid");Ajax.call([{methodname:"community_oer_copy_activity_to_section",args:{sectionid:sectionid,cmid:cmid,referer:referer},done:function(response){DROPDOWN_MENU.targetDropdown.dropdown("hide"),$(button).removeClass("btn-primary"),$(button).addClass("btn--white"),$(button).find("span").text("הועתק לסביבה"),Str.get_strings([{key:"activitycopy",component:"community_oer"},{key:"successcopybody",component:"community_oer"},{key:"approve",component:"community_oer"}]).done((function(strings){ModalFactory.create({type:ModalFactory.types.CANCEL,title:strings[0],body:strings[1]}).done((function(modal){modal.setButtonText("cancel",strings[2]),modal.show()}))}))},fail:Notification.exception}])}))}(DROPDOWN_MENU),checkCourseWidth(DROPDOWN_MENU.courses)})).fail((function(ex){console.log("ERROR")}))}(JSON.parse(response),target)},fail:Notification.exception}])}($(this).parent().parent())})),$(".dropdown.copy-activity-dropdown-wrapper").on("hide.bs.dropdown",(function(){DROPDOWN_MENU={};$(this).parent().find(".copy-activity-dropdown").html("")})),$(".dropdown.copy-activity-dropdown-wrapper .dropdown-menu").on("click",(function(e){e.stopPropagation()}))},singlePage:function(cmid){Ajax.call([{methodname:"community_oer_activity_get_single_page",args:{cmid:cmid},done:function(response){let data=JSON.parse(response);Object.keys(data).length&&Templates.render("community_oer/activity/block",data).done((function(html,js){Templates.prependNodeContents("#page-content",html,js),$("#page-header div").html(""),$(".header.backto").hide(),$("#topofscroll").addClass("wider")})).fail(Notification.exception)},fail:Notification.exception}])}}}));

//# sourceMappingURL=activity.min.js.map