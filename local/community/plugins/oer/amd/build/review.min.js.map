{"version":3,"file":"review.min.js","sources":["../src/review.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * Javascript main event handler.\r\n *\r\n * @module     community_oer/init\r\n * @package    community_oer\r\n * @copyright  2019 Devlionco <info@devlion.co>\r\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n * @since      3.6\r\n */\r\n\r\ndefine([\r\n  'jquery',\r\n  'community_oer/review-events',\r\n  'community_oer/review-modal',\r\n], function($, events, modal) {\r\n\r\n    var root = document.querySelector('body');\r\n\r\n    return {\r\n        init: function(popupdata) {\r\n\r\n            modal.insertWrapper().done(function() {\r\n\r\n                // Old version.\r\n                if (popupdata.showrequest) {\r\n                    events.askForReview(popupdata);\r\n                }\r\n\r\n                // New version v2.\r\n                if (popupdata.showrequestv2) {\r\n                    events.askForReviewV2(popupdata);\r\n                }\r\n\r\n                $(document).on('click', '[data-dismiss=\"modal\"]', function(){\r\n                     $('#modalReview').modal('hide');\r\n                });\r\n\r\n                $(document).on('click', '#activityremindtext a', function(){\r\n                    window.location.href = $(this).attr('href');\r\n                });\r\n\r\n                root.addEventListener('click', function(e) {\r\n                    var target = e.target;\r\n\r\n                    // Activity remind event for activity menu.\r\n                    if (target.role === 'menuitem') {\r\n                        let key = $(target).parent().data('key');\r\n\r\n                        if (key !== undefined && key.includes('activityRemind_')) {\r\n                            target.dataset.cmid = key.replace('activityRemind_', \"\");\r\n                            events.activityRemind(target);\r\n                        }\r\n                    }\r\n\r\n                    while (root.contains(target)) {\r\n\r\n                        switch(target.dataset.handler) {\r\n\r\n                            // New version of review.\r\n                            case 'sendShortReview':\r\n                                events.sendReview(target);\r\n                                break;\r\n                            case 'confirmRejectReview':\r\n                                events.confirmRejectReview(target);\r\n                                break;\r\n                            case 'reportBug':\r\n                                events.reportBug(target);\r\n                                break;\r\n\r\n                            // Old version of review.\r\n                            case 'sendReviewLater':\r\n                                events.sendReviewLater(target);\r\n                                break;\r\n                            case 'openSendReview':\r\n                                events.openSendReview(target);\r\n                                break;\r\n                            case 'sendReview':\r\n                                events.sendReview(target);\r\n                                break;\r\n\r\n\r\n                            // Course view\r\n                            case 'activityRemind':\r\n                                events.activityRemind(target);\r\n                                break;\r\n                            case 'sendRemind':\r\n                                events.sendRemind(target);\r\n                                break;\r\n                            case 'saveRemind':\r\n                                events.saveRemind(target);\r\n                                break;\r\n\r\n                            case 'deleteReview':\r\n                                events.deleteReview(target);\r\n                                break;\r\n                            case 'rejectReview':\r\n                                events.rejectReview(target);\r\n                                break;\r\n                            case 'showReview':\r\n                                events.showReview(target);\r\n                                break;\r\n                            case 'sendComment':\r\n                                events.sendComment(target);\r\n                                break;\r\n                            case 'updateComment':\r\n                                events.updateComment(target);\r\n                                break;\r\n                            case 'editComment':\r\n                                events.editComment(target);\r\n                                break;\r\n                            case 'deleteComment':\r\n                                events.deleteComment(target);\r\n                                break;\r\n                            case 'cancelComment':\r\n                                events.cancelComment(target);\r\n                                break;\r\n                            case 'askForReviewOnCourse':\r\n                                events.askForReviewOnCourse(target);\r\n                                break;\r\n                        }\r\n                        target = target.parentNode;\r\n                    }\r\n                });\r\n            });\r\n        },\r\n\r\n        add_icon: function(icon, callback) {\r\n            $('.page-header-headings').find('h1').append(' '+ icon).ready(function () {\r\n                callback()\r\n            });\r\n        },\r\n\r\n        add_icon_to_page: function(icon) {\r\n            this.add_icon(icon, function(){\r\n            })\r\n        },\r\n\r\n        add_and_open_icon_on_page: function(icon) {\r\n            this.add_icon(icon, function(){\r\n                setTimeout(function(){\r\n                    $('.page-header-headings').parent().find('.comment-icon')[0].click();\r\n                }, 1000);\r\n            })\r\n        },\r\n    };\r\n});\r\n"],"names":["define","$","events","modal","root","document","querySelector","init","popupdata","insertWrapper","done","showrequest","askForReview","showrequestv2","askForReviewV2","on","window","location","href","this","attr","addEventListener","e","target","role","key","parent","data","undefined","includes","dataset","cmid","replace","activityRemind","contains","handler","sendReview","confirmRejectReview","reportBug","sendReviewLater","openSendReview","sendRemind","saveRemind","deleteReview","rejectReview","showReview","sendComment","updateComment","editComment","deleteComment","cancelComment","askForReviewOnCourse","parentNode","add_icon","icon","callback","find","append","ready","add_icon_to_page","add_and_open_icon_on_page","setTimeout","click"],"mappings":";;;;;;;;;AAyBAA,8BAAO,CACL,SACA,8BACA,+BACC,SAASC,EAAGC,OAAQC,WAEfC,KAAOC,SAASC,cAAc,cAE3B,CACHC,KAAM,SAASC,WAEXL,MAAMM,gBAAgBC,MAAK,WAGnBF,UAAUG,aACVT,OAAOU,aAAaJ,WAIpBA,UAAUK,eACVX,OAAOY,eAAeN,WAG1BP,EAAEI,UAAUU,GAAG,QAAS,0BAA0B,WAC7Cd,EAAE,gBAAgBE,MAAM,WAG7BF,EAAEI,UAAUU,GAAG,QAAS,yBAAyB,WAC7CC,OAAOC,SAASC,KAAOjB,EAAEkB,MAAMC,KAAK,WAGxChB,KAAKiB,iBAAiB,SAAS,SAASC,OAChCC,OAASD,EAAEC,UAGK,aAAhBA,OAAOC,KAAqB,KACxBC,IAAMxB,EAAEsB,QAAQG,SAASC,KAAK,YAEtBC,IAARH,KAAqBA,IAAII,SAAS,qBAClCN,OAAOO,QAAQC,KAAON,IAAIO,QAAQ,kBAAmB,IACrD9B,OAAO+B,eAAeV,cAIvBnB,KAAK8B,SAASX,SAAS,QAEnBA,OAAOO,QAAQK,aAGb,sBAiBA,aACDjC,OAAOkC,WAAWb,kBAfjB,sBACDrB,OAAOmC,oBAAoBd,kBAE1B,YACDrB,OAAOoC,UAAUf,kBAIhB,kBACDrB,OAAOqC,gBAAgBhB,kBAEtB,iBACDrB,OAAOsC,eAAejB,kBAQrB,iBACDrB,OAAO+B,eAAeV,kBAErB,aACDrB,OAAOuC,WAAWlB,kBAEjB,aACDrB,OAAOwC,WAAWnB,kBAGjB,eACDrB,OAAOyC,aAAapB,kBAEnB,eACDrB,OAAO0C,aAAarB,kBAEnB,aACDrB,OAAO2C,WAAWtB,kBAEjB,cACDrB,OAAO4C,YAAYvB,kBAElB,gBACDrB,OAAO6C,cAAcxB,kBAEpB,cACDrB,OAAO8C,YAAYzB,kBAElB,gBACDrB,OAAO+C,cAAc1B,kBAEpB,gBACDrB,OAAOgD,cAAc3B,kBAEpB,uBACDrB,OAAOiD,qBAAqB5B,QAGpCA,OAASA,OAAO6B,mBAMhCC,SAAU,SAASC,KAAMC,UACrBtD,EAAE,yBAAyBuD,KAAK,MAAMC,OAAO,IAAKH,MAAMI,OAAM,WAC1DH,eAIRI,iBAAkB,SAASL,WAClBD,SAASC,MAAM,gBAIxBM,0BAA2B,SAASN,WAC3BD,SAASC,MAAM,WAChBO,YAAW,WACP5D,EAAE,yBAAyByB,SAAS8B,KAAK,iBAAiB,GAAGM,UAC9D"}