{"version":3,"file":"main.min.js","sources":["../src/main.js"],"sourcesContent":["define([\r\n    'jquery',\r\n    'core/str',\r\n    'core/notification',\r\n    'community_oer/activity',\r\n    'community_oer/question',\r\n    'community_oer/sequence',\r\n    'community_oer/course'\r\n\r\n], function ($, Str, Notification, Activity, Question, Sequence, Course) {\r\n    `use strict`;\r\n\r\n    let instance_data = {};\r\n    let defaultfilters = {};\r\n    let preset_data = {};\r\n    let current_dashboard = null;\r\n    let current_aside = {};\r\n    let prev_search = [];\r\n    let url_params = {};\r\n\r\n    return {\r\n        init: function (dashboard, type, value, default_filters) {\r\n            let self = this;\r\n\r\n            // Get url params.\r\n            let res = window.location.href.split(\"?\");\r\n            if(res[1] !== undefined){\r\n                let str = '&' + res[1];\r\n                str.replace(/[?&]+([^=&]+)=([^&]*)/gi,\r\n                    function(m,key,value) {\r\n                        url_params[key] = value;\r\n                    });\r\n            }\r\n\r\n            // Set dashboard from url.\r\n            // if(url_params.plugin !== undefined){\r\n            //     dashboard = url_params.plugin;\r\n            //\r\n            //     $('.main-filter-nav').find('a').removeClass('active');\r\n            //\r\n            //     let menu = $(\"*\").filter(function () {\r\n            //         return (($(this).data(\"plugin\") === 'main' && $(this).data(\"area\") === 'menu' && $(this).data(\"value\") === dashboard));\r\n            //     });\r\n            //\r\n            //     $(menu).each(function (index) {\r\n            //         $(this).addClass('active');\r\n            //     });\r\n            // }\r\n\r\n            defaultfilters = default_filters;\r\n\r\n            current_aside.render_aside = true;\r\n            current_aside.type = type;\r\n            current_aside.value = value;\r\n            current_aside.parentcourse = null;\r\n            current_aside.url_params = url_params;\r\n\r\n            // Hide header block.\r\n            $('#page-header').addClass('d-none');\r\n\r\n            // Default dashboard start.\r\n            this.buildDasboard(dashboard);\r\n\r\n            // Enter on search input.\r\n            $('#search_form').find('input').val('');\r\n\r\n            $('#search_form').find('.petel-search-icon').on( \"click\", function() {\r\n                $('#search_form').submit();\r\n            });\r\n\r\n            $('#search_form').submit(function(e){\r\n                e.preventDefault();\r\n\r\n                let target = $('#search_form').find('input');\r\n\r\n                if(target.val().trim().length > 0){\r\n\r\n                    $(target).data(\"value\", target.val().trim());\r\n                    $('#search_form').find('input').val('');\r\n\r\n                    switch (current_dashboard) {\r\n                        case 'activity':\r\n                            Activity.actionOnClick(target);\r\n                            preset_data.activity = Activity.returnPreset();\r\n                            break;\r\n\r\n                        case 'question':\r\n                            Question.actionOnClick(target);\r\n                            preset_data.question = Question.returnPreset();\r\n                            break;\r\n\r\n                        case 'sequence':\r\n                            Sequence.actionOnClick(target);\r\n                            preset_data.sequence = Sequence.returnPreset();\r\n                            break;\r\n\r\n                        case 'course':\r\n                            Course.actionOnClick(target);\r\n                            preset_data.course = Course.returnPreset();\r\n                            break;\r\n                    }\r\n                }\r\n            });\r\n\r\n            // Click on main-area.\r\n            $( \".main-area\" ).on( \"click\", function(e) {\r\n                let target = $(e.target).data();\r\n\r\n                // Side menu.\r\n                switch (target.area) {\r\n                    case 'sidemenu':\r\n                        current_aside.render_aside = true;\r\n                        current_aside.type = target.action;\r\n                        current_aside.value = target.value;\r\n                        current_aside.parentcourse = target.parentcourse;\r\n                        current_aside.url_params = url_params;\r\n\r\n                        // Build Url.\r\n                        self.buildHistoryUrl();\r\n                        break;\r\n                }\r\n\r\n                switch (target.plugin) {\r\n                    case 'main':\r\n                        self.actionOnClick(e.target);\r\n                        preset_data.main = self.returnPreset();\r\n\r\n                        // Build Url.\r\n                        self.buildHistoryUrl();\r\n                        break;\r\n\r\n                    case 'activity':\r\n                        Activity.actionOnClick(e.target);\r\n                        preset_data.activity = Activity.returnPreset();\r\n\r\n                        // Build Url.\r\n                        self.buildHistoryUrl();\r\n                        break;\r\n\r\n                    case 'question':\r\n                        Question.actionOnClick(e.target);\r\n                        preset_data.question = Question.returnPreset();\r\n\r\n                        // Build Url.\r\n                        self.buildHistoryUrl();\r\n                        break;\r\n\r\n                    case 'sequence':\r\n                        Sequence.actionOnClick(e.target);\r\n                        preset_data.sequence = Sequence.returnPreset();\r\n\r\n                        // Build Url.\r\n                        self.buildHistoryUrl();\r\n                        break;\r\n\r\n                    case 'course':\r\n                        Course.actionOnClick(e.target);\r\n                        preset_data.course = Course.returnPreset();\r\n\r\n                        // Build Url.\r\n                        self.buildHistoryUrl();\r\n                        break;\r\n                }\r\n            });\r\n\r\n        },\r\n\r\n        buildDasboard: function (dashboard) {\r\n            let self = this;\r\n\r\n            // Dashboard start.\r\n            switch (dashboard) {\r\n                case 'activity':\r\n                    current_dashboard = 'activity';\r\n                    Activity.init(function(res){\r\n                        instance_data.activity = JSON.parse(res);\r\n                        instance_data.activity.default_filters = defaultfilters.activity;\r\n\r\n                        // Render instance.\r\n                        Activity.renderInstance(instance_data.activity, current_aside, prev_search, preset_data.activity, function (){\r\n                            preset_data.activity = Activity.returnPreset();\r\n                        });\r\n                    });\r\n                    break;\r\n\r\n                case 'question':\r\n                    current_dashboard = 'question';\r\n                    Question.init(function(res){\r\n                        instance_data.question = JSON.parse(res);\r\n                        instance_data.question.default_filters = defaultfilters.question;\r\n\r\n                        // Render instance.\r\n                        Question.renderInstance(instance_data.question, current_aside, prev_search, preset_data.question, function (){\r\n                            preset_data.question = Question.returnPreset();\r\n                        });\r\n                    });\r\n                    break;\r\n\r\n                case 'sequence':\r\n                    current_dashboard = 'sequence';\r\n                    Sequence.init(function(res){\r\n                        instance_data.sequence = JSON.parse(res);\r\n                        instance_data.sequence.default_filters = defaultfilters.sequence;\r\n\r\n                        // Render instance.\r\n                        Sequence.renderInstance(instance_data.sequence, current_aside, prev_search, preset_data.sequence, function (){\r\n                            preset_data.sequence = Sequence.returnPreset();\r\n                        });\r\n                    });\r\n                    break;\r\n\r\n                case 'course':\r\n                    current_dashboard = 'course';\r\n                    Course.init(function(res){\r\n                        instance_data.course = JSON.parse(res);\r\n                        instance_data.course.default_filters = defaultfilters.course;\r\n\r\n                        // Render instance.\r\n                        Course.renderInstance(instance_data.course, current_aside, prev_search, preset_data.course, function (){\r\n                            preset_data.course = Course.returnPreset();\r\n                        });\r\n                    });\r\n                    break;\r\n            }\r\n        },\r\n\r\n        actionOnClick: function (object) {\r\n            let data = $(object).data();\r\n\r\n            if(current_dashboard !== data.value) {\r\n\r\n                if (data.area !== 'mainsearch') {\r\n                    $('.main-filter-nav').find('a').removeClass('active');\r\n\r\n                    if($(object).hasClass('main-total-elements-question') || $(object).hasClass('main-total-elements-activity') || $(object).hasClass('main-total-elements-sequence') || $(object).hasClass('main-total-elements-course')){\r\n                        $(object).parent().addClass('active');\r\n                    }else{\r\n                        $(object).addClass('active');\r\n                    }\r\n                }\r\n\r\n                // Get current search data.\r\n                prev_search = [];\r\n                let elementssearch = $(\"*\").filter(function () {\r\n                    return ($(this).data(\"area\") === 'pillsearch');\r\n                });\r\n\r\n                $(elementssearch).each(function () {\r\n                    prev_search.push($(this).data(\"value\"));\r\n                });\r\n\r\n                this.buildDasboard(data.value);\r\n            }\r\n        },\r\n\r\n        returnPreset: function () {\r\n            return {};\r\n        },\r\n\r\n        changeTitleBreadcrumbs: function (title) {\r\n            $('.main-title').html(title);\r\n        },\r\n\r\n        buildHistoryUrl: function () {\r\n\r\n            // Get selected.\r\n            let selected = $(\"*\").filter(function () {\r\n                return (($(this).data(\"selected\") === '1' || $(this).data(\"selected\") === 1));\r\n            });\r\n\r\n            let dataselected = {};\r\n            $(selected).each(function (index) {\r\n                dataselected[index] = $(this).data();\r\n            });\r\n\r\n            let plugin = '';\r\n            let sidemenu = '';\r\n            $.each(dataselected, function (index, item) {\r\n                plugin = 'plugin=' + item.plugin;\r\n\r\n                if(item.area === 'sidemenu'){\r\n\r\n                    let action = '';\r\n                    switch (item.action) {\r\n                        case 'category':\r\n                            action = 'categoryid';\r\n                            break;\r\n\r\n                        case 'course':\r\n                            action = 'courseid';\r\n                            break;\r\n\r\n                        case 'section':\r\n                            action = 'sectionid';\r\n                            break;\r\n\r\n                    }\r\n\r\n                    sidemenu = action + '=' + item.value;\r\n\r\n                    if(item.secondaction === 'childcategory'){\r\n                        sidemenu += '&' + item.secondaction + '='+ item.childcategory;\r\n                    }\r\n                }\r\n            });\r\n\r\n            // Build url.\r\n            let url = '?' + plugin + '&' + sidemenu;\r\n            window.history.pushState(\"\", \"\", url);\r\n\r\n            return true;\r\n        },\r\n\r\n        reRerenderMain: function () {\r\n\r\n            let obj = $('.main-filter-nav').find('.active');\r\n\r\n            switch (obj.data(\"value\")) {\r\n                case 'activity':\r\n                    Activity.renderBlocks();\r\n                    break;\r\n\r\n                case 'question':\r\n                    Question.renderBlocks();\r\n                    break;\r\n\r\n                case 'sequence':\r\n                    Sequence.renderBlocks();\r\n                    break;\r\n\r\n                case 'course':\r\n                    Course.renderBlocks();\r\n                    break;\r\n            }\r\n\r\n            return true;\r\n        },\r\n\r\n    }\r\n});\r\n"],"names":["define","$","Str","Notification","Activity","Question","Sequence","Course","instance_data","defaultfilters","preset_data","current_dashboard","current_aside","prev_search","url_params","init","dashboard","type","value","default_filters","self","this","res","window","location","href","split","undefined","replace","m","key","render_aside","parentcourse","addClass","buildDasboard","find","val","on","submit","e","preventDefault","target","trim","length","data","actionOnClick","activity","returnPreset","question","sequence","course","area","action","buildHistoryUrl","plugin","main","JSON","parse","renderInstance","object","removeClass","hasClass","parent","elementssearch","filter","each","push","changeTitleBreadcrumbs","title","html","selected","dataselected","index","sidemenu","item","secondaction","childcategory","url","history","pushState","reRerenderMain","renderBlocks"],"mappings":"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"}