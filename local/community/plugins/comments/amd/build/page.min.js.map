{"version":3,"file":"page.min.js","sources":["../src/page.js"],"sourcesContent":["/* eslint-disable no-undef */\n/* eslint-disable no-implicit-globals */\n/* eslint-disable no-unused-vars */\n/* eslint-disable max-len */\n// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Javascript main event handler.\n *\n * @module     community_comments/init\n * @package    community_comments\n * @copyright  2019 Devlionco <info@devlion.co>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @since      3.6\n */\n\ndefine([\n    'jquery',\n    'core/str',\n    'core/ajax',\n    'core/notification'\n], function ($, str, Ajax, Notification) {\n\n    str.get_strings([\n        {key: 'opencomment', component: 'community_comments'},\n        {key: 'closecomment', component: 'community_comments'},\n    ]).done(function () {\n    });\n\n    return {\n        init: function (activityid) {\n\n            let pathname = window.location.pathname;\n\n            if (pathname.toLowerCase().indexOf(\"quiz/attempt.php\") == -1 &&\n                pathname.toLowerCase().indexOf(\"questionnaire/preview.php\") == -1 ){\n\n                return;\n            }\n\n            this.render(activityid, 0);\n        },\n\n        scripts: function () {\n            var self = this;\n\n            // Save comment.\n            $('.comment__send').bind('click', function () {\n                var comment = $('#community_textarea_comment').val();\n                var activityid = $('#community_activityid_comment').val();\n                var sort = $('#community_sort_comment').val();\n\n                self.save_comment(activityid, comment, function(){\n                    self.render(activityid, sort);\n                });\n            });\n\n            // Change sort.\n            $( '#community_sort_comment' ).change(function() {\n                var activityid = $('#community_activityid_comment').val();\n                var sort = $('#community_sort_comment').val();\n\n                self.render(activityid, sort);\n            });\n\n            // Open/close comment.\n            $('.comment__close').on('click', function(){\n\n                $(this).toggleClass('comment__open');\n                if($(this).hasClass('comment__open')) {\n                    $(this).parent().prev().find('.comment__short').addClass('display__none');\n                    $(this).parent().prev().find('.comment__long').removeClass('display__none');\n                    $(this).parent().prev().removeClass('comment__body--short');\n                    $(this).text(M.util.get_string('closecomment', 'community_comments'));\n                    $(this).addClass('comment__icon-open');\n                }else {\n                    $(this).parent().prev().find('.comment__short').removeClass('display__none');\n                    $(this).parent().prev().find('.comment__long').addClass('display__none');\n                    $(this).parent().prev().addClass('comment__body--short');\n                    $(this).text(M.util.get_string('opencomment', 'community_comments'));\n                    $(this).removeClass('comment__icon-open');\n                }\n\n            });\n        },\n\n        render: function (activityid, sort) {\n            var self = this;\n\n            var data = {\n                activityid: Number(activityid),\n                sort: Number(sort),\n            };\n\n            Ajax.call([{\n                methodname: 'community_comments_render_block',\n                args: data,\n                done: function (response) {\n\n                    // Remove old block.\n                    if( $('#insert_community_comments').length ){\n                        $('#insert_community_comments').remove();\n                    }\n\n                    $.when( $('.activity-navigation').first().before(response.content) ).then(function() {\n                        self.scripts();\n                    });\n\n                },\n                fail: Notification.exception\n            }]);\n        },\n\n        save_comment: function (activityid, comment, callback) {\n            var data = {\n                activityid: Number(activityid),\n                comment: comment,\n            };\n\n            Ajax.call([{\n                methodname: 'community_comments_save_comment',\n                args: data,\n                done: function () {\n                    callback();\n                },\n                fail: Notification.exception\n            }]);\n        },\n\n    };\n});"],"names":["define","$","str","Ajax","Notification","get_strings","key","component","done","init","activityid","pathname","window","location","toLowerCase","indexOf","render","scripts","self","this","bind","comment","val","sort","save_comment","change","on","toggleClass","hasClass","parent","prev","find","addClass","removeClass","text","M","util","get_string","data","Number","call","methodname","args","response","length","remove","when","first","before","content","then","fail","exception","callback"],"mappings":";;;;;;;;;AA6BAA,iCAAO,CACH,SACA,WACA,YACA,sBACD,SAAUC,EAAGC,IAAKC,KAAMC,qBAEvBF,IAAIG,YAAY,CACZ,CAACC,IAAK,cAAeC,UAAW,sBAChC,CAACD,IAAK,eAAgBC,UAAW,wBAClCC,MAAK,eAGD,CACHC,KAAM,SAAUC,gBAERC,SAAWC,OAAOC,SAASF,UAE4B,GAAvDA,SAASG,cAAcC,QAAQ,sBACiC,GAAhEJ,SAASG,cAAcC,QAAQ,mCAK9BC,OAAON,WAAY,IAG5BO,QAAS,eACDC,KAAOC,KAGXlB,EAAE,kBAAkBmB,KAAK,SAAS,eAC1BC,QAAUpB,EAAE,+BAA+BqB,MAC3CZ,WAAaT,EAAE,iCAAiCqB,MAChDC,KAAOtB,EAAE,2BAA2BqB,MAExCJ,KAAKM,aAAad,WAAYW,SAAS,WACnCH,KAAKF,OAAON,WAAYa,YAKhCtB,EAAG,2BAA4BwB,QAAO,eAC9Bf,WAAaT,EAAE,iCAAiCqB,MAChDC,KAAOtB,EAAE,2BAA2BqB,MAExCJ,KAAKF,OAAON,WAAYa,SAI5BtB,EAAE,mBAAmByB,GAAG,SAAS,WAE7BzB,EAAEkB,MAAMQ,YAAY,iBACjB1B,EAAEkB,MAAMS,SAAS,kBAChB3B,EAAEkB,MAAMU,SAASC,OAAOC,KAAK,mBAAmBC,SAAS,iBACzD/B,EAAEkB,MAAMU,SAASC,OAAOC,KAAK,kBAAkBE,YAAY,iBAC3DhC,EAAEkB,MAAMU,SAASC,OAAOG,YAAY,wBACpChC,EAAEkB,MAAMe,KAAKC,EAAEC,KAAKC,WAAW,eAAgB,uBAC/CpC,EAAEkB,MAAMa,SAAS,wBAEjB/B,EAAEkB,MAAMU,SAASC,OAAOC,KAAK,mBAAmBE,YAAY,iBAC5DhC,EAAEkB,MAAMU,SAASC,OAAOC,KAAK,kBAAkBC,SAAS,iBACxD/B,EAAEkB,MAAMU,SAASC,OAAOE,SAAS,wBACjC/B,EAAEkB,MAAMe,KAAKC,EAAEC,KAAKC,WAAW,cAAe,uBAC9CpC,EAAEkB,MAAMc,YAAY,2BAMhCjB,OAAQ,SAAUN,WAAYa,UACtBL,KAAOC,KAEPmB,KAAO,CACP5B,WAAY6B,OAAO7B,YACnBa,KAAMgB,OAAOhB,OAGjBpB,KAAKqC,KAAK,CAAC,CACPC,WAAY,kCACZC,KAAMJ,KACN9B,KAAM,SAAUmC,UAGR1C,EAAE,8BAA8B2C,QAChC3C,EAAE,8BAA8B4C,SAGpC5C,EAAE6C,KAAM7C,EAAE,wBAAwB8C,QAAQC,OAAOL,SAASM,UAAWC,MAAK,WACtEhC,KAAKD,cAIbkC,KAAM/C,aAAagD,cAI3B5B,aAAc,SAAUd,WAAYW,QAASgC,cACrCf,KAAO,CACP5B,WAAY6B,OAAO7B,YACnBW,QAASA,SAGblB,KAAKqC,KAAK,CAAC,CACPC,WAAY,kCACZC,KAAMJ,KACN9B,KAAM,WACF6C,YAEJF,KAAM/C,aAAagD,cAKlC"}