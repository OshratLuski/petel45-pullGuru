{"version":3,"file":"statusloader.min.js","sources":["../src/statusloader.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * Javascript for lazy load of statuses.\r\n *\r\n * @package\r\n * @copyright  2020 Devlion <info@devlion.co>\r\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\n\r\ndefine(\r\n    [\r\n        'jquery',\r\n        'core/ajax',\r\n        'local_petel/inview',\r\n        'core/notification'\r\n    ],\r\n    function($, Ajax, inView, Notification) {\r\n        var courseid = null;\r\n\r\n        let getStatus = function(cmids, sectionid) {\r\n            if (courseid) {\r\n                Ajax.call([{\r\n                    methodname: 'format_flexsections_get_activity_grade_status',\r\n                    args: {\r\n                        cmids: cmids,\r\n                        sectionid: sectionid,\r\n                        courseid: courseid\r\n                    },\r\n                    done: function(resp) {\r\n                        let response = JSON.parse(resp);\r\n                        response.result.forEach(function(item) {\r\n                            $('#activity-row-grade-' + item.cmid).html(item.gradestatus);\r\n                            $('#activity-oer-version-' + item.cmid).html(item.oerversion);\r\n                        });\r\n                    },\r\n                    fail: Notification.exception\r\n                }]);\r\n            }\r\n        };\r\n        let inview = function() {\r\n            let stackcmids = [];\r\n            let sectionid = 0;\r\n            inView('.inviewgrade')\r\n                .on('enter', function(e) {\r\n\r\n                    if (!$(e).hasClass('inview-done')) {\r\n                        courseid = $(e).attr(\"data-courseid\");\r\n\r\n                        // Working by sectionid.\r\n                        let area = $(e).closest('.section-area');\r\n                        sectionid = area.attr(\"data-cmlistid\");\r\n                        area.find('.inviewgrade').addClass('inview-done');\r\n\r\n                        // Working by cmid.\r\n                        // $(e).addClass('inview-done');\r\n                        // let cmid = $(e).attr(\"data-cmid\");\r\n                        // stackcmids.push(cmid);\r\n                    }\r\n                });\r\n\r\n            setInterval(function() {\r\n                if (stackcmids.length > 0 || sectionid > 0) {\r\n                    let cmids = JSON.stringify(stackcmids);\r\n                    getStatus(cmids, sectionid);\r\n                    stackcmids = [];\r\n                    sectionid = 0;\r\n                }\r\n            }, 500);\r\n\r\n        };\r\n        return {\r\n            inview: inview,\r\n        };\r\n    });\r\n"],"names":["define","$","Ajax","inView","Notification","courseid","inview","stackcmids","sectionid","on","e","hasClass","attr","area","closest","find","addClass","setInterval","length","cmids","call","methodname","args","done","resp","JSON","parse","result","forEach","item","cmid","html","gradestatus","oerversion","fail","exception","getStatus","stringify"],"mappings":";;;;;;;AAuBAA,0CACI,CACI,SACA,YACA,qBACA,sBAEJ,SAASC,EAAGC,KAAMC,OAAQC,kBAClBC,SAAW,WAqDR,CACHC,OAhCS,eACLC,WAAa,GACbC,UAAY,EAChBL,OAAO,gBACFM,GAAG,SAAS,SAASC,OAEbT,EAAES,GAAGC,SAAS,eAAgB,CAC/BN,SAAWJ,EAAES,GAAGE,KAAK,qBAGjBC,KAAOZ,EAAES,GAAGI,QAAQ,iBACxBN,UAAYK,KAAKD,KAAK,iBACtBC,KAAKE,KAAK,gBAAgBC,SAAS,mBAS/CC,aAAY,cACJV,WAAWW,OAAS,GAAKV,UAAY,EAAG,EA1CpC,SAASW,MAAOX,WACxBH,UACAH,KAAKkB,KAAK,CAAC,CACPC,WAAY,gDACZC,KAAM,CACFH,MAAOA,MACPX,UAAWA,UACXH,SAAUA,UAEdkB,KAAM,SAASC,MACIC,KAAKC,MAAMF,MACjBG,OAAOC,SAAQ,SAASC,MAC7B5B,EAAE,uBAAyB4B,KAAKC,MAAMC,KAAKF,KAAKG,aAChD/B,EAAE,yBAA2B4B,KAAKC,MAAMC,KAAKF,KAAKI,gBAG1DC,KAAM9B,aAAa+B,aA4BnBC,CADYX,KAAKY,UAAU9B,YACVC,WACjBD,WAAa,GACbC,UAAY,KAEjB"}