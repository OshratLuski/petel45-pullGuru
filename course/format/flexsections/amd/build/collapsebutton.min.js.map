{"version":3,"file":"collapsebutton.min.js","sources":["../src/collapsebutton.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * Javascript for collapse button.\r\n *\r\n * @package\r\n * @copyright  2020 Devlion <info@devlion.co>\r\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\n\r\ndefine(\r\n    [\r\n        'jquery',\r\n        'core/str'\r\n    ],\r\n    function($, Str) {\r\n\r\n        const collapseAction = (type) => {\r\n            $('.course-section').each(function() {\r\n                let number = $(this).data('number');\r\n\r\n                if (number > 0) {\r\n                    let id = '#collapssesection' + number;\r\n                    let status = $(id).attr(\"aria-expanded\");\r\n\r\n                    if ((type === 'open' && status === 'false') || (type === 'close' && status === 'true')) {\r\n                        $(id).click();\r\n                    }\r\n                }\r\n            });\r\n        };\r\n\r\n        const getHashNumber = () => {\r\n            let queryString = window.location;\r\n            let urlParams = new URLSearchParams(queryString);\r\n            let hash = urlParams.get('hash');\r\n\r\n            if (hash.length > 0) {\r\n                return hash.match(/\\d+/)[0];\r\n            } else {\r\n                return false;\r\n            }\r\n        };\r\n\r\n        const openHash = () => {\r\n            let number = getHashNumber();\r\n            if (number !== false) {\r\n                let id = '#collapssesection' + number;\r\n                let status = $(id).attr(\"aria-expanded\");\r\n\r\n                $('.course-section').each(function() {\r\n                    let number2 = $(this).data('number');\r\n\r\n                    let id2 = '#collapssesection' + number2;\r\n                    let status2 = $(id2).attr(\"aria-expanded\");\r\n\r\n                    if (id !== id2 && status2 === 'true') {\r\n                        $(id2).click();\r\n                    }\r\n\r\n                    if (id === id2 && status === 'false') {\r\n                        $(id2).click();\r\n                    }\r\n                });\r\n            }\r\n        };\r\n\r\n        return {\r\n            init: function() {\r\n\r\n                // Default state.\r\n                setTimeout(function() {\r\n                    if (getHashNumber() !== false) {\r\n                        openHash();\r\n                    } else {\r\n                        collapseAction('open');\r\n                    }\r\n                }, 700);\r\n\r\n                // Change in url string. Hash.\r\n                window.addEventListener('hashchange', function() {\r\n                    openHash();\r\n                });\r\n\r\n                Str.get_strings([\r\n                    {key: 'collapsebuttonopen', component: 'format_flexsections'},\r\n                    {key: 'collapsebuttonclose', component: 'format_flexsections'}\r\n                ]).done(function(strings) {\r\n\r\n                    $('#collapse_button').on(\"click\", function() {\r\n                        let action = $(this).data('action');\r\n\r\n                        switch (action) {\r\n                            case 'close':\r\n                                $(this).data('action', 'open').text(strings[1]);\r\n                                collapseAction('open');\r\n                                break;\r\n\r\n                            case 'open':\r\n                                $(this).data('action', 'close').text(strings[0]);\r\n                                collapseAction('close');\r\n                                break;\r\n\r\n                            default:\r\n                                $(this).data('action', 'close').text(strings[0]);\r\n                        }\r\n                    });\r\n                });\r\n            },\r\n        };\r\n    });\r\n"],"names":["define","$","Str","collapseAction","type","each","number","this","data","id","status","attr","click","getHashNumber","queryString","window","location","hash","URLSearchParams","get","length","match","openHash","id2","status2","init","setTimeout","addEventListener","get_strings","key","component","done","strings","on","text"],"mappings":";;;;;;;AAuBAA,4CACI,CACI,SACA,aAEJ,SAASC,EAAGC,WAEFC,eAAkBC,OACpBH,EAAE,mBAAmBI,MAAK,eAClBC,OAASL,EAAEM,MAAMC,KAAK,aAEtBF,OAAS,EAAG,KACRG,GAAK,oBAAsBH,OAC3BI,OAAST,EAAEQ,IAAIE,KAAK,kBAEV,SAATP,MAA8B,UAAXM,QAAiC,UAATN,MAA+B,SAAXM,SAChET,EAAEQ,IAAIG,aAMhBC,cAAgB,SACdC,YAAcC,OAAOC,SAErBC,KADY,IAAIC,gBAAgBJ,aACfK,IAAI,eAErBF,KAAKG,OAAS,GACPH,KAAKI,MAAM,OAAO,IAM3BC,SAAW,SACThB,OAASO,oBACE,IAAXP,OAAkB,KACdG,GAAK,oBAAsBH,OAC3BI,OAAST,EAAEQ,IAAIE,KAAK,iBAExBV,EAAE,mBAAmBI,MAAK,eAGlBkB,IAAM,oBAFItB,EAAEM,MAAMC,KAAK,UAGvBgB,QAAUvB,EAAEsB,KAAKZ,KAAK,iBAEtBF,KAAOc,KAAmB,SAAZC,SACdvB,EAAEsB,KAAKX,QAGPH,KAAOc,KAAkB,UAAXb,QACdT,EAAEsB,KAAKX,mBAMhB,CACHa,KAAM,WAGFC,YAAW,YACiB,IAApBb,gBACAS,WAEAnB,eAAe,UAEpB,KAGHY,OAAOY,iBAAiB,cAAc,WAClCL,cAGJpB,IAAI0B,YAAY,CACZ,CAACC,IAAK,qBAAsBC,UAAW,uBACvC,CAACD,IAAK,sBAAuBC,UAAW,yBACzCC,MAAK,SAASC,SAEb/B,EAAE,oBAAoBgC,GAAG,SAAS,kBACjBhC,EAAEM,MAAMC,KAAK,eAGjB,QACDP,EAAEM,MAAMC,KAAK,SAAU,QAAQ0B,KAAKF,QAAQ,IAC5C7B,eAAe,kBAGd,OACDF,EAAEM,MAAMC,KAAK,SAAU,SAAS0B,KAAKF,QAAQ,IAC7C7B,eAAe,uBAIfF,EAAEM,MAAMC,KAAK,SAAU,SAAS0B,KAAKF,QAAQ"}