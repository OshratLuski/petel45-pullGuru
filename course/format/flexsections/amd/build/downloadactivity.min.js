define("format_flexsections/downloadactivity",["exports","core/ajax","core/modal_factory","core/modal_events","core/str"],(function(_exports,_ajax,_modal_factory,_modal_events,_str){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.showModal=_exports.init=void 0,_modal_factory=_interopRequireDefault(_modal_factory),_modal_events=_interopRequireDefault(_modal_events);const Selectors_actions={showDownloadModalBtn:'[data-action="show_download_modal"]'},Selectors_targets={activityInstance:".activity-instance"},TEMPOBJ={},clearTempObj=()=>{for(const prop in TEMPOBJ)TEMPOBJ.hasOwnProperty(prop)&&delete TEMPOBJ[prop]},showModal=async()=>{const info=await(cmid=TEMPOBJ.cmid,courseid=TEMPOBJ.courseid,(0,_ajax.call)([{methodname:"format_flexsections_get_info",args:{cmid:cmid,courseid:courseid}}])[0].then((response=>response)).catch((error=>{window.console.error("API call failed:",error)})));var cmid,courseid;const modal=await _modal_factory.default.create({title:info.title,body:info.body,type:_modal_factory.default.types.SAVE_CANCEL});modal.setSaveButtonText((0,_str.get_string)("downloadtheversionofthisactivity","format_flexsections")),modal.getRoot().on(_modal_events.default.save,(function(e){e.preventDefault(),activityDownload(modal.getBody()[0]),modal.getFooter()[0].querySelector('[data-action="save"]').disabled=!0,(async target=>{const closeText=await(0,_str.get_string)("close","format_flexsections");target.innerHTML=closeText})(modal.getFooter()[0].querySelector('[data-action="cancel"]')),clearTempObj()})),modal.getRoot().on(_modal_events.default.cancel,(function(){clearTempObj(),modal.hide()})),modal.show()};_exports.showModal=showModal;const activityDownload=async target=>{const response=await(cmid=+TEMPOBJ.cmid,courseid=+TEMPOBJ.courseid,(0,_ajax.call)([{methodname:"format_flexsections_version_download",args:{cmid:cmid,courseid:courseid}}])[0].then((response=>response)).catch((error=>{window.console.error("API call failed:",error)})));var cmid,courseid;return target.innerHTML=response,response};_exports.init=()=>{document.addEventListener("click",(e=>{e.target.closest(Selectors_actions.showDownloadModalBtn)&&(e.stopPropagation(),(e=>{const activitytitle=e.target.closest(Selectors_targets.activityInstance).querySelector(".activitytitle");activitytitle.nextElementSibling.dataset.cmid.length>0&&(TEMPOBJ.cmid=activitytitle.nextElementSibling.dataset.cmid),activitytitle.nextElementSibling.dataset.courseid.length>0&&(TEMPOBJ.courseid=activitytitle.nextElementSibling.dataset.courseid)})(e),showModal())}))}}));

//# sourceMappingURL=downloadactivity.min.js.map