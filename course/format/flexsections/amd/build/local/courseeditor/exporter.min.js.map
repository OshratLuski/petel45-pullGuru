{"version":3,"file":"exporter.min.js","sources":["../../../src/local/courseeditor/exporter.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\nimport Exporter from \"core_courseformat/local/courseeditor/exporter\";\r\n\r\n/**\r\n * Overriding default course format exporter\r\n *\r\n * @module     format_flexsections/local/courseeditor/exporter\r\n * @copyright  2022 Marina Glancy\r\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\nexport default class extends Exporter {\r\n    // Extends: course/format/amd/src/local/courseeditor/exporter.js\r\n\r\n    /**\r\n     * Generate a section export data from the state.\r\n     *\r\n     * @param {Object} state the current state.\r\n     * @param {Object} sectioninfo the section state data.\r\n     * @returns {Object}\r\n     */\r\n    section(state, sectioninfo) {\r\n        const children = sectioninfo.children;\r\n        const section = super.section(state, sectioninfo);\r\n        section.children = [];\r\n        if (children && children.length) {\r\n            for (let i = 0; i < children.length; i++) {\r\n                section.children.push(this.section(state, children[i]));\r\n            }\r\n        }\r\n        return section;\r\n    }\r\n\r\n    /**\r\n     * Generate the course export data from the state.\r\n     *\r\n     * @param {Object} state the current state.\r\n     * @returns {Object}\r\n     */\r\n    course(state) {\r\n        const course = super.course(state);\r\n        course.maxsectiondepth = state.course.maxsectiondepth;\r\n        return course;\r\n    }\r\n\r\n    /**\r\n     * Return a sorted list of all sections and cms items in the state.\r\n     *\r\n     * @param {Object} state the current state.\r\n     * @returns {Array} all sections and cms items in the state.\r\n     */\r\n    allItemsArray(state) {\r\n        const items = [];\r\n        const sectionlist = state.course.sectionlist ?? [];\r\n\r\n        const addCms = (sectioninfo) => {\r\n            const cmlist = sectioninfo.cmlist ?? [];\r\n            cmlist.forEach(cmid => {\r\n                const cminfo = state.cm.get(cmid);\r\n                items.push({type: 'cm', id: cminfo.id, url: cminfo.url});\r\n            });\r\n        };\r\n        const addChildItems = (children) => {\r\n            if (children && children.length) {\r\n                for (let i = 0; i < children.length; i++) {\r\n                    const child = children[i];\r\n                    items.push({type: 'section', id: child.id, url: child.sectionurl});\r\n                    addCms(child);\r\n                    addChildItems(child.children);\r\n                }\r\n            }\r\n        };\r\n        sectionlist.forEach(sectionid => {\r\n            const sectioninfo = state.section.get(sectionid);\r\n            items.push({type: 'section', id: sectioninfo.id, url: sectioninfo.sectionurl});\r\n            addCms(sectioninfo);\r\n            addChildItems(sectioninfo.children);\r\n        });\r\n        return items;\r\n    }\r\n}"],"names":["Exporter","section","state","sectioninfo","children","super","length","i","push","this","course","maxsectiondepth","allItemsArray","items","sectionlist","addCms","cmlist","forEach","cmid","cminfo","cm","get","type","id","url","addChildItems","child","sectionurl","sectionid"],"mappings":";;;;;;;wKAwB6BA,kBAUzBC,QAAQC,MAAOC,mBACLC,SAAWD,YAAYC,SACvBH,QAAUI,MAAMJ,QAAQC,MAAOC,gBACrCF,QAAQG,SAAW,GACfA,UAAYA,SAASE,WAChB,IAAIC,EAAI,EAAGA,EAAIH,SAASE,OAAQC,IACjCN,QAAQG,SAASI,KAAKC,KAAKR,QAAQC,MAAOE,SAASG,YAGpDN,QASXS,OAAOR,aACGQ,OAASL,MAAMK,OAAOR,cAC5BQ,OAAOC,gBAAkBT,MAAMQ,OAAOC,gBAC/BD,OASXE,cAAcV,uCACJW,MAAQ,GACRC,0CAAcZ,MAAMQ,OAAOI,mEAAe,GAE1CC,OAAUZ,mEACGA,YAAYa,0DAAU,IAC9BC,SAAQC,aACLC,OAASjB,MAAMkB,GAAGC,IAAIH,MAC5BL,MAAML,KAAK,CAACc,KAAM,KAAMC,GAAIJ,OAAOI,GAAIC,IAAKL,OAAOK,UAGrDC,cAAiBrB,cACfA,UAAYA,SAASE,WAChB,IAAIC,EAAI,EAAGA,EAAIH,SAASE,OAAQC,IAAK,OAChCmB,MAAQtB,SAASG,GACvBM,MAAML,KAAK,CAACc,KAAM,UAAWC,GAAIG,MAAMH,GAAIC,IAAKE,MAAMC,aACtDZ,OAAOW,OACPD,cAAcC,MAAMtB,mBAIhCU,YAAYG,SAAQW,kBACVzB,YAAcD,MAAMD,QAAQoB,IAAIO,WACtCf,MAAML,KAAK,CAACc,KAAM,UAAWC,GAAIpB,YAAYoB,GAAIC,IAAKrB,YAAYwB,aAClEZ,OAAOZ,aACPsB,cAActB,YAAYC,aAEvBS"}