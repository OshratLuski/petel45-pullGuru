{"version":3,"file":"uploadimagepopup.min.js","sources":["../src/uploadimagepopup.js"],"sourcesContent":["define([\r\n    'jquery',\r\n    'core/ajax',\r\n    'core/str',\r\n    'core/templates',\r\n    'core/notification',\r\n    'core/modal_factory',\r\n    'core/fragment',\r\n    'jqueryui',\r\n\r\n], function($, Ajax, str, Templates, Notification, ModalFactory, Fragment) {\r\n\r\n    return {\r\n        init: function(uniqueid) {\r\n            var form = $('#upload_image_form_' + uniqueid),\r\n                self = this;\r\n\r\n            form.on('keydown', 'input[type=\"text\"]', function(e) {\r\n                if (e.keyCode === 13) {\r\n                    e.preventDefault();\r\n                }\r\n            });\r\n\r\n            // Submit.\r\n            form.find('.uploadimagesubmit').click(function(event) {\r\n                self.uploadImage(event, form);\r\n            });\r\n\r\n            // Close modal factory popup.\r\n            form.find('.uploadimageclose').click(function() {\r\n                self.closeModalFactory(form);\r\n            });\r\n        },\r\n\r\n        uploadImage: function(e, form) {\r\n            let self = this;\r\n\r\n            e.preventDefault();\r\n\r\n            var serializedForm = form.serializeArray(),\r\n                data = {};\r\n\r\n            serializedForm.forEach(function(item) {\r\n                data[item.name] = data[item.name] ? data[item.name] + ',' + item.value : item.value;\r\n            });\r\n\r\n            var parseResponse = function(response) {\r\n                response = JSON.parse(response);\r\n\r\n                switch (response.type) {\r\n                    case 'course':\r\n                        $('#courseheaderimage').css('background-image', 'url(' + response.imageurl + ')');\r\n                        break;\r\n                    case 'singlesection':\r\n                        $('.card-img').css('background-image', 'url(' + response.imageurl + ')');\r\n                        break;\r\n                    case 'multisection':\r\n                        $('#section-image-' + response.sectionid).css('background-image', 'url(' + response.imageurl + ')');\r\n                        break;\r\n                }\r\n\r\n                // Close modal factory popup.\r\n                self.closeModalFactory(form);\r\n            };\r\n\r\n            switch (data.type) {\r\n                case 'course':\r\n                    Ajax.call([{\r\n                        methodname: 'format_flexsections_change_courseimage',\r\n                        args: {\r\n                            fileitemid: data.uploadedimage,\r\n                            courseid: data.courseid,\r\n                        },\r\n                        done: parseResponse,\r\n                        fail: Notification.exception\r\n                    }]);\r\n                    break;\r\n                case 'singlesection':\r\n                case 'multisection':\r\n                    Ajax.call([{\r\n                        methodname: 'format_flexsections_change_sectionimage',\r\n                        args: {\r\n                            type: data.type,\r\n                            fileitemid: data.uploadedimage,\r\n                            sectionid: data.sectionid,\r\n                        },\r\n                        done: parseResponse,\r\n                        fail: Notification.exception\r\n                    }]);\r\n                    break;\r\n                default:\r\n                    self.closeModalFactory(form);\r\n            }\r\n        },\r\n\r\n        closeModalFactory: function(form) {\r\n            form.parent().parent().parent().find('.btn-close').click();\r\n        },\r\n    };\r\n});\r\n"],"names":["define","$","Ajax","str","Templates","Notification","ModalFactory","Fragment","init","uniqueid","form","self","this","on","e","keyCode","preventDefault","find","click","event","uploadImage","closeModalFactory","serializedForm","serializeArray","data","forEach","item","name","value","parseResponse","response","JSON","parse","type","css","imageurl","sectionid","call","methodname","args","fileitemid","uploadedimage","courseid","done","fail","exception","parent"],"mappings":"AAAAA,OAAO,uCAAA,CACH,SACA,YACA,WACA,iBACA,oBACA,qBACA,gBACA,aAED,SAASC,EAAGC,KAAMC,IAAKC,UAAWC,aAAcC,aAAcC,UAE7D,MAAO,CACHC,KAAM,SAASC,UACX,IAAIC,KAAOT,EAAE,sBAAwBQ,UACjCE,KAAOC,KAEXF,KAAKG,GAAG,UAAW,sBAAsB,SAASC,GAC5B,KAAdA,EAAEC,SACFD,EAAEE,gBAEV,IAGAN,KAAKO,KAAK,sBAAsBC,OAAM,SAASC,OAC3CR,KAAKS,YAAYD,MAAOT,KAC5B,IAGAA,KAAKO,KAAK,qBAAqBC,OAAM,WACjCP,KAAKU,kBAAkBX,KAC3B,GACH,EAEDU,YAAa,SAASN,EAAGJ,MACrB,IAAIC,KAAOC,KAEXE,EAAEE,iBAEF,IAAIM,eAAiBZ,KAAKa,iBACtBC,KAAO,CAAA,EAEXF,eAAeG,SAAQ,SAASC,MAC5BF,KAAKE,KAAKC,MAAQH,KAAKE,KAAKC,MAAQH,KAAKE,KAAKC,MAAQ,IAAMD,KAAKE,MAAQF,KAAKE,KAClF,IAEA,IAAIC,cAAgB,SAASC,UAGzB,QAFAA,SAAWC,KAAKC,MAAMF,WAELG,MACb,IAAK,SACDhC,EAAE,sBAAsBiC,IAAI,mBAAoB,OAASJ,SAASK,SAAW,KAC7E,MACJ,IAAK,gBACDlC,EAAE,aAAaiC,IAAI,mBAAoB,OAASJ,SAASK,SAAW,KACpE,MACJ,IAAK,eACDlC,EAAE,kBAAoB6B,SAASM,WAAWF,IAAI,mBAAoB,OAASJ,SAASK,SAAW,KAKvGxB,KAAKU,kBAAkBX,OAG3B,OAAQc,KAAKS,MACT,IAAK,SACD/B,KAAKmC,KAAK,CAAC,CACPC,WAAY,yCACZC,KAAM,CACFC,WAAYhB,KAAKiB,cACjBC,SAAUlB,KAAKkB,UAEnBC,KAAMd,cACNe,KAAMvC,aAAawC,aAEvB,MACJ,IAAK,gBACL,IAAK,eACD3C,KAAKmC,KAAK,CAAC,CACPC,WAAY,0CACZC,KAAM,CACFN,KAAMT,KAAKS,KACXO,WAAYhB,KAAKiB,cACjBL,UAAWZ,KAAKY,WAEpBO,KAAMd,cACNe,KAAMvC,aAAawC,aAEvB,MACJ,QACIlC,KAAKU,kBAAkBX,MAElC,EAEDW,kBAAmB,SAASX,MACxBA,KAAKoC,SAASA,SAASA,SAAS7B,KAAK,cAAcC,OACvD,EAER"}