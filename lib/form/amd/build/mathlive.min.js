function _wrapNativeSuper(Class){var _cache="function"==typeof Map?new Map:void 0;return _wrapNativeSuper=function(Class){if(null===Class||(fn=Class,-1===Function.toString.call(fn).indexOf("[native code]")))return Class;var fn;if("function"!=typeof Class)throw new TypeError("Super expression must either be null or a function");if(void 0!==_cache){if(_cache.has(Class))return _cache.get(Class);_cache.set(Class,Wrapper)}function Wrapper(){return _construct(Class,arguments,_getPrototypeOf(this).constructor)}return Wrapper.prototype=Object.create(Class.prototype,{constructor:{value:Wrapper,enumerable:!1,writable:!0,configurable:!0}}),_setPrototypeOf(Wrapper,Class)},_wrapNativeSuper(Class)}function _construct(Parent,args,Class){return _construct=_isNativeReflectConstruct()?Reflect.construct:function(Parent,args,Class){var a=[null];a.push.apply(a,args);var instance=new(Function.bind.apply(Parent,a));return Class&&_setPrototypeOf(instance,Class.prototype),instance},_construct.apply(null,arguments)}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))}}function _get(){return _get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(target,property,receiver){var base=_superPropBase(target,property);if(base){var desc=Object.getOwnPropertyDescriptor(base,property);return desc.get?desc.get.call(arguments.length<3?target:receiver):desc.value}},_get.apply(this,arguments)}function _superPropBase(object,property){for(;!Object.prototype.hasOwnProperty.call(object,property)&&null!==(object=_getPrototypeOf(object)););return object}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),Object.defineProperty(subClass,"prototype",{writable:!1}),superClass&&_setPrototypeOf(subClass,superClass)}function _setPrototypeOf(o,p){return _setPrototypeOf=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o},_setPrototypeOf(o,p)}function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function(){var result,Super=_getPrototypeOf(Derived);if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else result=Super.apply(this,arguments);return _possibleConstructorReturn(this,result)}}function _possibleConstructorReturn(self,call){if(call&&("object"===_typeof(call)||"function"==typeof call))return call;if(void 0!==call)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(self)}function _assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function _getPrototypeOf(o){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)},_getPrototypeOf(o)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Constructor}function _toConsumableArray(arr){return function(arr){if(Array.isArray(arr))return _arrayLikeToArray(arr)}(arr)||function(iter){if("undefined"!=typeof Symbol&&null!=iter[Symbol.iterator]||null!=iter["@@iterator"])return Array.from(iter)}(arr)||_unsupportedIterableToArray(arr)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _slicedToArray(arr,i){return function(arr){if(Array.isArray(arr))return arr}(arr)||function(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null==_i)return;var _s,_e,_arr=[],_n=!0,_d=!1;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||_unsupportedIterableToArray(arr,i)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _createForOfIteratorHelper(o,allowArrayLike){var it="undefined"!=typeof Symbol&&o[Symbol.iterator]||o["@@iterator"];if(!it){if(Array.isArray(o)||(it=_unsupportedIterableToArray(o))||allowArrayLike&&o&&"number"==typeof o.length){it&&(o=it);var i=0,F=function(){};return{s:F,n:function(){return i>=o.length?{done:!0}:{done:!1,value:o[i++]}},e:function(_e2){throw _e2},f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var err,normalCompletion=!0,didErr=!1;return{s:function(){it=it.call(o)},n:function(){var step=it.next();return normalCompletion=step.done,step},e:function(_e3){didErr=!0,err=_e3},f:function(){try{normalCompletion||null==it.return||it.return()}finally{if(didErr)throw err}}}}function _unsupportedIterableToArray(o,minLen){if(o){if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);return"Object"===n&&o.constructor&&(n=o.constructor.name),"Map"===n||"Set"===n?Array.from(o):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(o,minLen):void 0}}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}var global,factory;global=window,factory=function(exports){var MathLive=function(){var __defProp=Object.defineProperty,__defProps=Object.defineProperties,__getOwnPropDesc=Object.getOwnPropertyDescriptor,__getOwnPropDescs=Object.getOwnPropertyDescriptors,__getOwnPropNames=Object.getOwnPropertyNames,__getOwnPropSymbols=Object.getOwnPropertySymbols,__hasOwnProp=Object.prototype.hasOwnProperty,__propIsEnum=Object.prototype.propertyIsEnumerable,__defNormalProp=function(obj,key,value){return key in obj?__defProp(obj,key,{enumerable:!0,configurable:!0,writable:!0,value:value}):obj[key]=value},__spreadValues=function(a,b){for(var prop in b||(b={}))__hasOwnProp.call(b,prop)&&__defNormalProp(a,prop,b[prop]);if(__getOwnPropSymbols){var _step,_iterator=_createForOfIteratorHelper(__getOwnPropSymbols(b));try{for(_iterator.s();!(_step=_iterator.n()).done;)prop=_step.value,__propIsEnum.call(b,prop)&&__defNormalProp(a,prop,b[prop])}catch(err){_iterator.e(err)}finally{_iterator.f()}}return a},__spreadProps=function(a,b){return __defProps(a,__getOwnPropDescs(b))},__restKey=function(key){return"symbol"===_typeof(key)?key:key+""},__objRest=function(source,exclude){var target={};for(var prop in source)__hasOwnProp.call(source,prop)&&exclude.indexOf(prop)<0&&(target[prop]=source[prop]);if(null!=source&&__getOwnPropSymbols){var _step2,_iterator2=_createForOfIteratorHelper(__getOwnPropSymbols(source));try{for(_iterator2.s();!(_step2=_iterator2.n()).done;)prop=_step2.value,exclude.indexOf(prop)<0&&__propIsEnum.call(source,prop)&&(target[prop]=source[prop])}catch(err){_iterator2.e(err)}finally{_iterator2.f()}}return target},mathlive_exports={};function isArray(x){return Array.isArray(x)}function isBrowser(){return"window"in globalThis&&"document"in globalThis}function canVibrate(){return"function"==typeof navigator.vibrate}function osPlatform(){var _a3,_b3;if(!isBrowser())return"other";var platform2=null!=(_b3=null==(_a3=navigator.userAgentData)?void 0:_a3.platform)?_b3:navigator.platform;return/^mac/i.test(platform2)?5===navigator.maxTouchPoints?"ios":"macos":/^win/i.test(platform2)?"windows":/android/i.test(navigator.userAgent)?"android":/iphone|ipod|ipad/i.test(navigator.userAgent)?"ios":/\bcros\b/i.test(navigator.userAgent)?"chromeos":"other"}!function(target,all){for(var name in all)__defProp(target,name,{get:all[name],enumerable:!0})}(mathlive_exports,{MathfieldElement:function(){return _MathfieldElement2},autoRenderMathInElement:function(){return _autoRenderMathInElement},convertAsciiMathToLatex:function(){return _convertAsciiMathToLatex},convertLatexToAsciiMath:function(){return _convertLatexToAsciiMath},convertLatexToMarkup:function(){return _convertLatexToMarkup},convertLatexToMathMl:function(){return _convertLatexToMathMl},convertLatexToSpeakableText:function(){return _convertLatexToSpeakableText},globalMathLive:function(){return _globalMathLive},makeSharedVirtualKeyboard:function(){return _makeSharedVirtualKeyboard},renderMathInDocument:function(){return _renderMathInDocument},renderMathInElement:function(){return _renderMathInElement},serializeMathJsonToLatex:function(){return _serializeMathJsonToLatex},validateLatex:function(){return validateLatex2},version:function(){return _version}});var l10n={strings:{en:{"keyboard.tooltip.functions":"Functions","keyboard.tooltip.symbols":"Symbols","keyboard.tooltip.greek":"Greek Letters","keyboard.tooltip.command":"LaTeX Command Mode","keyboard.tooltip.numeric":"Numeric","keyboard.tooltip.alphabetic":"Roman Letters","tooltip.copy to clipboard":"Copy to Clipboard","tooltip.cut to clipboard":"Cut to Clipboard","tooltip.paste from clipboard":"Paste from Clipboard","tooltip.redo":"Redo","tooltip.toggle virtual keyboard":"Toggle Virtual Keyboard","tooltip.undo":"Undo","menu.insert matrix":"Insert Matrix","menu.insert vector":"Insert Vector","submenu.array.matrix delimiters":"Matrix Delimiters","menu.array.add row above":"Add Row After","menu.array.add row below":"Add Row Before","menu.array.add column after":"Add Column After","menu.array.add column before":"Add Column Before","menu.array.delete row":"Delete Row","menu.array.delete rows":"Delete Selected Rows","menu.array.delete column":"Delete Column","menu.array.delete columns":"Delete Selected Columns","submenu.array.insert separator":"Insert Separator","menu.insert table":"Insert Table","submenu.table style":"Table Style"},ar:{"keyboard.tooltip.functions":"مهام","keyboard.tooltip.symbols":"حرف او رمز","keyboard.tooltip.greek":"حروف يونانية","keyboard.tooltip.command":"حالة تلقي الأوامر اللاتك","keyboard.tooltip.numeric":"الرقمية","keyboard.tooltip.alphabetic":"رموز الاحرف الرومانية","tooltip.copy to clipboard":"نسخ إلى الحافظة","tooltip.cut to clipboard":"قص إلى الحافظة","tooltip.paste from clipboard":"لصق من الحافظة","tooltip.redo":"الإعادة","tooltip.toggle virtual keyboard":"تبديل لوحة المفاتيح الإفتراضية","tooltip.undo":"إلغاء","menu.insert matrix":"أدخل المصفوفة","menu.insert vector":"أدخل متجه","submenu.array.matrix delimiters":"محددات المصفوفة","menu.array.add row above":"أضف صفًا بعد ذلك","menu.array.add row below":"أضف الصف قبل","menu.array.add column after":"أضف العمود بعد ذلك","menu.array.add column before":"أضف العمود قبل","menu.array.delete row":"احذف صف","menu.array.delete rows":"حذف الصفوف المحددة","menu.array.delete column":"حذف العمود","menu.array.delete columns":"حذف الأعمدة المحددة","submenu.array.insert separator":"أدخل فاصل","menu.insert table":"إدراج جدول","submenu.table style":"نمط الجدول"},bg:{"keyboard.tooltip.functions":"Функции","keyboard.tooltip.symbols":"Символи","keyboard.tooltip.greek":"Гръцки букви","keyboard.tooltip.command":"Команден режим на латекс","keyboard.tooltip.numeric":"Числови","keyboard.tooltip.alphabetic":"Римски букви","tooltip.copy to clipboard":"Копиране в клипборда","tooltip.redo":"Повторно","tooltip.toggle virtual keyboard":"Превключване на виртуална клавиатура","tooltip.undo":"Отмяна","menu.insert matrix":"Вмъкване на матрица","menu.insert vector":"Вмъкване на вектор","submenu.array.matrix delimiters":"Матрични разделители","menu.array.add row above":"Добавяне на ред след","menu.array.add row below":"Добавяне на ред преди","menu.array.add column after":"Добавяне на колона след","menu.array.add column before":"Добавяне на колона преди","menu.array.delete row":"Изтриване на реда","menu.array.delete rows":"Изтриване на избраните редове","menu.array.delete column":"Изтриване на колона","menu.array.delete columns":"Изтриване на избраните колони","submenu.array.insert separator":"Поставете разделител","menu.insert table":"Вмъкване на таблица","submenu.table style":"Табличен стил"},bs:{"keyboard.tooltip.functions":"Funkcije","keyboard.tooltip.symbols":"Simboli","keyboard.tooltip.greek":"Grčka slova","keyboard.tooltip.command":"LaTeX naredbeni način","keyboard.tooltip.numeric":"Numerički","keyboard.tooltip.alphabetic":"Rimska slova","tooltip.copy to clipboard":"Kopirati u clipboard","tooltip.redo":"Ponovi","tooltip.toggle virtual keyboard":"Uključi / isključi virtualnu tipkovnicu","tooltip.undo":"Poništi","menu.insert matrix":"Umetni matricu","menu.insert vector":"Umetni vektor","submenu.array.matrix delimiters":"Matrični razdjelnici","menu.array.add row above":"Dodaj redak nakon","menu.array.add row below":"Dodaj red prije","menu.array.add column after":"Dodaj stupac nakon","menu.array.add column before":"Dodaj stupac prije","menu.array.delete row":"Izbriši red","menu.array.delete rows":"Izbriši odabrane redove","menu.array.delete column":"Izbriši stupac","menu.array.delete columns":"Izbriši odabrane stupce","submenu.array.insert separator":"Umetni separator","menu.insert table":"Ubaci tabelu","submenu.table style":"Stil tabele"},cs:{"keyboard.tooltip.functions":"Funkce","keyboard.tooltip.symbols":"Symboly","keyboard.tooltip.greek":"Řecké dopisy","keyboard.tooltip.command":"Příkazový režim LaTeX","keyboard.tooltip.numeric":"Číselné","keyboard.tooltip.alphabetic":"Římské dopisy","tooltip.copy to clipboard":"Zkopírovat do schránky","tooltip.redo":"Předělat","tooltip.toggle virtual keyboard":"Přepnout virtuální klávesnici","tooltip.undo":"Vrátit","menu.insert matrix":"Vložte matici","menu.insert vector":"Vložit vektor","submenu.array.matrix delimiters":"Oddělovače matic","menu.array.add row above":"Přidat řádek za","menu.array.add row below":"Přidat řádek před","menu.array.add column after":"Přidat sloupec za","menu.array.add column before":"Přidat sloupec dříve","menu.array.delete row":"Odstranit řádek","menu.array.delete rows":"Odstranit vybrané řádky","menu.array.delete column":"Odstranit sloupec","menu.array.delete columns":"Odstranit vybrané sloupce","submenu.array.insert separator":"Vložte oddělovač","menu.insert table":"Vložit tabulku","submenu.table style":"Styl tabulky"},da:{"keyboard.tooltip.functions":"Funktioner","keyboard.tooltip.symbols":"Symboler","keyboard.tooltip.greek":"Græske bogstaver","keyboard.tooltip.command":"LaTeX kommandotilstand","keyboard.tooltip.numeric":"Numerisk","keyboard.tooltip.alphabetic":"Romerske breve","tooltip.copy to clipboard":"Kopier til udklipsholder","tooltip.redo":"Gentag igen","tooltip.toggle virtual keyboard":"Skift virtuelt tastatur","tooltip.undo":"Fortryd","menu.insert matrix":"Indsæt matrix","menu.insert vector":"Indsæt vektor","submenu.array.matrix delimiters":"Matrixafgrænsere","menu.array.add row above":"Tilføj række efter","menu.array.add row below":"Tilføj række før","menu.array.add column after":"Tilføj kolonne efter","menu.array.add column before":"Tilføj kolonne før","menu.array.delete row":"Slet række","menu.array.delete rows":"Slet valgte rækker","menu.array.delete column":"Slet kolonne","menu.array.delete columns":"Slet valgte kolonner","submenu.array.insert separator":"Indsæt separator","menu.insert table":"Indsæt tabel","submenu.table style":"Tabelstil"},de:{"keyboard.tooltip.functions":"Funktionen","keyboard.tooltip.symbols":"Symbole","keyboard.tooltip.greek":"Griechische Buchstaben","keyboard.tooltip.command":"LaTeX-Befehlsmodus","keyboard.tooltip.numeric":"Numerisch","keyboard.tooltip.alphabetic":"Römische Buchstaben","tooltip.copy to clipboard":"In die Zwischenablage kopieren","tooltip.redo":"Wiederholen","tooltip.toggle virtual keyboard":"Virtuelle Tastatur umschalten","tooltip.undo":"Widerrufen","menu.insert matrix":"Matrix einfügen","menu.insert vector":"Vektor einfügen","submenu.array.matrix delimiters":"Matrixtrennzeichen","menu.array.add row above":"Zeile hinzufügen nach","menu.array.add row below":"Zeile hinzufügen vor","menu.array.add column after":"Spalte hinzufügen nach","menu.array.add column before":"Spalte hinzufügen vor","menu.array.delete row":"Zeile löschen","menu.array.delete rows":"Ausgewählte Zeilen löschen","menu.array.delete column":"Spalte löschen","menu.array.delete columns":"Ausgewählte Spalten löschen","submenu.array.insert separator":"Trennzeichen einfügen","menu.insert table":"Tabelle einfügen","submenu.table style":"Tabellenstil"},el:{"keyboard.tooltip.functions":"συναρτήσεις","keyboard.tooltip.symbols":"σύμβολα","keyboard.tooltip.greek":"ελληνικά γράμματα","keyboard.tooltip.command":"Λειτουργία εντολών LaTeX","keyboard.tooltip.numeric":"Αριθμητικός","keyboard.tooltip.alphabetic":"Ρωμαϊκά γράμματα","tooltip.copy to clipboard":"Αντιγραφή στο πρόχειρο","tooltip.redo":"Ξανακάνω","tooltip.toggle virtual keyboard":"Εναλλαγή εικονικού πληκτρολογίου","tooltip.undo":"Ξεκάνω","menu.insert matrix":"Εισαγωγή Matrix","menu.insert vector":"Εισαγωγή διανύσματος","submenu.array.matrix delimiters":"Οριοθέτες Matrix","menu.array.add row above":"Προσθήκη σειράς μετά","menu.array.add row below":"Προσθήκη σειράς πριν","menu.array.add column after":"Προσθήκη στήλης μετά","menu.array.add column before":"Προσθήκη στήλης πριν","menu.array.delete row":"Διαγραφή σειράς","menu.array.delete rows":"Διαγραφή επιλεγμένων σειρών","menu.array.delete column":"Διαγραφή στήλης","menu.array.delete columns":"Διαγραφή επιλεγμένων στηλών","submenu.array.insert separator":"Εισαγωγή διαχωριστικού","menu.insert table":"Εισαγωγή πίνακα","submenu.table style":"Στυλ πίνακα"},es:{"keyboard.tooltip.functions":"Funciones","keyboard.tooltip.symbols":"Símbolos","keyboard.tooltip.greek":"Letras griegas","keyboard.tooltip.command":"Modo Comando LaTeX","keyboard.tooltip.numeric":"Numérico","keyboard.tooltip.alphabetic":"Letras romanas","tooltip.copy to clipboard":"Copiar al portapapeles","tooltip.redo":"Rehacer","tooltip.toggle virtual keyboard":"Alternar teclado virtual","tooltip.undo":"Deshacer","menu.insert matrix":"Añadir Matriz","menu.insert vector":"Añadir vector","submenu.array.matrix delimiters":"Delimitadores de Matriz","menu.array.add row above":"Añadir Línea Antes","menu.array.add row below":"Añadir Línea Despues","menu.array.add column after":"Añadir Columna Despues","menu.array.add column before":"Añadir Columna Antes","menu.array.delete row":"Borrar Línea","menu.array.delete rows":"Borrar Líneas Seleccionadas","menu.array.delete column":"Borrar Columna","menu.array.delete columns":"Borrar Columnas Seleccionadas","submenu.array.insert separator":"Insertar un Separador","menu.insert table":"Insertar Tabla","submenu.table style":"Estilo de Tabla"},et:{"keyboard.tooltip.functions":"Funktsioonid","keyboard.tooltip.symbols":"Sümbolid","keyboard.tooltip.greek":"Kreeka kirjad","keyboard.tooltip.command":"LaTeXi käsurežiim","keyboard.tooltip.numeric":"Numbriline","keyboard.tooltip.alphabetic":"Rooma kirjad","tooltip.copy to clipboard":"Kopeerida lõikelauale","tooltip.redo":"Tee uuesti","tooltip.toggle virtual keyboard":"Lülitage sisse virtuaalne klaviatuur","tooltip.undo":"Võta tagasi","menu.insert matrix":"Sisesta maatriks","menu.insert vector":"Sisesta vektor","submenu.array.matrix delimiters":"Maatriksi eraldajad","menu.array.add row above":"Lisa rida pärast","menu.array.add row below":"Lisa rida enne","menu.array.add column after":"Lisa veerg pärast","menu.array.add column before":"Lisa veerg enne","menu.array.delete row":"Kustuta rida","menu.array.delete rows":"Kustuta valitud read","menu.array.delete column":"Kustuta veerg","menu.array.delete columns":"Kustuta valitud veerud","submenu.array.insert separator":"Sisestage eraldaja","menu.insert table":"Sisesta tabeli","submenu.table style":"Tabeli stiilis"},fa:{"keyboard.tooltip.functions":"توابع","keyboard.tooltip.symbols":"نمادها","keyboard.tooltip.greek":"حروف یونانی","keyboard.tooltip.command":"حالت دستور لاتک","keyboard.tooltip.numeric":"عددی","keyboard.tooltip.alphabetic":"حروف رومی","tooltip.copy to clipboard":"کپی به کلیپبورد","tooltip.redo":"بازگشت به بعد","tooltip.toggle virtual keyboard":"نمایش/نهفتن کیبورد مجازی","tooltip.undo":"بازگشت به قبل","menu.insert matrix":"ماتریس را وارد کنید","menu.insert vector":"درج بردار","submenu.array.matrix delimiters":"مرزهای ماتریس","menu.array.add row above":"بعد از آن ردیف اضافه کنید","menu.array.add row below":"ردیف را قبل اضافه کنید","menu.array.add column after":"اضافه کردن ستون بعد","menu.array.add column before":"ستون قبل را اضافه کنید","menu.array.delete row":"ردیف را حذف کنید","menu.array.delete rows":"ردیف های انتخاب شده را حذف کنید","menu.array.delete column":"حذف ستون","menu.array.delete columns":"ستون های انتخاب شده را حذف کنید","submenu.array.insert separator":"درج جدا کننده","menu.insert table":"قرار دادن جدول","submenu.table style":"سبک میز"},fi:{"keyboard.tooltip.functions":"Toiminnot","keyboard.tooltip.symbols":"Symbolit","keyboard.tooltip.greek":"Kreikkalaiset kirjeet","keyboard.tooltip.command":"LaTeX-komentotila","keyboard.tooltip.numeric":"Numeerinen","keyboard.tooltip.alphabetic":"Roomalaiset kirjeet","tooltip.copy to clipboard":"Kopioi leikepöydälle","tooltip.redo":"Tee uudelleen","tooltip.toggle virtual keyboard":"Vaihda virtuaalinäppäimistö","tooltip.undo":"Kumoa","menu.insert matrix":"Lisää matriisi","menu.insert vector":"Lisää vektori","submenu.array.matrix delimiters":"Matriisin erottimet","menu.array.add row above":"Lisää rivi jälkeen","menu.array.add row below":"Lisää rivi ennen","menu.array.add column after":"Lisää sarake jälkeen","menu.array.add column before":"Lisää sarake ennen","menu.array.delete row":"Poista rivi","menu.array.delete rows":"Poista valitut rivit","menu.array.delete column":"Poista sarake","menu.array.delete columns":"Poista valitut sarakkeet","submenu.array.insert separator":"Aseta erotin","menu.insert table":"Lisää taulukko","submenu.table style":"Taulukon tyyli"},fr:{"keyboard.tooltip.functions":"Fonctions","keyboard.tooltip.symbols":"Symboles","keyboard.tooltip.greek":"Lettres grecques","keyboard.tooltip.command":"Mode de commandes LaTeX","keyboard.tooltip.numeric":"Numérique","keyboard.tooltip.alphabetic":"Lettres romaines","tooltip.copy to clipboard":"Copier dans le presse-papiers","tooltip.redo":"Rétablir","tooltip.toggle virtual keyboard":"Afficher/Masquer le clavier virtuel","tooltip.undo":"Annuler","menu.insert matrix":"Insérer une Matrice","menu.insert vector":"Insérer un Vecteur","submenu.array.matrix delimiters":"Délimiteurs de la Matrice","menu.array.add row above":"Ajouter une Ligne Avant","menu.array.add row below":"Ajouter une Ligne Après","menu.array.add column before":"Ajouter une Colonne Avant","menu.array.add column after":"Ajouter une Colonne Après","menu.array.delete row":"Enlever une Ligne","menu.array.delete rows":"Enlever les Lignes Sélectionées","menu.array.delete column":"Enlever une Colone","menu.array.delete columns":"Enlever les Colonnes Sélectionées","submenu.array.insert separator":"Insérer un Séparateur","menu.insert table":"Insérer une Table","submenu.table style":"Style de la  Table"},ga:{"keyboard.tooltip.functions":"Feidhmeanna","keyboard.tooltip.symbols":"Siombailí","keyboard.tooltip.greek":"Litreacha na Gréige","keyboard.tooltip.command":"Mód Ordú LaTeX","keyboard.tooltip.numeric":"Uimhriúil","keyboard.tooltip.alphabetic":"Litreacha Rómhánacha","tooltip.copy to clipboard":"Cóipeáil chuig an Ghearrthaisce","tooltip.redo":"Athdhéan","tooltip.toggle virtual keyboard":"Méarchláir Fíorúil a Fháil","tooltip.undo":"Cealaigh","menu.insert matrix":"Cuir isteach Maitrís","menu.insert vector":"Cuir isteach Veicteoir","submenu.array.matrix delimiters":"Delimiters Maitrís","menu.array.add row above":"Cuir Rae Tar éis","menu.array.add row below":"Cuir Rae Roimh","menu.array.add column after":"Cuir Colún Tar éis","menu.array.add column before":"Cuir Colún Roimh","menu.array.delete row":"Scrios Rae","menu.array.delete rows":"Scrios Sraitheanna Roghnaithe","menu.array.delete column":"Scrios Colún","menu.array.delete columns":"Scrios Colúin Roghnaithe","submenu.array.insert separator":"Cuir Deighilteoir isteach","menu.insert table":"Ionsáigh Tábla","submenu.table style":"Stíl Tábla"},he:{"keyboard.tooltip.functions":"פונקציות","keyboard.tooltip.symbols":"סמלים","keyboard.tooltip.greek":"אותיות יווניות","keyboard.tooltip.command":"מצב פקודה לטקס","keyboard.tooltip.numeric":"מספרי","keyboard.tooltip.alphabetic":"מכתבים רומיים","tooltip.copy to clipboard":"העתק ללוח","tooltip.redo":"לַעֲשׂוֹת שׁוּב","tooltip.toggle virtual keyboard":"החלף את המקלדת הווירטואלית","tooltip.undo":"לבטל","menu.insert matrix":"הכנס מטריקס","menu.insert vector":"הכנס וקטור","submenu.array.matrix delimiters":"מפרידי מטריקס","menu.array.add row above":"הוסף שורה אחרי","menu.array.add row below":"הוסף שורה לפני","menu.array.add column after":"הוסף עמודה אחרי","menu.array.add column before":"הוסף עמודה לפני","menu.array.delete row":"מחק שורה","menu.array.delete rows":"מחק שורות שנבחרו","menu.array.delete column":"מחק עמודה","menu.array.delete columns":"מחק עמודות שנבחרו","submenu.array.insert separator":"הכנס מפריד","menu.insert table":"הכנס טבלה","submenu.table style":"טבלה סִגְנוֹן"},hr:{"keyboard.tooltip.functions":"Funkcije","keyboard.tooltip.symbols":"Simboli","keyboard.tooltip.greek":"Grčka slova","keyboard.tooltip.command":"LaTeX naredbeni način","keyboard.tooltip.numeric":"Numerički","keyboard.tooltip.alphabetic":"Rimska slova","tooltip.copy to clipboard":"Kopirati u međuspremnik","tooltip.redo":"Ponovi","tooltip.toggle virtual keyboard":"Uključi / isključi virtualnu tipkovnicu","tooltip.undo":"Poništi","menu.insert matrix":"Umetni matricu","menu.insert vector":"Umetni vektor","submenu.array.matrix delimiters":"Matrični razdjelnici","menu.array.add row above":"Dodaj redak nakon","menu.array.add row below":"Dodaj redak prije","menu.array.add column after":"Dodaj stupac nakon","menu.array.add column before":"Dodaj stupac prije","menu.array.delete row":"Izbriši redak","menu.array.delete rows":"Izbriši odabrane retke","menu.array.delete column":"Izbriši stupac","menu.array.delete columns":"Izbriši odabrane stupce","submenu.array.insert separator":"Umetni separator","menu.insert table":"Umetni tablicu","submenu.table style":"Stil tabele"},id:{"keyboard.tooltip.functions":"Fungsi","keyboard.tooltip.symbols":"Simbol","keyboard.tooltip.greek":"Huruf Yunani","keyboard.tooltip.command":"Mode Perintah LaTeX","keyboard.tooltip.numeric":"Numerik","keyboard.tooltip.alphabetic":"Surat Romawi","tooltip.copy to clipboard":"Menyalin ke clipboard","tooltip.redo":"Mengulangi","tooltip.toggle virtual keyboard":"Alihkan Keyboard Virtual","tooltip.undo":"Membuka","menu.insert matrix":"Sisipkan Matriks","menu.insert vector":"Sisipkan Vektor","submenu.array.matrix delimiters":"Pembatas Matriks","menu.array.add row above":"Tambahkan Baris Setelah","menu.array.add row below":"Tambahkan Baris Sebelumnya","menu.array.add column after":"Tambahkan Kolom Setelah","menu.array.add column before":"Tambahkan Kolom Sebelumnya","menu.array.delete row":"Hapus Baris","menu.array.delete rows":"Hapus Baris yang Dipilih","menu.array.delete column":"Hapus Kolom","menu.array.delete columns":"Hapus Kolom yang Dipilih","submenu.array.insert separator":"Sisipkan Pemisah","menu.insert table":"Sisipkan Tabel","submenu.table style":"Gaya Tabel"},hi:{"keyboard.tooltip.functions":"कार्यों","keyboard.tooltip.symbols":"प्रतीक","keyboard.tooltip.greek":"ग्रीक अक्षर","keyboard.tooltip.command":"लाटेक्स कमांड मोड","keyboard.tooltip.numeric":"संख्यात्मक","keyboard.tooltip.alphabetic":"रोमन पत्र","tooltip.copy to clipboard":"क्लिपबोर्ड पर कॉपी करें","tooltip.redo":"फिर से करें","tooltip.toggle virtual keyboard":"वर्चुअल कीबोर्ड टॉगल करें","tooltip.undo":"पूर्ववत","menu.insert matrix":"मैट्रिक्स डालें","menu.insert vector":"वेक्टर डालें","submenu.array.matrix delimiters":"मैट्रिक्स सीमांकक","menu.array.add row above":"बाद में पंक्ति जोड़ें","menu.array.add row below":"पहले पंक्ति जोड़ें","menu.array.add column after":"बाद में कॉलम जोड़ें","menu.array.add column before":"पहले कॉलम जोड़ें","menu.array.delete row":"पंक्ति को हटाएं","menu.array.delete rows":"चयनित पंक्तियों को हटाएं","menu.array.delete column":"कॉलम हटाएं","menu.array.delete columns":"चयनित कॉलम हटाएं","submenu.array.insert separator":"विभाजक डालें","menu.insert table":"टेबल इंसर्ट करें","submenu.table style":"टेबल स्टाइल"},hu:{"keyboard.tooltip.functions":"Funkciók","keyboard.tooltip.symbols":"Szimbólumok","keyboard.tooltip.greek":"Görög levelek","keyboard.tooltip.command":"LaTeX Parancs mód","keyboard.tooltip.numeric":"Numerikus","keyboard.tooltip.alphabetic":"Római levelek","tooltip.copy to clipboard":"Másolja a vágólapra","tooltip.redo":"Újra","tooltip.toggle virtual keyboard":"Váltás a virtuális billentyűzetre","tooltip.undo":"Visszavonás","menu.insert matrix":"Helyezze be a Mátrixot","menu.insert vector":"Vektor beszúrása","submenu.array.matrix delimiters":"Mátrixhatárolók","menu.array.add row above":"Sor hozzáadása után","menu.array.add row below":"Add Add Sor előtt","menu.array.add column after":"Oszlop hozzáadása után","menu.array.add column before":"Add oszlop előtt","menu.array.delete row":"Sor törlése","menu.array.delete rows":"Kijelölt sorok törlése","menu.array.delete column":"Oszlop törlése","menu.array.delete columns":"A kijelölt oszlopok törlése","submenu.array.insert separator":"Helyezze be az elválasztót","menu.insert table":"Helyezze be a táblázatot","submenu.table style":"Táblázatos stílus"},it:{"keyboard.tooltip.functions":"Funzioni","keyboard.tooltip.symbols":"Simboli","keyboard.tooltip.greek":"Lettere greche","keyboard.tooltip.command":"Modalità di comando LaTeX","keyboard.tooltip.numeric":"Numerico","keyboard.tooltip.alphabetic":"Lettere romane","tooltip.copy to clipboard":"Copia negli appunti","tooltip.redo":"Rifare","tooltip.toggle virtual keyboard":"Attiva / disattiva la tastiera virtuale","tooltip.undo":"Disfare","menu.insert matrix":"Inserisci una Matrice","menu.insert vector":"Inserisci Vettore","submenu.array.matrix delimiters":"Delimitatori di Matrice","menu.array.add row above":"Aggiungi una Riga Prima","menu.array.add row below":"Aggiungi una Riga Dopo","menu.array.add column before":"Aggiungi una Colonna Prima","menu.array.add column after":"Aggiungi una Colonna Dopo","menu.array.delete row":"Rimuovi una Riga","menu.array.delete rows":"Rimuovi le Righe Selezionate","menu.array.delete column":"Rimuovi una Colonna","menu.array.delete columns":"Rimuovi le Colonne Selezionate","submenu.array.insert separator":"Inserisci un Separatore","menu.insert table":"Inserisci Tabella","submenu.table style":"Stile tabella"},is:{"keyboard.tooltip.functions":"Aðgerðir","keyboard.tooltip.symbols":"Tákn","keyboard.tooltip.greek":"Grísk bréf","keyboard.tooltip.command":"LaTeX stjórnunarstilling","keyboard.tooltip.numeric":"Tölulegt","keyboard.tooltip.alphabetic":"Rómversk bréf","tooltip.copy to clipboard":"Afritaðu á klemmuspjald","tooltip.redo":"Endurtaka","tooltip.toggle virtual keyboard":"Skiptu um sýndarlyklaborð","tooltip.undo":"Afturkalla","menu.insert matrix":"Settu fylki inn","menu.insert vector":"Settu inn Vector","submenu.array.matrix delimiters":"Matrix afmörkun","menu.array.add row above":"Bæta við röð á eftir","menu.array.add row below":"Bæta við röð áður","menu.array.add column after":"Bæta við dálki á eftir","menu.array.add column before":"Bæta við dálki áður","menu.array.delete row":"Eyða röð","menu.array.delete rows":"Eyða völdum línum","menu.array.delete column":"Eyða dálki","menu.array.delete columns":"Eyða völdum dálkum","submenu.array.insert separator":"Settu skiljuna í","menu.insert table":"Settu inn töflu","submenu.table style":"Töflu stíl"},ja:{"keyboard.tooltip.functions":"関数","keyboard.tooltip.symbols":"シンボル","keyboard.tooltip.greek":"ギリシャ文字","keyboard.tooltip.command":"ラテックスコマンドモード","keyboard.tooltip.numeric":"数値","keyboard.tooltip.alphabetic":"ローマ字","tooltip.copy to clipboard":"クリップボードにコピー","tooltip.redo":"やり直し","tooltip.toggle virtual keyboard":"仮想キーボードの切り替え","tooltip.undo":"元に戻す","menu.insert matrix":"マトリックスを挿入","menu.insert vector":"ベクトルを挿入","submenu.array.matrix delimiters":"行列区切り文字","menu.array.add row above":"後に行を追加","menu.array.add row below":"前に行を追加","menu.array.add column after":"後に列を追加","menu.array.add column before":"前に列を追加","menu.array.delete row":"行を削除","menu.array.delete rows":"選択した行を削除する","menu.array.delete column":"列を削除","menu.array.delete columns":"選択した列を削除する","submenu.array.insert separator":"セパレーターを挿入","menu.insert table":"テーブルを挿入","submenu.table style":"テーブルスタイル"},ko:{"keyboard.tooltip.functions":"기능","keyboard.tooltip.symbols":"기호","keyboard.tooltip.greek":"그리스 문자","keyboard.tooltip.command":"유액 명령 모드","keyboard.tooltip.numeric":"숫자","keyboard.tooltip.alphabetic":"로마 문자","tooltip.copy to clipboard":"클립 보드에 복사","tooltip.redo":"다시 하다","tooltip.toggle virtual keyboard":"가상 키보드 전환","tooltip.undo":"실행 취소","menu.insert matrix":"매트릭스 삽입","menu.insert vector":"벡터 삽입","submenu.array.matrix delimiters":"행렬 구분 기호","menu.array.add row above":"뒤에 행 추가","menu.array.add row below":"앞에 행 추가","menu.array.add column after":"뒤에 열 추가","menu.array.add column before":"앞에 열 추가","menu.array.delete row":"행 삭제","menu.array.delete rows":"선택한 행 삭제","menu.array.delete column":"열 삭제","menu.array.delete columns":"선택한 열 삭제","submenu.array.insert separator":"구분자 삽입","menu.insert table":"표 삽입","submenu.table style":"테이블 스타일"},lv:{"keyboard.tooltip.functions":"Funkcijas","keyboard.tooltip.symbols":"Simboli","keyboard.tooltip.greek":"Grieķu burti","keyboard.tooltip.command":"LaTeX komandu režīms","keyboard.tooltip.numeric":"Ciparu skaitlis","keyboard.tooltip.alphabetic":"Romiešu vēstules","tooltip.copy to clipboard":"Kopēt starpliktuvē","tooltip.redo":"Pārtaisīt","tooltip.toggle virtual keyboard":"Pārslēgt virtuālo tastatūru","tooltip.undo":"Atsaukt","menu.insert matrix":"Ievietojiet matricu","menu.insert vector":"Ievietot vektoru","submenu.array.matrix delimiters":"Matricas norobežotāji","menu.array.add row above":"Pievienot rindu pēc","menu.array.add row below":"Pievienot rindu pirms","menu.array.add column after":"Pievienot kolonnu pēc","menu.array.add column before":"Pievienot kolonnu pirms","menu.array.delete row":"Dzēst rindu","menu.array.delete rows":"Dzēst atlasītās rindas","menu.array.delete column":"Dzēst kolonnu","menu.array.delete columns":"Dzēst atlasītās kolonnas","submenu.array.insert separator":"Ievietojiet atdalītāju","menu.insert table":"Ievietojiet tabulu","submenu.table style":"Galda stils"},lt:{"keyboard.tooltip.functions":"Funkcijos","keyboard.tooltip.symbols":"Simboliai","keyboard.tooltip.greek":"Graikiškos raidės","keyboard.tooltip.command":"LaTeX komandų režimas","keyboard.tooltip.numeric":"Skaitmeninis","keyboard.tooltip.alphabetic":"Romos laiškai","tooltip.copy to clipboard":"Nukopijuoti į iškarpinę","tooltip.redo":"Perdaryti","tooltip.toggle virtual keyboard":"Perjungti virtualiąją klaviatūrą","tooltip.undo":"Atšaukti","menu.insert matrix":"Ievietojiet matricu","menu.insert vector":"Ievietot vektoru","submenu.array.matrix delimiters":"Matricas norobežotāji","menu.array.add row above":"Pievienot rindu pēc","menu.array.add row below":"Pievienot rindu pirms","menu.array.add column after":"Pievienot kolonnu pēc","menu.array.add column before":"Pievienot kolonnu pirms","menu.array.delete row":"Dzēst rindu","menu.array.delete rows":"Dzēst atlasītās rindas","menu.array.delete column":"Dzēst kolonnu","menu.array.delete columns":"Dzēst atlasītās kolonnas","submenu.array.insert separator":"Ievietojiet atdalītāju","menu.insert table":"Ievietojiet tabulu","submenu.table style":"Tabulas stili"},lu:{"keyboard.tooltip.functions":"Funktiounen","keyboard.tooltip.symbols":"Symboler","keyboard.tooltip.greek":"Griichesch Bréiwer","keyboard.tooltip.command":"LaTeX Kommando Modus","keyboard.tooltip.numeric":"Numeresch","keyboard.tooltip.alphabetic":"Réimesch Bréiwer","tooltip.copy to clipboard":"Kopéiert op Clipboard","tooltip.redo":"Nees nei maachen","tooltip.toggle virtual keyboard":"Wiesselt Virtuell Tastatur","tooltip.undo":"Undoen","menu.insert matrix":"Matrix asetzen","menu.insert vector":"Insert Vector","submenu.array.matrix delimiters":"Matrix Ofgrenzer","menu.array.add row above":"Dobäizemaachen Rei No","menu.array.add row below":"Füügt Rei vir","menu.array.add column after":"Dobäizemaachen Kolonn No","menu.array.add column before":"Kolonn derbäi Virun","menu.array.delete row":"Rad läschen","menu.array.delete rows":"Läscht Ausgewielte Reien","menu.array.delete column":"Läscht Kolonn","menu.array.delete columns":"Läscht Ausgewielte Kolonnen","submenu.array.insert separator":"Insert Separator","menu.insert table":"Dësch anzeginn","submenu.table style":"Dësch Style"},nl:{"keyboard.tooltip.functions":"Functies","keyboard.tooltip.symbols":"Symbolen","keyboard.tooltip.greek":"Griekse letters","keyboard.tooltip.command":"LaTeX commando mode","keyboard.tooltip.numeric":"Numeriek","keyboard.tooltip.alphabetic":"Romeinse letters","tooltip.copy to clipboard":"Kopiëren naar klembord","tooltip.redo":"Opnieuw","tooltip.toggle virtual keyboard":"Schakel naar virtueel toetsenbord","tooltip.undo":"Ongedaan maken","menu.insert matrix":"Matrix invoegen","menu.insert vector":"Vector invoegen","submenu.array.matrix delimiters":"Matrixscheidingstekens","menu.array.add row above":"Rij toevoegen na","menu.array.add row below":"Rij toevoegen eerder","menu.array.add column after":"Kolom toevoegen na","menu.array.add column before":"Kolom toevoegen voor","menu.array.delete row":"Verwijder rij","menu.array.delete rows":"Geselecteerde rijen verwijderen","menu.array.delete column":"Kolom verwijderen","menu.array.delete columns":"Geselecteerde kolommen verwijderen","submenu.array.insert separator":"Scheidingsteken invoegen","menu.insert table":"Tabel invoegen","submenu.table style":"Tabelstijl"},no:{"keyboard.tooltip.functions":"Funksjoner","keyboard.tooltip.symbols":"Symboler","keyboard.tooltip.greek":"Greske bokstaver","keyboard.tooltip.command":"LaTeX kommandomodus","keyboard.tooltip.numeric":"Numerisk","keyboard.tooltip.alphabetic":"Romerske bokstaver","tooltip.copy to clipboard":"Kopiere til utklippstavle","tooltip.redo":"Gjøre om","tooltip.toggle virtual keyboard":"Bytt virtuelt tastatur","tooltip.undo":"Angre","menu.insert matrix":"Sett inn matrise","menu.insert vector":"Sett inn vektor","submenu.array.matrix delimiters":"Matrix avgrensere","menu.array.add row above":"Legg til rad etter","menu.array.add row below":"Legg til rad før","menu.array.add column after":"Legg til kolonne etter","menu.array.add column before":"Legg til kolonne før","menu.array.delete row":"Slett rad","menu.array.delete rows":"Slett valgte rader","menu.array.delete column":"Slett kolonne","menu.array.delete columns":"Slett valgte kolonner","submenu.array.insert separator":"Sett inn skilletegn","menu.insert table":"Sett inn tabell","submenu.table style":"Tabellstil"},mk:{"keyboard.tooltip.functions":"Функции","keyboard.tooltip.symbols":"Симболи","keyboard.tooltip.greek":"Грчки букви","keyboard.tooltip.command":"Режим на команда во латекс","keyboard.tooltip.numeric":"Нумерички","keyboard.tooltip.alphabetic":"Римски писма","tooltip.copy to clipboard":"Копирајте во клипборд","tooltip.redo":"Повторно","tooltip.toggle virtual keyboard":"Вклучете ја виртуелната тастатура","tooltip.undo":"Врати","menu.insert matrix":"Вметнете матрица","menu.insert vector":"Вметни вектор","submenu.array.matrix delimiters":"Разграничувачи на матрица","menu.array.add row above":"Додадете ред после","menu.array.add row below":"Додади ред пред тоа","menu.array.add column after":"Додадете колона после","menu.array.add column before":"Додадете колона пред тоа","menu.array.delete row":"Избриши го редот","menu.array.delete rows":"Избришете ги избраните редови","menu.array.delete column":"Избриши ја колоната","menu.array.delete columns":"Избриши ја колоната","submenu.array.insert separator":"Вметнете сепаратор","menu.insert table":"Вметни табела","submenu.table style":"Табела стил"},pl:{"keyboard.tooltip.functions":"Funkcje","keyboard.tooltip.symbols":"Symbolika","keyboard.tooltip.greek":"Litery greckie","keyboard.tooltip.command":"Tryb poleceń LaTeX","keyboard.tooltip.numeric":"Numeryczne","keyboard.tooltip.alphabetic":"Litery rzymskie","tooltip.copy to clipboard":"Kopiuj do Schowka","tooltip.redo":"Przywróć","tooltip.toggle virtual keyboard":"Przełącz wirtualną klawiaturę","tooltip.undo":"Cofnij","menu.insert matrix":"Wstaw macierz","menu.insert vector":"Wstaw wektor","submenu.array.matrix delimiters":"Ograniczniki macierzy","menu.array.add row above":"Dodaj wiersz po","menu.array.add row below":"Dodaj wiersz przed","menu.array.add column after":"Dodaj kolumnę po","menu.array.add column before":"Dodaj kolumnę przed","menu.array.delete row":"Usuń wiersz","menu.array.delete rows":"Usuń wybrane wiersze","menu.array.delete column":"Usuń kolumnę","menu.array.delete columns":"Usuń wybrane kolumny","submenu.array.insert separator":"Wstaw separator","menu.insert table":"Wypełnij tabelę","submenu.table style":"Styl tabelę"},pt:{"keyboard.tooltip.functions":"Functions","keyboard.tooltip.symbols":"Símbolos","keyboard.tooltip.greek":"Letras gregas","keyboard.tooltip.command":"Modo de Comando LaTeX","keyboard.tooltip.numeric":"Numérico","keyboard.tooltip.alphabetic":"Letras romanas","tooltip.copy to clipboard":"Copiar para área de transferência","tooltip.redo":"Refazer","tooltip.toggle virtual keyboard":"Alternar teclado virtual","tooltip.undo":"Desfazer","menu.insert matrix":"Inserir Matriz","menu.insert vector":"Inserir vetor","submenu.array.matrix delimiters":"Delimitadores de matriz","menu.array.add row above":"Adicionar linha depois","menu.array.add row below":"Adicionar linha antes","menu.array.add column after":"Adicionar coluna depois","menu.array.add column before":"Adicionar coluna antes","menu.array.delete row":"Excluir linha","menu.array.delete rows":"Excluir linhas selecionadas","menu.array.delete column":"Apagar Coluna","menu.array.delete columns":"Excluir Colunas Selecionadas","submenu.array.insert separator":"Inserir Separador","menu.insert table":"Insira a tabela","submenu.table style":"Estilo tabela"},ro:{"keyboard.tooltip.functions":"Funcții","keyboard.tooltip.symbols":"Simboluri","keyboard.tooltip.greek":"Scrisori grecești","keyboard.tooltip.command":"Modul de comandă latex","keyboard.tooltip.numeric":"Numeric","keyboard.tooltip.alphabetic":"Scrisori romane","tooltip.copy to clipboard":"Copiați în clipboard","tooltip.redo":"A reface","tooltip.toggle virtual keyboard":"Comutați tastatura virtuală","tooltip.undo":"Anula","menu.insert matrix":"Introduceți Matrix","menu.insert vector":"Inserați Vector","submenu.array.matrix delimiters":"Delimitatori de matrice","menu.array.add row above":"Adăugați rândul după","menu.array.add row below":"Adăugați rândul înainte","menu.array.add column after":"Adăugați o coloană după","menu.array.add column before":"Adăugați o coloană înainte","menu.array.delete row":"Ștergeți rândul","menu.array.delete rows":"Ștergeți rândurile selectate","menu.array.delete column":"Ștergeți coloana","menu.array.delete columns":"Ștergeți coloanele selectate","submenu.array.insert separator":"Introduceți separatorul","menu.insert table":"Introduceți tabelul","submenu.table style":"Table style"},ru:{"keyboard.tooltip.functions":"Функции","keyboard.tooltip.symbols":"Символы","keyboard.tooltip.greek":"Греческие буквы","keyboard.tooltip.command":"Режим командной строки Латекс","keyboard.tooltip.numeric":"числовой","keyboard.tooltip.alphabetic":"Латинские буквы","tooltip.copy to clipboard":"Скопировать в буфер обмена","tooltip.redo":"переделывать","tooltip.toggle virtual keyboard":"Переключить виртуальную клавиатуру","tooltip.undo":"расстегивать","menu.insert matrix":"Вставить матрицу","menu.insert vector":"Вставить вектор","submenu.array.matrix delimiters":"Матричные разделители","menu.array.add row above":"Добавить строку после","menu.array.add row below":"Добавить строку перед","menu.array.add column after":"Добавить столбец после","menu.array.add column before":"Добавить столбец перед","menu.array.delete row":"Удалить строку","menu.array.delete rows":"Удалить выбранные строки","menu.array.delete column":"Удалить столбец","menu.array.delete columns":"Удалить выбранные столбцы","submenu.array.insert separator":"Вставить разделитель","menu.insert table":"Вставить таблицу","submenu.table style":"Табличный стиль"},sk:{"keyboard.tooltip.functions":"Functions","keyboard.tooltip.symbols":"Symboly","keyboard.tooltip.greek":"Grécke listy","keyboard.tooltip.command":"Príkazový režim LaTeX","keyboard.tooltip.numeric":"Numerické","keyboard.tooltip.alphabetic":"Rímske listy","tooltip.copy to clipboard":"Skopírovať do schránky","tooltip.redo":"Znova","tooltip.toggle virtual keyboard":"Prepnúť virtuálnu klávesnicu","tooltip.undo":"Vrátenie späť","menu.insert matrix":"Vložte maticu","menu.insert vector":"Vložte vektor","submenu.array.matrix delimiters":"Oddeľovače matíc","menu.array.add row above":"Pridajte riadok za","menu.array.add row below":"Pridajte riadok pred","menu.array.add column after":"Pridať stĺpec za","menu.array.add column before":"Pridajte stĺpec predtým","menu.array.delete row":"Odstrániť riadok","menu.array.delete rows":"Odstrániť vybraté riadky","menu.array.delete column":"Odstrániť stĺpec","menu.array.delete columns":"Odstrániť vybraté stĺpce","submenu.array.insert separator":"Vložte oddeľovač","menu.insert table":"Vložte tabuľku","submenu.table style":"Štýl tabuľky"},sl:{"keyboard.tooltip.functions":"Funkcije","keyboard.tooltip.symbols":"Simboli","keyboard.tooltip.greek":"Grška pisma","keyboard.tooltip.command":"Ukazni način LaTeX","keyboard.tooltip.numeric":"Številsko","keyboard.tooltip.alphabetic":"Rimska pisma","tooltip.copy to clipboard":"Kopirati v odložišče","tooltip.redo":"Ponovi","tooltip.toggle virtual keyboard":"Preklop navidezne tipkovnice","tooltip.undo":"Razveljavi","menu.insert matrix":"Vstavi matrico","menu.insert vector":"Vstavi vektor","submenu.array.matrix delimiters":"Matrični ločevalniki","menu.array.add row above":"Dodaj vrstico po","menu.array.add row below":"Dodaj vrstico prej","menu.array.add column after":"Dodaj stolpec po","menu.array.add column before":"Dodaj stolpec prej","menu.array.delete row":"Izbriši vrstico","menu.array.delete rows":"Izbriši izbrane vrstice","menu.array.delete column":"Izbriši stolpec","menu.array.delete columns":"Izbriši izbrane stolpce","submenu.array.insert separator":"Vstavi ločilo","menu.insert table":"Vstavi tabelo","submenu.table style":"Tabela slog"},sq:{"keyboard.tooltip.functions":"Funksione","keyboard.tooltip.symbols":"Simbolet","keyboard.tooltip.greek":"Letrat Greke","keyboard.tooltip.command":"Modaliteti i komandës latex","keyboard.tooltip.numeric":"Numerike","keyboard.tooltip.alphabetic":"Letrat romake","tooltip.copy to clipboard":"Kopjoni në Clipboard","tooltip.redo":"Riparo","tooltip.toggle virtual keyboard":"Aktivizo tastierën virtuale","tooltip.undo":"Zhbëj","menu.insert matrix":"Vendosni Matricën","menu.insert vector":"Vendos vektorin","submenu.array.matrix delimiters":"Përcaktuesit e matricës","menu.array.add row above":"Shto Rreshtin Pas","menu.array.add row below":"Shto Rreshtin Para","menu.array.add column after":"Shto kolonën pas","menu.array.add column before":"Shto kolonën para","menu.array.delete row":"Fshi Rreshtin","menu.array.delete rows":"Fshi rreshtat e zgjedhur","menu.array.delete column":"Fshi kolonën","menu.array.delete columns":"Fshi kolonat e zgjedhura","submenu.array.insert separator":"Vendos Ndarësin","menu.insert table":"Vendos tabelën","submenu.table style":"Stili tabelën"},sr:{"keyboard.tooltip.functions":"Функције","keyboard.tooltip.symbols":"Симболи","keyboard.tooltip.greek":"Греек Леттерс","keyboard.tooltip.command":"ЛаТеКс командни режим","keyboard.tooltip.numeric":"Нумерички","keyboard.tooltip.alphabetic":"Римска писма","tooltip.copy to clipboard":"Копирајте у међуспремник","tooltip.redo":"Понови","tooltip.toggle virtual keyboard":"Укључи / искључи виртуелну тастатуру","tooltip.undo":"Опозови","menu.insert matrix":"Уметни матрицу","menu.insert vector":"Уметни вектор","submenu.array.matrix delimiters":"Матрик Делимитерс","menu.array.add row above":"Додај ред после","menu.array.add row below":"Додај ред пре","menu.array.add column after":"Додај колону после","menu.array.add column before":"Додај колону пре","menu.array.delete row":"Избриши ред","menu.array.delete rows":"Избриши изабране редове","menu.array.delete column":"Избриши колону","menu.array.delete columns":"Избриши изабране колоне","submenu.array.insert separator":"Уметни сепаратор","menu.insert table":"Убаци табелу","submenu.table style":"Табеларни стил"},sv:{"keyboard.tooltip.functions":"Funktioner","keyboard.tooltip.symbols":"Symboler","keyboard.tooltip.greek":"Grekiska bokstäver","keyboard.tooltip.command":"LaTeX kommandoläge","keyboard.tooltip.numeric":"Numerisk","keyboard.tooltip.alphabetic":"Romerska bokstäver","tooltip.copy to clipboard":"Kopiera till Urklipp","tooltip.redo":"Göra om","tooltip.toggle virtual keyboard":"Växla virtuellt tangentbord","tooltip.undo":"Ångra","menu.insert matrix":"Sätt in matris","menu.insert vector":"Infoga vektor","submenu.array.matrix delimiters":"Matrisavgränsare","menu.array.add row above":"Lägg till rad efter","menu.array.add row below":"Lägg till rad före","menu.array.add column after":"Lägg till kolumn efter","menu.array.add column before":"Lägg till kolumn före","menu.array.delete row":"Radera rad","menu.array.delete rows":"Ta bort valda rader","menu.array.delete column":"Ta bort kolumn","menu.array.delete columns":"Ta bort valda kolumner","submenu.array.insert separator":"Sätt i separator","menu.insert table":"Infoga tabell","submenu.table style":"Tabellstil"},th:{"keyboard.tooltip.functions":"ฟังก์ชั่น","keyboard.tooltip.symbols":"สัญลักษณ์","keyboard.tooltip.greek":"อักษรกรีก","keyboard.tooltip.command":"โหมดคำสั่ง น้ำยาง","keyboard.tooltip.numeric":"ตัวเลข","keyboard.tooltip.alphabetic":"อักษรโรมัน","tooltip.copy to clipboard":"คัดลอกไปที่คลิปบอร์ด","tooltip.redo":"ทำซ้ำ","tooltip.toggle virtual keyboard":"สลับแป้นพิมพ์เสมือน","tooltip.undo":"เลิกทำ","menu.insert matrix":"แทรกเมทริกซ์","menu.insert vector":"แทรกเวกเตอร์","submenu.array.matrix delimiters":"ตัวคั่นเมทริกซ์","menu.array.add row above":"เพิ่มแถวหลัง","menu.array.add row below":"เพิ่มแถวก่อน","menu.array.add column after":"เพิ่มคอลัมน์หลัง","menu.array.add column before":"เพิ่มคอลัมน์ก่อน","menu.array.delete row":"ลบแถว","menu.array.delete rows":"ลบแถวที่เลือก","menu.array.delete column":"ลบคอลัมน์","menu.array.delete columns":"ลบคอลัมน์ที่เลือก","submenu.array.insert separator":"ตัวคั่นแทรก","menu.insert table":"แทรกตาราง","submenu.table style":"สไตล์ตาราง"},tr:{"keyboard.tooltip.functions":"Fonksiyonlar","keyboard.tooltip.symbols":"Semboller","keyboard.tooltip.greek":"Yunan harfleri","keyboard.tooltip.command":"LaTeX Komut Modu","keyboard.tooltip.numeric":"Sayısal","keyboard.tooltip.alphabetic":"Roma Harfleri","tooltip.copy to clipboard":"Panoya kopyala","tooltip.redo":"Yeniden yap","tooltip.toggle virtual keyboard":"Sanal Klavyeyi Aç/Kapat","tooltip.undo":"Geri alma","menu.insert matrix":"Matris Ekle","menu.insert vector":"Vektör Ekle","submenu.array.matrix delimiters":"Matris Sınırlayıcılar","menu.array.add row above":"Satırdan Sonra Ekle","menu.array.add row below":"Önce Satır Ekle","menu.array.add column after":"Sonra Sütun Ekle","menu.array.add column before":"Önce Sütun Ekle","menu.array.delete row":"Sırayı sil","menu.array.delete rows":"Seçili Satırları Sil","menu.array.delete column":"Sütunu Sil","menu.array.delete columns":"Seçili Sütunları Sil","submenu.array.insert separator":"Ayırıcı Ekle","menu.insert table":"Tablo Ekle","submenu.table style":"Tablo Stili"},uk:{"keyboard.tooltip.functions":"Функції","keyboard.tooltip.symbols":"Символи","keyboard.tooltip.greek":"Грецькі літери","keyboard.tooltip.command":"Командний режим латексу","keyboard.tooltip.numeric":"Числовий","keyboard.tooltip.alphabetic":"Римські літери","tooltip.copy to clipboard":"Копіювати в буфер обміну","tooltip.redo":"Повторити","tooltip.toggle virtual keyboard":"Переключити віртуальну клавіатуру","tooltip.undo":"Скасувати","menu.insert matrix":"Вставити матрицю","menu.insert vector":"Вставити вектор","submenu.array.matrix delimiters":"Матричні роздільники","menu.array.add row above":"Додати рядок після","menu.array.add row below":"Додати рядок до","menu.array.add column after":"Додати стовпець після","menu.array.add column before":"Додати стовпець перед","menu.array.delete row":"Видалити рядок","menu.array.delete rows":"Видалити вибрані рядки","menu.array.delete column":"Видалити стовпець","menu.array.delete columns":"Видалити вибрані стовпці","submenu.array.insert separator":"Вставте роздільник","menu.insert table":"Вставити таблицю","submenu.table style":"Стиль таблиці"},vi:{"keyboard.tooltip.functions":"Chức năng","keyboard.tooltip.symbols":"Ký hiệu","keyboard.tooltip.greek":"Chữ Hy Lạp","keyboard.tooltip.command":"Chế độ lệnh LaTeX","keyboard.tooltip.numeric":"Số","keyboard.tooltip.alphabetic":"Chữ cái La mã","tooltip.copy to clipboard":"Sao chép vào clipboard","tooltip.redo":"Làm lại","tooltip.toggle virtual keyboard":"Chuyển đổi bàn phím ảo","tooltip.undo":"Hoàn tác","menu.insert matrix":"Chèn ma trận","menu.insert vector":"Insert Vector","submenu.array.matrix delimiters":"Dấu phân cách ma trận","menu.array.add row above":"Thêm hàng sau","menu.array.add row below":"Thêm hàng trước","menu.array.add column after":"Thêm cột sau","menu.array.add column before":"Thêm cột trước","menu.array.delete row":"Xóa hàng","menu.array.delete rows":"Xóa hàng đã chọn","menu.array.delete column":"Xóa cột","menu.array.delete columns":"Xóa các cột đã chọn","submenu.array.insert separator":"Chèn dấu phân cách","menu.insert table":"Chèn bảng","submenu.table style":"Kiểu bảng"},zh_cn:{"keyboard.tooltip.functions":"职能","keyboard.tooltip.symbols":"符号","keyboard.tooltip.greek":"希腊字母","keyboard.tooltip.command":"乳胶 命令模式","keyboard.tooltip.numeric":"数字","keyboard.tooltip.alphabetic":"罗马字母","tooltip.copy to clipboard":"复制到剪贴板","tooltip.redo":"重做","tooltip.toggle virtual keyboard":"切换虚拟键盘","tooltip.undo":"撤消","menu.insert matrix":"插入矩阵","menu.insert vector":"插入向量","submenu.array.matrix delimiters":"矩阵分隔符","menu.array.add row above":"在后面添加行","menu.array.add row below":"在前面添加行","menu.array.add column after":"在后面添加列r","menu.array.add column before":"在前面添加列","menu.array.delete row":"删除行","menu.array.delete rows":"删除选定行","menu.array.delete column":"删除列","menu.array.delete columns":"删除选定的列","submenu.array.insert separator":"插入分隔符","menu.insert table":"插入表格","submenu.table style":"表格样式"},zh_tw:{"keyboard.tooltip.functions":"職能","keyboard.tooltip.symbols":"符號","keyboard.tooltip.greek":"希臘字母","keyboard.tooltip.command":"乳膠命令模式","keyboard.tooltip.numeric":"數字","keyboard.tooltip.alphabetic":"羅馬字母","tooltip.copy to clipboard":"複製到剪貼板","tooltip.redo":"重做","tooltip.toggle virtual keyboard":"切換虛擬鍵盤","tooltip.undo":"撤消","menu.insert matrix":"插入矩陣","menu.insert vector":"插入向量","submenu.array.matrix delimiters":"矩陣分隔符","menu.array.add row above":"在後面添加行","menu.array.add row below":"在前面添加行","menu.array.add column after":"在後面添加列","menu.array.add column before":"在前面添加列","menu.array.delete row":"刪除行","menu.array.delete rows":"刪除選定行","menu.array.delete column":"刪除列","menu.array.delete columns":"刪除選定的列","submenu.array.insert separator":"插入分隔符","menu.insert table":"插入表格","submenu.table style":"表格樣式"}},_locale:"",get locale(){return l10n._locale||(l10n._locale=isBrowser()?navigator.language.slice(0,5):"en"),l10n._locale},set locale(value){l10n._locale=value},merge:function(locale,strings){if(locale&&strings){var savedLocale=l10n._locale;l10n.locale=locale,l10n.strings[locale]=__spreadValues(__spreadValues({},l10n.strings[locale]),strings),l10n.locale=savedLocale}else if(locale&&!strings)for(var _i2=0,_Object$keys=Object.keys(locale);_i2<_Object$keys.length;_i2++){var l=_Object$keys[_i2];l10n.merge(l,locale[l])}}};function localize(key){if(void 0!==key){var language=l10n.locale.slice(0,2),result="";if(l10n.strings[l10n.locale]&&(result=l10n.strings[l10n.locale][key]),!result&&l10n.strings[language]&&(result=l10n.strings[language][key]),result||(result=l10n.strings.en[key]),result)return result}}var MATHEMATICA_COLORS={m0:"#3F3D99",m1:"#993D71",m2:"#998B3D",m3:"#3D9956",m4:"#3D5A99",m5:"#993D90",m6:"#996D3D",m7:"#43993D",m8:"#3D7999",m9:"#843D99"},MATLAB_COLORS={blue:"#0072BD",orange:"#D95319",yellow:"#EDB120",purple:"#7E2F8E",green:"#77AC30",cyan:"#4DBEEE",red:"#A2142F"},BACKGROUND_COLORS={red:"#fbbbb6",orange:"#ffe0c2",yellow:"#fff1c2",lime:"#d0e8b9",green:"#bceac4",teal:"#b9f1f1",blue:"#b6d9fb",indigo:"#d1c2f0",purple:"#e3baf8",magenta:"#f9c8e0",black:"#353535","dark-grey":"#8C8C8C",grey:"#D0D0D0","light-grey":"#F0F0F0",white:"#ffffff"},FOREGROUND_COLORS={red:"#d7170b",orange:"#fe8a2b",yellow:"#ffc02b",lime:"#63b215",green:"#21ba3a",teal:"#17cfcf",blue:"#0d80f2",indigo:"#63c",purple:"#a219e6",magenta:"#eb4799",black:"#000","dark-grey":"#666",grey:"#A6A6A6","light-grey":"#d4d5d2",white:"#ffffff"},DVIPS_TO_CHROMATIC={Red:"red",Orange:"orange",Yellow:"yellow",LimeGreen:"lime",Green:"green",TealBlue:"teal",Blue:"blue",Violet:"indigo",Purple:"purple",Magenta:"magenta",Black:"black",Gray:"grey",White:"white"},DVIPS_COLORS={Apricot:"#FBB982",Aquamarine:"#00B5BE",Bittersweet:"#C04F17",Black:"#221E1F",Blue:"#2D2F92",BlueGreen:"#00B3B8",BlueViolet:"#473992",BrickRed:"#B6321C",Brown:"#792500",BurntOrange:"#F7921D",CadetBlue:"#74729A",CarnationPink:"#F282B4",Cerulean:"#00A2E3",CornflowerBlue:"#41B0E4",Cyan:"#00AEEF",Dandelion:"#FDBC42",DarkOrchid:"#A4538A",Emerald:"#00A99D",ForestGreen:"#009B55",Fuchsia:"#8C368C",Goldenrod:"#FFDF42",Gray:"#949698",Green:"#00A64F",GreenYellow:"#DFE674",JungleGreen:"#00A99A",Lavender:"#F49EC4",Limegreen:"#8DC73E",Magenta:"#EC008C",Mahogany:"#A9341F",Maroon:"#AF3235",Melon:"#F89E7B",MidnightBlue:"#006795",Mulberry:"#A93C93",NavyBlue:"#006EB8",OliveGreen:"#3C8031",Orange:"#F58137",OrangeRed:"#ED135A",Orchid:"#AF72B0",Peach:"#F7965A",Periwinkle:"#7977B8",PineGreen:"#008B72",Plum:"#92268F",ProcessBlue:"#00B0F0",Purple:"#99479B",RawSienna:"#974006",Red:"#ED1B23",RedOrange:"#F26035",RedViolet:"#A1246B",Rhodamine:"#EF559F",RoyalBlue:"#0071BC",RoyalPurple:"#613F99",RubineRed:"#ED017D",Salmon:"#F69289",SeaGreen:"#3FBC9D",Sepia:"#671800",SkyBlue:"#46C5DD",SpringGreen:"#C6DC67",Tan:"#DA9D76",TealBlue:"#00AEB3",Thistle:"#D883B7",Turquoise:"#00B4CE",Violet:"#58429B",VioletRed:"#EF58A0",White:"#FFFFFF",WildStrawberry:"#EE2967",Yellow:"#FFF200",YellowGreen:"#98CC70",YellowOrange:"#FAA21A"};function defaultColorMap(s){var _a3,_b3,_c2,_d2,_e,_f,baseRed,baseGreen,baseBlue,colorSpec=s.split("!"),red=255,green=255,blue=255,mix=-1,complementary=colorSpec.length>0&&colorSpec[0].startsWith("-");complementary&&(colorSpec[0]=colorSpec[0].slice(1));for(var i=0;i<colorSpec.length;i++){baseRed=red,baseGreen=green,baseBlue=blue;var colorName=null==(_a3=colorSpec[i].trim().match(/^([A-Za-z\d]+)/))?void 0:_a3[1],lcColorName=null==colorName?void 0:colorName.toLowerCase(),color=colorName&&null!=(_f=null!=(_e=null!=(_d2=null!=(_c2=null!=(_b3=FOREGROUND_COLORS[lcColorName])?_b3:FOREGROUND_COLORS[DVIPS_TO_CHROMATIC[colorName]])?_c2:MATLAB_COLORS[colorName])?_d2:DVIPS_COLORS[colorName])?_e:MATHEMATICA_COLORS[colorName])?_f:colorSpec[i].trim(),m=color.match(/^#([\da-f]{2})([\da-f]{2})([\da-f]{2})$/i);if((null==m?void 0:m[1])&&m[2]&&m[3])red=Math.max(0,Math.min(255,Number.parseInt(m[1],16))),green=Math.max(0,Math.min(255,Number.parseInt(m[2],16))),blue=Math.max(0,Math.min(255,Number.parseInt(m[3],16)));else if(null==(m=color.match(/^#([\da-f]{3})$/i))?void 0:m[1]){var r1=Number.parseInt(m[1][0],16),g1=Number.parseInt(m[1][1],16),b1=Number.parseInt(m[1][2],16);red=Math.max(0,Math.min(255,16*r1+r1)),green=Math.max(0,Math.min(255,16*g1+g1)),blue=Math.max(0,Math.min(255,16*b1+b1))}else{if(!((null==(m=color.match(/^rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)$/i))?void 0:m[1])&&m[2]&&m[3]))return;red=Math.max(0,Math.min(255,Number.parseInt(m[1]))),green=Math.max(0,Math.min(255,Number.parseInt(m[2]))),blue=Math.max(0,Math.min(255,Number.parseInt(m[3])))}mix>=0&&(red=(1-mix)*red+mix*baseRed,green=(1-mix)*green+mix*baseGreen,blue=(1-mix)*blue+mix*baseBlue,mix=-1),i+1<colorSpec.length&&(mix=Math.max(0,Math.min(100,Number.parseInt(colorSpec[++i])))/100)}return mix>=0&&(red=mix*red+(1-mix)*baseRed,green=mix*green+(1-mix)*baseGreen,blue=mix*blue+(1-mix)*baseBlue),complementary&&(red=255-red,green=255-green,blue=255-blue),"#"+("00"+Math.round(red).toString(16)).slice(-2)+("00"+Math.round(green).toString(16)).slice(-2)+("00"+Math.round(blue).toString(16)).slice(-2)}function defaultBackgroundColorMap(s){var _a3,_b3;return s=s.trim(),null!=(_b3=null!=(_a3=BACKGROUND_COLORS[s.toLowerCase()])?_a3:BACKGROUND_COLORS[DVIPS_TO_CHROMATIC[s]])?_b3:defaultColorMap(s)}function hueToRgbChannel(t1,t2,hue){return hue<0&&(hue+=6),hue>=6&&(hue-=6),hue<1?(t2-t1)*hue+t1:hue<3?t2:hue<4?(t2-t1)*(4-hue)+t1:t1}function clampByte(v){return v<0?0:v>255?255:Math.round(v)}function highlight(color){var rgb=function(hex){var result;if(hex&&"#"===hex[0])return(hex=hex.slice(1)).length<=4?(result={r:parseInt(hex[0]+hex[0],16),g:parseInt(hex[1]+hex[1],16),b:parseInt(hex[2]+hex[2],16)},4===hex.length&&(result.a=parseInt(hex[3]+hex[3],16)/255)):(result={r:parseInt(hex[0]+hex[1],16),g:parseInt(hex[2]+hex[3],16),b:parseInt(hex[4]+hex[5],16)},8===hex.length&&(result.a=parseInt(hex[6]+hex[7],16)/255)),result&&void 0===result.a&&(result.a=1),result}(color);if(!rgb)return color;var _rgbToHsl=function(rgb){var r=rgb.r,g=rgb.g,b=rgb.b;r/=255,g/=255,b/=255;var h,min=Math.min(r,g,b),max=Math.max(r,g,b),delta=max-min;max===min?h=0:r===max?h=(g-b)/delta:g===max?h=2+(b-r)/delta:b===max&&(h=4+(r-g)/delta),(h=Math.min(60*h,360))<0&&(h+=360);var l=(min+max)/2;return{h:h,s:max===min?0:l<=.5?delta/(max+min):delta/(2-max-min),l:l}}(rgb),h=_rgbToHsl.h,s=_rgbToHsl.s,l=_rgbToHsl.l;return function(rgb){var r=rgb.r,g=rgb.g,b=rgb.b,hexString=((1<<24)+(clampByte(r)<<16)+(clampByte(g)<<8)+clampByte(b)).toString(16).slice(1);return hexString[0]===hexString[1]&&hexString[2]===hexString[3]&&hexString[4]===hexString[5]&&hexString[6]===hexString[7]&&(hexString=hexString[0]+hexString[2]+hexString[4]),"#"+hexString}(function(hsl){var _ref=[hsl.h,hsl.s,hsl.l],hue=_ref[0],sat=_ref[1],light=_ref[2];hue=(hue+360)%360/60,light=Math.max(0,Math.min(light,1)),sat=Math.max(0,Math.min(sat,1));var t2=light<=.5?light*(sat+1):light+sat-light*sat,t1=2*light-t2;return{r:Math.round(255*hueToRgbChannel(t1,t2,hue+2)),g:Math.round(255*hueToRgbChannel(t1,t2,hue)),b:Math.round(255*hueToRgbChannel(t1,t2,hue-2))}}({h:h,s:s+=.1,l:l-=.1}))}var MATH_LETTER_EXCEPTIONS={119893:8462,119965:8492,119968:8496,119969:8497,119971:8459,119972:8464,119975:8466,119976:8499,119981:8475,119994:8495,119996:8458,120004:8500,120070:8493,120075:8460,120076:8465,120085:8476,120093:8488,120122:8450,120127:8461,120133:8469,120135:8473,120136:8474,120137:8477,120145:8484},MATH_UNICODE_BLOCKS=[{start:119808,len:26,offset:65,style:"bold"},{start:119834,len:26,offset:97,style:"bold"},{start:119860,len:26,offset:65,style:"italic"},{start:119886,len:26,offset:97,style:"italic"},{start:119912,len:26,offset:65,style:"bolditalic"},{start:119938,len:26,offset:97,style:"bolditalic"},{start:119964,len:26,offset:65,variant:"script"},{start:119990,len:26,offset:97,variant:"script"},{start:120016,len:26,offset:65,variant:"script",style:"bold"},{start:120042,len:26,offset:97,variant:"script",style:"bold"},{start:120068,len:26,offset:65,variant:"fraktur"},{start:120094,len:26,offset:97,variant:"fraktur"},{start:120172,len:26,offset:65,variant:"fraktur",style:"bold"},{start:120198,len:26,offset:97,variant:"fraktur",style:"bold"},{start:120120,len:26,offset:65,variant:"double-struck"},{start:120146,len:26,offset:97,variant:"double-struck"},{start:120224,len:26,offset:65,variant:"sans-serif"},{start:120250,len:26,offset:97,variant:"sans-serif"},{start:120276,len:26,offset:65,variant:"sans-serif",style:"bold"},{start:120302,len:26,offset:97,variant:"sans-serif",style:"bold"},{start:120328,len:26,offset:65,variant:"sans-serif",style:"italic"},{start:120354,len:26,offset:97,variant:"sans-serif",style:"italic"},{start:120380,len:26,offset:65,variant:"sans-serif",style:"bolditalic"},{start:120406,len:26,offset:97,variant:"sans-serif",style:"bolditalic"},{start:120432,len:26,offset:65,variant:"monospace"},{start:120458,len:26,offset:97,variant:"monospace"},{start:120488,len:25,offset:913,style:"bold"},{start:120514,len:25,offset:945,style:"bold"},{start:120546,len:25,offset:913,style:"italic"},{start:120572,len:25,offset:945,style:"italic"},{start:120604,len:25,offset:913,style:"bolditalic"},{start:120630,len:25,offset:945,style:"bolditalic"},{start:120662,len:25,offset:913,variant:"sans-serif",style:"bold"},{start:120688,len:25,offset:945,variant:"sans-serif",style:"bold"},{start:120720,len:25,offset:913,variant:"sans-serif",style:"bolditalic"},{start:120746,len:25,offset:945,variant:"sans-serif",style:"bolditalic"},{start:120782,len:10,offset:48,variant:"main",style:"bold"},{start:120792,len:10,offset:48,variant:"double-struck"},{start:120803,len:10,offset:48,variant:"sans-serif"},{start:120812,len:10,offset:48,variant:"sans-serif",style:"bold"},{start:120822,len:10,offset:48,variant:"monospace"}];function argAtoms(arg){return arg?Array.isArray(arg)?arg:"object"===_typeof(arg)&&"group"in arg?arg.group:[]:[]}var LETTER,LETTER_AND_DIGITS,_DEFAULT_MACROS,MATH_SYMBOLS={},REVERSE_MATH_SYMBOLS={60:"\\lt",62:"\\gt",111:"o",38:"\\&",123:"\\lbrace",125:"\\rbrace",91:"\\lbrack",93:"\\rbrack",58:"\\colon",160:"~",172:"\\neg",183:"\\cdot",188:"\\frac{1}{4}",189:"\\frac{1}{2}",190:"\\frac{3}{4}",8304:"^{0}",8305:"^{i}",185:"^{1}",178:"^{2}",179:"^{3}",8224:"\\dagger",8225:"\\ddagger",8230:"\\ldots",8308:"^{4}",8309:"^{5}",8310:"^{6}",8311:"^{7}",8312:"^{8}",8313:"^{9}",8314:"^{+}",8315:"^{-}",8316:"^{=}",8319:"^{n}",8320:"_{0}",8321:"_{1}",8322:"_{2}",8323:"_{3}",8324:"_{4}",8325:"_{5}",8326:"_{6}",8327:"_{7}",8328:"_{8}",8329:"_{9}",8330:"_{+}",8331:"_{-}",8332:"_{=}",8336:"_{a}",8337:"_{e}",8338:"_{o}",8339:"_{x}",8242:"\\prime",39:"\\prime",8592:"\\gets",8594:"\\to",9651:"\\triangle",9661:"\\triangledown",8715:"\\owns",8727:"\\ast",8739:"\\vert",8741:"\\Vert",8743:"\\land",8744:"\\lor",8901:"\\cdot",8904:"\\bowtie",8800:"\\ne",8804:"\\le",8805:"\\ge",8869:"\\bot",10231:"\\biconditional",10232:"\\impliedby",10233:"\\implies",10234:"\\iff",8450:"\\mathbb{C}",8469:"\\mathbb{N}",8473:"\\mathbb{P}",8474:"\\mathbb{Q}",8477:"\\mathbb{R}",8484:"\\mathbb{Z}",8461:"\\mathbb{H}",8476:"\\Re",8465:"\\Im",42:"\\ast",11036:"\\square",9633:"\\square",8720:"\\coprod",8716:"\\not\\ni",9671:"\\diamond",8846:"\\uplus",8851:"\\sqcap",8852:"\\sqcup",8768:"\\wr",8750:"\\oint",8226:"\\textbullet",8722:"-",978:"\\Upsilon"},LATEX_COMMANDS={},ENVIRONMENTS={},DEFAULT_MACROS={iff:"\\;⟺\\;",nicefrac:"^{#1}\\!\\!/\\!_{#2}",rd:"\\mathrm{d}",rD:"\\mathrm{D}",doubleStruckCapitalN:"\\mathbb{N}",doubleStruckCapitalR:"\\mathbb{R}",doubleStruckCapitalQ:"\\mathbb{Q}",doubleStruckCapitalZ:"\\mathbb{Z}",doubleStruckCapitalP:"\\mathbb{P}",scriptCapitalE:"\\mathscr{E}",scriptCapitalH:"\\mathscr{H}",scriptCapitalL:"\\mathscr{L}",gothicCapitalC:"\\mathfrak{C}",gothicCapitalH:"\\mathfrak{H}",gothicCapitalI:"\\mathfrak{I}",gothicCapitalR:"\\mathfrak{R}",imaginaryI:"\\mathrm{i}",imaginaryJ:"\\mathrm{j}",exponentialE:"\\mathrm{e}",differentialD:"\\mathrm{d}",capitalDifferentialD:"\\mathrm{D}",mathstrut:{def:"\\vphantom{(}",primitive:!0},tripledash:{def:"\\vphantom{-}\\raise{4mu}{\\mkern1.5mu\\rule{2mu}{1.5mu}\\mkern{2.25mu}\\rule{2mu}{1.5mu}\\mkern{2.25mu}\\rule{2mu}{1.5mu}\\mkern{2mu}}",expand:!0},"braket.sty":{package:{bra:"\\mathinner{\\langle{#1}|}",ket:"\\mathinner{|{#1}\\rangle}",braket:"\\mathinner{\\langle{#1}\\rangle}",set:"\\mathinner{\\lbrace #1 \\rbrace}",Bra:"\\left\\langle #1\\right|",Ket:"\\left|#1\\right\\rangle",Braket:"\\left\\langle{#1}\\right\\rangle",Set:"\\left\\lbrace #1 \\right\\rbrace"}},"amsmath.sty":{package:{varGamma:"\\mathit{\\Gamma}",varDelta:"\\mathit{\\Delta}",varTheta:"\\mathit{\\Theta}",varLambda:"\\mathit{\\Lambda}",varXi:"\\mathit{\\Xi}",varPi:"\\mathit{\\Pi}",varSigma:"\\mathit{\\Sigma}",varUpsilon:"\\mathit{\\Upsilon}",varPhi:"\\mathit{\\Phi}",varPsi:"\\mathit{\\Psi}",varOmega:"\\mathit{\\Omega}",pmod:{def:"\\quad(\\operatorname{mod}\\ #1)",args:1,expand:!1},mod:{def:"\\quad\\operatorname{mod}\\,\\,#1",args:1,expand:!1},bmod:{def:"\\;\\mathbin{\\operatorname{mod }}",expand:!1}},primitive:!0},"texvc.sty":{package:{darr:"\\downarrow",dArr:"\\Downarrow",Darr:"\\Downarrow",lang:"\\langle",rang:"\\rangle",uarr:"\\uparrow",uArr:"\\Uparrow",Uarr:"\\Uparrow",N:"\\mathbb{N}",R:"\\mathbb{R}",Z:"\\mathbb{Z}",alef:"\\aleph",alefsym:"\\aleph",Alpha:"\\mathrm{A}",Beta:"\\mathrm{B}",bull:"\\bullet",Chi:"\\mathrm{X}",clubs:"\\clubsuit",cnums:"\\mathbb{C}",Complex:"\\mathbb{C}",Dagger:"\\ddagger",diamonds:"\\diamondsuit",empty:"\\emptyset",Epsilon:"\\mathrm{E}",Eta:"\\mathrm{H}",exist:"\\exists",harr:"\\leftrightarrow",hArr:"\\Leftrightarrow",Harr:"\\Leftrightarrow",hearts:"\\heartsuit",image:"\\Im",infin:"\\infty",Iota:"\\mathrm{I}",isin:"\\in",Kappa:"\\mathrm{K}",larr:"\\leftarrow",lArr:"\\Leftarrow",Larr:"\\Leftarrow",lrarr:"\\leftrightarrow",lrArr:"\\Leftrightarrow",Lrarr:"\\Leftrightarrow",Mu:"\\mathrm{M}",natnums:"\\mathbb{N}",Nu:"\\mathrm{N}",Omicron:"\\mathrm{O}",plusmn:"\\pm",rarr:"\\rightarrow",rArr:"\\Rightarrow",Rarr:"\\Rightarrow",real:"\\Re",reals:"\\mathbb{R}",Reals:"\\mathbb{R}",Rho:"\\mathrm{P}",sdot:"\\cdot",sect:"\\S",spades:"\\spadesuit",sub:"\\subset",sube:"\\subseteq",supe:"\\supseteq",Tau:"\\mathrm{T}",thetasym:"\\vartheta",weierp:"\\wp",Zeta:"\\mathrm{Z}"},primitive:!1}},TEXT_SYMBOLS={" ":32,"\\#":35,"\\&":38,"\\$":36,"\\%":37,"-":45,"\\_":95,"\\euro":8364,"\\maltese":10016,"\\{":123,"\\}":125,"\\nobreakspace":160,"\\ldots":8230,"\\textellipsis":8230,"\\backslash":92,"`":8216,"'":8217,"``":8220,"''":8221,"\\degree":176,"\\textasciicircum":94,"\\textasciitilde":126,"\\textasteriskcentered":42,"\\textbackslash":92,"\\textbraceleft":123,"\\textbraceright":125,"\\textbullet":8226,"\\textdollar":36,"\\textsterling":163,"\\textdagger":8224,"\\textdaggerdbl":8225,"–":8211,"—":8212,"‘":8216,"’":8217,"“":8220,"”":8221,'"':8221,"\\ss":223,"\\ae":230,"\\oe":339,"\\AE":198,"\\OE":338,"\\O":216,"\\i":305,"\\j":567,"\\aa":229,"\\AA":197},COMMAND_MODE_CHARACTERS=/[\w!@*()-=+{}[\]\\';:?/.,~<>`|$%#&^" ]/;function newSymbol(symbol,value){var type=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"mord",variant=arguments.length>3?arguments[3]:void 0;void 0!==value&&(MATH_SYMBOLS[symbol]={definitionType:"symbol",type:type,variant:variant,codepoint:value},REVERSE_MATH_SYMBOLS[value]||(REVERSE_MATH_SYMBOLS[value]=symbol),TEXT_SYMBOLS[symbol]||(TEXT_SYMBOLS[symbol]=value))}function newSymbols(value,inType,inVariant){if("string"!=typeof value){var _step6,_iterator6=_createForOfIteratorHelper(value);try{for(_iterator6.s();!(_step6=_iterator6.n()).done;){var _step6$value=_slicedToArray(_step6.value,4),symbol=_step6$value[0],val=_step6$value[1],type=_step6$value[2],variant=_step6$value[3];newSymbol(symbol,val,null!=type?type:inType,null!=variant?variant:inVariant)}}catch(err){_iterator6.e(err)}finally{_iterator6.f()}}else for(var i=0;i<value.length;i++){var ch=value.charAt(i);newSymbol(ch,ch.codePointAt(0))}}function newSymbolRange(from,to){for(var i=from;i<=to;i++)newSymbol(String.fromCodePoint(i),i)}function parseParameterTemplateArgument(argTemplate){var type="auto",r=argTemplate.match(/:([^=]+)/);return r&&(type=r[1].trim()),type}function parseParameterTemplate(parameterTemplate){if(!parameterTemplate)return[];var result=[],parameters=parameterTemplate.split("]");if(parameters[0].startsWith("[")){result.push({isOptional:!0,type:parseParameterTemplateArgument(parameters[0].slice(1))});for(var i=1;i<=parameters.length;i++)result.push.apply(result,_toConsumableArray(parseParameterTemplate(parameters[i])))}else if((parameters=parameterTemplate.split("}"))[0].startsWith("{")){result.push({isOptional:!1,type:parseParameterTemplateArgument(parameters[0].slice(1))});for(var _i4=1;_i4<=parameters.length;_i4++)result.push.apply(result,_toConsumableArray(parseParameterTemplate(parameters[_i4])))}return result}function parseArgAsString(atoms){if(!atoms)return"";var _step7,result="",success=!0,_iterator7=_createForOfIteratorHelper(atoms);try{for(_iterator7.s();!(_step7=_iterator7.n()).done;){var atom=_step7.value;"string"==typeof atom.value?result+=atom.value:success=!1}}catch(err){_iterator7.e(err)}finally{_iterator7.f()}return success?result:""}function defineEnvironment(names,createAtom){"string"==typeof names&&(names=[names]);var _step8,def={tabular:!1,params:[],createAtom:createAtom},_iterator8=_createForOfIteratorHelper(names);try{for(_iterator8.s();!(_step8=_iterator8.n()).done;){var name=_step8.value;ENVIRONMENTS[name]=def}}catch(err){_iterator8.e(err)}finally{_iterator8.f()}}function defineTabularEnvironment(names,parameters,createAtom){"string"==typeof names&&(names=[names]);var _step9,data={tabular:!0,params:parseParameterTemplate(parameters),createAtom:createAtom},_iterator9=_createForOfIteratorHelper(names);try{for(_iterator9.s();!(_step9=_iterator9.n()).done;){var name=_step9.value;ENVIRONMENTS[name]=data}}catch(err){_iterator9.e(err)}finally{_iterator9.f()}}function defineFunction(names,parameters,options){var _a3,_b3;options||(options={});var data={definitionType:"function",params:parseParameterTemplate(parameters),ifMode:options.ifMode,isFunction:null!=(_a3=options.isFunction)&&_a3,applyMode:options.applyMode,infix:null!=(_b3=options.infix)&&_b3,createAtom:options.createAtom,applyStyle:options.applyStyle,serialize:options.serialize,render:options.render};if("string"==typeof names)LATEX_COMMANDS["\\"+names]=data;else{var _step10,_iterator10=_createForOfIteratorHelper(names);try{for(_iterator10.s();!(_step10=_iterator10.n()).done;){var name=_step10.value;LATEX_COMMANDS["\\"+name]=data}}catch(err){_iterator10.e(err)}finally{_iterator10.f()}}}function getMacros(otherMacros){return _DEFAULT_MACROS||(_DEFAULT_MACROS=normalizeMacroDictionary(DEFAULT_MACROS)),otherMacros?normalizeMacroDictionary(__spreadValues(__spreadValues({},_DEFAULT_MACROS),otherMacros)):_DEFAULT_MACROS}function normalizeMacroDefinition(def,options){var _a3,_b3,_c2,_d2;if("string"==typeof def){var argCount=0,defString=def;return/(^|[^\\])#1/.test(defString)&&(argCount=1),/(^|[^\\])#2/.test(defString)&&(argCount=2),/(^|[^\\])#3/.test(defString)&&(argCount=3),/(^|[^\\])#4/.test(defString)&&(argCount=4),/(^|[^\\])#5/.test(defString)&&(argCount=5),/(^|[^\\])#6/.test(defString)&&(argCount=6),/(^|[^\\])#7/.test(defString)&&(argCount=7),/(^|[^\\])#8/.test(defString)&&(argCount=8),/(^|[^\\])#9/.test(defString)&&(argCount=9),{expand:null==(_a3=null==options?void 0:options.expand)||_a3,captureSelection:null==(_b3=null==options?void 0:options.captureSelection)||_b3,args:argCount,def:defString}}return __spreadValues({expand:null==(_c2=null==options?void 0:options.expand)||_c2,captureSelection:null==(_d2=null==options?void 0:options.captureSelection)||_d2,args:0},def)}function normalizeMacroDictionary(macros){if(!macros)return{};for(var result={},_i5=0,_Object$keys3=Object.keys(macros);_i5<_Object$keys3.length;_i5++){var macro=_Object$keys3[_i5],macroDef=macros[macro];if(null==macroDef)delete result[macro];else if("object"===_typeof(macroDef)&&"package"in macroDef)for(var _i6=0,_Object$keys4=Object.keys(macroDef.package);_i6<_Object$keys4.length;_i6++){var packageMacro=_Object$keys4[_i6];result[packageMacro]=normalizeMacroDefinition(macroDef.package[packageMacro],{expand:!macroDef.primitive,captureSelection:macroDef.captureSelection})}else result[macro]=normalizeMacroDefinition(macroDef)}return result}function getDefinition(token){var parseMode=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"math";if(!token||0===token.length)return null;var info=null;if(token.startsWith("\\")){if(info=LATEX_COMMANDS[token])return info.ifMode&&info.ifMode!==parseMode?null:info;"math"===parseMode?info=MATH_SYMBOLS[token]:TEXT_SYMBOLS[token]&&(info={definitionType:"symbol",type:"mord",codepoint:TEXT_SYMBOLS[token]})}else if("math"===parseMode){if(!(info=MATH_SYMBOLS[token])&&1===token.length){var command=charToLatex("math",token.codePointAt(0));return command.startsWith("\\")?__spreadProps(__spreadValues({},getDefinition(command,"math")),{command:command}):null}}else TEXT_SYMBOLS[token]?info={definitionType:"symbol",type:"mord",codepoint:TEXT_SYMBOLS[token]}:"text"===parseMode&&(info={definitionType:"symbol",type:"mord",codepoint:token.codePointAt(0)});return!info||"symbol"!==info.definitionType||"mord"!==info.type||102!==info.codepoint&&103!==info.codepoint&&104!==info.codepoint||(info.isFunction=!0),null!=info?info:null}function getMacroDefinition(token,macros){return token.startsWith("\\")?macros[token.slice(1)]:null}function unicodeCharToLatex(parseMode,char){var _a3,result;if("text"===parseMode)return null!=(_a3=charToLatex(parseMode,char.codePointAt(0)))?_a3:char;if(result=charToLatex(parseMode,char.codePointAt(0)))return result;var v=function(codepoint){var _a3;if((codepoint<119808||codepoint>120831)&&(codepoint<8448||codepoint>8527))return{char:String.fromCodePoint(codepoint)};for(var c in MATH_LETTER_EXCEPTIONS)if(MATH_LETTER_EXCEPTIONS[c]===codepoint){codepoint=null!=(_a3=c.codePointAt(0))?_a3:0;break}var _step5,_iterator5=_createForOfIteratorHelper(MATH_UNICODE_BLOCKS);try{for(_iterator5.s();!(_step5=_iterator5.n()).done;){var MATH_UNICODE_BLOCK=_step5.value;if(codepoint>=MATH_UNICODE_BLOCK.start&&codepoint<MATH_UNICODE_BLOCK.start+MATH_UNICODE_BLOCK.len)return{char:String.fromCodePoint(codepoint-MATH_UNICODE_BLOCK.start+MATH_UNICODE_BLOCK.offset),variant:MATH_UNICODE_BLOCK.variant,style:MATH_UNICODE_BLOCK.style}}}catch(err){_iterator5.e(err)}finally{_iterator5.f()}return{char:String.fromCodePoint(codepoint)}}(char.codePointAt(0));return v.style||v.variant?(result=v.char,v.variant&&(result="\\"+v.variant+"{"+result+"}"),"bold"===v.style?result="\\mathbf{"+result+"}":"italic"===v.style?result="\\mathit{"+result+"}":"bolditalic"===v.style&&(result="\\mathbfit{"+result+"}"),"\\mathord{"+result+"}"):""}function charToLatex(parseMode,codepoint){if(void 0===codepoint)return"";if("math"===parseMode&&REVERSE_MATH_SYMBOLS[codepoint])return REVERSE_MATH_SYMBOLS[codepoint];if("text"===parseMode){var textSymbol=Object.keys(TEXT_SYMBOLS).find((function(x){return TEXT_SYMBOLS[x]===codepoint}));if(!textSymbol){var hex=codepoint.toString(16);textSymbol="^".repeat(hex.length)+hex}return textSymbol}return String.fromCodePoint(codepoint)}!function(){if(!isBrowser())return!0;if(/firefox/i.test(navigator.userAgent)){var m=navigator.userAgent.match(/firefox\/(\d+)/i);return!!m&&parseInt(m[1])>=78}if(/trident/i.test(navigator.userAgent))return!1;if(/edge/i.test(navigator.userAgent)){var _m2=navigator.userAgent.match(/edg\/(\d+)/i);return!!_m2&&parseInt(_m2[1])>=79}return!0}()?(LETTER=/[a-zA-ZаАбБвВгГдДеЕёЁжЖзЗиИйЙкКлЛмМнНоОпПрРсСтТуУфФхХцЦчЧшШщЩъЪыЫьЬэЭюЮяĄąĆćĘęŁłŃńÓóŚśŹźŻżàâäôéèëêïîçùûüÿæœÀÂÄÔÉÈËÊÏÎŸÇÙÛÜÆŒößÖẞìíòúÌÍÒÚáñÁÑ]/,LETTER_AND_DIGITS=/[\da-zA-ZаАбБвВгГдДеЕёЁжЖзЗиИйЙкКлЛмМнНоОпПрРсСтТуУфФхХцЦчЧшШщЩъЪыЫьЬэЭюЮяĄąĆćĘęŁłŃńÓóŚśŹźŻżàâäôéèëêïîçùûüÿæœÀÂÄÔÉÈËÊÏÎŸÇÙÛÜÆŒößÖẞìíòúÌÍÒÚáñÁÑ]/):(LETTER=new RegExp("\\p{Letter}","u"),LETTER_AND_DIGITS=new RegExp("[0-9\\p{Letter}]","u"));var M1=[0,.68889,0,0,.72222],M2=[0,.68889,0,0,.66667],M3=[0,.68889,0,0,.77778],M4=[0,.68889,0,0,.61111],M5=[.16667,.68889,0,0,.77778],M6=[0,.68889,0,0,.55556],M7=[0,0,0,0,.25],M8=[0,.825,0,0,2.33334],M9=[0,.9,0,0,2.33334],M10=[0,.68889,0,0,.54028],M11=[-.03598,.46402,0,0,.5],M12=[-.13313,.36687,0,0,1],M13=[.01354,.52239,0,0,1],M14=[.01354,.52239,0,0,1.11111],M15=[0,.54986,0,0,1],M16=[0,.69224,0,0,.5],M17=[0,.43056,0,0,1],M18=[.08198,.58198,0,0,.77778],M19=[.19444,.69224,0,0,.41667],M20=[.1808,.675,0,0,1],M21=[.19444,.69224,0,0,.83334],M22=[.13667,.63667,0,0,1],M23=[-.064,.437,0,0,1.334],M24=[.08167,.58167,0,0,.77778],M25=[0,.69224,0,0,.72222],M26=[0,.69224,0,0,.66667],M27=[-.13313,.36687,0,0,.77778],M28=[.06062,.54986,0,0,.77778],M29=[0,.69224,0,0,.77778],M30=[.25583,.75583,0,0,.77778],M31=[.25142,.75726,0,0,.77778],M32=[.20576,.70576,0,0,.77778],M33=[.30274,.79383,0,0,.77778],M34=[.22958,.72958,0,0,.77778],M35=[.1808,.675,0,0,.77778],M36=[.13667,.63667,0,0,.77778],M37=[.13597,.63597,0,0,.77778],M38=[.03517,.54986,0,0,.77778],M39=[0,.675,0,0,.77778],M40=[.19444,.69224,0,0,.61111],M41=[0,.54986,0,0,.76042],M42=[0,.54986,0,0,.66667],M43=[.0391,.5391,0,0,.77778],M44=[.03517,.54986,0,0,1.33334],M45=[.38569,.88569,0,0,.77778],M46=[.23222,.74111,0,0,.77778],M47=[.19444,.69224,0,0,.77778],M48=[0,.37788,0,0,.5],M49=[0,.54986,0,0,.72222],M50=[0,.69224,0,0,.83334],M51=[.11111,.69224,0,0,.66667],M52=[.26167,.75726,0,0,.77778],M53=[.48256,.98256,0,0,.77778],M54=[.28481,.79383,0,0,.77778],M55=[.08167,.58167,0,0,.22222],M56=[.08167,.58167,0,0,.38889],M57=[0,.43056,.04028,0,.66667],M58=[.41951,.91951,0,0,.77778],M59=[.24982,.74947,0,0,.38865],M60=[.08319,.58283,0,0,.75623],M61=[0,.10803,0,0,.27764],M62=[0,.47534,0,0,.50181],M63=[.18906,.47534,0,0,.50181],M64=[0,.69141,0,0,.50181],M65=[.24982,.74947,0,0,.27764],M66=[0,.69141,0,0,.21471],M67=[.25,.75,0,0,.44722],M68=[0,.64444,0,0,.575],M69=[.08556,.58556,0,0,.89444],M70=[0,.69444,0,0,.89444],M71=[0,.68611,0,0,.9],M72=[0,.68611,0,0,.86944],M73=[.25,.75,0,0,.575],M74=[.25,.75,0,0,.31944],M75=[0,.69444,0,0,.63889],M76=[0,.69444,0,0,.31944],M77=[0,.44444,0,0,.63889],M78=[0,.44444,0,0,.51111],M79=[0,.69444,0,0,.575],M80=[.13333,.63333,0,0,.89444],M81=[0,.44444,0,0,.31944],M82=[0,.69444,0,0,.86944],M83=[0,.68611,0,0,.69166],M84=[0,.68611,0,0,.83055],M85=[0,.68611,0,0,.89444],M86=[0,.69444,0,0,.60278],M87=[.19444,.69444,0,0,.51111],M88=[0,.69444,0,0,.83055],M89=[-.10889,.39111,0,0,1.14999],M90=[.19444,.69444,0,0,.575],M91=[.19444,.69444,0,0,1.14999],M92=[.19444,.69444,0,0,.70277],M93=[.05556,.75,0,0,.575],M94=[0,.68611,0,0,.95833],M95=[.08556,.58556,0,0,.76666],M96=[-.02639,.47361,0,0,.575],M97=[0,.44444,0,0,.89444],M98=[0,.55556,0,0,.76666],M99=[-.10889,.39111,0,0,.89444],M100=[.00222,.50222,0,0,.89444],M101=[.19667,.69667,0,0,.89444],M102=[.08556,.58556,0,0,1.14999],M103=[0,.69444,0,0,.70277],M104=[-.02778,.47222,0,0,.575],M105=[.25,.75,0,0,.51111],M106=[-.13889,.36111,0,0,1.14999],M107=[.19444,.69444,0,0,1.02222],M108=[.12963,.69444,0,0,.89444],M109=[.19444,.69444,0,0,.44722],M110=[0,.64444,.13167,0,.59111],M111=[.19444,.64444,.13167,0,.59111],M112=[0,.68611,.17208,0,.8961],M113=[.19444,.44444,.105,0,.53222],M114=[0,.44444,.085,0,.82666],M115=[0,.69444,.06709,0,.59111],M116=[0,.69444,.12945,0,.35555],M117=[0,.69444,0,0,.94888],M118=[0,.69444,.11472,0,.59111],M119=[0,.68611,.10778,0,.88555],M120=[0,.69444,.07939,0,.62055],M121=[0,.69444,.12417,0,.30667],M122=[0,.64444,.13556,0,.51111],M123=[.19444,.64444,.13556,0,.51111],M124=[0,.68333,.16389,0,.74333],M125=[.19444,.43056,.08847,0,.46],M126=[0,.43056,.07514,0,.71555],M127=[0,.69444,.06646,0,.51111],M128=[0,.69444,0,0,.83129],M129=[0,.69444,.1225,0,.51111],M130=[0,.68333,.09403,0,.76666],M131=[0,.68333,.11111,0,.76666],M132=[0,.69444,.06961,0,.51444],M133=[0,.69444,0,0,.27778],M134=[.25,.75,0,0,.38889],M135=[0,.64444,0,0,.5],M136=[0,.69444,0,0,.77778],M137=[0,.68333,0,0,.75],M138=[0,.68333,0,0,.77778],M139=[0,.68333,0,0,.68056],M140=[0,.68333,0,0,.72222],M141=[.25,.75,0,0,.5],M142=[.25,.75,0,0,.27778],M143=[0,.69444,0,0,.5],M144=[0,.69444,0,0,.55556],M145=[0,.43056,0,0,.44445],M146=[0,.43056,0,0,.5],M147=[.19444,.43056,0,0,.55556],M148=[0,.43056,0,0,.55556],M149=[.08333,.58333,0,0,.77778],M150=[0,.43056,0,0,.27778],M151=[0,.66786,0,0,.27778],M152=[0,.69444,0,0,.75],M153=[0,.66786,0,0,.5],M154=[0,.68333,0,0,.625],M155=[.19444,.69444,0,0,.44445],M156=[0,.69444,0,0,.72222],M157=[.19444,.69444,0,0,.5],M158=[.19444,.69444,0,0,1],M159=[.011,.511,0,0,1.126],M160=[.19444,.69444,0,0,.61111],M161=[.05556,.75,0,0,.5],M162=[0,.68333,0,0,.83334],M163=[.0391,.5391,0,0,.66667],M164=[-.05555,.44445,0,0,.5],M165=[0,.43056,0,0,.77778],M166=[0,.55556,0,0,.66667],M167=[-.03625,.46375,0,0,.77778],M168=[-.01688,.48312,0,0,.77778],M169=[.0391,.5391,0,0,1],M170=[0,.69444,0,0,.61111],M171=[-.03472,.46528,0,0,.5],M172=[.25,.75,0,0,.44445],M173=[-.14236,.35764,0,0,1],M174=[.244,.744,0,0,.412],M175=[.19444,.69444,0,0,.88889],M176=[.12963,.69444,0,0,.77778],M177=[.19444,.69444,0,0,.38889],M178=[.011,.511,0,0,1.638],M179=[.19444,.69444,0,0,0],M180=[0,.44444,0,0,.575],M181=[.19444,.44444,0,0,.575],M182=[0,.68611,0,0,.75555],M183=[0,.69444,0,0,.66759],M184=[0,.68611,0,0,.80555],M185=[0,.68611,.08229,0,.98229],M186=[0,.68611,0,0,.76666],M187=[0,.44444,0,0,.58472],M188=[.19444,.44444,0,0,.6118],M189=[.19444,.43056,0,0,.5],M190=[0,.68333,.02778,.08334,.76278],M191=[0,.68333,.08125,.05556,.83125],M192=[0,.43056,0,.05556,.48472],M193=[.19444,.43056,0,.08334,.51702],M194=[.25,.75,0,0,.42778],M195=[0,.69444,0,0,.55],M196=[0,.69444,0,0,.73334],M197=[0,.69444,0,0,.79445],M198=[0,.69444,0,0,.51945],M199=[0,.69444,0,0,.70278],M200=[0,.69444,0,0,.76389],M201=[.25,.75,0,0,.34306],M202=[0,.69444,0,0,.56111],M203=[0,.69444,0,0,.25556],M204=[.19444,.45833,0,0,.56111],M205=[0,.45833,0,0,.56111],M206=[0,.69444,0,0,.30556],M207=[0,.69444,0,0,.58056],M208=[0,.69444,0,0,.67223],M209=[0,.69444,0,0,.85556],M210=[0,.69444,0,0,.55834],M211=[0,.65556,.11156,0,.5],M212=[0,.69444,.08094,0,.70834],M213=[.17014,0,0,0,.44445],M214=[0,.69444,.0799,0,.5],M215=[0,.69444,0,0,.73752],M216=[0,.69444,.09205,0,.5],M217=[0,.69444,.09031,0,.77778],M218=[0,.69444,.07816,0,.27778],M219=[0,.69444,.00316,0,.5],M220=[.19444,.69444,0,0,.83334],M221=[.05556,.75,0,0,.83334],M222=[0,.75,0,0,.5],M223=[.125,.08333,0,0,.27778],M224=[0,.08333,0,0,.27778],M225=[0,.65556,0,0,.5],M226=[0,.69444,0,0,.47222],M227=[0,.69444,0,0,.66667],M228=[0,.69444,0,0,.59722],M229=[0,.69444,0,0,.54167],M230=[0,.69444,0,0,.70834],M231=[.25,.75,0,0,.28889],M232=[0,.69444,0,0,.51667],M233=[0,.44444,0,0,.44445],M234=[.19444,.44444,0,0,.51667],M235=[0,.44444,0,0,.38333],M236=[0,.44444,0,0,.51667],M237=[0,.69444,0,0,.83334],M238=[.35001,.85,0,0,.45834],M239=[.35001,.85,0,0,.57778],M240=[.35001,.85,0,0,.41667],M241=[.35001,.85,0,0,.58334],M242=[0,.72222,0,0,.55556],M243=[1e-5,.6,0,0,.66667],M244=[1e-5,.6,0,0,.77778],M245=[.25001,.75,0,0,.94445],M246=[.306,.805,.19445,0,.47222],M247=[.30612,.805,.19445,0,.47222],M248=[.25001,.75,0,0,.83334],M249=[.35001,.85,0,0,.47222],M250=[.25001,.75,0,0,1.11111],M251=[.65002,1.15,0,0,.59722],M252=[.65002,1.15,0,0,.81111],M253=[.65002,1.15,0,0,.47222],M254=[.65002,1.15,0,0,.66667],M255=[0,.75,0,0,1],M256=[.55001,1.05,0,0,1.27778],M257=[.862,1.36,.44445,0,.55556],M258=[.86225,1.36,.44445,0,.55556],M259=[.55001,1.05,0,0,1.11111],M260=[.65002,1.15,0,0,.52778],M261=[.65002,1.15,0,0,.61111],M262=[.55001,1.05,0,0,1.51112],M263=[.95003,1.45,0,0,.73611],M264=[.95003,1.45,0,0,1.04445],M265=[.95003,1.45,0,0,.52778],M266=[.95003,1.45,0,0,.75],M267=[0,.75,0,0,1.44445],M268=[.95003,1.45,0,0,.58334],M269=[1.25003,1.75,0,0,.79167],M270=[1.25003,1.75,0,0,1.27778],M271=[1.25003,1.75,0,0,.58334],M272=[1.25003,1.75,0,0,.80556],M273=[0,.825,0,0,1.8889],M274=[1.25003,1.75,0,0,.63889],M275=[.64502,1.155,0,0,.875],M276=[1e-5,.6,0,0,.875],M277=[-99e-5,.601,0,0,.66667],M278=[.64502,1.155,0,0,.66667],M279=[1e-5,.9,0,0,.88889],M280=[.65002,1.15,0,0,.88889],M281=[.90001,0,0,0,.88889],M282=[-.00499,.605,0,0,1.05556],M283=[0,.12,0,0,.45],M284=[0,.61111,0,0,.525],M285=[.08333,.69444,0,0,.525],M286=[-.08056,.53055,0,0,.525],M287=[-.05556,.55556,0,0,.525],M288=[0,.43056,0,0,.525],M289=[.22222,.43056,0,0,.525],M290=[0,0,0,0,.525],font_metrics_data_default={"AMS-Regular":{32:M7,65:M1,66:M2,67:M1,68:M1,69:M2,70:M4,71:M3,72:M3,73:[0,.68889,0,0,.38889],74:[.16667,.68889,0,0,.5],75:M3,76:M2,77:[0,.68889,0,0,.94445],78:M1,79:M5,80:M4,81:M5,82:M1,83:M6,84:M2,85:M1,86:M1,87:[0,.68889,0,0,1],88:M1,89:M1,90:M2,107:M6,160:M7,165:[0,.675,.025,0,.75],174:[.15559,.69224,0,0,.94666],240:M6,295:M10,710:M8,732:M9,770:M8,771:M9,989:M24,1008:M57,8245:[0,.54986,0,0,.275],8463:M10,8487:M1,8498:M6,8502:M2,8503:[0,.68889,0,0,.44445],8504:M2,8513:[0,.68889,0,0,.63889],8592:M11,8594:M11,8602:M12,8603:M12,8606:M13,8608:M13,8610:M14,8611:M14,8619:M15,8620:M15,8621:[-.13313,.37788,0,0,1.38889],8622:M12,8624:M16,8625:M16,8630:M17,8631:M17,8634:M18,8635:M18,8638:M19,8639:M19,8642:M19,8643:M19,8644:M20,8646:M20,8647:M20,8648:M21,8649:M20,8650:M21,8651:M13,8652:M13,8653:M12,8654:M12,8655:M12,8666:M22,8667:M22,8669:[-.13313,.37788,0,0,1],8672:M23,8674:M23,8705:[0,.825,0,0,.5],8708:M6,8709:M24,8717:[0,.43056,0,0,.42917],8722:M11,8724:[.08198,.69224,0,0,.77778],8726:M24,8733:M29,8736:M25,8737:M25,8738:[.03517,.52239,0,0,.72222],8739:M55,8740:[.25142,.74111,0,0,.27778],8741:M56,8742:[.25142,.74111,0,0,.5],8756:M26,8757:M26,8764:M27,8765:[-.13313,.37788,0,0,.77778],8769:M27,8770:M167,8774:M33,8776:M168,8778:M24,8782:M28,8783:M28,8785:M18,8786:M18,8787:M18,8790:M29,8791:M34,8796:[.08198,.91667,0,0,.77778],8806:M30,8807:M30,8808:M31,8809:M31,8812:[.25583,.75583,0,0,.5],8814:M32,8815:M32,8816:M33,8817:M33,8818:M34,8819:M34,8822:M35,8823:M35,8828:M36,8829:M36,8830:M34,8831:M34,8832:M32,8833:M32,8840:M33,8841:M33,8842:M37,8843:M37,8847:M38,8848:M38,8858:M18,8859:M18,8861:M18,8862:M39,8863:M39,8864:M39,8865:M39,8872:[0,.69224,0,0,.61111],8873:M25,8874:[0,.69224,0,0,.88889],8876:M4,8877:M4,8878:M1,8879:M1,8882:M38,8883:M38,8884:M36,8885:M36,8888:[0,.54986,0,0,1.11111],8890:M147,8891:M40,8892:M40,8901:[0,.54986,0,0,.27778],8903:M24,8905:M24,8906:M24,8907:M29,8908:M29,8909:[-.03598,.46402,0,0,.77778],8910:M41,8911:M41,8912:M38,8913:M38,8914:M42,8915:M42,8916:M26,8918:M43,8919:M43,8920:M44,8921:M44,8922:M45,8923:M45,8926:M36,8927:M36,8928:M33,8929:M33,8934:M46,8935:M46,8936:M46,8937:M46,8938:M32,8939:M32,8940:M33,8941:M33,8994:M47,8995:M47,9416:[.15559,.69224,0,0,.90222],9484:M16,9488:M16,9492:M48,9496:M48,9585:[.19444,.68889,0,0,.88889],9586:[.19444,.74111,0,0,.88889],9632:M39,9633:M39,9650:M49,9651:M49,9654:M38,9660:M49,9661:M49,9664:M38,9674:M51,9733:[.19444,.69224,0,0,.94445],10003:M50,10016:M50,10731:M51,10846:[.19444,.75583,0,0,.61111],10877:M36,10878:M36,10885:M30,10886:M30,10887:M37,10888:M37,10889:M52,10890:M52,10891:M53,10892:M53,10901:M36,10902:M36,10933:M31,10934:M31,10935:M52,10936:M52,10937:M52,10938:M52,10949:M30,10950:M30,10955:M54,10956:M54,57350:M55,57351:M56,57352:M24,57353:M57,57356:M31,57357:M31,57358:M58,57359:M33,57360:M33,57361:M58,57366:M31,57367:M31,57368:M31,57369:M31,57370:M37,57371:M37},"Caligraphic-Regular":{32:M7,65:[0,.68333,0,.19445,.79847],66:[0,.68333,.03041,.13889,.65681],67:[0,.68333,.05834,.13889,.52653],68:[0,.68333,.02778,.08334,.77139],69:[0,.68333,.08944,.11111,.52778],70:[0,.68333,.09931,.11111,.71875],71:[.09722,.68333,.0593,.11111,.59487],72:[0,.68333,.00965,.11111,.84452],73:[0,.68333,.07382,0,.54452],74:[.09722,.68333,.18472,.16667,.67778],75:[0,.68333,.01445,.05556,.76195],76:[0,.68333,0,.13889,.68972],77:[0,.68333,0,.13889,1.2009],78:[0,.68333,.14736,.08334,.82049],79:[0,.68333,.02778,.11111,.79611],80:[0,.68333,.08222,.08334,.69556],81:[.09722,.68333,0,.11111,.81667],82:[0,.68333,0,.08334,.8475],83:[0,.68333,.075,.13889,.60556],84:[0,.68333,.25417,0,.54464],85:[0,.68333,.09931,.08334,.62583],86:[0,.68333,.08222,0,.61278],87:[0,.68333,.08222,.08334,.98778],88:[0,.68333,.14643,.13889,.7133],89:[.09722,.68333,.08222,.08334,.66834],90:[0,.68333,.07944,.13889,.72473],160:M7},"Fraktur-Regular":{32:M7,33:[0,.69141,0,0,.29574],34:M66,38:[0,.69141,0,0,.73786],39:[0,.69141,0,0,.21201],40:M59,41:M59,42:[0,.62119,0,0,.27764],43:M60,44:M61,45:M60,46:M61,47:[.24982,.74947,0,0,.50181],48:M62,49:M62,50:M62,51:M63,52:M63,53:M63,54:M64,55:M63,56:M64,57:M63,58:[0,.47534,0,0,.21606],59:[.12604,.47534,0,0,.21606],61:[-.13099,.36866,0,0,.75623],63:[0,.69141,0,0,.36245],65:[0,.69141,0,0,.7176],66:[0,.69141,0,0,.88397],67:[0,.69141,0,0,.61254],68:[0,.69141,0,0,.83158],69:[0,.69141,0,0,.66278],70:[.12604,.69141,0,0,.61119],71:[0,.69141,0,0,.78539],72:[.06302,.69141,0,0,.7203],73:[0,.69141,0,0,.55448],74:[.12604,.69141,0,0,.55231],75:[0,.69141,0,0,.66845],76:[0,.69141,0,0,.66602],77:[0,.69141,0,0,1.04953],78:[0,.69141,0,0,.83212],79:[0,.69141,0,0,.82699],80:[.18906,.69141,0,0,.82753],81:[.03781,.69141,0,0,.82699],82:[0,.69141,0,0,.82807],83:[0,.69141,0,0,.82861],84:[0,.69141,0,0,.66899],85:[0,.69141,0,0,.64576],86:[0,.69141,0,0,.83131],87:[0,.69141,0,0,1.04602],88:[0,.69141,0,0,.71922],89:[.18906,.69141,0,0,.83293],90:[.12604,.69141,0,0,.60201],91:M65,93:M65,94:[0,.69141,0,0,.49965],97:[0,.47534,0,0,.50046],98:[0,.69141,0,0,.51315],99:[0,.47534,0,0,.38946],100:[0,.62119,0,0,.49857],101:[0,.47534,0,0,.40053],102:[.18906,.69141,0,0,.32626],103:[.18906,.47534,0,0,.5037],104:[.18906,.69141,0,0,.52126],105:[0,.69141,0,0,.27899],106:[0,.69141,0,0,.28088],107:[0,.69141,0,0,.38946],108:[0,.69141,0,0,.27953],109:[0,.47534,0,0,.76676],110:[0,.47534,0,0,.52666],111:[0,.47534,0,0,.48885],112:[.18906,.52396,0,0,.50046],113:[.18906,.47534,0,0,.48912],114:[0,.47534,0,0,.38919],115:[0,.47534,0,0,.44266],116:[0,.62119,0,0,.33301],117:[0,.47534,0,0,.5172],118:[0,.52396,0,0,.5118],119:[0,.52396,0,0,.77351],120:[.18906,.47534,0,0,.38865],121:[.18906,.47534,0,0,.49884],122:[.18906,.47534,0,0,.39054],160:M7,8216:M66,8217:M66,58112:[0,.62119,0,0,.49749],58113:[0,.62119,0,0,.4983],58114:[.18906,.69141,0,0,.33328],58115:[.18906,.69141,0,0,.32923],58116:[.18906,.47534,0,0,.50343],58117:[0,.69141,0,0,.33301],58118:[0,.62119,0,0,.33409],58119:[0,.47534,0,0,.50073]},"Main-Bold":{32:M7,33:[0,.69444,0,0,.35],34:M86,35:[.19444,.69444,0,0,.95833],36:M93,37:[.05556,.75,0,0,.95833],38:M70,39:M76,40:M67,41:M67,42:[0,.75,0,0,.575],43:M80,44:[.19444,.15556,0,0,.31944],45:M235,46:[0,.15556,0,0,.31944],47:M73,48:M68,49:M68,50:M68,51:M68,52:M68,53:M68,54:M68,55:M68,56:M68,57:M68,58:M81,59:[.19444,.44444,0,0,.31944],60:M69,61:M99,62:M69,63:[0,.69444,0,0,.54305],64:M70,65:M72,66:[0,.68611,0,0,.81805],67:M84,68:[0,.68611,0,0,.88194],69:M182,70:[0,.68611,0,0,.72361],71:[0,.68611,0,0,.90416],72:M71,73:[0,.68611,0,0,.43611],74:[0,.68611,0,0,.59444],75:[0,.68611,0,0,.90138],76:M83,77:[0,.68611,0,0,1.09166],78:M71,79:[0,.68611,0,0,.86388],80:[0,.68611,0,0,.78611],81:[.19444,.68611,0,0,.86388],82:[0,.68611,0,0,.8625],83:[0,.68611,0,0,.63889],84:[0,.68611,0,0,.8],85:[0,.68611,0,0,.88472],86:[0,.68611,.01597,0,.86944],87:[0,.68611,.01597,0,1.18888],88:M72,89:[0,.68611,.02875,0,.86944],90:[0,.68611,0,0,.70277],91:M74,92:M73,93:M74,94:M79,95:[.31,.13444,.03194,0,.575],97:[0,.44444,0,0,.55902],98:M75,99:M78,100:M75,101:[0,.44444,0,0,.52708],102:[0,.69444,.10903,0,.35139],103:[.19444,.44444,.01597,0,.575],104:M75,105:M76,106:[.19444,.69444,0,0,.35139],107:[0,.69444,0,0,.60694],108:M76,109:[0,.44444,0,0,.95833],110:M77,111:M180,112:[.19444,.44444,0,0,.63889],113:[.19444,.44444,0,0,.60694],114:[0,.44444,0,0,.47361],115:[0,.44444,0,0,.45361],116:[0,.63492,0,0,.44722],117:M77,118:[0,.44444,.01597,0,.60694],119:[0,.44444,.01597,0,.83055],120:[0,.44444,0,0,.60694],121:[.19444,.44444,.01597,0,.60694],122:M78,123:M73,124:M74,125:M73,126:[.35,.34444,0,0,.575],160:M7,163:[0,.69444,0,0,.86853],168:M79,172:[0,.44444,0,0,.76666],176:M82,177:M80,184:[.17014,0,0,0,.51111],198:[0,.68611,0,0,1.04166],215:M80,216:[.04861,.73472,0,0,.89444],223:M228,230:[0,.44444,0,0,.83055],247:M80,248:[.09722,.54167,0,0,.575],305:M81,338:[0,.68611,0,0,1.16944],339:M97,567:[.19444,.44444,0,0,.35139],710:M79,711:[0,.63194,0,0,.575],713:[0,.59611,0,0,.575],714:M79,715:M79,728:M79,729:M76,730:M82,732:M79,733:M79,915:M83,916:M94,920:M85,923:M184,926:M186,928:M71,931:M84,933:M85,934:M84,936:M85,937:M84,8211:[0,.44444,.03194,0,.575],8212:[0,.44444,.03194,0,1.14999],8216:M76,8217:M76,8220:M86,8221:M86,8224:M87,8225:M87,8242:[0,.55556,0,0,.34444],8407:[0,.72444,.15486,0,.575],8463:M183,8465:M88,8467:[0,.69444,0,0,.47361],8472:[.19444,.44444,0,0,.74027],8476:M88,8501:M103,8592:M89,8593:M90,8594:M89,8595:M90,8596:M89,8597:M73,8598:M91,8599:M91,8600:M91,8601:M91,8636:M89,8637:M89,8640:M89,8641:M89,8656:M89,8657:M92,8658:M89,8659:M92,8660:M89,8661:[.25,.75,0,0,.70277],8704:M75,8706:[0,.69444,.06389,0,.62847],8707:M75,8709:M93,8711:M94,8712:M95,8715:M95,8722:M80,8723:M80,8725:M73,8726:M73,8727:M104,8728:M96,8729:M96,8730:[.18,.82,0,0,.95833],8733:M97,8734:[0,.44444,0,0,1.14999],8736:M25,8739:M74,8741:M73,8743:M98,8744:M98,8745:M98,8746:M98,8747:[.19444,.69444,.12778,0,.56875],8764:M99,8768:[.19444,.69444,0,0,.31944],8771:M100,8776:[.02444,.52444,0,0,.89444],8781:M100,8801:M100,8804:M101,8805:M101,8810:M102,8811:M102,8826:M69,8827:M69,8834:M69,8835:M69,8838:M101,8839:M101,8846:M98,8849:M101,8850:M101,8851:M98,8852:M98,8853:M80,8854:M80,8855:M80,8856:M80,8857:M80,8866:M103,8867:M103,8868:M70,8869:M70,8900:M96,8901:[-.02639,.47361,0,0,.31944],8902:M104,8968:M105,8969:M105,8970:M105,8971:M105,8994:M106,8995:M106,9651:M107,9657:M104,9661:M107,9667:M104,9711:M91,9824:M108,9825:M108,9826:M108,9827:M108,9837:[0,.75,0,0,.44722],9838:M109,9839:M109,10216:M67,10217:M67,10815:M71,10927:M101,10928:M101,57376:M179},"Main-BoldItalic":{32:M7,33:[0,.69444,.11417,0,.38611],34:M120,35:[.19444,.69444,.06833,0,.94444],37:[.05556,.75,.12861,0,.94444],38:[0,.69444,.08528,0,.88555],39:M116,40:[.25,.75,.15806,0,.47333],41:[.25,.75,.03306,0,.47333],42:[0,.75,.14333,0,.59111],43:[.10333,.60333,.03306,0,.88555],44:[.19444,.14722,0,0,.35555],45:[0,.44444,.02611,0,.41444],46:[0,.14722,0,0,.35555],47:[.25,.75,.15806,0,.59111],48:M110,49:M110,50:M110,51:M110,52:M111,53:M110,54:M110,55:M111,56:M110,57:M110,58:[0,.44444,.06695,0,.35555],59:[.19444,.44444,.06695,0,.35555],61:[-.10889,.39111,.06833,0,.88555],63:M118,64:[0,.69444,.09208,0,.88555],65:[0,.68611,0,0,.86555],66:[0,.68611,.0992,0,.81666],67:[0,.68611,.14208,0,.82666],68:[0,.68611,.09062,0,.87555],69:[0,.68611,.11431,0,.75666],70:[0,.68611,.12903,0,.72722],71:[0,.68611,.07347,0,.89527],72:M112,73:[0,.68611,.15681,0,.47166],74:[0,.68611,.145,0,.61055],75:[0,.68611,.14208,0,.89499],76:[0,.68611,0,0,.69777],77:[0,.68611,.17208,0,1.07277],78:M112,79:[0,.68611,.09062,0,.85499],80:[0,.68611,.0992,0,.78721],81:[.19444,.68611,.09062,0,.85499],82:[0,.68611,.02559,0,.85944],83:[0,.68611,.11264,0,.64999],84:[0,.68611,.12903,0,.7961],85:[0,.68611,.17208,0,.88083],86:[0,.68611,.18625,0,.86555],87:[0,.68611,.18625,0,1.15999],88:[0,.68611,.15681,0,.86555],89:[0,.68611,.19803,0,.86555],90:[0,.68611,.14208,0,.70888],91:[.25,.75,.1875,0,.35611],93:[.25,.75,.09972,0,.35611],94:M115,95:[.31,.13444,.09811,0,.59111],97:[0,.44444,.09426,0,.59111],98:[0,.69444,.07861,0,.53222],99:[0,.44444,.05222,0,.53222],100:[0,.69444,.10861,0,.59111],101:[0,.44444,.085,0,.53222],102:[.19444,.69444,.21778,0,.4],103:M113,104:[0,.69444,.09426,0,.59111],105:[0,.69326,.11387,0,.35555],106:[.19444,.69326,.1672,0,.35555],107:[0,.69444,.11111,0,.53222],108:[0,.69444,.10861,0,.29666],109:[0,.44444,.09426,0,.94444],110:[0,.44444,.09426,0,.64999],111:[0,.44444,.07861,0,.59111],112:[.19444,.44444,.07861,0,.59111],113:M113,114:[0,.44444,.11111,0,.50167],115:[0,.44444,.08167,0,.48694],116:[0,.63492,.09639,0,.385],117:[0,.44444,.09426,0,.62055],118:[0,.44444,.11111,0,.53222],119:[0,.44444,.11111,0,.76777],120:[0,.44444,.12583,0,.56055],121:[.19444,.44444,.105,0,.56166],122:[0,.44444,.13889,0,.49055],126:[.35,.34444,.11472,0,.59111],160:M7,168:[0,.69444,.11473,0,.59111],176:M117,184:[.17014,0,0,0,.53222],198:[0,.68611,.11431,0,1.02277],216:[.04861,.73472,.09062,0,.88555],223:[.19444,.69444,.09736,0,.665],230:M114,248:[.09722,.54167,.09458,0,.59111],305:[0,.44444,.09426,0,.35555],338:[0,.68611,.11431,0,1.14054],339:M114,567:[.19444,.44444,.04611,0,.385],710:M115,711:[0,.63194,.08271,0,.59111],713:[0,.59444,.10444,0,.59111],714:[0,.69444,.08528,0,.59111],715:[0,.69444,0,0,.59111],728:[0,.69444,.10333,0,.59111],729:M116,730:M117,732:M118,733:M118,915:[0,.68611,.12903,0,.69777],916:[0,.68611,0,0,.94444],920:[0,.68611,.09062,0,.88555],923:[0,.68611,0,0,.80666],926:[0,.68611,.15092,0,.76777],928:M112,931:[0,.68611,.11431,0,.82666],933:M119,934:[0,.68611,.05632,0,.82666],936:M119,937:[0,.68611,.0992,0,.82666],8211:[0,.44444,.09811,0,.59111],8212:[0,.44444,.09811,0,1.18221],8216:M116,8217:M116,8220:[0,.69444,.16772,0,.62055],8221:M120},"Main-Italic":{32:M7,33:M121,34:M132,35:[.19444,.69444,.06616,0,.81777],37:[.05556,.75,.13639,0,.81777],38:[0,.69444,.09694,0,.76666],39:M121,40:[.25,.75,.16194,0,.40889],41:[.25,.75,.03694,0,.40889],42:[0,.75,.14917,0,.51111],43:[.05667,.56167,.03694,0,.76666],44:[.19444,.10556,0,0,.30667],45:[0,.43056,.02826,0,.35778],46:[0,.10556,0,0,.30667],47:[.25,.75,.16194,0,.51111],48:M122,49:M122,50:M122,51:M122,52:M123,53:M122,54:M122,55:M123,56:M122,57:M122,58:[0,.43056,.0582,0,.30667],59:[.19444,.43056,.0582,0,.30667],61:[-.13313,.36687,.06616,0,.76666],63:M129,64:[0,.69444,.09597,0,.76666],65:[0,.68333,0,0,.74333],66:[0,.68333,.10257,0,.70389],67:[0,.68333,.14528,0,.71555],68:[0,.68333,.09403,0,.755],69:[0,.68333,.12028,0,.67833],70:[0,.68333,.13305,0,.65277],71:[0,.68333,.08722,0,.77361],72:M124,73:[0,.68333,.15806,0,.38555],74:[0,.68333,.14028,0,.525],75:[0,.68333,.14528,0,.76888],76:[0,.68333,0,0,.62722],77:[0,.68333,.16389,0,.89666],78:M124,79:M130,80:[0,.68333,.10257,0,.67833],81:[.19444,.68333,.09403,0,.76666],82:[0,.68333,.03868,0,.72944],83:[0,.68333,.11972,0,.56222],84:[0,.68333,.13305,0,.71555],85:M124,86:[0,.68333,.18361,0,.74333],87:[0,.68333,.18361,0,.99888],88:[0,.68333,.15806,0,.74333],89:[0,.68333,.19383,0,.74333],90:[0,.68333,.14528,0,.61333],91:[.25,.75,.1875,0,.30667],93:[.25,.75,.10528,0,.30667],94:M127,95:[.31,.12056,.09208,0,.51111],97:[0,.43056,.07671,0,.51111],98:[0,.69444,.06312,0,.46],99:[0,.43056,.05653,0,.46],100:[0,.69444,.10333,0,.51111],101:[0,.43056,.07514,0,.46],102:[.19444,.69444,.21194,0,.30667],103:M125,104:[0,.69444,.07671,0,.51111],105:[0,.65536,.1019,0,.30667],106:[.19444,.65536,.14467,0,.30667],107:[0,.69444,.10764,0,.46],108:[0,.69444,.10333,0,.25555],109:[0,.43056,.07671,0,.81777],110:[0,.43056,.07671,0,.56222],111:[0,.43056,.06312,0,.51111],112:[.19444,.43056,.06312,0,.51111],113:M125,114:[0,.43056,.10764,0,.42166],115:[0,.43056,.08208,0,.40889],116:[0,.61508,.09486,0,.33222],117:[0,.43056,.07671,0,.53666],118:[0,.43056,.10764,0,.46],119:[0,.43056,.10764,0,.66444],120:[0,.43056,.12042,0,.46389],121:[.19444,.43056,.08847,0,.48555],122:[0,.43056,.12292,0,.40889],126:[.35,.31786,.11585,0,.51111],160:M7,168:[0,.66786,.10474,0,.51111],176:M128,184:[.17014,0,0,0,.46],198:[0,.68333,.12028,0,.88277],216:[.04861,.73194,.09403,0,.76666],223:[.19444,.69444,.10514,0,.53666],230:M126,248:[.09722,.52778,.09194,0,.51111],338:[0,.68333,.12028,0,.98499],339:M126,710:M127,711:[0,.62847,.08295,0,.51111],713:[0,.56167,.10333,0,.51111],714:[0,.69444,.09694,0,.51111],715:[0,.69444,0,0,.51111],728:[0,.69444,.10806,0,.51111],729:[0,.66786,.11752,0,.30667],730:M128,732:[0,.66786,.11585,0,.51111],733:M129,915:[0,.68333,.13305,0,.62722],916:[0,.68333,0,0,.81777],920:M130,923:[0,.68333,0,0,.69222],926:[0,.68333,.15294,0,.66444],928:M124,931:[0,.68333,.12028,0,.71555],933:M131,934:[0,.68333,.05986,0,.71555],936:M131,937:[0,.68333,.10257,0,.71555],8211:[0,.43056,.09208,0,.51111],8212:[0,.43056,.09208,0,1.02222],8216:M121,8217:M121,8220:[0,.69444,.1685,0,.51444],8221:M132,8463:M10},"Main-Regular":{32:M7,33:M133,34:M143,35:M220,36:M161,37:M221,38:M136,39:M133,40:M134,41:M134,42:M222,43:M149,44:[.19444,.10556,0,0,.27778],45:[0,.43056,0,0,.33333],46:[0,.10556,0,0,.27778],47:M141,48:M135,49:M135,50:M135,51:M135,52:M135,53:M135,54:M135,55:M135,56:M135,57:M135,58:M150,59:[.19444,.43056,0,0,.27778],60:M43,61:M27,62:M43,63:M226,64:M136,65:M137,66:[0,.68333,0,0,.70834],67:M140,68:[0,.68333,0,0,.76389],69:M139,70:[0,.68333,0,0,.65278],71:[0,.68333,0,0,.78472],72:M137,73:[0,.68333,0,0,.36111],74:[0,.68333,0,0,.51389],75:M138,76:M154,77:[0,.68333,0,0,.91667],78:M137,79:M138,80:M139,81:[.19444,.68333,0,0,.77778],82:[0,.68333,0,0,.73611],83:[0,.68333,0,0,.55556],84:M140,85:M137,86:[0,.68333,.01389,0,.75],87:[0,.68333,.01389,0,1.02778],88:M137,89:[0,.68333,.025,0,.75],90:[0,.68333,0,0,.61111],91:M142,92:M141,93:M142,94:M143,95:[.31,.12056,.02778,0,.5],97:M146,98:M144,99:M145,100:M144,101:M145,102:[0,.69444,.07778,0,.30556],103:[.19444,.43056,.01389,0,.5],104:M144,105:M151,106:[.19444,.66786,0,0,.30556],107:[0,.69444,0,0,.52778],108:M133,109:[0,.43056,0,0,.83334],110:M148,111:M146,112:M147,113:[.19444,.43056,0,0,.52778],114:[0,.43056,0,0,.39167],115:[0,.43056,0,0,.39445],116:[0,.61508,0,0,.38889],117:M148,118:[0,.43056,.01389,0,.52778],119:[0,.43056,.01389,0,.72222],120:[0,.43056,0,0,.52778],121:[.19444,.43056,.01389,0,.52778],122:M145,123:M141,124:M142,125:M141,126:[.35,.31786,0,0,.5],160:M7,163:[0,.69444,0,0,.76909],167:M155,168:M153,172:[0,.43056,0,0,.66667],176:M152,177:M149,182:M160,184:M213,198:[0,.68333,0,0,.90278],215:M149,216:[.04861,.73194,0,0,.77778],223:M143,230:[0,.43056,0,0,.72222],247:M149,248:[.09722,.52778,0,0,.5],305:M150,338:[0,.68333,0,0,1.01389],339:M165,567:[.19444,.43056,0,0,.30556],710:M143,711:[0,.62847,0,0,.5],713:[0,.56778,0,0,.5],714:M143,715:M143,728:M143,729:M151,730:M152,732:M153,733:M143,915:M154,916:M162,920:M138,923:[0,.68333,0,0,.69445],926:[0,.68333,0,0,.66667],928:M137,931:M140,933:M138,934:M140,936:M138,937:M140,8211:[0,.43056,.02778,0,.5],8212:[0,.43056,.02778,0,1],8216:M133,8217:M133,8220:M143,8221:M143,8224:M155,8225:M155,8230:[0,.12,0,0,1.172],8242:[0,.55556,0,0,.275],8407:[0,.71444,.15382,0,.5],8463:M10,8465:M156,8467:[0,.69444,0,.11111,.41667],8472:[.19444,.43056,0,.11111,.63646],8476:M156,8501:M170,8592:M12,8593:M157,8594:M12,8595:M157,8596:M12,8597:M141,8598:M158,8599:M158,8600:M158,8601:M158,8614:[.011,.511,0,0,1],8617:M159,8618:M159,8636:M12,8637:M12,8640:M12,8641:M12,8652:[.011,.671,0,0,1],8656:M12,8657:M160,8658:M12,8659:M160,8660:M12,8661:[.25,.75,0,0,.61111],8704:M144,8706:[0,.69444,.05556,.08334,.5309],8707:M144,8709:M161,8711:M162,8712:M163,8715:M163,8722:M149,8723:M149,8725:M141,8726:M141,8727:M171,8728:M164,8729:M164,8730:[.2,.8,0,0,.83334],8733:M165,8734:M17,8736:M25,8739:M142,8741:M141,8743:M166,8744:M166,8745:M166,8746:M166,8747:[.19444,.69444,.11111,0,.41667],8764:M27,8768:[.19444,.69444,0,0,.27778],8771:M167,8773:[-.022,.589,0,0,1],8776:M168,8781:M167,8784:[-.133,.67,0,0,.778],8801:M167,8804:M37,8805:M37,8810:M169,8811:M169,8826:M43,8827:M43,8834:M43,8835:M43,8838:M37,8839:M37,8846:M166,8849:M37,8850:M37,8851:M166,8852:M166,8853:M149,8854:M149,8855:M149,8856:M149,8857:M149,8866:M170,8867:M170,8868:M136,8869:M136,8872:[.249,.75,0,0,.867],8900:M164,8901:[-.05555,.44445,0,0,.27778],8902:M171,8904:[.005,.505,0,0,.9],8942:[.03,.9,0,0,.278],8943:[-.19,.31,0,0,1.172],8945:[-.1,.82,0,0,1.282],8968:M172,8969:M172,8970:M172,8971:M172,8994:M173,8995:M173,9136:M174,9137:M174,9651:M175,9657:M171,9661:M175,9667:M171,9711:M158,9824:M176,9825:M176,9826:M176,9827:M176,9837:[0,.75,0,0,.38889],9838:M177,9839:M177,10216:M134,10217:M134,10222:M174,10223:M174,10229:[.011,.511,0,0,1.609],10230:M178,10231:[.011,.511,0,0,1.859],10232:[.024,.525,0,0,1.609],10233:[.024,.525,0,0,1.638],10234:[.024,.525,0,0,1.858],10236:M178,10815:M137,10927:M37,10928:M37,57376:M179},"Math-BoldItalic":{32:M7,48:M180,49:M180,50:M180,51:M181,52:M181,53:M181,54:M68,55:M181,56:M68,57:M181,65:M72,66:[0,.68611,.04835,0,.8664],67:[0,.68611,.06979,0,.81694],68:[0,.68611,.03194,0,.93812],69:[0,.68611,.05451,0,.81007],70:[0,.68611,.15972,0,.68889],71:[0,.68611,0,0,.88673],72:M185,73:[0,.68611,.07778,0,.51111],74:[0,.68611,.10069,0,.63125],75:[0,.68611,.06979,0,.97118],76:M182,77:[0,.68611,.11424,0,1.14201],78:[0,.68611,.11424,0,.95034],79:[0,.68611,.03194,0,.83666],80:[0,.68611,.15972,0,.72309],81:[.19444,.68611,0,0,.86861],82:[0,.68611,.00421,0,.87235],83:[0,.68611,.05382,0,.69271],84:[0,.68611,.15972,0,.63663],85:[0,.68611,.11424,0,.80027],86:[0,.68611,.25555,0,.67778],87:[0,.68611,.15972,0,1.09305],88:[0,.68611,.07778,0,.94722],89:[0,.68611,.25555,0,.67458],90:[0,.68611,.06979,0,.77257],97:[0,.44444,0,0,.63287],98:[0,.69444,0,0,.52083],99:[0,.44444,0,0,.51342],100:[0,.69444,0,0,.60972],101:[0,.44444,0,0,.55361],102:[.19444,.69444,.11042,0,.56806],103:[.19444,.44444,.03704,0,.5449],104:M183,105:[0,.69326,0,0,.4048],106:[.19444,.69326,.0622,0,.47083],107:[0,.69444,.01852,0,.6037],108:[0,.69444,.0088,0,.34815],109:[0,.44444,0,0,1.0324],110:[0,.44444,0,0,.71296],111:M187,112:[.19444,.44444,0,0,.60092],113:[.19444,.44444,.03704,0,.54213],114:[0,.44444,.03194,0,.5287],115:[0,.44444,0,0,.53125],116:[0,.63492,0,0,.41528],117:[0,.44444,0,0,.68102],118:[0,.44444,.03704,0,.56666],119:[0,.44444,.02778,0,.83148],120:[0,.44444,0,0,.65903],121:[.19444,.44444,.03704,0,.59028],122:[0,.44444,.04213,0,.55509],160:M7,915:[0,.68611,.15972,0,.65694],916:M94,920:[0,.68611,.03194,0,.86722],923:M184,926:[0,.68611,.07458,0,.84125],928:M185,931:[0,.68611,.05451,0,.88507],933:[0,.68611,.15972,0,.67083],934:M186,936:[0,.68611,.11653,0,.71402],937:[0,.68611,.04835,0,.8789],945:[0,.44444,0,0,.76064],946:[.19444,.69444,.03403,0,.65972],947:[.19444,.44444,.06389,0,.59003],948:[0,.69444,.03819,0,.52222],949:[0,.44444,0,0,.52882],950:[.19444,.69444,.06215,0,.50833],951:[.19444,.44444,.03704,0,.6],952:[0,.69444,.03194,0,.5618],953:[0,.44444,0,0,.41204],954:[0,.44444,0,0,.66759],955:[0,.69444,0,0,.67083],956:[.19444,.44444,0,0,.70787],957:[0,.44444,.06898,0,.57685],958:[.19444,.69444,.03021,0,.50833],959:M187,960:[0,.44444,.03704,0,.68241],961:M188,962:[.09722,.44444,.07917,0,.42361],963:[0,.44444,.03704,0,.68588],964:[0,.44444,.13472,0,.52083],965:[0,.44444,.03704,0,.63055],966:[.19444,.44444,0,0,.74722],967:[.19444,.44444,0,0,.71805],968:[.19444,.69444,.03704,0,.75833],969:[0,.44444,.03704,0,.71782],977:[0,.69444,0,0,.69155],981:[.19444,.69444,0,0,.7125],982:[0,.44444,.03194,0,.975],1009:M188,1013:[0,.44444,0,0,.48333],57649:[0,.44444,0,0,.39352],57911:[.19444,.44444,0,0,.43889]},"Math-Italic":{32:M7,48:M146,49:M146,50:M146,51:M189,52:M189,53:M189,54:M135,55:M189,56:M135,57:M189,65:[0,.68333,0,.13889,.75],66:[0,.68333,.05017,.08334,.75851],67:[0,.68333,.07153,.08334,.71472],68:[0,.68333,.02778,.05556,.82792],69:[0,.68333,.05764,.08334,.7382],70:[0,.68333,.13889,.08334,.64306],71:[0,.68333,0,.08334,.78625],72:M191,73:[0,.68333,.07847,.11111,.43958],74:[0,.68333,.09618,.16667,.55451],75:[0,.68333,.07153,.05556,.84931],76:[0,.68333,0,.02778,.68056],77:[0,.68333,.10903,.08334,.97014],78:[0,.68333,.10903,.08334,.80347],79:M190,80:[0,.68333,.13889,.08334,.64201],81:[.19444,.68333,0,.08334,.79056],82:[0,.68333,.00773,.08334,.75929],83:[0,.68333,.05764,.08334,.6132],84:[0,.68333,.13889,.08334,.58438],85:[0,.68333,.10903,.02778,.68278],86:[0,.68333,.22222,0,.58333],87:[0,.68333,.13889,0,.94445],88:[0,.68333,.07847,.08334,.82847],89:[0,.68333,.22222,0,.58056],90:[0,.68333,.07153,.08334,.68264],97:[0,.43056,0,0,.52859],98:[0,.69444,0,0,.42917],99:[0,.43056,0,.05556,.43276],100:[0,.69444,0,.16667,.52049],101:[0,.43056,0,.05556,.46563],102:[.19444,.69444,.10764,.16667,.48959],103:[.19444,.43056,.03588,.02778,.47697],104:[0,.69444,0,0,.57616],105:[0,.65952,0,0,.34451],106:[.19444,.65952,.05724,0,.41181],107:[0,.69444,.03148,0,.5206],108:[0,.69444,.01968,.08334,.29838],109:[0,.43056,0,0,.87801],110:[0,.43056,0,0,.60023],111:M192,112:[.19444,.43056,0,.08334,.50313],113:[.19444,.43056,.03588,.08334,.44641],114:[0,.43056,.02778,.05556,.45116],115:[0,.43056,0,.05556,.46875],116:[0,.61508,0,.08334,.36111],117:[0,.43056,0,.02778,.57246],118:[0,.43056,.03588,.02778,.48472],119:[0,.43056,.02691,.08334,.71592],120:[0,.43056,0,.02778,.57153],121:[.19444,.43056,.03588,.05556,.49028],122:[0,.43056,.04398,.05556,.46505],160:M7,915:[0,.68333,.13889,.08334,.61528],916:[0,.68333,0,.16667,.83334],920:M190,923:[0,.68333,0,.16667,.69445],926:[0,.68333,.07569,.08334,.74236],928:M191,931:[0,.68333,.05764,.08334,.77986],933:[0,.68333,.13889,.05556,.58333],934:[0,.68333,0,.08334,.66667],936:[0,.68333,.11,.05556,.61222],937:[0,.68333,.05017,.08334,.7724],945:[0,.43056,.0037,.02778,.6397],946:[.19444,.69444,.05278,.08334,.56563],947:[.19444,.43056,.05556,0,.51773],948:[0,.69444,.03785,.05556,.44444],949:[0,.43056,0,.08334,.46632],950:[.19444,.69444,.07378,.08334,.4375],951:[.19444,.43056,.03588,.05556,.49653],952:[0,.69444,.02778,.08334,.46944],953:[0,.43056,0,.05556,.35394],954:[0,.43056,0,0,.57616],955:[0,.69444,0,0,.58334],956:[.19444,.43056,0,.02778,.60255],957:[0,.43056,.06366,.02778,.49398],958:[.19444,.69444,.04601,.11111,.4375],959:M192,960:[0,.43056,.03588,0,.57003],961:M193,962:[.09722,.43056,.07986,.08334,.36285],963:[0,.43056,.03588,0,.57141],964:[0,.43056,.1132,.02778,.43715],965:[0,.43056,.03588,.02778,.54028],966:[.19444,.43056,0,.08334,.65417],967:[.19444,.43056,0,.05556,.62569],968:[.19444,.69444,.03588,.11111,.65139],969:[0,.43056,.03588,0,.62245],977:[0,.69444,0,.08334,.59144],981:[.19444,.69444,0,.08334,.59583],982:[0,.43056,.02778,0,.82813],1009:M193,1013:[0,.43056,0,.05556,.4059],57649:[0,.43056,0,.02778,.32246],57911:[.19444,.43056,0,.08334,.38403]},"SansSerif-Bold":{32:M7,33:[0,.69444,0,0,.36667],34:M210,35:[.19444,.69444,0,0,.91667],36:[.05556,.75,0,0,.55],37:[.05556,.75,0,0,1.02912],38:[0,.69444,0,0,.83056],39:M206,40:M194,41:M194,42:[0,.75,0,0,.55],43:[.11667,.61667,0,0,.85556],44:[.10556,.13056,0,0,.30556],45:[0,.45833,0,0,.36667],46:[0,.13056,0,0,.30556],47:[.25,.75,0,0,.55],48:M195,49:M195,50:M195,51:M195,52:M195,53:M195,54:M195,55:M195,56:M195,57:M195,58:[0,.45833,0,0,.30556],59:[.10556,.45833,0,0,.30556],61:[-.09375,.40625,0,0,.85556],63:M198,64:M196,65:M196,66:M196,67:M199,68:M197,69:[0,.69444,0,0,.64167],70:M170,71:M196,72:M197,73:[0,.69444,0,0,.33056],74:M198,75:M200,76:M207,77:[0,.69444,0,0,.97778],78:M197,79:M197,80:M199,81:[.10556,.69444,0,0,.79445],82:M199,83:M170,84:M196,85:M200,86:[0,.69444,.01528,0,.73334],87:[0,.69444,.01528,0,1.03889],88:M196,89:[0,.69444,.0275,0,.73334],90:M208,91:M201,93:M201,94:M195,95:[.35,.10833,.03056,0,.55],97:[0,.45833,0,0,.525],98:M202,99:[0,.45833,0,0,.48889],100:M202,101:[0,.45833,0,0,.51111],102:[0,.69444,.07639,0,.33611],103:[.19444,.45833,.01528,0,.55],104:M202,105:M203,106:[.19444,.69444,0,0,.28611],107:[0,.69444,0,0,.53056],108:M203,109:[0,.45833,0,0,.86667],110:M205,111:[0,.45833,0,0,.55],112:M204,113:M204,114:[0,.45833,.01528,0,.37222],115:[0,.45833,0,0,.42167],116:[0,.58929,0,0,.40417],117:M205,118:[0,.45833,.01528,0,.5],119:[0,.45833,.01528,0,.74445],120:[0,.45833,0,0,.5],121:[.19444,.45833,.01528,0,.5],122:[0,.45833,0,0,.47639],126:[.35,.34444,0,0,.55],160:M7,168:M195,176:M196,180:M195,184:[.17014,0,0,0,.48889],305:[0,.45833,0,0,.25556],567:[.19444,.45833,0,0,.28611],710:M195,711:[0,.63542,0,0,.55],713:[0,.63778,0,0,.55],728:M195,729:M206,730:M196,732:M195,733:M195,915:M207,916:[0,.69444,0,0,.91667],920:M209,923:M208,926:M196,928:M197,931:M197,933:M209,934:M197,936:M209,937:M197,8211:[0,.45833,.03056,0,.55],8212:[0,.45833,.03056,0,1.10001],8216:M206,8217:M206,8220:M210,8221:M210},"SansSerif-Italic":{32:M7,33:[0,.69444,.05733,0,.31945],34:M219,35:[.19444,.69444,.05087,0,.83334],36:[.05556,.75,.11156,0,.5],37:[.05556,.75,.03126,0,.83334],38:[0,.69444,.03058,0,.75834],39:M218,40:[.25,.75,.13164,0,.38889],41:[.25,.75,.02536,0,.38889],42:[0,.75,.11775,0,.5],43:[.08333,.58333,.02536,0,.77778],44:M223,45:[0,.44444,.01946,0,.33333],46:M224,47:[.25,.75,.13164,0,.5],48:M211,49:M211,50:M211,51:M211,52:M211,53:M211,54:M211,55:M211,56:M211,57:M211,58:[0,.44444,.02502,0,.27778],59:[.125,.44444,.02502,0,.27778],61:[-.13,.37,.05087,0,.77778],63:[0,.69444,.11809,0,.47222],64:[0,.69444,.07555,0,.66667],65:M227,66:[0,.69444,.08293,0,.66667],67:[0,.69444,.11983,0,.63889],68:[0,.69444,.07555,0,.72223],69:[0,.69444,.11983,0,.59722],70:[0,.69444,.13372,0,.56945],71:[0,.69444,.11983,0,.66667],72:M212,73:[0,.69444,.13372,0,.27778],74:[0,.69444,.08094,0,.47222],75:[0,.69444,.11983,0,.69445],76:M229,77:[0,.69444,.08094,0,.875],78:M212,79:[0,.69444,.07555,0,.73611],80:[0,.69444,.08293,0,.63889],81:[.125,.69444,.07555,0,.73611],82:[0,.69444,.08293,0,.64584],83:[0,.69444,.09205,0,.55556],84:[0,.69444,.13372,0,.68056],85:[0,.69444,.08094,0,.6875],86:[0,.69444,.1615,0,.66667],87:[0,.69444,.1615,0,.94445],88:[0,.69444,.13372,0,.66667],89:[0,.69444,.17261,0,.66667],90:[0,.69444,.11983,0,.61111],91:[.25,.75,.15942,0,.28889],93:[.25,.75,.08719,0,.28889],94:M214,95:[.35,.09444,.08616,0,.5],97:[0,.44444,.00981,0,.48056],98:[0,.69444,.03057,0,.51667],99:[0,.44444,.08336,0,.44445],100:[0,.69444,.09483,0,.51667],101:[0,.44444,.06778,0,.44445],102:[0,.69444,.21705,0,.30556],103:[.19444,.44444,.10836,0,.5],104:[0,.69444,.01778,0,.51667],105:[0,.67937,.09718,0,.23889],106:[.19444,.67937,.09162,0,.26667],107:[0,.69444,.08336,0,.48889],108:[0,.69444,.09483,0,.23889],109:[0,.44444,.01778,0,.79445],110:[0,.44444,.01778,0,.51667],111:[0,.44444,.06613,0,.5],112:[.19444,.44444,.0389,0,.51667],113:[.19444,.44444,.04169,0,.51667],114:[0,.44444,.10836,0,.34167],115:[0,.44444,.0778,0,.38333],116:[0,.57143,.07225,0,.36111],117:[0,.44444,.04169,0,.51667],118:[0,.44444,.10836,0,.46111],119:[0,.44444,.10836,0,.68334],120:[0,.44444,.09169,0,.46111],121:[.19444,.44444,.10836,0,.46111],122:[0,.44444,.08752,0,.43472],126:[.35,.32659,.08826,0,.5],160:M7,168:[0,.67937,.06385,0,.5],176:M215,184:M213,305:[0,.44444,.04169,0,.23889],567:[.19444,.44444,.04169,0,.26667],710:M214,711:[0,.63194,.08432,0,.5],713:[0,.60889,.08776,0,.5],714:M216,715:M143,728:[0,.69444,.09483,0,.5],729:[0,.67937,.07774,0,.27778],730:M215,732:[0,.67659,.08826,0,.5],733:M216,915:[0,.69444,.13372,0,.54167],916:M237,920:[0,.69444,.07555,0,.77778],923:M170,926:[0,.69444,.12816,0,.66667],928:M212,931:[0,.69444,.11983,0,.72222],933:M217,934:[0,.69444,.04603,0,.72222],936:M217,937:[0,.69444,.08293,0,.72222],8211:[0,.44444,.08616,0,.5],8212:[0,.44444,.08616,0,1],8216:M218,8217:M218,8220:[0,.69444,.14205,0,.5],8221:M219},"SansSerif-Regular":{32:M7,33:[0,.69444,0,0,.31945],34:M143,35:M220,36:M161,37:M221,38:[0,.69444,0,0,.75834],39:M133,40:M134,41:M134,42:M222,43:M149,44:M223,45:[0,.44444,0,0,.33333],46:M224,47:M141,48:M225,49:M225,50:M225,51:M225,52:M225,53:M225,54:M225,55:M225,56:M225,57:M225,58:[0,.44444,0,0,.27778],59:[.125,.44444,0,0,.27778],61:[-.13,.37,0,0,.77778],63:M226,64:M227,65:M227,66:M227,67:M75,68:[0,.69444,0,0,.72223],69:M228,70:[0,.69444,0,0,.56945],71:M227,72:M230,73:M133,74:M226,75:[0,.69444,0,0,.69445],76:M229,77:[0,.69444,0,0,.875],78:M230,79:[0,.69444,0,0,.73611],80:M75,81:[.125,.69444,0,0,.73611],82:[0,.69444,0,0,.64584],83:M144,84:[0,.69444,0,0,.68056],85:[0,.69444,0,0,.6875],86:[0,.69444,.01389,0,.66667],87:[0,.69444,.01389,0,.94445],88:M227,89:[0,.69444,.025,0,.66667],90:M170,91:M231,93:M231,94:M143,95:[.35,.09444,.02778,0,.5],97:[0,.44444,0,0,.48056],98:M232,99:M233,100:M232,101:M233,102:[0,.69444,.06944,0,.30556],103:[.19444,.44444,.01389,0,.5],104:M232,105:[0,.67937,0,0,.23889],106:[.19444,.67937,0,0,.26667],107:[0,.69444,0,0,.48889],108:[0,.69444,0,0,.23889],109:[0,.44444,0,0,.79445],110:M236,111:[0,.44444,0,0,.5],112:M234,113:M234,114:[0,.44444,.01389,0,.34167],115:M235,116:[0,.57143,0,0,.36111],117:M236,118:[0,.44444,.01389,0,.46111],119:[0,.44444,.01389,0,.68334],120:[0,.44444,0,0,.46111],121:[.19444,.44444,.01389,0,.46111],122:[0,.44444,0,0,.43472],126:[.35,.32659,0,0,.5],160:M7,168:[0,.67937,0,0,.5],176:M227,184:M213,305:[0,.44444,0,0,.23889],567:[.19444,.44444,0,0,.26667],710:M143,711:[0,.63194,0,0,.5],713:[0,.60889,0,0,.5],714:M143,715:M143,728:M143,729:[0,.67937,0,0,.27778],730:M227,732:[0,.67659,0,0,.5],733:M143,915:M229,916:M237,920:M136,923:M170,926:M227,928:M230,931:M156,933:M136,934:M156,936:M136,937:M156,8211:[0,.44444,.02778,0,.5],8212:[0,.44444,.02778,0,1],8216:M133,8217:M133,8220:M143,8221:M143},"Script-Regular":{32:M7,65:[0,.7,.22925,0,.80253],66:[0,.7,.04087,0,.90757],67:[0,.7,.1689,0,.66619],68:[0,.7,.09371,0,.77443],69:[0,.7,.18583,0,.56162],70:[0,.7,.13634,0,.89544],71:[0,.7,.17322,0,.60961],72:[0,.7,.29694,0,.96919],73:[0,.7,.19189,0,.80907],74:[.27778,.7,.19189,0,1.05159],75:[0,.7,.31259,0,.91364],76:[0,.7,.19189,0,.87373],77:[0,.7,.15981,0,1.08031],78:[0,.7,.3525,0,.9015],79:[0,.7,.08078,0,.73787],80:[0,.7,.08078,0,1.01262],81:[0,.7,.03305,0,.88282],82:[0,.7,.06259,0,.85],83:[0,.7,.19189,0,.86767],84:[0,.7,.29087,0,.74697],85:[0,.7,.25815,0,.79996],86:[0,.7,.27523,0,.62204],87:[0,.7,.27523,0,.80532],88:[0,.7,.26006,0,.94445],89:[0,.7,.2939,0,.70961],90:[0,.7,.24037,0,.8212],160:M7},"Size1-Regular":{32:M7,40:M238,41:M238,47:M239,91:M240,92:M239,93:M240,123:M241,125:M241,160:M7,710:M242,732:M242,770:M242,771:M242,8214:[-99e-5,.601,0,0,.77778],8593:M243,8595:M243,8657:M244,8659:M244,8719:M245,8720:M245,8721:[.25001,.75,0,0,1.05556],8730:[.35001,.85,0,0,1],8739:[-.00599,.606,0,0,.33333],8741:[-.00599,.606,0,0,.55556],8747:M247,8748:M246,8749:M246,8750:M247,8896:M248,8897:M248,8898:M248,8899:M248,8968:M249,8969:M249,8970:M249,8971:M249,9168:M277,10216:M249,10217:M249,10752:M250,10753:M250,10754:M250,10756:M248,10758:M248},"Size2-Regular":{32:M7,40:M251,41:M251,47:M252,91:M253,92:M252,93:M253,123:M254,125:M254,160:M7,710:M255,732:M255,770:M255,771:M255,8719:M256,8720:M256,8721:[.55001,1.05,0,0,1.44445],8730:[.65002,1.15,0,0,1],8747:M258,8748:M257,8749:M257,8750:M258,8896:M259,8897:M259,8898:M259,8899:M259,8968:M260,8969:M260,8970:M260,8971:M260,10216:M261,10217:M261,10752:M262,10753:M262,10754:M262,10756:M259,10758:M259},"Size3-Regular":{32:M7,40:M263,41:M263,47:M264,91:M265,92:M264,93:M265,123:M266,125:M266,160:M7,710:M267,732:M267,770:M267,771:M267,8730:[.95003,1.45,0,0,1],8968:M268,8969:M268,8970:M268,8971:M268,10216:M266,10217:M266},"Size4-Regular":{32:M7,40:M269,41:M269,47:M270,91:M271,92:M270,93:M271,123:M272,125:M272,160:M7,710:M273,732:M273,770:M273,771:M273,8730:[1.25003,1.75,0,0,1],8968:M274,8969:M274,8970:M274,8971:M274,9115:M275,9116:M276,9117:M275,9118:M275,9119:M276,9120:M275,9121:M278,9122:M277,9123:M278,9124:M278,9125:M277,9126:M278,9127:M279,9128:M280,9129:M281,9130:[0,.3,0,0,.88889],9131:M279,9132:M280,9133:M281,9143:[.88502,.915,0,0,1.05556],10216:M272,10217:M272,57344:M282,57345:M282,57680:M283,57681:M283,57682:M283,57683:M283},"Typewriter-Regular":{32:M290,33:M284,34:M284,35:M284,36:M285,37:M285,38:M284,39:M284,40:M285,41:M285,42:[0,.52083,0,0,.525],43:M286,44:[.13889,.125,0,0,.525],45:M286,46:[0,.125,0,0,.525],47:M285,48:M284,49:M284,50:M284,51:M284,52:M284,53:M284,54:M284,55:M284,56:M284,57:M284,58:M288,59:[.13889,.43056,0,0,.525],60:M287,61:[-.19549,.41562,0,0,.525],62:M287,63:M284,64:M284,65:M284,66:M284,67:M284,68:M284,69:M284,70:M284,71:M284,72:M284,73:M284,74:M284,75:M284,76:M284,77:M284,78:M284,79:M284,80:M284,81:[.13889,.61111,0,0,.525],82:M284,83:M284,84:M284,85:M284,86:M284,87:M284,88:M284,89:M284,90:M284,91:M285,92:M285,93:M285,94:M284,95:[.09514,0,0,0,.525],96:M284,97:M288,98:M284,99:M288,100:M284,101:M288,102:M284,103:M289,104:M284,105:M284,106:[.22222,.61111,0,0,.525],107:M284,108:M284,109:M288,110:M288,111:M288,112:M289,113:M289,114:M288,115:M288,116:[0,.55358,0,0,.525],117:M288,118:M288,119:M288,120:M288,121:M289,122:M288,123:M285,124:M285,125:M285,126:M284,127:M284,160:M290,176:M284,184:[.19445,0,0,0,.525],305:M288,567:M289,711:[0,.56597,0,0,.525],713:[0,.56555,0,0,.525],714:M284,715:M284,728:M284,730:M284,770:M284,771:M284,776:M284,915:M284,916:M284,920:M284,923:M284,926:M284,928:M284,931:M284,933:M284,934:M284,936:M284,937:M284,8216:M284,8217:M284,8242:M284,9251:[.11111,.21944,0,0,.525]}},CJK_REGEX=/[\u3040-\u309F]|[\u30A0-\u30FF]|[\u4E00-\u9FAF]|[\uAC00-\uD7AF]/,FONT_METRICS={slant:[.25,.25,.25],space:[0,0,0],stretch:[0,0,0],shrink:[0,0,0],xHeight:[.431,.431,.431],quad:[1,1.171,1.472],extraSpace:[0,0,0],num1:[.5,.732,.925],num2:[.394,.384,.5],num3:[.444,.471,.504],denom1:[.686,.752,1.025],denom2:[.345,.344,.532],sup1:[.413,.503,.504],sup2:[.363,.431,.404],sup3:[.289,.286,.294],sub1:[.15,.143,.2],sub2:[.247,.286,.4],supDrop:[.386,.353,.494],subDrop:[.05,.071,.1],delim1:[2.39,1.7,1.98],delim2:[1.01,1.157,1.42],axisHeight:[.25,.25,.25],defaultRuleThickness:[.04,.049,.049],bigOpSpacing1:[.111,.111,.111],bigOpSpacing2:[.166,.166,.166],bigOpSpacing3:[.2,.2,.2],bigOpSpacing4:[.6,.611,.611],bigOpSpacing5:[.1,.143,.143],sqrtRuleThickness:[.04,.04,.04]},FONT_SCALE=[0,.5,.7,.8,.9,1,1.2,1.44,1.728,2.074,2.488],extraCharacterMap={" ":" ","​":" ","Å":"A","Ç":"C","Ð":"D","Þ":"o","å":"a","ç":"c","ð":"d","þ":"o","А":"A","Б":"B","В":"B","Г":"F","Д":"A","Е":"E","Ж":"K","З":"3","И":"N","Й":"N","К":"K","Л":"N","М":"M","Н":"H","О":"O","П":"N","Р":"P","С":"C","Т":"T","У":"y","Ф":"O","Х":"X","Ц":"U","Ч":"h","Ш":"W","Щ":"W","Ъ":"B","Ы":"X","Ь":"B","Э":"3","Ю":"X","Я":"R","а":"a","б":"b","в":"a","г":"r","д":"y","е":"e","ж":"m","з":"e","и":"n","й":"n","к":"n","л":"n","м":"m","н":"n","о":"o","п":"n","р":"p","с":"c","т":"o","у":"y","ф":"b","х":"x","ц":"n","ч":"n","ш":"w","щ":"w","ъ":"a","ы":"m","ь":"a","э":"e","ю":"m","я":"r"};function getCharacterMetrics(codepoint,fontName){void 0===codepoint&&(codepoint=77);var metrics=font_metrics_data_default[fontName][codepoint];if(metrics)return{defaultMetrics:!1,depth:metrics[0],height:metrics[1],italic:metrics[2],skew:metrics[3],width:metrics[4]};if(11034===codepoint)return{defaultMetrics:!0,depth:.2,height:.8,italic:0,skew:0,width:.8};var char=String.fromCodePoint(codepoint);if(char in extraCharacterMap)codepoint=extraCharacterMap[char].codePointAt(0);else if(CJK_REGEX.test(char))return codepoint=77,{defaultMetrics:!0,depth:.2,height:.9,italic:0,skew:0,width:1};return{defaultMetrics:!0,depth:.2,height:.7,italic:0,skew:0,width:.8}}var emojiCombinator,SVG_BODY={overrightarrow:[["rightarrow"],.888,522,"xMaxYMin"],overleftarrow:[["leftarrow"],.888,522,"xMinYMin"],underrightarrow:[["rightarrow"],.888,522,"xMaxYMin"],underleftarrow:[["leftarrow"],.888,522,"xMinYMin"],xrightarrow:[["rightarrow"],1.469,522,"xMaxYMin"],longrightarrow:[["rightarrow"],1.469,522,"xMaxYMin"],xleftarrow:[["leftarrow"],1.469,522,"xMinYMin"],longleftarrow:[["leftarrow"],1.469,522,"xMinYMin"],Overrightarrow:[["doublerightarrow"],.888,560,"xMaxYMin"],xRightarrow:[["doublerightarrow"],1.526,560,"xMaxYMin"],xLeftarrow:[["doubleleftarrow"],1.526,560,"xMinYMin"],overleftharpoon:[["leftharpoon"],.888,522,"xMinYMin"],xleftharpoonup:[["leftharpoon"],.888,522,"xMinYMin"],xleftharpoondown:[["leftharpoondown"],.888,522,"xMinYMin"],overrightharpoon:[["rightharpoon"],.888,522,"xMaxYMin"],xrightharpoonup:[["rightharpoon"],.888,522,"xMaxYMin"],xrightharpoondown:[["rightharpoondown"],.888,522,"xMaxYMin"],xlongequal:[["longequal"],.888,334,"xMinYMin"],xtwoheadleftarrow:[["twoheadleftarrow"],.888,334,"xMinYMin"],xtwoheadrightarrow:[["twoheadrightarrow"],.888,334,"xMaxYMin"],overleftrightarrow:[["leftarrow","rightarrow"],.888,522],overbrace:[["leftbrace","midbrace","rightbrace"],1.6,548],underbrace:[["leftbraceunder","midbraceunder","rightbraceunder"],1.6,548],underleftrightarrow:[["leftarrow","rightarrow"],.888,522],xleftrightarrow:[["leftarrow","rightarrow"],1.75,522],longleftrightarrow:[["leftarrow","rightarrow"],1.75,522],xLeftrightarrow:[["doubleleftarrow","doublerightarrow"],1.75,560],xrightleftharpoons:[["leftharpoondownplus","rightharpoonplus"],1.75,716],longrightleftharpoons:[["leftharpoondownplus","rightharpoonplus"],1.75,716],xleftrightharpoons:[["leftharpoonplus","rightharpoondownplus"],1.75,716],longleftrightharpoons:[["leftharpoonplus","rightharpoondownplus"],1.75,716],xhookleftarrow:[["leftarrow","righthook"],1.08,522],xhookrightarrow:[["lefthook","rightarrow"],1.08,522],overlinesegment:[["leftlinesegment","rightlinesegment"],.888,522],underlinesegment:[["leftlinesegment","rightlinesegment"],.888,522],overgroup:[["leftgroup","rightgroup"],.888,342],undergroup:[["leftgroupunder","rightgroupunder"],.888,342],xmapsto:[["leftmapsto","rightarrow"],1.5,522],xtofrom:[["leftToFrom","rightToFrom"],1.75,528],xleftrightarrows:[["baraboveleftarrow","rightarrowabovebar"],1.75,901],longleftrightarrows:[["baraboveleftarrow","rightarrowabovebar"],1.75,901],xRightleftharpoons:[["baraboveshortleftharpoon","rightharpoonaboveshortbar"],1.75,716],longRightleftharpoons:[["baraboveshortleftharpoon","rightharpoonaboveshortbar"],1.75,716],xLeftrightharpoons:[["shortbaraboveleftharpoon","shortrightharpoonabovebar"],1.75,716],longLeftrightharpoons:[["shortbaraboveleftharpoon","shortrightharpoonabovebar"],1.75,716]},SVG_ACCENTS={widehat1:[1062,239,.24],widehat2:[2364,300,.3],widehat3:[2364,360,.36],widehat4:[2364,420,.42],widecheck1:[1062,239,.24],widecheck2:[2364,300,.3],widecheck3:[2364,360,.36],widecheck4:[2364,420,.42],widetilde1:[600,260,.26],widetilde2:[1033,286,.286],widetilde3:[2339,306,.306],widetilde4:[2340,312,.34],overarc:[1061,159,.3],underarc:[1061,159,.3]},PATHS={doubleleftarrow:"M262 157\nl10-10c34-36 62.7-77 86-123 3.3-8 5-13.3 5-16 0-5.3-6.7-8-20-8-7.3\n 0-12.2.5-14.5 1.5-2.3 1-4.8 4.5-7.5 10.5-49.3 97.3-121.7 169.3-217 216-28\n 14-57.3 25-88 33-6.7 2-11 3.8-13 5.5-2 1.7-3 4.2-3 7.5s1 5.8 3 7.5\nc2 1.7 6.3 3.5 13 5.5 68 17.3 128.2 47.8 180.5 91.5 52.3 43.7 93.8 96.2 124.5\n 157.5 9.3 8 15.3 12.3 18 13h6c12-.7 18-4 18-10 0-2-1.7-7-5-15-23.3-46-52-87\n-86-123l-10-10h399738v-40H218c328 0 0 0 0 0l-10-8c-26.7-20-65.7-43-117-69 2.7\n-2 6-3.7 10-5 36.7-16 72.3-37.3 107-64l10-8h399782v-40z\nm8 0v40h399730v-40zm0 194v40h399730v-40z",doublerightarrow:"M399738 392l\n-10 10c-34 36-62.7 77-86 123-3.3 8-5 13.3-5 16 0 5.3 6.7 8 20 8 7.3 0 12.2-.5\n 14.5-1.5 2.3-1 4.8-4.5 7.5-10.5 49.3-97.3 121.7-169.3 217-216 28-14 57.3-25 88\n-33 6.7-2 11-3.8 13-5.5 2-1.7 3-4.2 3-7.5s-1-5.8-3-7.5c-2-1.7-6.3-3.5-13-5.5-68\n-17.3-128.2-47.8-180.5-91.5-52.3-43.7-93.8-96.2-124.5-157.5-9.3-8-15.3-12.3-18\n-13h-6c-12 .7-18 4-18 10 0 2 1.7 7 5 15 23.3 46 52 87 86 123l10 10H0v40h399782\nc-328 0 0 0 0 0l10 8c26.7 20 65.7 43 117 69-2.7 2-6 3.7-10 5-36.7 16-72.3 37.3\n-107 64l-10 8H0v40zM0 157v40h399730v-40zm0 194v40h399730v-40z",leftarrow:"M400000 241H110l3-3c68.7-52.7 113.7-120\n 135-202 4-14.7 6-23 6-25 0-7.3-7-11-21-11-8 0-13.2.8-15.5 2.5-2.3 1.7-4.2 5.8\n-5.5 12.5-1.3 4.7-2.7 10.3-4 17-12 48.7-34.8 92-68.5 130S65.3 228.3 18 247\nc-10 4-16 7.7-18 11 0 8.7 6 14.3 18 17 47.3 18.7 87.8 47 121.5 85S196 441.3 208\n 490c.7 2 1.3 5 2 9s1.2 6.7 1.5 8c.3 1.3 1 3.3 2 6s2.2 4.5 3.5 5.5c1.3 1 3.3\n 1.8 6 2.5s6 1 10 1c14 0 21-3.7 21-11 0-2-2-10.3-6-25-20-79.3-65-146.7-135-202\n l-3-3h399890zM100 241v40h399900v-40z",leftbrace:"M6 548l-6-6v-35l6-11c56-104 135.3-181.3 238-232 57.3-28.7 117\n-45 179-50h399577v120H403c-43.3 7-81 15-113 26-100.7 33-179.7 91-237 174-2.7\n 5-6 9-10 13-.7 1-7.3 1-20 1H6z",leftbraceunder:"M0 6l6-6h17c12.688 0 19.313.3 20 1 4 4 7.313 8.3 10 13\n 35.313 51.3 80.813 93.8 136.5 127.5 55.688 33.7 117.188 55.8 184.5 66.5.688\n 0 2 .3 4 1 18.688 2.7 76 4.3 172 5h399450v120H429l-6-1c-124.688-8-235-61.7\n-331-161C60.687 138.7 32.312 99.3 7 54L0 41V6z",overarc:"M529 0c179 0 524 115 524 115 5 1 9 5 9 10 0 1-1 2-1 3l-4 22c-1 5-5 9-11 9h-2s-338-93-512-92c-174 0-513 92-513 92h-2c-5 0-9-4-11-9l-5-22c-1-6 2-12 8-13 0 0 342-115 520-115z",underarc:"m 529 160\n  c -179 0 -524 -115 -524 -115\n  c -5 -1 -9 -5 -9 -10\n  c 0 -1 1 -2 1 -3\n  l 4 -22\n  c 1 -5 5 -9 11 -9\n  h 2\n  s 338 93 512 92\n  c 174 0 513 -92 513 -92\n  h 2\n  c 5 0 9 4 11 9\n  l 5 22\n  c 1 6 -2 12 -8 13\n  c 0 0 -342 115 -520 115\n  z\n  ",leftgroup:"M400000 80\nH435C64 80 168.3 229.4 21 260c-5.9 1.2-18 0-18 0-2 0-3-1-3-3v-38C76 61 257 0\n 435 0h399565z",leftgroupunder:"M400000 262\nH435C64 262 168.3 112.6 21 82c-5.9-1.2-18 0-18 0-2 0-3 1-3 3v38c76 158 257 219\n 435 219h399565z",leftharpoon:"M0 267c.7 5.3 3 10 7 14h399993v-40H93c3.3\n-3.3 10.2-9.5 20.5-18.5s17.8-15.8 22.5-20.5c50.7-52 88-110.3 112-175 4-11.3 5\n-18.3 3-21-1.3-4-7.3-6-18-6-8 0-13 .7-15 2s-4.7 6.7-8 16c-42 98.7-107.3 174.7\n-196 228-6.7 4.7-10.7 8-12 10-1.3 2-2 5.7-2 11zm100-26v40h399900v-40z",leftharpoonplus:"M0 267c.7 5.3 3 10 7 14h399993v-40H93c3.3-3.3 10.2-9.5\n 20.5-18.5s17.8-15.8 22.5-20.5c50.7-52 88-110.3 112-175 4-11.3 5-18.3 3-21-1.3\n-4-7.3-6-18-6-8 0-13 .7-15 2s-4.7 6.7-8 16c-42 98.7-107.3 174.7-196 228-6.7 4.7\n-10.7 8-12 10-1.3 2-2 5.7-2 11zm100-26v40h399900v-40zM0 435v40h400000v-40z\nm0 0v40h400000v-40z",leftharpoondown:"M7 241c-4 4-6.333 8.667-7 14 0 5.333.667 9 2 11s5.333\n 5.333 12 10c90.667 54 156 130 196 228 3.333 10.667 6.333 16.333 9 17 2 .667 5\n 1 9 1h5c10.667 0 16.667-2 18-6 2-2.667 1-9.667-3-21-32-87.333-82.667-157.667\n-152-211l-3-3h399907v-40zM93 281 H400000 v-40L7 241z",leftharpoondownplus:"M7 435c-4 4-6.3 8.7-7 14 0 5.3.7 9 2 11s5.3 5.3 12\n 10c90.7 54 156 130 196 228 3.3 10.7 6.3 16.3 9 17 2 .7 5 1 9 1h5c10.7 0 16.7\n-2 18-6 2-2.7 1-9.7-3-21-32-87.3-82.7-157.7-152-211l-3-3h399907v-40H7zm93 0\nv40h399900v-40zM0 241v40h399900v-40zm0 0v40h399900v-40z",lefthook:"M400000 281 H103s-33-11.2-61-33.5S0 197.3 0 164s14.2-61.2 42.5\n-83.5C70.8 58.2 104 47 142 47 c16.7 0 25 6.7 25 20 0 12-8.7 18.7-26 20-40 3.3\n-68.7 15.7-86 37-10 12-15 25.3-15 40 0 22.7 9.8 40.7 29.5 54 19.7 13.3 43.5 21\n 71.5 23h399859zM103 281v-40h399897v40z",leftlinesegment:"M40 281 V428 H0 V94 H40 V241 H400000 v40z\nM40 281 V428 H0 V94 H40 V241 H400000 v40z",leftmapsto:"M40 281 V448H0V74H40V241H400000v40z\nM40 281 V448H0V74H40V241H400000v40z",leftToFrom:"M0 147h400000v40H0zm0 214c68 40 115.7 95.7 143 167h22c15.3 0 23\n-.3 23-1 0-1.3-5.3-13.7-16-37-18-35.3-41.3-69-70-101l-7-8h399905v-40H95l7-8\nc28.7-32 52-65.7 70-101 10.7-23.3 16-35.7 16-37 0-.7-7.7-1-23-1h-22C115.7 265.3\n 68 321 0 361zm0-174v-40h399900v40zm100 154v40h399900v-40z",longequal:"M0 50 h400000 v40H0z m0 194h40000v40H0z\nM0 50 h400000 v40H0z m0 194h40000v40H0z",midbrace:"M200428 334\nc-100.7-8.3-195.3-44-280-108-55.3-42-101.7-93-139-153l-9-14c-2.7 4-5.7 8.7-9 14\n-53.3 86.7-123.7 153-211 199-66.7 36-137.3 56.3-212 62H0V214h199568c178.3-11.7\n 311.7-78.3 403-201 6-8 9.7-12 11-12 .7-.7 6.7-1 18-1s17.3.3 18 1c1.3 0 5 4 11\n 12 44.7 59.3 101.3 106.3 170 141s145.3 54.3 229 60h199572v120z",midbraceunder:"M199572 214\nc100.7 8.3 195.3 44 280 108 55.3 42 101.7 93 139 153l9 14c2.7-4 5.7-8.7 9-14\n 53.3-86.7 123.7-153 211-199 66.7-36 137.3-56.3 212-62h199568v120H200432c-178.3\n 11.7-311.7 78.3-403 201-6 8-9.7 12-11 12-.7.7-6.7 1-18 1s-17.3-.3-18-1c-1.3 0\n-5-4-11-12-44.7-59.3-101.3-106.3-170-141s-145.3-54.3-229-60H0V214z",oiintSize1:"M512.6 71.6c272.6 0 320.3 106.8 320.3 178.2 0 70.8-47.7 177.6\n-320.3 177.6S193.1 320.6 193.1 249.8c0-71.4 46.9-178.2 319.5-178.2z\nm368.1 178.2c0-86.4-60.9-215.4-368.1-215.4-306.4 0-367.3 129-367.3 215.4 0 85.8\n60.9 214.8 367.3 214.8 307.2 0 368.1-129 368.1-214.8z",oiintSize2:"M757.8 100.1c384.7 0 451.1 137.6 451.1 230 0 91.3-66.4 228.8\n-451.1 228.8-386.3 0-452.7-137.5-452.7-228.8 0-92.4 66.4-230 452.7-230z\nm502.4 230c0-111.2-82.4-277.2-502.4-277.2s-504 166-504 277.2\nc0 110 84 276 504 276s502.4-166 502.4-276z",oiiintSize1:"M681.4 71.6c408.9 0 480.5 106.8 480.5 178.2 0 70.8-71.6 177.6\n-480.5 177.6S202.1 320.6 202.1 249.8c0-71.4 70.5-178.2 479.3-178.2z\nm525.8 178.2c0-86.4-86.8-215.4-525.7-215.4-437.9 0-524.7 129-524.7 215.4 0\n85.8 86.8 214.8 524.7 214.8 438.9 0 525.7-129 525.7-214.8z",oiiintSize2:"M1021.2 53c603.6 0 707.8 165.8 707.8 277.2 0 110-104.2 275.8\n-707.8 275.8-606 0-710.2-165.8-710.2-275.8C311 218.8 415.2 53 1021.2 53z\nm770.4 277.1c0-131.2-126.4-327.6-770.5-327.6S248.4 198.9 248.4 330.1\nc0 130 128.8 326.4 772.7 326.4s770.5-196.4 770.5-326.4z",rightarrow:"M0 241v40h399891c-47.3 35.3-84 78-110 128\n-16.7 32-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20\n 11 8 0 13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7\n 39-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85\n-40.5-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5\n-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67\n 151.7 139 205zm0 0v40h399900v-40z",rightbrace:"M400000 542l\n-6 6h-17c-12.7 0-19.3-.3-20-1-4-4-7.3-8.3-10-13-35.3-51.3-80.8-93.8-136.5-127.5\ns-117.2-55.8-184.5-66.5c-.7 0-2-.3-4-1-18.7-2.7-76-4.3-172-5H0V214h399571l6 1\nc124.7 8 235 61.7 331 161 31.3 33.3 59.7 72.7 85 118l7 13v35z",rightbraceunder:"M399994 0l6 6v35l-6 11c-56 104-135.3 181.3-238 232-57.3\n 28.7-117 45-179 50H-300V214h399897c43.3-7 81-15 113-26 100.7-33 179.7-91 237\n-174 2.7-5 6-9 10-13 .7-1 7.3-1 20-1h17z",rightgroup:"M0 80h399565c371 0 266.7 149.4 414 180 5.9 1.2 18 0 18 0 2 0\n 3-1 3-3v-38c-76-158-257-219-435-219H0z",rightgroupunder:"M0 262h399565c371 0 266.7-149.4 414-180 5.9-1.2 18 0 18\n 0 2 0 3 1 3 3v38c-76 158-257 219-435 219H0z",rightharpoon:"M0 241v40h399993c4.7-4.7 7-9.3 7-14 0-9.3\n-3.7-15.3-11-18-92.7-56.7-159-133.7-199-231-3.3-9.3-6-14.7-8-16-2-1.3-7-2-15-2\n-10.7 0-16.7 2-18 6-2 2.7-1 9.7 3 21 15.3 42 36.7 81.8 64 119.5 27.3 37.7 58\n 69.2 92 94.5zm0 0v40h399900v-40z",rightharpoonplus:"M0 241v40h399993c4.7-4.7 7-9.3 7-14 0-9.3-3.7-15.3-11\n-18-92.7-56.7-159-133.7-199-231-3.3-9.3-6-14.7-8-16-2-1.3-7-2-15-2-10.7 0-16.7\n 2-18 6-2 2.7-1 9.7 3 21 15.3 42 36.7 81.8 64 119.5 27.3 37.7 58 69.2 92 94.5z\nm0 0v40h399900v-40z m100 194v40h399900v-40zm0 0v40h399900v-40z",rightharpoondown:"M399747 511c0 7.3 6.7 11 20 11 8 0 13-.8 15-2.5s4.7-6.8\n 8-15.5c40-94 99.3-166.3 178-217 13.3-8 20.3-12.3 21-13 5.3-3.3 8.5-5.8 9.5\n-7.5 1-1.7 1.5-5.2 1.5-10.5s-2.3-10.3-7-15H0v40h399908c-34 25.3-64.7 57-92 95\n-27.3 38-48.7 77.7-64 119-3.3 8.7-5 14-5 16zM0 241v40h399900v-40z",rightharpoondownplus:"M399747 705c0 7.3 6.7 11 20 11 8 0 13-.8\n 15-2.5s4.7-6.8 8-15.5c40-94 99.3-166.3 178-217 13.3-8 20.3-12.3 21-13 5.3-3.3\n 8.5-5.8 9.5-7.5 1-1.7 1.5-5.2 1.5-10.5s-2.3-10.3-7-15H0v40h399908c-34 25.3\n-64.7 57-92 95-27.3 38-48.7 77.7-64 119-3.3 8.7-5 14-5 16zM0 435v40h399900v-40z\nm0-194v40h400000v-40zm0 0v40h400000v-40z",righthook:"M399859 241c-764 0 0 0 0 0 40-3.3 68.7-15.7 86-37 10-12 15-25.3\n 15-40 0-22.7-9.8-40.7-29.5-54-19.7-13.3-43.5-21-71.5-23-17.3-1.3-26-8-26-20 0\n-13.3 8.7-20 26-20 38 0 71 11.2 99 33.5 0 0 7 5.6 21 16.7 14 11.2 21 33.5 21\n 66.8s-14 61.2-42 83.5c-28 22.3-61 33.5-99 33.5L0 241z M0 281v-40h399859v40z",rightlinesegment:"M399960 241 V94 h40 V428 h-40 V281 H0 v-40z\nM399960 241 V94 h40 V428 h-40 V281 H0 v-40z",rightToFrom:"M400000 167c-70.7-42-118-97.7-142-167h-23c-15.3 0-23 .3-23\n 1 0 1.3 5.3 13.7 16 37 18 35.3 41.3 69 70 101l7 8H0v40h399905l-7 8c-28.7 32\n-52 65.7-70 101-10.7 23.3-16 35.7-16 37 0 .7 7.7 1 23 1h23c24-69.3 71.3-125 142\n-167z M100 147v40h399900v-40zM0 341v40h399900v-40z",twoheadleftarrow:"M0 167c68 40\n 115.7 95.7 143 167h22c15.3 0 23-.3 23-1 0-1.3-5.3-13.7-16-37-18-35.3-41.3-69\n-70-101l-7-8h125l9 7c50.7 39.3 85 86 103 140h46c0-4.7-6.3-18.7-19-42-18-35.3\n-40-67.3-66-96l-9-9h399716v-40H284l9-9c26-28.7 48-60.7 66-96 12.7-23.333 19\n-37.333 19-42h-46c-18 54-52.3 100.7-103 140l-9 7H95l7-8c28.7-32 52-65.7 70-101\n 10.7-23.333 16-35.7 16-37 0-.7-7.7-1-23-1h-22C115.7 71.3 68 127 0 167z",twoheadrightarrow:"M400000 167\nc-68-40-115.7-95.7-143-167h-22c-15.3 0-23 .3-23 1 0 1.3 5.3 13.7 16 37 18 35.3\n 41.3 69 70 101l7 8h-125l-9-7c-50.7-39.3-85-86-103-140h-46c0 4.7 6.3 18.7 19 42\n 18 35.3 40 67.3 66 96l9 9H0v40h399716l-9 9c-26 28.7-48 60.7-66 96-12.7 23.333\n-19 37.333-19 42h46c18-54 52.3-100.7 103-140l9-7h125l-7 8c-28.7 32-52 65.7-70\n 101-10.7 23.333-16 35.7-16 37 0 .7 7.7 1 23 1h22c27.3-71.3 75-127 143-167z",widetilde1:"M200 55.538c-77 0-168 73.953-177 73.953-3 0-7\n-2.175-9-5.437L2 97c-1-2-2-4-2-6 0-4 2-7 5-9l20-12C116 12 171 0 207 0c86 0\n 114 68 191 68 78 0 168-68 177-68 4 0 7 2 9 5l12 19c1 2.175 2 4.35 2 6.525 0\n 4.35-2 7.613-5 9.788l-19 13.05c-92 63.077-116.937 75.308-183 76.128\n-68.267.847-113-73.952-191-73.952z",widetilde2:"M344 55.266c-142 0-300.638 81.316-311.5 86.418\n-8.01 3.762-22.5 10.91-23.5 5.562L1 120c-1-2-1-3-1-4 0-5 3-9 8-10l18.4-9C160.9\n 31.9 283 0 358 0c148 0 188 122 331 122s314-97 326-97c4 0 8 2 10 7l7 21.114\nc1 2.14 1 3.21 1 4.28 0 5.347-3 9.626-7 10.696l-22.3 12.622C852.6 158.372 751\n 181.476 676 181.476c-149 0-189-126.21-332-126.21z",widetilde3:"M786 59C457 59 32 175.242 13 175.242c-6 0-10-3.457\n-11-10.37L.15 138c-1-7 3-12 10-13l19.2-6.4C378.4 40.7 634.3 0 804.3 0c337 0\n 411.8 157 746.8 157 328 0 754-112 773-112 5 0 10 3 11 9l1 14.075c1 8.066-.697\n 16.595-6.697 17.492l-21.052 7.31c-367.9 98.146-609.15 122.696-778.15 122.696\n -338 0-409-156.573-744-156.573z",widetilde4:"M786 58C457 58 32 177.487 13 177.487c-6 0-10-3.345\n-11-10.035L.15 143c-1-7 3-12 10-13l22-6.7C381.2 35 637.15 0 807.15 0c337 0 409\n 177 744 177 328 0 754-127 773-127 5 0 10 3 11 9l1 14.794c1 7.805-3 13.38-9\n 14.495l-20.7 5.574c-366.85 99.79-607.3 139.372-776.3 139.372-338 0-409\n -175.236-744-175.236z",vec:"M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z",widehat1:"M529 0h5l519 115c5 1 9 5 9 10 0 1-1 2-1 3l-4 22\nc-1 5-5 9-11 9h-2L532 67 19 159h-2c-5 0-9-4-11-9l-5-22c-1-6 2-12 8-13z",widehat2:"M1181 0h2l1171 176c6 0 10 5 10 11l-2 23c-1 6-5 10\n-11 10h-1L1182 67 15 220h-1c-6 0-10-4-11-10l-2-23c-1-6 4-11 10-11z",widehat3:"M1181 0h2l1171 236c6 0 10 5 10 11l-2 23c-1 6-5 10\n-11 10h-1L1182 67 15 280h-1c-6 0-10-4-11-10l-2-23c-1-6 4-11 10-11z",widehat4:"M1181 0h2l1171 296c6 0 10 5 10 11l-2 23c-1 6-5 10\n-11 10h-1L1182 67 15 340h-1c-6 0-10-4-11-10l-2-23c-1-6 4-11 10-11z",widecheck1:"M529,159h5l519,-115c5,-1,9,-5,9,-10c0,-1,-1,-2,-1,-3l-4,-22c-1,\n-5,-5,-9,-11,-9h-2l-512,92l-513,-92h-2c-5,0,-9,4,-11,9l-5,22c-1,6,2,12,8,13z",widecheck2:"M1181,220h2l1171,-176c6,0,10,-5,10,-11l-2,-23c-1,-6,-5,-10,\n-11,-10h-1l-1168,153l-1167,-153h-1c-6,0,-10,4,-11,10l-2,23c-1,6,4,11,10,11z",widecheck3:"M1181,280h2l1171,-236c6,0,10,-5,10,-11l-2,-23c-1,-6,-5,-10,\n-11,-10h-1l-1168,213l-1167,-213h-1c-6,0,-10,4,-11,10l-2,23c-1,6,4,11,10,11z",widecheck4:"M1181,340h2l1171,-296c6,0,10,-5,10,-11l-2,-23c-1,-6,-5,-10,\n-11,-10h-1l-1168,273l-1167,-273h-1c-6,0,-10,4,-11,10l-2,23c-1,6,4,11,10,11z",baraboveleftarrow:"M400000 620h-399890l3 -3c68.7 -52.7 113.7 -120 135 -202\nc4 -14.7 6 -23 6 -25c0 -7.3 -7 -11 -21 -11c-8 0 -13.2 0.8 -15.5 2.5\nc-2.3 1.7 -4.2 5.8 -5.5 12.5c-1.3 4.7 -2.7 10.3 -4 17c-12 48.7 -34.8 92 -68.5 130\ns-74.2 66.3 -121.5 85c-10 4 -16 7.7 -18 11c0 8.7 6 14.3 18 17c47.3 18.7 87.8 47\n121.5 85s56.5 81.3 68.5 130c0.7 2 1.3 5 2 9s1.2 6.7 1.5 8c0.3 1.3 1 3.3 2 6\ns2.2 4.5 3.5 5.5c1.3 1 3.3 1.8 6 2.5s6 1 10 1c14 0 21 -3.7 21 -11\nc0 -2 -2 -10.3 -6 -25c-20 -79.3 -65 -146.7 -135 -202l-3 -3h399890z\nM100 620v40h399900v-40z M0 241v40h399900v-40zM0 241v40h399900v-40z",rightarrowabovebar:"M0 241v40h399891c-47.3 35.3-84 78-110 128-16.7 32\n-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20 11 8 0\n13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7 39\n-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85-40.5\n-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5\n-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67\n151.7 139 205zm96 379h399894v40H0zm0 0h399904v40H0z",baraboveshortleftharpoon:"M507,435c-4,4,-6.3,8.7,-7,14c0,5.3,0.7,9,2,11\nc1.3,2,5.3,5.3,12,10c90.7,54,156,130,196,228c3.3,10.7,6.3,16.3,9,17\nc2,0.7,5,1,9,1c0,0,5,0,5,0c10.7,0,16.7,-2,18,-6c2,-2.7,1,-9.7,-3,-21\nc-32,-87.3,-82.7,-157.7,-152,-211c0,0,-3,-3,-3,-3l399351,0l0,-40\nc-398570,0,-399437,0,-399437,0z M593 435 v40 H399500 v-40z\nM0 281 v-40 H399908 v40z M0 281 v-40 H399908 v40z",rightharpoonaboveshortbar:"M0,241 l0,40c399126,0,399993,0,399993,0\nc4.7,-4.7,7,-9.3,7,-14c0,-9.3,-3.7,-15.3,-11,-18c-92.7,-56.7,-159,-133.7,-199,\n-231c-3.3,-9.3,-6,-14.7,-8,-16c-2,-1.3,-7,-2,-15,-2c-10.7,0,-16.7,2,-18,6\nc-2,2.7,-1,9.7,3,21c15.3,42,36.7,81.8,64,119.5c27.3,37.7,58,69.2,92,94.5z\nM0 241 v40 H399908 v-40z M0 475 v-40 H399500 v40z M0 475 v-40 H399500 v40z",shortbaraboveleftharpoon:"M7,435c-4,4,-6.3,8.7,-7,14c0,5.3,0.7,9,2,11\nc1.3,2,5.3,5.3,12,10c90.7,54,156,130,196,228c3.3,10.7,6.3,16.3,9,17c2,0.7,5,1,9,\n1c0,0,5,0,5,0c10.7,0,16.7,-2,18,-6c2,-2.7,1,-9.7,-3,-21c-32,-87.3,-82.7,-157.7,\n-152,-211c0,0,-3,-3,-3,-3l399907,0l0,-40c-399126,0,-399993,0,-399993,0z\nM93 435 v40 H400000 v-40z M500 241 v40 H400000 v-40z M500 241 v40 H400000 v-40z",shortrightharpoonabovebar:"M53,241l0,40c398570,0,399437,0,399437,0\nc4.7,-4.7,7,-9.3,7,-14c0,-9.3,-3.7,-15.3,-11,-18c-92.7,-56.7,-159,-133.7,-199,\n-231c-3.3,-9.3,-6,-14.7,-8,-16c-2,-1.3,-7,-2,-15,-2c-10.7,0,-16.7,2,-18,6\nc-2,2.7,-1,9.7,3,21c15.3,42,36.7,81.8,64,119.5c27.3,37.7,58,69.2,92,94.5z\nM500 241 v40 H399408 v-40z M500 435 v40 H400000 v-40z"},EMOJI_COMBINATOR=[[8205,1],[65038,2],[127995,5],[129456,4],[917536,96]],REGIONAL_INDICATOR=[127462,127487];function isEmojiCombinator(code){var _a3;if(void 0===emojiCombinator){emojiCombinator={};var _step11,_iterator11=_createForOfIteratorHelper(EMOJI_COMBINATOR);try{for(_iterator11.s();!(_step11=_iterator11.n()).done;)for(var x=_step11.value,i=x[0];i<=x[0]+x[1]-1;i++)emojiCombinator[i]=!0}catch(err){_iterator11.e(err)}finally{_iterator11.f()}}return null!=(_a3=emojiCombinator[code])&&_a3}function isRegionalIndicator(code){return code>=REGIONAL_INDICATOR[0]&&code<=REGIONAL_INDICATOR[1]}function splitGraphemes(string){if(/^[\u0020-\u00FF]*$/.test(string))return string;for(var result=[],codePoints=function(string){for(var result=[],i=0;i<string.length;i++){var code=string.charCodeAt(i);if(13===code&&10===string.charCodeAt(i+1)&&(code=10,i++),13!==code&&12!==code||(code=10),0===code&&(code=65533),code>=55296&&code<=56319){var nextCode=string.charCodeAt(i+1);if(nextCode>=56320&&nextCode<=57343){var lead=code-55296,trail=nextCode-56320;code=Math.pow(2,16)+lead*Math.pow(2,10)+trail,i++}}result.push(code)}return result}(string),index=0;index<codePoints.length;){var code=codePoints[index++],next=codePoints[index];if(8205===next){var baseIndex=index-1;for(index+=2;8205===codePoints[index];)index+=2;result.push(String.fromCodePoint.apply(String,_toConsumableArray(codePoints.slice(baseIndex,index-baseIndex+1))))}else if(isEmojiCombinator(next)){for(var _baseIndex=index-1;isEmojiCombinator(codePoints[index]);)index+=8205===codePoints[index]?2:1;result.push(String.fromCodePoint.apply(String,_toConsumableArray(codePoints.slice(_baseIndex,2*index-_baseIndex-1))))}else isRegionalIndicator(code)?(index+=1,result.push(String.fromCodePoint.apply(String,_toConsumableArray(codePoints.slice(index-2,2))))):result.push(String.fromCodePoint(code))}return result}var Tokenizer=function(){function Tokenizer(s){_classCallCheck(this,Tokenizer),this.s=splitGraphemes(s),this.pos=0,this.obeyspaces=!1}return _createClass(Tokenizer,[{key:"end",value:function(){return this.pos>=this.s.length}},{key:"get",value:function(){return this.pos<this.s.length?this.s[this.pos++]:""}},{key:"peek",value:function(){return this.s[this.pos]}},{key:"match",value:function(regEx){var execResult="string"==typeof this.s?regEx.exec(this.s.slice(this.pos)):regEx.exec(this.s.slice(this.pos).join(""));return(null==execResult?void 0:execResult[0])?(this.pos+=execResult[0].length,execResult[0]):""}},{key:"next",value:function(){if(this.end())return null;if(!this.obeyspaces&&this.match(/^[ \f\n\r\t\v\u00A0\u2028\u2029]+/))return"<space>";if(this.obeyspaces&&this.match(/^[ \f\n\r\t\v\u00A0\u2028\u2029]/))return"<space>";var next=this.get();if("\\"===next){if(!this.end()){var command=this.match(/^[a-zA-Z\*]+/);return command?this.match(/^[ \f\n\r\t\v\u00A0\u2028\u2029]*/):command=this.get(),"\\"+command}}else{if("{"===next)return"<{>";if("}"===next)return"<}>";if("^"===next){if("^"===this.peek()){this.get();var hex=this.match(/^(\^(\^(\^(\^[\da-f])?[\da-f])?[\da-f])?[\da-f])?[\da-f]{2}/);if(hex)return String.fromCodePoint(Number.parseInt(hex.slice(hex.lastIndexOf("^")+1),16))}return next}if("#"===next){if(!this.end()){var isParameter=!1;if(/[\d?@]/.test(this.peek())&&(isParameter=!0,this.pos+1<this.s.length)){var after=this.s[this.pos+1];isParameter=/[^\dA-Za-z]/.test(after)}return isParameter?"#"+this.get():"#"}}else if("$"===next)return"$"===this.peek()?(this.get(),"<$$>"):"<$>"}return next}}]),Tokenizer}();function expand(lex,args){var _a3,_b3,_c2,_d2,result=[],token=lex.next();if(token)if("\\relax"===token);else if("\\noexpand"===token)(token=lex.next())&&result.push(token);else if("\\obeyspaces"===token)lex.obeyspaces=!0;else if("\\bgroup"===token)result.push("<{>");else if("\\egroup"===token)result.push("<}>");else if("\\string"===token){if(token=lex.next())if(token.startsWith("\\")){var _step12,_iterator12=_createForOfIteratorHelper(token);try{for(_iterator12.s();!(_step12=_iterator12.n()).done;){var x=_step12.value;result.push("\\"===x?"\\backslash":x)}}catch(err){_iterator12.e(err)}finally{_iterator12.f()}}else"<{>"===token?result.push("\\{"):"<space>"===token?result.push("~"):"<}>"===token&&result.push("\\}")}else if("\\csname"===token){for(;"<space>"===lex.peek();)lex.next();var command="",done=!1,tokens=[];do{if(0===tokens.length)if(/^#[\d?@]$/.test(lex.peek())){var parameter=lex.get().slice(1);token=(tokens=tokenize(null!=(_b3=null!=(_a3=null==args?void 0:args(parameter))?_a3:null==args?void 0:args("?"))?_b3:"\\placeholder{}",args))[0]}else tokens=(token=lex.next())?[token]:[];(done=0===tokens.length)||"\\endcsname"!==token||(done=!0,tokens.shift()),done||(done="<$>"===token||"<$$>"===token||"<{>"===token||"<}>"===token||"string"==typeof token&&token.length>1&&token.startsWith("\\")),done||(command+=tokens.shift())}while(!done);command&&result.push("\\"+command),result.push.apply(result,_toConsumableArray(tokens))}else if("\\endcsname"===token);else if(token.length>1&&token.startsWith("#")){var _parameter=token.slice(1);result.push.apply(result,_toConsumableArray(tokenize(null!=(_d2=null!=(_c2=null==args?void 0:args(_parameter))?_c2:null==args?void 0:args("?"))?_d2:"\\placeholder{}",args)))}else result.push(token);return result}function tokenize(s){var _step13,args=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,stream=[],sep="",_iterator13=_createForOfIteratorHelper(s.toString().split(/\r?\n/));try{for(_iterator13.s();!(_step13=_iterator13.n()).done;){var line=_step13.value;sep&&stream.push(sep),sep=" ";var m=line.match(/((?:\\%)|[^%])*/);null!==m&&stream.push(m[0])}}catch(err){_iterator13.e(err)}finally{_iterator13.f()}var tokenizer=new Tokenizer(stream.join("")),result=[];do{result.push.apply(result,_toConsumableArray(expand(tokenizer,args)))}while(!tokenizer.end());return result}function joinLatex(segments){var _step14,sep="",result=[],_iterator14=_createForOfIteratorHelper(segments);try{for(_iterator14.s();!(_step14=_iterator14.n()).done;){var segment=_step14.value;segment&&(sep&&/^[a-zA-Z\*]/.test(segment)&&result.push(sep),result.push(segment),/^\\[a-zA-Z]+\*?[\"\'][^\ ]+$/.test(segment)&&result.push(" "),sep=/\\[a-zA-Z]+\*?$/.test(segment)?" ":"")}}catch(err){_iterator14.e(err)}finally{_iterator14.f()}return result.join("")}function latexCommand(command){console.assert(command.startsWith("\\"));for(var _len=arguments.length,args=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++)args[_key-1]=arguments[_key];return 0===args.length?command:joinLatex([command].concat(_toConsumableArray(args.map((function(x){return"{".concat(x,"}")})))))}function tokensToString(tokens){return joinLatex(tokens.map((function(token){var _a3;return null!=(_a3={"<space>":" ","<$$>":"$$","<$>":"$","<{>":"{","<}>":"}"}[token])?_a3:token})))}var Mode=function(){function _Mode(name){_classCallCheck(this,_Mode),_Mode._registry[name]=this}return _createClass(_Mode,null,[{key:"createAtom",value:function(mode,command,style){return _Mode._registry[mode].createAtom(command,getDefinition(command,mode),style)}},{key:"serialize",value:function(atoms,options){var _a3;if(!atoms||0===atoms.length)return"";if(null!=(_a3=options.skipStyles)&&_a3){var _step15,body=[],_iterator15=_createForOfIteratorHelper(getModeRuns(atoms));try{for(_iterator15.s();!(_step15=_iterator15.n()).done;){var run=_step15.value,mode=_Mode._registry[run[0].mode];body.push.apply(body,_toConsumableArray(mode.serialize(run,options)))}}catch(err){_iterator15.e(err)}finally{_iterator15.f()}return joinLatex(body)}return joinLatex(function(run,options){if(0===run.length)return[];var _step20,parent=run[0].parent,contextFontsize=null==parent?void 0:parent.computedStyle.fontSize,result=[],_iterator20=_createForOfIteratorHelper(getPropertyRuns(run,"fontSize"));try{for(_iterator20.s();!(_step20=_iterator20.n()).done;){var sizeRun=_step20.value,fontsize=sizeRun[0].computedStyle.fontSize,body=emitBackgroundColorRun(sizeRun,options);body&&(!fontsize||"auto"===fontsize||parent&&contextFontsize===fontsize?result.push.apply(result,_toConsumableArray(body)):result.push.apply(result,[["","\\tiny","\\scriptsize","\\footnotesize","\\small","\\normalsize","\\large","\\Large","\\LARGE","\\huge","\\Huge"][fontsize]].concat(_toConsumableArray(body))))}}catch(err){_iterator20.e(err)}finally{_iterator20.f()}return result}(atoms,options))}},{key:"getFont",value:function(mode,box,style){return _Mode._registry[mode].getFont(box,style)}}]),_Mode}();function getModeRuns(atoms){var _step16,result=[],run=[],currentMode="NONE",_iterator16=_createForOfIteratorHelper(atoms);try{for(_iterator16.s();!(_step16=_iterator16.n()).done;){var atom=_step16.value;"first"!==atom.type&&(atom.mode!==currentMode?(run.length>0&&result.push(run),run=[atom],currentMode=atom.mode):run.push(atom))}}catch(err){_iterator16.e(err)}finally{_iterator16.f()}return run.length>0&&result.push(run),result}function getPropertyRuns(atoms,property){var _step17,result=[],run=[],currentValue=void 0,_iterator17=_createForOfIteratorHelper(atoms);try{for(_iterator17.s();!(_step17=_iterator17.n()).done;){var atom=_step17.value;if("first"!==atom.type&&atom.style){var value=void 0;"variant"===property?(value=atom.style.variant,atom.style.variantStyle&&"up"!==atom.style.variantStyle&&(value+="-"+atom.style.variantStyle)):value=atom.style[property],value===currentValue?run.push(atom):(run.length>0&&result.push(run),run=[atom],currentValue=value)}}}catch(err){_iterator17.e(err)}finally{_iterator17.f()}return run.length>0&&result.push(run),result}function emitColorRun(run,options){var _a3,_step18,parent=run[0].parent,parentColor=null==parent?void 0:parent.computedStyle.color,result=[],_iterator18=_createForOfIteratorHelper(getModeRuns(run));try{for(_iterator18.s();!(_step18=_iterator18.n()).done;){var _step19,modeRun=_step18.value,mode=options.defaultMode,_iterator19=_createForOfIteratorHelper(getPropertyRuns(modeRun,"color"));try{for(_iterator19.s();!(_step19=_iterator19.n()).done;){var colorRun=_step19.value,style=colorRun[0].computedStyle,body=Mode._registry[colorRun[0].mode].serialize(colorRun,__spreadProps(__spreadValues({},options),{defaultMode:"text"===mode?"text":"math"}));options.skipStyles||!style.color||"none"===style.color||parent&&parentColor===style.color?result.push(joinLatex(body)):result.push(latexCommand("\\textcolor",null!=(_a3=style.verbatimColor)?_a3:style.color,joinLatex(body)))}}catch(err){_iterator19.e(err)}finally{_iterator19.f()}}}catch(err){_iterator18.e(err)}finally{_iterator18.f()}return result}function emitBackgroundColorRun(run,options){var parent=run[0].parent,parentColor=null==parent?void 0:parent.computedStyle.backgroundColor;return getPropertyRuns(run,"backgroundColor").map((function(x){var _a3;if(x.length>0||"box"!==x[0].type){var style=x[0].computedStyle;if(style.backgroundColor&&"none"!==style.backgroundColor&&(!parent||parentColor!==style.backgroundColor))return latexCommand("\\colorbox",null!=(_a3=style.verbatimBackgroundColor)?_a3:style.backgroundColor,joinLatex(emitColorRun(x,__spreadProps(__spreadValues({},options),{defaultMode:"text"}))))}return joinLatex(emitColorRun(x,options))}))}function boxType(type){if(type)return{mord:"ord",mbin:"bin",mop:"op",mrel:"rel",mopen:"open",mclose:"close",mpunct:"punct",minner:"inner",spacing:"ignore",latex:"latex",composition:"inner",error:"inner",placeholder:"ord",supsub:"ignore"}[type]}function atomsBoxType(atoms){if(0===atoms.length)return"ord";var first=boxType(atoms[0].type),last=boxType(atoms[atoms.length-1].type);return first&&first===last?first:"ord"}function toString(arg1,arg2){if("string"==typeof arg1)return arg1;if("number"==typeof arg1){console.assert(Number.isFinite(arg1));var numValue=Math.ceil(100*arg1)/100;return 0===numValue?"0":numValue.toString()+(null!=arg2?arg2:"")}return""}Mode._registry={};var Box=function(){function Box(content,options){var _a3,_b3,_c2,_d2,_e,_f;if(_classCallCheck(this,Box),"number"==typeof content?this.value=String.fromCodePoint(content):"string"==typeof content?this.value=content:isArray(content)?this.children=content.filter((function(x){return null!==x})):content&&content instanceof Box&&(this.children=[content]),this.children){var _step21,_iterator21=_createForOfIteratorHelper(this.children);try{for(_iterator21.s();!(_step21=_iterator21.n()).done;)_step21.value.parent=this}catch(err){_iterator21.e(err)}finally{_iterator21.f()}}if(this.type=null!=(_a3=null==options?void 0:options.type)?_a3:"ignore",this.isSelected=!0===(null==options?void 0:options.isSelected),(null==options?void 0:options.caret)&&(this.caret=options.caret),this.classes=null!=(_b3=null==options?void 0:options.classes)?_b3:"",this.isTight=null!=(_c2=null==options?void 0:options.isTight)&&_c2,null==options?void 0:options.properties)for(var _i7=0,_Object$keys5=Object.keys(options.properties);_i7<_Object$keys5.length;_i7++){var prop=_Object$keys5[_i7];this.setStyle(prop,options.properties[prop])}(null==options?void 0:options.attributes)&&(this.attributes=options.attributes);var fontName=null==options?void 0:options.fontFamily;if((null==options?void 0:options.style)&&this.value&&(fontName=null!=(_e=Mode.getFont(null!=(_d2=options.mode)?_d2:"math",this,__spreadProps(__spreadValues({variant:"normal"},options.style),{letterShapeStyle:options.letterShapeStyle})))?_e:void 0),fontName||(fontName="Main-Regular"),this.height=0,this.depth=0,this._width=0,this.hasExplicitWidth=!1,this.skew=0,this.italic=0,this.maxFontSize=0,this.scale=1,"latex"===this.type)this.height=.8,this.depth=.2,this._width=1;else if("number"==typeof content){var metrics=getCharacterMetrics(content,fontName);this.height=metrics.height,this.depth=metrics.depth,this._width=metrics.width,this.skew=metrics.skew,this.italic=metrics.italic}else if(this.value){this.height=-1/0,this.depth=-1/0,this._width=0,this.skew=-1/0,this.italic=-1/0;for(var i=0;i<this.value.length;i++){var _metrics=getCharacterMetrics(this.value.codePointAt(i),fontName);this.height=Math.max(this.height,_metrics.height),this.depth=Math.max(this.depth,_metrics.depth),this._width+=_metrics.width,this.skew=_metrics.skew,this.italic=_metrics.italic}}else if(this.children&&this.children.length>0)if(1===this.children.length){var _child=this.children[0];this.height=_child.height,this.depth=_child.depth,this._width=_child.width,this.maxFontSize=_child.maxFontSize,this.skew=_child.skew,this.italic=_child.italic}else{var _step22,height=-1/0,depth=-1/0,width=0,maxFontSize=0,_iterator22=_createForOfIteratorHelper(this.children);try{for(_iterator22.s();!(_step22=_iterator22.n()).done;){var _child2=_step22.value;_child2.height>height&&(height=_child2.height),_child2.depth>depth&&(depth=_child2.depth),maxFontSize=Math.max(maxFontSize,null!=(_f=_child2.maxFontSize)?_f:0),width+=_child2.width}}catch(err){_iterator22.e(err)}finally{_iterator22.f()}this.height=height,this.depth=depth,this._width=width,this.maxFontSize=maxFontSize}void 0!==(null==options?void 0:options.height)&&(this.height=options.height),void 0!==(null==options?void 0:options.depth)&&(this.depth=options.depth),void 0!==(null==options?void 0:options.width)&&(this.width=options.width),void 0!==(null==options?void 0:options.maxFontSize)&&(this.maxFontSize=options.maxFontSize)}return _createClass(Box,[{key:"atomID",set:function(id){void 0!==id&&0!==id.length&&(this.id=id)}},{key:"selected",value:function(isSelected){if(this.isSelected!==isSelected&&(this.isSelected=isSelected,this.children)){var _step23,_iterator23=_createForOfIteratorHelper(this.children);try{for(_iterator23.s();!(_step23=_iterator23.n()).done;)_step23.value.selected(isSelected)}catch(err){_iterator23.e(err)}finally{_iterator23.f()}}}},{key:"setStyle",value:function(prop,value,unit){if(void 0!==value){var v=toString(value,unit);v.length>0&&(this.cssProperties||(this.cssProperties={}),this.cssProperties[prop]=v)}}},{key:"setTop",value:function(top){Number.isFinite(top)&&Math.abs(top)>.01&&(this.cssProperties||(this.cssProperties={}),this.cssProperties.top=toString(top,"em"),this.height-=top,this.depth+=top)}},{key:"left",get:function(){var _a3;return(null==(_a3=this.cssProperties)?void 0:_a3["margin-left"])?Number.parseFloat(this.cssProperties["margin-left"]):0},set:function(value){Number.isFinite(value)&&(0===value?this.cssProperties&&delete this.cssProperties["margin-left"]:(this.cssProperties||(this.cssProperties={}),this.cssProperties["margin-left"]=toString(value,"em")))}},{key:"right",set:function(value){Number.isFinite(value)&&(0===value?this.cssProperties&&delete this.cssProperties["margin-right"]:(this.cssProperties||(this.cssProperties={}),this.cssProperties["margin-right"]=toString(value,"em")))}},{key:"width",get:function(){return this._width},set:function(value){this._width=value,this.hasExplicitWidth=!0}},{key:"wrap",value:function(context){var parent=context.parent;if(!parent)return this;context.isPhantom&&this.setStyle("opacity",0);var color=context.color;color&&color!==parent.color&&this.setStyle("color",color);var backgroundColor=context.backgroundColor;this.isSelected&&(backgroundColor=highlight(backgroundColor)),backgroundColor&&backgroundColor!==parent.backgroundColor&&(this.setStyle("background-color",backgroundColor),this.setStyle("display","inline-block")),console.assert(1===this.scale);var scale=context.scalingFactor;return this.scale=scale,this.height*=scale,this.depth*=scale,this._width*=scale,this.skew*=scale,this.italic*=scale,this}},{key:"toMarkup",value:function(){var _a3,_b3,_c2,_d2,_this=this,body=null!=(_a3=this.value)?_a3:"";if(this.children){var _step24,_iterator24=_createForOfIteratorHelper(this.children);try{for(_iterator24.s();!(_step24=_iterator24.n()).done;)body+=_step24.value.toMarkup()}catch(err){_iterator24.e(err)}finally{_iterator24.f()}}var svgMarkup="";if(this.svgBody)svgMarkup=function(svgBodyName){if(SVG_ACCENTS[svgBodyName]){var _SVG_ACCENTS$svgBodyN=_slicedToArray(SVG_ACCENTS[svgBodyName],3),vbWidth=_SVG_ACCENTS$svgBodyN[0],vbHeight=_SVG_ACCENTS$svgBodyN[1],height2=_SVG_ACCENTS$svgBodyN[2],result='<span class="stretchy" style="height:'.concat(height2,'em"><svg width="100%" height="').concat(height2,'em" viewBox="0 0 ').concat(vbWidth," ").concat(vbHeight,'" preserveAspectRatio="none" ><path fill="currentcolor" d="').concat(PATHS[svgBodyName],'"></path></svg></span>');return'<span style="display:inline-block;height:'.concat(height2/2,'em;min-width:0">').concat(result,"</span>")}var widthClasses,aligns,_SVG_BODY$svgBodyName=_slicedToArray(SVG_BODY[svgBodyName],4),paths=_SVG_BODY$svgBodyName[0],minWidth=_SVG_BODY$svgBodyName[1],viewBoxHeight=_SVG_BODY$svgBodyName[2],align2=_SVG_BODY$svgBodyName[3],height=viewBoxHeight/1e3;3===paths.length?(widthClasses=["slice-1-of-3","slice-2-of-3","slice-3-of-3"],aligns=["xMinYMin","xMidYMin","xMaxYMin"]):2===paths.length?(widthClasses=["slice-1-of-2","slice-2-of-2"],aligns=["xMinYMin","xMaxYMin"]):(widthClasses=["slice-1-of-1"],aligns=[align2]);var body=paths.map((function(path,i){return'<span class="'.concat(widthClasses[i],'" style=height:').concat(height,"em><svg width=400em height=").concat(height,'em viewBox="0 0 400000 ').concat(viewBoxHeight,'" preserveAspectRatio="').concat(aligns[i],' slice"><path fill="currentcolor" d="').concat(PATHS[path],'"></path></svg></span>')})).join("");return'<span style="display:inline-block;height:'.concat(height,"em;min-width:").concat(minWidth,'em;">').concat(body,"</span>")}(this.svgBody);else if(this.svgOverlay){svgMarkup='<span style="',svgMarkup+="display: inline-block;",svgMarkup+="height:".concat(this.height+this.depth,"em;"),svgMarkup+="vertical-align:".concat(this.depth,"em;"),svgMarkup+='">',svgMarkup+=body,svgMarkup+="</span>",svgMarkup+='<svg style="position:absolute;overflow:overlay;',svgMarkup+="height:".concat(this.height+this.depth,"em;");var padding2=null==(_b3=this.cssProperties)?void 0:_b3.padding;padding2?(svgMarkup+="top:".concat(padding2,";"),svgMarkup+="left:".concat(padding2,";"),svgMarkup+="width:calc(100% - 2 * ".concat(padding2," );")):svgMarkup+="top:0;left:0;width:100%;",svgMarkup+="z-index:2;",svgMarkup+='"',this.svgStyle&&(svgMarkup+=' style="'.concat(this.svgStyle,'"')),svgMarkup+=">".concat(this.svgOverlay,"</svg>")}var props="",classes=this.classes.split(" ");classes.push(null!=(_c2={latex:"ML__latex",placeholder:"ML__placeholder",error:"ML__error"}[this.type])?_c2:""),"latex"===this.caret&&classes.push("ML__latex-caret"),this.isSelected&&classes.push("ML__selected");var classList=1===classes.length?classes[0]:classes.filter((function(x,e,a){return x.length>0&&a.indexOf(x)===e})).join(" ");if(classList.length>0&&(props+=' class="'.concat(classList,'"')),this.id&&(props+=" data-atom-id=".concat(this.id)),this.cssId&&(props+=' id="'.concat(this.cssId.replace(/ /g,"-"),'" ')),this.attributes&&(props+=" "+Object.keys(this.attributes).map((function(x){return"".concat(x,'="').concat(_this.attributes[x],'"')})).join(" ")),this.htmlData){var _step25,_iterator25=_createForOfIteratorHelper(this.htmlData.split(","));try{for(_iterator25.s();!(_step25=_iterator25.n()).done;){var entry=_step25.value,matched=entry.match(/([^=]+)=(.+$)/);if(matched){var key=matched[1].trim().replace(/ /g,"-");key&&(props+=" data-".concat(key,'="').concat(matched[2],'" '))}else{var _key2=entry.trim().replace(/ /g,"-");_key2&&(props+=" data-".concat(_key2," "))}}}catch(err){_iterator25.e(err)}finally{_iterator25.f()}}var cssProps=null!=(_d2=this.cssProperties)?_d2:{};this.hasExplicitWidth&&(console.assert(void 0===cssProps.width),cssProps.width="".concat(Math.round(100*this._width)/100,"em"));var styles=Object.keys(cssProps).map((function(x){return"".concat(x,":").concat(cssProps[x])}));if(void 0!==this.scale&&1!==this.scale&&(body.length>0||svgMarkup.length>0)&&styles.push("font-size: ".concat(Math.round(1e4*this.scale)/100,"%")),this.htmlStyle){var _step26,styleString="",_iterator26=_createForOfIteratorHelper(this.htmlStyle.split(";"));try{for(_iterator26.s();!(_step26=_iterator26.n()).done;){var _matched=_step26.value.match(/([^=]+):(.+$)/);if(_matched){var _key3=_matched[1].trim().replace(/ /g,"-");_key3&&(styleString+="".concat(_key3,":").concat(_matched[2],";"))}}}catch(err){_iterator26.e(err)}finally{_iterator26.f()}styleString&&(props+=' style="'.concat(styleString,'"'))}styles.length>0&&(props+=' style="'.concat(styles.join(";"),'"'));var result="";return result=props.length>0||svgMarkup.length>0?"<span".concat(props,">").concat(body).concat(svgMarkup,"</span>"):body,"text"===this.caret?result+='<span class="ML__text-caret"></span>':"math"===this.caret&&(result+='<span class="ML__caret"></span>'),result}},{key:"tryCoalesceWith",value:function(box){if(this.svgBody||!this.value)return!1;if(box.svgBody||!box.value)return!1;var hasChildren=this.children&&this.children.length>0,boxHasChildren=box.children&&box.children.length>0;if(hasChildren||boxHasChildren)return!1;if(box.cssProperties||this.cssProperties)for(var _i8=0,_arr2=["border","border-left","border-right","border-right-width","left","margin","margin-left","margin-right","padding","position","width"];_i8<_arr2.length;_i8++){var prop=_arr2[_i8];if(box.cssProperties&&prop in box.cssProperties)return!1;if(this.cssProperties&&prop in this.cssProperties)return!1}var thisStyleCount=this.cssProperties?Object.keys(this.cssProperties).length:0;if(thisStyleCount!==(box.cssProperties?Object.keys(box.cssProperties).length:0))return!1;if(thisStyleCount>0)for(var _i9=0,_Object$keys6=Object.keys(this.cssProperties);_i9<_Object$keys6.length;_i9++){var _prop=_Object$keys6[_i9];if(this.cssProperties[_prop]!==box.cssProperties[_prop])return!1}var classes=this.classes.trim().replace(/\s+/g," ").split(" "),boxClasses=box.classes.trim().replace(/\s+/g," ").split(" ");if(classes.length!==boxClasses.length)return!1;classes.sort(),boxClasses.sort();var _step27,_iterator27=_createForOfIteratorHelper(classes.entries());try{for(_iterator27.s();!(_step27=_iterator27.n()).done;){var _step27$value=_slicedToArray(_step27.value,2),i=_step27$value[0],class_=_step27$value[1];if("vertical-separator"===class_)return!1;if(class_!==boxClasses[i])return!1}}catch(err){_iterator27.e(err)}finally{_iterator27.f()}return this.value+=box.value,this.height=Math.max(this.height,box.height),this.depth=Math.max(this.depth,box.depth),this._width=this._width+box._width,this.maxFontSize=Math.max(this.maxFontSize,box.maxFontSize),this.italic=box.italic,!0}}]),Box}();function coalesceRecursive(boxes){if(!boxes||0===boxes.length)return[];boxes[0].children=coalesceRecursive(boxes[0].children);for(var result=[boxes[0]],i=1;i<boxes.length;i++)result[result.length-1].tryCoalesceWith(boxes[i])||(boxes[i].children=coalesceRecursive(boxes[i].children),result.push(boxes[i]));return result}function coalesce(box){return box.children&&(box.children=coalesceRecursive(box.children)),box}function makeStruts(content,options){if(!content)return new Box(null,options);var topStrut=new Box(null,{classes:"ML__strut",type:"ignore"});topStrut.setStyle("height",Math.max(0,content.height),"em");var struts=[topStrut];if(0!==content.depth){var bottomStrut=new Box(null,{classes:"ML__strut--bottom",type:"ignore"});bottomStrut.setStyle("height",content.height+content.depth,"em"),bottomStrut.setStyle("vertical-align",-content.depth,"em"),struts.push(bottomStrut)}return struts.push(content),new Box(struts,__spreadProps(__spreadValues({},options),{type:"lift"}))}function addSVGOverlay(body,svgMarkup,svgStyle){return body.svgOverlay=svgMarkup,body.svgStyle=svgStyle,body}function makeSVGBox(svgBodyName){var height=function(svgBodyName){return SVG_BODY[svgBodyName]?SVG_BODY[svgBodyName][2]/1e3:SVG_ACCENTS[svgBodyName][2]}(svgBodyName)/2,box=new Box(null,{height:height+.166,depth:height-.166,maxFontSize:0});return box.svgBody=svgBodyName,box}function makeRows(params){var _a3,_getVListChildrenAndD=function(params){if("individualShift"in params){for(var oldChildren=params.individualShift,prevChild=oldChildren[0],children=[prevChild],depth=-prevChild.shift-prevChild.box.depth,currPos=depth,i=1;i<oldChildren.length;i++){var child=oldChildren[i],diff=-child.shift-currPos-child.box.depth,size=diff-(prevChild.box.height+prevChild.box.depth);currPos+=diff,children.push(size),children.push(child),prevChild=child}return[children,depth]}if("top"in params){var _step28,bottom=params.top,_iterator28=_createForOfIteratorHelper(params.children);try{for(_iterator28.s();!(_step28=_iterator28.n()).done;){var _child3=_step28.value;bottom-="number"==typeof _child3?_child3:_child3.box.height+_child3.box.depth}}catch(err){_iterator28.e(err)}finally{_iterator28.f()}return[params.children,bottom]}if("bottom"in params)return[params.children,-params.bottom];if("firstBaseline"in params){var firstChild=params.firstBaseline[0];if("number"==typeof firstChild)throw new Error("First child must be an element.");return[params.firstBaseline,-firstChild.box.depth]}if("shift"in params){var _firstChild=params.children[0];if("number"==typeof _firstChild)throw new Error("First child must be an element.");return[params.children,-_firstChild.box.depth-params.shift]}return[null,0]}(params),_getVListChildrenAndD2=_slicedToArray(_getVListChildrenAndD,2),children=_getVListChildrenAndD2[0],depth=_getVListChildrenAndD2[1];if(!children)return[[],0,0];var _step29,pstrutSize=0,_iterator29=_createForOfIteratorHelper(children);try{for(_iterator29.s();!(_step29=_iterator29.n()).done;){var child=_step29.value;if("number"!=typeof child){var box=child.box;pstrutSize=Math.max(pstrutSize,box.maxFontSize,box.height)}}}catch(err){_iterator29.e(err)}finally{_iterator29.f()}var pstrut=new Box(null,{classes:"pstrut",height:pstrutSize+=2});pstrut.setStyle("height",pstrutSize,"em");var _step30,realChildren=[],minPos=depth,maxPos=depth,currPos=depth,_iterator30=_createForOfIteratorHelper(children);try{for(_iterator30.s();!(_step30=_iterator30.n()).done;){var _child4=_step30.value;if("number"==typeof _child4)currPos+=_child4;else{var _box=_child4.box,classes=null!=(_a3=_child4.classes)?_a3:[],childWrap=new Box([pstrut,_box],{classes:classes.join(" "),style:_child4.style});_box.setStyle("height",_box.height+_box.depth,"em"),_box.setStyle("display","inline-block"),childWrap.setStyle("top",-pstrutSize-currPos-_box.depth,"em"),_child4.marginLeft&&childWrap.setStyle("margin-left",_child4.marginLeft,"em"),_child4.marginRight&&childWrap.setStyle("margin-right",_child4.marginRight,"em"),realChildren.push(childWrap),currPos+=_box.height+_box.depth}minPos=Math.min(minPos,currPos),maxPos=Math.max(maxPos,currPos)}}catch(err){_iterator30.e(err)}finally{_iterator30.f()}var vlist=new Box(realChildren,{classes:"vlist"});if(vlist.setStyle("height",maxPos,"em"),minPos>=0)return[[new Box(vlist,{classes:"vlist-r"})],maxPos,-minPos];var depthStrut=new Box(new Box(null),{classes:"vlist"});depthStrut.setStyle("height",-minPos,"em");var topStrut=new Box(8203,{classes:"vlist-s",maxFontSize:0,height:0,depth:0});return[[new Box([vlist,topStrut],{classes:"vlist-r"}),new Box(depthStrut,{classes:"vlist-r"})],maxPos,-minPos]}var VBox=function(_Box){_inherits(VBox,_Box);var _super=_createSuper(VBox);function VBox(content,options){var _a3;_classCallCheck(this,VBox);var _makeRows2=_slicedToArray(makeRows(content),3),rows=_makeRows2[0],height=_makeRows2[1],depth=_makeRows2[2];return _super.call(this,1===rows.length?rows[0]:rows,{classes:(null!=(_a3=null==options?void 0:options.classes)?_a3:"")+" vlist-t"+(2===rows.length?" vlist-t2":""),height:height,depth:depth,type:null==options?void 0:options.type})}return _createClass(VBox)}(Box),Mathstyle=function(){function Mathstyle(id,sizeDelta,cramped){_classCallCheck(this,Mathstyle),this.id=id,this.sizeDelta=sizeDelta,this.cramped=cramped;var metricsIndex={"-4":2,"-3":1,0:0}[sizeDelta];this.metrics=Object.keys(FONT_METRICS).reduce((function(acc,x){return __spreadProps(__spreadValues({},acc),_defineProperty({},x,FONT_METRICS[x][metricsIndex]))}),{})}return _createClass(Mathstyle,[{key:"getFontSize",value:function(size){return Math.max(1,size+this.sizeDelta)}},{key:"sup",get:function(){return MATHSTYLES[[0,1,0,1,2,3,2,3][this.id]]}},{key:"sub",get:function(){return MATHSTYLES[[0,0,0,0,2,2,2,2][this.id]]}},{key:"fracNum",get:function(){return MATHSTYLES[[0,1,0,1,2,3,4,5][this.id]]}},{key:"fracDen",get:function(){return MATHSTYLES[[0,0,0,0,2,2,4,4][this.id]]}},{key:"cramp",get:function(){return MATHSTYLES[[0,0,2,2,4,4,6,6][this.id]]}},{key:"isTight",get:function(){return this.sizeDelta<0}}]),Mathstyle}(),NUMERIC_MATHSTYLES={7:new Mathstyle(7,0,!1),6:new Mathstyle(6,0,!0),5:new Mathstyle(5,0,!1),4:new Mathstyle(4,0,!0),3:new Mathstyle(3,-3,!1),2:new Mathstyle(2,-3,!0),1:new Mathstyle(1,-4,!1),0:new Mathstyle(0,-4,!0)},MATHSTYLES=__spreadProps(__spreadValues({},NUMERIC_MATHSTYLES),{displaystyle:NUMERIC_MATHSTYLES[7],textstyle:NUMERIC_MATHSTYLES[5],scriptstyle:NUMERIC_MATHSTYLES[3],scriptscriptstyle:NUMERIC_MATHSTYLES[1]});function convertDimensionToPt(value,precision){var _a3;if(!value)return 0;var f={pt:1,mm:7227/2540,cm:7227/254,ex:35271/8192,px:3/4,em:10,bp:1.00375,dd:1238/1157,pc:12,in:72.27,mu:10/18}[null!=(_a3=value.unit)?_a3:"pt"];if(Number.isFinite(precision)){var factor=Math.pow(10,precision);return Math.round(value.dimension/10*f*factor)/factor}return value.dimension*f}function convertDimensionToEm(value,precision){if(null===value)return 0;var result=convertDimensionToPt(value)/10;if(Number.isFinite(precision)){var factor=Math.pow(10,precision);return Math.round(result*factor)/factor}return result}function serializeDimension(value){var _a3;return"".concat(value.dimension).concat(null!=(_a3=value.unit)?_a3:"pt")}function serializeLatexValue(value){var _a3,_b3;if(null==value)return null;var result="";if("dimension"in value&&(result="".concat(value.dimension).concat(null!=(_a3=value.unit)?_a3:"pt")),"glue"in value&&(result=function(value){var result=serializeDimension(value.glue);return value.grow&&0!==value.grow.dimension&&(result+=" plus ".concat(serializeDimension(value.grow))),value.shrink&&0!==value.shrink.dimension&&(result+=" minus ".concat(serializeDimension(value.shrink))),result}(value)),"number"in value)if("base"in value&&"decimal"!==value.base)if("alpha"===value.base)result="`".concat(String.fromCodePoint(value.number));else{var i=Math.round(value.number)>>>0;"hexadecimal"===value.base?(result=Number(i).toString(16).toUpperCase(),result=i<=255?result.padStart(2,"0"):i<=65535?result.padStart(4,"0"):i<=16777215?result.padStart(6,"0"):result.padStart(8,"0"),result='"'.concat(result)):"octal"===value.base&&(result=Number(i).toString(8),result=i<=63?result.padStart(2,"0"):i<=30583?result.padStart(4,"0"):result.padStart(8,"0"),result="'".concat(result))}else result=Number(value.number).toString();return"register"in value&&("factor"in value&&(-1===value.factor?result="-":1!==value.factor&&(result=Number(value.factor).toString())),"global"in value&&value.global&&(result+="\\global"),result+="\\".concat(value.register)),"string"in value&&(result=value.string),null!=(_b3=value.relax)&&_b3&&(result+="\\relax"),result}function multiplyLatexValue(value,factor){return null==value?null:"number"in value?__spreadProps(__spreadValues({},value),{number:value.number*factor}):"register"in value?"factor"in value&&value.factor?__spreadProps(__spreadValues({},value),{factor:value.factor*factor}):__spreadProps(__spreadValues({},value),{factor:factor}):"dimension"in value?__spreadProps(__spreadValues({},value),{dimension:value.dimension*factor}):"glue"in value?value.shrink&&value.grow?{glue:multiplyLatexValue(value.glue,factor),shrink:multiplyLatexValue(value.shrink,factor),grow:multiplyLatexValue(value.grow,factor)}:value.shrink?{glue:multiplyLatexValue(value.glue,factor),shrink:multiplyLatexValue(value.shrink,factor)}:value.grow?{glue:multiplyLatexValue(value.glue,factor),grow:multiplyLatexValue(value.grow,factor)}:{glue:multiplyLatexValue(value.glue,factor)}:null}var DEFAULT_REGISTERS={"p@":{dimension:1},"z@":{dimension:0},maxdimen:{dimension:16383.99999},hfuzz:{dimension:.1},vfuzz:{dimension:.1},overfullrule:{dimension:5},hsize:{dimension:6.5,unit:"in"},vsize:{dimension:8.9,unit:"in"},parindent:{dimension:20},maxdepth:{dimension:4},splitmaxdepth:{register:"maxdimen"},boxmaxdepth:{register:"maxdimen"},delimitershortfall:{dimension:5},nulldelimiterspace:{dimension:1.2,unit:"pt"},scriptspace:{dimension:.5},topskip:{dimension:10},splittopskip:{dimension:10},normalbaselineskip:{dimension:12},normallineskip:{dimension:1},normallineskiplimit:{dimension:0},jot:{dimension:3},doublerulesep:{dimension:2},arrayrulewidth:{dimension:.4},arraycolsep:{dimension:5},fboxsep:{dimension:3},fboxrule:{dimension:.4},"z@skip":{glue:{dimension:0},shrink:{dimension:0},grow:{dimension:0}},hideskip:{glue:{dimension:-1e3},grow:{dimension:1,unit:"fill"}},"@flushglue":{glue:{dimension:0},grow:{dimension:1,unit:"fill"}},parskip:{glue:{dimension:0},grow:{dimension:1}},abovedisplayskip:{glue:{dimension:12},grow:{dimension:3},shrink:{dimension:9}},abovedisplayshortskip:{glue:{dimension:0},grow:{dimension:3}},belowdisplayskip:{glue:{dimension:12},grow:{dimension:3},shrink:{dimension:9}},belowdisplayshortskip:{glue:{dimension:7},grow:{dimension:3},shrink:{dimension:4}},parfillskip:{glue:{dimension:0},grow:{dimension:1,unit:"fil"}},thinmuskip:{glue:{dimension:3,unit:"mu"}},medmuskip:{glue:{dimension:4,unit:"mu"},grow:{dimension:2,unit:"mu"},shrink:{dimension:4,unit:"mu"}},thickmuskip:{glue:{dimension:5,unit:"mu"},grow:{dimension:5,unit:"mu"}},smallskipamount:{glue:{dimension:3},grow:{dimension:1},shrink:{dimension:1}},medskipamount:{glue:{dimension:6},grow:{dimension:2},shrink:{dimension:3}},bigskipamount:{glue:{dimension:12},grow:{dimension:2},shrink:{dimension:4}},pretolerance:100,tolerance:200,hbadness:1e3,vbadness:1e3,linepenalty:10,hyphenpenalty:50,exhyphenpenalty:50,binoppenalty:700,relpenalty:500,clubpenalty:150,widowpenalty:150,displaywidowpenalty:50,brokenpenalty:100,predisplaypenalty:1e4,doublehyphendemerits:1e4,finalhyphendemerits:5e3,adjdemerits:1e4,tracinglostchars:1,uchyph:1,delimiterfactor:901,defaulthyphenchar:"\\-",defaultskewchar:-1,newlinechar:-1,showboxbreadth:5,showboxdepth:3,errorcontextlines:5,interdisplaylinepenalty:100,interfootnotelinepenalty:100,baselineSkip:1.2,arraystretch:1,month:(new Date).getMonth()+1,day:(new Date).getDate(),year:(new Date).getFullYear()};function getDefaultRegisters(){return __spreadValues({},DEFAULT_REGISTERS)}function getDefaultContext(){return{registers:getDefaultRegisters(),smartFence:!1,renderPlaceholder:void 0,placeholderSymbol:"▢",letterShapeStyle:l10n.locale.startsWith("fr")?"french":"tex",minFontScale:0,colorMap:defaultColorMap,backgroundColorMap:defaultBackgroundColorMap,getMacro:function(token){return getMacroDefinition(token,getMacros())}}}var Context=function(){function Context(options,style){var _a3,_b3,_c2,_d2,_e,_f,_g,_h,_i,_j,_k,_l,_m,_n,_o,template;_classCallCheck(this,Context),(null==options?void 0:options.parent)?(this.parent=options.parent,template=options.parent,this.registers={}):(template=__spreadValues(__spreadValues({},getDefaultContext()),null!=(_a3=null==options?void 0:options.from)?_a3:{}),this.registers=template.registers),template.atomIdsSettings&&(this.atomIdsSettings=__spreadValues({},template.atomIdsSettings)),this.renderPlaceholder=template.renderPlaceholder,this.isPhantom=null!=(_d2=null!=(_c2=null==options?void 0:options.isPhantom)?_c2:null==(_b3=this.parent)?void 0:_b3.isPhantom)&&_d2,this.letterShapeStyle=template.letterShapeStyle,this.minFontScale=template.minFontScale,(null==style?void 0:style.color)&&"none"!==style.color?this.color=style.color:this.color=null!=(_f=null==(_e=this.parent)?void 0:_e.color)?_f:"",(null==style?void 0:style.backgroundColor)&&"none"!==style.backgroundColor?this.backgroundColor=style.backgroundColor:this.backgroundColor=null!=(_h=null==(_g=this.parent)?void 0:_g.backgroundColor)?_h:"",(null==style?void 0:style.fontSize)&&"auto"!==style.fontSize&&style.fontSize!==(null==(_i=this.parent)?void 0:_i.size)?this.size=style.fontSize:this.size=null!=(_k=null==(_j=this.parent)?void 0:_j.size)?_k:5;var mathstyle=null!=(_m=null==(_l=this.parent)?void 0:_l.mathstyle)?_m:MATHSTYLES.displaystyle;if("string"==typeof(null==options?void 0:options.mathstyle)){if(template instanceof Context)switch(options.mathstyle){case"cramp":mathstyle=mathstyle.cramp;break;case"superscript":mathstyle=mathstyle.sup;break;case"subscript":mathstyle=mathstyle.sub;break;case"numerator":mathstyle=mathstyle.fracNum;break;case"denominator":mathstyle=mathstyle.fracDen}switch(options.mathstyle){case"textstyle":mathstyle=MATHSTYLES.textstyle;break;case"displaystyle":mathstyle=MATHSTYLES.displaystyle;break;case"scriptstyle":mathstyle=MATHSTYLES.scriptstyle;break;case"scriptscriptstyle":mathstyle=MATHSTYLES.scriptscriptstyle}}this.mathstyle=mathstyle,this.smartFence=template.smartFence,this.placeholderSymbol=template.placeholderSymbol,this.colorMap=null!=(_n=template.colorMap)?_n:function(x){return x},this.backgroundColorMap=null!=(_o=template.backgroundColorMap)?_o:function(x){return x},this.getMacro=template.getMacro,console.assert(void 0!==this.parent||void 0!==this.registers)}return _createClass(Context,[{key:"makeID",value:function(){if(this.atomIdsSettings){if(this.atomIdsSettings.overrideID)return this.atomIdsSettings.overrideID;if("number"!=typeof this.atomIdsSettings.seed)return"".concat(Date.now().toString(36).slice(-2)).concat(Math.floor(1e5*Math.random()).toString(36));var result=this.atomIdsSettings.seed.toString(36);return this.atomIdsSettings.seed+=1,result}}},{key:"scale",value:function(value){return value*this.effectiveFontSize}},{key:"scalingFactor",get:function(){return this.parent?this.effectiveFontSize/this.parent.effectiveFontSize:1}},{key:"isDisplayStyle",get:function(){return 7===this.mathstyle.id||6===this.mathstyle.id}},{key:"isCramped",get:function(){return this.mathstyle.cramped}},{key:"isTight",get:function(){return this.mathstyle.isTight}},{key:"metrics",get:function(){return this.mathstyle.metrics}},{key:"effectiveFontSize",get:function(){return Math.max(FONT_SCALE[Math.max(1,this.size+this.mathstyle.sizeDelta)],this.minFontScale)}},{key:"getRegister",value:function(name){var _a3;return(null==(_a3=this.registers)?void 0:_a3[name])?this.registers[name]:this.parent?this.parent.getRegister(name):void 0}},{key:"getRegisterAsNumber",value:function(name){var val=this.getRegister(name);return"number"==typeof val?val:"string"==typeof val?Number(val):void 0}},{key:"getRegisterAsGlue",value:function(name){var _a3;if(null==(_a3=this.registers)?void 0:_a3[name]){var value=this.registers[name];return"object"===_typeof(value)&&"glue"in value?value:"object"===_typeof(value)&&"dimension"in value?{glue:{dimension:value.dimension}}:"number"==typeof value?{glue:{dimension:value}}:void 0}if(this.parent)return this.parent.getRegisterAsGlue(name)}},{key:"getRegisterAsEm",value:function(name,precision){return convertDimensionToEm(this.getRegisterAsDimension(name),precision)}},{key:"getRegisterAsDimension",value:function(name){var _a3;if(null==(_a3=this.registers)?void 0:_a3[name]){var value=this.registers[name];return"object"===_typeof(value)&&"glue"in value?value.glue:"object"===_typeof(value)&&"dimension"in value?value:"number"==typeof value?{dimension:value}:void 0}if(this.parent)return this.parent.getRegisterAsDimension(name)}},{key:"setRegister",value:function(name,value){void 0!==value?this.registers[name]=value:delete this.registers[name]}},{key:"evaluate",value:function(value){if(!value||!("register"in value))return value;var context=this;if("global"in value&&value.global)for(;context.parent;)context=context.parent;var factor=1;"factor"in value&&1!==value.factor&&void 0!==value.factor&&(factor=value.factor);var val=context.getRegister(value.register);if(void 0!==val){if("string"==typeof val)return{string:Number(val).toString()+val};if("number"==typeof val)return{number:factor*val};var result=context.evaluate(val);if(void 0!==result)return"string"in result?{string:Number(val).toString()+result.string}:"number"in result?{number:factor*result.number}:"dimension"in result?__spreadProps(__spreadValues({},result),{dimension:factor*result.dimension}):"glue"in result?__spreadProps(__spreadValues({},result),{glue:__spreadProps(__spreadValues({},result.glue),{dimension:factor*result.glue.dimension}),shrink:result.shrink?__spreadProps(__spreadValues({},result.shrink),{dimension:factor*result.shrink.dimension}):void 0,grow:result.grow?__spreadProps(__spreadValues({},result.grow),{dimension:factor*result.grow.dimension}):void 0}):value}}},{key:"toDimension",value:function(value){var val=this.evaluate(value);return void 0===val?null:"dimension"in val?val:"glue"in val?val.glue:"number"in val?{dimension:val.number}:null}},{key:"toEm",value:function(value,precision){if(null===value)return 0;var dimen=this.toDimension(value);return null===dimen?0:convertDimensionToPt(dimen,precision)/10}},{key:"toNumber",value:function(value){if(null===value)return null;var val=this.evaluate(value);return void 0===val?null:"number"in val?val.number:"dimension"in val?val.dimension:"glue"in val?val.glue.dimension:"string"in val?Number(val.string):null}},{key:"toColor",value:function(value){var _a3,_b3;if(null===value)return null;var val=this.evaluate(value);return void 0===val?null:"string"in val?null!=(_b3=null==(_a3=this.colorMap)?void 0:_a3.call(this,val.string))?_b3:val.string:null}},{key:"toBackgroundColor",value:function(value){var _a3,_b3;if(null===value)return null;var val=this.evaluate(value);return void 0===val?null:"string"in val?null!=(_b3=null==(_a3=this.backgroundColorMap)?void 0:_a3.call(this,val.string))?_b3:val.string:null}}]),Context}(),NAMED_BRANCHES=["body","above","below","superscript","subscript"];function isNamedBranch(branch){return"string"==typeof branch&&NAMED_BRANCHES.includes(branch)}function isCellBranch(branch){return void 0!==branch&&Array.isArray(branch)&&2===branch.length}var Atom=function(){function Atom(options){var _a3,_b3,_c2,_d2,_e,_f,_g,_h,_i;_classCallCheck(this,Atom),this.subsupPlacement=void 0,this.explicitSubsupPlacement=!1,this.type=options.type,"string"==typeof options.value&&(this.value=options.value),this.command=null!=(_b3=null!=(_a3=options.command)?_a3:this.value)?_b3:"",this.mode=null!=(_c2=options.mode)?_c2:"math",this.isFunction=null!=(_d2=options.isFunction)&&_d2,this.subsupPlacement=options.limits,this.style=null!=(_e=__spreadValues({},options.style))?_e:{},this.displayContainsHighlight=null!=(_f=options.displayContainsHighlight)&&_f,this.captureSelection=null!=(_g=options.captureSelection)&&_g,this.skipBoundary=null!=(_h=options.skipBoundary)&&_h,this.verbatimLatex=null!=(_i=options.verbatimLatex)?_i:void 0,options.args&&(this.args=options.args),options.body&&(this.body=options.body),"root"===this.type&&(this._changeCounter=0)}return _createClass(Atom,[{key:"latexMode",get:function(){return"math"===this.mode?"math":"text"}},{key:"toJson",value:function(){var result={};if(this.type&&(result.type=this.type),"math"!==this.mode&&(result.mode=this.mode),this.command&&this.command!==this.value&&(result.command=this.command),void 0!==this.value&&(result.value=this.value),this.style&&Object.keys(this.style).length>0&&(result.style=__spreadValues({},this.style)),void 0!==this.verbatimLatex&&(result.verbatimLatex=this.verbatimLatex),this.subsupPlacement&&(result.subsupPlacement=this.subsupPlacement),this.explicitSubsupPlacement&&(result.explicitSubsupPlacement=!0),this.isFunction&&(result.isFunction=!0),this.displayContainsHighlight&&(result.displayContainsHighlight=!0),this.isExtensibleSymbol&&(result.isExtensibleSymbol=!0),this.skipBoundary&&(result.skipBoundary=!0),this.captureSelection&&(result.captureSelection=!0),this.args&&(result.args=argumentsToJson(this.args)),this._branches)for(var _i10=0,_Object$keys7=Object.keys(this._branches);_i10<_Object$keys7.length;_i10++){var branch=_Object$keys7[_i10];this._branches[branch]&&(result[branch]=this._branches[branch].filter((function(x){return"first"!==x.type})).map((function(x){return x.toJson()})))}return"mord"===result.type&&2===Object.keys(result).length&&"value"in result?result.value:result}},{key:"changeCounter",get:function(){return this.parent?this.parent.changeCounter:this._changeCounter}},{key:"isDirty",set:function(dirty){if(dirty){"root"===this.type&&this._changeCounter++,"verbatimLatex"in this&&(this.verbatimLatex=void 0),this._children=void 0;for(var parent=this.parent;parent;)"root"===parent.type&&parent._changeCounter++,"verbatimLatex"in parent&&(parent.verbatimLatex=void 0),parent._children=void 0,parent=parent.parent}}},{key:"_serialize",value:function(options){var _a3;if(!options.expandMacro&&!options.skipStyles&&"string"==typeof this.verbatimLatex)return this.verbatimLatex;var def=getDefinition(this.command,this.mode);return(null==def?void 0:def.serialize)?def.serialize(this,options):this.body&&this.command?joinLatex([latexCommand(this.command,this.bodyToLatex(options)),this.supsubToLatex(options)]):this.body?joinLatex([this.bodyToLatex(options),this.supsubToLatex(options)]):this.value&&"​"!==this.value?null!=(_a3=this.command)?_a3:unicodeCharToLatex(this.mode,this.value):""}},{key:"bodyToLatex",value:function(options){var _a3;return Mode.serialize(this.body,__spreadProps(__spreadValues({},options),{defaultMode:null!=(_a3=options.defaultMode)?_a3:this.latexMode}))}},{key:"aboveToLatex",value:function(options){return Mode.serialize(this.above,options)}},{key:"belowToLatex",value:function(options){return Mode.serialize(this.below,options)}},{key:"supsubToLatex",value:function(options){var result="";if(options=__spreadProps(__spreadValues({},options),{defaultMode:"math"}),void 0!==this.branch("subscript")){var sub=Mode.serialize(this.subscript,options);0===sub.length?result+="_{}":1===sub.length&&/^[0-9]$/.test(sub)?result+="_".concat(sub):result+="_{".concat(sub,"}")}if(void 0!==this.branch("superscript")){var sup=Mode.serialize(this.superscript,options);0===sup.length?result+="^{}":1===sup.length?"′"===sup?result+="^\\prime ":"″"===sup?result+="^\\doubleprime ":/^[0-9]$/.test(sup)?result+="^".concat(sup):result+="^{".concat(sup,"}"):result+="^{".concat(sup,"}")}return result}},{key:"treeDepth",get:function(){for(var result=1,atom=this.parent;atom;)atom=atom.parent,result+=1;return result}},{key:"inCaptureSelection",get:function(){for(var atom=this;atom;){if(atom.captureSelection)return!0;atom=atom.parent}return!1}},{key:"parentPrompt",get:function(){for(var atom=this.parent;atom;){if("prompt"===atom.type&&!atom.captureSelection)return atom;atom=atom.parent}return null}},{key:"branch",value:function(name){if(isNamedBranch(name)&&this._branches)return this._branches[name]}},{key:"branches",get:function(){if(!this._branches)return[];var _step31,result=[],_iterator31=_createForOfIteratorHelper(NAMED_BRANCHES);try{for(_iterator31.s();!(_step31=_iterator31.n()).done;){var branch=_step31.value;this._branches[branch]&&result.push(branch)}}catch(err){_iterator31.e(err)}finally{_iterator31.f()}return result}},{key:"createBranch",value:function(name){return console.assert(isNamedBranch(name)),isNamedBranch(name)?(this._branches?this._branches[name]||(this._branches[name]=[this.makeFirstAtom(name)]):this._branches=_defineProperty({},name,[this.makeFirstAtom(name)]),this.isDirty=!0,this._branches[name]):[]}},{key:"row",get:function(){return isCellBranch(this.parentBranch)?this.parentBranch[0]:-1}},{key:"col",get:function(){return isCellBranch(this.parentBranch)?this.parentBranch[1]:-1}},{key:"body",get:function(){var _a3;return null==(_a3=this._branches)?void 0:_a3.body},set:function(atoms){this.setChildren(atoms,"body")}},{key:"superscript",get:function(){var _a3;return null==(_a3=this._branches)?void 0:_a3.superscript},set:function(atoms){this.setChildren(atoms,"superscript")}},{key:"subscript",get:function(){var _a3;return null==(_a3=this._branches)?void 0:_a3.subscript},set:function(atoms){this.setChildren(atoms,"subscript")}},{key:"above",get:function(){var _a3;return null==(_a3=this._branches)?void 0:_a3.above},set:function(atoms){this.setChildren(atoms,"above")}},{key:"below",get:function(){var _a3;return null==(_a3=this._branches)?void 0:_a3.below},set:function(atoms){this.setChildren(atoms,"below")}},{key:"computedStyle",get:function(){var _a3,_b3,hadVerbatimColor="string"==typeof this.style.verbatimColor,hadVerbatimBackgroundColor="string"==typeof this.style.verbatimBackgroundColor,result=__spreadValues(__spreadValues({},null!=(_b3=null==(_a3=this.parent)?void 0:_a3.computedStyle)?_b3:{}),this.style);return delete result.variant,delete result.variantStyle,hadVerbatimBackgroundColor||delete result.verbatimBackgroundColor,hadVerbatimColor||delete result.verbatimColor,result}},{key:"applyStyle",value:function(style){this.isDirty=!0,this.style=__spreadValues(__spreadValues({},this.style),style),"none"===this.style.fontFamily&&delete this.style.fontFamily,"auto"===this.style.fontShape&&delete this.style.fontShape,"auto"===this.style.fontSeries&&delete this.style.fontSeries,"none"===this.style.color&&(delete this.style.color,delete this.style.verbatimColor),"none"===this.style.backgroundColor&&(delete this.style.backgroundColor,delete this.style.verbatimBackgroundColor),"auto"===this.style.fontSize&&delete this.style.fontSize;var _step32,_iterator32=_createForOfIteratorHelper(this.children);try{for(_iterator32.s();!(_step32=_iterator32.n()).done;)_step32.value.applyStyle(style)}catch(err){_iterator32.e(err)}finally{_iterator32.f()}}},{key:"getInitialBaseElement",value:function(){var _a3,_b3,_c2;return this.hasEmptyBranch("body")?this:(console.assert("first"===(null==(_a3=this.body)?void 0:_a3[0].type)),null!=(_c2=null==(_b3=this.body[1])?void 0:_b3.getInitialBaseElement())?_c2:this)}},{key:"getFinalBaseElement",value:function(){return this.hasEmptyBranch("body")?this:this.body[this.body.length-1].getFinalBaseElement()}},{key:"isCharacterBox",value:function(){return"leftright"!==this.type&&"genfrac"!==this.type&&"subsup"!==this.type&&"delim"!==this.type&&"array"!==this.type&&"surd"!==this.type&&"mord"===this.getFinalBaseElement().type}},{key:"hasEmptyBranch",value:function(branch){var atoms=this.branch(branch);return!atoms||(console.assert(atoms.length>0),console.assert("first"===atoms[0].type),1===atoms.length)}},{key:"setChildren",value:function(children,branch){var _a3;if(children&&(console.assert(isNamedBranch(branch)),isNamedBranch(branch))){console.assert("first"!==(null==(_a3=children[0])?void 0:_a3.type));var newBranch=[this.makeFirstAtom(branch)].concat(_toConsumableArray(children));this._branches?this._branches[branch]=newBranch:this._branches=_defineProperty({},branch,newBranch);var _step33,_iterator33=_createForOfIteratorHelper(children);try{for(_iterator33.s();!(_step33=_iterator33.n()).done;){var child=_step33.value;child.parent=this,child.parentBranch=branch}}catch(err){_iterator33.e(err)}finally{_iterator33.f()}this.isDirty=!0}}},{key:"makeFirstAtom",value:function(branch){var result=new Atom({type:"first",mode:this.mode});return result.parent=this,result.parentBranch=branch,result}},{key:"addChild",value:function(child,branch){console.assert("first"!==child.type),this.createBranch(branch).push(child),this.isDirty=!0,child.parent=this,child.parentBranch=branch}},{key:"addChildBefore",value:function(child,before){console.assert(void 0!==before.parentBranch);var branch=this.createBranch(before.parentBranch);branch.splice(branch.indexOf(before),0,child),this.isDirty=!0,child.parent=this,child.parentBranch=before.parentBranch}},{key:"addChildAfter",value:function(child,after){console.assert(void 0!==after.parentBranch);var branch=this.createBranch(after.parentBranch);branch.splice(branch.indexOf(after)+1,0,child),this.isDirty=!0,child.parent=this,child.parentBranch=after.parentBranch}},{key:"addChildren",value:function(children,branchName){var _step34,branch=this.createBranch(branchName),_iterator34=_createForOfIteratorHelper(children);try{for(_iterator34.s();!(_step34=_iterator34.n()).done;){var child=_step34.value;child.parent=this,child.parentBranch=branchName,branch.push(child)}}catch(err){_iterator34.e(err)}finally{_iterator34.f()}this.isDirty=!0}},{key:"addChildrenAfter",value:function(children,after){console.assert(0===children.length||"first"!==children[0].type),console.assert(void 0!==after.parentBranch);var branch=this.createBranch(after.parentBranch);branch.splice.apply(branch,[branch.indexOf(after)+1,0].concat(_toConsumableArray(children))),this.isDirty=!0;var _step35,_iterator35=_createForOfIteratorHelper(children);try{for(_iterator35.s();!(_step35=_iterator35.n()).done;){var child=_step35.value;child.parent=this,child.parentBranch=after.parentBranch}}catch(err){_iterator35.e(err)}finally{_iterator35.f()}return children[children.length-1]}},{key:"removeBranch",value:function(name){var children=this.branch(name);if(isNamedBranch(name)&&(this._branches[name]=void 0),!children)return[];var _step36,_iterator36=_createForOfIteratorHelper(children);try{for(_iterator36.s();!(_step36=_iterator36.n()).done;){var child=_step36.value;child.parent=void 0,child.parentBranch=void 0}}catch(err){_iterator36.e(err)}finally{_iterator36.f()}return console.assert("first"===children[0].type),children.shift(),this.isDirty=!0,children}},{key:"removeChild",value:function(child){if(console.assert(child.parent===this),"first"!==child.type){var branch=this.branch(child.parentBranch),index=branch.indexOf(child);console.assert(index>=0),branch.splice(index,1),this.isDirty=!0,child.parent=void 0,child.parentBranch=void 0}}},{key:"siblings",get:function(){return this.parent?this.parent.branch(this.parentBranch):[]}},{key:"firstSibling",get:function(){return this.siblings[0]}},{key:"lastSibling",get:function(){var siblings=this.siblings;return siblings[siblings.length-1]}},{key:"isFirstSibling",get:function(){return this===this.firstSibling}},{key:"isLastSibling",get:function(){return this===this.lastSibling}},{key:"hasNoSiblings",get:function(){return 1===this.siblings.length}},{key:"leftSibling",get:function(){console.assert(void 0!==this.parent);var siblings=this.parent.branch(this.parentBranch);return siblings[siblings.indexOf(this)-1]}},{key:"rightSibling",get:function(){console.assert(void 0!==this.parent);var siblings=this.parent.branch(this.parentBranch);return siblings[siblings.indexOf(this)+1]}},{key:"hasChildren",get:function(){return Boolean(this._branches&&this.children.length>0)}},{key:"firstChild",get:function(){return console.assert(this.hasChildren),this.children[0]}},{key:"lastChild",get:function(){console.assert(this.hasChildren);var children=this.children;return children[children.length-1]}},{key:"children",get:function(){if(this._children)return this._children;if(!this._branches)return[];var _step37,result=[],_iterator37=_createForOfIteratorHelper(NAMED_BRANCHES);try{for(_iterator37.s();!(_step37=_iterator37.n()).done;){var branchName=_step37.value;if(this._branches[branchName]){var _step38,_iterator38=_createForOfIteratorHelper(this._branches[branchName]);try{for(_iterator38.s();!(_step38=_iterator38.n()).done;){var x=_step38.value;result.push.apply(result,_toConsumableArray(x.children)),result.push(x)}}catch(err){_iterator38.e(err)}finally{_iterator38.f()}}}}catch(err){_iterator37.e(err)}finally{_iterator37.f()}return this._children=result,result}},{key:"render",value:function(parentContext){if("first"===this.type&&!parentContext.atomIdsSettings)return null;var def=getDefinition(this.command,this.mode);if(null==def?void 0:def.render)return def.render(this,parentContext);var context=new Context({parent:parentContext},this.style),result=this.createBox(context,{classes:this.parent?"":"ML__base"});return result?(this.subsupPlacement||!this.superscript&&!this.subscript||(result=this.attachSupsub(context,{base:result})),result.wrap(context)):null}},{key:"attachSupsub",value:function(parentContext,options){var _a3,base=options.base,superscript=this.superscript,subscript=this.subscript;if(!superscript&&!subscript)return base;var supBox=null,subBox=null,isCharacterBox=null!=(_a3=options.isCharacterBox)?_a3:this.isCharacterBox(),supShift=0;if(superscript){var context=new Context({parent:parentContext,mathstyle:"superscript"});supBox=Atom.createBox(context,superscript),isCharacterBox||(supShift=base.height-parentContext.metrics.supDrop*context.scalingFactor)}var minSupShift,subShift=0;if(subscript){var _context2=new Context({parent:parentContext,mathstyle:"subscript"});subBox=Atom.createBox(_context2,subscript),isCharacterBox||(subShift=base.depth+parentContext.metrics.subDrop*_context2.scalingFactor)}minSupShift=parentContext.isDisplayStyle?parentContext.metrics.sup1:parentContext.isCramped?parentContext.metrics.sup3:parentContext.metrics.sup2;var scriptspace=.05/parentContext.scalingFactor,supsub=null;if(subBox&&supBox){supShift=Math.max(supShift,minSupShift,supBox.depth+.25*parentContext.metrics.xHeight),subShift=Math.max(subShift,parentContext.metrics.sub2);var ruleWidth=parentContext.metrics.defaultRuleThickness;if(supShift-supBox.depth-(subBox.height-subShift)<4*ruleWidth){subShift=4*ruleWidth-(supShift-supBox.depth)+subBox.height;var psi=.8*parentContext.metrics.xHeight-(supShift-supBox.depth);psi>0&&(supShift+=psi,subShift-=psi)}var slant=this.isExtensibleSymbol&&base.italic?-base.italic:0;supsub=new VBox({individualShift:[{box:subBox,shift:subShift,marginLeft:slant},{box:supBox,shift:-supShift}]}).wrap(parentContext)}else subBox&&!supBox?(subShift=Math.max(subShift,parentContext.metrics.sub1,subBox.height-.3448),supsub=new VBox({shift:subShift,children:[{box:subBox,marginRight:scriptspace,marginLeft:this.isCharacterBox()?-base.italic:0}]})):!subBox&&supBox&&(supShift=Math.max(supShift,minSupShift,supBox.depth+.10775),supsub=new VBox({shift:-supShift,children:[{box:supBox,marginRight:scriptspace}]}));return new Box([base,new Box(supsub,{caret:this.caret,isSelected:this.isSelected,classes:"msubsup"})],{type:options.type})}},{key:"attachLimits",value:function(ctx,options){var above=this.superscript?Atom.createBox(new Context({parent:ctx,mathstyle:"superscript"},this.style),this.superscript):null,below=this.subscript?Atom.createBox(new Context({parent:ctx,mathstyle:"subscript"},this.style),this.subscript):null;return above||below?function(context,options){var _a3,_b3,_c2,_d2,_e,metrics=context.metrics,base=new Box(options.base),baseShift=null!=(_a3=options.baseShift)?_a3:0,slant=null!=(_b3=options.slant)?_b3:0,aboveShift=0,belowShift=0;options.above&&(aboveShift=null!=(_c2=options.aboveShift)?_c2:Math.max(metrics.bigOpSpacing1,metrics.bigOpSpacing3-options.above.depth)),options.below&&(belowShift=null!=(_d2=options.belowShift)?_d2:Math.max(metrics.bigOpSpacing2,metrics.bigOpSpacing4-options.below.height));var result=null;if(options.below&&options.above){var bottom=metrics.bigOpSpacing5+options.below.height+options.below.depth+belowShift+base.depth+baseShift;result=new VBox({bottom:bottom,children:[metrics.bigOpSpacing5,{box:options.below,marginLeft:-slant,classes:["ML__center"]},belowShift,{box:base,classes:["ML__center"]},aboveShift,{box:options.above,marginLeft:slant,classes:["ML__center"]},metrics.bigOpSpacing5]}).wrap(context)}else if(options.below&&!options.above)result=new VBox({top:base.height-baseShift,children:[metrics.bigOpSpacing5,{box:options.below,marginLeft:-slant,classes:["ML__center"]},belowShift,{box:base,classes:["ML__center"]}]}).wrap(context);else if(!options.below&&options.above){var _bottom=base.depth+baseShift;result=new VBox({bottom:_bottom,children:[{box:base,classes:["ML__center"]},aboveShift,{box:options.above,marginLeft:slant,classes:["ML__center"]},metrics.bigOpSpacing5]}).wrap(context)}else{var _bottom2=base.depth+baseShift;result=new VBox({bottom:_bottom2,children:[{box:base},metrics.bigOpSpacing5]}).wrap(context)}return new Box(result,{type:null!=(_e=options.type)?_e:"op"})}(ctx,__spreadProps(__spreadValues({},options),{above:above,below:below})):options.base.wrap(ctx)}},{key:"bind",value:function(context,box){if(!box||context.isPhantom||"​"===this.value)return box;for(var parent=this.parent;parent&&!parent.captureSelection;)parent=parent.parent;return(null==parent?void 0:parent.captureSelection)||(this.id||(this.id=context.makeID()),box.atomID=this.id),box}},{key:"createBox",value:function(context,options){var _a3,_b3,_c2,_d2,value=null!=(_a3=this.value)?_a3:this.body,type=null!=(_b3=null==options?void 0:options.boxType)?_b3:boxType(this.type),classes=null!=(_c2=null==options?void 0:options.classes)?_c2:"";"text"===this.mode&&(classes+=" ML__text");var result="string"==typeof value||void 0===value?new Box(null!=value?value:null,{type:type,isSelected:this.isSelected,mode:this.mode,maxFontSize:context.scalingFactor,style:__spreadProps(__spreadValues({variant:"normal"},this.style),{fontSize:Math.max(1,context.size+context.mathstyle.sizeDelta)}),letterShapeStyle:context.letterShapeStyle,classes:classes}):null!=(_d2=Atom.createBox(context,value,{type:type,classes:classes}))?_d2:new Box(null);return context.isTight&&(result.isTight=!0),"math"===this.mode&&"main"!==this.style.variant||(result.italic=0),result.right=result.italic,this.bind(context,result),this.caret&&(this.superscript||this.subscript||(result.caret=this.caret)),result}},{key:"isDigit",value:function(){var _a3;return"mord"===this.type&&this.value?/^[\d,\.]$/.test(this.value):"group"===this.type&&2===(null==(_a3=this.body)?void 0:_a3.length)&&"first"===this.body[0].type&&","===this.body[1].value}},{key:"asDigit",value:function(){var _a3;return"mord"===this.type&&this.value&&/^[\d,\.]$/.test(this.value)?this.value:"group"===this.type&&2===(null==(_a3=this.body)?void 0:_a3.length)&&"first"===this.body[0].type&&","===this.body[1].value?".":""}}],[{key:"createBox",value:function(context,atoms,options){var _a3;if(!atoms)return null;var _step39,runs=function(atoms){var _step40,style=void 0,runs=[],run=[],_iterator40=_createForOfIteratorHelper(atoms);try{for(_iterator40.s();!(_step40=_iterator40.n()).done;){var atom=_step40.value;if(style||atom.style){var atomStyle=atom.computedStyle;style&&atomStyle.color===style.color&&atomStyle.backgroundColor===style.backgroundColor&&atomStyle.fontSize===style.fontSize?run.push(atom):(run.length>0&&runs.push(run),run=[atom],style=atomStyle)}else run.push(atom)}}catch(err){_iterator40.e(err)}finally{_iterator40.f()}return run.length>0&&runs.push(run),runs}(atoms),boxes=[],_iterator39=_createForOfIteratorHelper(runs);try{for(_iterator39.s();!(_step39=_iterator39.n()).done;){var run=_step39.value,style=run[0].style,box=renderStyleRun(context,run,{style:{color:style.color,backgroundColor:style.backgroundColor,fontSize:style.fontSize}});box&&boxes.push(box)}}catch(err){_iterator39.e(err)}finally{_iterator39.f()}if(0===boxes.length)return null;var classes=(null!=(_a3=null==options?void 0:options.classes)?_a3:"").trim();return 1!==boxes.length||classes||(null==options?void 0:options.type)?new Box(boxes,{classes:classes,type:null==options?void 0:options.type}).wrap(context):boxes[0].wrap(context)}},{key:"serialize",value:function(value,options){return Mode.serialize(value,options)}},{key:"commonAncestor",value:function(a,b){if(a===b)return a.parent;if(a.parent===b.parent)return a.parent;for(var parents=new WeakSet,parent=a.parent;parent;)parents.add(parent),parent=parent.parent;for(parent=b.parent;parent;){if(parents.has(parent))return parent;parent=parent.parent}console.assert(Boolean(parent))}},{key:"fromJson",value:function(json){return new Atom("string"==typeof json?{type:"mord",value:json,mode:"math"}:json)}}]),Atom}();function renderStyleRun(parentContext,atoms,options){var _a3,_b3,_c2,_d2,_e;if(!atoms||0===atoms.length)return null;var context=new Context({parent:parentContext},options.style),displaySelection=!(null==(_a3=context.atomIdsSettings)?void 0:_a3.groupNumbers),boxes=[];if(1===atoms.length){var atom=atoms[0],box=atom.render(context);box&&(displaySelection&&atom.isSelected&&box.selected(!0),boxes=[box])}else{var _step41,digitOrTextStringID="",lastWasDigit=!0,_iterator41=_createForOfIteratorHelper(atoms);try{for(_iterator41.s();!(_step41=_iterator41.n()).done;){var _atom=_step41.value;(null==(_b3=context.atomIdsSettings)?void 0:_b3.groupNumbers)&&digitOrTextStringID&&(lastWasDigit&&_atom.isDigit()||!lastWasDigit&&isText(_atom))&&(context.atomIdsSettings.overrideID=digitOrTextStringID);var _box2=_atom.render(context);context.atomIdsSettings&&(context.atomIdsSettings.overrideID=void 0),_box2&&((null==(_c2=context.atomIdsSettings)?void 0:_c2.groupNumbers)&&((_atom.isDigit()||isText(_atom))&&(digitOrTextStringID&&lastWasDigit===_atom.isDigit()||(lastWasDigit=_atom.isDigit(),digitOrTextStringID=null!=(_d2=_atom.id)?_d2:"")),!digitOrTextStringID||(_atom.isDigit()||isText(_atom))&&_atom.hasEmptyBranch("superscript")&&_atom.hasEmptyBranch("subscript")||(digitOrTextStringID="")),displaySelection&&_atom.isSelected&&_box2.selected(!0),boxes.push(_box2))}}catch(err){_iterator41.e(err)}finally{_iterator41.f()}}if(0===boxes.length)return null;var result=new Box(boxes,__spreadProps(__spreadValues({isTight:context.isTight},options),{type:null!=(_e=options.type)?_e:"lift"}));return result.isSelected=boxes.every((function(x){return x.isSelected})),result.wrap(context)}function isText(atom){return"text"===atom.mode}function argumentsToJson(args){return args.map((function(arg){return null===arg?"<null>":Array.isArray(arg)&&arg[0]instanceof Atom?{atoms:arg.map((function(x){return x.toJson()}))}:"object"===_typeof(arg)&&"group"in arg?{group:arg.group.map((function(x){return x.toJson()}))}:arg}))}var TextAtom=function(_Atom){_inherits(TextAtom,_Atom);var _super2=_createSuper(TextAtom);function TextAtom(command,value,style){var _this2;return _classCallCheck(this,TextAtom),(_this2=_super2.call(this,{type:"text",command:command,mode:"text",displayContainsHighlight:!0})).value=value,_this2.verbatimLatex=value,_this2.applyStyle(style),_this2}return _createClass(TextAtom,[{key:"render",value:function(context){var result=this.createBox(context);return this.caret&&(result.caret=this.caret),result}},{key:"_serialize",value:function(_options){var _a3;return null!=(_a3=this.verbatimLatex)?_a3:charToLatex("text",this.value.codePointAt(0))}}],[{key:"fromJson",value:function(json){return new TextAtom(json.command,json.value,json.style)}}]),TextAtom}(Atom);function compareRange(a,b){return a[0]===b[0]&&a[1]===b[1]?"equal":"different"}function range(selection){var _step42,first=1/0,last=-1/0,_iterator42=_createForOfIteratorHelper(selection.ranges);try{for(_iterator42.s();!(_step42=_iterator42.n()).done;){var range2=_step42.value;first=Math.min(first,range2[0],range2[1]),last=Math.max(last,range2[0],range2[1])}}catch(err){_iterator42.e(err)}finally{_iterator42.f()}return[first,last]}function getInlineShortcut(context,s,shortcuts){return shortcuts?function(siblings,shortcut){if(!shortcut)return"";if("string"==typeof shortcut)return shortcut;if(!siblings||void 0===shortcut.after)return shortcut.value;for(var nothing,letter=!1,digit=!1,isFunction=!1,frac=!1,surd=!1,binop=!1,relop=!1,operator=!1,punct=!1,array=!1,openfence=!1,closefence=!1,text=!1,space=!1,sibling=siblings[0],index=0;(null==sibling?void 0:sibling.type)&&/msubsup|placeholder/.test(sibling.type);)sibling=siblings[index+=1];return nothing=!sibling||"first"===sibling.type,sibling&&(letter=!(text="text"===sibling.mode)&&"mord"===sibling.type&&LETTER.test(sibling.value),digit=!text&&"mord"===sibling.type&&/\d+$/.test(sibling.value),isFunction=!text&&sibling.isFunction,frac="genfrac"===sibling.type,surd="surd"===sibling.type,binop="mbin"===sibling.type,relop="mrel"===sibling.type,operator="mop"===sibling.type,punct="mpunct"===sibling.type||"minner"===sibling.type,array="array"===sibling.type,openfence="mopen"===sibling.type,closefence="mclose"===sibling.type||"leftright"===sibling.type,space="space"===sibling.type),shortcut.after.includes("nothing")&&nothing||shortcut.after.includes("letter")&&letter||shortcut.after.includes("digit")&&digit||shortcut.after.includes("function")&&isFunction||shortcut.after.includes("frac")&&frac||shortcut.after.includes("surd")&&surd||shortcut.after.includes("binop")&&binop||shortcut.after.includes("relop")&&relop||shortcut.after.includes("operator")&&operator||shortcut.after.includes("punct")&&punct||shortcut.after.includes("array")&&array||shortcut.after.includes("openfence")&&openfence||shortcut.after.includes("closefence")&&closefence||shortcut.after.includes("text")&&text||shortcut.after.includes("space")&&space?shortcut.value:""}(context,shortcuts[s]):""}var INLINE_SHORTCUTS={"&":"\\&","%":"\\%","''":"^{\\doubleprime}",alpha:"\\alpha",delta:"\\delta",Delta:"\\Delta",pi:"\\pi",Pi:"\\Pi",theta:"\\theta",Theta:"\\Theta",ii:{after:"nothing+digit+function+frac+surd+binop+relop+punct+array+openfence+closefence+space+text",value:"\\imaginaryI"},jj:{after:"nothing+digit+function+frac+surd+binop+relop+punct+array+openfence+closefence+space+text",value:"\\imaginaryJ"},ee:{after:"nothing+digit+function+frac+surd+binop+relop+punct+array+openfence+closefence+space+text",value:"\\exponentialE"},nabla:"\\nabla",grad:"\\nabla",del:"\\partial",deg:{after:"digit+space",value:"\\degree"},infty:"\\infty","∞":"\\infty",oo:{after:"nothing+digit+frac+surd+binop+relop+punct+array+openfence+closefence+space",value:"\\infty"},"∑":"\\sum",sum:"\\sum_{#?}^{#?}",int:"\\int_{#?}^{#?}",prod:"\\prod_{#?}^{#?}",sqrt:"\\sqrt{#?}","∆":"\\differentialD","∂":"\\differentialD",arcsin:"\\arcsin",arccos:"\\arccos",arctan:"\\arctan",arcsec:"\\arcsec",arccsc:"\\arccsc",arsinh:"\\arsinh",arcosh:"\\arcosh",artanh:"\\artanh",arcsech:"\\arcsech",arccsch:"\\arccsch",arg:"\\arg",ch:"\\ch",cosec:"\\cosec",cosh:"\\cosh",cot:"\\cot",cotg:"\\cotg",coth:"\\coth",csc:"\\csc",ctg:"\\ctg",cth:"\\cth",sec:"\\sec",sinh:"\\sinh",sh:"\\sh",tanh:"\\tanh",tg:"\\tg",th:"\\th",sin:"\\sin",cos:"\\cos",tan:"\\tan",lg:"\\lg",lb:"\\lb",log:"\\log",ln:"\\ln",exp:"\\exp",lim:"\\lim_{#?}",dx:{after:"nothing+digit+function+frac+surd+binop+relop+punct+array+openfence+closefence+space+text",value:"\\differentialD x"},dy:{after:"nothing+digit+function+frac+surd+binop+relop+punct+array+openfence+closefence+space+text",value:"\\differentialD y"},dt:{after:"nothing+digit+function+frac+surd+binop+relop+punct+array+openfence+closefence+space+text",value:"\\differentialD t"},AA:"\\forall",EE:"\\exists","!EE":"\\nexists","&&":"\\land",xin:{after:"nothing+text+relop+punct+openfence+space",value:"x \\in"},in:{after:"nothing+letter+closefence",value:"\\in"},"!in":"\\notin",NN:"\\mathbb{N}",ZZ:"\\Z",QQ:"\\Q",RR:"\\R",CC:"\\C",xx:"\\times","+-":"\\pm","≠":"\\ne","!=":"\\ne","≥":"\\ge",">=":"\\ge","≤":"\\le","<=":"\\le","<<":"\\ll",">>":"\\gg","~~":"\\approx","≈":"\\approx","?=":"\\questeq","÷":"\\div","¬":"\\neg",":=":"\\coloneq","::":"\\Colon","(:":"\\langle",":)":"\\rangle",beta:"\\beta",chi:"\\chi",epsilon:"\\epsilon",varepsilon:"\\varepsilon",eta:{after:"nothing+digit+function+frac+surd+binop+relop+punct+array+openfence+closefence+space+text",value:"\\eta"},gamma:"\\gamma",Gamma:"\\Gamma",iota:"\\iota",kappa:"\\kappa",lambda:"\\lambda",Lambda:"\\Lambda",mu:{after:"nothing+digit+function+frac+surd+binop+relop+punct+array+openfence+closefence+space+text",value:"\\mu"},nu:{after:"nothing+digit+function+frac+surd+binop+relop+punct+array+openfence+closefence+space+text",value:"\\nu"},"µ":"\\mu",phi:{after:"nothing+digit+function+frac+surd+binop+relop+punct+array+openfence+closefence+space+text",value:"\\phi"},Phi:{after:"nothing+digit+function+frac+surd+binop+relop+punct+array+openfence+closefence+space+text",value:"\\Phi"},varphi:"\\varphi",psi:{after:"nothing+digit+function+frac+surd+binop+relop+punct+array+openfence+closefence+space+text",value:"\\psi"},Psi:{after:"nothing+digit+function+frac+surd+binop+relop+punct+array+openfence+closefence+space+text",value:"\\Psi"},rho:{after:"nothing+digit+function+frac+surd+binop+relop+punct+array+openfence+closefence+space+text",value:"\\rho"},sigma:"\\sigma",Sigma:"\\Sigma",tau:{after:"nothing+digit+function+frac+surd+binop+relop+punct+array+openfence+closefence+space+text",value:"\\tau"},vartheta:"\\vartheta",upsilon:"\\upsilon",xi:{after:"nothing+digit+function+frac+surd+binop+relop+punct+array+openfence+closefence+space",value:"\\xi"},Xi:{after:"nothing+digit+function+frac+surd+binop+relop+punct+array+openfence+closefence+space+text",value:"\\Xi"},zeta:"\\zeta",omega:"\\omega",Omega:"\\Omega","Ω":"\\omega",forall:"\\forall",exists:"\\exists","!exists":"\\nexists",":.":"\\therefore",liminf:"\\liminf_{#?}",limsup:"\\limsup_{#?}",argmin:"\\operatorname*{arg~min}_{#?}",argmax:"\\operatorname*{arg~max}_{#?}",det:"\\det",mod:"\\mod",max:"\\max",min:"\\min",erf:"\\operatorname{erf}",erfc:"\\operatorname{erfc}",bessel:"\\operatorname{bessel}",mean:"\\operatorname{mean}",median:"\\operatorname{median}",fft:"\\operatorname{fft}",lcm:"\\operatorname{lcm}",gcd:"\\operatorname{gcd}",randomReal:"\\operatorname{randomReal}",randomInteger:"\\operatorname{randomInteger}",Re:"\\operatorname{Re}",Im:"\\operatorname{Im}",mm:{after:"nothing+digit+operator",value:"\\operatorname{mm}"},cm:{after:"nothing+digit+operator",value:"\\operatorname{cm}"},km:{after:"nothing+digit+operator",value:"\\operatorname{km}"},kg:{after:"nothing+digit+operator",value:"\\operatorname{kg}"},"...":"\\ldots","+...":"+\\cdots","-...":"-\\cdots","->...":"\\to\\cdots","--\x3e...":"\\longrightarrow\\cdots","->":"\\to","|->":"\\mapsto","--\x3e":"\\longrightarrow","<--":"\\longleftarrow","=>":"\\Rightarrow","==>":"\\Longrightarrow","<=>":"\\Leftrightarrow","<->":"\\leftrightarrow","(.)":"\\odot","(+)":"\\oplus","(/)":"\\oslash","(*)":"\\otimes","(-)":"\\ominus","||":"\\Vert","{":"\\{","}":"\\}","*":"\\cdot","**":"\\star","***":"\\ast","//":"\\slash","\\\\":"\\backslash",setminus:"\\backslash","|><":"\\ltimes","><|":"\\rtimes","|><|":"\\bowtie","-:":"\\div",divide:"\\div","@":"\\circ","^^":"\\wedge","^^^":"\\bigwedge",vv:"\\vee",vvv:"\\bigvee",nn:"\\cap",nnn:"\\bigcap",uu:"\\cup",uuu:"\\bigcup","-=":"\\equiv","~=":"\\cong",lt:"<","lt=":"\\leq",gt:">","gt=":"\\geq","-<":"\\prec","-lt":"\\prec","-<=":"\\preceq",">-=":"\\succeq",prop:"\\propto",diamond:"\\diamond",square:"\\square",iff:"\\iff",sub:"\\subset",sup:"\\supset",sube:"\\subseteq",supe:"\\supseteq",uarr:"\\uparrow",darr:"\\downarrow",rarr:"\\rightarrow",rArr:"\\Rightarrow",larr:"\\leftarrow",lArr:"\\Leftarrow",harr:"\\leftrightarrow",hArr:"\\Leftrightarrow",aleph:"\\aleph",and:"\\land",or:"\\lor",not:"\\neg","_|_":"\\bot",TT:"\\top","|--":"\\vdash","|==":"\\models","|__":"\\lfloor","__|":"\\rfloor","|~":"\\lceil","~|":"\\rceil",">->":"\\rightarrowtail","->>":"\\twoheadrightarrow",">->>":"\\twoheadrightarrowtail",frac:"\\frac{#?}{#?}",cbrt:"\\sqrt[3]{#?}",nthroot:"\\sqrt[#?]{#?}"};function parseMathString(s,options){var _a3,format=null!=(_a3=null==options?void 0:options.format)?_a3:"auto";if("auto"===format){var _inferFormat=function(s){if((s=s.trim()).length<=1)return["latex",s];var hasLatexModeShiftCommand,_trimModeShiftCommand2=_slicedToArray(trimModeShiftCommand(s),2);return hasLatexModeShiftCommand=_trimModeShiftCommand2[0],s=_trimModeShiftCommand2[1],hasLatexModeShiftCommand?["latex",s]:s.startsWith("`")&&s.endsWith("`")?["ascii-math",s=s.substring(1,s.length-1)]:s.includes("\\")?["latex",s]:/\$.+\$/.test(s)?["latex","\\text{".concat(s,"}")]:[void 0,s]}(s),_inferFormat2=_slicedToArray(_inferFormat,2);format=_inferFormat2[0],s=_inferFormat2[1]}return"ascii-math"===format?["ascii-math",parseMathExpression(s=(s=(s=(s=(s=(s=s.replace(/\u2061/g,"")).replace(/\u3016/g,"{")).replace(/\u3017/g,"}")).replace(/([^\\])sinx/g,"$1\\sin x")).replace(/([^\\])cosx/g,"$1\\cos x ")).replace(/\u2013/g,"-"),{inlineShortcuts:null==options?void 0:options.inlineShortcuts})]:["latex",s]}function parseMathExpression(s,options){var _a3,_b3,_c2;if(!s)return"";var m,done=!1,inlineShortcuts=null!=(_a3=options.inlineShortcuts)?_a3:INLINE_SHORTCUTS;if(done||!s.startsWith("^")&&!s.startsWith("_")||(m=parseMathArgument(s.slice(1),{inlineShortcuts:inlineShortcuts,noWrap:!0}),s=s[0]+"{"+m.match+"}",s+=parseMathExpression(m.rest,options),done=!0),done||(m=s.match(/^(sqrt|\u221A)(.*)/))&&(s="\\sqrt{"+(null!=(_b3=(m=parseMathArgument(m[2],{inlineShortcuts:inlineShortcuts,noWrap:!0})).match)?_b3:"\\placeholder{}")+"}",s+=parseMathExpression(m.rest,options),done=!0),done||(m=s.match(/^(\\cbrt|\u221B)(.*)/))&&(s="\\sqrt[3]{"+(null!=(_c2=(m=parseMathArgument(m[2],{inlineShortcuts:inlineShortcuts,noWrap:!0})).match)?_c2:"\\placeholder{}")+"}",s+=parseMathExpression(m.rest,options),done=!0),done||(m=s.match(/^abs(.*)/))&&(s="\\left|"+(m=parseMathArgument(m[1],{inlineShortcuts:inlineShortcuts,noWrap:!0})).match+"\\right|",s+=parseMathExpression(m.rest,options),done=!0),done||(m=s.match(/^["”“](.*?)["”“](.*)/))&&(s="\\text{"+m[1]+"}",s+=parseMathExpression(m[2],options),done=!0),done||(m=s.match(/^([^a-zA-Z\(\{\[\_\^\\\s"]+)(.*)/))&&(s=paddedShortcut(m[1],inlineShortcuts),s+=parseMathExpression(m[2],options),done=!0),!done&&/^([fgh])[^a-zA-Z]/.test(s)&&(m=parseMathArgument(s.slice(1),{inlineShortcuts:inlineShortcuts,noWrap:!0}),s="("===s[1]?s[0]+"\\left("+m.match+"\\right)":s[0]+m.match,s+=parseMathExpression(m.rest,options),done=!0),done||(m=s.match(/^([a-zA-Z]+)(.*)/))&&(s=paddedShortcut(m[1],inlineShortcuts),s+=parseMathExpression(m[2],options),done=!0),!done)if((m=parseMathArgument(s,{inlineShortcuts:inlineShortcuts,noWrap:!0})).match&&"/"===m.rest[0]){var m2=parseMathArgument(m.rest.slice(1),{inlineShortcuts:inlineShortcuts,noWrap:!0});m2.match&&(s="\\frac{"+m.match+"}{"+m2.match+"}"+parseMathExpression(m2.rest,options)),done=!0}else m.match&&(s=s.startsWith("(")?"\\left("+m.match+"\\right)"+parseMathExpression(m.rest,options):m.match+parseMathExpression(m.rest,options),done=!0);return done||(m=s.match(/^(\s+)(.*)$/))&&(s=" "+parseMathExpression(m[2],options),done=!0),s}function parseMathArgument(s,options){var match="",rest=s=s.trim(),lFence=s.charAt(0),rFence={"(":")","{":"}","[":"]"}[lFence];if(rFence){for(var level=1,i=1;i<s.length&&level>0;)s[i]===lFence&&level++,s[i]===rFence&&level--,i++;0===level?(options.noWrap&&"("===lFence?match=parseMathExpression(s.substring(1,i-1),options):("{"===lFence&&"}"===rFence&&(lFence="\\{",rFence="\\}"),match="\\left"+lFence+parseMathExpression(s.substring(1,i-1),options)+"\\right"+rFence),rest=s.slice(Math.max(0,i))):(match=s.substring(1,i),rest="")}else{var m=s.match(/^([a-zA-Z]+)/);if(m){var shortcut=getInlineShortcut(null,s,options.inlineShortcuts);if(shortcut)return{match:shortcut=(shortcut=shortcut.replace("_{#?}","")).replace("^{#?}",""),rest:s.slice(shortcut.length)}}if(m=s.match(/^([a-zA-Z])/))return{match:m[1],rest:s.slice(1)};if(m=s.match(/^(-)?\d+(\.\d*)?/))return{match:m[0],rest:s.slice(m[0].length)};/^\\(left|right)/.test(s)||(m=s.match(/^(\\[a-zA-Z]+)/))&&(rest=s.slice(m[1].length),match=m[1])}return{match:match,rest:rest}}function paddedShortcut(s,shortcuts){var result=getInlineShortcut(null,s,shortcuts);return result?(result=(result=result.replace("_{#?}","")).replace("^{#?}",""),result+=" "):result=s,result}var MODE_SHIFT_COMMANDS=[["\\[","\\]"],["\\(","\\)"],["$$","$$"],["$","$"],["\\begin{math}","\\end{math}"],["\\begin{displaymath}","\\end{displaymath}"],["\\begin{equation}","\\end{equation}"],["\\begin{equation*}","\\end{equation*}"]];function trimModeShiftCommand(s){var _step43,trimedString=s.trim(),_iterator43=_createForOfIteratorHelper(MODE_SHIFT_COMMANDS);try{for(_iterator43.s();!(_step43=_iterator43.n()).done;){var mode=_step43.value;if(trimedString.startsWith(mode[0])&&trimedString.endsWith(mode[1]))return[!0,trimedString.substring(mode[0].length,trimedString.length-mode[1].length)]}}catch(err){_iterator43.e(err)}finally{_iterator43.f()}return[!1,s]}var defaultExportHook=function(_from,latex,_range){return MODE_SHIFT_COMMANDS.some((function(x){return latex.startsWith(x[0])&&latex.endsWith(x[1])}))||(latex="".concat("$$"," ").concat(latex," ").concat("$$")),latex},_ModeEditor=function(){function _ModeEditor(name){_classCallCheck(this,_ModeEditor),_ModeEditor._modes[name]=this}return _createClass(_ModeEditor,[{key:"onPaste",value:function(_mathfield,_data){return!1}},{key:"insert",value:function(_model,_text,_options){return!1}}],[{key:"onPaste",value:function(mode,mathfield,data){var _a3;if(!mathfield.contentEditable&&"none"===mathfield.userSelect)return mathfield.model.announce("plonk"),!1;if("string"==typeof data){var dataTransfer=new DataTransfer;dataTransfer.setData("text/plain",data),data=dataTransfer}var redispatchedEvent=new ClipboardEvent("paste",{clipboardData:data,cancelable:!0});return!!(null==(_a3=mathfield.host)?void 0:_a3.dispatchEvent(redispatchedEvent))&&_ModeEditor._modes[mode].onPaste(mathfield,data)}},{key:"onCopy",value:function(mathfield,ev){var _a3;if(ev.clipboardData)if(mathfield.contentEditable||"none"!==mathfield.userSelect){var model=mathfield.model,exportRange=model.selectionIsCollapsed?[0,model.lastOffset]:range(model.selection),atoms=model.getAtoms(exportRange);if(atoms.every((function(x){return"text"===x.mode||!x.mode})))ev.clipboardData.setData("text/plain",atoms.filter((function(x){return x instanceof TextAtom})).map((function(x){return x.value})).join(""));else if(atoms.every((function(x){return"latex"===x.mode})))ev.clipboardData.setData("text/plain",model.getAtoms(exportRange,{includeChildren:!0}).map((function(x){var _a4;return null!=(_a4=x.value)?_a4:""})).join(""));else{var latex;latex=1===atoms.length&&void 0!==atoms[0].verbatimLatex?atoms[0].verbatimLatex:model.getValue(exportRange,"latex-expanded"),ev.clipboardData.setData("application/x-latex",latex);try{ev.clipboardData.setData("text/plain",mathfield.options.onExport(mathfield,latex,exportRange))}catch(e){}1!==atoms.length||atoms[0].parent&&"group"!==atoms[0].type||(atoms=atoms[0].body.filter((function(x){return"first"!==x.type})));try{ev.clipboardData.setData("application/json+mathlive",JSON.stringify(atoms.map((function(x){return x.toJson()}))))}catch(e){}if(null==(_a3=window[Symbol.for("io.cortexjs.compute-engine")])?void 0:_a3.ComputeEngine){var ce=window.MathfieldElement.computeEngine;if(ce)try{ce.jsonSerializationOptions={metadata:["latex"]};var expr=ce.parse(model.getValue(exportRange,"latex-unstyled")),mathJson=JSON.stringify(expr.json);mathJson&&ev.clipboardData.setData("application/json",mathJson)}catch(e){}}}ev.preventDefault()}else mathfield.model.announce("plonk")}},{key:"insert",value:function(model,text){var _a3,options=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},mode="auto"===options.mode?model.mode:null!=(_a3=options.mode)?_a3:model.mode;return _ModeEditor._modes[mode].insert(model,text,options)}}]),_ModeEditor}(),ModeEditor=_ModeEditor;ModeEditor._modes={};var gStylesheets,gInjectedStylesheets,DEFAULT_KEYBINDINGS=[{key:"left",command:"moveToPreviousChar"},{key:"right",command:"moveToNextChar"},{key:"up",command:"moveUp"},{key:"down",command:"moveDown"},{key:"shift+[ArrowLeft]",command:"extendSelectionBackward"},{key:"shift+[ArrowRight]",command:"extendSelectionForward"},{key:"shift+[ArrowUp]",command:"extendSelectionUpward"},{key:"shift+[ArrowDown]",command:"extendSelectionDownward"},{key:"[Backspace]",command:"deleteBackward"},{key:"alt+[Delete]",command:"deleteBackward"},{key:"[Delete]",command:"deleteForward"},{key:"alt+[Backspace]",command:"deleteForward"},{key:"alt+[ArrowLeft]",command:"moveToPreviousWord"},{key:"alt+[ArrowRight]",command:"moveToNextWord"},{key:"shift+alt+[ArrowLeft]",command:"extendToPreviousWord"},{key:"shift+alt+[ArrowRight]",command:"extendToNextWord"},{key:"ctrl+[ArrowLeft]",command:"moveToGroupStart"},{key:"ctrl+[ArrowRight]",command:"moveToGroupEnd"},{key:"shift+ctrl+[ArrowLeft]",command:"extendToGroupStart"},{key:"shift+ctrl+[ArrowRight]",command:"extendToGroupEnd"},{key:"[Home]",command:"moveToMathfieldStart"},{key:"cmd+[ArrowLeft]",command:"moveToMathfieldStart"},{key:"shift+[Home]",command:"extendToMathFieldStart"},{key:"shift+cmd+[ArrowLeft]",command:"extendToMathFieldStart"},{key:"[End]",command:"moveToMathfieldEnd"},{key:"cmd+[ArrowRight]",command:"moveToMathfieldEnd"},{key:"shift+[End]",command:"extendToMathFieldEnd"},{key:"shift+cmd+[ArrowRight]",command:"extendToMathFieldEnd"},{key:"[Pageup]",command:"moveToGroupStart"},{key:"[Pagedown]",command:"moveToGroupEnd"},{key:"[Tab]",command:"moveToNextGroup"},{key:"shift+[Tab]",ifMode:"math",command:"moveToPreviousGroup"},{key:"[Escape]",ifMode:"math",command:["switchMode","latex"]},{key:"[Escape]",ifMode:"text",command:["switchMode","latex"]},{key:"[Escape]",ifMode:"latex",command:["complete","complete",{selectItem:"true"}]},{key:"\\",ifMode:"math",command:["switchMode","latex","\\"]},{key:"[IntlBackslash]",ifMode:"math",command:["switchMode","latex","\\"]},{key:"[Tab]",ifMode:"latex",command:["complete","accept-suggestion"]},{key:"[Return]",ifMode:"latex",command:"complete"},{key:"[Enter]",ifMode:"latex",command:"complete"},{key:"shift+[Escape]",ifMode:"latex",command:["complete","reject"]},{key:"[ArrowDown]",ifMode:"latex",command:"nextSuggestion"},{key:"[ArrowUp]",ifMode:"latex",command:"previousSuggestion"},{key:"ctrl+a",ifPlatform:"!macos",command:"selectAll"},{key:"cmd+a",command:"selectAll"},{key:"[Cut]",command:"cutToClipboard"},{key:"[Copy]",command:"copyToClipboard"},{key:"[Paste]",command:"pasteFromClipboard"},{key:"[Clear]",command:"deleteBackward"},{key:"[Undo]",command:"undo"},{key:"[Redo]",command:"redo"},{key:"[EraseEof]",command:"deleteToGroupEnd"},{key:"ctrl+x",ifPlatform:"ios",command:"cutToClipboard"},{key:"cmd+x",ifPlatform:"ios",command:"cutToClipboard"},{key:"ctrl+c",ifPlatform:"ios",command:"copyToClipboard"},{key:"cmd+c",ifPlatform:"ios",command:"copyToClipboard"},{key:"ctrl+v",ifPlatform:"ios",command:"pasteFromClipboard"},{key:"cmd+v",ifPlatform:"ios",command:"pasteFromClipboard"},{key:"ctrl+z",ifPlatform:"!macos",command:"undo"},{key:"cmd+z",command:"undo"},{key:"ctrl+y",ifPlatform:"!macos",command:"redo"},{key:"shift+cmd+y",command:"redo"},{key:"shift+ctrl+z",ifPlatform:"!macos",command:"redo"},{key:"shift+cmd+z",command:"redo"},{key:"ctrl+b",ifPlatform:"macos",command:"moveToPreviousChar"},{key:"ctrl+f",ifPlatform:"macos",command:"moveToNextChar"},{key:"ctrl+p",ifPlatform:"macos",command:"moveUp"},{key:"ctrl+n",ifPlatform:"macos",command:"moveDown"},{key:"ctrl+a",ifPlatform:"macos",command:"moveToMathfieldStart"},{key:"ctrl+e",ifPlatform:"macos",command:"moveToMathfieldEnd"},{key:"shift+ctrl+b",ifPlatform:"macos",command:"extendSelectionBackward"},{key:"shift+ctrl+f",ifPlatform:"macos",command:"extendSelectionForward"},{key:"shift+ctrl+p",ifPlatform:"macos",command:"extendSelectionUpward"},{key:"shift+ctrl+n",ifPlatform:"macos",command:"extendSelectionDownward"},{key:"shift+ctrl+a",ifPlatform:"macos",command:"extendToMathFieldStart"},{key:"shift+ctrl+e",ifPlatform:"macos",command:"extendToMathFieldEnd"},{key:"alt+ctrl+b",ifPlatform:"macos",command:"moveToPreviousWord"},{key:"alt+ctrl+f",ifPlatform:"macos",command:"moveToNextWord"},{key:"shift+alt+ctrl+b",ifPlatform:"macos",command:"extendToPreviousWord"},{key:"shift+alt+ctrl+f",ifPlatform:"macos",command:"extendToNextWord"},{key:"ctrl+h",ifPlatform:"macos",command:"deleteBackward"},{key:"ctrl+d",ifPlatform:"macos",command:"deleteForward"},{key:"ctrl+l",ifPlatform:"macos",command:"scrollIntoView"},{key:"ctrl+[Digit2]",ifMode:"math",command:["insert","\\sqrt{#0}"]},{key:"ctrl+[Digit5]",ifMode:"math",command:"moveToOpposite"},{key:"ctrl+[Digit6]",ifMode:"math",command:"moveToSuperscript"},{key:"ctrl+[Return]",ifMode:"math",command:"addRowAfter"},{key:"ctrl+[Enter]",ifMode:"math",command:"addRowAfter"},{key:"cmd+[Return]",ifMode:"math",command:"addRowAfter"},{key:"cmd+[Enter]",ifMode:"math",command:"addRowAfter"},{key:"alt+p",ifMode:"math",command:["insert","\\pi"]},{key:"alt+v",ifMode:"math",command:["insert","\\sqrt{#0}"]},{key:"alt+o",ifMode:"math",command:["insert","\\emptyset"]},{key:"alt+d",ifMode:"math",command:["insert","\\differentialD"]},{key:"shift+alt+o",ifMode:"math",command:["insert","\\varnothing"]},{key:"shift+alt+d",ifMode:"math",command:["insert","\\partial"]},{key:"alt+[Backslash]",ifMode:"math",command:["insert","\\backslash"]},{key:"[NumpadDivide]",ifMode:"math",command:["insert","\\frac{#@}{#?}"]},{key:"alt+[NumpadDivide]",ifMode:"math",command:["insert","\\frac{#?}{#@}"]},{key:"shift+alt+k",command:"toggleKeystrokeCaption"},{key:"alt+[Space]",command:"toggleVirtualKeyboard"},{key:"alt+ctrl+[ArrowUp]",command:["speak","all",{withHighlighting:!1}]},{key:"alt+ctrl+[ArrowDown]",command:["speak","selection",{withHighlighting:!1}]},{key:"shift+[Quote]",ifLayout:["apple.en-intl","windows.en-intl","linux.en"],ifMode:"math",command:["switchMode","text","",""]},{key:"shift+alt+[KeyT]",ifMode:"math",command:["switchMode","text","",""]},{key:"shift+[Quote]",ifLayout:["apple.en-intl","windows.en-intl","linux.en"],ifMode:"text",command:["switchMode","math","",""]},{key:"shift+alt+[KeyT]",ifMode:"text",command:["switchMode","math","",""]},{key:"/",ifMode:"math",command:["insert","\\frac{#@}{#?}"]},{key:"alt+/",ifLayout:["apple.en-intl","windows.en-intl","linux.en"],ifMode:"math",command:["insert","\\/"]},{key:"alt+[BracketLeft]",ifLayout:["apple.en-intl","windows.en-intl","linux.en"],ifMode:"math",command:["insert","\\left\\lbrack #0 \\right\\rbrack"]},{key:"ctrl+[Minus]",ifLayout:["apple.en-intl","windows.en-intl","linux.en"],ifMode:"math",command:"moveToSubscript"},{key:"shift+alt+[BracketLeft]",ifLayout:["apple.en-intl","windows.en-intl","linux.en"],ifMode:"math",command:["insert","\\left\\lbrace #0 \\right\\rbrace"]},{key:"ctrl+;",ifLayout:["apple.en-intl","windows.en-intl","linux.en"],ifMode:"math",command:"addRowAfter"},{key:"cmd+;",ifLayout:["apple.en-intl","windows.en-intl","linux.en"],ifMode:"math",command:"addRowAfter"},{key:"shift+ctrl+;",ifLayout:["apple.en-intl","windows.en-intl","linux.en"],ifMode:"math",command:"addRowBefore"},{key:"shift+cmd+;",ifLayout:["apple.en-intl","windows.en-intl","linux.en"],ifMode:"math",command:"addRowBefore"},{key:"ctrl+[Backspace]",ifMode:"math",command:"removeRow"},{key:"cmd+[Backspace]",ifMode:"math",command:"removeRow"},{key:"alt+[Tab]",ifMode:"math",command:"addColumnAfter"},{key:"shift+alt+[Tab]",ifMode:"math",command:"addColumnBefore"},{key:"alt+[Enter]",ifMode:"math",command:"addRowAfter"},{key:"shift+alt+[Enter]",ifMode:"math",command:"addRowBefore"},{key:"alt+[Return]",ifMode:"math",command:"addRowAfter"},{key:"shift+alt+[Return]",ifMode:"math",command:"addRowBefore"},{key:"shift+[Backspace]",ifMode:"math",command:"removeColumn"},{key:"alt+[Digit5]",ifLayout:["apple.en-intl","windows.en-intl","linux.en"],ifMode:"math",command:["insert","$\\infty"]},{key:"alt+[Digit9]",ifLayout:["apple.en-intl","windows.en-intl","linux.en"],ifMode:"math",command:["insert","("]},{key:"alt+[Digit0]",ifLayout:["apple.en-intl","windows.en-intl","linux.en"],ifMode:"math",command:["insert",")"]},{key:"alt+|",ifLayout:["apple.en-intl","windows.en-intl","linux.en"],ifMode:"math",command:["insert","|"]},{key:"shift+[Backquote]",ifLayout:["apple.en-intl","windows.en-intl","linux.en"],ifMode:"math",command:["insert","\\~"]},{key:"[Backquote]",ifLayout:["windows.french","linux.french"],ifMode:"math",command:["insert","^2"]}],REVERSE_KEYBINDINGS={"\\sqrt":["alt+v","ctrl+[Digit2]"],"\\pi":"alt+p","\\infty":"alt+[Digit5]","\\differentialD":"alt+d","\\partial":"shift+alt+d","\\frac":"Slash","\\emptyset":"alt+o","\\varnothing":"shift+alt+o","\\~":"~"};function on(element,inSelectors,listener,options){var _step44,_iterator44=_createForOfIteratorHelper(inSelectors.split(" "));try{for(_iterator44.s();!(_step44=_iterator44.n()).done;){var sel=_step44.value,m=sel.match(/(.*):(.*)/);if(m){var options2=null!=options?options:{};"active"===m[2]?options2.passive=!1:options2[m[2]]=!0,element.addEventListener(m[1],listener,options2)}else element.addEventListener(sel,listener,options)}}catch(err){_iterator44.e(err)}finally{_iterator44.f()}}function off(element,inSelectors,listener,options){var _step45,_iterator45=_createForOfIteratorHelper(inSelectors.split(" "));try{for(_iterator45.s();!(_step45=_iterator45.n()).done;){var sel=_step45.value,m=sel.match(/(.*):(.*)/);if(m){var options2=null!=options?options:{};"active"===m[2]?options2.passive=!1:options2[m[2]]=!0,element.removeEventListener(m[1],listener,options2)}else element.removeEventListener(sel,listener,options)}}catch(err){_iterator45.e(err)}finally{_iterator45.f()}}function isValidMathfield(mf){var _a3;return(null==(_a3=mf.element)?void 0:_a3.mathfield)===mf}function _getCaretPoint(element){var caret=function(element){var _a3,_b3;return null!=(_b3=null!=(_a3=element.querySelector(".ML__caret"))?_a3:element.querySelector(".ML__text-caret"))?_b3:element.querySelector(".ML__latex-caret")}(element);if(!caret)return null;var bounds=caret.getBoundingClientRect();return{x:bounds.right,y:bounds.bottom,height:bounds.height}}function branchId(atom){var _a3;if(!atom.parent)return"root";var result=null!=(_a3=atom.parent.id)?_a3:"";return result+="string"==typeof atom.parentBranch?"-"+atom.parentBranch:"-".concat(atom.parentBranch[0],"/").concat(atom.parentBranch[0])}function adjustForScrolling(mathfield,rect,scaleFactor){if(!rect)return null;var fieldRect=mathfield.field.getBoundingClientRect(),w=rect.right-rect.left,h=rect.bottom-rect.top,left=Math.ceil(rect.left-fieldRect.left+mathfield.field.scrollLeft*scaleFactor),top=Math.ceil(rect.top-fieldRect.top);return{left:left,right:left+w,top:top,bottom:top+h}}function getNodeBounds(node){var bounds=node.getBoundingClientRect(),marginRight=parseInt(getComputedStyle(node).marginRight),result={top:bounds.top-1,bottom:bounds.bottom,left:bounds.left,right:bounds.right-1+marginRight};if(0===node.children.length||"SVG"===node.tagName.toUpperCase())return result;var _step46,_iterator46=_createForOfIteratorHelper(node.children);try{for(_iterator46.s();!(_step46=_iterator46.n()).done;){var child=_step46.value;if(1===child.nodeType&&"atomId"in child.dataset&&!child.classList.contains("pstrut")){var r=getNodeBounds(child);result.left=Math.min(result.left,r.left),result.right=Math.max(result.right,r.right),result.top=Math.min(result.top,r.top),result.bottom=Math.max(result.bottom,r.bottom)}}}catch(err){_iterator46.e(err)}finally{_iterator46.f()}return result}function getAtomBounds(mathfield,atom){var _a3,_b3;if(!atom.id)return null;var result=null!=(_b3=null==(_a3=mathfield.atomBoundsCache)?void 0:_a3.get(atom.id))?_b3:null;if(null!==result)return result;var node=mathfield.fieldContent.querySelector('[data-atom-id="'.concat(atom.id,'"]'));return result=node?getNodeBounds(node):null,mathfield.atomBoundsCache&&(result?mathfield.atomBoundsCache.set(atom.id,result):mathfield.atomBoundsCache.delete(atom.id)),null!=result?result:null}function getSelectionBounds(mathfield,options){return mathfield.model.selection.ranges.reduce((function(acc,x){return acc.concat.apply(acc,_toConsumableArray(function(mathfield,range2,options){var _step47,rects=new Map,_iterator47=_createForOfIteratorHelper(mathfield.model.getAtoms(range2,{includeChildren:!0}));try{for(_iterator47.s();!(_step47=_iterator47.n()).done;){var atom=_step47.value;if(!(null==options?void 0:options.excludeAtomsWithBackground)||!atom.style.backgroundColor){var field=mathfield.field,supposedWidth=parseFloat(getComputedStyle(field).width),scaleFactor=field.getBoundingClientRect().width/supposedWidth;scaleFactor=isNaN(scaleFactor)?1:scaleFactor;var bounds=adjustForScrolling(mathfield,getAtomBounds(mathfield,atom),scaleFactor);if(bounds){var id=branchId(atom);if(rects.has(id)){var r=rects.get(id);rects.set(id,{left:Math.min(r.left,bounds.left),right:Math.max(r.right,bounds.right),top:Math.min(r.top,bounds.top),bottom:Math.max(r.bottom,bounds.bottom)})}else rects.set(id,bounds)}}}}catch(err){_iterator47.e(err)}finally{_iterator47.f()}return _toConsumableArray(rects.values())}(mathfield,x,options)))}),[])}function validateOrigin(origin,originValidator){return"*"===origin||"none"===originValidator||("same-origin"===originValidator?!window.origin||origin===window.origin:"function"==typeof originValidator&&originValidator(origin))}function getLocalDOMRect(el){for(var offsetTop=0,offsetLeft=0,width=el.offsetWidth,height=el.offsetHeight;el instanceof HTMLElement;)offsetTop+=el.offsetTop,offsetLeft+=el.offsetLeft,el=el.offsetParent;return new DOMRect(offsetLeft,offsetTop,width,height)}function getStylesheet(id){if(gStylesheets||(gStylesheets={}),gStylesheets[id])return gStylesheets[id];gStylesheets[id]=new CSSStyleSheet;var content="";switch(id){case"mathfield-element":content="\n    :host { display: inline-block; background-color: field; color: fieldtext; border-width: 1px; border-style: solid; border-color: #acacac; border-radius: 2px; padding:4px; pointer-events: none;}\n    :host([hidden]) { display: none; }\n    :host([disabled]), :host([disabled]:focus), :host([disabled]:focus-within) { outline: none; opacity:  .5; }\n    :host(:focus), :host(:focus-within) {\n      outline: Highlight auto 1px;    /* For Firefox */\n      outline: -webkit-focus-ring-color auto 1px;\n    }\n    :host([readonly]:focus), :host([readonly]:focus-within),\n    :host([read-only]:focus), :host([read-only]:focus-within) {\n      outline: none;\n    }";break;case"core":content=".ML__container {\n  min-height: auto !important;\n  --_hue: var(--hue, 212);\n  --_placeholder-color: var(--placeholder-color, hsl(var(--_hue), 40%, 49%));\n  --_placeholder-opacity: var(--placeholder-opacity, 0.4);\n  --_text-font-family: var(--text-font-family, system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif);\n}\n.ML__sr-only {\n  position: absolute;\n  width: 1px;\n  height: 1px;\n  margin: -1px;\n  padding: 0;\n  overflow: hidden;\n  clip: rect(0, 0, 0, 0);\n  clip-path: inset(50%);\n  white-space: nowrap;\n  border: 0;\n}\n.ML__is-inline {\n  display: inline-block;\n}\n.ML__base {\n  visibility: inherit;\n  display: inline-block;\n  position: relative;\n  cursor: text;\n  padding: 0;\n  margin: 0;\n  box-sizing: content-box;\n  border: 0;\n  outline: 0;\n  vertical-align: baseline;\n  font-weight: inherit;\n  font-family: inherit;\n  font-style: inherit;\n  text-decoration: none;\n  width: min-content;\n}\n.ML__strut,\n.ML__strut--bottom {\n  display: inline-block;\n  min-height: 0.5em;\n}\n.ML__small-delim {\n  font-family: KaTeX_Main;\n}\n/* Text mode */\n.ML__text {\n  font-family: var(--_text-font-family);\n  white-space: pre;\n}\n/* Use cmr for 'math upright' */\n.ML__cmr {\n  font-family: KaTeX_Main;\n  font-style: normal;\n}\n.ML__mathit {\n  font-family: KaTeX_Math;\n  /* The KaTeX_Math font is italic by default, so the font-style below is only \n     useful when a fallback font is used\n  */\n  font-style: italic;\n}\n.ML__mathbf {\n  font-family: KaTeX_Main;\n  font-weight: bold;\n}\n/* Lowercase greek symbols should stick to math font when \\mathbf is applied \n   to match TeX idiosyncratic behavior */\n.lcGreek.ML__mathbf {\n  font-family: KaTeX_Math;\n  font-weight: normal;\n}\n.ML__mathbfit {\n  font-family: KaTeX_Math;\n  font-weight: bold;\n  font-style: italic;\n}\n.ML__ams {\n  font-family: KaTeX_AMS;\n}\n/* Blackboard */\n.ML__bb {\n  font-family: KaTeX_AMS;\n}\n.ML__cal {\n  font-family: KaTeX_Caligraphic;\n}\n.ML__frak {\n  font-family: KaTeX_Fraktur;\n}\n.ML__tt {\n  font-family: KaTeX_Typewriter;\n}\n.ML__script {\n  font-family: KaTeX_Script;\n}\n.ML__sans {\n  font-family: KaTeX_SansSerif;\n}\n.ML__series_ul {\n  font-weight: 100;\n}\n.ML__series_el {\n  font-weight: 100;\n}\n.ML__series_l {\n  font-weight: 200;\n}\n.ML__series_sl {\n  font-weight: 300;\n}\n.ML__series_sb {\n  font-weight: 500;\n}\n.ML__bold,\n.ML__boldsymbol {\n  font-weight: 700;\n}\n.ML__series_eb {\n  font-weight: 800;\n}\n.ML__series_ub {\n  font-weight: 900;\n}\n.ML__series_uc {\n  font-stretch: ultra-condensed;\n}\n.ML__series_ec {\n  font-stretch: extra-condensed;\n}\n.ML__series_c {\n  font-stretch: condensed;\n}\n.ML__series_sc {\n  font-stretch: semi-condensed;\n}\n.ML__series_sx {\n  font-stretch: semi-expanded;\n}\n.ML__series_x {\n  font-stretch: expanded;\n}\n.ML__series_ex {\n  font-stretch: extra-expanded;\n}\n.ML__series_ux {\n  font-stretch: ultra-expanded;\n}\n.ML__it {\n  font-style: italic;\n}\n.ML__shape_ol {\n  -webkit-text-stroke: 1px black;\n  text-stroke: 1px black;\n  color: transparent;\n}\n.ML__shape_sc {\n  font-variant: small-caps;\n}\n.ML__shape_sl {\n  font-style: oblique;\n}\n/* First level emphasis */\n.ML__emph {\n  color: #bc2612;\n}\n/* Second level emphasis */\n.ML__emph .ML__emph {\n  color: #0c7f99;\n}\n.ML__highlight {\n  color: #007cb2;\n  background: #edd1b0;\n}\n.ML__center {\n  text-align: center;\n}\n.ML__label_padding {\n  padding: 0 0.5em;\n}\n.ML__frac-line {\n  width: 100%;\n  min-height: 1px;\n}\n.ML__frac-line:after {\n  content: '';\n  display: block;\n  margin-top: max(-1px, -0.04em);\n  min-height: max(1px, 0.04em);\n  /* Ensure the line is visible when printing even if \"turn off background images\" is on*/\n  -webkit-print-color-adjust: exact;\n  print-color-adjust: exact;\n  /* There's a bug since Chrome 62 where \n      sub-pixel border lines don't draw at some zoom \n      levels (110%, 90%). \n      Setting the min-height used to work around it, but that workaround\n      broke in Chrome 84 or so.\n      Setting the background (and the min-height) seems to work for now.\n      */\n  background: currentColor;\n  box-sizing: content-box;\n  /* Vuetify sets the box-sizing to inherit \n            causes the fraction line to not draw at all sizes (see #26) */\n  /* On some versions of Firefox on Windows, the line fails to \n            draw at some zoom levels, but setting the transform triggers\n            the hardware accelerated path, which works */\n  transform: translate(0, 0);\n}\n.ML__sqrt {\n  display: inline-block;\n}\n.ML__sqrt-sign {\n  display: inline-block;\n  position: relative;\n}\n.ML__sqrt-line {\n  display: inline-block;\n  height: max(1px, 0.04em);\n  width: 100%;\n}\n.ML__sqrt-line:before {\n  content: '';\n  display: block;\n  margin-top: min(-1px, -0.04em);\n  min-height: max(1px, 0.04em);\n  /* Ensure the line is visible when printing even if \"turn off background images\" is on*/\n  -webkit-print-color-adjust: exact;\n  print-color-adjust: exact;\n  background: currentColor;\n  /* On some versions of Firefox on Windows, the line fails to \n            draw at some zoom levels, but setting the transform triggers\n            the hardware accelerated path, which works */\n  transform: translate(0, 0);\n}\n.ML__sqrt-line:after {\n  border-bottom-width: 1px;\n  content: ' ';\n  display: block;\n  margin-top: -0.1em;\n}\n.ML__sqrt-index {\n  margin-left: 0.27777778em;\n  margin-right: -0.55555556em;\n}\n.ML__delim-size1 {\n  font-family: KaTeX_Size1;\n}\n.ML__delim-size2 {\n  font-family: KaTeX_Size2;\n}\n.ML__delim-size3 {\n  font-family: KaTeX_Size3;\n}\n.ML__delim-size4 {\n  font-family: KaTeX_Size4;\n}\n.ML__delim-mult .delim-size1 > span {\n  font-family: KaTeX_Size1;\n}\n.ML__delim-mult .delim-size4 > span {\n  font-family: KaTeX_Size4;\n}\n.ML__accent-body > span {\n  font-family: KaTeX_Main;\n  width: 0;\n}\n.ML__accent-vec {\n  position: relative;\n  left: 0.24em;\n}\n.ML__mathlive {\n  display: inline-block;\n  direction: ltr;\n  text-align: left;\n  text-indent: 0;\n  text-rendering: auto;\n  font-family: KaTeX_Main, 'Times New Roman', serif;\n  font-style: normal;\n  font-size-adjust: none;\n  font-stretch: normal;\n  font-variant-caps: normal;\n  letter-spacing: normal;\n  line-height: 1.2;\n  word-wrap: normal;\n  word-spacing: normal;\n  white-space: nowrap;\n  text-shadow: none;\n  -webkit-user-select: none;\n  user-select: none;\n  width: min-content;\n}\n.ML__mathlive .style-wrap {\n  position: relative;\n}\n.ML__mathlive .mfrac,\n.ML__mathlive .left-right {\n  display: inline-block;\n}\n.ML__mathlive .vlist-t {\n  display: inline-table;\n  table-layout: fixed;\n  border-collapse: collapse;\n}\n.ML__mathlive .vlist-r {\n  display: table-row;\n}\n.ML__mathlive .vlist {\n  display: table-cell;\n  vertical-align: bottom;\n  position: relative;\n}\n.ML__mathlive .vlist > span {\n  display: block;\n  height: 0;\n  position: relative;\n}\n.ML__mathlive .vlist > span > span {\n  display: inline-block;\n}\n.ML__mathlive .vlist > span > .pstrut {\n  overflow: hidden;\n  width: 0;\n}\n.ML__mathlive .vlist-t2 {\n  margin-right: -2px;\n}\n.ML__mathlive .vlist-s {\n  display: table-cell;\n  vertical-align: bottom;\n  font-size: 1px;\n  width: 2px;\n  min-width: 2px;\n}\n.ML__mathlive .msubsup {\n  text-align: left;\n}\n.ML__mathlive .negativethinspace {\n  display: inline-block;\n  margin-left: -0.16667em;\n  height: 0.71em;\n}\n.ML__mathlive .thinspace {\n  display: inline-block;\n  width: 0.16667em;\n  height: 0.71em;\n}\n.ML__mathlive .mediumspace {\n  display: inline-block;\n  width: 0.22222em;\n  height: 0.71em;\n}\n.ML__mathlive .thickspace {\n  display: inline-block;\n  width: 0.27778em;\n  height: 0.71em;\n}\n.ML__mathlive .enspace {\n  display: inline-block;\n  width: 0.5em;\n  height: 0.71em;\n}\n.ML__mathlive .quad {\n  display: inline-block;\n  width: 1em;\n  height: 0.71em;\n}\n.ML__mathlive .qquad {\n  display: inline-block;\n  width: 2em;\n  height: 0.71em;\n}\n.ML__mathlive .llap,\n.ML__mathlive .rlap {\n  width: 0;\n  position: relative;\n  display: inline-block;\n}\n.ML__mathlive .llap > .inner,\n.ML__mathlive .rlap > .inner {\n  position: absolute;\n}\n.ML__mathlive .llap > .fix,\n.ML__mathlive .rlap > .fix {\n  display: inline-block;\n}\n.ML__mathlive .llap > .inner {\n  right: 0;\n}\n.ML__mathlive .rlap > .inner {\n  left: 0;\n}\n.ML__mathlive .rule {\n  display: inline-block;\n  border: solid 0;\n  position: relative;\n  box-sizing: border-box;\n}\n.ML__mathlive .overline .overline-line,\n.ML__mathlive .underline .underline-line {\n  width: 100%;\n}\n.ML__mathlive .overline .overline-line:before,\n.ML__mathlive .underline .underline-line:before {\n  content: '';\n  border-bottom-style: solid;\n  border-bottom-width: max(1px, 0.04em);\n  -webkit-print-color-adjust: exact;\n  print-color-adjust: exact;\n  display: block;\n}\n.ML__mathlive .overline .overline-line:after,\n.ML__mathlive .underline .underline-line:after {\n  border-bottom-style: solid;\n  border-bottom-width: max(1px, 0.04em);\n  -webkit-print-color-adjust: exact;\n  print-color-adjust: exact;\n  content: '';\n  display: block;\n  margin-top: -1px;\n}\n.ML__mathlive .stretchy {\n  display: block;\n  position: absolute;\n  width: 100%;\n  left: 0;\n  overflow: hidden;\n}\n.ML__mathlive .stretchy:before,\n.ML__mathlive .stretchy:after {\n  content: '';\n}\n.ML__mathlive .stretchy svg {\n  display: block;\n  position: absolute;\n  width: 100%;\n  height: inherit;\n  fill: currentColor;\n  stroke: currentColor;\n  fill-rule: nonzero;\n  fill-opacity: 1;\n  stroke-width: 1;\n  stroke-linecap: butt;\n  stroke-linejoin: miter;\n  stroke-miterlimit: 4;\n  stroke-dasharray: none;\n  stroke-dashoffset: 0;\n  stroke-opacity: 1;\n}\n.ML__mathlive .slice-1-of-2 {\n  display: inline-flex;\n  position: absolute;\n  left: 0;\n  width: 50.2%;\n  overflow: hidden;\n}\n.ML__mathlive .slice-2-of-2 {\n  display: inline-flex;\n  position: absolute;\n  right: 0;\n  width: 50.2%;\n  overflow: hidden;\n}\n.ML__mathlive .slice-1-of-3 {\n  display: inline-flex;\n  position: absolute;\n  left: 0;\n  width: 25.1%;\n  overflow: hidden;\n}\n.ML__mathlive .slice-2-of-3 {\n  display: inline-flex;\n  position: absolute;\n  left: 25%;\n  width: 50%;\n  overflow: hidden;\n}\n.ML__mathlive .slice-3-of-3 {\n  display: inline-flex;\n  position: absolute;\n  right: 0;\n  width: 25.1%;\n  overflow: hidden;\n}\n.ML__mathlive .slice-1-of-1 {\n  display: inline-flex;\n  position: absolute;\n  width: 100%;\n  left: 0;\n  overflow: hidden;\n}\n.ML__mathlive .nulldelimiter {\n  display: inline-block;\n}\n.ML__mathlive .op-group {\n  display: inline-block;\n}\n.ML__mathlive .op-symbol {\n  position: relative;\n}\n.ML__mathlive .op-symbol.small-op {\n  font-family: KaTeX_Size1;\n}\n.ML__mathlive .op-symbol.large-op {\n  font-family: KaTeX_Size2;\n}\n.ML__mathlive .mtable .vertical-separator {\n  display: inline-block;\n  min-width: 1px;\n  box-sizing: border-box;\n}\n.ML__mathlive .mtable .arraycolsep {\n  display: inline-block;\n}\n.ML__mathlive .mtable .col-align-m > .vlist-t {\n  text-align: center;\n}\n.ML__mathlive .mtable .col-align-c > .vlist-t {\n  text-align: center;\n}\n.ML__mathlive .mtable .col-align-l > .vlist-t {\n  text-align: left;\n}\n.ML__mathlive .mtable .col-align-r > .vlist-t {\n  text-align: right;\n}\n.ML__error {\n  display: inline-block;\n  background-image: radial-gradient(ellipse at center, hsl(341, 100%, 40%), rgba(0, 0, 0, 0) 70%);\n  background-color: hsla(341, 100%, 40%, 0.1);\n  background-repeat: repeat-x;\n  background-size: 3px 3px;\n  padding-bottom: 3px;\n  background-position: 0 100%;\n}\n.ML__error > .ML__error {\n  background: transparent;\n  padding: 0;\n}\n.ML__placeholder {\n  color: var(--_placeholder-color);\n  opacity: var(--_placeholder-opacity);\n  padding-left: 0.4ex;\n  padding-right: 0.4ex;\n  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;\n}\n.ML__notation {\n  position: absolute;\n  box-sizing: border-box;\n  line-height: 0;\n}\n/* This class is used to implement the `\\mathtip` and `\\texttip` commands\n   For UI elements, see `[data-ML__tooltip]`\n*/\n.ML__tooltip-container {\n  position: relative;\n  transform: scale(0);\n}\n.ML__tooltip-container .ML__tooltip-content {\n  position: fixed;\n  display: inline-table;\n  visibility: hidden;\n  z-index: 2;\n  width: max-content;\n  max-width: 400px;\n  padding: 12px 12px;\n  border-radius: 8px;\n  background: #616161;\n  --_selection-color: #fff;\n  color: #fff;\n  box-shadow: 0 2px 2px 0 rgba(0, 0, 0, 0.14), 0 1px 5px 0 rgba(0, 0, 0, 0.12), 0 3px 1px -2px rgba(0, 0, 0, 0.2);\n  opacity: 0;\n  transition: opacity 0.15s cubic-bezier(0.4, 0, 1, 1);\n}\n.ML__tooltip-container .ML__tooltip-content .ML__text {\n  white-space: normal;\n}\n.ML__tooltip-container .ML__tooltip-content .ML__base {\n  display: contents;\n}\n.ML__tooltip-container:hover .ML__tooltip-content {\n  visibility: visible;\n  opacity: 1;\n  font-size: 0.75em;\n  transform: scale(1) translate(0, 3em);\n}\n";break;case"mathfield":content="@keyframes ML__caret-blink {\n  0%,\n  100% {\n    opacity: 1;\n  }\n  50% {\n    opacity: 0;\n  }\n}\n.ML__container {\n  display: inline-flex;\n  flex-flow: row;\n  justify-content: space-between;\n  align-items: flex-end;\n  min-height: 39px;\n  /* Need some room for the virtual keyboard toggle */\n  width: 100%;\n  /* Encourage browsers to consider allocating a hardware accelerated\n   layer for this element. */\n  isolation: isolate;\n  /* Prevent the browser from trying to interpret touch gestures in the field */\n  /* \"Disabling double-tap to zoom removes the need for browsers to\n        delay the generation of click events when the user taps the screen.\" */\n  touch-action: none;\n  --_caret-color: var(--caret-color, hsl(var(--_hue), 40%, 49%));\n  --_selection-color: var(--selection-color, #000);\n  --_selection-background-color: var(--selection-background-color, hsl(var(--_hue), 70%, 85%));\n  --_text-highlight-background-color: var(--highlight-text, hsla(var(--_hue), 40%, 50%, 0.1));\n  --_contains-highlight-background-color: var(--contains-highlight-backround-color, hsl(var(--_hue), 40%, 95%));\n  --_smart-fence-color: var(--smart-fence-color, currentColor);\n  --_smart-fence-opacity: var(--smart-fence-opacity, 0.5);\n  --_latex-color: var(--latex-color, hsl(var(--_hue), 40%, 50%));\n  --_correct-color: var(--correct-color, #10a000);\n  --_incorrect-color: var(--incorrect-color, #a01b00);\n  --_composition-background-color: var(--composition-background-color, #fff1c2);\n  --_composition-text-color: var(--composition-text-color, black);\n  --_composition-underline-color: var(--composition-underline-color, transparent);\n}\n/* This is the actual field content (formula) */\n.ML__content {\n  display: flex;\n  align-items: center;\n  align-self: center;\n  position: relative;\n  overflow: hidden;\n  padding: 2px 0 2px 1px;\n  width: 100%;\n}\n.ML__virtual-keyboard-toggle {\n  box-sizing: border-box;\n  display: flex;\n  align-self: center;\n  align-items: center;\n  flex-shrink: 0;\n  flex-direction: column;\n  justify-content: center;\n  width: 34px;\n  height: 34px;\n  padding: 0;\n  margin-right: 4px;\n  cursor: pointer;\n  /* Avoid some weird blinking with :hover */\n  border-radius: 8px;\n  border: 1px solid transparent;\n  transition: background 0.2s cubic-bezier(0.64, 0.09, 0.08, 1);\n  color: hsl(var(--_hue), 40%, 50%);\n  fill: currentColor;\n  background: transparent;\n}\n.ML__virtual-keyboard-toggle:hover {\n  background: hsla(0, 0%, 70%, 0.3);\n  color: #333;\n  fill: currentColor;\n}\n.ML__virtual-keyboard-toggle > span {\n  display: flex;\n  align-self: center;\n  align-items: center;\n}\n/* The invisible element used to capture keyboard events. We're just trying\n really hard to make sure it doesn't show. */\n.ML__keyboard-sink {\n  display: inline-block;\n  resize: none;\n  outline: none;\n  border: none;\n  /* Need these for Microsoft Edge */\n  position: fixed;\n  clip: rect(0 0 0 0);\n  /* Need this to prevent iOS Safari from auto-zooming */\n  font-size: 1em;\n  font-family: KaTeX_Main;\n}\n.ML__composition {\n  background: var(--_composition-background-color);\n  color: var(--_composition-text-color);\n  text-decoration: underline var(--_composition-underline-color);\n}\n.ML__caret:after {\n  content: '';\n  border: none;\n  border-radius: 2px;\n  border-right: 2px solid var(--_caret-color);\n  margin-right: -2px;\n  position: relative;\n  left: -1px;\n  animation: ML__caret-blink 1.05s step-end forwards infinite;\n}\n.ML__text-caret:after {\n  content: '';\n  border: none;\n  border-radius: 1px;\n  border-right: 1px solid var(--_caret-color);\n  margin-right: -1px;\n  position: relative;\n  left: 0;\n  animation: ML__caret-blink 1.05s step-end forwards infinite;\n}\n.ML__latex-caret:after {\n  content: '_';\n  border: none;\n  margin-right: 0;\n  margin-right: calc(-1ex - 2px);\n  position: relative;\n  color: var(--_caret-color);\n  animation: ML__caret-blink 1.05s step-end forwards infinite;\n}\n.ML__focused .ML__text {\n  background: var(--_text-highlight-background-color);\n}\n/* When using smartFence, the anticipated closing fence is displayed\nwith this style */\n.ML__smart-fence__close {\n  opacity: var(--_smart-fence-opacity);\n  color: var(--_smart-fence-color);\n}\n.ML__selected,\n.ML__focused .ML__selected .ML__contains-caret,\n.ML__focused .ML__selected .ML__smart-fence__close,\n.ML__focused .ML__selected .ML__placeholder {\n  color: var(--_selection-color);\n  opacity: 1;\n}\n:host(:focus) .ML__selection {\n  box-sizing: border-box;\n  background: var(--_selection-background-color) !important;\n}\n.ML__contains-caret.ML__close,\n.ML__contains-caret.ML__open,\n.ML__contains-caret > .ML__close,\n.ML__contains-caret > .ML__open,\n.ML__contains-caret .ML__sqrt-sign,\n.ML__contains-caret .ML__sqrt-line {\n  color: var(--_caret-color);\n}\n.ML__contains-highlight {\n  background: var(--_contains-highlight-background-color);\n  box-sizing: border-box;\n}\n.ML__latex {\n  font-family: 'Berkeley Mono', 'IBM Plex Mono', 'Source Code Pro', Consolas, 'Roboto Mono', Menlo, 'Bitstream Vera Sans Mono', 'DejaVu Sans Mono', Monaco, Courier, monospace;\n  font-weight: 400;\n  color: var(--_latex-color);\n}\n.ML__suggestion {\n  opacity: 0.5;\n}\n.ML__virtual-keyboard-toggle.is-visible.is-pressed:hover {\n  background: hsl(var(--_hue), 25%, 35%);\n  color: #fafafa;\n  fill: currentColor;\n}\n.ML__virtual-keyboard-toggle:focus {\n  outline: none;\n  border-radius: 8px;\n  border: 2px solid hsl(var(--_hue), 40%, 50%);\n}\n.ML__virtual-keyboard-toggle.is-pressed,\n.ML__virtual-keyboard-toggle.is-active:hover,\n.ML__virtual-keyboard-toggle.is-active {\n  background: hsl(var(--_hue), 25%, 35%);\n  color: #fafafa;\n  fill: currentColor;\n}\n/* Add an attribute 'data-ML__tooltip' to automatically show a\n   tooltip over a element on hover.\n   Use 'data-position=\"top\"' to place the tooltip above the\n   element rather than below.\n   Use 'data-delay' to delay the triggering of the tooltip.\n*/\n[data-ML__tooltip] {\n  position: relative;\n}\n[data-ML__tooltip][data-placement='top']::after {\n  top: inherit;\n  bottom: 100%;\n}\n[data-ML__tooltip]::after {\n  content: attr(data-ML__tooltip);\n  position: absolute;\n  display: none;\n  z-index: 2;\n  right: 110%;\n  left: calc(100% + 8px);\n  width: max-content;\n  max-width: 200px;\n  padding: 8px 8px;\n  border-radius: 2px;\n  background: #616161;\n  color: #fff;\n  box-shadow: 0 2px 2px 0 rgba(0, 0, 0, 0.14), 0 1px 5px 0 rgba(0, 0, 0, 0.12), 0 3px 1px -2px rgba(0, 0, 0, 0.2);\n  text-align: center;\n  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;\n  font-style: normal;\n  font-weight: 400;\n  font-size: 12px;\n  /* Phone */\n  opacity: 0;\n  transform: scale(0.5);\n  transition: all 0.15s cubic-bezier(0.4, 0, 1, 1);\n}\n@media only screen and (max-width: 767px) {\n  [data-ML__tooltip]::after {\n    padding: 8px 16px;\n    font-size: 16px;\n  }\n}\n:not(.tracking) [data-ML__tooltip]:hover {\n  position: relative;\n}\n:not(.tracking) [data-ML__tooltip]:hover::after {\n  visibility: visible;\n  display: inline-table;\n  opacity: 1;\n  transform: scale(1);\n}\n[data-ML__tooltip][data-delay]::after {\n  transition-delay: 0s;\n}\n[data-ML__tooltip][data-delay]:hover::after {\n  transition-delay: 1s;\n  /* attr(data-delay); Should work. But doesn't. */\n}\n.ML__prompt {\n  border-radius: 2px;\n}\n.ML__editablePromptBox {\n  outline: 1px solid #acacac;\n  border-radius: 2px;\n  z-index: -1;\n}\n.ML__focusedPromptBox {\n  outline: highlight auto 1px;\n}\n.ML__lockedPromptBox {\n  background-color: rgba(142, 142, 141, 0.4);\n  z-index: -1;\n}\n.ML__correctPromptBox {\n  outline: 1px solid var(--_correct-color);\n  box-shadow: 0 0 5px var(--_correct-color);\n}\n.ML__incorrectPromptBox {\n  outline: 1px solid var(--_incorrect-color);\n  box-shadow: 0 0 5px var(--_incorrect-color);\n}\n";break;case"environment-popover":content="#mathlive-environment-popover.is-visible {\n  visibility: visible;\n}\n#mathlive-environment-popover {\n  --_environment-panel-height: var(--environment-panel-height, 70px);\n  --_accent-color: var(--accent-color, #0c75d8);\n  --_background: var(--environment-panel-background, #0c75d8);\n  --_button-background: var(--environment-panel-button-background, white);\n  --_button-background-hover: var(--environment-panel-button-background-hover, #f5f5f7);\n  --_button-background-active: var(--environment-panel-button-background-active, #f5f5f7);\n  --_button-text: var(--environment-panel-button-text, #e3e4e8);\n  position: absolute;\n  width: calc(var(--_environment-panel-height) * 2);\n  height: var(--_environment-panel-height);\n  border-radius: 4px;\n  border: 1.5px solid var(--_accent-color);\n  background-color: var(--_background);\n  box-shadow: 0 0 30px 0 var(--environment-shadow, rgba(0, 0, 0, 0.4));\n  pointer-events: all;\n  visibility: hidden;\n}\n#mathlive-environment-popover .MLEP__array-buttons {\n  height: calc(var(--_environment-panel-height) * 5/4);\n  width: calc(var(--_environment-panel-height) * 5/4);\n  margin-left: calc(0px - var(--_environment-panel-height) * 0.16);\n  margin-top: calc(0px - var(--_environment-panel-height) * 0.19);\n}\n#mathlive-environment-popover .MLEP__array-buttons .font {\n  fill: white;\n}\n#mathlive-environment-popover .MLEP__array-buttons circle {\n  fill: #7f7f7f;\n  transition: fill 300ms;\n}\n#mathlive-environment-popover .MLEP__array-buttons .MLEP__array-insert-background {\n  fill-opacity: 1;\n  fill: var(--_background);\n  stroke: var(--_accent-color);\n  stroke-width: 3px;\n}\n#mathlive-environment-popover .MLEP__array-buttons line {\n  stroke: var(--_accent-color);\n  stroke-opacity: 0;\n  stroke-width: 40;\n  pointer-events: none;\n  transition: stroke-opacity 300ms;\n  stroke-linecap: round;\n}\n#mathlive-environment-popover .MLEP__array-buttons g[data-command]:hover circle {\n  fill: var(--_accent-color);\n}\n#mathlive-environment-popover .MLEP__array-buttons g[data-command]:hover line {\n  stroke-opacity: 1;\n}\n#mathlive-environment-popover .MLEP__environment-delimiter-controls {\n  height: 100%;\n  width: 50%;\n}\n#mathlive-environment-popover .MLEP__environment-delimiter-controls .MLEP__array-delimiter-options {\n  width: var(--_environment-panel-height);\n  height: var(--_environment-panel-height);\n  display: flex;\n  flex-wrap: wrap;\n  flex-direction: row;\n  justify-content: space-around;\n}\n#mathlive-environment-popover .MLEP__environment-delimiter-controls .MLEP__array-delimiter-options svg {\n  pointer-events: all;\n  margin-top: 2px;\n  width: calc(var(--_environment-panel-height) / 3 * 28 / 24);\n  height: calc(var(--_environment-panel-height) / 3 - 2px);\n  border-radius: calc(var(--_environment-panel-height) / 25);\n  background-color: var(--_button-background);\n}\n#mathlive-environment-popover .MLEP__environment-delimiter-controls .MLEP__array-delimiter-options svg:hover {\n  background-color: var(--_button-background-hover);\n}\n#mathlive-environment-popover .MLEP__environment-delimiter-controls .MLEP__array-delimiter-options svg path,\n#mathlive-environment-popover .MLEP__environment-delimiter-controls .MLEP__array-delimiter-options svg line {\n  stroke: var(--_button-text);\n  stroke-width: 2;\n  stroke-linecap: round;\n}\n#mathlive-environment-popover .MLEP__environment-delimiter-controls .MLEP__array-delimiter-options svg rect,\n#mathlive-environment-popover .MLEP__environment-delimiter-controls .MLEP__array-delimiter-options svg path {\n  fill-opacity: 0;\n}\n#mathlive-environment-popover .MLEP__environment-delimiter-controls .MLEP__array-delimiter-options svg.active {\n  pointer-events: none;\n  background-color: var(--_button-background-active);\n}\n#mathlive-environment-popover .MLEP__environment-delimiter-controls .MLEP__array-delimiter-options svg.active path,\n#mathlive-environment-popover .MLEP__environment-delimiter-controls .MLEP__array-delimiter-options svg.active line {\n  stroke: var(--_accent-color);\n}\n#mathlive-environment-popover .MLEP__environment-delimiter-controls .MLEP__array-delimiter-options svg.active circle {\n  fill: var(--_accent-color);\n}\n";break;case"suggestion-popover":content="/* The element that display info while in latex mode */\n#mathlive-suggestion-popover {\n  background-color: rgba(97, 97, 97);\n  color: #fff;\n  text-align: center;\n  border-radius: 8px;\n  position: fixed;\n  z-index: 1;\n  display: none;\n  flex-direction: column;\n  justify-content: center;\n  box-shadow: 0 14px 28px rgba(0, 0, 0, 0.25), 0 10px 10px rgba(0, 0, 0, 0.22);\n}\n#mathlive-suggestion-popover.top-tip::after {\n  content: '';\n  position: absolute;\n  top: -15px;\n  left: calc(50% - 15px);\n  width: 0;\n  height: 0;\n  border-left: 15px solid transparent;\n  border-right: 15px solid transparent;\n  border-bottom: 15px solid rgba(97, 97, 97);\n  font-size: 1rem;\n}\n#mathlive-suggestion-popover.bottom-tip::after {\n  content: '';\n  position: absolute;\n  bottom: -15px;\n  left: calc(50% - 15px);\n  width: 0;\n  height: 0;\n  border-left: 15px solid transparent;\n  border-right: 15px solid transparent;\n  border-top: 15px solid rgba(97, 97, 97);\n  font-size: 1rem;\n}\n#mathlive-suggestion-popover.is-animated {\n  transition: all 0.2s cubic-bezier(0.64, 0.09, 0.08, 1);\n  animation: ML__fade-in cubic-bezier(0, 0, 0.2, 1) 0.15s;\n}\n#mathlive-suggestion-popover.is-visible {\n  display: flex;\n}\n@keyframes ML__fade-in {\n  from {\n    opacity: 0;\n  }\n  to {\n    opacity: 1;\n  }\n}\n/* The wrapper class for the entire content of the popover panel */\n#mathlive-suggestion-popover ul {\n  display: flex;\n  flex-flow: column;\n  list-style: none;\n  margin: 0;\n  padding: 0;\n  align-items: flex-start;\n  max-height: 400px;\n  overflow-y: auto;\n}\n#mathlive-suggestion-popover li {\n  display: flex;\n  flex-direction: row;\n  justify-content: space-between;\n  margin: 8px;\n  padding: 8px;\n  width: calc(100% - 16px - 16px);\n  column-gap: 1em;\n  border-radius: 8px;\n  cursor: pointer;\n  /* Since the content can be clicked on, provide feedback on hover */\n}\n#mathlive-suggestion-popover li a {\n  color: #5ea6fd;\n  padding-top: 0.3em;\n  margin-top: 0.4em;\n  display: block;\n}\n#mathlive-suggestion-popover li a:hover {\n  color: #5ea6fd;\n  text-decoration: underline;\n}\n#mathlive-suggestion-popover li:hover,\n#mathlive-suggestion-popover li.is-pressed,\n#mathlive-suggestion-popover li.is-active {\n  background: rgba(255, 255, 255, 0.1);\n}\n/* The command inside a popover (inside a #mathlive-suggestion-popover) */\n.ML__popover__command {\n  font-size: 1.6rem;\n  font-family: KaTeX_Main;\n}\n.ML__popover__current {\n  background: #5ea6fd;\n  color: #fff;\n}\n.ML__popover__latex {\n  font-family: 'IBM Plex Mono', 'Source Code Pro', Consolas, 'Roboto Mono', Menlo, 'Bitstream Vera Sans Mono', 'DejaVu Sans Mono', Monaco, Courier, monospace;\n  align-self: center;\n}\n/* The keyboard shortcuts for a symbol as displayed in the popover */\n.ML__popover__keybinding {\n  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;\n  font-size: 0.8em;\n  opacity: 0.7;\n}\n/* Style for the character that joins the modifiers of a keyboard shortcut \n(usually a \"+\" sign)*/\n.ML__shortcut-join {\n  opacity: 0.5;\n}\n";break;case"keystroke-caption":content="/* The element that displays the keys as the user type them */\n#mathlive-keystroke-caption-panel {\n  visibility: hidden;\n  /*min-width: 160px;*/\n  /*background-color: rgba(97, 97, 200, .95);*/\n  background: var(--secondary, hsl(var(--_hue), 19%, 26%));\n  border-color: var(--secondary-border, hsl(0, 0%, 91%));\n  box-shadow: 0 3px 6px rgba(0, 0, 0, 0.16), 0 3px 6px rgba(0, 0, 0, 0.23);\n  text-align: center;\n  border-radius: 6px;\n  padding: 16px;\n  position: absolute;\n  z-index: 1;\n  display: flex;\n  flex-direction: row-reverse;\n  justify-content: center;\n  --keystroke: white;\n  --on-keystroke: #555;\n  --keystroke-border: #f7f7f7;\n}\n@media (prefers-color-scheme: dark) {\n  body:not([theme='light']) #mathlive-keystroke-caption-panel {\n    --keystroke: hsl(var(--_hue), 50%, 30%);\n    --on-keystroke: hsl(0, 0%, 98%);\n    --keystroke-border: hsl(var(--_hue), 50%, 25%);\n  }\n}\nbody[theme='dark'] #mathlive-keystroke-caption-panel {\n  --keystroke: hsl(var(--_hue), 50%, 30%);\n  --on-keystroke: hsl(0, 0%, 98%);\n  --keystroke-border: hsl(var(--_hue), 50%, 25%);\n}\n#mathlive-keystroke-caption-panel > span {\n  min-width: 14px;\n  /*height: 8px;*/\n  margin: 0 8px 0 0;\n  padding: 4px;\n  background-color: var(--keystroke);\n  color: var(--on-keystroke);\n  fill: currentColor;\n  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;\n  font-size: 1em;\n  border-radius: 6px;\n  border: 2px solid var(--keystroke-border);\n  /*box-shadow: 0 7px 14px rgba(0,0,0,0.25), 0 5px 5px rgba(0,0,0,0.22);*/\n}\n";break;case"virtual-keyboard":content=".ML__keyboard {\n  --_keyboard-height: 0;\n  --_keyboard-zindex: var(--keyboard-zindex, 105);\n  --_accent-color: var(--keyboard-accent-color, #0c75d8);\n  --_background: var(--keyboard-background, #cacfd7);\n  --_border: var(--keyboard-border, #ddd);\n  --_padding-horizontal: var(--keyboard-padding-horizontal, 0px);\n  --_padding-top: var(--keyboard-padding-top, 5px);\n  --_padding-bottom: var(--keyboard-padding-bottom, 0px);\n  --_row-padding-left: var(--keyboard-row-padding-left, 0px);\n  --_row-padding-left: var(--keyboard-row-padding-right, 0px);\n  --_toolbar-text: var(--keyboard-toolbar-text, #2c2e2f);\n  --_toolbar-text-active: var(--keyboard-toolbar-text-active, var(--_accent-color));\n  --_toolbar-background: var(--keyboard-toolbar-background, transparent);\n  --_toolbar-background-hover: var(--keyboard-toolbar-background-hover, #eee);\n  --_toolbar-background-selected: var(--keyboard-toolbar-background-selected, transparent);\n  --_horizontal-rule: var(--keyboard-horizontal-rule, 1px solid #fff);\n  --_keycap-background: var(--keycap-background, white);\n  --_keycap-background-hover: var(--keycap-background, #f5f5f7);\n  --_keycap-background-active: var(--keycap-background-active, var(--_accent-color));\n  --_keycap-background-pressed: var(--keycap-background-pressed, var(--_accent-color));\n  --_keycap-border: var(--keycap-border, #e5e6e9);\n  --_keycap-border-bottom: var(--keycap-border-bottom, #8d8f92);\n  --_keycap-text: var(--keycap-text, #000);\n  --_keycap-text-active: var(--keycap-text-active, #fff);\n  --_keycap-text-hover: var(--keycap-text-hover, var(--_keycap-text));\n  --_keycap-text-pressed: var(--keycap-text-pressed, #fff);\n  --_keycap-shift-text: var(--keycap-shift-text, var(--_accent-color));\n  --_keycap-primary-background: var(--keycap-primary-background, var(--_accent-color));\n  --_keycap-primary-text: var(--keycap-primary-text, #ddd);\n  --_keycap-primary-background-hover: var(--keycap-primary-background-hover, #0d80f2);\n  --_keycap-secondary-background: var(--keycap-secondary-background, #a0a9b8);\n  --_keycap-secondary-background-hover: var(--keycap-secondary-background-hover, #7d8795);\n  --_keycap-secondary-text: var(--keycap-secondary-text, #060707);\n  --_keycap-secondary-border: var(--keycap-secondary-border, #c5c9d0);\n  --_keycap-secondary-border-bottom: var(--keycap-secondary-border-bottom, #989da6);\n  --_keycap-height: var(--keycap-height, 60px);\n  /* Keycap width (incl. margin) */\n  --_keycap-max-width: var(--keycap-max-width, 100px);\n  --_keycap-gap: var(--keycap-gap, 8px);\n  --_keycap-font-size: var(--keycap-font-size, clamp(16px, 4cqw, 24px));\n  --_keycap-small-font-size: var(--keycap-small-font-size, calc(var(--keycap-font-size) * 0.8));\n  --_keycap-extra-small-font-size: var(--keycap-extra-small-font-size, calc(var(--keycap-font-size) / 1.42));\n  --_variant-panel-background: var(--variant-panel-background, #fff);\n  --_variant-keycap-text: var(--variant-keycap-textvar, var(--_keycap-text));\n  --_variant-keycap-text-active: var(--variant-keycap-text-active, var(--_keycap-text-active));\n  --_variant-keycap-background-active: var(--variant-keycap-background-active, var(--_accent-color));\n  --_variant-keycap-length: var(--variant-keycap-length, 70px);\n  --_variant-keycap-font-size: var(--variant-keycap-font-size, 30px);\n  --_variant-keycap-aside-font-size: var(--variant-keycap-aside-font-size, 12px);\n  --_keycap-shift-font-size: var(--variant-keycap-font-size, 16px);\n  --_keycap-shift-color: var(--keycap-shift-color, var(--_accent-color));\n  --_box-placeholder-color: var(--box-placeholder-color, var(--_accent-color));\n}\n.if-can-undo,\n.if-can-redo,\n.if-can-copy,\n.if-can-cut,\n.if-can-paste {\n  opacity: 0.4;\n  pointer-events: none;\n}\n.can-undo .if-can-undo,\n.can-redo .if-can-redo,\n.can-copy .if-can-copy,\n.can-cut .if-can-cut,\n.can-paste .if-can-paste {\n  opacity: 1;\n  pointer-events: all;\n}\nbody > .ML__keyboard {\n  position: fixed;\n  --_padding-bottom: calc(var(--_padding-bottom) + env(safe-area-inset-bottom, 0));\n}\nbody > .ML__keyboard.is-visible > .MLK__backdrop {\n  box-shadow: 0 -5px 6px rgba(0, 0, 0, 0.08);\n  border-top: 1px solid var(--_border);\n}\nbody > .ML__keyboard.backdrop-is-transparent.is-visible > .MLK__backdrop {\n  box-shadow: none;\n  border: none;\n}\nbody > .ML__keyboard.is-visible.animate > .MLK__backdrop {\n  transition: 0.28s cubic-bezier(0, 0, 0.2, 1);\n  transition-property: transform, opacity;\n  transition-timing-function: cubic-bezier(0.4, 0, 1, 1);\n}\n.ML__keyboard {\n  position: relative;\n  overflow: hidden;\n  top: 0;\n  left: 0;\n  height: 100%;\n  width: 100%;\n  z-index: var(--_keyboard-zindex);\n  box-sizing: border-box;\n  outline: none;\n  border: none;\n  margin: 0;\n  padding: 0;\n  line-height: 1;\n  overflow-wrap: unset;\n  text-align: left;\n  vertical-align: baseline;\n  cursor: auto;\n  white-space: pre;\n  box-shadow: none;\n  opacity: 1;\n  transform: none;\n  pointer-events: none;\n}\n.ML__keyboard :where(div) {\n  box-sizing: border-box;\n  outline: none;\n  border: none;\n  margin: 0;\n  padding: 0;\n  line-height: 1;\n  overflow-wrap: unset;\n  text-align: left;\n  vertical-align: baseline;\n  cursor: auto;\n  white-space: pre;\n  box-shadow: none;\n  transform: none;\n}\n.MLK__backdrop {\n  position: absolute;\n  bottom: calc(-1 * var(--_keyboard-height));\n  width: 100%;\n  height: var(--_keyboard-height);\n  box-sizing: border-box;\n  padding-top: var(--_padding-top);\n  padding-bottom: var(--_padding-bottom);\n  padding-left: var(--_padding-horizontal);\n  padding-right: var(--_padding-horizontal);\n  opacity: 0;\n  visibility: hidden;\n  transform: translate(0, 0);\n  background: var(--_background);\n}\n.backdrop-is-transparent .MLK__backdrop {\n  background: transparent;\n}\n/* If a custom layout has a custom container/backdrop\n  (backdrop-is-transparent), make sure to let pointer event go through. */\n.backdrop-is-transparent .MLK__plate {\n  background: transparent;\n  pointer-events: none;\n}\n/* If a custom layout has a custom container/backdrop, make sure to \n   allow pointer events on it. */\n.backdrop-is-transparent .MLK__layer > div > div {\n  pointer-events: all;\n}\n.ML__keyboard.is-visible > .MLK__backdrop {\n  transform: translate(0, calc(-1 * var(--_keyboard-height)));\n  opacity: 1;\n  visibility: visible;\n}\n.caps-lock-indicator {\n  display: none;\n  width: 8px;\n  height: 8px;\n  background: #0cbc0c;\n  box-shadow: inset 0 0 4px 0 #13ca13, 0 0 4px 0 #a9ef48;\n  border-radius: 8px;\n  right: 8px;\n  top: 8px;\n  position: absolute;\n}\n.ML__keyboard.is-caps-lock .caps-lock-indicator {\n  display: block;\n}\n.ML__keyboard.is-caps-lock .shift {\n  background: var(--_keycap-background-active);\n  color: var(--_keycap-text-active);\n}\n.MLK__plate {\n  position: absolute;\n  top: 0;\n  left: var(--_padding-horizontal);\n  width: calc(100% - 2 * var(--_padding-horizontal));\n  margin: 0;\n  padding: 0;\n  box-sizing: border-box;\n  container-type: inline-size;\n  touch-action: none;\n  -webkit-user-select: none;\n  user-select: none;\n  pointer-events: all;\n  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;\n  font-size: 16px;\n  /* Size of toolbar labels */\n  font-weight: 400;\n  text-shadow: none;\n}\n.ML__box-placeholder {\n  color: var(--_box-placeholder-color);\n}\n.MLK__tex {\n  font-family: KaTeX_Main, KaTeX_Math, 'Cambria Math', 'Asana Math', OpenSymbol, Symbola, STIX, Times, serif !important;\n}\n.MLK__tex-math {\n  font-family: KaTeX_Math, KaTeX_Main, 'Cambria Math', 'Asana Math', OpenSymbol, Symbola, STIX, Times, serif !important;\n  font-style: italic;\n}\n.MLK__layer {\n  display: none;\n  outline: none;\n}\n.MLK__layer.is-visible {\n  display: flex;\n  flex-flow: column;\n}\n/* Keyboard layouts are made or rows of keys... */\n.MLK__rows {\n  display: flex;\n  flex-flow: column;\n  align-items: center;\n  border-collapse: separate;\n  clear: both;\n  border: 0;\n  margin: 0;\n  margin-bottom: var(--_keycap-gap);\n  gap: var(--_keycap-gap);\n  /* If the styling include, e.g., some shadows, they will be\n  cut off by the overflow. In that case, set the padding to \n  compensate. */\n  padding-left: var(--_row-padding-left);\n  padding-right: var(--_row-padding-right);\n  overflow-x: auto;\n  touch-action: none;\n}\n.MLK__rows > .row {\n  display: flex;\n  flex-flow: row;\n  justify-content: center;\n  width: 100%;\n  gap: var(--_keycap-gap);\n  margin: 0;\n  padding: 0;\n  /* For the alignment of the text on some modifiers (e.g. shift) */\n  /* Extra spacing between two adjacent keys */\n  /** A regular keycap */\n}\n.MLK__rows > .row .tex {\n  font-family: KaTeX_Math, KaTeX_Main, 'Cambria Math', 'Asana Math', OpenSymbol, Symbola, STIX, Times, serif !important;\n}\n.MLK__rows > .row .tex-math {\n  font-family: KaTeX_Math, 'Cambria Math', 'Asana Math', OpenSymbol, Symbola, STIX, Times, serif !important;\n}\n.MLK__rows > .row .big-op {\n  font-size: calc(1.25 * var(--_keycap-font-size));\n}\n.MLK__rows > .row .small {\n  font-size: var(--_keycap-small-font-size);\n}\n.MLK__rows > .row .bottom {\n  justify-content: flex-end;\n}\n.MLK__rows > .row .left {\n  align-items: flex-start;\n  padding-left: 12px;\n}\n.MLK__rows > .row .right {\n  align-items: flex-end;\n  padding-right: 12px;\n}\n.MLK__rows > .row .w0 {\n  width: 0;\n}\n.MLK__rows > .row .w5 {\n  width: calc(min(var(--_keycap-max-width, 100px), 10cqw) / 2 - var(--_keycap-gap));\n}\n.MLK__rows > .row .w15 {\n  width: calc(1.5 * min(var(--_keycap-max-width, 100px), 10cqw) - var(--_keycap-gap));\n}\n.MLK__rows > .row .w20 {\n  width: calc(2 * min(var(--_keycap-max-width, 100px), 10cqw) - var(--_keycap-gap));\n}\n.MLK__rows > .row .w50 {\n  width: calc(5 * min(var(--_keycap-max-width, 100px), 10cqw) - var(--_keycap-gap));\n}\n.MLK__rows > .row .MLK__keycap.w50 {\n  font-size: 80%;\n  padding-top: 10px;\n  font-weight: 100;\n}\n.MLK__rows > .row .separator {\n  background: transparent;\n  border: none;\n  pointer-events: none;\n}\n.MLK__rows > .row .horizontal-rule {\n  height: 6px;\n  margin-top: 3px;\n  margin-bottom: 0;\n  width: 100%;\n  border-radius: 0;\n  border-top: var(--_horizontal-rule);\n}\n.MLK__rows > .row .ghost {\n  background: var(--_toolbar-background);\n  border: none;\n  color: var(--_toolbar-text);\n}\n.MLK__rows > .row .ghost:hover {\n  background: var(--_toolbar-background-hover);\n}\n.MLK__rows > .row .bigfnbutton {\n  font-size: var(--_keycap-extra-small-font-size);\n}\n.MLK__rows > .row .shift,\n.MLK__rows > .row .action {\n  color: var(--_keycap-secondary-text);\n  background: var(--_keycap-secondary-background);\n  border-color: var(--_keycap-secondary-border);\n  border-bottom-color: var(--_keycap-secondary-border-bottom);\n  line-height: 0.8;\n  font-size: min(1rem, var(--_keycap-small-font-size));\n  font-weight: 600;\n  padding: 8px 12px 8px 12px;\n}\n.MLK__rows > .row .shift:hover,\n.MLK__rows > .row .action:hover {\n  background: var(--_keycap-secondary-background-hover);\n}\n.MLK__rows > .row .action.primary {\n  background: var(--_keycap-primary-background);\n  color: var(--_keycap-primary-text);\n}\n.MLK__rows > .row .action.primary:hover {\n  background: var(--_keycap-primary-background-hover);\n  color: var(--_keycap-primary-text);\n}\n.MLK__rows > .row .shift.selected,\n.MLK__rows > .row .action.selected {\n  color: var(--_toolbar-text-active);\n}\n.MLK__rows > .row .shift.selected.is-pressed,\n.MLK__rows > .row .action.selected.is-pressed,\n.MLK__rows > .row .shift.selected.is-active,\n.MLK__rows > .row .action.selected.is-active {\n  color: white;\n}\n.MLK__rows > .row .warning {\n  background: #cd0030;\n  color: white;\n}\n.MLK__rows > .row .warning svg.svg-glyph {\n  width: 24px;\n  height: 24px;\n  min-height: 24px;\n}\n.MLK__rows > .row div {\n  display: flex;\n  flex-flow: column;\n  align-items: center;\n  justify-content: space-evenly;\n  width: calc(min(var(--_keycap-max-width), 10cqw) - var(--_keycap-gap));\n  height: var(--_keycap-height);\n  box-sizing: border-box;\n  padding: 0;\n  vertical-align: top;\n  text-align: center;\n  float: left;\n  color: var(--_keycap-text);\n  fill: currentColor;\n  font-size: var(--_keycap-font-size);\n  background: var(--_keycap-background);\n  border: 1px solid var(--_keycap-border);\n  border-bottom-color: var(--_keycap-border-bottom);\n  border-radius: 6px;\n  cursor: pointer;\n  touch-action: none;\n  /* Keys with a variants panel */\n  position: relative;\n  overflow: hidden;\n  -webkit-user-select: none;\n  user-select: none;\n  -webkit-tap-highlight-color: transparent;\n}\n.MLK__rows > .row div:hover {\n  background: var(--_keycap-background-hover);\n}\n.MLK__rows > .row div .ML__mathlive {\n  pointer-events: none;\n  touch-action: none;\n}\n.MLK__rows > .row div svg.svg-glyph {\n  margin: 8px 0;\n  width: 20px;\n  height: 20px;\n  min-height: 20px;\n}\n.MLK__rows > .row div svg.svg-glyph-lg {\n  margin: 8px 0;\n  width: 24px;\n  height: 24px;\n  min-height: 24px;\n}\n.MLK__rows > .row div.MLK__tex-math {\n  font-size: 25px;\n}\n.MLK__rows > .row div.is-pressed {\n  background: var(--_keycap-background-pressed);\n  color: var(--_keycap-text-pressed);\n}\n.MLK__rows > .row div.MLK__keycap.is-active,\n.MLK__rows > .row div.action.is-active,\n.MLK__rows > .row div.MLK__keycap.is-pressed,\n.MLK__rows > .row div.action.is-pressed {\n  z-index: calc(var(--_keyboard-zindex) - 5);\n}\n.MLK__rows > .row div.MLK__keycap.is-active aside,\n.MLK__rows > .row div.action.is-active aside,\n.MLK__rows > .row div.MLK__keycap.is-pressed aside,\n.MLK__rows > .row div.action.is-pressed aside {\n  display: none;\n}\n.MLK__rows > .row div.MLK__keycap.is-active .MLK__shift,\n.MLK__rows > .row div.action.is-active .MLK__shift,\n.MLK__rows > .row div.MLK__keycap.is-pressed .MLK__shift,\n.MLK__rows > .row div.action.is-pressed .MLK__shift {\n  display: none;\n}\n.MLK__rows > .row div.shift.is-pressed,\n.MLK__rows > .row div.MLK__keycap.is-pressed,\n.MLK__rows > .row div.action.is-pressed {\n  background: var(--_keycap-background-pressed);\n  color: var(--_keycap-text-pressed);\n}\n.MLK__rows > .row div.shift.is-active,\n.MLK__rows > .row div.MLK__keycap.is-active,\n.MLK__rows > .row div.action.is-active {\n  background: var(--_keycap-background-active);\n  color: var(--_keycap-text-active);\n}\n.MLK__rows > .row div small {\n  color: var(--_keycap-secondary-text);\n}\n.MLK__rows > .row div aside {\n  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;\n  font-size: 10px;\n  line-height: 10px;\n  color: var(--_keycap-secondary-text);\n}\n/* Add an attribute 'data-tooltip' to display a tooltip on hover.\nNote there are a different set of tooltip rules for the keyboard toggle\n(it's in a different CSS tree) */\n.MLK__tooltip {\n  position: relative;\n}\n.MLK__tooltip::after {\n  position: absolute;\n  display: inline-table;\n  content: attr(data-tooltip);\n  top: inherit;\n  bottom: 100%;\n  width: max-content;\n  max-width: 200px;\n  padding: 8px 8px;\n  background: #616161;\n  color: #fff;\n  text-align: center;\n  z-index: 2;\n  box-shadow: 0 2px 2px 0 rgba(0, 0, 0, 0.14), 0 1px 5px 0 rgba(0, 0, 0, 0.12), 0 3px 1px -2px rgba(0, 0, 0, 0.2);\n  border-radius: 2px;\n  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;\n  font-weight: 400;\n  font-size: 12px;\n  transition: all 0.15s cubic-bezier(0.4, 0, 1, 1) 1s;\n  opacity: 0;\n  transform: scale(0.5);\n}\n.MLK__tooltip:hover {\n  position: relative;\n}\n.MLK__tooltip:hover::after {\n  opacity: 1;\n  transform: scale(1);\n}\n.MLK__toolbar {\n  align-self: center;\n  display: flex;\n  flex-flow: row;\n  justify-content: space-between;\n  width: 100%;\n  max-width: 996px;\n  min-height: 32px;\n  /* Icons for undo/redo, etc. */\n}\n.MLK__toolbar svg {\n  height: 20px;\n  width: 20px;\n}\n.MLK__toolbar > .left {\n  position: relative;\n  display: flex;\n  justify-content: flex-start;\n  flex-flow: row;\n}\n.MLK__toolbar > .right {\n  display: flex;\n  justify-content: flex-end;\n  flex-flow: row;\n}\n.MLK__toolbar > div > div {\n  /* \"button\" in the toolbar */\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  color: var(--_toolbar-text);\n  fill: currentColor;\n  background: var(--_toolbar-background);\n  font-size: 135%;\n  padding: 4px 15px;\n  cursor: pointer;\n  width: max-content;\n  min-width: 42px;\n  min-height: 22px;\n  border: none;\n  padding-left: 10px;\n  padding-right: 10px;\n  padding-bottom: 8px;\n  padding-top: 8px;\n  margin-top: 7px;\n  margin-bottom: 8px;\n  margin-left: 4px;\n  margin-right: 4px;\n  border-radius: 8px;\n  box-shadow: none;\n  border-bottom: 2px solid transparent;\n}\n.MLK__toolbar > div > div:not(.disabled):not(.selected):hover {\n  background: var(--_toolbar-background-hover);\n}\n.MLK__toolbar > div > div.disabled svg,\n.MLK__toolbar > div > div.disabled:hover svg,\n.MLK__toolbar > div > div.disabled.is-pressed svg {\n  color: var(--_toolbar-text);\n  opacity: 0.2;\n}\n.MLK__toolbar > div > div:hover,\n.MLK__toolbar > div > div:active,\n.MLK__toolbar > div > div.is-pressed,\n.MLK__toolbar > div > div.is-active {\n  color: var(--_toolbar-text-active);\n}\n.MLK__toolbar > div > div.selected {\n  color: var(--_toolbar-text-active);\n  background: var(--_toolbar-background-selected);\n  border-radius: 0;\n  border-bottom-color: var(--_toolbar-text-active);\n  padding-bottom: 4px;\n  margin-bottom: 12px;\n}\n/* This is the element that displays variants on press+hold */\n.MLK__variant-panel {\n  visibility: hidden;\n  position: fixed;\n  display: flex;\n  flex-flow: row wrap-reverse;\n  justify-content: center;\n  align-content: center;\n  margin: 0;\n  padding: 0;\n  bottom: auto;\n  top: 0;\n  box-sizing: content-box;\n  transform: none;\n  z-index: calc(var(--_keyboard-zindex) + 1);\n  touch-action: none;\n  max-width: 350px;\n  background: var(--_variant-panel-background);\n  text-align: center;\n  border-radius: 6px;\n  padding: 6px;\n  box-shadow: 0 14px 28px rgba(0, 0, 0, 0.25), 0 10px 10px rgba(0, 0, 0, 0.22);\n  transition: none;\n}\n.MLK__variant-panel.is-visible {\n  visibility: visible;\n}\n.MLK__variant-panel.compact {\n  --_variant-keycap-length: var(--variant-keycap-length, 50px);\n  --_variant-keycap-font-size: var(--variant-keycap-font-size, 24px);\n  --_variant-keycap-aside-font-size: var(--variant-keycap-aside-font-size, 10px);\n}\n.MLK__variant-panel .item {\n  display: flex;\n  flex-flow: column;\n  align-items: center;\n  justify-content: center;\n  font-size: var(--_variant-keycap-font-size);\n  height: var(--_variant-keycap-length);\n  width: var(--_variant-keycap-length);\n  margin: 0;\n  box-sizing: border-box;\n  border-radius: 5px;\n  border: 1px solid transparent;\n  background: transparent;\n  pointer-events: all;\n  cursor: pointer;\n  color: var(--_variant-keycap-text);\n  fill: currentColor;\n}\n@media (max-height: 412px) {\n  .MLK__variant-panel .item {\n    --_variant-keycap-font-size: var(--variant-keycap-font-size, 24px);\n    --_variant-keycap-length: var(--variant-keycap-length, 50px);\n  }\n}\n.MLK__variant-panel .item .ML__mathlive {\n  pointer-events: none;\n}\n.MLK__variant-panel .item.is-active {\n  background: var(--_variant-keycap-background-active);\n  color: var(--_variant-keycap-text-active);\n}\n.MLK__variant-panel .item.is-pressed {\n  background: var(--_variant-keycap-background-pressed);\n  color: var(--_variant-keycap-text-pressed);\n}\n.MLK__variant-panel .item.small {\n  font-size: var(--_keycap-small-font-size);\n}\n.MLK__variant-panel .item.swatch-button {\n  box-sizing: border-box;\n  background: #fbfbfb;\n}\n.MLK__variant-panel .item.swatch-button > span {\n  display: inline-block;\n  margin: 6px;\n  width: calc(100% - 12px);\n  height: calc(100% - 12px);\n  border-radius: 50%;\n}\n.MLK__variant-panel .item.swatch-button:hover {\n  background: #f0f0f0;\n}\n.MLK__variant-panel .item.swatch-button:hover > span {\n  border-radius: 2px;\n}\n.MLK__variant-panel .item.box > div,\n.MLK__variant-panel .item.box > span {\n  border: 1px dashed rgba(0, 0, 0, 0.24);\n}\n.MLK__variant-panel .item .warning {\n  min-height: 60px;\n  min-width: 60px;\n  background: #cd0030;\n  color: white;\n  padding: 5px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  border-radius: 5px;\n}\n.MLK__variant-panel .item .warning.is-pressed,\n.MLK__variant-panel .item .warning.is-active {\n  background: red;\n}\n.MLK__variant-panel .item .warning svg.svg-glyph {\n  width: 50px;\n  height: 50px;\n}\n.MLK__variant-panel .item aside {\n  font-size: var(--_variant-keycap-aside-font-size);\n  line-height: 12px;\n  opacity: 0.78;\n  padding-top: 2px;\n}\n.MLK__keycap {\n  position: relative;\n}\n.MLK__shift {\n  display: block;\n  position: absolute;\n  right: 4px;\n  top: 4px;\n  font-size: var(--_keycap-shift-font-size);\n  color: var(--_keycap-shift-color);\n}\n.hide-shift .MLK__shift {\n  display: none;\n}\n@media (max-width: 414px) {\n  .MLK__variant-panel {\n    max-width: 350px;\n    --_variant-keycap-font-size: var(--variant-keycap-font-size, 24px);\n    --_variant-keycap-length: var(--variant-keycap-length, 50px);\n  }\n}\n/* @xs breakpoint: iPhone 5 */\n@container (max-width: 414px) {\n  .MLK__rows {\n    --_keycap-gap: min(var(--_keycap-gap, 2px), 2px);\n    --_keycap-height: min(var(--_keycap-height, 42px), 42px);\n    --_keycap-max-width: min(var(--_keycap-max-width, 62px), 62px);\n  }\n  .MLK__toolbar > div > div {\n    font-size: 100%;\n    padding: 0;\n    margin-left: 2px;\n    margin-right: 2px;\n  }\n  .MLK__rows .shift,\n  .MLK__rows .action {\n    font-size: 65%;\n  }\n  .MLK__rows .warning svg.svg-glyph {\n    width: 14px;\n    height: 14px;\n    min-height: 14px;\n  }\n}\n@container (max-width: 744px) {\n  .MLK__rows {\n    --_keycap-gap: min(var(--keycap-gap, 2px), 2px);\n    --_keycap-height: min(var(--keycap-height, 52px), 52px);\n    --_keycap-max-width: min(var(--keycap-max-width, 62px), 62px);\n  }\n  .MLK__toolbar > div > div {\n    padding-left: 0;\n    padding-right: 0;\n  }\n  .MLK__tooltip::after {\n    padding: 8px 16px;\n    font-size: 16px;\n  }\n  .MLK__rows > .row > div.fnbutton {\n    font-size: 16px;\n  }\n  .MLK__rows > .row > div.bigfnbutton {\n    font-size: calc(var(--_keycap-extra-small-font-size) / 1.55);\n  }\n  .MLK__rows > .row > div.small {\n    font-size: 13px;\n  }\n  .MLK__rows > .row > div > aside {\n    display: none;\n  }\n  .MLK__shift {\n    display: none;\n  }\n}\n/* Medium breakpoint: larger phones */\n@container (max-width: 768px) {\n  .MLK__rows {\n    --_keycap-height: min(var(--keycap-height, 42px), 42px);\n  }\n  .MLK__rows > .row > div > small {\n    font-size: 14px;\n  }\n}\n@container (max-width: 1444px) {\n  .MLK__rows .if-wide {\n    display: none;\n  }\n}\n@media (prefers-color-scheme: dark) {\n  .ML__keyboard {\n    --_accent-color: var(--keyboard-accent-color, #0b5c9c);\n    --_background: var(--keyboard-background, #151515);\n    --_border: var(--keyboard-border, transparent);\n    --_toolbar-text: var(--keyboard-toolbar-text, #e3e4e8);\n    --_toolbar-background-hover: var(--keyboard-toolbar-background-hover, #303030);\n    --keyboard-toolbar-background-hover: #303030;\n    --_horizontal-rule: var(--keyboard-horizontal-rule, 1px solid #303030);\n    --_keycap-background: var(--keycap-background, #1f2022);\n    --_keycap-background-hover: var(--keycap-background, #2f3032);\n    --_keycap-border: var(--_keycap-border, transparent);\n    --_keycap-border-bottom: var(--_keycap-border-bottom, transparent);\n    --_keycap-text: var(--keycap-text, #e3e4e8);\n    --_keycap-secondary-background: var(--keycap-secondary-background, #3d4144);\n    --_keycap-secondary-background-hover: var(--keycap-secondary-background-hover, #4d5154);\n    --_keycap-secondary-text: var(--keycap-secondary-text, #e7ebee);\n    --keycap-secondary-border: transparent;\n    --keycap-secondary-border-bottom: transparent;\n    --_keycap-secondary-border: var(--keycap-secondary-border, transparent);\n    --_keycap-secondary-border-bottom: var(--keycap-secondary-border-bottom, transparent);\n    --_variant-panel-background: var(--variant-panel-background, #303030);\n    --_variant-keycap-text-active: var(--variant-keycap-text-active, #fff);\n  }\n}\n/* Same as the media query, but with a class */\n[theme='dark'] .ML__keyboard .ML__keyboard {\n  --_accent-color: var(--keyboard-accent-color, #0b5c9c);\n  --_background: var(--keyboard-background, #151515);\n  --_border: var(--keyboard-border, transparent);\n  --_toolbar-text: var(--keyboard-toolbar-text, #e3e4e8);\n  --_toolbar-background-hover: var(--keyboard-toolbar-background-hover, #303030);\n  --keyboard-toolbar-background-hover: #303030;\n  --_horizontal-rule: var(--keyboard-horizontal-rule, 1px solid #303030);\n  --_keycap-background: var(--keycap-background, #1f2022);\n  --_keycap-background-hover: var(--keycap-background, #2f3032);\n  --_keycap-border: var(--_keycap-border, transparent);\n  --_keycap-border-bottom: var(--_keycap-border-bottom, transparent);\n  --_keycap-text: var(--keycap-text, #e3e4e8);\n  --_keycap-secondary-background: var(--keycap-secondary-background, #3d4144);\n  --_keycap-secondary-background-hover: var(--keycap-secondary-background-hover, #4d5154);\n  --_keycap-secondary-text: var(--keycap-secondary-text, #e7ebee);\n  --keycap-secondary-border: transparent;\n  --keycap-secondary-border-bottom: transparent;\n  --_keycap-secondary-border: var(--keycap-secondary-border, transparent);\n  --_keycap-secondary-border-bottom: var(--keycap-secondary-border-bottom, transparent);\n  --_variant-panel-background: var(--variant-panel-background, #303030);\n  --_variant-keycap-text-active: var(--variant-keycap-text-active, #fff);\n}\n[theme='light'] .ML__keyboard {\n  --_accent-color: var(--keyboard-accent-color, #0c75d8);\n  --_background: var(--keyboard-background, #cacfd7);\n  --_border: var(--keyboard-border, #ddd);\n  --_toolbar-text: var(--keyboard-toolbar-text, #2c2e2f);\n  --_toolbar-background: var(--keyboard-toolbar-background, transparent);\n  --_toolbar-background-hover: var(--keyboard-toolbar-background-hover, #eee);\n  --_toolbar-background-selected: var(--keyboard-toolbar-background-selected, transparent);\n  --_horizontal-rule: var(--keyboard-horizontal-rule, 1px solid #fff);\n  --_keycap-background: var(--keycap-background, white);\n  --_keycap-background-hover: var(--keycap-background, #f5f5f7);\n  --_keycap-background-active: var(--keycap-background-active, var(--_accent-color));\n  --_keycap-background-pressed: var(--keycap-background-pressed, var(--_accent-color));\n  --_keycap-border: var(--_keycap-border, #e5e6e9);\n  --_keycap-border-bottom: var(--_keycap-border-bottom, #8d8f92);\n  --_keycap-text: var(--keycap-text, #000);\n  --_keycap-text-active: var(--keycap-text-active, #fff);\n  --_keycap-text-hover: var(--keycap-text-hover, var(--_keycap-text));\n  --_keycap-text-pressed: var(--keycap-text-pressed, #fff);\n  --_keycap-shift-text: var(--keycap-shift-text, var(--_accent-color));\n  --_keycap-secondary-background: var(--keycap-secondary-background, #a0a9b8);\n  --_keycap-secondary-background-hover: var(--keycap-secondary-background-hover, #7d8795);\n  --_keycap-secondary-text: var(--keycap-secondary-text, #060707);\n  --_keycap-secondary-border: var(--keycap-secondary-border, #c5c9d0);\n  --_keycap-secondary-border-bottom: var(--keycap-secondary-border-bottom, #989da6);\n  --_variant-panel-background: var(--variant-panel-background, #fff);\n  --_variant-keycap-text: var(--variant-keycap-textvar, var(--_keycap-text));\n  --_variant-keycap-text-active: var(--variant-keycap-text-active, var(--_keycap-text-active));\n  --_variant-keycap-background-active: var(--variant-keycap-background-active, var(--_accent-color));\n}\n"}return gStylesheets[id].replaceSync(content),gStylesheets[id]}function injectStylesheet(id){var _a3;if(gInjectedStylesheets||(gInjectedStylesheets={}),0!==(null!=(_a3=gInjectedStylesheets[id])?_a3:0))gInjectedStylesheets[id]+=1;else{var stylesheet=getStylesheet(id);document.adoptedStyleSheets=[].concat(_toConsumableArray(document.adoptedStyleSheets),[stylesheet]),gInjectedStylesheets[id]=1}}function releaseStylesheet(id){if((null==gInjectedStylesheets?void 0:gInjectedStylesheets[id])&&(gInjectedStylesheets[id]-=1,gInjectedStylesheets[id]<=0)){console.log("releasign stylesheet ",id);var stylesheet=gStylesheets[id];document.adoptedStyleSheets=document.adoptedStyleSheets.filter((function(x){return x!==stylesheet}))}}var AccentAtom=function(_Atom2){_inherits(AccentAtom,_Atom2);var _super3=_createSuper(AccentAtom);function AccentAtom(options){var _this3,_a3;return _classCallCheck(this,AccentAtom),_this3=_super3.call(this,__spreadProps(__spreadValues({},options),{type:"accent",body:null!=(_a3=options.body)?_a3:void 0})),options.accentChar?_this3.accent=options.accentChar:_this3.svgAccent=null==options?void 0:options.svgAccent,_this3.skipBoundary=!0,_this3.captureSelection=!0,_this3}return _createClass(AccentAtom,[{key:"toJson",value:function(){return __spreadProps(__spreadValues({},_get(_getPrototypeOf(AccentAtom.prototype),"toJson",this).call(this)),{accentChar:this.accent,svgAccent:this.svgAccent})}},{key:"render",value:function(parentContext){var _a3,context=new Context({parent:parentContext,mathstyle:"cramp"},this.style),base=null!=(_a3=Atom.createBox(context,this.body))?_a3:new Box("▢",{style:this.style}),skew=0;!this.hasEmptyBranch("body")&&2===this.body.length&&this.body[1].isCharacterBox()&&(skew=base.skew);var accentBox,clearance=Math.min(base.height,.431);if(this.svgAccent)accentBox=makeSVGBox(this.svgAccent),clearance=context.metrics.bigOpSpacing1-clearance;else if(this.accent){var accent=new Box(this.accent,{fontFamily:"Main-Regular"});accent.italic=0;var vecClass=8407===this.accent?" ML__accent-vec":"";accentBox=new Box(new Box(accent),{classes:"ML__accent-body"+vecClass})}accentBox=new VBox({shift:0,children:[{box:new Box(base)},-clearance,{box:accentBox,marginLeft:base.left+2*skew,classes:["ML__center"]}]});var result=new Box(accentBox,{type:"lift"});return this.caret&&(result.caret=this.caret),this.bind(context,result.wrap(context)),this.attachSupsub(context,{base:result})}}],[{key:"fromJson",value:function(json){return new AccentAtom(json)}}]),AccentAtom}(Atom),RIGHT_DELIM={"(":")","{":"}","[":"]","|":"|","\\lbrace":"\\rbrace","\\lparen":"\\rparen","\\{":"\\}","\\langle":"\\rangle","\\lfloor":"\\rfloor","\\lceil":"\\rceil","\\vert":"\\vert","\\lvert":"\\rvert","\\Vert":"\\Vert","\\lVert":"\\rVert","\\lbrack":"\\rbrack","\\ulcorner":"\\urcorner","\\llcorner":"\\lrcorner","\\lgroup":"\\rgroup","\\lmoustache":"\\rmoustache"},LEFT_DELIM=Object.fromEntries(Object.entries(RIGHT_DELIM).map((function(_ref2){var _ref3=_slicedToArray(_ref2,2),leftDelim=_ref3[0];return[_ref3[1],leftDelim]})));function getSymbolValue(symbol){var _a3;return null!=(_a3={"[":91,"]":93,"(":40,")":41,"\\mid":8739,"|":8739,"∣":8739,"∥":8741,"\\|":8739,"\\{":123,"\\}":125,"\\lbrace":123,"\\rbrace":125,"\\lparen":40,"\\rparen":41,"\\lbrack":91,"\\rbrack":93,"\\vert":8739,"\\lvert":8739,"\\mvert":8739,"\\rvert":8739,"\\Vert":8741,"\\lVert":8741,"\\mVert":8741,"\\rVert":8741,"\\parallel":8741,"\\shortparallel":8741,"\\langle":10216,"\\rangle":10217,"\\lfloor":8970,"\\rfloor":8971,"\\lceil":8968,"\\rceil":8969,"\\ulcorner":9484,"\\urcorner":9488,"\\llcorner":9492,"\\lrcorner":9496,"\\lgroup":10222,"\\rgroup":10223,"\\lmoustache":9136,"\\rmoustache":9137,"\\surd":8730}[symbol])?_a3:symbol.codePointAt(0)}function makeLargeDelim(delim,size,center,parentContext,options){var _a3,_b3,context=new Context({parent:parentContext,mathstyle:"textstyle"},null==options?void 0:options.style),result=new Box(getSymbolValue(delim),{fontFamily:"Size".concat(size,"-Regular"),isSelected:options.isSelected,classes:(null!=(_a3=options.classes)?_a3:"")+" ML__delim-size".concat(size),type:null!=(_b3=options.type)?_b3:"ignore"}).wrap(context);return center&&result.setTop(.25*(1-context.scalingFactor)),result}function makeStackedDelim(delim,heightTotal,center,context,options){var _a3,top,middle,repeat,bottom;top=repeat=bottom=getSymbolValue(delim),middle=null;var fontFamily="Size1-Regular";"\\vert"===delim||"\\lvert"===delim||"\\rvert"===delim||"\\mvert"===delim||"\\mid"===delim?repeat=top=bottom=8739:"\\Vert"===delim||"\\lVert"===delim||"\\rVert"===delim||"\\mVert"===delim||"\\|"===delim?repeat=top=bottom=8741:"\\uparrow"===delim?repeat=bottom=9168:"\\Uparrow"===delim?repeat=bottom=8214:"\\downarrow"===delim?top=repeat=9168:"\\Downarrow"===delim?top=repeat=8214:"\\updownarrow"===delim?(top=8593,repeat=9168,bottom=8595):"\\Updownarrow"===delim?(top=8657,repeat=8214,bottom=8659):"["===delim||"\\lbrack"===delim?(top=9121,repeat=9122,bottom=9123,fontFamily="Size4-Regular"):"]"===delim||"\\rbrack"===delim?(top=9124,repeat=9125,bottom=9126,fontFamily="Size4-Regular"):"\\lfloor"===delim||"⌊"===delim?(repeat=top=9122,bottom=9123,fontFamily="Size4-Regular"):"\\lceil"===delim||"⌈"===delim?(top=9121,repeat=bottom=9122,fontFamily="Size4-Regular"):"\\rfloor"===delim||"⌋"===delim?(repeat=top=9125,bottom=9126,fontFamily="Size4-Regular"):"\\rceil"===delim||"⌉"===delim?(top=9124,repeat=bottom=9125,fontFamily="Size4-Regular"):"("===delim||"\\lparen"===delim?(top=9115,repeat=9116,bottom=9117,fontFamily="Size4-Regular"):")"===delim||"\\rparen"===delim?(top=9118,repeat=9119,bottom=9120,fontFamily="Size4-Regular"):"\\{"===delim||"\\lbrace"===delim?(top=9127,middle=9128,bottom=9129,repeat=9130,fontFamily="Size4-Regular"):"\\}"===delim||"\\rbrace"===delim?(top=9131,middle=9132,bottom=9133,repeat=9130,fontFamily="Size4-Regular"):"\\lgroup"===delim||"⟮"===delim?(top=9127,bottom=9129,repeat=9130,fontFamily="Size4-Regular"):"\\rgroup"===delim||"⟯"===delim?(top=9131,bottom=9133,repeat=9130,fontFamily="Size4-Regular"):"\\lmoustache"===delim||"⎰"===delim?(top=9127,bottom=9133,repeat=9130,fontFamily="Size4-Regular"):"\\rmoustache"===delim||"⎱"===delim?(top=9131,bottom=9129,repeat=9130,fontFamily="Size4-Regular"):"\\surd"===delim?(top=57345,bottom=9143,repeat=57344,fontFamily="Size4-Regular"):"\\ulcorner"===delim?(top=9484,repeat=bottom=32):"\\urcorner"===delim?(top=9488,repeat=bottom=32):"\\llcorner"===delim?(bottom=9492,repeat=top=32):"\\lrcorner"===delim&&(top=9496,repeat=top=32);var topMetrics=getCharacterMetrics(top,fontFamily),topHeightTotal=topMetrics.height+topMetrics.depth,repeatMetrics=getCharacterMetrics(repeat,fontFamily),repeatHeightTotal=repeatMetrics.height+repeatMetrics.depth,bottomMetrics=getCharacterMetrics(bottom,fontFamily),bottomHeightTotal=bottomMetrics.height+bottomMetrics.depth,middleHeightTotal=0,middleFactor=1;if(null!==middle){var middleMetrics=getCharacterMetrics(middle,fontFamily);middleHeightTotal=middleMetrics.height+middleMetrics.depth,middleFactor=2}var minHeight=topHeightTotal+bottomHeightTotal+middleHeightTotal,repeatCount=Math.max(0,Math.ceil((heightTotal-minHeight)/(middleFactor*repeatHeightTotal))),realHeightTotal=minHeight+repeatCount*middleFactor*repeatHeightTotal,axisHeight=.25;center&&(axisHeight*=context.scalingFactor);var depth=realHeightTotal/2-axisHeight,stack=[];stack.push({box:new Box(bottom,{fontFamily:fontFamily})}),stack.push(-.008);var repeatBox=new Box(repeat,{fontFamily:fontFamily});if(null===middle)for(var i=0;i<repeatCount;i++)stack.push({box:repeatBox});else{for(var _i11=0;_i11<repeatCount;_i11++)stack.push({box:repeatBox});stack.push(-.008),stack.push({box:new Box(middle,{fontFamily:fontFamily})}),stack.push(-.008);for(var _i12=0;_i12<repeatCount;_i12++)stack.push({box:repeatBox})}stack.push(-.008),stack.push({box:new Box(top,{fontFamily:fontFamily})});var sizeClass="";"Size1-Regular"===fontFamily?sizeClass=" delim-size1":"Size4-Regular"===fontFamily&&(sizeClass=" delim-size4");var inner=new VBox({bottom:depth,children:stack},{classes:sizeClass});return new Box(inner,__spreadProps(__spreadValues({},null!=options?options:{}),{classes:(null!=(_a3=null==options?void 0:options.classes)?_a3:"")+" ML__delim-mult"}))}var stackLargeDelimiters=new Set(["(",")","\\lparen","\\rparen","[","]","\\lbrack","\\rbrack","\\{","\\}","\\lbrace","\\rbrace","\\lfloor","\\rfloor","\\lceil","\\rceil","\\surd","⌊","⌋","⌈","⌉"]),stackAlwaysDelimiters=new Set(["\\uparrow","\\downarrow","\\updownarrow","\\Uparrow","\\Downarrow","\\Updownarrow","|","\\|","\\vert","\\Vert","\\lvert","\\rvert","\\lVert","\\rVert","\\mvert","\\mid","\\lgroup","\\rgroup","\\lmoustache","\\rmoustache","⟮","⟯","⎰","⎱"]),stackNeverDelimiters=new Set(["<",">","\\langle","\\rangle","/","\\backslash","\\lt","\\gt"]),sizeToMaxHeight=[0,1.2,1.8,2.4,3],stackNeverDelimiterSequence=[{type:"small",mathstyle:"scriptscriptstyle"},{type:"small",mathstyle:"scriptstyle"},{type:"small",mathstyle:"textstyle"},{type:"large",size:1},{type:"large",size:2},{type:"large",size:3},{type:"large",size:4}],stackAlwaysDelimiterSequence=[{type:"small",mathstyle:"scriptscriptstyle"},{type:"small",mathstyle:"scriptscriptstyle"},{type:"small",mathstyle:"textstyle"},{type:"stack"}],stackLargeDelimiterSequence=[{type:"small",mathstyle:"scriptscriptstyle"},{type:"small",mathstyle:"scriptstyle"},{type:"small",mathstyle:"textstyle"},{type:"large",size:1},{type:"large",size:2},{type:"large",size:3},{type:"large",size:4},{type:"stack"}];function makeCustomSizedDelim(type,delim,height,center,context,options){if(!delim||0===delim.length||"."===delim)return makeNullDelimiter(context);var sequence;"<"===delim||"\\lt"===delim?delim="\\langle":">"!==delim&&"\\gt"!==delim||(delim="\\rangle"),sequence=stackNeverDelimiters.has(delim)?stackNeverDelimiterSequence:stackLargeDelimiters.has(delim)?stackLargeDelimiterSequence:stackAlwaysDelimiterSequence;var delimType=function(delim,height,sequence,context){for(var info,i={"-4":0,"-3":1,0:2}[context.mathstyle.sizeDelta];i<sequence.length&&"stack"!==sequence[i].type;i++){var metrics=getCharacterMetrics(delim,"small"===(info=sequence[i]).type?"Main-Regular":"large"===info.type?"Size"+info.size+"-Regular":(console.assert("stack"===info.type),"Size4-Regular"));if(metrics.defaultMetrics)return{type:"small",mathstyle:"scriptstyle"};var heightDepth=metrics.height+metrics.depth;if("small"===sequence[i].type&&("scriptscriptstyle"===sequence[i].mathstyle?heightDepth*=Math.max(FONT_SCALE[Math.max(1,context.size-2)],context.minFontScale):"scriptstyle"===sequence[i].mathstyle&&(heightDepth*=Math.max(FONT_SCALE[Math.max(1,context.size-1)],context.minFontScale))),heightDepth>height)return sequence[i]}return sequence[sequence.length-1]}(getSymbolValue(delim),height,sequence,context),ctx=new Context({parent:context,mathstyle:delimType.mathstyle},null==options?void 0:options.style);return"small"===delimType.type?function(delim,context,center,options){var _a3,box=new Box(getSymbolValue(delim),{fontFamily:"Main-Regular",isSelected:options.isSelected,classes:"ML__small-delim "+(null!=(_a3=options.classes)?_a3:"")}).wrap(context);return center&&box.setTop(.25*(1-context.scalingFactor)),box}(delim,ctx,center,__spreadProps(__spreadValues({},options),{type:type})):"large"===delimType.type?makeLargeDelim(delim,delimType.size,center,ctx,__spreadProps(__spreadValues({},options),{type:type})):(console.assert("stack"===delimType.type),makeStackedDelim(delim,height,center,ctx,__spreadProps(__spreadValues({},options),{type:type})))}function makeLeftRightDelim(type,delim,height,depth,context,options){if("."===delim)return makeNullDelimiter(context,null==options?void 0:options.classes);var axisHeight=.25*context.scalingFactor,maxDistFromAxis=Math.max(height-axisHeight,depth+axisHeight);return makeCustomSizedDelim(type,delim,Math.max(maxDistFromAxis/500*901,2*maxDistFromAxis-.5),!0,context,options)}function makeNullDelimiter(parent,classes){return new Box(null,{classes:" nulldelimiter "+(null!=classes?classes:""),type:"ignore",width:parent.getRegisterAsEm("nulldelimiterspace")}).wrap(new Context({parent:parent,mathstyle:"textstyle"}))}var PlaceholderAtom=function(_Atom3){_inherits(PlaceholderAtom,_Atom3);var _super4=_createSuper(PlaceholderAtom);function PlaceholderAtom(options){var _this4,_a3;return _classCallCheck(this,PlaceholderAtom),(_this4=_super4.call(this,{type:"placeholder",command:"\\placeholder",mode:null!=(_a3=null==options?void 0:options.mode)?_a3:"math",style:null==options?void 0:options.style})).captureSelection=!0,_this4}return _createClass(PlaceholderAtom,[{key:"toJson",value:function(){return _get(_getPrototypeOf(PlaceholderAtom.prototype),"toJson",this).call(this)}},{key:"render",value:function(context){var result;return this.value=context.placeholderSymbol,result="function"==typeof context.renderPlaceholder?context.renderPlaceholder(context):this.createBox(context),this.caret&&(result.classes+=" ML__placeholder-selected"),result}},{key:"_serialize",value:function(){return"\\placeholder{}"}}],[{key:"fromJson",value:function(json){return new PlaceholderAtom(json)}}]),PlaceholderAtom}(Atom),matrices=["matrix","matrix*","pmatrix","pmatrix*","bmatrix","bmatrix*","Bmatrix","Bmatrix*","vmatrix","vmatrix*","Vmatrix","Vmatrix*"],cases=["cases","dcases","rcases"],align=["align","align*","aligned","gather","gathered","split"],otherTabular=["array","subequations","eqnarray"];function isMatrixEnvironment(environment){return matrices.includes(environment)}function normalizeArray(atom,array,colFormat){var _step48,maxColCount=0,_iterator48=_createForOfIteratorHelper(colFormat);try{for(_iterator48.s();!(_step48=_iterator48.n()).done;)"align"in _step48.value&&(maxColCount+=1)}catch(err){_iterator48.e(err)}finally{_iterator48.f()}var _step49,colCount=0,rows=[],_iterator49=_createForOfIteratorHelper(array);try{for(_iterator49.s();!(_step49=_iterator49.n()).done;){var _row2=_step49.value,colIndex2=0;for(colCount=Math.max(colCount,Math.min(_row2.length,maxColCount));colIndex2<_row2.length;){for(var newRow=[],lastCol=Math.min(_row2.length,colIndex2+maxColCount);colIndex2<lastCol;){var _cell=_row2[colIndex2];0===_cell.length?newRow.push([new Atom({type:"first",mode:atom.mode})]):"first"!==_cell[0].type?newRow.push([new Atom({type:"first",mode:atom.mode})].concat(_toConsumableArray(_cell))):(console.assert(!_cell.slice(1).some((function(x){return"first"===x.type}))),newRow.push(_cell)),colIndex2+=1}rows.push(newRow)}}}catch(err){_iterator49.e(err)}finally{_iterator49.f()}rows.length>0&&1===rows[rows.length-1].length&&1===rows[rows.length-1][0].length&&"first"===rows[rows.length-1][0][0].type&&rows.pop();for(var result=[],_i13=0,_rows=rows;_i13<_rows.length;_i13++){var row=_rows[_i13];if(row.length!==colCount)for(var i=row.length;i<colCount;i++)row.push([new Atom({type:"first",mode:atom.mode}),new PlaceholderAtom]);result.push(row)}for(var rowIndex=0,colIndex=0,_i14=0,_result=result;_i14<_result.length;_i14++){colIndex=0;var _step50,_iterator50=_createForOfIteratorHelper(_result[_i14]);try{for(_iterator50.s();!(_step50=_iterator50.n()).done;){var _step51,_iterator51=_createForOfIteratorHelper(_step50.value);try{for(_iterator51.s();!(_step51=_iterator51.n()).done;){var element=_step51.value;element.parent=atom,element.parentBranch=[rowIndex,colIndex]}}catch(err){_iterator51.e(err)}finally{_iterator51.f()}colIndex+=1}}catch(err){_iterator50.e(err)}finally{_iterator50.f()}rowIndex+=1}return atom.isDirty=!0,result}var ArrayAtom=function(_Atom4){_inherits(ArrayAtom,_Atom4);var _super5=_createSuper(ArrayAtom);function ArrayAtom(envName,array,rowGaps){var _this5,_a3,options=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return _classCallCheck(this,ArrayAtom),(_this5=_super5.call(this,{type:"array"})).environmentName=envName,_this5.rowGaps=rowGaps,options.mathstyleName&&(_this5.mathstyleName=options.mathstyleName),options.columns&&(0===options.columns.length?_this5.colFormat=[{align:"l"}]:_this5.colFormat=options.columns),_this5.colFormat||(_this5.colFormat=[{align:"l"},{align:"l"},{align:"l"},{align:"l"},{align:"l"},{align:"l"},{align:"l"},{align:"l"},{align:"l"},{align:"l"}]),_this5.array=normalizeArray(_assertThisInitialized(_this5),array,_this5.colFormat),options.leftDelim&&(_this5.leftDelim=options.leftDelim),options.rightDelim&&(_this5.rightDelim=options.rightDelim),void 0!==options.arraycolsep&&(_this5.arraycolsep=options.arraycolsep),_this5.colSeparationType=options.colSeparationType,void 0!==options.arraystretch&&(_this5.arraystretch=options.arraystretch),_this5.minColumns=null!=(_a3=options.minColumns)?_a3:1,_this5}return _createClass(ArrayAtom,[{key:"toJson",value:function(){var result=__spreadProps(__spreadValues({},_get(_getPrototypeOf(ArrayAtom.prototype),"toJson",this).call(this)),{environmentName:this.environmentName,array:this.array.map((function(row){return row.map((function(col){return col.map((function(x){return x.toJson()}))}))})),rowGaps:this.rowGaps,columns:this.colFormat,colSeparationType:this.colSeparationType});return void 0!==this.arraystretch&&(result.arraystretch=this.arraystretch),void 0!==this.arraycolsep&&(result.arraycolsep=this.arraycolsep),this.leftDelim&&(result.leftDelim=this.leftDelim),this.rightDelim&&(result.rightDelim=this.rightDelim),result}},{key:"branch",value:function(cell){var _a3;if(isCellBranch(cell))return null!=(_a3=this.array[cell[0]][cell[1]])?_a3:void 0}},{key:"createBranch",value:function(cell){var _a3;return isCellBranch(cell)?(this.isDirty=!0,null!=(_a3=this.branch(cell))?_a3:[]):[]}},{key:"rowCount",get:function(){return this.array.length}},{key:"colCount",get:function(){return this.array[0].length}},{key:"maxColumns",get:function(){return this.colFormat.filter((function(col){return Boolean(col.align)})).length}},{key:"removeBranch",value:function(name){if(isNamedBranch(name))return _get(_getPrototypeOf(ArrayAtom.prototype),"removeBranch",this).call(this,name);var children=this.branch(name);return this.array[name[0]][name[1]]=void 0,children.forEach((function(x){x.parent=void 0,x.parentBranch=void 0})),console.assert("first"===children[0].type),children.shift(),this.isDirty=!0,children}},{key:"hasChildren",get:function(){return this.children.length>0}},{key:"children",get:function(){var _step52,result=[],_iterator52=_createForOfIteratorHelper(this.array);try{for(_iterator52.s();!(_step52=_iterator52.n()).done;){var _step53,_iterator53=_createForOfIteratorHelper(_step52.value);try{for(_iterator53.s();!(_step53=_iterator53.n()).done;){var cell=_step53.value;if(cell){var _step54,_iterator54=_createForOfIteratorHelper(cell);try{for(_iterator54.s();!(_step54=_iterator54.n()).done;){var atom=_step54.value;result.push.apply(result,_toConsumableArray(atom.children)),result.push(atom)}}catch(err){_iterator54.e(err)}finally{_iterator54.f()}}}}catch(err){_iterator53.e(err)}finally{_iterator53.f()}}}catch(err){_iterator52.e(err)}finally{_iterator52.f()}return[].concat(result,_toConsumableArray(_get(_getPrototypeOf(ArrayAtom.prototype),"children",this)))}},{key:"render",value:function(context){var _a3,_b3,_c2,_d2,_e,_f,innerContext=new Context({parent:context,mathstyle:this.mathstyleName},this.style),arrayRuleWidth=innerContext.getRegisterAsEm("arrayrulewidth"),arrayColSep=innerContext.getRegisterAsEm("arraycolsep"),doubleRuleSep=innerContext.getRegisterAsEm("doublerulesep"),arraystretch=null!=(_b3=null!=(_a3=this.arraystretch)?_a3:innerContext.getRegisterAsNumber("arraystretch"))?_b3:1,arraycolsep="number"==typeof this.arraycolsep?this.arraycolsep:arrayColSep;"small"===this.colSeparationType&&(arraycolsep=new Context({parent:context,mathstyle:"scriptstyle"}).scalingFactor/context.scalingFactor*.2778);for(var arrayskip=1.2*arraystretch,arstrutHeight=.7*arrayskip,arstrutDepth=.3*arrayskip,totalHeight=0,body=[],nc=0,nr=this.array.length,r=0;r<nr;++r){var inrow=this.array[r];nc=Math.max(nc,inrow.length);var _step55,cellContext=new Context({parent:innerContext,mathstyle:this.mathstyleName},this.style),height=arstrutHeight/cellContext.scalingFactor,depth=arstrutDepth/cellContext.scalingFactor,outrow={cells:[],height:0,depth:0,pos:0},_iterator55=_createForOfIteratorHelper(inrow);try{for(_iterator55.s();!(_step55=_iterator55.n()).done;){var element=_step55.value,elt=null!=(_c2=Atom.createBox(cellContext,element,{type:"ignore"}))?_c2:new Box(null,{type:"ignore"});depth=Math.max(depth,elt.depth),height=Math.max(height,elt.height),outrow.cells.push(elt)}}catch(err){_iterator55.e(err)}finally{_iterator55.f()}var gap=null!=(_d2=convertDimensionToEm(this.rowGaps[r]))?_d2:0;gap>0&&(gap+=arstrutDepth,depth=Math.max(depth,gap),gap=0),r<nr-1&&!isMatrixEnvironment(this.environmentName)&&"cases"!==this.environmentName&&"array"!==this.environmentName&&(depth+=innerContext.getRegisterAsEm("jot")),outrow.height=height,outrow.depth=depth,totalHeight+=height,outrow.pos=totalHeight,totalHeight+=depth+gap,body.push(outrow)}for(var offset=totalHeight/2+.25,contentCols=[],colIndex=0;colIndex<nc;colIndex++){var _step56,stack=[],_iterator56=_createForOfIteratorHelper(body);try{for(_iterator56.s();!(_step56=_iterator56.n()).done;){var row=_step56.value,_element=row.cells[colIndex];_element.depth=row.depth,_element.height=row.height,stack.push({box:_element,shift:row.pos-offset})}}catch(err){_iterator56.e(err)}finally{_iterator56.f()}stack.length>0&&contentCols.push(new VBox({individualShift:stack}))}var _step57,cols=[],previousColContent=!1,previousColRule=!1,currentContentCol=0,firstColumn=!this.leftDelim,_iterator57=_createForOfIteratorHelper(this.colFormat);try{for(_iterator57.s();!(_step57=_iterator57.n()).done;){var colDesc=_step57.value;if("align"in colDesc&&currentContentCol>=contentCols.length)break;if("align"in colDesc)previousColContent?cols.push(makeColGap(2*arraycolsep)):(previousColRule||firstColumn)&&cols.push(makeColGap(arraycolsep)),cols.push(new Box(contentCols[currentContentCol],{classes:"col-align-"+colDesc.align})),currentContentCol++,previousColContent=!0,previousColRule=!1,firstColumn=!1;else if("gap"in colDesc){if("number"==typeof colDesc.gap)cols.push(makeColGap(colDesc.gap));else{var col=makeColOfRepeatingElements(context,body,offset,colDesc.gap);col&&cols.push(col)}previousColContent=!1,previousColRule=!1,firstColumn=!1}else if("separator"in colDesc){var separator=new Box(null,{classes:"vertical-separator"});separator.setStyle("height",totalHeight,"em"),separator.setStyle("border-right","".concat(arrayRuleWidth,"em ").concat(colDesc.separator," currentColor")),separator.setStyle("vertical-align",-(totalHeight-offset),"em");var _gap=0;previousColRule?_gap=doubleRuleSep-arrayRuleWidth:previousColContent&&(_gap=arraycolsep-arrayRuleWidth),separator.left=_gap,cols.push(separator),previousColContent=!1,previousColRule=!0,firstColumn=!1}}}catch(err){_iterator57.e(err)}finally{_iterator57.f()}previousColContent&&!this.rightDelim&&cols.push(makeColGap(arraycolsep));var inner=new Box(cols,{classes:"mtable"});if(!(this.leftDelim&&"."!==this.leftDelim||this.rightDelim&&"."!==this.rightDelim))return this.caret&&(inner.caret=this.caret),inner;var innerHeight=inner.height,innerDepth=inner.depth,result=this.bind(context,new Box([this.bind(context,makeLeftRightDelim("open",null!=(_e=this.leftDelim)?_e:".",innerHeight,innerDepth,innerContext,{isSelected:this.isSelected})),inner,this.bind(context,makeLeftRightDelim("close",null!=(_f=this.rightDelim)?_f:".",innerHeight,innerDepth,innerContext,{isSelected:this.isSelected}))],{type:"ord"}));return result?(this.caret&&(result.caret=this.caret),this.attachSupsub(context,{base:result})):null}},{key:"_serialize",value:function(options){var _a3,result=["\\begin{".concat(this.environmentName,"}")];if("array"===this.environmentName){if(result.push("{"),void 0!==this.colFormat){var _step58,_iterator58=_createForOfIteratorHelper(this.colFormat);try{for(_iterator58.s();!(_step58=_iterator58.n()).done;){var format=_step58.value;"align"in format&&"string"==typeof format.align?result.push(format.align):"separator"in format&&"solid"===format.separator?result.push("|"):"separator"in format&&"dashed"===format.separator&&result.push(":")}}catch(err){_iterator58.e(err)}finally{_iterator58.f()}}result.push("}")}for(var row=0;row<this.array.length;row++){for(var col=0;col<this.array[row].length;col++)col>0&&result.push(" & "),result.push(Atom.serialize(this.array[row][col],options));if(row<this.array.length-1){var gap=this.rowGaps[row];(null==gap?void 0:gap.dimension)?result.push("\\\\[".concat(gap.dimension," ").concat(null!=(_a3=gap.unit)?_a3:"pt","] ")):result.push("\\\\ ")}}return result.push("\\end{".concat(this.environmentName,"}")),joinLatex(result)}},{key:"getCell",value:function(row,col){return this.array[row][col]}},{key:"setCell",value:function(row,column,value){console.assert("array"===this.type&&Array.isArray(this.array)&&void 0!==this.array[row][column]);var _step59,_iterator59=_createForOfIteratorHelper(this.array[row][column]);try{for(_iterator59.s();!(_step59=_iterator59.n()).done;){var atom=_step59.value;atom.parent=void 0,atom.parentBranch=void 0}}catch(err){_iterator59.e(err)}finally{_iterator59.f()}var atoms=value;0!==value.length&&"first"===value[0].type||(atoms=[new Atom({type:"first",mode:this.mode})].concat(_toConsumableArray(value))),this.array[row][column]=atoms;var _step60,_iterator60=_createForOfIteratorHelper(atoms);try{for(_iterator60.s();!(_step60=_iterator60.n()).done;){var _atom2=_step60.value;_atom2.parent=this,_atom2.parentBranch=[row,column]}}catch(err){_iterator60.e(err)}finally{_iterator60.f()}this.isDirty=!0}},{key:"addRowBefore",value:function(row){console.assert("array"===this.type&&Array.isArray(this.array));for(var newRow=[],i=0;i<this.colCount;i++)newRow.push(makePlaceholderCell(this));this.array.splice(row,0,newRow);for(var _i15=row;_i15<this.rowCount;_i15++)for(var j=0;j<this.colCount;j++){var atoms=this.array[_i15][j];if(atoms){var _step61,_iterator61=_createForOfIteratorHelper(atoms);try{for(_iterator61.s();!(_step61=_iterator61.n()).done;)_step61.value.parentBranch=[_i15,j]}catch(err){_iterator61.e(err)}finally{_iterator61.f()}}}this.isDirty=!0}},{key:"addRowAfter",value:function(row){console.assert("array"===this.type&&Array.isArray(this.array));for(var newRow=[],i=0;i<this.colCount;i++)newRow.push(makePlaceholderCell(this));this.array.splice(row+1,0,newRow);for(var _i16=row+1;_i16<this.rowCount;_i16++)for(var j=0;j<this.colCount;j++){var atoms=this.array[_i16][j];if(atoms){var _step62,_iterator62=_createForOfIteratorHelper(atoms);try{for(_iterator62.s();!(_step62=_iterator62.n()).done;)_step62.value.parentBranch=[_i16,j]}catch(err){_iterator62.e(err)}finally{_iterator62.f()}}}this.isDirty=!0}},{key:"removeRow",value:function(row){console.assert("array"===this.type&&Array.isArray(this.array)&&this.rowCount>row);var _step63,_iterator63=_createForOfIteratorHelper(this.array.splice(row,1));try{for(_iterator63.s();!(_step63=_iterator63.n()).done;){var _step65,_iterator65=_createForOfIteratorHelper(_step63.value);try{for(_iterator65.s();!(_step65=_iterator65.n()).done;){var cell=_step65.value;if(cell){var _step66,_iterator66=_createForOfIteratorHelper(cell);try{for(_iterator66.s();!(_step66=_iterator66.n()).done;){var child=_step66.value;child.parent=void 0,child.parentBranch=void 0}}catch(err){_iterator66.e(err)}finally{_iterator66.f()}}}}catch(err){_iterator65.e(err)}finally{_iterator65.f()}}}catch(err){_iterator63.e(err)}finally{_iterator63.f()}for(var i=row;i<this.rowCount;i++)for(var j=0;j<this.colCount;j++){var atoms=this.array[i][j];if(atoms){var _step64,_iterator64=_createForOfIteratorHelper(atoms);try{for(_iterator64.s();!(_step64=_iterator64.n()).done;)_step64.value.parentBranch=[i,j]}catch(err){_iterator64.e(err)}finally{_iterator64.f()}}}this.isDirty=!0}},{key:"addColumnBefore",value:function(col){console.assert("array"===this.type&&Array.isArray(this.array));var _step67,_iterator67=_createForOfIteratorHelper(this.array);try{for(_iterator67.s();!(_step67=_iterator67.n()).done;)_step67.value.splice(col,0,makePlaceholderCell(this))}catch(err){_iterator67.e(err)}finally{_iterator67.f()}for(var i=0;i<this.rowCount;i++)for(var j=col;j<this.colCount;j++){var atoms=this.array[i][j];if(atoms){var _step68,_iterator68=_createForOfIteratorHelper(atoms);try{for(_iterator68.s();!(_step68=_iterator68.n()).done;)_step68.value.parentBranch=[i,j]}catch(err){_iterator68.e(err)}finally{_iterator68.f()}}}this.isDirty=!0}},{key:"addColumnAfter",value:function(col){console.assert("array"===this.type&&Array.isArray(this.array));var _step69,_iterator69=_createForOfIteratorHelper(this.array);try{for(_iterator69.s();!(_step69=_iterator69.n()).done;)_step69.value.splice(col+1,0,makePlaceholderCell(this))}catch(err){_iterator69.e(err)}finally{_iterator69.f()}for(var i=0;i<this.rowCount;i++)for(var j=col+1;j<this.colCount;j++){var atoms=this.array[i][j];if(atoms){var _step70,_iterator70=_createForOfIteratorHelper(atoms);try{for(_iterator70.s();!(_step70=_iterator70.n()).done;)_step70.value.parentBranch=[i,j]}catch(err){_iterator70.e(err)}finally{_iterator70.f()}}}this.isDirty=!0}},{key:"addColumn",value:function(){this.addColumnAfter(this.colCount-1)}},{key:"removeColumn",value:function(col){console.assert("array"===this.type&&Array.isArray(this.array)&&this.colCount>col);var _step71,_iterator71=_createForOfIteratorHelper(this.array);try{for(_iterator71.s();!(_step71=_iterator71.n()).done;){var _step73,_iterator73=_createForOfIteratorHelper(_step71.value.splice(col,1));try{for(_iterator73.s();!(_step73=_iterator73.n()).done;){var cell=_step73.value;if(cell){var _step74,_iterator74=_createForOfIteratorHelper(cell);try{for(_iterator74.s();!(_step74=_iterator74.n()).done;){var child=_step74.value;child.parent=void 0,child.parentBranch=void 0}}catch(err){_iterator74.e(err)}finally{_iterator74.f()}}}}catch(err){_iterator73.e(err)}finally{_iterator73.f()}}}catch(err){_iterator71.e(err)}finally{_iterator71.f()}for(var i=0;i<this.rowCount;i++)for(var j=col;j<this.colCount;j++){var atoms=this.array[i][j];if(atoms){var _step72,_iterator72=_createForOfIteratorHelper(atoms);try{for(_iterator72.s();!(_step72=_iterator72.n()).done;)_step72.value.parentBranch=[i,j]}catch(err){_iterator72.e(err)}finally{_iterator72.f()}}}this.isDirty=!0}},{key:"cells",get:function(){var _step75,result=[],_iterator75=_createForOfIteratorHelper(this.array);try{for(_iterator75.s();!(_step75=_iterator75.n()).done;){var _step76,_iterator76=_createForOfIteratorHelper(_step75.value);try{for(_iterator76.s();!(_step76=_iterator76.n()).done;){var cell=_step76.value;cell&&result.push(cell.filter((function(x){return"first"!==x.type})))}}catch(err){_iterator76.e(err)}finally{_iterator76.f()}}}catch(err){_iterator75.e(err)}finally{_iterator75.f()}return result}}],[{key:"fromJson",value:function(json){return new ArrayAtom(json.environmentName,json.array,json.rowGaps,json)}}]),ArrayAtom}(Atom);function makePlaceholderCell(parent){var first=new Atom({type:"first",mode:parent.mode});first.parent=parent;var placeholder=new PlaceholderAtom;return placeholder.parent=parent,[first,placeholder]}function makeColGap(width){return new Box(null,{classes:"arraycolsep",width:width})}function makeColOfRepeatingElements(context,rows,offset,element){if(!element)return null;var _step77,col=[],_iterator77=_createForOfIteratorHelper(rows);try{for(_iterator77.s();!(_step77=_iterator77.n()).done;){var row=_step77.value,cell=Atom.createBox(context,element,{type:"ignore"});cell&&(cell.depth=row.depth,cell.height=row.height,col.push({box:cell,shift:row.pos-offset}))}}catch(err){_iterator77.e(err)}finally{_iterator77.f()}return new VBox({individualShift:col}).wrap(context)}var BoxAtom=function(_Atom5){_inherits(BoxAtom,_Atom5);var _super6=_createSuper(BoxAtom);function BoxAtom(options){var _this6;return _classCallCheck(this,BoxAtom),(_this6=_super6.call(this,{mode:options.mode,command:options.command,style:options.style,body:options.body,type:"box"})).framecolor=options.framecolor,_this6.backgroundcolor=options.backgroundcolor,_this6.padding=options.padding,_this6.offset=options.offset,_this6.border=options.border,_this6}return _createClass(BoxAtom,[{key:"toJson",value:function(){return __spreadProps(__spreadValues({},_get(_getPrototypeOf(BoxAtom.prototype),"toJson",this).call(this)),{framecolor:this.framecolor,backgroundcolor:this.backgroundcolor,padding:this.padding,offset:this.offset,border:this.border})}},{key:"render",value:function(parentContext){var _a3,_b3,_c2,_d2,base=Atom.createBox(parentContext,this.body,{type:"lift"});if(!base)return null;var offset=parentContext.toEm(null!=(_a3=this.offset)?_a3:{dimension:0});base.depth+=offset;var context=new Context({parent:parentContext},this.style),padding2=context.toEm(null!=(_b3=this.padding)?_b3:{register:"fboxsep"}),box=new Box(null,{classes:"ML__box"});box.height=base.height+padding2,box.depth=base.depth+padding2,box.setStyle("box-sizing","border-box"),box.setStyle("position","absolute"),box.setStyle("top",.3-padding2,"em"),box.setStyle("height",box.height+box.depth,"em"),box.setStyle("left",0),box.setStyle("width","100%"),this.backgroundcolor&&box.setStyle("background-color",null!=(_c2=context.toColor(this.backgroundcolor))?_c2:"transparent"),this.framecolor&&box.setStyle("border","".concat(context.getRegisterAsEm("fboxrule",2),"em solid ").concat(null!=(_d2=context.toColor(this.framecolor))?_d2:"black")),this.border&&box.setStyle("border",this.border),base.setStyle("display","inline-block"),base.setStyle("position","relative"),base.setStyle("height",base.height+base.depth,"em"),base.setStyle("vertical-align",-base.height,"em");var result=new Box([box,base],{type:"lift"});return result.setStyle("display","inline-block"),result.setStyle("position","relative"),result.setStyle("line-height",0),result.height=base.height+padding2+(offset>0?offset:0),result.depth=base.depth+padding2+(offset<0?-offset:0),result.setStyle("padding-left",padding2,"em"),result.setStyle("padding-right",padding2,"em"),result.setStyle("height",base.height+base.depth+2*padding2+Math.abs(offset),"em"),result.setStyle("margin-top",-padding2,"em"),result.setStyle("top",base.depth-base.height+2*padding2-offset,"em"),result.setStyle("vertical-align",base.depth+2*padding2,"em"),this.caret&&(result.caret=this.caret),this.attachSupsub(parentContext,{base:result})}},{key:"_serialize",value:function(options){return options.skipStyles?joinLatex([this.bodyToLatex(options),this.supsubToLatex(options)]):_get(_getPrototypeOf(BoxAtom.prototype),"_serialize",this).call(this,options)}}],[{key:"fromJson",value:function(json){return new BoxAtom(json)}}]),BoxAtom}(Atom),CompositionAtom=function(_Atom6){_inherits(CompositionAtom,_Atom6);var _super7=_createSuper(CompositionAtom);function CompositionAtom(value,options){var _a3;return _classCallCheck(this,CompositionAtom),_super7.call(this,{type:"composition",mode:null!=(_a3=null==options?void 0:options.mode)?_a3:"math",value:value})}return _createClass(CompositionAtom,[{key:"toJson",value:function(){return _get(_getPrototypeOf(CompositionAtom.prototype),"toJson",this).call(this)}},{key:"computedStyle",get:function(){return{}}},{key:"render",value:function(context){var result=new Box(this.value,{classes:"ML__composition",type:"composition"});return this.bind(context,result),this.caret&&(result.caret=this.caret),result}},{key:"_serialize",value:function(_options){return""}}],[{key:"fromJson",value:function(json){return new CompositionAtom(json.value,json)}}]),CompositionAtom}(Atom),ErrorAtom=function(_Atom7){_inherits(ErrorAtom,_Atom7);var _super8=_createSuper(ErrorAtom);function ErrorAtom(value){var _this7;return _classCallCheck(this,ErrorAtom),(_this7=_super8.call(this,{type:"error",value:value,command:value,mode:"math"})).verbatimLatex=value,_this7}return _createClass(ErrorAtom,[{key:"toJson",value:function(){return _get(_getPrototypeOf(ErrorAtom.prototype),"toJson",this).call(this)}},{key:"render",value:function(context){var result=this.createBox(context,{classes:"ML__error"});return this.caret&&(result.caret=this.caret),result}}],[{key:"fromJson",value:function(json){return new ErrorAtom(json.command)}}]),ErrorAtom}(Atom),GroupAtom=function(_Atom8){_inherits(GroupAtom,_Atom8);var _super9=_createSuper(GroupAtom);function GroupAtom(arg,mode,style){var _this8;return _classCallCheck(this,GroupAtom),(_this8=_super9.call(this,{type:"group",mode:mode,style:style})).body=arg,_this8.boxType=arg.length>1?"ord":"ignore",_this8.skipBoundary=!0,_this8.displayContainsHighlight=!1,arg&&1===arg.length&&","===arg[0].command&&(_this8.captureSelection=!0),_this8}return _createClass(GroupAtom,[{key:"render",value:function(context){var box=Atom.createBox(context,this.body,{type:this.boxType});return box?(this.caret&&(box.caret=this.caret),this.bind(context,box)):null}},{key:"_serialize",value:function(options){if(!options.expandMacro&&!options.skipStyles&&"string"==typeof this.verbatimLatex)return this.verbatimLatex;var def=getDefinition(this.command,this.mode);return(null==def?void 0:def.serialize)?def.serialize(this,options):"{".concat(this.bodyToLatex(options),"}")}}],[{key:"fromJson",value:function(json){return new GroupAtom(json.body,json.mode,json.style)}}]),GroupAtom}(Atom),LeftRightAtom=function(_Atom9){_inherits(LeftRightAtom,_Atom9);var _super10=_createSuper(LeftRightAtom);function LeftRightAtom(variant,body,options){var _this9;return _classCallCheck(this,LeftRightAtom),(_this9=_super10.call(this,{type:"leftright",style:options.style,displayContainsHighlight:!0})).variant=variant,_this9.body=body,_this9.leftDelim=options.leftDelim,_this9.rightDelim=options.rightDelim,_this9}return _createClass(LeftRightAtom,[{key:"toJson",value:function(){var result=_get(_getPrototypeOf(LeftRightAtom.prototype),"toJson",this).call(this);return this.variant&&(result.variant=this.variant),this.leftDelim&&(result.leftDelim=this.leftDelim),this.rightDelim&&(result.rightDelim=this.rightDelim),result}},{key:"_serialize",value:function(options){var _a3,_b3,rightDelim=this.matchingRightDelim();return"left...right"===this.variant?joinLatex(["\\left",null!=(_a3=this.leftDelim)?_a3:".",this.bodyToLatex(options),"\\right",rightDelim]):"mleft...mright"===this.variant?joinLatex(["\\mleft",null!=(_b3=this.leftDelim)?_b3:".",this.bodyToLatex(options),"\\mright",rightDelim]):joinLatex([this.leftDelim&&"."!==this.leftDelim?this.leftDelim:"",this.bodyToLatex(options),rightDelim])}},{key:"matchingRightDelim",value:function(){var _a3,_b3;if(this.rightDelim&&"?"!==this.rightDelim)return this.rightDelim;var leftDelim=null!=(_a3=this.leftDelim)?_a3:".";return null!=(_b3=RIGHT_DELIM[leftDelim])?_b3:leftDelim}},{key:"render",value:function(parentContext){var _a3,_b3,_c2,_d2,_e,context=new Context({parent:parentContext},this.style);console.assert(void 0!==this.body);var delimContext=new Context({parent:parentContext,mathstyle:"textstyle"},this.style),inner=null!=(_a3=Atom.createBox(context,this.body,{type:"inner"}))?_a3:new Box(null,{type:"inner"}),innerHeight=inner.height/delimContext.scalingFactor,innerDepth=inner.depth/delimContext.scalingFactor,boxes=[];this.leftDelim&&boxes.push(this.bind(delimContext,makeLeftRightDelim("open",this.leftDelim,innerHeight,innerDepth,delimContext,{isSelected:this.isSelected,classes:"ML__open"+(this.containsCaret?" ML__contains-caret":""),mode:this.mode,style:this.style})));var closeDelimStyle=null!=(_c2=null==(_b3=this.body)?void 0:_b3[this.body.length-1].style)?_c2:{};if(inner&&(upgradeMiddle(inner.children,this,context,innerHeight,innerDepth),boxes.push(inner)),this.rightDelim){var classes=this.containsCaret?" ML__contains-caret":"",delim=this.rightDelim;"?"===delim&&(context.smartFence?(delim=this.matchingRightDelim(),classes+=" ML__smart-fence__close"):delim="."),boxes.push(this.bind(delimContext,makeLeftRightDelim("close",delim,innerHeight,innerDepth,delimContext,{isSelected:this.isSelected,classes:classes+" ML__close",mode:this.mode,style:closeDelimStyle})))}var tightSpacing=null!=(_e="mleft...mright"===this.variant||(null==(_d2=this.leftSibling)?void 0:_d2.isFunction))&&_e,result=new Box(boxes,{type:tightSpacing?"close":"inner",classes:"left-right"});return this.caret&&(result.caret=this.caret),this.bind(context,result.wrap(context))}}],[{key:"fromJson",value:function(json){var _a3;return new LeftRightAtom(null!=(_a3=json.variant)?_a3:"",json.body,json)}}]),LeftRightAtom}(Atom);function upgradeMiddle(boxes,atom,context,height,depth){if(boxes)for(var i=0;i<boxes.length;i++){var child=boxes[i];"middle"===child.type?(boxes[i]=atom.bind(context,makeLeftRightDelim("inner",child.value,height,depth,context,{isSelected:atom.isSelected})),boxes[i].caret=child.caret,boxes[i].isSelected=child.isSelected,boxes[i].cssId=child.cssId,boxes[i].htmlData=child.htmlData,boxes[i].htmlStyle=child.htmlStyle,boxes[i].attributes=child.attributes,boxes[i].cssProperties=child.cssProperties):child.children&&upgradeMiddle(child.children,atom,context,height,depth)}}var MacroAtom=function(_Atom10){_inherits(MacroAtom,_Atom10);var _super11=_createSuper(MacroAtom);function MacroAtom(macro,options){var _this10,_a3;return _classCallCheck(this,MacroAtom),(_this10=_super11.call(this,{type:"macro",command:macro,style:options.style})).body=options.body,void 0===options.captureSelection?options.args?_this10.captureSelection=!1:_this10.captureSelection=!0:_this10.captureSelection=options.captureSelection,_this10.macroArgs=options.args,_this10.expand=null!=(_a3=options.expand)&&_a3,_this10}return _createClass(MacroAtom,[{key:"toJson",value:function(){var options=_get(_getPrototypeOf(MacroAtom.prototype),"toJson",this).call(this);return this.expand&&(options.expand=!0),void 0!==this.captureSelection&&(options.captureSelection=this.captureSelection),this.macroArgs&&(options.args=this.macroArgs),options}},{key:"_serialize",value:function(options){var _a3;return options.expandMacro&&this.expand?this.bodyToLatex(options):this.command+(null!=(_a3=this.macroArgs)?_a3:"")}},{key:"render",value:function(context){var result=Atom.createBox(context,this.body);return result?(this.caret&&(result.caret=this.caret),this.bind(context,result)):null}}],[{key:"fromJson",value:function(json){return new MacroAtom(json.command,json)}}]),MacroAtom}(Atom),MacroArgumentAtom=function(_Atom11){_inherits(MacroArgumentAtom,_Atom11);var _super12=_createSuper(MacroArgumentAtom);function MacroArgumentAtom(){return _classCallCheck(this,MacroArgumentAtom),_super12.call(this,{type:"macro-argument"})}return _createClass(MacroArgumentAtom,[{key:"toJson",value:function(){return _get(_getPrototypeOf(MacroArgumentAtom.prototype),"toJson",this).call(this)}},{key:"_serialize",value:function(options){return""}},{key:"render",value:function(context){return null}}],[{key:"fromJson",value:function(json){return new MacroArgumentAtom}}]),MacroArgumentAtom}(Atom),PromptAtom=function(_Atom12){_inherits(PromptAtom,_Atom12);var _super13=_createSuper(PromptAtom);function PromptAtom(placeholderId,correctness){var _this11,_a3,locked=arguments.length>2&&void 0!==arguments[2]&&arguments[2],body=arguments.length>3?arguments[3]:void 0,options=arguments.length>4?arguments[4]:void 0;return _classCallCheck(this,PromptAtom),(_this11=_super13.call(this,{type:"prompt",mode:null!=(_a3=null==options?void 0:options.mode)?_a3:"math",style:null==options?void 0:options.style,command:"\\placeholder"})).body=body,_this11.correctness=correctness,_this11.placeholderId=placeholderId,_this11.locked=locked,_this11.captureSelection=_this11.locked,_this11}return _createClass(PromptAtom,[{key:"toJson",value:function(){var result=_get(_getPrototypeOf(PromptAtom.prototype),"toJson",this).call(this);return this.placeholderId&&(result.placeholderId=this.placeholderId),this.body||delete result.body,this.body&&(result.body=this.body.filter((function(x){return"first"!==x.type})).map((function(x){return x.toJson()}))),this.correctness&&(result.correctness=this.correctness),result.locked=this.locked,result}},{key:"render",value:function(parentContext){var context=new Context({parent:parentContext}),fboxsep=context.getRegisterAsEm("fboxsep"),padding2=fboxsep,content=Atom.createBox(parentContext,this.body);if(!content)return null;content.height||(content.height=.5),content.setStyle("vertical-align",-content.height,"em"),"correct"===this.correctness?content.setStyle("color","var(--correct-color, var(--ML__correct-color))"):"incorrect"===this.correctness&&content.setStyle("color","var(--incorrect-color, var(--ML__incorrect-color))");var base=new Box(content,{type:"ord"}),boxClasses="ML__prompt ";this.locked?boxClasses+=" ML__lockedPromptBox ":boxClasses+=" ML__editablePromptBox ","correct"===this.correctness?boxClasses+=" ML__correctPromptBox ":"incorrect"===this.correctness&&(boxClasses+=" ML__incorrectPromptBox "),this.containsCaret&&(boxClasses+=" ML__focusedPromptBox ");var box=new Box(null,{classes:boxClasses});box.height=base.height+padding2,box.depth=base.depth+padding2,box.setStyle("box-sizing","border-box"),box.setStyle("position","absolute"),box.setStyle("height",base.height+base.depth+2*padding2,"em"),0===padding2?box.setStyle("width","100%"):(box.setStyle("width","calc(100% + ".concat(2*padding2,"em)")),box.setStyle("top",fboxsep,"em"),box.setStyle("left",-padding2,"em")),this.body&&1!==this.body.length||(box.setStyle("width","calc(100% + ".concat(3*padding2,"em)")),box.setStyle("left",-1.5*padding2,"em"));var svg="";"incorrect"===this.correctness&&(svg+='<line x1="3%"  y1="97%" x2="97%" y2="3%" stroke-width="0.5" stroke="var(--incorrect-color, var(--ML__incorrect-color))" stroke-linecap="round" />'),svg&&addSVGOverlay(box,svg,""),base.setStyle("display","inline-block"),base.setStyle("height",content.height+content.depth,"em"),base.setStyle("vertical-align",-padding2,"em");var result=new Box([box,base],{classes:"ML__prompt-atom"});return result.setStyle("position","relative"),result.setStyle("display","inline-block"),result.setStyle("line-height",0),result.height=base.height+padding2+.2,result.depth=base.depth+padding2,result.left=padding2,result.right=padding2,result.setStyle("height",base.height+padding2,"em"),result.setStyle("top",base.depth-base.height,"em"),result.setStyle("vertical-align",base.depth+padding2,"em"),result.setStyle("margin-left",.5,"em"),result.setStyle("margin-right",.5,"em"),this.caret&&(result.caret=this.caret),this.bind(context,this.attachSupsub(parentContext,{base:result}))}},{key:"_serialize",value:function(options){var _a3,value=null!=(_a3=this.bodyToLatex(options))?_a3:"",command="\\placeholder";return this.placeholderId&&(command+="[".concat(this.placeholderId,"]")),"correct"===this.correctness?command+="[correct]":"incorrect"===this.correctness&&(command+="[incorrect]"),this.locked&&(command+="[locked]"),latexCommand(command,value)}}],[{key:"fromJson",value:function(json){return new PromptAtom(json.placeholderId,json.correctness,json.locked,json.body,json)}}]),PromptAtom}(Atom),SubsupAtom=function(_Atom13){_inherits(SubsupAtom,_Atom13);var _super14=_createSuper(SubsupAtom);function SubsupAtom(options){var _this12;return _classCallCheck(this,SubsupAtom),(_this12=_super14.call(this,{type:"subsup",style:null==options?void 0:options.style})).subsupPlacement="auto",_this12}return _createClass(SubsupAtom,[{key:"render",value:function(context){var _a3,phantomCtx=new Context({parent:context,isPhantom:!0}),leftSibling=this.leftSibling,base=null!=(_a3=leftSibling.render(phantomCtx))?_a3:new Box(null),phantom=new Box(null,{height:base.height,depth:base.depth});return this.attachSupsub(context,{base:phantom,isCharacterBox:leftSibling.isCharacterBox(),type:"ignore"})}},{key:"_serialize",value:function(options){return this.supsubToLatex(options)}}],[{key:"fromJson",value:function(json){var _step78,result=new SubsupAtom(json),_iterator78=_createForOfIteratorHelper(NAMED_BRANCHES);try{for(_iterator78.s();!(_step78=_iterator78.n()).done;){var branch=_step78.value;json[branch]&&result.setChildren(json[branch],branch)}}catch(err){_iterator78.e(err)}finally{_iterator78.f()}return result}}]),SubsupAtom}(Atom);function isLiteral(token){return!!token&&!/^(<$$>|<$>|<space>|<{>|<}>|#[0-9\?]|\\.+)$/.test(token)}var Parser=function(){function Parser(tokens,context,options){var _a3,_b3,_c2,_d2;_classCallCheck(this,Parser),this.errors=[],this.index=0,this.endCount=0,null!=options||(options={}),this.tokens=tokens,this.context=context instanceof Context&&!(null==options?void 0:options.parseMode)&&!options.mathstyle?context:new Context({from:context,mathstyle:options.mathstyle},options.style),this.args=null!=(_a3=options.args)?_a3:void 0,this.smartFence=this.context.smartFence,this.parsingContext={parent:void 0,mathlist:[],style:null!=(_b3=options.style)?_b3:{},parseMode:null!=(_c2=options.parseMode)?_c2:"math",mathstyle:null!=(_d2=options.mathstyle)?_d2:"displaystyle",tabular:!1}}return _createClass(Parser,[{key:"beginContext",value:function(options){var _a3,_b3,_c2,current=this.parsingContext,newContext={parent:current,mathlist:[],style:__spreadValues({},current.style),parseMode:null!=(_a3=null==options?void 0:options.mode)?_a3:current.parseMode,mathstyle:null!=(_b3=null==options?void 0:options.mathstyle)?_b3:current.mathstyle,tabular:null!=(_c2=null==options?void 0:options.tabular)&&_c2};this.parsingContext=newContext}},{key:"endContext",value:function(){this.parsingContext=this.parsingContext.parent}},{key:"onError",value:function(err){this.errors.push(__spreadValues({before:tokensToString(this.tokens.slice(this.index,this.index+10)),after:tokensToString(this.tokens.slice(Math.max(0,this.index-10),this.index))},err))}},{key:"mathlist",get:function(){return this.parsingContext.mathlist},set:function(value){this.parsingContext.mathlist=value}},{key:"parseMode",get:function(){return this.parsingContext.parseMode},set:function(value){this.parsingContext.parseMode=value}},{key:"tabularMode",get:function(){return this.parsingContext.tabular}},{key:"style",get:function(){for(var context=this.parsingContext;context;){if(context.style)return __spreadValues({},context.style);context=context.parent}return{}},set:function(value){this.parsingContext.style=value}},{key:"end",value:function(){return this.endCount++,this.index>=this.tokens.length||this.endCount>1e3}},{key:"next",value:function(){this.index+=1}},{key:"get",value:function(){return this.endCount=0,this.index<this.tokens.length?this.tokens[this.index++]:""}},{key:"peek",value:function(){return this.tokens[this.index]}},{key:"match",value:function(input){return this.tokens[this.index]===input&&(this.index++,!0)}},{key:"lastSubsupAtom",value:function(){var atom;if(this.mathlist.length>0){if("subsup"===(atom=this.mathlist[this.mathlist.length-1]).type)return atom;if(void 0!==atom.subsupPlacement)return atom}return atom=new SubsupAtom({style:this.style}),this.mathlist.push(atom),atom}},{key:"hasPattern",value:function(pattern){return pattern.test(this.tokens[this.index])}},{key:"hasInfixCommand",value:function(){var _a3,index=this.index;if(index<this.tokens.length&&this.tokens[index].startsWith("\\")){var info=getDefinition(this.tokens[index],this.parseMode);return!(!info||"symbol"===info.definitionType)&&!(info.ifMode&&!info.ifMode.includes(this.parseMode))&&null!=(_a3=info.infix)&&_a3}return!1}},{key:"matchColumnSeparator",value:function(){return!!this.tabularMode&&"&"===this.peek()&&(this.index++,!0)}},{key:"matchRowSeparator",value:function(){if(!this.tabularMode)return!1;var peek=this.peek();return("\\\\"===peek||"\\cr"===peek||"\\tabularnewline"===peek)&&(this.index++,!0)}},{key:"placeholder",value:function(){var _a3,placeHolderArg=null==(_a3=this.args)?void 0:_a3.call(this,"?");return placeHolderArg?parseLatex(placeHolderArg,{parseMode:this.parseMode,mathstyle:"textstyle"}):[new PlaceholderAtom({mode:this.parseMode,style:this.style})]}},{key:"skipWhitespace",value:function(){for(;this.match("<space>"););}},{key:"skipUntilToken",value:function(input){for(var token=this.tokens[this.index];token&&token!==input;)token=this.tokens[++this.index];token===input&&this.index++}},{key:"skipFiller",value:function(){for(;this.match("\\relax")||this.match("<space>"););}},{key:"matchKeyword",value:function(keyword){for(var savedIndex=this.index,done=this.end(),value="";!done;){var token=this.get();isLiteral(token)?(value+=token,done=this.end()||value.length>=keyword.length):done=!0}var hasKeyword=keyword.toUpperCase()===value.toUpperCase();return hasKeyword||(this.index=savedIndex),hasKeyword}},{key:"scanString",value:function(){for(var result="";!this.end();){var token=this.peek();if("]"===token)return result;if("<space>"===token)result+=" ";else if(token.startsWith("\\"))this.onError({code:"unexpected-command-in-string"}),result+=token.substring(1);else{if(!isLiteral(token))return result;result+=token}this.next()}return result}},{key:"scanBalancedString",value:function(){for(var result="",done=this.end(),level=1;!done;){var token=this.get();"<space>"===token?result+=" ":"<{>"===token?(result+="{",level+=1):"<}>"===token?(level-=1)>0?result+="}":this.index-=1:result+="<$>"===token?"$":"<$$>"===token?"$$":token,done=0===level||this.end()}return result}},{key:"scanLiteralGroup",value:function(){var _a3;if(!this.match("<{>"))return"";for(var result="",level=1;level>0&&!this.end();){var token=this.get();"<}>"===token?(level-=1)>0&&(result+="}"):"<{>"===token?(level+=1,result+="{"):(/\\[a-zA-Z]+$/.test(result)&&/^[a-zA-Z]/.test(token)&&(result+=" "),result+=null!=(_a3={"<space>":" ","<$$>":"$$","<$>":"$"}[token])?_a3:token)}return result}},{key:"scanNumber",value:function(){for(var _a3,_b3,isInteger=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],negative=!1,token=this.peek();"<space>"===token||"+"===token||"-"===token;)this.get(),"-"===token&&(negative=!negative),token=this.peek();isInteger=Boolean(isInteger);var radix=10,digits=/\d/;if(this.match("'"))radix=8,digits=/[0-7]/,isInteger=!0;else if(this.match('"'))radix=16,digits=/[\dA-F]/,isInteger=!0;else if(this.match("x"))radix=16,digits=/[\dA-Fa-f]/,isInteger=!0;else if(this.match("`"))return(token=this.get())?2===token.length&&token.startsWith("\\")?{number:(negative?-1:1)*(null!=(_a3=token.codePointAt(1))?_a3:0),base:"alpha"}:{number:(negative?-1:1)*(null!=(_b3=token.codePointAt(0))?_b3:0),base:"alpha"}:null;for(var value="";this.hasPattern(digits);)value+=this.get();if(!isInteger&&(this.match(".")||this.match(",")))for(value+=".";this.hasPattern(digits);)value+=this.get();var result=isInteger?Number.parseInt(value,radix):Number.parseFloat(value);return Number.isNaN(result)?null:{number:negative?-result:result,base:16===radix?"hexadecimal":8===radix?"octal":"decimal"}}},{key:"scanRegister",value:function(){var _a3,index=this.index,number=this.scanNumber(!1);if(this.skipWhitespace(),this.match("\\relax"))return number;var negative=!1;if(null===number)for(;;){var s=this.peek();if("-"===s)negative=!negative;else if("+"!==s)break;this.next(),this.skipWhitespace()}if(this.match("\\global")){this.skipWhitespace();var register4=this.get();return register4.startsWith("\\")?number?{register:register4,global:!0,factor:(negative?-1:1)*number.number}:negative?{register:register4,global:!0,factor:-1}:{register:register4,global:!0}:(this.index=index,null)}var register3=this.get();return(null==register3?void 0:register3.startsWith("\\"))?(register3=register3.substring(1),this.context.registers[register3]?negative&&null===number?{register:register3}:{register:register3,factor:(negative?-1:1)*(null!=(_a3=null==number?void 0:number.number)?_a3:1)}:(this.index=index,null)):(this.index=index,null)}},{key:"scanValue",value:function(){var register3=this.scanRegister();if(register3)return register3;var index=this.index,glue=this.scanGlueOrDimen();if(glue&&("unit"in glue||"glue"in glue&&"unit"in glue.glue))return glue;this.index=index;var number=this.scanNumber();if(number)return number;if(this.end()||!isLiteral(this.peek()))return null;var s=this.scanString();return s.length>0?{string:s}:null}},{key:"scanDimen",value:function(){var value=this.scanNumber(!1);if(null===value)return null;var unit,dimension=value.number;return this.skipWhitespace(),this.matchKeyword("true"),this.skipWhitespace(),this.matchKeyword("pt")?unit="pt":this.matchKeyword("mm")?unit="mm":this.matchKeyword("cm")?unit="cm":this.matchKeyword("ex")?unit="ex":this.matchKeyword("px")?unit="px":this.matchKeyword("em")?unit="em":this.matchKeyword("bp")?unit="bp":this.matchKeyword("dd")?unit="dd":this.matchKeyword("pc")?unit="pc":this.matchKeyword("in")?unit="in":this.matchKeyword("mu")&&(unit="mu"),unit?{dimension:dimension,unit:unit}:{dimension:dimension}}},{key:"scanGlueOrDimen",value:function(){var dimen=this.scanDimen();if(null===dimen)return null;if(this.skipWhitespace(),this.match("\\relax"))return dimen;var result={glue:dimen};if(this.matchKeyword("plus")){var grow=this.scanDimen();if(!grow)return result;result.grow=grow}if(this.skipWhitespace(),this.match("\\relax"))return result;if(this.skipWhitespace(),this.matchKeyword("minus")){var shrink=this.scanDimen();if(!shrink)return result;result.shrink=shrink}return result.grow||result.shrink?result:dimen}},{key:"scanColspec",value:function(){this.skipWhitespace();for(var result=[];!this.end()&&"<}>"!==this.peek()&&"]"!==this.peek();){var literal=this.get();"c"===literal||"r"===literal||"l"===literal?result.push({align:literal}):"|"===literal?result.push({separator:"solid"}):":"===literal?result.push({separator:"dashed"}):"@"===literal&&(this.match("<{>")&&(this.beginContext({mode:"math"}),result.push({gap:this.scan((function(token){return"<}>"===token}))}),this.endContext()),this.match("<}>")||this.onError({code:"unbalanced-braces"}))}return result}},{key:"scanModeSet",value:function(){var mathstyle=void 0;if(this.match("\\(")&&(mathstyle="textstyle"),!mathstyle&&this.match("\\[")&&(mathstyle="displaystyle"),!mathstyle)return null;this.beginContext({mode:"math",mathstyle:mathstyle});var result=this.scan((function(token){return token===("displaystyle"===mathstyle?"\\]":"\\)")}));return this.match("displaystyle"===mathstyle?"\\]":"\\)")||this.onError({code:"unbalanced-mode-shift"}),this.endContext(),result}},{key:"scanModeShift",value:function(){var final="";if(this.match("<$>")&&(final="<$>"),!final&&this.match("<$$>")&&(final="<$$>"),!final)return null;this.beginContext({mode:"math",mathstyle:"textstyle"});var result=this.scan((function(token){return token===final}));return this.match(final)||this.onError({code:"unbalanced-mode-shift"}),this.endContext(),result}},{key:"scanEnvironment",value:function(){if(!this.match("\\begin"))return null;var envName=this.scanArgument("string");if(!envName)return null;var _a3,def=null!=(_a3=ENVIRONMENTS[envName])?_a3:null;if(!def)return this.onError({code:"unknown-environment",arg:envName}),null;var args=[];if(def.params){var _step79,_iterator79=_createForOfIteratorHelper(def.params);try{for(_iterator79.s();!(_step79=_iterator79.n()).done;){var parameter=_step79.value;if(parameter.isOptional)args.push(this.scanOptionalArgument(parameter.type));else{var arg=this.scanArgument(parameter.type);arg||this.onError({code:"missing-argument",arg:envName}),args.push(arg)}}}catch(err){_iterator79.e(err)}finally{_iterator79.f()}}this.beginContext({tabular:def.tabular});var array=[],rowGaps=[],row=[],done=!1;do{if(this.end()&&(this.onError({code:"unbalanced-environment",arg:envName}),done=!0),!done&&this.match("\\end")&&(this.scanArgument("string")!==envName&&this.onError({code:"unbalanced-environment",arg:envName}),done=!0),!done)if(this.matchColumnSeparator())row.push(this.mathlist),this.mathlist=[];else if(this.matchRowSeparator()){row.push(this.mathlist),this.mathlist=[];var gap=null;this.skipWhitespace(),this.match("[")&&(gap=this.scanDimen(),this.skipWhitespace(),this.match("]")),rowGaps.push(null!=gap?gap:{dimension:0}),array.push(row),row=[]}else{var _this$mathlist;(_this$mathlist=this.mathlist).push.apply(_this$mathlist,_toConsumableArray(this.scan((function(token){return["<}>","&","\\end","\\cr","\\\\","\\tabularnewline"].includes(token)}))))}}while(!done);return row.push(this.mathlist),row.length>0&&array.push(row),this.endContext(),def.createAtom(envName,array,rowGaps,args)}},{key:"scanExpression",value:function(){var savedList=this.mathlist;if(this.mathlist=[],this.parseExpression()){var result=this.mathlist;return this.mathlist=savedList,result}return this.mathlist=savedList,null}},{key:"scan",value:function(done){this.beginContext(),done||(done=function(token){return"<}>"===token});for(var result,infix="",infixInfo=null,infixArgs=[],prefix=null;!this.end()&&!done(this.peek());)this.hasInfixCommand()&&!infix?((infixInfo=getDefinition(infix=this.get(),"math"))&&(infixArgs=this.scanArguments(infixInfo)[1]),prefix=this.mathlist,this.mathlist=[]):this.parseExpression();return infix?(console.assert(Boolean(infixInfo)),infixArgs.unshift(this.mathlist),prefix&&infixArgs.unshift(prefix),result=[infixInfo.createAtom({command:infix,args:infixArgs,style:this.style,mode:this.parseMode})]):result=this.mathlist,this.endContext(),result}},{key:"scanGroup",value:function(){var initialIndex=this.index;if(!this.match("<{>"))return null;var body=this.scan((function(token){return"<}>"===token}));this.match("<}>")||this.onError({code:"unbalanced-braces"});var result=new GroupAtom(body,this.parseMode,this.style);return result.verbatimLatex=tokensToString(this.tokens.slice(initialIndex,this.index)),result}},{key:"scanSmartFence",value:function(){if(this.skipWhitespace(),!this.match("("))return null;this.beginContext();for(var nestLevel=1;!this.end()&&0!==nestLevel;)this.match("(")&&(nestLevel+=1),this.match(")")&&(nestLevel-=1),0!==nestLevel&&this.parseExpression();0===nestLevel&&this.match(")");var result=new LeftRightAtom("",this.mathlist,{leftDelim:"(",rightDelim:0===nestLevel?")":"?"});return this.endContext(),result}},{key:"scanDelim",value:function(){this.skipWhitespace();var token=this.peek();if(!token)return this.onError({code:"unexpected-end-of-string"}),null;if(!isLiteral(token)&&!token.startsWith("\\"))return null;this.next();var info=getDefinition(token,"math");return info?"function"===info.definitionType&&info.ifMode&&!info.ifMode.includes(this.parseMode)?(this.onError({code:"unexpected-delimiter",arg:token}),null):"symbol"!==info.definitionType||"mopen"!==info.type&&"mclose"!==info.type?/^(\.|\?|\||<|>|\\vert|\\Vert|\\\||\\surd|\\uparrow|\\downarrow|\\Uparrow|\\Downarrow|\\updownarrow|\\Updownarrow|\\mid|\\mvert|\\mVert)$/.test(token)?token:(this.onError({code:"unexpected-delimiter",arg:token}),null):token:(this.onError({code:"unknown-command",arg:token}),null)}},{key:"scanLeftRight",value:function(){var _a3;if(this.match("\\right"))return this.onError({code:"unbalanced-braces"}),new ErrorAtom("\\right");if(this.match("\\mright"))return this.onError({code:"unbalanced-braces"}),new ErrorAtom("\\mright");var close="\\right";if(!this.match("\\left")){if(!this.match("\\mleft"))return null;close="\\mright"}var leftDelim=this.scanDelim();if(!leftDelim)return this.onError({code:"unexpected-delimiter"}),new ErrorAtom("\\right"===close?"\\left":"\\mleft");for(this.beginContext();!this.end()&&!this.match(close);)this.parseExpression();var body=this.mathlist;this.endContext();var rightDelim=null!=(_a3=this.scanDelim())?_a3:".";return new LeftRightAtom("\\right"===close?"left...right":"mleft...mright",body,{leftDelim:leftDelim,rightDelim:rightDelim,style:this.style})}},{key:"parseSupSub",value:function(){if("math"!==this.parseMode)return!1;var token=this.peek();if("^"!==token&&"_"!==token&&"'"!==token)return!1;for(var target=this.lastSubsupAtom();"^"===token||"_"===token||"'"===token;)this.match("'")?this.match("'")?target.addChild(new Atom({type:"mord",command:"\\doubleprime",mode:"math",value:"′′"}),"superscript"):target.addChild(new Atom({type:"mord",command:"\\prime",mode:"math",value:"′"}),"superscript"):(this.match("^")||this.match("_"))&&target.addChildren(argAtoms(this.scanArgument("expression")),"_"===token?"subscript":"superscript"),token=this.peek();return!0}},{key:"parseLimits",value:function(){if("math"!==this.parseMode)return!1;var isLimits=this.match("\\limits"),isNoLimits=!isLimits&&this.match("\\nolimits"),isDisplayLimits=!isNoLimits&&!isLimits&&this.match("\\displaylimits");if(!isLimits&&!isNoLimits&&!isDisplayLimits)return!1;var opAtom=this.mathlist.length>0?this.mathlist[this.mathlist.length-1]:null;return null!==opAtom&&"mop"===opAtom.type&&(opAtom.explicitSubsupPlacement=!0,isLimits&&(opAtom.subsupPlacement="over-under"),isNoLimits&&(opAtom.subsupPlacement="adjacent"),isDisplayLimits&&(opAtom.subsupPlacement="auto"),!0)}},{key:"scanArguments",value:function(info){if(!(null==info?void 0:info.params))return[void 0,[]];for(var deferredArg=void 0,args=[],i=info.infix?2:0;i<info.params.length;){var parameter=info.params[i];"rest"===parameter.type?args.push(this.scan((function(token){return["<}>","&","\\end","\\cr","\\\\","\\tabularnewline"].includes(token)}))):parameter.isOptional?args.push(this.scanOptionalArgument(parameter.type)):parameter.type.endsWith("*")?deferredArg=parameter.type.slice(0,-1):args.push(this.scanArgument(parameter.type)),i+=1}return[deferredArg,args]}},{key:"scanSymbolOrLiteral",value:function(){var result,token=this.peek();if(!token)return null;if(this.next(),isLiteral(token)){var result2=Mode.createAtom(this.parseMode,token,__spreadValues({},this.style));return result2?[result2]:null}if(result=this.scanMacro(token))return[result];if(token.startsWith("\\")){var info=getDefinition(token,this.parseMode);if(!info)return this.onError({code:"unknown-command",arg:token}),[new ErrorAtom(token)];if("symbol"===info.definitionType){var style=__spreadValues({},this.style);info.variant&&(style.variant=info.variant),result=new Atom({type:info.type,command:token,style:style,value:String.fromCodePoint(info.codepoint),mode:this.parseMode,verbatimLatex:token})}else{if(info.applyMode||info.applyStyle||info.infix)return this.onError({code:"invalid-command",arg:token}),[new ErrorAtom(token)];info.createAtom&&(result=info.createAtom({command:token,args:[],style:this.style,mode:this.parseMode}))}}return result?[result]:null}},{key:"scanArgument",value:function(type){var _a3;this.skipFiller();var mode=this.parseMode;if("auto"===type&&(type=mode),!this.match("<{>")){if("string"===type)return this.scanString();if("value"===type)return this.scanValue();if("delim"===type)return null!=(_a3=this.scanDelim())?_a3:".";if("expression"===type)return this.scanExpression();if("math"===type){type!==mode&&this.beginContext({mode:"math"});var result2=this.scanSymbolOrLiteral();return type!==mode&&this.endContext(),result2}if("text"===type){type!==mode&&this.beginContext({mode:"text"});var _result2=this.scanSymbolOrLiteral();return type!==mode&&this.endContext(),_result2}return"balanced-string"===type||console.assert(!1),null}if("text"===type){this.beginContext({mode:"text"});do{var _this$mathlist2;(_this$mathlist2=this.mathlist).push.apply(_this$mathlist2,_toConsumableArray(this.scan()))}while(!this.match("<}>")&&!this.end());var atoms=this.mathlist;return this.endContext(),{group:atoms}}if("math"===type){this.beginContext({mode:"math"});do{var _this$mathlist3;(_this$mathlist3=this.mathlist).push.apply(_this$mathlist3,_toConsumableArray(this.scan()))}while(!this.match("<}>")&&!this.end());var _atoms=this.mathlist;return this.endContext(),{group:_atoms}}var result=null;if("expression"===type){this.beginContext({mode:"math"});do{var _this$mathlist4;(_this$mathlist4=this.mathlist).push.apply(_this$mathlist4,_toConsumableArray(this.scan()))}while(!this.match("<}>")&&!this.end());var _atoms2=this.mathlist;return this.endContext(),{group:_atoms2}}return"string"===type?result=this.scanString():"balanced-string"===type?result=this.scanBalancedString():"colspec"===type?result=this.scanColspec():"value"===type&&(result=this.scanValue()),this.skipUntilToken("<}>"),result}},{key:"scanOptionalArgument",value:function(argType){if(argType="auto"===argType?this.parseMode:argType,this.skipFiller(),!this.match("["))return null;for(var result=null;!this.end()&&!this.match("]");)if("string"===argType)result=this.scanString();else if("value"===argType)result=this.scanValue();else if("colspec"===argType)result=this.scanColspec();else if("bbox"===argType){var _step80,bboxParameter={},_iterator80=_createForOfIteratorHelper(this.scanString().toLowerCase().trim().split(/,(?![^(]*\)(?:(?:[^(]*\)){2})*[^"]*$)/));try{for(_iterator80.s();!(_step80=_iterator80.n()).done;){var element=_step80.value,m=element.match(/^\s*([\d.]+)\s*([a-z]{2})/);if(m)bboxParameter.padding={dimension:parseInt(m[1]),unit:m[2]};else{var m2=element.match(/^\s*border\s*:\s*(.*)/);m2?bboxParameter.border=m2[1]:bboxParameter.backgroundcolor={string:element}}}}catch(err){_iterator80.e(err)}finally{_iterator80.f()}result=bboxParameter}else"math"===argType&&(this.beginContext({mode:"math"}),result=this.mathlist.concat(this.scan((function(token){return"]"===token}))),this.endContext());return result}},{key:"scanSymbolOrCommand",value:function(command){var _a3,_b3,_this13=this;if("\\placeholder"===command){var correctness,id=this.scanOptionalArgument("string"),defaultValue=this.scanOptionalArgument("math"),defaultAsString=Atom.serialize(defaultValue,{defaultMode:"math"}),defaultAtoms=[];correctness||"correct"!==defaultAsString?correctness||"incorrect"!==defaultAsString?""!==defaultAsString&&(defaultAtoms=defaultValue):correctness="incorrect":correctness="correct";var body,locked="locked"===this.scanOptionalArgument("string"),value=this.scanArgument("auto");return body=value&&Array.isArray(value)&&value.length>0?value:value&&"object"===_typeof(value)&&"group"in value?value.group:defaultAtoms,id?[new PromptAtom(id,correctness,locked,null!=body?body:defaultAtoms,{mode:this.parseMode,style:this.style})]:[new PlaceholderAtom({mode:this.parseMode,style:this.style})]}var result=this.scanMacro(command);if(result)return[result];var info=getDefinition(command,this.parseMode);if(!info)return this.onError({code:"unknown-command",arg:command}),"text"===this.parseMode?_toConsumableArray(command).map((function(c){return new Atom({type:"text",value:c,mode:"text",style:_this13.style})})):[new ErrorAtom(command)];var initialIndex=this.index;if("symbol"===info.definitionType){var style=__spreadValues({},this.style);info.variant&&(style.variant=info.variant),result=new Atom({type:info.type,command:command,style:style,value:String.fromCodePoint(info.codepoint),mode:this.parseMode})}else{if(info.ifMode&&!info.ifMode.includes(this.parseMode))return[];var savedMode=this.parseMode;info.applyMode&&(this.parseMode=info.applyMode);var _this$scanArguments2=_slicedToArray(this.scanArguments(info),2),deferredArg=_this$scanArguments2[0],args=_this$scanArguments2[1];if(this.parseMode=savedMode,info.applyMode&&!info.applyStyle&&!info.createAtom)return argAtoms(args[0]);if(info.infix)return this.onError({code:"too-many-infix-commands",arg:command}),null;if("function"==typeof info.createAtom)result=info.createAtom({command:command,args:args,style:this.style,mode:this.parseMode}),deferredArg&&(result.body=argAtoms(this.scanArgument(deferredArg)));else if("function"==typeof info.applyStyle){var _style=__spreadValues(__spreadValues({},this.style),info.applyStyle(command,args,this.context)),savedMode2=this.parseMode;if(info.applyMode&&(this.parseMode=info.applyMode),deferredArg){var saveStyle=this.style;this.style=_style;var atoms=this.scanArgument(deferredArg);return this.style=saveStyle,this.parseMode=savedMode2,argAtoms(atoms)}this.style=_style}else result=new Atom({type:"mord",command:null!=(_a3=info.command)?_a3:command,style:__spreadValues({},this.style),value:command,mode:null!=(_b3=info.applyMode)?_b3:this.parseMode})}if(!result)return null;if(result instanceof Atom&&void 0===result.verbatimLatex&&!/^\\(llap|rlap|class|cssId|htmlData)$/.test(command)){var verbatim=joinLatex([command,tokensToString(this.tokens.slice(initialIndex,this.index))]);verbatim&&(result.verbatimLatex=verbatim)}if(null===result.verbatimLatex&&(result.verbatimLatex=void 0),result.isFunction&&this.smartFence){var smartFence=this.scanSmartFence();if(smartFence)return[result,smartFence]}return[result]}},{key:"scanSymbolCommandOrLiteral",value:function(){var token=this.get();if(!token)return null;if(isLiteral(token)){var result=Mode.createAtom(this.parseMode,token,__spreadValues({},this.style));if(!result)return null;if(result.isFunction&&this.smartFence){var smartFence=this.scanSmartFence();if(smartFence)return[result,smartFence]}return[result]}return token.startsWith("\\")?this.scanSymbolOrCommand(token):"<space>"===token?"text"===this.parseMode?[new TextAtom(" "," ",this.style)]:null:("<}>"===token?this.onError({latex:"",code:"unbalanced-braces"}):this.onError({latex:"",code:"unexpected-token",arg:token}),null)}},{key:"scanMacro",value:function(macro){var _a3,def=this.context.getMacro(macro);if(!def)return null;for(var initialIndex=this.index,argCount=def.args,_args={"?":null==(_a3=this.args)?void 0:_a3.call(this,"?")},i=1;i<=argCount;i++)_args[i]=this.scanLiteralGroup();return new MacroAtom(macro,{expand:def.expand,captureSelection:def.captureSelection,args:initialIndex===this.index?null:tokensToString(this.tokens.slice(initialIndex,this.index)),style:this.parsingContext.style,body:parseLatex(def.def,{context:this.context,parseMode:this.parseMode,args:function(arg){return _args[arg]},mathstyle:this.parsingContext.mathstyle,style:this.parsingContext.style})})}},{key:"parseExpression",value:function(){var _this$mathlist5,_a3,_b3,_c2,_d2,result=null!=(_d2=null!=(_c2=null!=(_b3=null!=(_a3=this.scanEnvironment())?_a3:this.scanModeShift())?_b3:this.scanModeSet())?_c2:this.scanGroup())?_d2:this.scanLeftRight();if(null===result){if(this.parseSupSub())return!0;if(this.parseLimits())return!0;result=this.scanSymbolCommandOrLiteral()}return!!result&&(Array.isArray(result)?(_this$mathlist5=this.mathlist).push.apply(_this$mathlist5,_toConsumableArray(result)):this.mathlist.push(result),!0)}}]),Parser}();function parseLatex(s,options){for(var _a3,_b3,_c2,_d2,args=null!=(_a3=null==options?void 0:options.args)?_a3:void 0,parser=new Parser(tokenize(s,args),null==options?void 0:options.context,{args:args,mathstyle:null!=(_b3=null==options?void 0:options.mathstyle)?_b3:"displaystyle",parseMode:null!=(_c2=null==options?void 0:options.parseMode)?_c2:"math",style:null!=(_d2=null==options?void 0:options.style)?_d2:{}}),atoms=[];!parser.end();)atoms.push.apply(atoms,_toConsumableArray(parser.scan((function(){return!1}))));return atoms}function validateLatex(s,options){for(var _a3,parser=new Parser(tokenize(s,null),null==options?void 0:options.context,{mathstyle:"displaystyle",parseMode:null!=(_a3=null==options?void 0:options.parseMode)?_a3:"math"});!parser.end();)parser.scan();return parser.errors}var ChemAtom=function(_Atom14){_inherits(ChemAtom,_Atom14);var _super15=_createSuper(ChemAtom);function ChemAtom(command,arg){var _this14;_classCallCheck(this,ChemAtom),_this14=_super15.call(this,"chem",{command:command,mode:"math"});var tex=texify.go(mhchemParser.go(arg,"\\pu"===command?"pu":"ce"),!1);return _this14.body=parseLatex(tex),_this14.verbatimLatex=command+"{"+arg+"}",_this14.arg=arg,_this14.captureSelection=!0,_this14}return _createClass(ChemAtom,[{key:"toJson",value:function(){return __spreadProps(__spreadValues({},_get(_getPrototypeOf(ChemAtom.prototype),"toJson",this).call(this)),{arg:this.arg})}},{key:"render",value:function(context){var box=Atom.createBox(context,this.body,{type:"inner"});return this.caret&&(box.caret=this.caret),this.bind(context,box)}},{key:"_serialize",value:function(_options){return this.verbatimLatex}}],[{key:"fromJson",value:function(json){return new ChemAtom(json.command,json.arg)}}]),ChemAtom}(Atom);defineFunction(["ce","pu"],"{chemformula:balanced-string}",{createAtom:function(options){var _a3;return new ChemAtom(options.command,null!=(_a3=options.args[0])?_a3:"")}});var mhchemParser={go:function(input,stateMachine){if(!input)return[];void 0===stateMachine&&(stateMachine="ce");var lastInput,state="0",buffer={parenthesisLevel:0};input=(input=(input=input.replace(/\n/g," ")).replace(/[\u2212\u2013\u2014\u2010]/g,"-")).replace(/[\u2026]/g,"...");for(var watchdog=10,output=[];;){lastInput!==input?(watchdog=10,lastInput=input):watchdog--;var machine=mhchemParser.stateMachines[stateMachine],t=machine.transitions[state]||machine.transitions["*"];iterateTransitions:for(var i=0;i<t.length;i++){var matches=mhchemParser.patterns.match_(t[i].pattern,input);if(matches){for(var task=t[i].task,iA=0;iA<task.action_.length;iA++){var o;if(machine.actions[task.action_[iA].type_])o=machine.actions[task.action_[iA].type_](buffer,matches.match_,task.action_[iA].option);else{if(!mhchemParser.actions[task.action_[iA].type_])throw["MhchemBugA","mhchem bug A. Please report. ("+task.action_[iA].type_+")"];o=mhchemParser.actions[task.action_[iA].type_](buffer,matches.match_,task.action_[iA].option)}mhchemParser.concatArray(output,o)}if(state=task.nextState||state,!(input.length>0))return output;if(task.revisit||(input=matches.remainder),!task.toContinue)break iterateTransitions}}if(watchdog<=0)throw["MhchemBugU","mhchem bug U. Please report."]}},concatArray:function(a,b){if(b)if("[object Array]"===Object.prototype.toString.call(b))for(var iB=0;iB<b.length;iB++)a.push(b[iB]);else a.push(b)},patterns:{patterns:{empty:/^$/,else:/^./,else2:/^./,space:/^\s/,"space A":/^\s(?=[A-Z\\$])/,space$:/^\s$/,"a-z":/^[a-z]/,x:/^x/,x$:/^x$/,i$:/^i$/,letters:/^(?:[a-zA-Z\u03B1-\u03C9\u0391-\u03A9?@]|(?:\\(?:alpha|beta|gamma|delta|epsilon|zeta|eta|theta|iota|kappa|lambda|mu|nu|xi|omicron|pi|rho|sigma|tau|upsilon|phi|chi|psi|omega|Gamma|Delta|Theta|Lambda|Xi|Pi|Sigma|Upsilon|Phi|Psi|Omega)(?:\s+|\{\}|(?![a-zA-Z]))))+/,"\\greek":/^\\(?:alpha|beta|gamma|delta|epsilon|zeta|eta|theta|iota|kappa|lambda|mu|nu|xi|omicron|pi|rho|sigma|tau|upsilon|phi|chi|psi|omega|Gamma|Delta|Theta|Lambda|Xi|Pi|Sigma|Upsilon|Phi|Psi|Omega)(?:\s+|\{\}|(?![a-zA-Z]))/,"one lowercase latin letter $":/^(?:([a-z])(?:$|[^a-zA-Z]))$/,"$one lowercase latin letter$ $":/^\$(?:([a-z])(?:$|[^a-zA-Z]))\$$/,"one lowercase greek letter $":/^(?:\$?[\u03B1-\u03C9]\$?|\$?\\(?:alpha|beta|gamma|delta|epsilon|zeta|eta|theta|iota|kappa|lambda|mu|nu|xi|omicron|pi|rho|sigma|tau|upsilon|phi|chi|psi|omega)\s*\$?)(?:\s+|\{\}|(?![a-zA-Z]))$/,digits:/^[0-9]+/,"-9.,9":/^[+\-]?(?:[0-9]+(?:[,.][0-9]+)?|[0-9]*(?:\.[0-9]+))/,"-9.,9 no missing 0":/^[+\-]?[0-9]+(?:[.,][0-9]+)?/,"(-)(9.,9)(e)(99)":function(input){var m=input.match(/^(\+\-|\+\/\-|\+|\-|\\pm\s?)?([0-9]+(?:[,.][0-9]+)?|[0-9]*(?:\.[0-9]+))?(\((?:[0-9]+(?:[,.][0-9]+)?|[0-9]*(?:\.[0-9]+))\))?(?:(?:([eE])|\s*(\*|x|\\times|\u00D7)\s*10\^)([+\-]?[0-9]+|\{[+\-]?[0-9]+\}))?/);return m&&m[0]?{match_:m.slice(1),remainder:input.substr(m[0].length)}:null},"(-)(9)^(-9)":function(input){var m=input.match(/^(\+\-|\+\/\-|\+|\-|\\pm\s?)?([0-9]+(?:[,.][0-9]+)?|[0-9]*(?:\.[0-9]+)?)\^([+\-]?[0-9]+|\{[+\-]?[0-9]+\})/);return m&&m[0]?{match_:m.slice(1),remainder:input.substr(m[0].length)}:null},"state of aggregation $":function(input){var a=mhchemParser.patterns.findObserveGroups(input,"",/^\([a-z]{1,3}(?=[\),])/,")","");if(a&&a.remainder.match(/^($|[\s,;\)\]\}])/))return a;var m=input.match(/^(?:\((?:\\ca\s?)?\$[amothc]\$\))/);return m?{match_:m[0],remainder:input.substr(m[0].length)}:null},"_{(state of aggregation)}$":/^_\{(\([a-z]{1,3}\))\}/,"{[(":/^(?:\\\{|\[|\()/,")]}":/^(?:\)|\]|\\\})/,", ":/^[,;]\s*/,",":/^[,;]/,".":/^[.]/,". ":/^([.\u22C5\u00B7\u2022])\s*/,"...":/^\.\.\.(?=$|[^.])/,"* ":/^([*])\s*/,"^{(...)}":function(input){return mhchemParser.patterns.findObserveGroups(input,"^{","","","}")},"^($...$)":function(input){return mhchemParser.patterns.findObserveGroups(input,"^","$","$","")},"^a":/^\^([0-9]+|[^\\_])/,"^\\x{}{}":function(input){return mhchemParser.patterns.findObserveGroups(input,"^",/^\\[a-zA-Z]+\{/,"}","","","{","}","",!0)},"^\\x{}":function(input){return mhchemParser.patterns.findObserveGroups(input,"^",/^\\[a-zA-Z]+\{/,"}","")},"^\\x":/^\^(\\[a-zA-Z]+)\s*/,"^(-1)":/^\^(-?\d+)/,"'":/^'/,"_{(...)}":function(input){return mhchemParser.patterns.findObserveGroups(input,"_{","","","}")},"_($...$)":function(input){return mhchemParser.patterns.findObserveGroups(input,"_","$","$","")},_9:/^_([+\-]?[0-9]+|[^\\])/,"_\\x{}{}":function(input){return mhchemParser.patterns.findObserveGroups(input,"_",/^\\[a-zA-Z]+\{/,"}","","","{","}","",!0)},"_\\x{}":function(input){return mhchemParser.patterns.findObserveGroups(input,"_",/^\\[a-zA-Z]+\{/,"}","")},"_\\x":/^_(\\[a-zA-Z]+)\s*/,"^_":/^(?:\^(?=_)|\_(?=\^)|[\^_]$)/,"{}":/^\{\}/,"{...}":function(input){return mhchemParser.patterns.findObserveGroups(input,"","{","}","")},"{(...)}":function(input){return mhchemParser.patterns.findObserveGroups(input,"{","","","}")},"$...$":function(input){return mhchemParser.patterns.findObserveGroups(input,"","$","$","")},"${(...)}$":function(input){return mhchemParser.patterns.findObserveGroups(input,"${","","","}$")},"$(...)$":function(input){return mhchemParser.patterns.findObserveGroups(input,"$","","","$")},"=<>":/^[=<>]/,"#":/^[#\u2261]/,"+":/^\+/,"-$":/^-(?=[\s_},;\]/]|$|\([a-z]+\))/,"-9":/^-(?=[0-9])/,"- orbital overlap":/^-(?=(?:[spd]|sp)(?:$|[\s,;\)\]\}]))/,"-":/^-/,"pm-operator":/^(?:\\pm|\$\\pm\$|\+-|\+\/-)/,operator:/^(?:\+|(?:[\-=<>]|<<|>>|\\approx|\$\\approx\$)(?=\s|$|-?[0-9]))/,arrowUpDown:/^(?:v|\(v\)|\^|\(\^\))(?=$|[\s,;\)\]\}])/,"\\bond{(...)}":function(input){return mhchemParser.patterns.findObserveGroups(input,"\\bond{","","","}")},"->":/^(?:<->|<-->|->|<-|<=>>|<<=>|<=>|[\u2192\u27F6\u21CC])/,CMT:/^[CMT](?=\[)/,"[(...)]":function(input){return mhchemParser.patterns.findObserveGroups(input,"[","","","]")},"1st-level escape":/^(&|\\\\|\\hline)\s*/,"\\,":/^(?:\\[,\ ;:])/,"\\x{}{}":function(input){return mhchemParser.patterns.findObserveGroups(input,"",/^\\[a-zA-Z]+\{/,"}","","","{","}","",!0)},"\\x{}":function(input){return mhchemParser.patterns.findObserveGroups(input,"",/^\\[a-zA-Z]+\{/,"}","")},"\\ca":/^\\ca(?:\s+|(?![a-zA-Z]))/,"\\x":/^(?:\\[a-zA-Z]+\s*|\\[_&{}%])/,orbital:/^(?:[0-9]{1,2}[spdfgh]|[0-9]{0,2}sp)(?=$|[^a-zA-Z])/,others:/^[\/~|]/,"\\frac{(...)}":function(input){return mhchemParser.patterns.findObserveGroups(input,"\\frac{","","","}","{","","","}")},"\\overset{(...)}":function(input){return mhchemParser.patterns.findObserveGroups(input,"\\overset{","","","}","{","","","}")},"\\underset{(...)}":function(input){return mhchemParser.patterns.findObserveGroups(input,"\\underset{","","","}","{","","","}")},"\\underbrace{(...)}":function(input){return mhchemParser.patterns.findObserveGroups(input,"\\underbrace{","","","}_","{","","","}")},"\\color{(...)}0":function(input){return mhchemParser.patterns.findObserveGroups(input,"\\color{","","","}")},"\\color{(...)}{(...)}1":function(input){return mhchemParser.patterns.findObserveGroups(input,"\\color{","","","}","{","","","}")},"\\color(...){(...)}2":function(input){return mhchemParser.patterns.findObserveGroups(input,"\\color","\\","",/^(?=\{)/,"{","","","}")},"\\ce{(...)}":function(input){return mhchemParser.patterns.findObserveGroups(input,"\\ce{","","","}")},oxidation$:/^(?:[+-][IVX]+|\\pm\s*0|\$\\pm\$\s*0)$/,"d-oxidation$":/^(?:[+-]?\s?[IVX]+|\\pm\s*0|\$\\pm\$\s*0)$/,"roman numeral":/^[IVX]+/,"1/2$":/^[+\-]?(?:[0-9]+|\$[a-z]\$|[a-z])\/[0-9]+(?:\$[a-z]\$|[a-z])?$/,amount:function(input){var match;if(match=input.match(/^(?:(?:(?:\([+\-]?[0-9]+\/[0-9]+\)|[+\-]?(?:[0-9]+|\$[a-z]\$|[a-z])\/[0-9]+|[+\-]?[0-9]+[.,][0-9]+|[+\-]?\.[0-9]+|[+\-]?[0-9]+)(?:[a-z](?=\s*[A-Z]))?)|[+\-]?[a-z](?=\s*[A-Z])|\+(?!\s))/))return{match_:match[0],remainder:input.substr(match[0].length)};var a=mhchemParser.patterns.findObserveGroups(input,"","$","$","");return a&&(match=a.match_.match(/^\$(?:\(?[+\-]?(?:[0-9]*[a-z]?[+\-])?[0-9]*[a-z](?:[+\-][0-9]*[a-z]?)?\)?|\+|-)\$$/))?{match_:match[0],remainder:input.substr(match[0].length)}:null},amount2:function(input){return this.amount(input)},"(KV letters),":/^(?:[A-Z][a-z]{0,2}|i)(?=,)/,formula$:function(input){if(input.match(/^\([a-z]+\)$/))return null;var match=input.match(/^(?:[a-z]|(?:[0-9\ \+\-\,\.\(\)]+[a-z])+[0-9\ \+\-\,\.\(\)]*|(?:[a-z][0-9\ \+\-\,\.\(\)]+)+[a-z]?)$/);return match?{match_:match[0],remainder:input.substr(match[0].length)}:null},uprightEntities:/^(?:pH|pOH|pC|pK|iPr|iBu)(?=$|[^a-zA-Z])/,"/":/^\s*(\/)\s*/,"//":/^\s*(\/\/)\s*/,"*":/^\s*[*.]\s*/},findObserveGroups:function(input,begExcl,begIncl,endIncl,endExcl,beg2Excl,beg2Incl,end2Incl,end2Excl,combine){var _match=function(input2,pattern){if("string"==typeof pattern)return 0!==input2.indexOf(pattern)?null:pattern;var match2=input2.match(pattern);return match2?match2[0]:null},match=_match(input,begExcl);if(null===match)return null;if(input=input.substr(match.length),null===(match=_match(input,begIncl)))return null;var e=function(input2,i,endChars){for(var braces=0;i<input2.length;){var a=input2.charAt(i),match2=_match(input2.substr(i),endChars);if(null!==match2&&0===braces)return{endMatchBegin:i,endMatchEnd:i+match2.length};if("{"===a)braces++;else if("}"===a){if(0===braces)throw["ExtraCloseMissingOpen","Extra close brace or missing open brace"];braces--}i++}return null}(input,match.length,endIncl||endExcl);if(null===e)return null;var match1=input.substring(0,endIncl?e.endMatchEnd:e.endMatchBegin);if(beg2Excl||beg2Incl){var group2=this.findObserveGroups(input.substr(e.endMatchEnd),beg2Excl,beg2Incl,end2Incl,end2Excl);if(null===group2)return null;var matchRet=[match1,group2.match_];return{match_:combine?matchRet.join(""):matchRet,remainder:group2.remainder}}return{match_:match1,remainder:input.substr(e.endMatchEnd)}},match_:function(m,input){var pattern=mhchemParser.patterns.patterns[m];if(void 0===pattern)throw["MhchemBugP","mhchem bug P. Please report. ("+m+")"];if("function"==typeof pattern)return mhchemParser.patterns.patterns[m](input);var match=input.match(pattern);return match?{match_:match[2]?[match[1],match[2]]:match[1]?match[1]:match[0],remainder:input.substr(match[0].length)}:null}},actions:{"a=":function(buffer,m){buffer.a=(buffer.a||"")+m},"b=":function(buffer,m){buffer.b=(buffer.b||"")+m},"p=":function(buffer,m){buffer.p=(buffer.p||"")+m},"o=":function(buffer,m){buffer.o=(buffer.o||"")+m},"q=":function(buffer,m){buffer.q=(buffer.q||"")+m},"d=":function(buffer,m){buffer.d=(buffer.d||"")+m},"rm=":function(buffer,m){buffer.rm=(buffer.rm||"")+m},"text=":function(buffer,m){buffer.text_=(buffer.text_||"")+m},insert:function(buffer,m,a){return{type_:a}},"insert+p1":function(buffer,m,a){return{type_:a,p1:m}},"insert+p1+p2":function(buffer,m,a){return{type_:a,p1:m[0],p2:m[1]}},copy:function(buffer,m){return m},rm:function(buffer,m){return{type_:"rm",p1:m||""}},text:function(buffer,m){return mhchemParser.go(m,"text")},"{text}":function(buffer,m){var ret=["{"];return mhchemParser.concatArray(ret,mhchemParser.go(m,"text")),ret.push("}"),ret},"tex-math":function(buffer,m){return mhchemParser.go(m,"tex-math")},"tex-math tight":function(buffer,m){return mhchemParser.go(m,"tex-math tight")},bond:function(buffer,m,k){return{type_:"bond",kind_:k||m}},"color0-output":function(buffer,m){return{type_:"color0",color:m[0]}},ce:function(buffer,m){return mhchemParser.go(m)},"1/2":function(buffer,m){var ret=[];m.match(/^[+\-]/)&&(ret.push(m.substr(0,1)),m=m.substr(1));var n=m.match(/^([0-9]+|\$[a-z]\$|[a-z])\/([0-9]+)(\$[a-z]\$|[a-z])?$/);return n[1]=n[1].replace(/\$/g,""),ret.push({type_:"frac",p1:n[1],p2:n[2]}),n[3]&&(n[3]=n[3].replace(/\$/g,""),ret.push({type_:"tex-math",p1:n[3]})),ret},"9,9":function(buffer,m){return mhchemParser.go(m,"9,9")}},createTransitions:function(o){var pattern,state,stateArray,i,transitions={};for(pattern in o)for(state in o[pattern])for(stateArray=state.split("|"),o[pattern][state].stateArray=stateArray,i=0;i<stateArray.length;i++)transitions[stateArray[i]]=[];for(pattern in o)for(state in o[pattern])for(stateArray=o[pattern][state].stateArray||[],i=0;i<stateArray.length;i++){var p=o[pattern][state];if(p.action_){p.action_=[].concat(p.action_);for(var k=0;k<p.action_.length;k++)"string"==typeof p.action_[k]&&(p.action_[k]={type_:p.action_[k]})}else p.action_=[];for(var patternArray=pattern.split("|"),j=0;j<patternArray.length;j++)if("*"===stateArray[i])for(var t in transitions)transitions[t].push({pattern:patternArray[j],task:p});else transitions[stateArray[i]].push({pattern:patternArray[j],task:p})}return transitions},stateMachines:{}};mhchemParser.stateMachines={ce:{transitions:mhchemParser.createTransitions({empty:{"*":{action_:"output"}},else:{"0|1|2":{action_:"beginsWithBond=false",revisit:!0,toContinue:!0}},oxidation$:{0:{action_:"oxidation-output"}},CMT:{r:{action_:"rdt=",nextState:"rt"},rd:{action_:"rqt=",nextState:"rdt"}},arrowUpDown:{"0|1|2|as":{action_:["sb=false","output","operator"],nextState:"1"}},uprightEntities:{"0|1|2":{action_:["o=","output"],nextState:"1"}},orbital:{"0|1|2|3":{action_:"o=",nextState:"o"}},"->":{"0|1|2|3":{action_:"r=",nextState:"r"},"a|as":{action_:["output","r="],nextState:"r"},"*":{action_:["output","r="],nextState:"r"}},"+":{o:{action_:"d= kv",nextState:"d"},"d|D":{action_:"d=",nextState:"d"},q:{action_:"d=",nextState:"qd"},"qd|qD":{action_:"d=",nextState:"qd"},dq:{action_:["output","d="],nextState:"d"},3:{action_:["sb=false","output","operator"],nextState:"0"}},amount:{"0|2":{action_:"a=",nextState:"a"}},"pm-operator":{"0|1|2|a|as":{action_:["sb=false","output",{type_:"operator",option:"\\pm"}],nextState:"0"}},operator:{"0|1|2|a|as":{action_:["sb=false","output","operator"],nextState:"0"}},"-$":{"o|q":{action_:["charge or bond","output"],nextState:"qd"},d:{action_:"d=",nextState:"d"},D:{action_:["output",{type_:"bond",option:"-"}],nextState:"3"},q:{action_:"d=",nextState:"qd"},qd:{action_:"d=",nextState:"qd"},"qD|dq":{action_:["output",{type_:"bond",option:"-"}],nextState:"3"}},"-9":{"3|o":{action_:["output",{type_:"insert",option:"hyphen"}],nextState:"3"}},"- orbital overlap":{o:{action_:["output",{type_:"insert",option:"hyphen"}],nextState:"2"},d:{action_:["output",{type_:"insert",option:"hyphen"}],nextState:"2"}},"-":{"0|1|2":{action_:[{type_:"output",option:1},"beginsWithBond=true",{type_:"bond",option:"-"}],nextState:"3"},3:{action_:{type_:"bond",option:"-"}},a:{action_:["output",{type_:"insert",option:"hyphen"}],nextState:"2"},as:{action_:[{type_:"output",option:2},{type_:"bond",option:"-"}],nextState:"3"},b:{action_:"b="},o:{action_:{type_:"- after o/d",option:!1},nextState:"2"},q:{action_:{type_:"- after o/d",option:!1},nextState:"2"},"d|qd|dq":{action_:{type_:"- after o/d",option:!0},nextState:"2"},"D|qD|p":{action_:["output",{type_:"bond",option:"-"}],nextState:"3"}},amount2:{"1|3":{action_:"a=",nextState:"a"}},letters:{"0|1|2|3|a|as|b|p|bp|o":{action_:"o=",nextState:"o"},"q|dq":{action_:["output","o="],nextState:"o"},"d|D|qd|qD":{action_:"o after d",nextState:"o"}},digits:{o:{action_:"q=",nextState:"q"},"d|D":{action_:"q=",nextState:"dq"},q:{action_:["output","o="],nextState:"o"},a:{action_:"o=",nextState:"o"}},"space A":{"b|p|bp":{}},space:{a:{nextState:"as"},0:{action_:"sb=false"},"1|2":{action_:"sb=true"},"r|rt|rd|rdt|rdq":{action_:"output",nextState:"0"},"*":{action_:["output","sb=true"],nextState:"1"}},"1st-level escape":{"1|2":{action_:["output",{type_:"insert+p1",option:"1st-level escape"}]},"*":{action_:["output",{type_:"insert+p1",option:"1st-level escape"}],nextState:"0"}},"[(...)]":{"r|rt":{action_:"rd=",nextState:"rd"},"rd|rdt":{action_:"rq=",nextState:"rdq"}},"...":{"o|d|D|dq|qd|qD":{action_:["output",{type_:"bond",option:"..."}],nextState:"3"},"*":{action_:[{type_:"output",option:1},{type_:"insert",option:"ellipsis"}],nextState:"1"}},". |* ":{"*":{action_:["output",{type_:"insert",option:"addition compound"}],nextState:"1"}},"state of aggregation $":{"*":{action_:["output","state of aggregation"],nextState:"1"}},"{[(":{"a|as|o":{action_:["o=","output","parenthesisLevel++"],nextState:"2"},"0|1|2|3":{action_:["o=","output","parenthesisLevel++"],nextState:"2"},"*":{action_:["output","o=","output","parenthesisLevel++"],nextState:"2"}},")]}":{"0|1|2|3|b|p|bp|o":{action_:["o=","parenthesisLevel--"],nextState:"o"},"a|as|d|D|q|qd|qD|dq":{action_:["output","o=","parenthesisLevel--"],nextState:"o"}},", ":{"*":{action_:["output","comma"],nextState:"0"}},"^_":{"*":{}},"^{(...)}|^($...$)":{"0|1|2|as":{action_:"b=",nextState:"b"},p:{action_:"b=",nextState:"bp"},"3|o":{action_:"d= kv",nextState:"D"},q:{action_:"d=",nextState:"qD"},"d|D|qd|qD|dq":{action_:["output","d="],nextState:"D"}},"^a|^\\x{}{}|^\\x{}|^\\x|'":{"0|1|2|as":{action_:"b=",nextState:"b"},p:{action_:"b=",nextState:"bp"},"3|o":{action_:"d= kv",nextState:"d"},q:{action_:"d=",nextState:"qd"},"d|qd|D|qD":{action_:"d="},dq:{action_:["output","d="],nextState:"d"}},"_{(state of aggregation)}$":{"d|D|q|qd|qD|dq":{action_:["output","q="],nextState:"q"}},"_{(...)}|_($...$)|_9|_\\x{}{}|_\\x{}|_\\x":{"0|1|2|as":{action_:"p=",nextState:"p"},b:{action_:"p=",nextState:"bp"},"3|o":{action_:"q=",nextState:"q"},"d|D":{action_:"q=",nextState:"dq"},"q|qd|qD|dq":{action_:["output","q="],nextState:"q"}},"=<>":{"0|1|2|3|a|as|o|q|d|D|qd|qD|dq":{action_:[{type_:"output",option:2},"bond"],nextState:"3"}},"#":{"0|1|2|3|a|as|o":{action_:[{type_:"output",option:2},{type_:"bond",option:"#"}],nextState:"3"}},"{}":{"*":{action_:{type_:"output",option:1},nextState:"1"}},"{...}":{"0|1|2|3|a|as|b|p|bp":{action_:"o=",nextState:"o"},"o|d|D|q|qd|qD|dq":{action_:["output","o="],nextState:"o"}},"$...$":{a:{action_:"a="},"0|1|2|3|as|b|p|bp|o":{action_:"o=",nextState:"o"},"as|o":{action_:"o="},"q|d|D|qd|qD|dq":{action_:["output","o="],nextState:"o"}},"\\bond{(...)}":{"*":{action_:[{type_:"output",option:2},"bond"],nextState:"3"}},"\\frac{(...)}":{"*":{action_:[{type_:"output",option:1},"frac-output"],nextState:"3"}},"\\overset{(...)}":{"*":{action_:[{type_:"output",option:2},"overset-output"],nextState:"3"}},"\\underset{(...)}":{"*":{action_:[{type_:"output",option:2},"underset-output"],nextState:"3"}},"\\underbrace{(...)}":{"*":{action_:[{type_:"output",option:2},"underbrace-output"],nextState:"3"}},"\\color{(...)}{(...)}1|\\color(...){(...)}2":{"*":{action_:[{type_:"output",option:2},"color-output"],nextState:"3"}},"\\color{(...)}0":{"*":{action_:[{type_:"output",option:2},"color0-output"]}},"\\ce{(...)}":{"*":{action_:[{type_:"output",option:2},"ce"],nextState:"3"}},"\\,":{"*":{action_:[{type_:"output",option:1},"copy"],nextState:"1"}},"\\x{}{}|\\x{}|\\x":{"0|1|2|3|a|as|b|p|bp|o|c0":{action_:["o=","output"],nextState:"3"},"*":{action_:["output","o=","output"],nextState:"3"}},others:{"*":{action_:[{type_:"output",option:1},"copy"],nextState:"3"}},else2:{a:{action_:"a to o",nextState:"o",revisit:!0},as:{action_:["output","sb=true"],nextState:"1",revisit:!0},"r|rt|rd|rdt|rdq":{action_:["output"],nextState:"0",revisit:!0},"*":{action_:["output","copy"],nextState:"3"}}}),actions:{"o after d":function(buffer,m){var ret;if((buffer.d||"").match(/^[0-9]+$/)){var tmp=buffer.d;buffer.d=void 0,ret=this.output(buffer),buffer.b=tmp}else ret=this.output(buffer);return mhchemParser.actions["o="](buffer,m),ret},"d= kv":function(buffer,m){buffer.d=m,buffer.dType="kv"},"charge or bond":function(buffer,m){if(buffer.beginsWithBond){var ret=[];return mhchemParser.concatArray(ret,this.output(buffer)),mhchemParser.concatArray(ret,mhchemParser.actions.bond(buffer,m,"-")),ret}buffer.d=m},"- after o/d":function(buffer,m,isAfterD){var c1=mhchemParser.patterns.match_("orbital",buffer.o||""),c2=mhchemParser.patterns.match_("one lowercase greek letter $",buffer.o||""),c3=mhchemParser.patterns.match_("one lowercase latin letter $",buffer.o||""),c4=mhchemParser.patterns.match_("$one lowercase latin letter$ $",buffer.o||""),hyphenFollows="-"===m&&(c1&&""===c1.remainder||c2||c3||c4);!hyphenFollows||buffer.a||buffer.b||buffer.p||buffer.d||buffer.q||c1||!c3||(buffer.o="$"+buffer.o+"$");var ret=[];return hyphenFollows?(mhchemParser.concatArray(ret,this.output(buffer)),ret.push({type_:"hyphen"})):(c1=mhchemParser.patterns.match_("digits",buffer.d||""),isAfterD&&c1&&""===c1.remainder?(mhchemParser.concatArray(ret,mhchemParser.actions["d="](buffer,m)),mhchemParser.concatArray(ret,this.output(buffer))):(mhchemParser.concatArray(ret,this.output(buffer)),mhchemParser.concatArray(ret,mhchemParser.actions.bond(buffer,m,"-")))),ret},"a to o":function(buffer){buffer.o=buffer.a,buffer.a=void 0},"sb=true":function(buffer){buffer.sb=!0},"sb=false":function(buffer){buffer.sb=!1},"beginsWithBond=true":function(buffer){buffer.beginsWithBond=!0},"beginsWithBond=false":function(buffer){buffer.beginsWithBond=!1},"parenthesisLevel++":function(buffer){buffer.parenthesisLevel++},"parenthesisLevel--":function(buffer){buffer.parenthesisLevel--},"state of aggregation":function(buffer,m){return{type_:"state of aggregation",p1:mhchemParser.go(m,"o")}},comma:function(buffer,m){var a=m.replace(/\s*$/,"");return a!==m&&0===buffer.parenthesisLevel?{type_:"comma enumeration L",p1:a}:{type_:"comma enumeration M",p1:a}},output:function(buffer,m,entityFollows){var ret,rd,rq;for(var p in buffer.r?(rd="M"===buffer.rdt?mhchemParser.go(buffer.rd,"tex-math"):"T"===buffer.rdt?[{type_:"text",p1:buffer.rd||""}]:mhchemParser.go(buffer.rd),rq="M"===buffer.rqt?mhchemParser.go(buffer.rq,"tex-math"):"T"===buffer.rqt?[{type_:"text",p1:buffer.rq||""}]:mhchemParser.go(buffer.rq),ret={type_:"arrow",r:buffer.r,rd:rd,rq:rq}):(ret=[],(buffer.a||buffer.b||buffer.p||buffer.o||buffer.q||buffer.d||entityFollows)&&(buffer.sb&&ret.push({type_:"entitySkip"}),buffer.o||buffer.q||buffer.d||buffer.b||buffer.p||2===entityFollows?buffer.o||buffer.q||buffer.d||!buffer.b&&!buffer.p?buffer.o&&"kv"===buffer.dType&&mhchemParser.patterns.match_("d-oxidation$",buffer.d||"")?buffer.dType="oxidation":buffer.o&&"kv"===buffer.dType&&!buffer.q&&(buffer.dType=void 0):(buffer.o=buffer.a,buffer.d=buffer.b,buffer.q=buffer.p,buffer.a=buffer.b=buffer.p=void 0):(buffer.o=buffer.a,buffer.a=void 0),ret.push({type_:"chemfive",a:mhchemParser.go(buffer.a,"a"),b:mhchemParser.go(buffer.b,"bd"),p:mhchemParser.go(buffer.p,"pq"),o:mhchemParser.go(buffer.o,"o"),q:mhchemParser.go(buffer.q,"pq"),d:mhchemParser.go(buffer.d,"oxidation"===buffer.dType?"oxidation":"bd"),dType:buffer.dType}))),buffer)"parenthesisLevel"!==p&&"beginsWithBond"!==p&&delete buffer[p];return ret},"oxidation-output":function(buffer,m){var ret=["{"];return mhchemParser.concatArray(ret,mhchemParser.go(m,"oxidation")),ret.push("}"),ret},"frac-output":function(buffer,m){return{type_:"frac-ce",p1:mhchemParser.go(m[0]),p2:mhchemParser.go(m[1])}},"overset-output":function(buffer,m){return{type_:"overset",p1:mhchemParser.go(m[0]),p2:mhchemParser.go(m[1])}},"underset-output":function(buffer,m){return{type_:"underset",p1:mhchemParser.go(m[0]),p2:mhchemParser.go(m[1])}},"underbrace-output":function(buffer,m){return{type_:"underbrace",p1:mhchemParser.go(m[0]),p2:mhchemParser.go(m[1])}},"color-output":function(buffer,m){return{type_:"color",color1:m[0],color2:mhchemParser.go(m[1])}},"r=":function(buffer,m){buffer.r=m},"rdt=":function(buffer,m){buffer.rdt=m},"rd=":function(buffer,m){buffer.rd=m},"rqt=":function(buffer,m){buffer.rqt=m},"rq=":function(buffer,m){buffer.rq=m},operator:function(buffer,m,p1){return{type_:"operator",kind_:p1||m}}}},a:{transitions:mhchemParser.createTransitions({empty:{"*":{}},"1/2$":{0:{action_:"1/2"}},else:{0:{nextState:"1",revisit:!0}},"$(...)$":{"*":{action_:"tex-math tight",nextState:"1"}},",":{"*":{action_:{type_:"insert",option:"commaDecimal"}}},else2:{"*":{action_:"copy"}}}),actions:{}},o:{transitions:mhchemParser.createTransitions({empty:{"*":{}},"1/2$":{0:{action_:"1/2"}},else:{0:{nextState:"1",revisit:!0}},letters:{"*":{action_:"rm"}},"\\ca":{"*":{action_:{type_:"insert",option:"circa"}}},"\\x{}{}|\\x{}|\\x":{"*":{action_:"copy"}},"${(...)}$|$(...)$":{"*":{action_:"tex-math"}},"{(...)}":{"*":{action_:"{text}"}},else2:{"*":{action_:"copy"}}}),actions:{}},text:{transitions:mhchemParser.createTransitions({empty:{"*":{action_:"output"}},"{...}":{"*":{action_:"text="}},"${(...)}$|$(...)$":{"*":{action_:"tex-math"}},"\\greek":{"*":{action_:["output","rm"]}},"\\,|\\x{}{}|\\x{}|\\x":{"*":{action_:["output","copy"]}},else:{"*":{action_:"text="}}}),actions:{output:function(buffer){if(buffer.text_){var ret={type_:"text",p1:buffer.text_};for(var p in buffer)delete buffer[p];return ret}}}},pq:{transitions:mhchemParser.createTransitions({empty:{"*":{}},"state of aggregation $":{"*":{action_:"state of aggregation"}},i$:{0:{nextState:"!f",revisit:!0}},"(KV letters),":{0:{action_:"rm",nextState:"0"}},formula$:{0:{nextState:"f",revisit:!0}},"1/2$":{0:{action_:"1/2"}},else:{0:{nextState:"!f",revisit:!0}},"${(...)}$|$(...)$":{"*":{action_:"tex-math"}},"{(...)}":{"*":{action_:"text"}},"a-z":{f:{action_:"tex-math"}},letters:{"*":{action_:"rm"}},"-9.,9":{"*":{action_:"9,9"}},",":{"*":{action_:{type_:"insert+p1",option:"comma enumeration S"}}},"\\color{(...)}{(...)}1|\\color(...){(...)}2":{"*":{action_:"color-output"}},"\\color{(...)}0":{"*":{action_:"color0-output"}},"\\ce{(...)}":{"*":{action_:"ce"}},"\\,|\\x{}{}|\\x{}|\\x":{"*":{action_:"copy"}},else2:{"*":{action_:"copy"}}}),actions:{"state of aggregation":function(buffer,m){return{type_:"state of aggregation subscript",p1:mhchemParser.go(m,"o")}},"color-output":function(buffer,m){return{type_:"color",color1:m[0],color2:mhchemParser.go(m[1],"pq")}}}},bd:{transitions:mhchemParser.createTransitions({empty:{"*":{}},x$:{0:{nextState:"!f",revisit:!0}},formula$:{0:{nextState:"f",revisit:!0}},else:{0:{nextState:"!f",revisit:!0}},"-9.,9 no missing 0":{"*":{action_:"9,9"}},".":{"*":{action_:{type_:"insert",option:"electron dot"}}},"a-z":{f:{action_:"tex-math"}},x:{"*":{action_:{type_:"insert",option:"KV x"}}},letters:{"*":{action_:"rm"}},"'":{"*":{action_:{type_:"insert",option:"prime"}}},"${(...)}$|$(...)$":{"*":{action_:"tex-math"}},"{(...)}":{"*":{action_:"text"}},"\\color{(...)}{(...)}1|\\color(...){(...)}2":{"*":{action_:"color-output"}},"\\color{(...)}0":{"*":{action_:"color0-output"}},"\\ce{(...)}":{"*":{action_:"ce"}},"\\,|\\x{}{}|\\x{}|\\x":{"*":{action_:"copy"}},else2:{"*":{action_:"copy"}}}),actions:{"color-output":function(buffer,m){return{type_:"color",color1:m[0],color2:mhchemParser.go(m[1],"bd")}}}},oxidation:{transitions:mhchemParser.createTransitions({empty:{"*":{}},"roman numeral":{"*":{action_:"roman-numeral"}},"${(...)}$|$(...)$":{"*":{action_:"tex-math"}},else:{"*":{action_:"copy"}}}),actions:{"roman-numeral":function(buffer,m){return{type_:"roman numeral",p1:m||""}}}},"tex-math":{transitions:mhchemParser.createTransitions({empty:{"*":{action_:"output"}},"\\ce{(...)}":{"*":{action_:["output","ce"]}},"{...}|\\,|\\x{}{}|\\x{}|\\x":{"*":{action_:"o="}},else:{"*":{action_:"o="}}}),actions:{output:function(buffer){if(buffer.o){var ret={type_:"tex-math",p1:buffer.o};for(var p in buffer)delete buffer[p];return ret}}}},"tex-math tight":{transitions:mhchemParser.createTransitions({empty:{"*":{action_:"output"}},"\\ce{(...)}":{"*":{action_:["output","ce"]}},"{...}|\\,|\\x{}{}|\\x{}|\\x":{"*":{action_:"o="}},"-|+":{"*":{action_:"tight operator"}},else:{"*":{action_:"o="}}}),actions:{"tight operator":function(buffer,m){buffer.o=(buffer.o||"")+"{"+m+"}"},output:function(buffer){if(buffer.o){var ret={type_:"tex-math",p1:buffer.o};for(var p in buffer)delete buffer[p];return ret}}}},"9,9":{transitions:mhchemParser.createTransitions({empty:{"*":{}},",":{"*":{action_:"comma"}},else:{"*":{action_:"copy"}}}),actions:{comma:function(){return{type_:"commaDecimal"}}}},pu:{transitions:mhchemParser.createTransitions({empty:{"*":{action_:"output"}},space$:{"*":{action_:["output","space"]}},"{[(|)]}":{"0|a":{action_:"copy"}},"(-)(9)^(-9)":{0:{action_:"number^",nextState:"a"}},"(-)(9.,9)(e)(99)":{0:{action_:"enumber",nextState:"a"}},space:{"0|a":{}},"pm-operator":{"0|a":{action_:{type_:"operator",option:"\\pm"},nextState:"0"}},operator:{"0|a":{action_:"copy",nextState:"0"}},"//":{d:{action_:"o=",nextState:"/"}},"/":{d:{action_:"o=",nextState:"/"}},"{...}|else":{"0|d":{action_:"d=",nextState:"d"},a:{action_:["space","d="],nextState:"d"},"/|q":{action_:"q=",nextState:"q"}}}),actions:{enumber:function(buffer,m){var ret=[];return"+-"===m[0]||"+/-"===m[0]?ret.push("\\pm "):m[0]&&ret.push(m[0]),m[1]&&(mhchemParser.concatArray(ret,mhchemParser.go(m[1],"pu-9,9")),m[2]&&(m[2].match(/[,.]/)?mhchemParser.concatArray(ret,mhchemParser.go(m[2],"pu-9,9")):ret.push(m[2])),(m[3]||m[4])&&("e"===m[3]||"*"===m[4]?ret.push({type_:"cdot"}):ret.push({type_:"times"}))),m[5]&&ret.push("10^{"+m[5]+"}"),ret},"number^":function(buffer,m){var ret=[];return"+-"===m[0]||"+/-"===m[0]?ret.push("\\pm "):m[0]&&ret.push(m[0]),mhchemParser.concatArray(ret,mhchemParser.go(m[1],"pu-9,9")),ret.push("^{"+m[2]+"}"),ret},operator:function(buffer,m,p1){return{type_:"operator",kind_:p1||m}},space:function(){return{type_:"pu-space-1"}},output:function(buffer){var ret,md=mhchemParser.patterns.match_("{(...)}",buffer.d||"");md&&""===md.remainder&&(buffer.d=md.match_);var mq=mhchemParser.patterns.match_("{(...)}",buffer.q||"");if(mq&&""===mq.remainder&&(buffer.q=mq.match_),buffer.d&&(buffer.d=buffer.d.replace(/\u00B0C|\^oC|\^{o}C/g,"{}^{\\circ}C"),buffer.d=buffer.d.replace(/\u00B0F|\^oF|\^{o}F/g,"{}^{\\circ}F")),buffer.q){buffer.q=buffer.q.replace(/\u00B0C|\^oC|\^{o}C/g,"{}^{\\circ}C"),buffer.q=buffer.q.replace(/\u00B0F|\^oF|\^{o}F/g,"{}^{\\circ}F");var b5={d:mhchemParser.go(buffer.d,"pu"),q:mhchemParser.go(buffer.q,"pu")};"//"===buffer.o?ret={type_:"pu-frac",p1:b5.d,p2:b5.q}:(ret=b5.d,b5.d.length>1||b5.q.length>1?ret.push({type_:" / "}):ret.push({type_:"/"}),mhchemParser.concatArray(ret,b5.q))}else ret=mhchemParser.go(buffer.d,"pu-2");for(var p in buffer)delete buffer[p];return ret}}},"pu-2":{transitions:mhchemParser.createTransitions({empty:{"*":{action_:"output"}},"*":{"*":{action_:["output","cdot"],nextState:"0"}},"\\x":{"*":{action_:"rm="}},space:{"*":{action_:["output","space"],nextState:"0"}},"^{(...)}|^(-1)":{1:{action_:"^(-1)"}},"-9.,9":{0:{action_:"rm=",nextState:"0"},1:{action_:"^(-1)",nextState:"0"}},"{...}|else":{"*":{action_:"rm=",nextState:"1"}}}),actions:{cdot:function(){return{type_:"tight cdot"}},"^(-1)":function(buffer,m){buffer.rm+="^{"+m+"}"},space:function(){return{type_:"pu-space-2"}},output:function(buffer){var ret=[];if(buffer.rm){var mrm=mhchemParser.patterns.match_("{(...)}",buffer.rm||"");ret=mrm&&""===mrm.remainder?mhchemParser.go(mrm.match_,"pu"):{type_:"rm",p1:buffer.rm}}for(var p in buffer)delete buffer[p];return ret}}},"pu-9,9":{transitions:mhchemParser.createTransitions({empty:{0:{action_:"output-0"},o:{action_:"output-o"}},",":{0:{action_:["output-0","comma"],nextState:"o"}},".":{0:{action_:["output-0","copy"],nextState:"o"}},else:{"*":{action_:"text="}}}),actions:{comma:function(){return{type_:"commaDecimal"}},"output-0":function(buffer){var ret=[];if(buffer.text_=buffer.text_||"",buffer.text_.length>4){var a=buffer.text_.length%3;0===a&&(a=3);for(var i=buffer.text_.length-3;i>0;i-=3)ret.push(buffer.text_.substr(i,3)),ret.push({type_:"1000 separator"});ret.push(buffer.text_.substr(0,a)),ret.reverse()}else ret.push(buffer.text_);for(var p in buffer)delete buffer[p];return ret},"output-o":function(buffer){var ret=[];if(buffer.text_=buffer.text_||"",buffer.text_.length>4){for(var a=buffer.text_.length-3,i=0;i<a;i+=3)ret.push(buffer.text_.substr(i,3)),ret.push({type_:"1000 separator"});ret.push(buffer.text_.substr(i))}else ret.push(buffer.text_);for(var p in buffer)delete buffer[p];return ret}}}};var texify={go:function(input,isInner){if(!input)return"";for(var res="",cee=!1,i=0;i<input.length;i++){var inputi=input[i];"string"==typeof inputi?res+=inputi:(res+=texify._go2(inputi),"1st-level escape"===inputi.type_&&(cee=!0))}return isInner||cee||!res||(res="{"+res+"}"),res},_goInner:function(input){return input?texify.go(input,!0):input},_go2:function(buf){var res;switch(buf.type_){case"chemfive":res="";var b5={a:texify._goInner(buf.a),b:texify._goInner(buf.b),p:texify._goInner(buf.p),o:texify._goInner(buf.o),q:texify._goInner(buf.q),d:texify._goInner(buf.d)};b5.a&&(b5.a.match(/^[+\-]/)&&(b5.a="{"+b5.a+"}"),res+=b5.a+"\\,"),(b5.b||b5.p)&&(res+="{\\vphantom{X}}",res+="^{\\hphantom{"+(b5.b||"")+"}}_{\\hphantom{"+(b5.p||"")+"}}",res+="{\\vphantom{X}}",res+="^{\\smash[t]{\\vphantom{2}}\\llap{"+(b5.b||"")+"}}",res+="_{\\vphantom{2}\\llap{\\smash[t]{"+(b5.p||"")+"}}}"),b5.o&&(b5.o.match(/^[+\-]/)&&(b5.o="{"+b5.o+"}"),res+=b5.o),"kv"===buf.dType?((b5.d||b5.q)&&(res+="{\\vphantom{X}}"),b5.d&&(res+="^{"+b5.d+"}"),b5.q&&(res+="_{\\smash[t]{"+b5.q+"}}")):"oxidation"===buf.dType?(b5.d&&(res+="{\\vphantom{X}}",res+="^{"+b5.d+"}"),b5.q&&(res+="{\\vphantom{X}}",res+="_{\\smash[t]{"+b5.q+"}}")):(b5.q&&(res+="{\\vphantom{X}}",res+="_{\\smash[t]{"+b5.q+"}}"),b5.d&&(res+="{\\vphantom{X}}",res+="^{"+b5.d+"}"));break;case"rm":case"roman numeral":res="\\mathrm{"+buf.p1+"}";break;case"text":buf.p1.match(/[\^_]/)?(buf.p1=buf.p1.replace(" ","~").replace("-","\\text{-}"),res="\\mathrm{"+buf.p1+"}"):res="\\text{"+buf.p1+"}";break;case"state of aggregation":res="\\mskip2mu "+texify._goInner(buf.p1);break;case"state of aggregation subscript":res="\\mskip1mu "+texify._goInner(buf.p1);break;case"bond":if(!(res=texify._getBond(buf.kind_)))throw["MhchemErrorBond","mhchem Error. Unknown bond type ("+buf.kind_+")"];break;case"frac":var c="\\frac{"+buf.p1+"}{"+buf.p2+"}";res="\\mathchoice{\\textstyle"+c+"}{"+c+"}{"+c+"}{"+c+"}";break;case"pu-frac":var d="\\frac{"+texify._goInner(buf.p1)+"}{"+texify._goInner(buf.p2)+"}";res="\\mathchoice{\\textstyle"+d+"}{"+d+"}{"+d+"}{"+d+"}";break;case"tex-math":case"1st-level escape":res=buf.p1+" ";break;case"frac-ce":res="\\frac{"+texify._goInner(buf.p1)+"}{"+texify._goInner(buf.p2)+"}";break;case"overset":res="\\overset{"+texify._goInner(buf.p1)+"}{"+texify._goInner(buf.p2)+"}";break;case"underset":res="\\underset{"+texify._goInner(buf.p1)+"}{"+texify._goInner(buf.p2)+"}";break;case"underbrace":res="\\underbrace{"+texify._goInner(buf.p1)+"}_{"+texify._goInner(buf.p2)+"}";break;case"color":res="{\\color{"+buf.color1+"}{"+texify._goInner(buf.color2)+"}}";break;case"color0":res="\\color{"+buf.color+"}";break;case"arrow":var b6={rd:texify._goInner(buf.rd),rq:texify._goInner(buf.rq)},arrow=texify._getArrow(buf.r);b6.rd||b6.rq?"<=>"===buf.r||"<=>>"===buf.r||"<<=>"===buf.r||"<--\x3e"===buf.r?(arrow="\\long"+arrow,b6.rd&&(arrow="\\overset{"+b6.rd+"}{"+arrow+"}"),b6.rq&&(arrow="<--\x3e"===buf.r?"\\underset{\\lower2mu{"+b6.rq+"}}{"+arrow+"}":"\\underset{\\lower6mu{"+b6.rq+"}}{"+arrow+"}"),arrow=" {}\\mathrel{"+arrow+"}{} "):(b6.rq&&(arrow+="[{"+b6.rq+"}]"),arrow=" {}\\mathrel{\\x"+(arrow+="{"+b6.rd+"}")+"}{} "):arrow=" {}\\mathrel{\\long"+arrow+"}{} ",res=arrow;break;case"operator":res=texify._getOperator(buf.kind_);break;case"space":res=" ";break;case"entitySkip":case"pu-space-1":res="~";break;case"pu-space-2":res="\\mkern3mu ";break;case"1000 separator":res="\\mkern2mu ";break;case"commaDecimal":res="{,}";break;case"comma enumeration L":res="{"+buf.p1+"}\\mkern6mu ";break;case"comma enumeration M":res="{"+buf.p1+"}\\mkern3mu ";break;case"comma enumeration S":res="{"+buf.p1+"}\\mkern1mu ";break;case"hyphen":res="\\text{-}";break;case"addition compound":res="\\,{\\cdot}\\,";break;case"electron dot":res="\\mkern1mu \\bullet\\mkern1mu ";break;case"KV x":res="{\\times}";break;case"prime":res="\\prime ";break;case"cdot":res="\\cdot ";break;case"tight cdot":res="\\mkern1mu{\\cdot}\\mkern1mu ";break;case"times":res="\\times ";break;case"circa":res="{\\sim}";break;case"^":res="uparrow";break;case"v":res="downarrow";break;case"ellipsis":res="\\ldots ";break;case"/":res="/";break;case" / ":res="\\,/\\,";break;default:throw["MhchemBugT","mhchem bug T. Please report."]}return res},_getArrow:function(a){switch(a){case"->":case"→":case"⟶":return"rightarrow";case"<-":return"leftarrow";case"<->":return"leftrightarrow";case"<--\x3e":return"leftrightarrows";case"<=>":case"⇌":return"rightleftharpoons";case"<=>>":return"Rightleftharpoons";case"<<=>":return"Leftrightharpoons";default:throw["MhchemBugT","mhchem bug T. Please report."]}},_getBond:function(a){switch(a){case"-":case"1":return"{-}";case"=":case"2":return"{=}";case"#":case"3":return"{\\equiv}";case"~":return"{\\tripledash}";case"~-":return"{\\rlap{\\lower.1em{-}}\\raise.1em{\\tripledash}}";case"~=":case"~--":return"{\\rlap{\\lower.2em{-}}\\rlap{\\raise.2em{\\tripledash}}-}";case"-~-":return"{\\rlap{\\lower.2em{-}}\\rlap{\\raise.2em{-}}\\tripledash}";case"...":return"{{\\cdot}{\\cdot}{\\cdot}}";case"....":return"{{\\cdot}{\\cdot}{\\cdot}{\\cdot}}";case"->":return"{\\rightarrow}";case"<-":return"{\\leftarrow}";case"<":return"{<}";case">":return"{>}";default:throw["MhchemBugT","mhchem bug T. Please report."]}},_getOperator:function(a){switch(a){case"+":return" {}+{} ";case"-":return" {}-{} ";case"=":return" {}={} ";case"<":return" {}<{} ";case">":return" {}>{} ";case"<<":return" {}\\ll{} ";case">>":return" {}\\gg{} ";case"\\pm":return" {}\\pm{} ";case"\\approx":case"$\\approx$":return" {}\\approx{} ";case"v":case"(v)":return" \\downarrow{} ";case"^":case"(^)":return" \\uparrow{} ";default:throw["MhchemBugT","mhchem bug T. Please report."]}}},MiddleDelimAtom=function(_Atom15){_inherits(MiddleDelimAtom,_Atom15);var _super16=_createSuper(MiddleDelimAtom);function MiddleDelimAtom(options){var _this15;return _classCallCheck(this,MiddleDelimAtom),(_this15=_super16.call(this,__spreadProps(__spreadValues({},options),{type:"delim"}))).value=options.delim,_this15.size=options.size,_this15}return _createClass(MiddleDelimAtom,[{key:"toJson",value:function(){return __spreadProps(__spreadValues({},_get(_getPrototypeOf(MiddleDelimAtom.prototype),"toJson",this).call(this)),{delim:this.value,size:this.size})}},{key:"render",value:function(_context){return new Box(this.value,{type:"middle"})}},{key:"_serialize",value:function(options){if(!options.expandMacro&&!options.skipStyles&&"string"==typeof this.verbatimLatex)return this.verbatimLatex;var def=getDefinition(this.command,this.mode);return(null==def?void 0:def.serialize)?def.serialize(this,options):latexCommand(this.command,this.value)}}],[{key:"fromJson",value:function(json){return new MiddleDelimAtom(json)}}]),MiddleDelimAtom}(Atom),SizedDelimAtom=function(_Atom16){_inherits(SizedDelimAtom,_Atom16);var _super17=_createSuper(SizedDelimAtom);function SizedDelimAtom(options){var _this16;return _classCallCheck(this,SizedDelimAtom),(_this16=_super17.call(this,__spreadProps(__spreadValues({},options),{type:"sizeddelim",value:options.delim}))).delimType=options.delimType,_this16.size=options.size,_this16}return _createClass(SizedDelimAtom,[{key:"toJson",value:function(){return __spreadProps(__spreadValues({},_get(_getPrototypeOf(SizedDelimAtom.prototype),"toJson",this).call(this)),{delim:this.value,size:this.size,delimType:this.delimType})}},{key:"render",value:function(context){var result=function(delim,size,context,options){return void 0===delim||"."===delim?makeNullDelimiter(context,options.classes):("<"===delim||"\\lt"===delim||"⟨"===delim?delim="\\langle":">"!==delim&&"\\gt"!==delim&&"⟩"!==delim||(delim="\\rangle"),stackLargeDelimiters.has(delim)||stackNeverDelimiters.has(delim)?makeLargeDelim(delim,size,!1,context,options):stackAlwaysDelimiters.has(delim)?makeStackedDelim(delim,sizeToMaxHeight[size],!1,context,options):(console.assert(!1,"Unknown delimiter '"+delim+"'"),null))}(this.value,this.size,context,{classes:{open:"mopen",close:"mclose"}[this.delimType],type:this.delimType,isSelected:this.isSelected});return result?(result=this.bind(context,result),this.caret&&(result.caret=this.caret),result):null}},{key:"_serialize",value:function(options){if(!options.expandMacro&&!options.skipStyles&&"string"==typeof this.verbatimLatex)return this.verbatimLatex;var def=getDefinition(this.command,this.mode);return(null==def?void 0:def.serialize)?def.serialize(this,options):latexCommand(this.command,this.value)}}],[{key:"fromJson",value:function(json){return new SizedDelimAtom(json)}}]),SizedDelimAtom}(Atom),EncloseAtom=function(_Atom17){_inherits(EncloseAtom,_Atom17);var _super18=_createSuper(EncloseAtom);function EncloseAtom(command,body,notation,options){var _this17;return _classCallCheck(this,EncloseAtom),(_this17=_super18.call(this,{type:"enclose",command:command,style:options.style})).body=body,_this17.backgroundcolor=options.backgroundcolor,notation.updiagonalarrow&&(notation.updiagonalstrike=!1),notation.box&&(notation.left=!1,notation.right=!1,notation.bottom=!1,notation.top=!1),_this17.notation=notation,_this17.shadow=options.shadow,_this17.strokeWidth=options.strokeWidth,_this17.strokeStyle=options.strokeStyle,_this17.svgStrokeStyle=options.svgStrokeStyle,_this17.strokeColor=options.strokeColor,_this17.borderStyle=options.borderStyle,_this17.padding=options.padding,_this17.captureSelection=!0,_this17}return _createClass(EncloseAtom,[{key:"toJson",value:function(){return __spreadProps(__spreadValues({},_get(_getPrototypeOf(EncloseAtom.prototype),"toJson",this).call(this)),{notation:this.notation,shadow:this.shadow,strokeWidth:this.strokeWidth,strokeStyle:this.strokeStyle,svgStrokeStyle:this.svgStrokeStyle,strokeColor:this.strokeColor,borderStyle:this.borderStyle,padding:this.padding})}},{key:"_serialize",value:function(options){var _a3;if(!options.expandMacro&&!options.skipStyles&&"string"==typeof this.verbatimLatex)return this.verbatimLatex;var def=getDefinition(this.command,this.mode);if(null==def?void 0:def.serialize)return def.serialize(this,options);var command=null!=(_a3=this.command)?_a3:"";if("\\enclose"===this.command){command+="{"+Object.keys(this.notation).join(" ")+"}";var style="",sep="";this.backgroundcolor&&"transparent"!==this.backgroundcolor&&(style+=sep+'mathbackground="'+this.backgroundcolor+'"',sep=","),this.shadow&&"auto"!==this.shadow&&(style+=sep+'shadow="'+this.shadow+'"',sep=","),this.strokeWidth||"solid"!==this.strokeStyle?(style+=sep+this.borderStyle,sep=","):this.strokeColor&&"currentColor"!==this.strokeColor&&(style+=sep+'mathcolor="'+this.strokeColor+'"',sep=","),style&&(command+="[".concat(style,"]"))}return latexCommand(command,this.bodyToLatex(options))}},{key:"render",value:function(parentContext){var _a3,context=new Context({parent:parentContext},this.style),base=Atom.createBox(context,this.body);if(!base)return null;var padding2=context.toEm(this.padding&&"auto"!==this.padding?{string:this.padding}:{register:"fboxsep"}),borderWidth=function(s){if(!s)return"1px";var m=s.match(/([0-9][a-zA-Z\%]+)/);return null===m?"1px":m[1]}(this.borderStyle),notation=new Box(null,{classes:"ML__notation"});notation.setStyle("box-sizing","border-box"),notation.setStyle("left","calc(-".concat(borderWidth," / 2 - ").concat(padding2,"em)")),notation.setStyle("height","calc(".concat(base.height+base.depth+2*padding2,"em)")),notation.height=base.height+padding2,notation.depth=base.depth+padding2,notation.setStyle("width","calc(100% + ".concat(2*padding2,"em + 2 * ").concat(borderWidth,")")),this.backgroundcolor&&notation.setStyle("background-color",null!=(_a3=this.backgroundcolor)?_a3:"transparent"),this.notation.box&&notation.setStyle("border",this.borderStyle),this.notation.actuarial&&(notation.setStyle("border-top",this.borderStyle),notation.setStyle("border-right",this.borderStyle)),this.notation.madruwb&&(notation.setStyle("border-bottom",this.borderStyle),notation.setStyle("border-right",this.borderStyle)),this.notation.roundedbox&&(notation.setStyle("border-radius","8px"),notation.setStyle("border",this.borderStyle)),this.notation.circle&&(notation.setStyle("border-radius","50%"),notation.setStyle("border",this.borderStyle)),this.notation.top&&notation.setStyle("border-top",this.borderStyle),this.notation.left&&notation.setStyle("border-left",this.borderStyle),this.notation.right&&notation.setStyle("border-right",this.borderStyle),this.notation.bottom&&notation.setStyle("border-bottom",this.borderStyle);var svgStyle,svg="";this.notation.horizontalstrike&&(svg+='<line x1="3%"  y1="50%" x2="97%" y2="50%"',svg+=' stroke-width="'.concat(this.strokeWidth,'" stroke="').concat(this.strokeColor,'"'),svg+=' stroke-linecap="round"',this.svgStrokeStyle&&(svg+=' stroke-dasharray="'.concat(this.svgStrokeStyle,'"')),svg+="/>"),this.notation.verticalstrike&&(svg+='<line x1="50%"  y1="3%" x2="50%" y2="97%"',svg+=' stroke-width="'.concat(this.strokeWidth,'" stroke="').concat(this.strokeColor,'"'),svg+=' stroke-linecap="round"',this.svgStrokeStyle&&(svg+=' stroke-dasharray="'.concat(this.svgStrokeStyle,'"')),svg+="/>"),this.notation.updiagonalstrike&&(svg+='<line x1="3%"  y1="97%" x2="97%" y2="3%"',svg+=' stroke-width="'.concat(this.strokeWidth,'" stroke="').concat(this.strokeColor,'"'),svg+=' stroke-linecap="round"',this.svgStrokeStyle&&(svg+=' stroke-dasharray="'.concat(this.svgStrokeStyle,'"')),svg+="/>"),this.notation.downdiagonalstrike&&(svg+='<line x1="3%"  y1="3%" x2="97%" y2="97%"',svg+=' stroke-width="'.concat(this.strokeWidth,'" stroke="').concat(this.strokeColor,'"'),svg+=' stroke-linecap="round"',this.svgStrokeStyle&&(svg+=' stroke-dasharray="'.concat(this.svgStrokeStyle,'"')),svg+="/>"),svg&&("none"!==this.shadow&&(svgStyle="auto"===this.shadow?"filter: drop-shadow(0 0 .5px rgba(255, 255, 255, .7)) drop-shadow(1px 1px 2px #333)":"filter: drop-shadow("+this.shadow+")"),addSVGOverlay(notation,svg,svgStyle));var result=new Box([notation,base]);return result.setStyle("position","relative"),result.setStyle("display","inline"),result.height=base.height+padding2,result.depth=base.depth+padding2,result.left=padding2,result.right=padding2,this.caret&&(result.caret=this.caret),result.wrap(context)}}],[{key:"fromJson",value:function(json){return new EncloseAtom(json.command,json.body,json.notation,json)}}]),EncloseAtom}(Atom),GenfracAtom=function(_Atom18){_inherits(GenfracAtom,_Atom18);var _super19=_createSuper(GenfracAtom);function GenfracAtom(above,below,options){var _this18,_a3,_b3;return _classCallCheck(this,GenfracAtom),(_this18=_super19.call(this,__spreadProps(__spreadValues({},options),{type:"genfrac",displayContainsHighlight:!0}))).above=above,_this18.below=below,_this18.hasBarLine=null==(_a3=null==options?void 0:options.hasBarLine)||_a3,_this18.continuousFraction=null!=(_b3=null==options?void 0:options.continuousFraction)&&_b3,_this18.numerPrefix=null==options?void 0:options.numerPrefix,_this18.denomPrefix=null==options?void 0:options.denomPrefix,_this18.mathstyleName=null==options?void 0:options.mathstyleName,_this18.leftDelim=null==options?void 0:options.leftDelim,_this18.rightDelim=null==options?void 0:options.rightDelim,_this18.fractionNavigationOrder=null==options?void 0:options.fractionNavigationOrder,_this18}return _createClass(GenfracAtom,[{key:"toJson",value:function(){var options={};return this.continuousFraction&&(options.continuousFraction=!0),this.numerPrefix&&(options.numerPrefix=this.numerPrefix),this.denomPrefix&&(options.denomPrefix=this.denomPrefix),this.leftDelim&&(options.leftDelim=this.leftDelim),this.rightDelim&&(options.rightDelim=this.rightDelim),this.hasBarLine||(options.hasBarLine=!1),this.mathstyleName&&(options.mathstyleName=this.mathstyleName),this.fractionNavigationOrder&&(options.fractionNavigationOrder=this.fractionNavigationOrder),__spreadValues(__spreadValues({},_get(_getPrototypeOf(GenfracAtom.prototype),"toJson",this).call(this)),options)}},{key:"children",get:function(){if(this._children)return this._children;var result=[];if("denominator-numerator"===this.fractionNavigationOrder){var _step81,_iterator81=_createForOfIteratorHelper(this.below);try{for(_iterator81.s();!(_step81=_iterator81.n()).done;){var x=_step81.value;result.push.apply(result,_toConsumableArray(x.children)),result.push(x)}}catch(err){_iterator81.e(err)}finally{_iterator81.f()}var _step82,_iterator82=_createForOfIteratorHelper(this.above);try{for(_iterator82.s();!(_step82=_iterator82.n()).done;){var _x=_step82.value;result.push.apply(result,_toConsumableArray(_x.children)),result.push(_x)}}catch(err){_iterator82.e(err)}finally{_iterator82.f()}}else{var _step83,_iterator83=_createForOfIteratorHelper(this.above);try{for(_iterator83.s();!(_step83=_iterator83.n()).done;){var _x2=_step83.value;result.push.apply(result,_toConsumableArray(_x2.children)),result.push(_x2)}}catch(err){_iterator83.e(err)}finally{_iterator83.f()}var _step84,_iterator84=_createForOfIteratorHelper(this.below);try{for(_iterator84.s();!(_step84=_iterator84.n()).done;){var _x3=_step84.value;result.push.apply(result,_toConsumableArray(_x3.children)),result.push(_x3)}}catch(err){_iterator84.e(err)}finally{_iterator84.f()}}return this._children=result,result}},{key:"render",value:function(context){var _a3,_b3,numerShift,denomShift,fracContext=new Context({parent:context,mathstyle:this.mathstyleName},this.style),metrics=fracContext.metrics,numContext=new Context({parent:fracContext,mathstyle:this.continuousFraction?"":"numerator"},this.style),numerBox=this.numerPrefix?new Box([new Box(this.numerPrefix),Atom.createBox(numContext,this.above)],{isTight:numContext.isTight,type:"ignore"}):null!=(_a3=Atom.createBox(numContext,this.above,{type:"ignore"}))?_a3:new Box(null,{type:"ignore"}),denomContext=new Context({parent:fracContext,mathstyle:this.continuousFraction?"":"denominator"},this.style),denomBox=this.denomPrefix?new Box([new Box(this.denomPrefix),Atom.createBox(denomContext,this.below,{type:"ignore"})]):null!=(_b3=Atom.createBox(denomContext,this.below,{type:"ignore"}))?_b3:new Box(null,{type:"ignore"}),ruleWidth=this.hasBarLine?metrics.defaultRuleThickness:0,clearance=0;fracContext.isDisplayStyle?(numerShift=numContext.metrics.num1,clearance=ruleWidth>0?3*ruleWidth:7*ruleWidth,denomShift=denomContext.metrics.denom1):(ruleWidth>0?(numerShift=numContext.metrics.num2,clearance=ruleWidth):(numerShift=numContext.metrics.num3,clearance=3*metrics.defaultRuleThickness),denomShift=denomContext.metrics.denom2);var classes=[];this.isSelected&&classes.push("ML__selected");var frac,numerDepth=numerBox.depth,denomHeight=denomBox.height;if(ruleWidth<=0){var candidateClearance=numerShift-numerDepth-(denomHeight-denomShift);candidateClearance<clearance&&(numerShift+=(clearance-candidateClearance)/2,denomShift+=(clearance-candidateClearance)/2),frac=new VBox({individualShift:[{box:numerBox,shift:-numerShift,classes:[].concat(classes,["ML__center"])},{box:denomBox,shift:denomShift,classes:[].concat(classes,["ML__center"])}]}).wrap(fracContext)}else{var numerLine=.25+ruleWidth/2,denomLine=.25-ruleWidth/2;numerShift<clearance+numerDepth+numerLine&&(numerShift=clearance+numerDepth+numerLine),denomShift<clearance+denomHeight-denomLine&&(denomShift=clearance+denomHeight-denomLine);var fracLine=new Box(null,{classes:"ML__frac-line",mode:this.mode,style:this.style});fracLine.height=ruleWidth/2,fracLine.depth=ruleWidth/2,frac=new VBox({individualShift:[{box:denomBox,shift:denomShift,classes:[].concat(classes,["ML__center"])},{box:fracLine,shift:-denomLine,classes:classes},{box:numerBox,shift:-numerShift,classes:[].concat(classes,["ML__center"])}]}).wrap(fracContext)}var delimSize=fracContext.isDisplayStyle?metrics.delim1:metrics.delim2,leftDelim=this.leftDelim?this.bind(context,makeCustomSizedDelim("open",this.leftDelim,delimSize,!0,context,{style:this.style,mode:this.mode,isSelected:this.isSelected})):makeNullDelimiter(fracContext,"open"),rightDelim=null;rightDelim=this.continuousFraction?new Box(null,{type:"close"}):this.rightDelim?this.bind(context,makeCustomSizedDelim("close",this.rightDelim,delimSize,!0,context,{style:this.style,mode:this.mode,isSelected:this.isSelected})):makeNullDelimiter(fracContext,"close");var result=this.bind(context,new Box([leftDelim,frac,rightDelim],{isTight:fracContext.isTight,type:"inner",classes:"mfrac"}));return result?(this.caret&&(result.caret=this.caret),this.attachSupsub(context,{base:result})):null}}],[{key:"fromJson",value:function(json){return new GenfracAtom(json.above,json.below,json)}}]),GenfracAtom}(Atom),LatexAtom=function(_Atom19){_inherits(LatexAtom,_Atom19);var _super20=_createSuper(LatexAtom);function LatexAtom(value,options){var _this19,_a3;return _classCallCheck(this,LatexAtom),(_this19=_super20.call(this,{type:"latex",value:value,mode:"latex"})).isSuggestion=null!=(_a3=null==options?void 0:options.isSuggestion)&&_a3,_this19.isError=!1,_this19}return _createClass(LatexAtom,[{key:"toJson",value:function(){var options={};return this.isSuggestion&&(options.isSuggestion=!0),this.isError&&(options.isError=!0),__spreadValues({type:"latex",value:this.value},options)}},{key:"computedStyle",get:function(){return{}}},{key:"render",value:function(context){var result=new Box(this.value,{classes:this.isSuggestion?"ML__suggestion":this.isError?"ML__error":"",type:"latex",maxFontSize:1});return result?(this.caret&&(result.caret=this.caret),this.bind(context,result)):null}}],[{key:"fromJson",value:function(json){var result=new LatexAtom(json.value);return json.isSuggestion&&(result.isSuggestion=!0),json.isError&&(result.isError=!0),result}}]),LatexAtom}(Atom),LatexGroupAtom=function(_Atom20){_inherits(LatexGroupAtom,_Atom20);var _super21=_createSuper(LatexGroupAtom);function LatexGroupAtom(latex){var _this20;return _classCallCheck(this,LatexGroupAtom),(_this20=_super21.call(this,{type:"latexgroup",mode:"latex"})).body=_toConsumableArray(latex).map((function(x){return new LatexAtom(x)})),_this20.skipBoundary=!1,_this20}return _createClass(LatexGroupAtom,[{key:"toJson",value:function(){return _get(_getPrototypeOf(LatexGroupAtom.prototype),"toJson",this).call(this)}},{key:"render",value:function(context){var box=Atom.createBox(context,this.body);return box?(this.caret&&(box.caret=this.caret),this.bind(context,box)):null}},{key:"_serialize",value:function(_options){var _a3,_b3;return null!=(_b3=null==(_a3=this.body)?void 0:_a3.map((function(x){return x.value})).join(""))?_b3:""}}],[{key:"fromJson",value:function(_json){return new LatexGroupAtom("")}}]),LatexGroupAtom}(Atom),OperatorAtom=function(_Atom21){_inherits(OperatorAtom,_Atom21);var _super22=_createSuper(OperatorAtom);function OperatorAtom(symbol,options){var _this21,_a3,_b3,_c2;return _classCallCheck(this,OperatorAtom),(_this21=_super22.call(this,__spreadProps(__spreadValues({},options),{type:null!=(_a3=options.type)?_a3:"mop",isFunction:null==options?void 0:options.isFunction}))).value=symbol,_this21.hasArgument=null!=(_b3=options.hasArgument)&&_b3,_this21.variant=null==options?void 0:options.variant,_this21.variantStyle=null==options?void 0:options.variantStyle,_this21.subsupPlacement=null==options?void 0:options.limits,_this21.isExtensibleSymbol=null!=(_c2=null==options?void 0:options.isExtensibleSymbol)&&_c2,_this21}return _createClass(OperatorAtom,[{key:"toJson",value:function(){var result=_get(_getPrototypeOf(OperatorAtom.prototype),"toJson",this).call(this);return this.hasArgument&&(result.hasArgument=!0),this.variant&&(result.variant=this.variant),this.variantStyle&&(result.variantStyle=this.variantStyle),this.subsupPlacement&&(result.limits=this.subsupPlacement),this.isExtensibleSymbol&&(result.isExtensibleSymbol=!0),this.value&&(result.symbol=this.value),result}},{key:"render",value:function(context){var _a3,base,baseShift=0,slant=0;if(this.isExtensibleSymbol){var large=context.isDisplayStyle&&"\\smallint"!==this.value;if(!(base=new Box(this.value,{fontFamily:large?"Size2-Regular":"Size1-Regular",classes:"op-symbol "+(large?"large-op":"small-op"),type:"op",maxFontSize:context.scalingFactor,isSelected:this.isSelected})))return null;base.right=base.italic,baseShift=(base.height-base.depth)/2-.25*context.scalingFactor,slant=base.italic,base.setTop(baseShift)}else console.assert("mop"===this.type),base=new Box(this.value,{type:"op",mode:"math",maxFontSize:context.scalingFactor,style:{variant:this.variant,variantStyle:this.variantStyle},isSelected:this.isSelected,letterShapeStyle:context.letterShapeStyle});var result=base;if(this.superscript||this.subscript){var limits=null!=(_a3=this.subsupPlacement)?_a3:"auto";result="over-under"===limits||"auto"===limits&&context.isDisplayStyle?this.attachLimits(context,{base:base,baseShift:baseShift,slant:slant}):this.attachSupsub(context,{base:base})}return new Box(this.bind(context,result),{type:"op",caret:this.caret,isSelected:this.isSelected,classes:"op-group"}).wrap(context)}},{key:"_serialize",value:function(options){if(!options.expandMacro&&!options.skipStyles&&"string"==typeof this.verbatimLatex)return this.verbatimLatex;var def=getDefinition(this.command,this.mode);if(null==def?void 0:def.serialize)return def.serialize(this,options);if("​"===this.value)return this.supsubToLatex(options);var result=[];return this.hasArgument?result.push(latexCommand(this.command,this.bodyToLatex(options))):result.push(this.command),this.explicitSubsupPlacement&&("over-under"===this.subsupPlacement&&result.push("\\limits"),"adjacent"===this.subsupPlacement&&result.push("\\nolimits"),"auto"===this.subsupPlacement&&result.push("\\displaylimits")),result.push(this.supsubToLatex(options)),joinLatex(result)}}],[{key:"fromJson",value:function(json){return new OperatorAtom(json.symbol,json)}}]),OperatorAtom}(Atom),OverlapAtom=function(_Atom22){_inherits(OverlapAtom,_Atom22);var _super23=_createSuper(OverlapAtom);function OverlapAtom(options){var _this22;_classCallCheck(this,OverlapAtom);var body=options.body;return(_this22=_super23.call(this,__spreadProps(__spreadValues({},options),{type:"overlap",body:"string"==typeof body?[new Atom({value:body})]:body,style:null==options?void 0:options.style}))).skipBoundary=!0,_this22.align=null==options?void 0:options.align,_this22.boxType=null==options?void 0:options.boxType,_this22}return _createClass(OverlapAtom,[{key:"toJson",value:function(){var options={};return this.align&&(options.align=this.align),this.boxType&&(options.boxType=this.boxType),__spreadValues(__spreadValues({},_get(_getPrototypeOf(OverlapAtom.prototype),"toJson",this).call(this)),options)}},{key:"render",value:function(context){var inner=Atom.createBox(context,this.body,{classes:"inner"});return inner?(this.caret&&(inner.caret=this.caret),this.bind(context,new Box([inner,new Box(null,{classes:"fix"})],{classes:"right"===this.align?"rlap":"llap",type:this.boxType}))):null}}],[{key:"fromJson",value:function(json){return new OverlapAtom(json)}}]),OverlapAtom}(Atom),OverunderAtom=function(_Atom23){_inherits(OverunderAtom,_Atom23);var _super24=_createSuper(OverunderAtom);function OverunderAtom(options){var _this23,_a3,_b3,_c2,_d2;return _classCallCheck(this,OverunderAtom),(_this23=_super24.call(this,{type:"overunder",command:options.command,style:options.style,mode:options.mode,body:options.body,skipBoundary:null==(_a3=options.skipBoundary)||_a3})).subsupPlacement=options.supsubPlacement,_this23.svgAbove=options.svgAbove,_this23.svgBelow=options.svgBelow,_this23.svgBody=options.svgBody,_this23.above=options.above,_this23.below=options.below,_this23.boxType=null!=(_b3=options.boxType)?_b3:"ord",_this23.paddedBody=null!=(_c2=options.paddedBody)&&_c2,_this23.paddedLabels=null!=(_d2=options.paddedLabels)&&_d2,_this23}return _createClass(OverunderAtom,[{key:"toJson",value:function(){var json=_get(_getPrototypeOf(OverunderAtom.prototype),"toJson",this).call(this);return this.skipBoundary||(json.skipBoundary=!1),this.subsupPlacement&&(json.subsupPlacement=this.subsupPlacement),this.svgAbove&&(json.svgAbove=this.svgAbove),this.svgBelow&&(json.svgBelow=this.svgBelow),this.svgBody&&(json.svgBody=this.svgBody),"ord"!==this.boxType&&(json.boxType=this.boxType),this.paddedBody&&(json.paddedBody=!0),this.paddedLabels&&(json.paddedLabels=!0),json}},{key:"render",value:function(parentContext){var body=this.svgBody?makeSVGBox(this.svgBody):Atom.createBox(parentContext,this.body,{type:"ignore"}),annotationContext=new Context({parent:parentContext,mathstyle:"scriptstyle"},this.style),above=null;this.svgAbove?above=makeSVGBox(this.svgAbove):this.above&&(above=Atom.createBox(annotationContext,this.above,{type:"ignore"}));var below=null;this.svgBelow?below=makeSVGBox(this.svgBelow):this.below&&(below=Atom.createBox(annotationContext,this.below,{type:"ignore"})),this.paddedBody&&(body=new Box([makeNullDelimiter(parentContext,"open"),body,makeNullDelimiter(parentContext,"close")],{type:"ignore"}));var base=function(context,options){if(!options.base)return null;if(!options.above&&!options.below){var box=new Box(options.base,{type:options.type});return box.setStyle("position","relative"),box}var aboveShift=0;options.above&&(aboveShift=context.metrics.bigOpSpacing5);var result=null,base=options.base,baseShift=0,classes=["ML__center"];if(options.paddedAboveBelow&&classes.push("ML__label_padding"),options.below&&options.above){var bottom=context.metrics.bigOpSpacing5+options.below.height+options.below.depth+base.depth+baseShift;result=new VBox({bottom:bottom,children:[context.metrics.bigOpSpacing5,{box:options.below,classes:classes},{box:base,classes:["ML__center"]},aboveShift,{box:options.above,classes:classes},context.metrics.bigOpSpacing5]})}else options.below?result=new VBox({top:base.height-baseShift,children:[context.metrics.bigOpSpacing5,{box:options.below,classes:classes},{box:base,classes:["ML__center"]}]}):options.above&&(result=new VBox({bottom:base.depth+baseShift,children:[{box:base,classes:["ML__center"]},aboveShift,{box:options.above,classes:classes},context.metrics.bigOpSpacing5]}));return new Box(result,{type:options.type})}(parentContext,{base:body,above:above,below:below,type:"bin"===this.boxType||"rel"===this.boxType?this.boxType:"ord",paddedAboveBelow:this.paddedLabels});return base?(base="over-under"===this.subsupPlacement?this.attachLimits(parentContext,{base:base,type:base.type}):this.attachSupsub(parentContext,{base:base}),this.caret&&(base.caret=this.caret),this.bind(parentContext,base)):null}}],[{key:"fromJson",value:function(json){return new OverunderAtom(json)}}]),OverunderAtom}(Atom),PhantomAtom=function(_Atom24){_inherits(PhantomAtom,_Atom24);var _super25=_createSuper(PhantomAtom);function PhantomAtom(options){var _this24,_a3,_b3,_c2,_d2;return _classCallCheck(this,PhantomAtom),(_this24=_super25.call(this,__spreadProps(__spreadValues({},options),{type:"phantom"}))).captureSelection=!0,_this24.isInvisible=null!=(_a3=options.isInvisible)&&_a3,_this24.smashDepth=null!=(_b3=options.smashDepth)&&_b3,_this24.smashHeight=null!=(_c2=options.smashHeight)&&_c2,_this24.smashWidth=null!=(_d2=options.smashWidth)&&_d2,_this24}return _createClass(PhantomAtom,[{key:"toJson",value:function(){var options={};return this.isInvisible&&(options.isInvisible=!0),this.smashDepth&&(options.smashDepth=!0),this.smashHeight&&(options.smashHeight=!0),this.smashWidth&&(options.smashWidth=!0),__spreadValues(__spreadValues({},_get(_getPrototypeOf(PhantomAtom.prototype),"toJson",this).call(this)),options)}},{key:"render",value:function(context){var phantom=new Context({parent:context,isPhantom:!0});if(!this.smashDepth&&!this.smashHeight&&!this.smashWidth)return console.assert(this.isInvisible),Atom.createBox(phantom,this.body,{classes:"inner"});var content=Atom.createBox(this.isInvisible?phantom:context,this.body);if(!content)return null;if(this.smashWidth){var fix=new Box(null,{classes:"fix"});return new Box([content,fix],{classes:"rlap"}).wrap(context)}if(!this.smashHeight&&!this.smashDepth)return content;if(this.smashHeight&&(content.height=0),this.smashDepth&&(content.depth=0),content.children){var _step85,_iterator85=_createForOfIteratorHelper(content.children);try{for(_iterator85.s();!(_step85=_iterator85.n()).done;){var box=_step85.value;this.smashHeight&&(box.height=0),this.smashDepth&&(box.depth=0)}}catch(err){_iterator85.e(err)}finally{_iterator85.f()}}return new VBox({firstBaseline:[{box:content}]},{type:content.type}).wrap(context)}}],[{key:"fromJson",value:function(json){return new PhantomAtom(json)}}]),PhantomAtom}(Atom),SpacingAtom=function(_Atom25){_inherits(SpacingAtom,_Atom25);var _super26=_createSuper(SpacingAtom);function SpacingAtom(options){var _this25,_a3;return _classCallCheck(this,SpacingAtom),(_this25=_super26.call(this,__spreadValues({type:"spacing"},options))).width=null==options?void 0:options.width,_this25._braced=null!=(_a3=null==options?void 0:options.braced)&&_a3,_this25}return _createClass(SpacingAtom,[{key:"toJson",value:function(){var json=_get(_getPrototypeOf(SpacingAtom.prototype),"toJson",this).call(this);return void 0!==this.width&&(json.width=this.width),this._braced&&(json.braced=!0),json}},{key:"render",value:function(context){var _a3,result;if("space"===this.command)return new Box("math"===this.mode?null:" ");if(void 0!==this.width)(result=new Box(null,{classes:"mspace"})).left=context.toEm(this.width);else{var spacingCls=null!=(_a3={"\\qquad":"qquad","\\quad":"quad","\\enspace":"enspace","\\;":"thickspace","\\:":"mediumspace","\\,":"thinspace","\\!":"negativethinspace"}[this.command])?_a3:"mediumspace";result=new Box(null,{classes:spacingCls})}return result=this.bind(context,result),this.caret&&(result.caret=this.caret),result}},{key:"_serialize",value:function(options){var _a3;if(!options.expandMacro&&"string"==typeof this.verbatimLatex)return this.verbatimLatex;var def=getDefinition(this.command,this.mode);if(null==def?void 0:def.serialize)return def.serialize(this,options);var command=null!=(_a3=this.command)?_a3:"";return void 0===this.width?command:this._braced&&!("register"in this.width)?"".concat(command,"{").concat(serializeLatexValue(this.width),"}"):"".concat(command).concat(serializeLatexValue(this.width))}}],[{key:"fromJson",value:function(json){return new SpacingAtom(json)}}]),SpacingAtom}(Atom),SurdAtom=function(_Atom26){_inherits(SurdAtom,_Atom26);var _super27=_createSuper(SurdAtom);function SurdAtom(options){var _this26,_a3;return _classCallCheck(this,SurdAtom),(_this26=_super27.call(this,__spreadProps(__spreadValues({},options),{type:"surd",mode:null!=(_a3=options.mode)?_a3:"math",style:options.style,displayContainsHighlight:!0,body:options.body}))).above=options.index,_this26}return _createClass(SurdAtom,[{key:"_serialize",value:function(options){if(!options.expandMacro&&!options.skipStyles&&"string"==typeof this.verbatimLatex)return this.verbatimLatex;var def=getDefinition(this.command,this.mode);if(null==def?void 0:def.serialize)return def.serialize(this,options);var command=this.command,body=this.bodyToLatex(options);return this.above&&!this.hasEmptyBranch("above")?latexCommand("".concat(command,"[").concat(this.aboveToLatex(options),"]"),body):/^[0-9]$/.test(body)?"".concat(command).concat(body):latexCommand(command,body)}},{key:"render",value:function(context){var _a3,innerContext=new Context({parent:context,mathstyle:"cramp"},this.style),innerBox=null!=(_a3=Atom.createBox(innerContext,this.body,{type:"inner"}))?_a3:new Box(null),factor=innerContext.scalingFactor,ruleWidth=innerContext.metrics.defaultRuleThickness/factor,phi=context.isDisplayStyle?.431:ruleWidth,line=new Box(null,{classes:"ML__sqrt-line",style:this.style,height:ruleWidth}),lineClearance=factor*(ruleWidth+phi/4),minDelimiterHeight=Math.max(2*factor*phi,innerBox.height+innerBox.depth)+lineClearance+ruleWidth,delimContext=new Context({parent:context},this.style),delimBox=this.bind(delimContext,new Box(makeCustomSizedDelim("inner","\\surd",minDelimiterHeight,!1,delimContext,{isSelected:this.isSelected}),{isSelected:this.isSelected,classes:"ML__sqrt-sign",style:this.style}));if(!delimBox)return null;var delimDepth=delimBox.height+delimBox.depth-ruleWidth;delimDepth>innerBox.height+innerBox.depth+lineClearance&&(lineClearance=(lineClearance+delimDepth-(innerBox.height+innerBox.depth))/2),delimBox.setTop(delimBox.height-innerBox.height-lineClearance);var bodyBox=this.bind(context,new VBox({firstBaseline:[{box:new Box(innerBox)},lineClearance-2*ruleWidth,{box:line},ruleWidth]})),indexBox=Atom.createBox(new Context({parent:context,mathstyle:"scriptscriptstyle"}),this.above,{type:"ignore"});if(!indexBox){var result2=new Box([delimBox,bodyBox],{classes:this.containsCaret?"ML__contains-caret":"",type:"inner"});return result2.setStyle("display","inline-block"),result2.setStyle("height",result2.height+result2.depth,"em"),this.caret&&(result2.caret=this.caret),this.bind(context,result2)}var indexStack=new VBox({shift:-.6*(Math.max(delimBox.height,bodyBox.height)-Math.max(delimBox.depth,bodyBox.depth)),children:[{box:indexBox}]}),result=new Box([new Box(indexStack,{classes:"ML__sqrt-index",type:"ignore"}),delimBox,bodyBox],{type:"inner",classes:this.containsCaret?"ML__contains-caret":""});return result.height=delimBox.height,result.depth=delimBox.depth,this.caret&&(result.caret=this.caret),this.bind(context,result)}}],[{key:"fromJson",value:function(json){return new SurdAtom(__spreadProps(__spreadValues({},json),{index:json.above}))}}]),SurdAtom}(Atom),SkipBox=function(_Box2){_inherits(SkipBox,_Box2);var _super28=_createSuper(SkipBox);function SkipBox(width){return _classCallCheck(this,SkipBox),_super28.call(this,null,{type:"skip",width:width})}return _createClass(SkipBox,[{key:"toMarkup",value:function(){return'<span style="display:inline-block;width:'.concat(Math.round(100*this.width)/100,'em"></span>')}}]),SkipBox}(Box);function addSkipBefore(box,width){if(box.parent){for(var siblings=box.parent.children,i=siblings.indexOf(box),j=i-1;j>=0&&"ignore"===siblings[j].type;)j-=1;j<0&&box.parent.parent&&"lift"===box.parent.type?addSkipBefore(box.parent,width):i>0&&"skip"===siblings[i-1].type?siblings[i-1].width+=width:siblings.splice(i,0,new SkipBox(width))}}var INTER_BOX_SPACING={ord:{op:3,bin:4,rel:5,inner:3},op:{ord:3,op:3,rel:5,inner:3},bin:{ord:4,op:4,open:4,inner:4},rel:{ord:5,op:5,open:5,inner:5},close:{op:3,bin:4,rel:5,inner:3},punct:{ord:3,op:3,rel:3,open:3,punct:3,inner:3},inner:{ord:3,op:3,bin:4,rel:5,open:3,punct:3,inner:3}},INTER_BOX_TIGHT_SPACING={ord:{op:3},op:{ord:3,op:3},close:{op:3},inner:{op:3}};function applyInterBoxSpacing(root,context){if(!root.children)return root;var boxes=root.children;!function(boxes){traverseBoxes(boxes,(function(prev,cur){"bin"!==cur.type||prev&&!/^(middle|bin|op|rel|open|punct)$/.test(prev.type)||(cur.type="ord"),"bin"===(null==prev?void 0:prev.type)&&/^(rel|close|punct)$/.test(cur.type)&&(prev.type="ord"),"ignore"!==cur.type&&(prev=cur)}))}(boxes);var thin=context.getRegisterAsEm("thinmuskip"),med=context.getRegisterAsEm("medmuskip"),thick=context.getRegisterAsEm("thickmuskip");return traverseBoxes(boxes,(function(prev,cur){var _a3,_b3,_c2;if(prev){var prevType=prev.type,table=cur.isTight?null!=(_a3=INTER_BOX_TIGHT_SPACING[prevType])?_a3:null:null!=(_b3=INTER_BOX_SPACING[prevType])?_b3:null,hskip=null!=(_c2=null==table?void 0:table[cur.type])?_c2:null;3===hskip&&addSkipBefore(cur,thin),4===hskip&&addSkipBefore(cur,med),5===hskip&&addSkipBefore(cur,thick)}})),root}function traverseBoxes(boxes,f){var prev=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;if(!boxes)return prev;var _step86,_iterator86=_createForOfIteratorHelper(boxes=_toConsumableArray(boxes));try{for(_iterator86.s();!(_step86=_iterator86.n()).done;){var cur=_step86.value;"lift"===cur.type?prev=traverseBoxes(cur.children,f,prev):"ignore"===cur.type?traverseBoxes(cur.children,f):(f(prev,cur),traverseBoxes(cur.children,f),prev=cur)}}catch(err){_iterator86.e(err)}finally{_iterator86.f()}return prev}var TooltipAtom=function(_Atom27){_inherits(TooltipAtom,_Atom27);var _super29=_createSuper(TooltipAtom);function TooltipAtom(options){var _this27;return _classCallCheck(this,TooltipAtom),(_this27=_super29.call(this,{type:"tooltip",command:options.command,mode:options.mode,style:options.style,body:options.body,displayContainsHighlight:!0})).tooltip=new Atom({type:"root",mode:options.content,body:options.tooltip,style:{}}),_this27.skipBoundary=!0,_this27.captureSelection=!1,_this27}return _createClass(TooltipAtom,[{key:"toJson",value:function(){var _a3,tooltip=null==(_a3=this.tooltip.body)?void 0:_a3.filter((function(x){return"first"!==x.type})).map((function(x){return x.toJson()}));return __spreadProps(__spreadValues({},_get(_getPrototypeOf(TooltipAtom.prototype),"toJson",this).call(this)),{tooltip:tooltip})}},{key:"render",value:function(context){var body=Atom.createBox(new Context,this.body);if(!body)return null;var tooltipContext=new Context({parent:context,mathstyle:"displaystyle"},{fontSize:5}),tooltip=coalesce(applyInterBoxSpacing(new Box(this.tooltip.render(tooltipContext),{classes:"ML__tooltip-content"}),tooltipContext)),box=new Box([tooltip,body],{classes:"ML__tooltip-container"});return this.caret&&(box.caret=this.caret),this.bind(context,box)}}],[{key:"fromJson",value:function(json){return new TooltipAtom(__spreadProps(__spreadValues({},json),{tooltip:_fromJson(json.tooltip)}))}}]),TooltipAtom}(Atom);function _fromJson(json){if(isArray(json))return json.map((function(x){return _fromJson(x)}));if("string"==typeof json)return Atom.fromJson(json);json=__spreadValues({},json);var _step87,_iterator87=_createForOfIteratorHelper(NAMED_BRANCHES);try{for(_iterator87.s();!(_step87=_iterator87.n()).done;){var branch=_step87.value;json[branch]&&(json[branch]=_fromJson(json[branch]))}}catch(err){_iterator87.e(err)}finally{_iterator87.f()}json.args&&(json.args=function(json){return json&&Array.isArray(json)?json.map((function(arg){return"<null>"===arg?null:"object"===_typeof(arg)&&"group"in arg?{group:arg.group.map((function(x){return _fromJson(x)}))}:"object"===_typeof(arg)&&"atoms"in arg?arg.atoms.map((function(x){return _fromJson(x)})):arg})):void 0}(json.args)),json.array&&(json.array=_fromJson(json.array));var type=json.type,result=void 0;"accent"===type&&(result=AccentAtom.fromJson(json)),"array"===type&&(result=ArrayAtom.fromJson(json)),"box"===type&&(result=BoxAtom.fromJson(json)),"chem"===type&&(result=ChemAtom.fromJson(json)),"composition"===type&&(result=CompositionAtom.fromJson(json)),"delim"===type&&(result=MiddleDelimAtom.fromJson(json)),"enclose"===type&&(result=EncloseAtom.fromJson(json)),"error"===type&&(result=ErrorAtom.fromJson(json)),"genfrac"===type&&(result=GenfracAtom.fromJson(json)),"group"===type&&(result=GroupAtom.fromJson(json)),"latex"===type&&(result=LatexAtom.fromJson(json)),"latexgroup"===type&&(result=LatexGroupAtom.fromJson(json)),"leftright"===type&&(result=LeftRightAtom.fromJson(json)),"macro"===type&&(result=MacroAtom.fromJson(json)),"macro-argument"===type&&(result=MacroArgumentAtom.fromJson(json)),"subsup"===type&&(result=SubsupAtom.fromJson(json)),"overlap"===type&&(result=OverlapAtom.fromJson(json)),"overunder"===type&&(result=OverunderAtom.fromJson(json)),"placeholder"===type&&(result=PlaceholderAtom.fromJson(json)),"prompt"===type&&(result=PromptAtom.fromJson(json)),"phantom"===type&&(result=PhantomAtom.fromJson(json)),"sizeddelim"===type&&(result=SizedDelimAtom.fromJson(json)),"spacing"===type&&(result=SpacingAtom.fromJson(json)),"surd"===type&&(result=SurdAtom.fromJson(json)),"text"===type&&(result=TextAtom.fromJson(json)),"tooltip"===type&&(result=TooltipAtom.fromJson(json)),"mop"===type&&(result=OperatorAtom.fromJson(json)),result||(console.assert(!type||["first","mbin","mrel","mclose","minner","mopen","mord","mpunct","root","space"].includes(type),'MathLive 0.94.6: an unexpected atom type "'.concat(type,'" was encountered. Add new atom constructors to `fromJson()` in "atom.ts"')),result=Atom.fromJson(json));var _step88,_iterator88=_createForOfIteratorHelper(NAMED_BRANCHES);try{for(_iterator88.s();!(_step88=_iterator88.n()).done;){var _branch=_step88.value;json[_branch]&&result.setChildren(json[_branch],_branch)}}catch(err){_iterator88.e(err)}finally{_iterator88.f()}return void 0!==json.verbatimLatex&&(result.verbatimLatex=json.verbatimLatex),json.subsupPlacement&&(result.subsupPlacement=json.subsupPlacement),json.explicitSubsupPlacement&&(result.explicitSubsupPlacement=!0),json.isFunction&&(result.isFunction=!0),json.isExtensibleSymbol&&(result.isExtensibleSymbol=!0),json.skipBoundary&&(result.skipBoundary=!0),json.captureSelection&&(result.captureSelection=!0),result}var VARIANTS={main:["Main-Regular","ML__cmr"],"main-italic":["Main-Italic","ML__cmr ML__it"],"main-bold":["Main-Bold","ML__cmr ML__bold"],"main-bolditalic":["Main-BoldItalic","ML__cmr ML__bold ML__it"],normal:["Main-Regular","ML__cmr"],"normal-bold":["Main-Bold","ML__mathbf"],"normal-italic":["Math-Italic","ML__mathit"],"normal-bolditalic":["Math-BoldItalic","ML__mathbfit"],ams:["AMS-Regular","ML__ams"],"ams-bold":["AMS-Regular","ML__ams"],"ams-italic":["AMS-Regular","ML__ams"],"ams-bolditalic":["AMS-Regular","ML__ams"],"sans-serif":["SansSerif-Regular","ML__sans"],"sans-serif-bold":["SansSerif-Regular","ML__sans ML__bold"],"sans-serif-italic":["SansSerif-Regular","ML__sans"],"sans-serif-bolditalic":["SansSerif-Regular","ML__sans"],calligraphic:["Caligraphic-Regular","ML__cal"],"calligraphic-bold":["Caligraphic-Regular","ML__cal ML__bold"],"calligraphic-italic":["Caligraphic-Regular","ML__cal ML__it"],"calligraphic-bolditalic":["Caligraphic-Regular","ML__cal ML__bold ML__it"],script:["Script-Regular","ML__script"],"script-bold":["Script-Regular","ML__script ML__bold"],"script-italic":["Script-Regular","ML__script ML__it"],"script-bolditalic":["Script-Regular","ML__script ML__bold ML__it"],fraktur:["Fraktur-Regular","ML__frak"],"fraktur-bold":["Fraktur-Regular","ML__frak"],"fraktur-italic":["Fraktur-Regular","ML__frak"],"fraktur-bolditalic":["Fraktur-Regular","ML__frak"],monospace:["Typewriter-Regular","ML__tt"],"monospace-bold":["Typewriter-Regular","ML__tt ML__bold"],"monospace-italic":["Typewriter-Regular","ML__tt ML__it"],"monospace-bolditalic":["Typewriter-Regular","ML__tt ML__bold ML__it"],"double-struck":["AMS-Regular","ML__bb"],"double-struck-bold":["AMS-Regular","ML__bb"],"double-struck-italic":["AMS-Regular","ML__bb"],"double-struck-bolditalic":["AMS-Regular","ML__bb"]},VARIANT_REPERTOIRE={"double-struck":/^[A-Z ]$/,script:/^[A-Z ]$/,calligraphic:/^[\dA-Z ]$/,fraktur:/^[\dA-Za-z ]$|^[!"#$%&'()*+,\-./:;=?[]^’‘]$/,monospace:/^[\dA-Za-z ]$|^[!"&'()*+,\-./:;=?@[\]^_~\u0131\u0237\u0393\u0394\u0398\u039B\u039E\u03A0\u03A3\u03A5\u03A8\u03A9]$/,"sans-serif":/^[\dA-Za-z ]$|^[!"&'()*+,\-./:;=?@[\]^_~\u0131\u0237\u0393\u0394\u0398\u039B\u039E\u03A0\u03A3\u03A5\u03A8\u03A9]$/},GREEK_LOWERCASE=/^[\u03B1-\u03C9]|\u03D1|\u03D5|\u03D6|\u03F1|\u03F5]$/,LETTER_SHAPE_RANGES=[/^[a-z]$/,/^[A-Z]$/,GREEK_LOWERCASE,/^[\u0393|\u0394\u0398\u039B\u039E\u03A0\u03A3\u03A5\u03A6\u03A8\u03A9]$/],LETTER_SHAPE_MODIFIER={iso:["it","it","it","it"],tex:["it","it","it","up"],french:["it","up","up","up"],upright:["up","up","up","up"]};function variantString(atom){if(!atom)return"";var style=atom.style;if(void 0===style.variant)return"";var result=style.variant;return style.variantStyle&&"up"!==style.variantStyle&&(result+="-"+style.variantStyle),result}function emitFontSeriesTextRun(run,options){return getPropertyRuns(run,"fontSeries").map((function(x){var s=function(run,options){return getPropertyRuns(run,"fontShape").map((function(x){var s=function(run,options){return run.map((function(x){return x._serialize(options)}))}(x,options),fontShape=x[0].style.fontShape,command="";return"it"===fontShape&&(command="\\textit"),"sl"===fontShape&&(command="\\textsl"),"sc"===fontShape&&(command="\\textsc"),"n"===fontShape&&(command="\\textup"),!command&&fontShape?"{".concat(latexCommand("\\fontshape",fontShape)).concat(joinLatex(s),"}"):command?latexCommand(command,joinLatex(s)):joinLatex(s)}))}(x,options),fontSeries=x[0].style.fontSeries,command="";return"b"===fontSeries&&(command="\\textbf"),"l"===fontSeries&&(command="\\textlf"),"m"===fontSeries&&(command="\\textmd"),fontSeries&&!command?"{".concat(latexCommand("\\fontseries",fontSeries)).concat(joinLatex(s),"}"):command?latexCommand(command,joinLatex(s)):joinLatex(s)}))}function emitFontFamilyTextRun(run,options){return getPropertyRuns(run,"fontFamily").map((function(x){var _a3,_b3,s=function(run,options){return getPropertyRuns(run,"fontSize").map((function(x){var _a3,_b3,s=emitFontSeriesTextRun(x,options),command=null!=(_b3=["","\\tiny","\\scriptsize","\\footnotesize","\\small","\\normalsize","\\large","\\Large","\\LARGE","\\huge","\\Huge"][null!=(_a3=x[0].style.fontSize)?_a3:""])?_b3:"";return command?"".concat(command," ").concat(joinLatex(s)):joinLatex(s)}))}(x,options),command=null!=(_b3={roman:"textrm",monospace:"texttt","sans-serif":"textsf"}[null!=(_a3=x[0].style.fontFamily)?_a3:""])?_b3:"";return command?"\\".concat(command,"{").concat(joinLatex(s),"}"):x[0].style.fontFamily?"{\\fontfamily{".concat(x[0].style.fontFamily,"} ").concat(joinLatex(s),"}"):joinLatex(s)}))}new(function(_Mode2){_inherits(MathMode,_Mode2);var _super30=_createSuper(MathMode);function MathMode(){return _classCallCheck(this,MathMode),_super30.call(this,"math")}return _createClass(MathMode,[{key:"createAtom",value:function(command,info,style){var _a3,_b3,_c2,_d2,_e;if(null===info)return new Atom({type:"mord",mode:"math",command:command,value:command,style:style});if("symbol"===info.definitionType){var result2=new Atom({type:null!=(_a3=info.type)?_a3:"mord",mode:"math",command:null!=(_b3=info.command)?_b3:command,value:String.fromCodePoint(info.codepoint),style:style});return null!=(_c2=info.isFunction)&&_c2&&(result2.isFunction=!0),command.startsWith("\\")&&(result2.verbatimLatex=command),result2}var result=new Atom({type:"mord",mode:"math",command:null!=(_d2=info.command)?_d2:command,value:command,style:style});return null!=(_e=info.isFunction)&&_e&&(result.isFunction=!0),command.startsWith("\\")&&(result.verbatimLatex=command),result}},{key:"serialize",value:function(run,options){var result=function(run,options){var contextVariant=variantString(run[0].parent);return getPropertyRuns(run,"variant").map((function(x){var variant=variantString(x[0]),command="";variant&&variant!==contextVariant&&(command={calligraphic:"\\mathcal",fraktur:"\\mathfrak","double-struck":"\\mathbb",script:"\\mathscr",monospace:"\\mathtt","sans-serif":"\\mathsf",normal:"\\mathrm","normal-italic":"\\mathnormal","normal-bold":"\\mathbf","normal-bolditalic":"\\mathbfit",ams:"","ams-italic":"\\mathit","ams-bold":"\\mathbf","ams-bolditalic":"\\mathbfit",main:"","main-italic":"\\mathit","main-bold":"\\mathbf","main-bolditalic":"\\mathbfit"}[variant],console.assert(void 0!==command));var arg=joinLatex(x.map((function(x2){return x2._serialize(options)})));return command?latexCommand(command,arg):arg}))}(run,__spreadProps(__spreadValues({},options),{defaultMode:"math"}));return 0===result.length||"text"!==options.defaultMode?result:["$ "].concat(_toConsumableArray(result),[" $"])}},{key:"getFont",value:function(box,style){console.assert(void 0!==style.variant);var variant=style.variant,variantStyle=style.variantStyle;"normal"===variant&&!variantStyle&&/[\u00A3\u0131\u0237]/.test(box.value)&&(variant="main",variantStyle="italic"),"normal"!==variant||variantStyle||1!==box.value.length||LETTER_SHAPE_RANGES.forEach((function(x,i){var _a3;x.test(box.value)&&"it"===LETTER_SHAPE_MODIFIER[null!=(_a3=style.letterShapeStyle)?_a3:"tex"][i]&&(variantStyle="italic")})),"up"===variantStyle&&(variantStyle=void 0);var styledVariant=variantStyle?variant+"-"+variantStyle:variant;console.assert(void 0!==VARIANTS[styledVariant]);var _VARIANTS$styledVaria=_slicedToArray(VARIANTS[styledVariant],2),fontName=_VARIANTS$styledVaria[0],classes=_VARIANTS$styledVaria[1];return VARIANT_REPERTOIRE[variant]&&!VARIANT_REPERTOIRE[variant].test(box.value)?(box.value=function(char,variant,style){if(!/[A-Za-z\d]/.test(char))return char;if(!variant&&!style)return char;var codepoint=char.codePointAt(0);if(void 0===codepoint)return char;var _step4,_iterator4=_createForOfIteratorHelper(MATH_UNICODE_BLOCKS);try{for(_iterator4.s();!(_step4=_iterator4.n()).done;){var MATH_UNICODE_BLOCK=_step4.value;if((!variant||MATH_UNICODE_BLOCK.variant===variant)&&(!style||MATH_UNICODE_BLOCK.style===style)&&codepoint>=MATH_UNICODE_BLOCK.offset&&codepoint<MATH_UNICODE_BLOCK.offset+MATH_UNICODE_BLOCK.len){var result=MATH_UNICODE_BLOCK.start+codepoint-MATH_UNICODE_BLOCK.offset;return String.fromCodePoint(MATH_LETTER_EXCEPTIONS[result]||result)}}}catch(err){_iterator4.e(err)}finally{_iterator4.f()}return char}(box.value,variant,variantStyle),null):(GREEK_LOWERCASE.test(box.value)&&(box.classes+=" lcGreek"),classes&&(box.classes+=" "+classes),fontName)}}]),MathMode}(Mode));var TEXT_FONT_CLASS={roman:"","sans-serif":"ML__sans",monospace:"ML__tt"};function keystrokeModifiersFromString(key){var segments=key.split("+"),result={shift:!1,alt:!1,cmd:!1,win:!1,meta:!1,ctrl:!1,key:segments.pop()};return segments.includes("shift")&&(result.shift=!0),segments.includes("alt")&&(result.alt=!0),segments.includes("ctrl")&&(result.ctrl=!0),segments.includes("cmd")&&(result.cmd=!0),segments.includes("win")&&(result.win=!0),segments.includes("meta")&&(result.meta=!0),result}function keystrokeModifiersToString(key){var result="";return key.shift&&(result+="shift+"),key.alt&&(result+="alt+"),key.ctrl&&(result+="ctrl+"),key.cmd&&(result+="cmd+"),key.win&&(result+="win+"),key.meta&&(result+="meta+"),result+key.key}new(function(_Mode3){_inherits(TextMode,_Mode3);var _super31=_createSuper(TextMode);function TextMode(){return _classCallCheck(this,TextMode),_super31.call(this,"text")}return _createClass(TextMode,[{key:"createAtom",value:function(command,info,style){return info&&"symbol"===info.definitionType?new TextAtom(command,String.fromCodePoint(info.codepoint),null!=style?style:{}):null}},{key:"serialize",value:function(run,options){var result=emitFontFamilyTextRun(run,__spreadProps(__spreadValues({},options),{defaultMode:"text"}));return 0===result.length||"text"===options.defaultMode?result:["\\text{"].concat(_toConsumableArray(result),["}"])}},{key:"getFont",value:function(box,style){var _a3,_b3,_c2,_d2,_e,fontFamily=style.fontFamily;if(TEXT_FONT_CLASS[fontFamily]?box.classes+=" "+TEXT_FONT_CLASS[fontFamily]:fontFamily&&box.setStyle("font-family",fontFamily),style.fontShape&&(box.classes+=" ",box.classes+=null!=(_a3={it:"ML__it",sl:"ML__shape_sl",sc:"ML__shape_sc",ol:"ML__shape_ol"}[style.fontShape])?_a3:""),style.fontSeries){var m=style.fontSeries.match(/(.?[lbm])?(.?[cx])?/);m&&(box.classes+=" ",box.classes+=null!=(_c2={ul:"ML__series_ul",el:"ML__series_el",l:"ML__series_l",sl:"ML__series_sl",m:"",sb:"ML__series_sb",b:"ML__bold",eb:"ML__series_eb",ub:"ML__series_ub"}[null!=(_b3=m[1])?_b3:""])?_c2:"",box.classes+=" ",box.classes+=null!=(_e={uc:"ML__series_uc",ec:"ML__series_ec",c:"ML__series_c",sc:"ML__series_sc",n:"",sx:"ML__series_sx",x:"ML__series_x",ex:"ML__series_ex",ux:"ML__series_ux"}[null!=(_d2=m[2])?_d2:""])?_e:"")}return"Main-Regular"}}]),TextMode}(Mode)),new(function(_Mode4){_inherits(LatexMode,_Mode4);var _super32=_createSuper(LatexMode);function LatexMode(){return _classCallCheck(this,LatexMode),_super32.call(this,"latex")}return _createClass(LatexMode,[{key:"createAtom",value:function(command){return new LatexAtom(command)}},{key:"serialize",value:function(run,_options){return run.filter((function(x){return x instanceof LatexAtom&&!x.isSuggestion})).map((function(x){return x.value}))}},{key:"getFont",value:function(){return null}}]),LatexMode}(Mode));var gKeyboardLayout,DEFAULT_KEYBOARD_LAYOUT="apple"===platform()?{id:"apple.en-intl",displayName:"English (international)",virtualLayout:"qwerty",platform:"apple",locale:"en",score:0,mapping:{KeyA:["a","A","å","Å"],KeyB:["b","B","∫","ı"],KeyC:["c","C","ç","Ç"],KeyD:["d","D","∂","Î"],KeyE:["e","E","´","´"],KeyF:["f","F","ƒ","Ï"],KeyG:["g","G","©","˝"],KeyH:["h","H","˙","Ó"],KeyI:["i","I","ˆ","ˆ"],KeyJ:["j","J","∆","Ô"],KeyK:["k","K","˚",""],KeyL:["l","L","¬","Ò"],KeyM:["m","M","µ","Â"],KeyN:["n","N","˜","˜"],KeyO:["o","O","ø","Ø"],KeyP:["p","P","π","∏"],KeyQ:["q","Q","œ","Œ"],KeyR:["r","R","®","‰"],KeyS:["s","S","ß","Í"],KeyT:["t","T","†","ˇ"],KeyU:["u","U","¨","¨"],KeyV:["v","V","√","◊"],KeyW:["w","W","∑","„"],KeyX:["x","X","≈","˛"],KeyY:["y","Y","¥","Á"],KeyZ:["z","Z","Ω","¸"],Digit1:["1","!","¡","⁄"],Digit2:["2","@","™","€"],Digit3:["3","#","£","‹"],Digit4:["4","$","¢","›"],Digit5:["5","%","∞","ﬁ"],Digit6:["6","^","§","ﬂ"],Digit7:["7","&","¶","‡"],Digit8:["8","*","•","°"],Digit9:["9","(","ª","·"],Digit0:["0",")","º","‚"],Space:[" "," "," "," "],Minus:["-","_","–","—"],Equal:["=","+","≠","±"],BracketLeft:["[","{","“","”"],BracketRight:["]","}","‘","’"],Backslash:["\\","|","«","»"],Semicolon:[";",":","…","Ú"],Quote:["'",'"',"æ","Æ"],Backquote:["`","˜","`","`"],Comma:[",","<","≤","¯"],Period:[".",">","≥","˘"],Slash:["/","?","÷","¿"],NumpadDivide:["/","/","/","/"],NumpadMultiply:["*","*","*","*"],NumpadSubtract:["-","-","-","-"],NumpadAdd:["+","+","+","+"],Numpad1:["1","1","1","1"],Numpad2:["2","2","2","2"],Numpad3:["3","3","3","3"],Numpad4:["4","4","4","4"],Numpad5:["5","5","5","5"],Numpad6:["6","6","6","6"],Numpad7:["7","7","7","7"],Numpad8:["8","8","8","8"],Numpad9:["9","9","9","9"],Numpad0:["0","0","0","0"],NumpadDecimal:[".",".",".","."],IntlBackslash:["§","±","§","±"],NumpadEqual:["=","=","=","="],AudioVolumeUp:["","=","","="]}}:"windows"===platform()?{id:"windows.en-intl",displayName:"English (international)",platform:"windows",virtualLayout:"qwerty",locale:"en",score:0,mapping:{KeyA:["a","A","á","Á"],KeyB:["b","B","",""],KeyC:["c","C","©","¢"],KeyD:["d","D","ð","Ð"],KeyE:["e","E","é","É"],KeyF:["f","F","",""],KeyG:["g","G","",""],KeyH:["h","H","",""],KeyI:["i","I","í","Í"],KeyJ:["j","J","",""],KeyK:["k","K","",""],KeyL:["l","L","ø","Ø"],KeyM:["m","M","µ",""],KeyN:["n","N","ñ","Ñ"],KeyO:["o","O","ó","Ó"],KeyP:["p","P","ö","Ö"],KeyQ:["q","Q","ä","Ä"],KeyR:["r","R","®",""],KeyS:["s","S","ß","§"],KeyT:["t","T","þ","Þ"],KeyU:["u","U","ú","Ú"],KeyV:["v","V","",""],KeyW:["w","W","å","Å"],KeyX:["x","X","",""],KeyY:["y","Y","ü","Ü"],KeyZ:["z","Z","æ","Æ"],Digit1:["1","!","¡","¹"],Digit2:["2","@","²",""],Digit3:["3","#","³",""],Digit4:["4","$","¤","£"],Digit5:["5","%","€",""],Digit6:["6","^","¼",""],Digit7:["7","&","½",""],Digit8:["8","*","¾",""],Digit9:["9","(","‘",""],Digit0:["0",")","’",""],Space:[" "," ","",""],Minus:["-","_","¥",""],Equal:["=","+","×","÷"],BracketLeft:["[","{","«",""],BracketRight:["]","}","»",""],Backslash:["\\","|","¬","¦"],Semicolon:[";",":","¶","°"],Quote:["'",'"',"´","¨"],Backquote:["`","~","",""],Comma:[",","<","ç","Ç"],Period:[".",">","",""],Slash:["/","?","¿",""],NumpadDivide:["/","/","",""],NumpadMultiply:["*","*","",""],NumpadSubtract:["-","-","",""],NumpadAdd:["+","+","",""],IntlBackslash:["\\","|","",""]}}:{id:"linux.en",displayName:"English",platform:"linux",virtualLayout:"qwerty",locale:"en",score:0,mapping:{KeyA:["a","A","a","A"],KeyB:["b","B","b","B"],KeyC:["c","C","c","C"],KeyD:["d","D","d","D"],KeyE:["e","E","e","E"],KeyF:["f","F","f","F"],KeyG:["g","G","g","G"],KeyH:["h","H","h","H"],KeyI:["i","I","i","I"],KeyJ:["j","J","j","J"],KeyK:["k","K","k","K"],KeyL:["l","L","l","L"],KeyM:["m","M","m","M"],KeyN:["n","N","n","N"],KeyO:["o","O","o","O"],KeyP:["p","P","p","P"],KeyQ:["q","Q","q","Q"],KeyR:["r","R","r","R"],KeyS:["s","S","s","S"],KeyT:["t","T","t","T"],KeyU:["u","U","u","U"],KeyV:["v","V","v","V"],KeyW:["w","W","w","W"],KeyX:["x","X","x","X"],KeyY:["y","Y","y","Y"],KeyZ:["z","Z","z","Z"],Digit1:["1","!","1","!"],Digit2:["2","@","2","@"],Digit3:["3","#","3","#"],Digit4:["4","$","4","$"],Digit5:["5","%","5","%"],Digit6:["6","^","6","^"],Digit7:["7","&","7","&"],Digit8:["8","*","8","*"],Digit9:["9","(","9","("],Digit0:["0",")","0",")"],Space:[" "," "," "," "],Minus:["-","_","-","_"],Equal:["=","+","=","+"],BracketLeft:["[","{","[","{"],BracketRight:["]","}","]","}"],Backslash:["\\","|","\\","|"],Semicolon:[";",":",";",":"],Quote:["'",'"',"'",'"'],Backquote:["`","~","`","~"],Comma:[",","<",",","<"],Period:[".",">",".",">"],Slash:["/","?","/","?"],NumpadDivide:["/","/","/","/"],NumpadMultiply:["*","*","*","*"],NumpadSubtract:["-","-","-","-"],NumpadAdd:["+","+","+","+"],Numpad1:["1","1","1","1"],Numpad2:["2","2","2","2"],Numpad3:["3","3","3","3"],Numpad4:["4","4","4","4"],Numpad5:["5","5","5","5"],Numpad6:["6","6","6","6"],Numpad7:["7","7","7","7"],Numpad8:["8","8","8","8"],Numpad9:["9","9","9","9"],Numpad0:["0","0","0","0"],NumpadDecimal:["",".","","."],IntlBackslash:["<",">","|","¦"],NumpadEqual:["=","=","=","="],NumpadComma:[".",".",".","."],NumpadParenLeft:["(","(","(","("],NumpadParenRight:[")",")",")",")"]}},BASE_LAYOUT_MAPPING={enter:"[Enter]",escape:"[Escape]",backspace:"[Backspace]",tab:"[Tab]",space:"[Space]",pausebreak:"[Pause]",insert:"[Insert]",home:"[Home]",pageup:"[PageUp]",delete:"[Delete]",end:"[End]",pagedown:"[PageDown]",right:"[ArrowRight]",left:"[ArrowLeft]",down:"[ArrowDown]",up:"[ArrowUp]",numpad0:"[Numpad0]",numpad1:"[Numpad1]",numpad2:"[Numpad2]",numpad3:"[Numpad3]",numpad4:"[Numpad4]",numpad5:"[Numpad5]",numpad6:"[Numpad6]",numpad7:"[Numpad7]",numpad8:"[Numpad8]",numpad9:"[Numpad9]",numpad_divide:"[NumpadDivide]",numpad_multiply:"[NumpadMultiply]",numpad_subtract:"[NumpadSubtract]",numpad_add:"[NumpadAdd]",numpad_decimal:"[NumpadDecimal]",numpad_separator:"[NumpadComma]",capslock:"[Capslock]",f1:"[F1]",f2:"[F2]",f3:"[F3]",f4:"[F4]",f5:"[F5]",f6:"[F6]",f7:"[F7]",f8:"[F8]",f9:"[F9]",f10:"[F10]",f11:"[F11]",f12:"[F12]",f13:"[F13]",f14:"[F14]",f15:"[F15]",f16:"[F16]",f17:"[F17]",f18:"[F18]",f19:"[F19]"},gKeyboardLayouts=[];function platform(){switch(osPlatform()){case"macos":case"ios":return"apple";case"windows":return"windows"}return"linux"}function register(layout){layout.platform&&layout.platform!==platform()||gKeyboardLayouts.push(layout)}function getActiveKeyboardLayout(){return null!=gKeyboardLayout?gKeyboardLayout:gKeyboardLayouts[0]}function commandToString(command){var result=command;return isArray(result)&&(result=result.length>0?result[0]+"("+result.slice(1).join("")+")":""),result}function getKeybindingsForCommand(keybindings,command){var result=[];if("string"==typeof command){var candidate=REVERSE_KEYBINDINGS[command];isArray(candidate)?result=candidate.slice():candidate&&result.push(candidate)}var _step91,normalizedCommand=commandToString(command),regex=new RegExp("^"+normalizedCommand.replace("\\","\\\\").replace("|","\\|").replace("*","\\*").replace("$","\\$").replace("^","\\^")+"([^*a-zA-Z]|$)"),_iterator91=_createForOfIteratorHelper(keybindings);try{for(_iterator91.s();!(_step91=_iterator91.n()).done;){var keybinding=_step91.value;regex.test(commandToString(keybinding.command))&&result.push(keybinding.key)}}catch(err){_iterator91.e(err)}finally{_iterator91.f()}return result.map(getKeybindingMarkup)}function getKeybindingMarkup(keystroke){var _a3,_step92,useSymbol=/macos|ios|/.test(osPlatform()),result="",_iterator92=_createForOfIteratorHelper(keystroke.split("+"));try{for(_iterator92.s();!(_step92=_iterator92.n()).done;){var segment=_step92.value;!useSymbol&&result&&(result+='<span class="ML__shortcut-join">+</span>'),segment.startsWith("[Key")?result+=segment.slice(4,5):segment.startsWith("Key")?result+=segment.slice(3,4):segment.startsWith("[Digit")?result+=segment.slice(6,7):segment.startsWith("Digit")?result+=segment.slice(5,6):result+=null!=(_a3={cmd:"⌘",meta:useSymbol?"⌘":"command",shift:useSymbol?"⇧":"shift",alt:useSymbol?"⌥":"alt",ctrl:useSymbol?"⌃":"control","\n":useSymbol?"⏎":"return","[return]":useSymbol?"⏎":"return","[enter]":useSymbol?"⌤":"enter","[tab]":useSymbol?"⇥":"tab","[escape]":"esc","[backspace]":useSymbol?"⌫":"backspace","[delete]":useSymbol?"⌦":"del","[pageup]":useSymbol?"⇞":"page up","[pagedown]":useSymbol?"⇟":"page down","[home]":useSymbol?"⤒":"home","[end]":useSymbol?"⤓":"end","[space]":"space","[equal]":"=","[minus]":"-","[comma]":",","[slash]":"/","[backslash]":"\\","[bracketleft]":"[","[bracketright]":"]",semicolon:";",period:".",comma:",",minus:"-",equal:"=",quote:"'",bracketLeft:"[",bracketRight:"]",backslash:"\\",intlbackslash:"\\",backquote:"`",slash:"/",numpadmultiply:"* &#128290;",numpaddivide:"/ &#128290;",numpadsubtract:"- &#128290;",numpadadd:"+ &#128290;",numpaddecimal:". &#128290;",numpadcomma:", &#128290;",help:"help",left:"⇠",up:"⇡",right:"⇢",down:"⇣","[arrowleft]":"⇠","[arrowup]":"⇡","[arrowright]":"⇢","[arrowdown]":"⇣","[digit0]":"0","[digit1]":"1","[digit2]":"2","[digit3]":"3","[digit4]":"4","[digit5]":"5","[digit6]":"6","[digit7]":"7","[digit8]":"8","[digit9]":"9"}[segment.toLowerCase()])?_a3:segment.toUpperCase()}}catch(err){_iterator92.e(err)}finally{_iterator92.f()}return result}function normalizeKeybinding(keybinding,layout){if(keybinding.ifPlatform&&!/^!?(macos|windows|android|ios|chromeos|other)$/.test(keybinding.ifPlatform))throw new Error('Unexpected platform "'.concat(keybinding.ifPlatform,'" for keybinding ').concat(keybinding.key));if(void 0===keybinding.ifLayout||0!==layout.score&&keybinding.ifLayout.includes(layout.id)){var modifiers=keystrokeModifiersFromString(keybinding.key),platform2=keybinding.ifPlatform;if(modifiers.cmd){if(platform2&&"macos"!==platform2&&"ios"!==platform2)throw new Error('Unexpected "cmd" modifier with platform "'+platform2+'"\n"cmd" modifier can only be used with macOS or iOS platform.');platform2||(platform2="ios"===osPlatform()?"ios":"macos"),modifiers.win=!1,modifiers.cmd=!1,modifiers.meta=!0}if(modifiers.win){if(platform2&&"windows"!==platform2)throw new Error('Unexpected "win" modifier with platform "'+platform2+'"\n"win" modifier can only be used with Windows platform.');platform2="windows",modifiers.win=!1,modifiers.cmd=!1,modifiers.meta=!0}if(!platform2||function(p){if(isBrowser()){var plat=osPlatform(),isNeg=p.startsWith("!"),isMatch=p.endsWith(plat);if(isNeg&&!isMatch)return!0;if(!isNeg&&isMatch)return!0}return"!other"!==p&&"other"===p}(platform2)){if(/^\[.+\]$/.test(modifiers.key))return __spreadProps(__spreadValues({},keybinding),{ifPlatform:platform2,key:keystrokeModifiersToString(modifiers)});var code=function(k,layout){var _a3,result={shift:!1,alt:!1,cmd:!1,win:!1,meta:!1,ctrl:!1,key:""};if(!k)return result;for(var _i17=0,_Object$entries=Object.entries(layout.mapping);_i17<_Object$entries.length;_i17++){var _Object$entries$_i=_slicedToArray(_Object$entries[_i17],2),key=_Object$entries$_i[0],value=_Object$entries$_i[1];if(value[0]===k)return result.key="[".concat(key,"]"),result;if(value[1]===k)return result.shift=!0,result.key="[".concat(key,"]"),result;if(value[2]===k)return result.alt=!0,result.key="[".concat(key,"]"),result;if(value[3]===k)return result.shift=!0,result.alt=!0,result.key="[".concat(key,"]"),result}return result.key=null!=(_a3=BASE_LAYOUT_MAPPING[k])?_a3:"",result}(modifiers.key,layout);if(!code)throw new Error('Invalid keybinding key "'+keybinding.key+'"');if(code.shift&&modifiers.shift||code.alt&&modifiers.alt)throw new Error("The keybinding ".concat(keybinding.key," (").concat(selectorToString(keybinding.command),") is conflicting with the key combination ").concat(keystrokeModifiersToString(code)," using the ").concat(layout.displayName," keyboard layout"));return code.shift=code.shift||modifiers.shift,code.alt=code.alt||modifiers.alt,code.meta=modifiers.meta,code.ctrl=modifiers.ctrl,__spreadProps(__spreadValues({},keybinding),{ifPlatform:platform2,key:keystrokeModifiersToString(code)})}}}function selectorToString(selector){if(Array.isArray(selector)){var sel=_toConsumableArray(selector);return sel.shift()+"("+sel.map((function(x){return"string"==typeof x?'"'.concat(x,'"'):x.toString()})).join(", ")+")"}return selector}function makeProxy(mf){return{value:mf.model.getValue(),selectionIsCollapsed:mf.model.selectionIsCollapsed,canUndo:mf.canUndo(),canRedo:mf.canRedo(),style:mf.selectionStyle,mode:mf.model.mode}}function selectionDidChange(model){window.mathVirtualKeyboard.visible&&window.mathVirtualKeyboard.update(makeProxy(model.mathfield)),model.silenceNotifications||(model.silenceNotifications=!0,model.listeners.onSelectionDidChange(),model.silenceNotifications=!1)}function contentWillChange(model){var options=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(model.silenceNotifications)return!0;model.silenceNotifications=!0;var result=model.listeners.onContentWillChange(options);return model.silenceNotifications=!1,result}function contentDidChange(model,options){var _a3;window.mathVirtualKeyboard.visible&&window.mathVirtualKeyboard.update(makeProxy(model.mathfield)),!model.silenceNotifications&&model.mathfield.host&&(model.silenceNotifications=!0,model.mathfield.host.dispatchEvent(new InputEvent("input",__spreadProps(__spreadValues({},options),{data:options.data?options.data:null!=(_a3=options.inputType)?_a3:"",bubbles:!0,composed:!0}))),model.silenceNotifications=!1)}function getLatexGroup(model){return model.atoms.find((function(x){return"latexgroup"===x.type}))}function getLatexGroupBody(model){var _a3,_b3,atom=model.atoms.find((function(x){return"latexgroup"===x.type}));return atom&&null!=(_b3=null==(_a3=atom.body)?void 0:_a3.filter((function(x){return"latex"===x.type})))?_b3:[]}function getCommandSuggestionRange(model,options){for(var _a3,start=0,found=!1,last=Number.isFinite(null==options?void 0:options.before)?null!=(_a3=null==options?void 0:options.before)?_a3:0:model.lastOffset;start<=last&&!found;){var atom=model.at(start);(found=atom instanceof LatexAtom&&atom.isSuggestion)||start++}if(!found)return[void 0,void 0];for(var end=start,done=!1;end<=last&&!done;){var _atom3=model.at(end);(done=!(_atom3 instanceof LatexAtom&&_atom3.isSuggestion))||end++}return[start-1,end-1]}function removeSuggestion(mathfield){var group=getLatexGroupBody(mathfield.model).filter((function(x){return x.isSuggestion}));if(0!==group.length){mathfield.model.position=mathfield.model.offsetOf(group[0].leftSibling);var _step95,_iterator95=_createForOfIteratorHelper(group);try{for(_iterator95.s();!(_step95=_iterator95.n()).done;){var atom=_step95.value;atom.parent.removeChild(atom)}}catch(err){_iterator95.e(err)}finally{_iterator95.f()}}}function updateAutocomplete(mathfield,options){var _a3,model=mathfield.model;removeSuggestion(mathfield);var _step96,_iterator96=_createForOfIteratorHelper(getLatexGroupBody(model));try{for(_iterator96.s();!(_step96=_iterator96.n()).done;)_step96.value.isError=!1}catch(err){_iterator96.e(err)}finally{_iterator96.f()}if(model.selectionIsCollapsed&&"off"!==mathfield.options.popoverPolicy){for(var commandAtoms=[],atom=model.at(model.position);atom&&atom instanceof LatexAtom&&/^[a-zA-Z\*]$/.test(atom.value);)atom=atom.leftSibling;if(atom&&atom instanceof LatexAtom&&"\\"===atom.value)for(commandAtoms.push(atom),atom=atom.rightSibling;atom&&atom instanceof LatexAtom&&/^[a-zA-Z\*]$/.test(atom.value);)commandAtoms.push(atom),atom=atom.rightSibling;var command=commandAtoms.map((function(x){return x.value})).join(""),suggestions=function(mf,s){var _a3,_b3;if(0===s.length||"\\"===s||!s.startsWith("\\"))return[];var result=[];for(var p in LATEX_COMMANDS)p.startsWith(s)&&!LATEX_COMMANDS[p].infix&&result.push({match:p,frequency:null!=(_a3=LATEX_COMMANDS[p].frequency)?_a3:0});for(var _p2 in MATH_SYMBOLS)_p2.startsWith(s)&&result.push({match:_p2,frequency:null!=(_b3=MATH_SYMBOLS[_p2].frequency)?_b3:0});for(var command=s.substring(1),_i3=0,_Object$keys2=Object.keys(mf.options.macros);_i3<_Object$keys2.length;_i3++){var _p3=_Object$keys2[_i3];_p3.startsWith(command)&&result.push({match:"\\"+_p3,frequency:0})}return result.sort((function(a,b){var _a4,_b4;return a.frequency===b.frequency?a.match.length===b.match.length?a.match<b.match?-1:1:a.match.length-b.match.length:(null!=(_a4=b.frequency)?_a4:0)-(null!=(_b4=a.frequency)?_b4:0)})),result.map((function(x){return x.match}))}(mathfield,command);if(0!==suggestions.length){var index=null!=(_a3=null==options?void 0:options.atIndex)?_a3:0;mathfield.suggestionIndex=index<0?suggestions.length-1:index%suggestions.length;var suggestion=suggestions[mathfield.suggestionIndex];if(suggestion!==command){var lastAtom=commandAtoms[commandAtoms.length-1];lastAtom.parent.addChildrenAfter(_toConsumableArray(suggestion.slice(command.length-suggestion.length)).map((function(x){return new LatexAtom(x,{isSuggestion:!0})})),lastAtom),render(mathfield,{interactive:!0})}!function(mf,suggestions){var _a3;if(0!==suggestions.length){var _step99,template="",_iterator99=_createForOfIteratorHelper(suggestions.entries());try{for(_iterator99.s();!(_step99=_iterator99.n()).done;){var _step99$value=_slicedToArray(_step99.value,2),i=_step99$value[0],suggestion=_step99$value[1],command=suggestion,commandMarkup=latexToMarkup(mf,suggestion),keybinding=getKeybindingsForCommand(mf.keybindings,command).join("<br>");template+='<li role="button" data-command="'.concat(command,'" ').concat(i===mf.suggestionIndex?"class=ML__popover__current":"",'><span class="ML__popover__latex">').concat(command,'</span><span class="ML__popover__command">').concat(commandMarkup,"</span>"),keybinding&&(template+='<span class="ML__popover__keybinding">'.concat(keybinding,"</span>")),template+="</li>"}}catch(err){_iterator99.e(err)}finally{_iterator99.f()}var panel=function(mf,html){var panel=document.getElementById("mathlive-suggestion-popover");return panel||(panel=getSharedElement("mathlive-suggestion-popover"),injectStylesheet("suggestion-popover"),injectStylesheet("core"),panel.addEventListener("pointerdown",(function(ev){return ev.preventDefault()})),panel.addEventListener("click",(function(ev){for(var el=ev.target;el&&!el.dataset.command;)el=el.parentElement;el&&(complete(mf,"reject"),ModeEditor.insert(mf.model,el.dataset.command,{selectionMode:"placeholder",format:"latex",mode:"math"}),mf.dirty=!0,mf.focus())}))),panel.innerHTML=window.MathfieldElement.createHTML(html),panel}(mf,"<ul>".concat(template,"</ul>"));isSuggestionPopoverVisible()&&(null==(_a3=panel.querySelector(".ML__popover__current"))||_a3.scrollIntoView({block:"nearest",inline:"nearest"})),setTimeout((function(){var _a4;panel&&!isSuggestionPopoverVisible()&&(panel.classList.add("is-visible"),updateSuggestionPopoverPosition(mf),null==(_a4=panel.querySelector(".ML__popover__current"))||_a4.scrollIntoView({block:"nearest",inline:"nearest"}))}),32)}else hideSuggestionPopover(mf)}(mathfield,suggestions)}else{if(/^\\[a-zA-Z\*]+$/.test(command)){var _step97,_iterator97=_createForOfIteratorHelper(commandAtoms);try{for(_iterator97.s();!(_step97=_iterator97.n()).done;)_step97.value.isError=!0}catch(err){_iterator97.e(err)}finally{_iterator97.f()}}hideSuggestionPopover(mathfield)}}else hideSuggestionPopover(mathfield)}function acceptCommandSuggestion(model){var _getCommandSuggestion2=_slicedToArray(getCommandSuggestionRange(model,{before:model.position}),2),from=_getCommandSuggestion2[0],to=_getCommandSuggestion2[1];if(void 0===from||void 0===to)return!1;var result=!1;return model.getAtoms([from,to]).forEach((function(x){x.isSuggestion&&(x.isSuggestion=!1,result=!0)})),result}function complete(mathfield){var _a3,_b3,completion=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"accept",options=arguments.length>2?arguments[2]:void 0;hideSuggestionPopover(mathfield);var latexGroup=getLatexGroup(mathfield.model);if(!latexGroup)return!1;if("accept-suggestion"===completion){var suggestions=getLatexGroupBody(mathfield.model).filter((function(x){return x.isSuggestion}));if(0===suggestions.length)return!1;var _step98,_iterator98=_createForOfIteratorHelper(suggestions);try{for(_iterator98.s();!(_step98=_iterator98.n()).done;){var suggestion=_step98.value;suggestion.isSuggestion=!1}}catch(err){_iterator98.e(err)}finally{_iterator98.f()}return mathfield.model.position=mathfield.model.offsetOf(suggestions[suggestions.length-1]),!0}var body=getLatexGroupBody(mathfield.model).filter((function(x){return!x.isSuggestion})),latex=body.map((function(x){return x.value})).join(""),newPos=latexGroup.leftSibling;return latexGroup.parent.removeChild(latexGroup),mathfield.model.position=mathfield.model.offsetOf(newPos),mathfield.model.mode=null!=(_a3=null==options?void 0:options.mode)?_a3:"math","reject"===completion||(ModeEditor.insert(mathfield.model,latex,{selectionMode:null!=(_b3=null==options?void 0:options.selectItem)&&_b3?"item":"placeholder",format:"latex",mode:"math"}),mathfield.snapshot(),mathfield.model.announce("replacement")),!0}function getSharedElement(id){var _a3,result=document.getElementById(id);return result?result.dataset.refcount=Number(Number.parseInt(null!=(_a3=result.dataset.refcount)?_a3:"0")+1).toString():((result=document.createElement("div")).setAttribute("aria-hidden","true"),result.dataset.refcount="1",result.id=id,document.body.append(result)),result}function releaseSharedElement(id){var _a3,element=document.getElementById(id);if(element){var refcount=Number.parseInt(null!=(_a3=element.getAttribute("data-refcount"))?_a3:"0");refcount<=1?element.remove():element.dataset.refcount=Number(refcount-1).toString()}}function latexToMarkup(mf,latex){var context=new Context({from:mf.context}),root=new Atom({mode:"math",type:"root",body:parseLatex(latex,{context:context})});return makeStruts(coalesce(applyInterBoxSpacing(new Box(root.render(context),{classes:"ML__base"}),context)),{classes:"ML__mathlive"}).toMarkup()}function isSuggestionPopoverVisible(){var panel=document.getElementById("mathlive-suggestion-popover");return!!panel&&panel.classList.contains("is-visible")}function updateSuggestionPopoverPosition(mf,options){var _a3;if(mf.element&&mf.element.mathfield===mf&&isSuggestionPopoverVisible())if("latex"===(null==(_a3=mf.model.at(mf.model.position))?void 0:_a3.type))if(null==options?void 0:options.deferred)setTimeout((function(){return updateSuggestionPopoverPosition(mf)}),32);else{var position=_getCaretPoint(mf.field);if(position){var viewportHeight=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,viewportWidth=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,scrollbarWidth=window.innerWidth-document.documentElement.clientWidth,scrollbarHeight=window.innerHeight-document.documentElement.clientHeight,virtualkeyboardHeight=window.mathVirtualKeyboard.boundingRect.height,panel=document.getElementById("mathlive-suggestion-popover");position.x+panel.offsetWidth/2>viewportWidth-scrollbarWidth?panel.style.left="".concat(viewportWidth-panel.offsetWidth-scrollbarWidth,"px"):position.x-panel.offsetWidth/2<0?panel.style.left="0":panel.style.left="".concat(position.x-panel.offsetWidth/2,"px");var spaceAbove=position.y-position.height;viewportHeight-scrollbarHeight-virtualkeyboardHeight-position.y<spaceAbove?(panel.classList.add("ML__popover--reverse-direction"),panel.classList.remove("top-tip"),panel.classList.add("bottom-tip"),panel.style.top="".concat(position.y-position.height-panel.offsetHeight-15,"px")):(panel.classList.remove("ML__popover--reverse-direction"),panel.classList.add("top-tip"),panel.classList.remove("bottom-tip"),panel.style.top="".concat(position.y+15,"px"))}}else hideSuggestionPopover(mf)}function hideSuggestionPopover(mf){mf.suggestionIndex=0;var panel=document.getElementById("mathlive-suggestion-popover");panel&&(panel.classList.remove("is-visible"),panel.innerHTML="")}register(DEFAULT_KEYBOARD_LAYOUT),register({id:"apple.french",locale:"fr",displayName:"French",platform:"apple",virtualLayout:"azerty",score:0,mapping:{KeyA:["q","Q","‡","Ω"],KeyB:["b","B","ß","∫"],KeyC:["c","C","©","¢"],KeyD:["d","D","∂","∆"],KeyE:["e","E","ê","Ê"],KeyF:["f","F","ƒ","·"],KeyG:["g","G","ﬁ","ﬂ"],KeyH:["h","H","Ì","Î"],KeyI:["i","I","î","ï"],KeyJ:["j","J","Ï","Í"],KeyK:["k","K","È","Ë"],KeyL:["l","L","¬","|"],KeyM:[",","?","∞","¿"],KeyN:["n","N","~","ı"],KeyO:["o","O","œ","Œ"],KeyP:["p","P","π","∏"],KeyQ:["a","A","æ","Æ"],KeyR:["r","R","®","‚"],KeyS:["s","S","Ò","∑"],KeyT:["t","T","†","™"],KeyU:["u","U","º","ª"],KeyV:["v","V","◊","√"],KeyW:["z","Z","Â","Å"],KeyX:["x","X","≈","⁄"],KeyY:["y","Y","Ú","Ÿ"],KeyZ:["w","W","‹","›"],Digit1:["&","1","","´"],Digit2:["é","2","ë","„"],Digit3:['"',"3","“","”"],Digit4:["'","4","‘","’"],Digit5:["(","5","{","["],Digit6:["§","6","¶","å"],Digit7:["è","7","«","»"],Digit8:["!","8","¡","Û"],Digit9:["ç","9","Ç","Á"],Digit0:["à","0","ø","Ø"],Space:[" "," "," "," "],Minus:[")","°","}","]"],Equal:["-","_","—","–"],BracketLeft:["^","¨","ô","Ô"],BracketRight:["$","*","€","¥"],Backslash:["`","£","@","#"],Semicolon:["m","M","µ","Ó"],Quote:["ù","%","Ù","‰"],Backquote:["<",">","≤","≥"],Comma:[";",".","…","•"],Period:[":","/","÷","\\"],Slash:["=","+","≠","±"],NumpadDivide:["/","/","/","/"],NumpadMultiply:["*","*","*","*"],NumpadSubtract:["-","-","-","-"],NumpadAdd:["+","+","+","+"],NumpadDecimal:[",",".",",","."],IntlBackslash:["@","#","•","Ÿ"],NumpadEqual:["=","=","=","="]}}),register({id:"apple.spanish",locale:"es",displayName:"Spanish ISO",platform:"apple",virtualLayout:"qwerty",score:0,mapping:{KeyA:["a","A","å","Å"],KeyB:["b","B","ß",""],KeyC:["c","C","©"," "],KeyD:["d","D","∂","∆"],KeyE:["e","E","€","€"],KeyF:["f","F","ƒ","ﬁ"],KeyG:["g","G","","ﬂ"],KeyH:["h","H","™"," "],KeyI:["i","I"," "," "],KeyJ:["j","J","¶","¯"],KeyK:["k","K","§","ˇ"],KeyL:["l","L"," ","˘"],KeyM:["m","M","µ","˚"],KeyN:["n","N"," ","˙"],KeyO:["o","O","ø","Ø"],KeyP:["p","P","π","∏"],KeyQ:["q","Q","œ","Œ"],KeyR:["r","R","®"," "],KeyS:["s","S","∫"," "],KeyT:["t","T","†","‡"],KeyU:["u","U"," "," "],KeyV:["v","V","√","◊"],KeyW:["w","W","æ","Æ"],KeyX:["x","X","∑","›"],KeyY:["y","Y","¥"," "],KeyZ:["z","Z","Ω","‹"],Digit1:["1","!","|","ı"],Digit2:["2",'"',"@","˝"],Digit3:["3","·","#","•"],Digit4:["4","$","¢","£"],Digit5:["5","%","∞","‰"],Digit6:["6","&","¬"," "],Digit7:["7","/","÷","⁄"],Digit8:["8","(","“","‘"],Digit9:["9",")","”","’"],Digit0:["0","=","≠","≈"],Space:[" "," "," "," "],Minus:["'","?","´","¸"],Equal:["¡","¿","‚","˛"],BracketLeft:["`","^","[","ˆ"],BracketRight:["+","*","]","±"],Backslash:["ç","Ç","}","»"],Semicolon:["ñ","Ñ","~","˜"],Quote:["´","¨","{","«"],Backquote:["<",">","≤","≥"],Comma:[",",";","„",""],Period:[".",":","…","…"],Slash:["-","_","–","—"],NumpadDivide:["/","/","/","/"],NumpadMultiply:["*","*","*","*"],NumpadSubtract:["-","-","-","-"],NumpadAdd:["+","+","+","+"],Numpad1:["1","1","1","1"],Numpad2:["2","2","2","2"],Numpad3:["3","3","3","3"],Numpad4:["4","4","4","4"],Numpad5:["5","5","5","5"],Numpad6:["6","6","6","6"],Numpad7:["7","7","7","7"],Numpad8:["8","8","8","8"],Numpad9:["9","9","9","9"],Numpad0:["0","0","0","0"],NumpadDecimal:[",",",",",",","],IntlBackslash:["º","ª","\\","°"]}}),register({id:"windows.spanish",locale:"es",displayName:"Spanish",platform:"windows",virtualLayout:"qwerty",score:0,mapping:{KeyA:["a","A","",""],KeyB:["b","B","",""],KeyC:["c","C","",""],KeyD:["d","D","",""],KeyE:["e","E","€",""],KeyF:["f","F","",""],KeyG:["g","G","",""],KeyH:["h","H","",""],KeyI:["i","I","",""],KeyJ:["j","J","",""],KeyK:["k","K","",""],KeyL:["l","L","",""],KeyM:["m","M","",""],KeyN:["n","N","",""],KeyO:["o","O","",""],KeyP:["p","P","",""],KeyQ:["q","Q","",""],KeyR:["r","R","",""],KeyS:["s","S","",""],KeyT:["t","T","",""],KeyU:["u","U","",""],KeyV:["v","V","",""],KeyW:["w","W","",""],KeyX:["x","X","",""],KeyY:["y","Y","",""],KeyZ:["z","Z","",""],Digit1:["1","!","|",""],Digit2:["2",'"',"@",""],Digit3:["3","·","#",""],Digit4:["4","$","~",""],Digit5:["5","%","€",""],Digit6:["6","&","¬",""],Digit7:["7","/","",""],Digit8:["8","(","",""],Digit9:["9",")","",""],Digit0:["0","=","",""],Space:[" "," ","",""],Minus:["'","?","",""],Equal:["¡","¿","",""],BracketLeft:["`","^","[",""],BracketRight:["+","*","]",""],Backslash:["ç","Ç","}",""],Semicolon:["ñ","Ñ","",""],Quote:["´","¨","{",""],Backquote:["º","ª","\\",""],Comma:[",",";","",""],Period:[".",":","",""],Slash:["-","_","",""],NumpadDivide:["/","/","",""],NumpadMultiply:["*","*","",""],NumpadSubtract:["-","-","",""],NumpadAdd:["+","+","",""],IntlBackslash:["<",">","",""]}}),register({id:"linux.spanish",locale:"es",displayName:"Spanish",platform:"linux",virtualLayout:"qwerty",score:0,mapping:{KeyA:["a","A","æ","Æ"],KeyB:["b","B","”","’"],KeyC:["c","C","¢","©"],KeyD:["d","D","ð","Ð"],KeyE:["e","E","€","¢"],KeyF:["f","F","đ","ª"],KeyG:["g","G","ŋ","Ŋ"],KeyH:["h","H","ħ","Ħ"],KeyI:["i","I","→","ı"],KeyJ:["j","J","̉","̛"],KeyK:["k","K","ĸ","&"],KeyL:["l","L","ł","Ł"],KeyM:["m","M","µ","º"],KeyN:["n","N","n","N"],KeyO:["o","O","ø","Ø"],KeyP:["p","P","þ","Þ"],KeyQ:["q","Q","@","Ω"],KeyR:["r","R","¶","®"],KeyS:["s","S","ß","§"],KeyT:["t","T","ŧ","Ŧ"],KeyU:["u","U","↓","↑"],KeyV:["v","V","“","‘"],KeyW:["w","W","ł","Ł"],KeyX:["x","X","»",">"],KeyY:["y","Y","←","¥"],KeyZ:["z","Z","«","<"],Digit1:["1","!","|","¡"],Digit2:["2",'"',"@","⅛"],Digit3:["3","·","#","£"],Digit4:["4","$","~","$"],Digit5:["5","%","½","⅜"],Digit6:["6","&","¬","⅝"],Digit7:["7","/","{","⅞"],Digit8:["8","(","[","™"],Digit9:["9",")","]","±"],Digit0:["0","=","}","°"],Enter:["\r","\r","\r","\r"],Escape:["","","",""],Backspace:["\b","\b","\b","\b"],Tab:["\t","","\t",""],Space:[" "," "," "," "],Minus:["'","?","\\","¿"],Equal:["¡","¿","̃","~"],BracketLeft:["̀","̂","[","̊"],BracketRight:["+","*","]","̄"],Backslash:["ç","Ç","}","̆"],Semicolon:["ñ","Ñ","~","̋"],Quote:["́","̈","{","{"],Backquote:["º","ª","\\","\\"],Comma:[",",";","─","×"],Period:[".",":","·","÷"],Slash:["-","_","̣","̇"],NumpadDivide:["/","/","/","/"],NumpadMultiply:["*","*","*","*"],NumpadSubtract:["-","-","-","-"],NumpadAdd:["+","+","+","+"],NumpadEnter:["\r","\r","\r","\r"],Numpad1:["","1","","1"],Numpad2:["","2","","2"],Numpad3:["","3","","3"],Numpad4:["","4","","4"],Numpad5:["","5","","5"],Numpad6:["","6","","6"],Numpad7:["","7","","7"],Numpad8:["","8","","8"],Numpad9:["","9","","9"],Numpad0:["","0","","0"],NumpadDecimal:["",".","","."],IntlBackslash:["<",">","|","¦"],NumpadEqual:["=","=","=","="],NumpadComma:[".",".",".","."],NumpadParenLeft:["(","(","(","("],NumpadParenRight:[")",")",")",")"]}}),register({id:"linux.french",locale:"fr",displayName:"French",virtualLayout:"azerty",platform:"linux",score:0,mapping:{KeyA:["q","Q","@","Ω"],KeyB:["b","B","”","’"],KeyC:["c","C","¢","©"],KeyD:["d","D","ð","Ð"],KeyE:["e","E","€","¢"],KeyF:["f","F","đ","ª"],KeyG:["g","G","ŋ","Ŋ"],KeyH:["h","H","ħ","Ħ"],KeyI:["i","I","→","ı"],KeyJ:["j","J","̉","̛"],KeyK:["k","K","ĸ","&"],KeyL:["l","L","ł","Ł"],KeyM:[",","?","́","̋"],KeyN:["n","N","n","N"],KeyO:["o","O","ø","Ø"],KeyP:["p","P","þ","Þ"],KeyQ:["a","A","æ","Æ"],KeyR:["r","R","¶","®"],KeyS:["s","S","ß","§"],KeyT:["t","T","ŧ","Ŧ"],KeyU:["u","U","↓","↑"],KeyV:["v","V","“","‘"],KeyW:["z","Z","«","<"],KeyX:["x","X","»",">"],KeyY:["y","Y","←","¥"],KeyZ:["w","W","ł","Ł"],Digit1:["&","1","¹","¡"],Digit2:["é","2","~","⅛"],Digit3:['"',"3","#","£"],Digit4:["'","4","{","$"],Digit5:["(","5","[","⅜"],Digit6:["-","6","|","⅝"],Digit7:["è","7","`","⅞"],Digit8:["_","8","\\","™"],Digit9:["ç","9","^","±"],Digit0:["à","0","@","°"],Enter:["\r","\r","\r","\r"],Escape:["","","",""],Backspace:["\b","\b","\b","\b"],Tab:["\t","","\t",""],Space:[" "," "," "," "],Minus:[")","°","]","¿"],Equal:["=","+","}","̨"],BracketLeft:["̂","̈","̈","̊"],BracketRight:["$","£","¤","̄"],Backslash:["*","µ","̀","̆"],Semicolon:["m","M","µ","º"],Quote:["ù","%","̂","̌"],Backquote:["²","~","¬","¬"],Comma:[";",".","─","×"],Period:[":","/","·","÷"],Slash:["!","§","̣","̇"],NumpadMultiply:["*","*","*","*"],NumpadSubtract:["-","-","-","-"],NumpadAdd:["+","+","+","+"],NumpadDecimal:["",".","","."],IntlBackslash:["<",">","|","¦"]}}),register({id:"windows.french",locale:"fr",displayName:"French",virtualLayout:"azerty",platform:"windows",score:0,mapping:{KeyA:["q","Q","",""],KeyB:["b","B","",""],KeyC:["c","C","",""],KeyD:["d","D","",""],KeyE:["e","E","€",""],KeyF:["f","F","",""],KeyG:["g","G","",""],KeyH:["h","H","",""],KeyI:["i","I","",""],KeyJ:["j","J","",""],KeyK:["k","K","",""],KeyL:["l","L","",""],KeyM:[",","?","",""],KeyN:["n","N","",""],KeyO:["o","O","",""],KeyP:["p","P","",""],KeyQ:["a","A","",""],KeyR:["r","R","",""],KeyS:["s","S","",""],KeyT:["t","T","",""],KeyU:["u","U","",""],KeyV:["v","V","",""],KeyW:["z","Z","",""],KeyX:["x","X","",""],KeyY:["y","Y","",""],KeyZ:["w","W","",""],Digit1:["&","1","",""],Digit2:["é","2","~",""],Digit3:['"',"3","#",""],Digit4:["'","4","{",""],Digit5:["(","5","[",""],Digit6:["-","6","|",""],Digit7:["è","7","`",""],Digit8:["_","8","\\",""],Digit9:["ç","9","^",""],Digit0:["à","0","@",""],Space:[" "," ","",""],Minus:[")","°","]",""],Equal:["=","+","}",""],BracketLeft:["^","¨","",""],BracketRight:["$","£","¤",""],Backslash:["*","µ","",""],Semicolon:["m","M","",""],Quote:["ù","%","",""],Backquote:["²","","",""],Comma:[";",".","",""],Period:[":","/","",""],Slash:["!","§","",""],NumpadDivide:["/","/","",""],NumpadMultiply:["*","*","",""],NumpadSubtract:["-","-","",""],NumpadAdd:["+","+","",""],IntlBackslash:["<",">","",""]}}),register({id:"windows.german",locale:"de",displayName:"German",platform:"windows",virtualLayout:"qwertz",score:0,mapping:{KeyA:["a","A","",""],KeyB:["b","B","",""],KeyC:["c","C","",""],KeyD:["d","D","",""],KeyE:["e","E","€",""],KeyF:["f","F","",""],KeyG:["g","G","",""],KeyH:["h","H","",""],KeyI:["i","I","",""],KeyJ:["j","J","",""],KeyK:["k","K","",""],KeyL:["l","L","",""],KeyM:["m","M","µ",""],KeyN:["n","N","",""],KeyO:["o","O","",""],KeyP:["p","P","",""],KeyQ:["q","Q","@",""],KeyR:["r","R","",""],KeyS:["s","S","",""],KeyT:["t","T","",""],KeyU:["u","U","",""],KeyV:["v","V","",""],KeyW:["w","W","",""],KeyX:["x","X","",""],KeyY:["z","Z","",""],KeyZ:["y","Y","",""],Digit1:["1","!","",""],Digit2:["2",'"',"²",""],Digit3:["3","§","³",""],Digit4:["4","$","",""],Digit5:["5","%","",""],Digit6:["6","&","",""],Digit7:["7","/","{",""],Digit8:["8","(","[",""],Digit9:["9",")","]",""],Digit0:["0","=","}",""],Space:[" "," ","",""],Minus:["ß","?","\\","ẞ"],Equal:["´","`","",""],BracketLeft:["ü","Ü","",""],BracketRight:["+","*","~",""],Backslash:["#","'","",""],Semicolon:["ö","Ö","",""],Quote:["ä","Ä","",""],Backquote:["^","°","",""],Comma:[",",";","",""],Period:[".",":","",""],Slash:["-","_","",""],NumpadDivide:["/","/","",""],NumpadMultiply:["*","*","",""],NumpadSubtract:["-","-","",""],NumpadAdd:["+","+","",""],IntlBackslash:["<",">","|",""]}}),register({id:"apple.german",locale:"de",displayName:"German",virtualLayout:"qwertz",platform:"apple",score:0,mapping:{KeyA:["a","A","å","Å"],KeyB:["b","B","∫","‹"],KeyC:["c","C","ç","Ç"],KeyD:["d","D","∂","™"],KeyE:["e","E","€","‰"],KeyF:["f","F","ƒ","Ï"],KeyG:["g","G","©","Ì"],KeyH:["h","H","ª","Ó"],KeyI:["i","I","⁄","Û"],KeyJ:["j","J","º","ı"],KeyK:["k","K","∆","ˆ"],KeyL:["l","L","@","ﬂ"],KeyM:["m","M","µ","˘"],KeyN:["n","N","~","›"],KeyO:["o","O","ø","Ø"],KeyP:["p","P","π","∏"],KeyQ:["q","Q","«","»"],KeyR:["r","R","®","¸"],KeyS:["s","S","‚","Í"],KeyT:["t","T","†","˝"],KeyU:["u","U","¨","Á"],KeyV:["v","V","√","◊"],KeyW:["w","W","∑","„"],KeyX:["x","X","≈","Ù"],KeyY:["z","Z","Ω","ˇ"],KeyZ:["y","Y","¥","‡"],Digit1:["1","!","¡","¬"],Digit2:["2",'"',"“","”"],Digit3:["3","§","¶","#"],Digit4:["4","$","¢","£"],Digit5:["5","%","[","ﬁ"],Digit6:["6","&","]","^"],Digit7:["7","/","|","\\"],Digit8:["8","(","{","˜"],Digit9:["9",")","}","·"],Digit0:["0","=","≠","¯"],Space:[" "," "," "," "],Minus:["ß","?","¿","˙"],Equal:["´","`","'","˚"],BracketLeft:["ü","Ü","•","°"],BracketRight:["+","*","±",""],Backslash:["#","'","‘","’"],Semicolon:["ö","Ö","œ","Œ"],Quote:["ä","Ä","æ","Æ"],Backquote:["<",">","≤","≥"],Comma:[",",";","∞","˛"],Period:[".",":","…","÷"],Slash:["-","_","–","—"],NumpadDivide:["/","/","/","/"],NumpadMultiply:["*","*","*","*"],NumpadSubtract:["-","-","-","-"],NumpadAdd:["+","+","+","+"],NumpadDecimal:[",",",",".","."],IntlBackslash:["^","°","„","“"],NumpadEqual:["=","=","=","="]}}),register({id:"dvorak",locale:"en",displayName:"Dvorak",virtualLayout:"dvorak",platform:"",score:0,mapping:{KeyA:["a","A","å","Å"],KeyB:["x","X","≈","˛"],KeyC:["j","J","∆","Ô"],KeyD:["e","E","´","´"],KeyE:[".",">","≥","˘"],KeyF:["u","U","¨","¨"],KeyG:["i","I","ˆ","ˆ"],KeyH:["d","D","∂","Î"],KeyI:["c","C","ç","Ç"],KeyJ:["h","H","˙","Ó"],KeyK:["t","T","†","ˇ"],KeyL:["n","N","˜","˜"],KeyM:["m","M","µ","Â"],KeyN:["b","B","∫","ı"],KeyO:["r","R","®","‰"],KeyP:["l","L","¬","Ò"],KeyQ:["'",'"',"æ","Æ"],KeyR:["p","P","π","∏"],KeyS:["o","O","ø","Ø"],KeyT:["y","Y","¥","Á"],KeyU:["g","G","©","˝"],KeyV:["k","K","˚",""],KeyW:[",","<","≤","¯"],KeyX:["q","Q","œ","Œ"],KeyY:["f","F","ƒ","Ï"],KeyZ:[";",":","…","Ú"],Digit1:["1","!","¡","⁄"],Digit2:["2","@","™","€"],Digit3:["3","#","£","‹"],Digit4:["4","$","¢","›"],Digit5:["5","%","∞","ﬁ"],Digit6:["6","^","§","ﬂ"],Digit7:["7","&","¶","‡"],Digit8:["8","*","•","°"],Digit9:["9","(","ª","·"],Digit0:["0",")","º","‚"],Space:[" "," "," "," "],Minus:["[","{","“","”"],Equal:["]","}","‘","’"],BracketLeft:["/","?","÷","¿"],BracketRight:["=","+","≠","±"],Backslash:["\\","|","«","»"],Semicolon:["s","S","ß","Í"],Quote:["-","_","–","—"],Backquote:["`","~","`","`"],Comma:["w","W","∑","„"],Period:["v","V","√","◊"],Slash:["z","Z","Ω","¸"],NumpadDivide:["/","/","/","/"],NumpadMultiply:["*","*","*","*"],NumpadSubtract:["-","-","-","-"],NumpadAdd:["+","+","+","+"],Numpad1:["1","1","1","1"],Numpad2:["2","2","2","2"],Numpad3:["3","3","3","3"],Numpad4:["4","4","4","4"],Numpad5:["5","5","5","5"],Numpad6:["6","6","6","6"],Numpad7:["7","7","7","7"],Numpad8:["8","8","8","8"],Numpad9:["9","9","9","9"],Numpad0:["0","0","0","0"],NumpadDecimal:[".",".",".","."],IntlBackslash:["§","±","§","±"],NumpadEqual:["=","=","=","="],AudioVolumeUp:["","=","","="]}}),new(function(_ModeEditor2){_inherits(LatexModeEditor,_ModeEditor2);var _super33=_createSuper(LatexModeEditor);function LatexModeEditor(){return _classCallCheck(this,LatexModeEditor),_super33.call(this,"latex")}return _createClass(LatexModeEditor,[{key:"createAtom",value:function(command){return new LatexAtom(command)}},{key:"onPaste",value:function(mathfield,data){if(!data)return!1;var text="string"==typeof data?data:data.getData("application/x-latex")||data.getData("text/plain");return!(!text||!contentWillChange(mathfield.model,{inputType:"insertFromPaste",data:text})||(mathfield.stopCoalescingUndo(),mathfield.stopRecording(),this.insert(mathfield.model,text)&&(mathfield.startRecording(),mathfield.snapshot("paste"),contentDidChange(mathfield.model,{inputType:"insertFromPaste"}),requestUpdate(mathfield)),mathfield.startRecording(),0))}},{key:"insert",value:function(model,text,options){if(!contentWillChange(model,{data:text,inputType:"insertText"}))return!1;options||(options={}),options.insertionMode||(options.insertionMode="replaceSelection"),options.selectionMode||(options.selectionMode="placeholder");var silenceNotifications=model.silenceNotifications;options.silenceNotifications&&(model.silenceNotifications=!0);var saveSilenceNotifications=model.silenceNotifications;model.silenceNotifications=!0,"replaceSelection"!==options.insertionMode||model.selectionIsCollapsed?"replaceAll"===options.insertionMode?(model.root.setChildren([],"body"),model.position=0):"insertBefore"===options.insertionMode?model.collapseSelection("backward"):"insertAfter"===options.insertionMode&&model.collapseSelection("forward"):model.deleteAtoms(range(model.selection));var _step94,newAtoms=[],_iterator94=_createForOfIteratorHelper(text);try{for(_iterator94.s();!(_step94=_iterator94.n()).done;){var c=_step94.value;COMMAND_MODE_CHARACTERS.test(c)&&newAtoms.push(new LatexAtom(c))}}catch(err){_iterator94.e(err)}finally{_iterator94.f()}var cursor=model.at(model.position);if(cursor instanceof LatexGroupAtom&&(cursor=cursor.lastChild),!(cursor.parent instanceof LatexGroupAtom)){var group=new LatexGroupAtom("");cursor.parent.addChildAfter(group,cursor),cursor=group.firstChild}var lastNewAtom=cursor.parent.addChildrenAfter(newAtoms,cursor);return model.silenceNotifications=saveSilenceNotifications,"before"===options.selectionMode||("item"===options.selectionMode?model.setSelection(model.anchor,model.offsetOf(lastNewAtom)):lastNewAtom&&(model.position=model.offsetOf(lastNewAtom))),contentDidChange(model,{data:text,inputType:"insertText"}),model.silenceNotifications=silenceNotifications,!0}}]),LatexModeEditor}(ModeEditor));var _a,_b,gResolvedScriptUrl=null,gScriptUrl=(null==(_b=null==(_a=null==globalThis?void 0:globalThis.document)?void 0:_a.currentScript)?void 0:_b.src)||function(){var stackTraceFrames=String((new Error).stack).replace(/^Error.*\n/,"").split("\n");if(0===stackTraceFrames.length)return console.error("Can't use relative paths to specify assets location because the sourcefile location could not be determined (unexpected stack trace format \"".concat((new Error).stack,'").')),"";var callerFrame=stackTraceFrames[1],m=callerFrame.match(/http.*\.ts[\?:]/);return m&&(callerFrame=stackTraceFrames[2]),(m=callerFrame.match(/(https?:.*):[0-9]+:[0-9]+/))||(m=callerFrame.match(/at (.*(\.ts))[\?:]/))||(m=callerFrame.match(/at (.*(\.mjs|\.js))[\?:]/)),m?m[1]:(console.error(stackTraceFrames),console.error("Can't use relative paths to specify assets location because the source file location could not be determined (unexpected location \"".concat(callerFrame,'").')),"")}();function resolveUrl(_x4){return _resolveUrl.apply(this,arguments)}function _resolveUrl(){return(_resolveUrl=_asyncToGenerator(regeneratorRuntime.mark((function _callee3(url){var response;return regeneratorRuntime.wrap((function(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:if(!/^(?:[a-z+]+:)?\/\//i.test(url)){_context5.next=2;break}return _context5.abrupt("return",new URL(url).href);case 2:if(null!==gResolvedScriptUrl){_context5.next=13;break}return _context5.prev=3,_context5.next=6,fetch(gScriptUrl,{method:"HEAD"});case 6:200===(response=_context5.sent).status&&(gResolvedScriptUrl=response.url),_context5.next=13;break;case 10:_context5.prev=10,_context5.t0=_context5.catch(3),console.error('Invalid URL "'.concat(url,'" (relative to "').concat(gScriptUrl,'")'));case 13:return _context5.abrupt("return",new URL(url,null!=gResolvedScriptUrl?gResolvedScriptUrl:gScriptUrl).href);case 14:case"end":return _context5.stop()}}),_callee3,null,[[3,10]])})))).apply(this,arguments)}function makeFontFace(name,source){var descriptors=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return new FontFace(name,"url(".concat(source,".woff2) format('woff2')"),descriptors)}var COMMANDS,gFontsState="not-loaded";function _reloadFonts(){return(_reloadFonts=_asyncToGenerator(regeneratorRuntime.mark((function _callee4(){return regeneratorRuntime.wrap((function(_context6){for(;;)switch(_context6.prev=_context6.next){case 0:return gFontsState="not-loaded",_context6.abrupt("return",loadFonts());case 2:case"end":return _context6.stop()}}),_callee4)})))).apply(this,arguments)}function loadFonts(){return _loadFonts.apply(this,arguments)}function _loadFonts(){return(_loadFonts=_asyncToGenerator(regeneratorRuntime.mark((function _callee5(){var _a3,fontFamilies,fontsInDocument,fontsFolder,fonts;return regeneratorRuntime.wrap((function(_context7){for(;;)switch(_context7.prev=_context7.next){case 0:if("not-loaded"===gFontsState){_context7.next=2;break}return _context7.abrupt("return");case 2:if(gFontsState="loading",null==(_a3=getComputedStyle(document.documentElement).getPropertyValue("--ML__static-fonts"))||!_a3){_context7.next=7;break}return gFontsState="ready",_context7.abrupt("return");case 7:if(document.body.classList.remove("ML__fonts-did-not-load"),!("fonts"in document)){_context7.next=39;break}if(fontFamilies=["KaTeX_Main","KaTeX_Math","KaTeX_AMS","KaTeX_Caligraphic","KaTeX_Fraktur","KaTeX_SansSerif","KaTeX_Script","KaTeX_Typewriter","KaTeX_Size1","KaTeX_Size2","KaTeX_Size3","KaTeX_Size4"],fontsInDocument=Array.from(document.fonts).map((function(f){return f.family})),!fontFamilies.every((function(x){return fontsInDocument.includes(x)}))){_context7.next=14;break}return gFontsState="ready",_context7.abrupt("return");case 14:if(window.MathfieldElement.fontsDirectory){_context7.next=17;break}return gFontsState="not-loaded",_context7.abrupt("return");case 17:return _context7.next=19,resolveUrl(window.MathfieldElement.fontsDirectory);case 19:if(fontsFolder=_context7.sent){_context7.next=24;break}return document.body.classList.add("ML__fonts-did-not-load"),gFontsState="error",_context7.abrupt("return");case 24:return fonts=[["KaTeX_Main-Regular"],["KaTeX_Main-BoldItalic",{style:"italic",weight:"bold"}],["KaTeX_Main-Bold",{weight:"bold"}],["KaTeX_Main-Italic",{style:"italic"}],["KaTeX_Math-Italic",{style:"italic"}],["KaTeX_Math-BoldItalic",{style:"italic",weight:"bold"}],["KaTeX_AMS-Regular"],["KaTeX_Caligraphic-Regular"],["KaTeX_Caligraphic-Bold",{weight:"bold"}],["KaTeX_Fraktur-Regular"],["KaTeX_Fraktur-Bold",{weight:"bold"}],["KaTeX_SansSerif-Regular",{style:"italic"}],["KaTeX_SansSerif-Bold",{weight:"bold"}],["KaTeX_SansSerif-Italic",{style:"italic"}],["KaTeX_Script-Regular"],["KaTeX_Typewriter-Regular"],["KaTeX_Size1-Regular"],["KaTeX_Size2-Regular"],["KaTeX_Size3-Regular"],["KaTeX_Size4-Regular"]].map((function(x){return makeFontFace(x[0].replace(/-[a-zA-Z]+$/,""),"".concat(fontsFolder,"/").concat(x[0]),x[1])})),_context7.prev=25,_context7.next=28,Promise.all(fonts.map((function(x){try{return x.load()}catch(e){}})));case 28:return _context7.sent.forEach((function(font){return document.fonts.add(font)})),gFontsState="ready",_context7.abrupt("return");case 34:_context7.prev=34,_context7.t0=_context7.catch(25),console.error('MathLive 0.94.6: The math fonts could not be loaded from "'.concat(fontsFolder,'"'),{cause:_context7.t0}),document.body.classList.add("ML__fonts-did-not-load");case 38:gFontsState="error";case 39:case"end":return _context7.stop()}}),_callee5,null,[[25,34]])})))).apply(this,arguments)}function hash(latex){for(var result=0,i=0;i<latex.length;i++)result=31*result+latex.charCodeAt(i),result|=0;return Math.abs(result)}function requestUpdate(mathfield,options){mathfield.dirty||(mathfield.dirty=!0,requestAnimationFrame((function(){isValidMathfield(mathfield)&&mathfield.dirty&&(mathfield.atomBoundsCache=new Map,render(mathfield,options),mathfield.atomBoundsCache=void 0)})))}function contentMarkup(mathfield,renderOptions){var model=mathfield.model;model.root.caret=void 0,model.root.isSelected=!1,model.root.containsCaret=!0;var _step100,_iterator100=_createForOfIteratorHelper(model.atoms);try{for(_iterator100.s();!(_step100=_iterator100.n()).done;){var _atom6=_step100.value;_atom6.caret=void 0,_atom6.isSelected=!1,_atom6.containsCaret=!1}}catch(err){_iterator100.e(err)}finally{_iterator100.f()}if(model.selectionIsCollapsed){if(mathfield.isSelectionEditable&&mathfield.hasFocus()){var atom=model.at(model.position);atom.caret=mathfield.model.mode;for(var ancestor=atom.parent;ancestor;)ancestor.containsCaret=!0,ancestor=ancestor.parent}}else{var _step101,_iterator101=_createForOfIteratorHelper(model.getAtoms(model.selection,{includeChildren:!0}));try{for(_iterator101.s();!(_step101=_iterator101.n()).done;)_step101.value.isSelected=!0}catch(err){_iterator101.e(err)}finally{_iterator101.f()}}var box=function(mathfield,renderOptions){var _a3;renderOptions=null!=renderOptions?renderOptions:{};var context=new Context({from:__spreadProps(__spreadValues({},mathfield.context),{atomIdsSettings:{seed:renderOptions.forHighlighting?hash(Atom.serialize([mathfield.model.root],{expandMacro:!1,defaultMode:mathfield.options.defaultMode})):"random",groupNumbers:null!=(_a3=renderOptions.forHighlighting)&&_a3},letterShapeStyle:mathfield.options.letterShapeStyle}),mathstyle:"inline-math"===mathfield.options.defaultMode?"textstyle":"displaystyle"});return makeStruts(applyInterBoxSpacing(mathfield.model.root.render(context),context),{classes:mathfield.hasEditablePrompts?"ML__mathlive ML__prompting":"ML__mathlive",attributes:{translate:"no","aria-hidden":"true"}})}(mathfield,renderOptions);return box.toMarkup()}function render(mathfield,renderOptions){var _a3;if(isValidMathfield(mathfield)){null!=renderOptions||(renderOptions={});var toggle=null==(_a3=mathfield.element)?void 0:_a3.querySelector("[part=virtual-keyboard-toggle]");toggle&&(toggle.style.display=mathfield.hasEditableContent?"flex":"none");var field=mathfield.field,hasFocus=mathfield.isSelectionEditable&&mathfield.hasFocus(),isFocused=field.classList.contains("ML__focused");isFocused&&!hasFocus?field.classList.remove("ML__focused"):!isFocused&&hasFocus&&field.classList.add("ML__focused"),field.innerHTML=window.MathfieldElement.createHTML(contentMarkup(mathfield,renderOptions)),mathfield.fieldContent=field.getElementsByClassName("ML__mathlive")[0],renderSelection(mathfield,renderOptions.interactive),mathfield.dirty=!1}}function renderSelection(mathfield,interactive){var field=mathfield.field;if(field){var _step102,_iterator102=_createForOfIteratorHelper(field.querySelectorAll(".ML__selection, .ML__contains-highlight"));try{for(_iterator102.s();!(_step102=_iterator102.n()).done;)_step102.value.remove()}catch(err){_iterator102.e(err)}finally{_iterator102.f()}null!=interactive&&interactive||"error"===gFontsState||"ready"===gFontsState||setTimeout((function(){"ready"===gFontsState?renderSelection(mathfield):setTimeout((function(){return renderSelection(mathfield)}),128)}),32);var model=mathfield.model,supposedWidth=parseFloat(getComputedStyle(field).width),scaleFactor=field.getBoundingClientRect().width/supposedWidth;if(scaleFactor=isNaN(scaleFactor)?1:scaleFactor,model.selectionIsCollapsed){updateSuggestionPopoverPosition(mathfield,{deferred:!0});for(var atom=model.at(model.position);atom&&(!atom.containsCaret||!atom.displayContainsHighlight);)atom=atom.parent;if((null==atom?void 0:atom.containsCaret)&&atom.displayContainsHighlight){var bounds=adjustForScrolling(mathfield,getAtomBounds(mathfield,atom),scaleFactor);if(bounds){bounds.left/=scaleFactor,bounds.right/=scaleFactor,bounds.top/=scaleFactor,bounds.bottom/=scaleFactor;var element=document.createElement("div");element.classList.add("ML__contains-highlight"),element.style.position="absolute",element.style.left="".concat(bounds.left,"px"),element.style.top="".concat(bounds.top,"px"),element.style.width="".concat(Math.ceil(bounds.right-bounds.left),"px"),element.style.height="".concat(Math.ceil(bounds.bottom-bounds.top-1),"px"),field.insertBefore(element,field.childNodes[0])}}}else{var _step103,_iterator103=_createForOfIteratorHelper(function(rects){var _step104,result=[],_iterator104=_createForOfIteratorHelper(rects);try{for(_iterator104.s();!(_step104=_iterator104.n()).done;){var _step106,rect=_step104.value,found=!1,_iterator106=_createForOfIteratorHelper(result);try{for(_iterator106.s();!(_step106=_iterator106.n()).done;){var rect2=_step106.value;if(rect.left===rect2.left&&rect.right===rect2.right&&rect.top===rect2.top&&rect.bottom===rect2.bottom){found=!0;break}}}catch(err){_iterator106.e(err)}finally{_iterator106.f()}found||result.push(rect)}}catch(err){_iterator104.e(err)}finally{_iterator104.f()}rects=result,result=[];var _step105,_iterator105=_createForOfIteratorHelper(rects);try{for(_iterator105.s();!(_step105=_iterator105.n()).done;){var _step107,_rect=_step105.value,count=0,_iterator107=_createForOfIteratorHelper(rects);try{for(_iterator107.s();!(_step107=_iterator107.n()).done;){var _rect2=_step107.value;if(_rect.left>=_rect2.left&&_rect.right<=_rect2.right&&_rect.top>=_rect2.top&&_rect.bottom<=_rect2.bottom&&(count+=1)>1)break}}catch(err){_iterator107.e(err)}finally{_iterator107.f()}1===count&&result.push(_rect)}}catch(err){_iterator105.e(err)}finally{_iterator105.f()}return result}(getSelectionBounds(mathfield,{excludeAtomsWithBackground:!0})));try{for(_iterator103.s();!(_step103=_iterator103.n()).done;){var x=_step103.value;x.left/=scaleFactor,x.right/=scaleFactor,x.top/=scaleFactor,x.bottom/=scaleFactor;var selectionElement=document.createElement("div");selectionElement.classList.add("ML__selection"),selectionElement.style.position="absolute",selectionElement.style.left="".concat(x.left,"px"),selectionElement.style.top="".concat(x.top,"px"),selectionElement.style.width="".concat(Math.ceil(x.right-x.left),"px"),selectionElement.style.height="".concat(Math.ceil(x.bottom-x.top-1),"px"),field.insertBefore(selectionElement,field.childNodes[0])}}catch(err){_iterator103.e(err)}finally{_iterator103.f()}}}}function register2(commands,options){options=__spreadValues({target:"mathfield",canUndo:!1,audioFeedback:void 0,changeContent:!1,changeSelection:!1},null!=options?options:{}),COMMANDS||(COMMANDS={});for(var _i18=0,_Object$keys8=Object.keys(commands);_i18<_Object$keys8.length;_i18++){var selector=_Object$keys8[_i18];console.assert(!COMMANDS[selector],"Selector already defined: ",selector),COMMANDS[selector]=__spreadProps(__spreadValues({},options),{fn:commands[selector]})}}function getCommandInfo(command){var selector;return selector=(selector=Array.isArray(command)?"performWithFeedback"===command[0]||"performVariant"===command[0]?command[1]:command[0]:command).replace(/-\w/g,(function(m){return m[1].toUpperCase()})),COMMANDS[selector]}function getCommandTarget(command){var _a3;return null==(_a3=getCommandInfo(command))?void 0:_a3.target}function isVirtualKeyboardMessage(evt){var _a3;return"message"===evt.type&&"mathlive#virtual-keyboard-message"===(null==(_a3=evt.data)?void 0:_a3.type)}register2({performWithFeedback:function(mathfield,command){return function(mathfield,selector){var _a3;mathfield.focus(),mathfield_element_default.keypressVibration&&canVibrate()&&navigator.vibrate(3);var info=getCommandInfo(selector);window.MathfieldElement.playSound(null!=(_a3=null==info?void 0:info.audioFeedback)?_a3:"keypress");var result=mathfield.executeCommand(selector);return mathfield.scrollIntoView(),result}(mathfield,command)}}),register2({complete:complete},{target:"mathfield",audioFeedback:"return",canUndo:!0,changeContent:!0,changeSelection:!0}),register2({nextSuggestion:function(mathfield){return updateAutocomplete(mathfield,{atIndex:mathfield.suggestionIndex+1}),!1},previousSuggestion:function(mathfield){return updateAutocomplete(mathfield,{atIndex:mathfield.suggestionIndex-1}),!1}},{target:"mathfield",audioFeedback:"keypress",changeSelection:!0});var VirtualKeyboardProxy=function(){function VirtualKeyboardProxy(){_classCallCheck(this,VirtualKeyboardProxy),this.targetOrigin=window.origin,this.originValidator="none",this._boundingRect=new DOMRect(0,0,0,0),this._isShifted=!1,window.addEventListener("message",this),this.sendMessage("proxy-created"),this.listeners={}}return _createClass(VirtualKeyboardProxy,[{key:"alphabeticLayout",set:function(value){this.sendMessage("update-setting",{alphabeticLayout:value})}},{key:"layouts",set:function(value){this.sendMessage("update-setting",{layouts:value})}},{key:"editToolbar",set:function(value){this.sendMessage("update-setting",{editToolbar:value})}},{key:"actionKeycap",set:function(value){this.sendMessage("update-setting",{actionKeycap:value})}},{key:"shiftKeycap",set:function(value){this.sendMessage("update-setting",{shiftKeycap:value})}},{key:"backspaceKeycap",set:function(value){this.sendMessage("update-setting",{backspaceKeycap:value})}},{key:"tabKeycap",set:function(value){this.sendMessage("update-setting",{tabKeycap:value})}},{key:"container",set:function(value){throw new Error("Container inside an iframe cannot be changed")}},{key:"show",value:function(options){this.sendMessage("show",options)}},{key:"hide",value:function(options){this.sendMessage("hide",options)}},{key:"isShifted",get:function(){return this._isShifted}},{key:"visible",get:function(){return this._boundingRect.height>0},set:function(value){value?this.show():this.hide()}},{key:"boundingRect",get:function(){return this._boundingRect}},{key:"executeCommand",value:function(command){return this.sendMessage("execute-command",{command:command}),!0}},{key:"updateToolbar",value:function(mf){this.sendMessage("update-toolbar",mf)}},{key:"update",value:function(mf){this.sendMessage("update-setting",mf)}},{key:"connect",value:function(){this.sendMessage("connect")}},{key:"disconnect",value:function(){this.sendMessage("disconnect")}},{key:"addEventListener",value:function(type,callback,_options){this.listeners[type]||(this.listeners[type]=new Set),this.listeners[type].has(callback)||this.listeners[type].add(callback)}},{key:"dispatchEvent",value:function(event){return!this.listeners[event.type]||0===this.listeners[event.type].size||(this.listeners[event.type].forEach((function(x){"function"==typeof x?x(event):null==x||x.handleEvent(event)})),!event.defaultPrevented)}},{key:"removeEventListener",value:function(type,callback,_options){this.listeners[type]&&this.listeners[type].delete(callback)}},{key:"handleEvent",value:function(evt){if(isVirtualKeyboardMessage(evt)){if(!validateOrigin(evt.origin,this.originValidator))throw new DOMException("Message from unknown origin (".concat(evt.origin,") cannot be handled"),"SecurityError");this.handleMessage(evt.data)}}},{key:"handleMessage",value:function(msg){var action=msg.action;if("execute-command"!==action)return"synchronize-proxy"===action?(console.log("synchronize-proxy",window,msg.boundingRect),this._boundingRect=msg.boundingRect,void(this._isShifted=msg.isShifted)):"geometry-changed"===action?(console.log("geometry-change",window,msg.boundingRect),this._boundingRect=msg.boundingRect,void this.dispatchEvent(new Event("geometrychange"))):void 0;var command=msg.command;"virtual-keyboard"===getCommandTarget(command)&&this.executeCommand(command)}},{key:"sendMessage",value:function(action){var payload=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!window.top)throw new DOMException("A frame does not have access to the top window and can‘t communicate with the keyboard. Review virtualKeyboardTargetOrigin and originValidator on mathfields embedded in an iframe","SecurityError");window.top.postMessage(__spreadValues({type:"mathlive#virtual-keyboard-message",action:action},payload),this.targetOrigin)}}],[{key:"singleton",get:function(){return this._singleton||(this._singleton=new VirtualKeyboardProxy),this._singleton}}]),VirtualKeyboardProxy}(),LAYOUTS={numeric:{label:"123",labelClass:"MLK__tex-math",tooltip:"keyboard.tooltip.numeric",rows:[[{latex:"x",shift:"y",variants:["y","z","t","r",{latex:"f(#?)",class:"small"},{latex:"g(#?)",class:"small"},"x^2","x^n","x_n","x_{n+1}","x_i","x_{i+1}"]},{latex:"n",shift:"a",variants:["i","j","p","k","a","u"]},"[separator-5]","[7]","[8]","[9]","[/]","[separator-5]",{latex:"e",shift:"\\ln",variants:["\\exp","\\times 10^{#?}","\\ln","\\log_{10}","\\log"]},{latex:"\\imaginaryI",variants:["\\Re","\\Im","\\imaginaryJ","\\Vert #0 \\Vert"]},{latex:"\\pi",shift:"\\sin",variants:["\\prod",{latex:"\\theta",aside:"theta"},{latex:"\\rho",aside:"rho"},{latex:"\\tau",aside:"tau"},"\\sin","\\cos","\\tan"]}],[{label:"<",latex:"<",class:"hide-shift",shift:{latex:"\\le",label:"≤"}},{label:">",latex:">",class:"hide-shift",shift:{latex:"\\ge",label:"≥"}},"[separator-5]","[4]","[5]","[6]","[*]","[separator-5]",{class:"hide-shift",latex:"#@^2}",shift:"#@^{\\prime}}"},{latex:"#@^{#0}}",class:"hide-shift",shift:"#@_{#?}"},{class:"hide-shift",latex:"\\sqrt{#0}",shift:{latex:"\\sqrt[#0]{#?}}"}}],["[(]","[)]","[separator-5]","[1]","[2]","[3]","[-]","[separator-5]",{latex:"\\int^{\\infty}_{0}",class:"small hide-shift",shift:"\\int",variants:[{latex:"\\int_{#?}^{#?}",class:"small"},{latex:"\\int",class:"small"},{latex:"\\smallint",class:"small"},{latex:"\\iint",class:"small"},{latex:"\\iiint",class:"small"},{latex:"\\oint",class:"small"},{latex:"\\dfrac{\\rd}{\\rd x}",class:"small"},{latex:"\\frac{\\partial}{\\partial x}",class:"small"},"\\capitalDifferentialD","\\rd","\\partial"]},{class:"hide-shift",latex:"\\forall",shift:"\\exists"},{label:"[backspace]",width:1}],[{label:"[shift]",width:2},"[separator-5]","[0]","[.]","[=]","[+]","[separator-5]","[left]","[right]",{label:"[action]",width:1}]]},greek:{label:"&alpha;&beta;&gamma;",labelClass:"MLK__tex-math",tooltip:"keyboard.tooltip.greek",rows:[[{label:"<i>&#x03c6;</i>",class:"MLK__tex hide-shift",insert:"\\varphi",aside:"phi var.",shift:"\\Phi"},{label:"<i>&#x03c2;</i>",class:"MLK__tex hide-shift",insert:"\\varsigma",aside:"sigma var.",shift:"\\Sigma"},{label:"<i>&#x03f5;</i>",class:"MLK__tex hide-shift",insert:"\\epsilon",aside:"espilon",shift:'\\char"0190'},{label:"<i>&rho;</i>",class:"MLK__tex hide-shift",insert:"\\rho",aside:"rho",shift:'\\char"3A1'},{label:"<i>&tau;</i>",class:"MLK__tex hide-shift",insert:"\\tau",aside:"tau",shift:'\\char"3A4'},{label:"<i>&upsilon;</i>",class:"MLK__tex hide-shift",insert:"\\upsilon",aside:"upsilon",shift:"\\Upsilon"},{label:"<i>&theta;</i>",class:"MLK__tex hide-shift",insert:"\\theta",aside:"theta",shift:"\\Theta"},{label:"<i>&iota;</i>",class:"MLK__tex hide-shift",insert:"\\iota",aside:"iota",shift:'\\char"399'},{label:"<i>&omicron;</i>",class:"MLK__tex hide-shift",insert:"\\omicron",aside:"omicron",shift:'\\char"39F'},{label:"<i>&pi;</i>",class:"MLK__tex hide-shift",insert:"\\pi",aside:"pi",shift:"\\Pi"}],["[separator-5]",{label:"<i>&alpha;</i>",class:"MLK__tex hide-shift",insert:"\\alpha",aside:"alpha",shift:'\\char"391'},{label:"<i>&sigma;</i>",class:"MLK__tex hide-shift",insert:"\\sigma",aside:"sigma",shift:"\\Sigma"},{label:"<i>&delta;</i>",class:"MLK__tex hide-shift",insert:"\\delta",aside:"delta",shift:"\\Delta"},{label:"<i>&phi;</i>",class:"MLK__tex hide-shift",insert:"\\phi",aside:"phi",shift:"\\Phi"},{label:"<i>&gamma;</i>",class:"MLK__tex hide-shift",insert:"\\gamma",aside:"gamma",shift:"\\Gamma"},{label:"<i>&eta;</i>",class:"MLK__tex hide-shift",insert:"\\eta",aside:"eta",shift:'\\char"397'},{label:"<i>&xi;</i>",class:"MLK__tex hide-shift",insert:"\\xi",aside:"xi",shift:"\\Xi"},{label:"<i>&kappa;</i>",class:"MLK__tex hide-shift",insert:"\\kappa",aside:"kappa",shift:"\\Kappa"},{label:"<i>&lambda;</i>",class:"MLK__tex hide-shift",insert:"\\lambda",aside:"lambda",shift:"\\Lambda"},"[separator-5]"],["[shift]",{label:"<i>&zeta;</i>",class:"MLK__tex hide-shift",insert:"\\zeta",aside:"zeta",shift:'\\char"396'},{label:"<i>&chi;</i>",class:"MLK__tex hide-shift",insert:"\\chi",aside:"chi",shift:'\\char"3A7'},{label:"<i>&psi;</i>",class:"MLK__tex hide-shift",insert:"\\psi",aside:"zeta",shift:"\\Psi"},{label:"<i>&omega;</i>",class:"MLK__tex hide-shift",insert:"\\omega",aside:"omega",shift:"\\Omega"},{label:"<i>&beta;</i>",class:"MLK__tex hide-shift",insert:"\\beta",aside:"beta",shift:'\\char"392'},{label:"<i>&nu;</i>",class:"MLK__tex hide-shift",insert:"\\nu",aside:"nu",shift:'\\char"39D'},{label:"<i>&mu;</i>",class:"MLK__tex hide-shift",insert:"\\mu",aside:"mu",shift:'\\char"39C'},"[backspace]"],["[separator]",{label:"<i>&#x03b5;</i>",class:"MLK__tex",insert:"\\varepsilon",aside:"espilon var."},{label:"<i>&#x03d1;</i>",class:"MLK__tex",insert:"\\vartheta",aside:"theta var."},{label:"<i>&#x3f0;</i>",class:"MLK__tex",insert:"\\varkappa",aside:"kappa var."},{label:"<i>&#x03d6;</i>",class:"MLK__tex",insert:"\\varpi",aside:"pi var."},{label:"<i>&#x03f1;</i>",class:"MLK__tex",insert:"\\varrho",aside:"rho var."},"[left]","[right]","[action]"]]},symbols:{label:"&infin;≠∈",labelClass:"MLK__tex",tooltip:"keyboard.tooltip.symbols",rows:[[{latex:"\\sin",shift:"\\sin^{-1}",variants:[{class:"small",latex:"\\sinh"},{class:"small",latex:"\\sin^{-1}"},{class:"small",latex:"\\arsinh"}]},"\\ln",{latex:"\\mathrm{abs}",insert:"\\mathrm{abs}\\left(#0\\right)"},{latex:"\\rarr",shift:"\\rArr",variants:[{latex:"\\implies",aside:"implies"},{latex:"\\to",aside:"to"},"\\dashv",{latex:"\\roundimplies",aside:"round implies"}]},{latex:"\\exists",variants:["\\nexists"],shift:"\\nexists"},{latex:"\\in",shift:"\\notin",variants:["\\notin","\\owns"]},"\\cup",{latex:"\\overrightarrow{#@}",shift:"\\overleftarrow{#@}",variants:["\\overleftarrow{#@}","\\bar{#@}","\\vec{#@}","\\hat{#@}","\\check{#@}","\\dot{#@}","\\ddot{#@}","\\mathring{#@}","\\breve{#@}","\\acute{#@}","\\tilde{#@}","\\grave{#@}"]},"\\lim_{#?}","\\exponentialE"],[{latex:"\\cos",shift:"\\cos^{-1}",variants:[{class:"small",latex:"\\cosh"},{class:"small",latex:"\\cos^{-1}"},{class:"small",latex:"\\arcosh"}]},{latex:"\\log",shift:"\\log_{10}",variants:["\\log_{#0}","\\log_{10}"]},"\\left\\vert#0\\right\\vert",{latex:"\\larr",shift:"\\lArr",variants:[{latex:"\\impliedby",aside:"implied by"},{latex:"\\gets",aside:"gets"},"\\lArr","\\vdash",{latex:"\\models",aside:"models"}]},{latex:"\\forall",shift:"\\lnot",variants:[{latex:"\\land",aside:"and"},{latex:"\\lor",aside:"or"},{latex:"\\oplus",aside:"xor"},{latex:"\\lnot",aside:"not"},{latex:"\\downarrow",aside:"nor"},{latex:"\\uparrow",aside:"nand"},{latex:"\\curlywedge",aside:"nor"},{latex:"\\bar\\curlywedge",aside:"nand"}]},{latex:"\\ni",shift:"\\not\\owns"},"\\cap",{latex:"\\overline{#@}",shift:"\\underline{#@}",variants:["\\overbrace{#@}","\\overlinesegment{#@}","\\overleftrightarrow{#@}","\\overrightarrow{#@}","\\overleftarrow{#@}","\\overgroup{#@}","\\underbrace{#@}","\\underlinesegment{#@}","\\underleftrightarrow{#@}","\\underrightarrow{#@}","\\underleftarrow{#@}","\\undergroup{#@}"]},{class:"hide-shift",latex:"\\int",shift:"\\iint",variants:[{latex:"\\int_{#?}^{#?}",class:"small"},{latex:"\\int",class:"small"},{latex:"\\smallint",class:"small"},{latex:"\\iint",class:"small"},{latex:"\\iiint",class:"small"},{latex:"\\oint",class:"small"},"\\intop","\\iiint","\\oiint","\\oiiint","\\intclockwise","\\varointclockwise","\\ointctrclockwise","\\intctrclockwise"]},{latex:"\\pi",shift:"\\tau",variants:["\\tau"]}],[{latex:"\\tan",shift:"\\tan^{-1}",variants:[{class:"small",latex:"\\tanh"},{class:"small",latex:"\\tan^{-1}"},{class:"small",latex:"\\artanh"},{class:"small",latex:"\\arctan"},{class:"small",latex:"\\arctg"},{class:"small",latex:"\\tg"}]},{latex:"\\mathrm{exp}",insert:"\\mathrm{exp}\\left(#0\\right)",variants:["\\exponentialE^{#0}"]},"\\left\\Vert#0\\right\\Vert",{latex:"\\lrArr",shift:"\\leftrightarrow",variants:[{latex:"\\iff",aside:"if and only if"},"\\leftrightarrow","\\leftrightarrows","\\Leftrightarrow",{latex:"^\\biconditional",aside:"biconditional"}]},{latex:"\\vert",shift:"!"},{latex:"#@^{\\complement}",aside:"complement",variants:[{latex:"\\setminus",aside:"set minus"},{latex:"\\smallsetminus",aside:"small set minus"}]},{latex:"\\subset",shift:"\\subseteq",variants:["\\subset","\\subseteq","\\subsetneq","\\varsubsetneq","\\subsetneqq","\\nsubset","\\nsubseteq","\\supset","\\supseteq","\\supsetneq","\\supsetneqq","\\nsupset","\\nsupseteq"]},{latex:"#@^{\\prime}",shift:"#@^{\\doubleprime}",variants:["#@^{\\doubleprime}","#@\\degree"]},{latex:"\\rd",shift:"\\partial",variants:[{latex:"\\dfrac{\\rd}{\\rd x}",class:"small"},{latex:"\\frac{\\partial}{\\partial x}",class:"small"},"\\capitalDifferentialD","\\rd","\\partial"]},{latex:"\\infty",variants:["\\aleph_0","\\aleph_1","\\omega","\\mathfrak{m}"]}],[{label:"[shift]",width:2},{class:"box",latex:",",shift:";",variants:[";","?"]},{class:"box",latex:"\\colon",shift:"\\Colon",variants:[{latex:"\\Colon",aside:"such that",class:"box"},{latex:":",aside:"ratio",class:"box"},{latex:"\\vdots",aside:"",class:"box"},{latex:"\\ddots",aside:"",class:"box"},{latex:"\\ldotp",aside:"low dot",class:"box"},{latex:"\\cdotp",aside:"center dot",class:"box"},{latex:"\\ldots",aside:"low ellipsis",class:"box"},{latex:"\\cdots",aside:"center ellipsis",class:"box"},{latex:"\\therefore",aside:"therefore",class:"box"},{latex:"\\because",aside:"because",class:"box"}]},{class:"box",latex:"\\cdot",aside:"centered dot",shift:"\\ast",variants:["\\circ","\\bigcirc","\\bullet","\\odot","\\oslash","\\circledcirc","\\ast","\\star","\\times","\\doteq","\\doteqdot"]},"[separator]","[left]","[right]",{label:"[backspace]",width:1,class:"action hide-shift"},{label:"[action]",width:1}]]},compact:{label:"compact",rows:[["[+]","[-]","[*]","[/]","[=]","[.]","[(]","[)]","\\sqrt{#0}","#@^{#?}"],["[1]","[2]","[3]","[4]","[5]","[6]","[7]","[8]","[9]","[0]"],["[hr]"],["[undo]","[redo]","[separator]","[separator]","[separator]","[left]","[right]",{label:"[backspace]",class:"action hide-shift"},"[hide-keyboard]"]]},minimalist:{label:"minimalist",layers:[{style:"\n          .minimalist-backdrop {\n            display: flex;\n            justify-content: center;\n          }          \n          .minimalist-container {\n            --keycap-height: 40px;\n            --keycap-max-width: 53px;\n            --keycap-small-font-size: 12px;\n            background: var(--keyboard-background);\n            padding: 20px;\n            border-top-left-radius: 8px;\n            border-top-right-radius: 8px;\n            border: 1px solid var(--keyboard-border);\n            box-shadow: 0 0 32px rgb(0 0 0 / 30%);\n          }        \n        ",backdrop:"minimalist-backdrop",container:"minimalist-container",rows:[["+","-","\\times",{latex:"\\frac{#@}{#0}",class:"small"},"=","[.]","(",")",{latex:"\\sqrt{#0}",class:"small"},{latex:"#@^{#?}",class:"small"}],["1","2","3","4","5","6","7","8","9","0"],["[hr]"],["[undo]","[redo]","[separator]","[separator]","[separator]","[left]","[right]",{label:"[backspace]",class:"action hide-shift"},"[hide-keyboard]"]]}]},"numeric-only":{label:"123",labelClass:"MLK__tex-math",tooltip:"keyboard.tooltip.numeric",id:"numeric-only",rows:[["7","8","9","[separator]",{label:"[backspace]",width:2}],["4","5","6","[separator]","[separator]","[separator]"],["1","2","3","[separator]","[separator]","[separator]"],["0",{label:"[.]",variants:[]},"-","[separator]","[left]","[right]"]]}},Scrim=function(){function Scrim(options){var _a3,_b3;_classCallCheck(this,Scrim),this.preventOverlayClose=null!=(_a3=null==options?void 0:options.preventOverlayClose)&&_a3,this.translucent=null!=(_b3=null==options?void 0:options.translucent)&&_b3,this.state="closed"}return _createClass(Scrim,[{key:"element",get:function(){if(this._element)return this._element;var element=document.createElement("div");return element.setAttribute("role","presentation"),element.style.position="fixed",element.style.contain="content",element.style.top="0",element.style.left="0",element.style.right="0",element.style.bottom="0",element.style.zIndex="var(--scrim-zindex, 10099)",element.style.outline="none",this.translucent?(element.style.background="rgba(255, 255, 255, .2)",element.style.backdropFilter="contrast(40%)"):element.style.background="transparent",this._element=element,element}},{key:"open",value:function(options){var _a3;if("closed"===this.state){this.state="opening",this.savedActiveElement=deepActiveElement();var element=this.element;(null!=(_a3=null==options?void 0:options.root)?_a3:document.body).appendChild(element),element.addEventListener("click",this),document.addEventListener("touchmove",this,!1),document.addEventListener("scroll",this,!1);var scrollbarWidth=window.innerWidth-document.documentElement.clientWidth;this.savedMarginRight=document.body.style.marginRight,this.savedOverflow=document.body.style.overflow,document.body.style.overflow="hidden";var marginRight=Number.parseFloat(getComputedStyle(document.body).marginRight);document.body.style.marginRight="".concat(marginRight+scrollbarWidth,"px"),(null==options?void 0:options.child)&&element.append(options.child),this.state="open"}}},{key:"close",value:function(){var _a3,_b3,_c2,_d2;if("open"===this.state){this.state="closing","function"==typeof this.onClose&&this.onClose();var element=this.element;element.removeEventListener("click",this),document.removeEventListener("touchmove",this,!1),document.removeEventListener("scroll",this,!1),element.remove(),document.body.style.overflow=null!=(_a3=this.savedOverflow)?_a3:"",document.body.style.marginRight=null!=(_b3=this.savedMarginRight)?_b3:"",deepActiveElement()!==this.savedActiveElement&&(null==(_d2=null==(_c2=this.savedActiveElement)?void 0:_c2.focus)||_d2.call(_c2)),element.innerHTML="",this.state="closed"}}},{key:"handleEvent",value:function(ev){this.preventOverlayClose||(ev.target===this._element&&"click"===ev.type?(this.close(),ev.preventDefault(),ev.stopPropagation()):ev.target!==document||"touchmove"!==ev.type&&"scroll"!==ev.type||(this.close(),ev.preventDefault(),ev.stopPropagation()))}}]),Scrim}();function deepActiveElement(){for(var _a3,a=document.activeElement;null==(_a3=null==a?void 0:a.shadowRoot)?void 0:_a3.activeElement;)a=a.shadowRoot.activeElement;return a}var variantPanelController,VARIANTS2={0:["\\varnothing","\\infty"],1:["\\frac{1}{#@}","#@^{-1}","\\times 10^{#?}","\\phi","\\imaginaryI"],2:["\\frac{1}{2}","#@^2","\\sqrt2","\\exponentialE"],3:["\\frac{1}{3}","#@^3","\\sqrt3","\\pi"],4:["\\frac{1}{4}","#@^4"],5:["\\frac{1}{5}","#@^5","\\sqrt5"],6:["\\frac{1}{6}","#@^6"],7:["\\frac{1}{7}","#@^7"],8:["\\frac{1}{8}","#@^8"],9:["\\frac{1}{9}","#@^9"],".":[".",",",";","\\colon"],a:[{latex:"\\aleph",aside:"aleph"},{latex:"\\forall",aside:"for all"}],b:[{latex:"\\beth",aside:"beth"}],c:[{latex:"\\C",aside:"set of complex numbers"}],d:[{latex:"\\daleth",aside:"daleth"}],e:[{latex:"\\exponentialE",aside:"exponential e"},{latex:"\\exists",aside:"there is"},{latex:"\\nexists",aside:"there isn’t"}],g:[{latex:"\\gimel",aside:"gimel"}],h:[{latex:"\\hbar",aside:"h bar"},{latex:"\\hslash",aside:"h slash"}],i:[{latex:"\\imaginaryI",aside:"imaginary i"}],j:[{latex:"\\imaginaryJ",aside:"imaginary j"}],l:[{latex:"\\ell",aside:"ell"}],n:[{latex:"\\mathbb{N}",aside:"set of natural numbers"}],p:[{latex:"\\mathbb{P}",aside:"set of primes"}],q:[{latex:"\\mathbb{Q}",aside:"set of rational numbers"}],r:[{latex:"\\mathbb{R}",aside:"set of real numbers"}],z:[{latex:"\\mathbb{Z}",aside:"set of integers"}],space:[{latex:'\\char"203A\\!\\char"2039',insert:"\\!",aside:"negative thin space<br>⁻³⧸₁₈ em"},{latex:'\\char"203A\\,\\char"2039',insert:"\\,",aside:"thin space<br>³⧸₁₈ em"},{latex:'\\char"203A\\:\\char"2039',insert:"\\:",aside:"medium space<br>⁴⧸₁₈ em"},{latex:'\\char"203A\\;\\char"2039',insert:"\\;",aside:"thick space<br>⁵⧸₁₈ em"},{latex:'\\char"203A\\ \\char"2039',insert:"\\ ",aside:"⅓ em"},{latex:'\\char"203A\\enspace\\char"2039',insert:"\\enspace",aside:"½ em"},{latex:'\\char"203A\\quad\\char"2039',insert:"\\quad",aside:"1 em"},{latex:'\\char"203A\\qquad\\char"2039',insert:"\\qquad",aside:"2 em"}]};function showVariantsPanel(element,onClose){var _a3,_b3,_c2,keyboard=VirtualKeyboard.singleton;if(keyboard){var keycap=parentKeycap(element),variantDef=null!=(_b3=null==(_a3=keyboard.getKeycap(null==keycap?void 0:keycap.id))?void 0:_a3.variants)?_b3:"";if("string"==typeof variantDef&&!hasVariants(variantDef)||Array.isArray(variantDef)&&0===variantDef.length)null==onClose||onClose();else{var _step108,variants={},markup="",_iterator108=_createForOfIteratorHelper(function(id){var _a3;return"string"!=typeof id?id:(VARIANTS2[id]||(VARIANTS2[id]=null!=(_a3=function(id){if("foreground-color"===id){for(var result=[],_i19=0,_Object$keys9=Object.keys(FOREGROUND_COLORS);_i19<_Object$keys9.length;_i19++){var color=_Object$keys9[_i19];result.push({class:"swatch-button",label:'<span style="border: 3px solid '+FOREGROUND_COLORS[color]+'"></span>',command:["applyStyle",{color:color}]})}return result}if("background-color"===id){for(var _result3=[],_i20=0,_Object$keys10=Object.keys(BACKGROUND_COLORS);_i20<_Object$keys10.length;_i20++){var _color=_Object$keys10[_i20];_result3.push({class:"swatch-button",label:'<span style="background:'+BACKGROUND_COLORS[_color]+'"></span>',command:["applyStyle",{backgroundColor:_color}]})}return _result3}}(id))?_a3:[]),VARIANTS2[id])}(variantDef));try{for(_iterator108.s();!(_step108=_iterator108.n()).done;){var keycap2=normalizeKeycap(_step108.value),id=Date.now().toString(36).slice(-2)+Math.floor(1e5*Math.random()).toString(36);variants[id]=keycap2;var _renderKeycap2=_slicedToArray(renderKeycap(keycap2),2),keycapMarkup=_renderKeycap2[0],keycapCls=_renderKeycap2[1];markup+="<div id=".concat(id,' class="item ').concat(keycapCls,'">').concat(keycapMarkup,"</div>")}}catch(err){_iterator108.e(err)}finally{_iterator108.f()}var variantPanel=document.createElement("div");variantPanel.setAttribute("aria-hidden","true"),variantPanel.className="MLK__variant-panel",variantPanel.style.height="auto";var l=Object.keys(variants).length,w=5;1===l?w=1:2===l||4===l?w=2:3===l||5===l||6===l?w=3:l>=7&&l<14&&(w=4),variantPanel.style.width="calc(var(--variant-keycap-length) * ".concat(w," + 12px)"),variantPanel.innerHTML=mathfield_element_default.createHTML(markup),Scrim.scrim||(Scrim.scrim=new Scrim),Scrim.scrim.open({root:null==(_c2=null==keyboard?void 0:keyboard.container)?void 0:_c2.querySelector(".ML__keyboard"),child:variantPanel}),null==variantPanelController||variantPanelController.abort(),variantPanelController=new AbortController,variantPanel.addEventListener("pointerup",(function(ev){var target=parentKeycap(ev.target);(null==target?void 0:target.id)&&variants[target.id]&&(executeKeycapCommand(variants[target.id]),hideVariantsPanel(),null==onClose||onClose(),ev.preventDefault())}),{capture:!0,passive:!1,signal:variantPanelController.signal}),variantPanel.addEventListener("pointerenter",(function(ev){var target=parentKeycap(ev.target);(null==target?void 0:target.id)&&variants[target.id]&&target.classList.add("is-active")}),{capture:!0,signal:variantPanelController.signal}),variantPanel.addEventListener("pointerleave",(function(ev){var target=parentKeycap(ev.target);(null==target?void 0:target.id)&&variants[target.id]&&target.classList.remove("is-active")}),{capture:!0,signal:variantPanelController.signal}),window.addEventListener("pointercancel",(function(){hideVariantsPanel(),null==onClose||onClose()}),{signal:variantPanelController.signal}),window.addEventListener("pointerup",(function(){hideVariantsPanel(),null==onClose||onClose()}),{signal:variantPanelController.signal});var position=null==element?void 0:element.getBoundingClientRect();if(position){position.top-variantPanel.clientHeight<0&&(variantPanel.style.width="auto",l<=6?variantPanel.style.height="56px":l<=12?variantPanel.style.height="108px":l<=18?variantPanel.style.height="205px":variantPanel.classList.add("compact"));var left=Math.max(0,Math.min(window.innerWidth-variantPanel.offsetWidth,(position.left+position.right-variantPanel.offsetWidth)/2)),top=position.top-variantPanel.clientHeight+5;variantPanel.style.transform="translate(".concat(left,"px, ").concat(top,"px)"),variantPanel.classList.add("is-visible")}}}}function hideVariantsPanel(){var _a3;null==variantPanelController||variantPanelController.abort(),null==(_a3=Scrim.scrim)||_a3.close()}function hasVariants(id){return void 0!==VARIANTS2[id]}function jsonToCss(json){return Object.keys(json).map((function(k){return"".concat(k," {").concat(function(json){return"string"==typeof json?json:Object.entries(json).map((function(_ref4){var _ref5=_slicedToArray(_ref4,2),k=_ref5[0],v=_ref5[1];return"".concat(k,":").concat(v," !important")})).join(";")}(json[k]),"}")})).join("")}function latexToMarkup2(latex){if(!latex)return"";var context=new Context,root=new Atom({mode:"math",type:"root",body:parseLatex(latex,{context:context,args:function(arg){return"@"===arg?"{\\class{ML__box-placeholder}{\\blacksquare}}":"\\placeholder{}"}})});return makeStruts(coalesce(applyInterBoxSpacing(new Box(root.render(context),{classes:"ML__base"}),context)),{classes:"ML__mathlive"}).toMarkup()}function normalizeLayer(layer){if(Array.isArray(layer))return layer.map((function(x){return normalizeLayer(x)})).flat();var result="string"==typeof layer?{markup:layer}:layer;return"rows"in result&&Array.isArray(result.rows)&&(result.rows=result.rows.map((function(row){return row.map((function(x){return normalizeKeycap(x)}))}))),null!=result.id||(result.id="ML__layer_"+Date.now().toString(36).slice(-2)+Math.floor(1e5*Math.random()).toString(36)),[result]}function normalizeLayout(layout){if("alphabetic"===layout)return function(){var _a3,_b3,layoutName=window.mathVirtualKeyboard.alphabeticLayout;if("auto"===layoutName){var activeLayout=getActiveKeyboardLayout();activeLayout&&(layoutName=activeLayout.virtualLayout),layoutName&&"auto"!==layoutName||(layoutName=null!=(_a3={fr:"azerty",be:"azerty",al:"qwertz",ba:"qwertz",cz:"qwertz",de:"qwertz",hu:"qwertz",sk:"qwertz",ch:"qwertz"}[l10n.locale.slice(0,2)])?_a3:"qwerty")}var _step109,ALPHABETIC_TEMPLATE={qwerty:["qwertyuiop"," asdfghjkl ","^zxcvbnm~"],azerty:["azertyuiop","qsdfghjklm","^ wxcvbn ~"],qwertz:["qwertzuiop"," asdfghjkl ","^yxcvbnm~"],dvorak:["^  pyfgcrl ","aoeuidhtns","qjkxbmwvz~"],colemak:[" qwfpgjluy ","arstdhneio","^zxcvbkm~"]},rows=[[{label:"1",variants:"1"},{label:"2",variants:"2"},{label:"3",variants:"3"},{label:"4",variants:"4"},{label:"5",shift:{latex:"\\frac{#@}{#?}"},variants:"5"},{label:"6",shift:{latex:"#@^#?"},variants:"6"},{label:"7",variants:"4"},{label:"8",shift:{latex:"\\times"},variants:"8"},{label:"9",shift:{label:"(",latex:"("},variants:"9"},{label:"0",shift:{label:")",latex:")"},variants:"0"}]],_iterator109=_createForOfIteratorHelper(null!=(_b3=ALPHABETIC_TEMPLATE[layoutName])?_b3:ALPHABETIC_TEMPLATE.qwerty);try{for(_iterator109.s();!(_step109=_iterator109.n()).done;){var _step110,templateRow=_step109.value,row=[],_iterator110=_createForOfIteratorHelper(templateRow);try{for(_iterator110.s();!(_step110=_iterator110.n()).done;){var k=_step110.value;/[a-z]/.test(k)?row.push({label:k,class:"hide-shift",shift:{label:k.toUpperCase()},variants:hasVariants(k)?k:void 0}):"~"===k?"dvorak"!==layoutName?row.push("[backspace]"):row.push({label:"[backspace]",width:1}):"^"===k?row.push("[shift]"):" "===k&&row.push("[separator-5]")}}catch(err){_iterator110.e(err)}finally{_iterator110.f()}rows.push(row)}}catch(err){_iterator109.e(err)}finally{_iterator109.f()}return rows.push(["[-]","[+]","[=]",{label:" ",width:1.5},",","[.]","[left]","[right]",{label:"[action]",width:1.5}]),{label:"abc",labelClass:"MLK__tex-math",tooltip:"keyboard.tooltip.alphabetic",layers:normalizeLayer({rows:rows})}}();if("string"==typeof layout)return console.assert(void 0!==LAYOUTS[layout],'MathLive 0.94.6: unknown keyboard layout "'.concat(layout,'"')),normalizeLayout(LAYOUTS[layout]);var result;if("rows"in layout&&Array.isArray(layout.rows)){console.assert(!("layers"in layout||"markup"in layout),'MathLive 0.94.6: when providing a "rows" property, "layers" and "markup" are ignored');var _a3=layout,partialLayout=(_a3.rows,__objRest(_a3,["rows"]));result=__spreadProps(__spreadValues({},partialLayout),{layers:normalizeLayer({rows:layout.rows})})}else if("markup"in layout&&"string"==typeof layout.markup){var _b3=layout,_partialLayout=(_b3.markup,__objRest(_b3,["markup"]));result=__spreadProps(__spreadValues({},_partialLayout),{layers:normalizeLayer(layout.markup)})}else result=__spreadValues({},layout),"layers"in layout?result.layers=normalizeLayer(layout.layers):console.error('MathLive 0.94.6: provide either a "rows", "markup" or "layers" property');var _step111,hasShift=!1,hasEdit=!1,_iterator111=_createForOfIteratorHelper(result.layers);try{for(_iterator111.s();!(_step111=_iterator111.n()).done;){var layer=_step111.value;if(layer.rows){var _step112,_iterator112=_createForOfIteratorHelper(layer.rows.flat());try{for(_iterator112.s();!(_step112=_iterator112.n()).done;){var keycap=_step112.value;isShiftKey(keycap)&&(hasShift=!0);var command=keycap.command;"string"==typeof command&&["undo","redo","cut","copy","paste"].includes(command)&&(hasEdit=!0)}}catch(err){_iterator112.e(err)}finally{_iterator112.f()}}}}catch(err){_iterator111.e(err)}finally{_iterator111.f()}return"displayShiftedKeycaps"in layout&&void 0!==layout.displayShiftedKeycaps||(result.displayShiftedKeycaps=hasShift),"displayEditToolbar"in layout&&void 0!==layout.displayEditToolbar||(result.displayEditToolbar=!hasEdit),result}function makeLayoutsToolbar(keyboard,index){var _a3,_b3,markup='<div class="left">';if(keyboard.normalizedLayouts.length>1){var _step113,_iterator113=_createForOfIteratorHelper(keyboard.normalizedLayouts.entries());try{for(_iterator113.s();!(_step113=_iterator113.n()).done;){var _step113$value=_slicedToArray(_step113.value,2),i=_step113$value[0],layout=_step113$value[1],classes=[i===index?"selected":"layer-switch"];layout.tooltip&&classes.push("MLK__tooltip"),layout.labelClass&&classes.push.apply(classes,_toConsumableArray(layout.labelClass.split(" "))),markup+='<div class="'.concat(classes.join(" "),'"'),layout.tooltip&&(markup+=" data-tooltip='"+(null!=(_a3=localize(layout.tooltip))?_a3:layout.tooltip)+"' "),i!==index&&(markup+='data-layer="'.concat(layout.layers[0].id,'"')),markup+=">".concat(null!=(_b3=layout.label)?_b3:"untitled","</div>")}}catch(err){_iterator113.e(err)}finally{_iterator113.f()}}return markup+="</div>"}function makeEditToolbar(options,mathfield){var result="";if("none"===options.editToolbar)return"";var availableActions=[];mathfield.selectionIsCollapsed?availableActions.push("undo","redo","pasteFromClipboard"):availableActions.push("cutToClipboard","copyToClipboard","pasteFromClipboard");var actionsMarkup={undo:"<div class='action ".concat(!1===mathfield.canUndo?"disabled":"","'\n          data-command='\"undo\"'\n          data-tooltip='").concat(localize("tooltip.undo"),"'>\n          <svg><use xlink:href='#svg-undo' /></svg>\n      </div>"),redo:"<div class='action ".concat(!1===mathfield.canRedo?"disabled":"","'\n          data-command='\"redo\"'\n          data-tooltip='").concat(localize("tooltip.redo"),"'>\n          <svg><use xlink:href='#svg-redo' /></svg>\n      </div>"),cutToClipboard:"\n        <div class='action'\n            data-command='\"cutToClipboard\"'\n            data-tooltip='".concat(localize("tooltip.cut to clipboard"),"'>\n            <svg><use xlink:href='#svg-cut' /></svg>\n        </div>\n    "),copyToClipboard:"\n        <div class='action'\n            data-command='\"copyToClipboard\"'\n            data-tooltip='".concat(localize("tooltip.copy to clipboard"),"'>\n            <svg><use xlink:href='#svg-copy' /></svg>\n        </div>\n    "),pasteFromClipboard:"\n        <div class='action'\n            data-command='\"pasteFromClipboard\"'\n            data-tooltip='".concat(localize("tooltip.paste from clipboard"),"'>\n            <svg><use xlink:href='#svg-paste' /></svg>\n        </div>\n    ")};return result+=availableActions.map((function(action){return actionsMarkup[action]})).join("")}function makeSyntheticKeycap(element){var keyboard=VirtualKeyboard.singleton;if(keyboard){var keycap={};if(!element.id){if(element.hasAttribute("data-label")&&(keycap.label=element.dataset.label),element.hasAttribute("data-latex")&&(keycap.latex=element.dataset.latex),element.hasAttribute("data-key")&&(keycap.key=element.dataset.key),element.hasAttribute("data-insert")&&(keycap.insert=element.dataset.insert),element.hasAttribute("data-variants")&&(keycap.variants=element.dataset.variants),element.hasAttribute("data-aside")&&(keycap.aside=element.dataset.aside),element.className&&(keycap.class=element.className),keycap.label||keycap.latex||keycap.key||keycap.insert||(keycap.latex=element.innerText,keycap.label=element.innerHTML),element.hasAttribute("data-command"))try{keycap.command=JSON.parse(element.dataset.command)}catch(e){}element.id=keyboard.registerKeycap(keycap)}if(!element.innerHTML){var _renderKeycap4=_slicedToArray(renderKeycap(keycap),2),markup=_renderKeycap4[0];_renderKeycap4[1],element.innerHTML=window.MathfieldElement.createHTML(markup)}}}function makeKeyboardElement(keyboard){keyboard.resetKeycapRegistry(),injectStylesheet("virtual-keyboard"),injectStylesheet("core"),loadFonts();var result=document.createElement("div");result.className="ML__keyboard";var plate=document.createElement("div");plate.className="MLK__plate",plate.innerHTML=window.MathfieldElement.createHTML('<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">\n\n<symbol id="svg-delete-backward" viewBox="0 0 576 512">\n  <path d="M432.1 208.1L385.9 256L432.1 303C442.3 312.4 442.3 327.6 432.1 336.1C423.6 346.3 408.4 346.3 399 336.1L352 289.9L304.1 336.1C295.6 346.3 280.4 346.3 271 336.1C261.7 327.6 261.7 312.4 271 303L318.1 256L271 208.1C261.7 199.6 261.7 184.4 271 175C280.4 165.7 295.6 165.7 304.1 175L352 222.1L399 175C408.4 165.7 423.6 165.7 432.1 175C442.3 184.4 442.3 199.6 432.1 208.1V208.1zM512 64C547.3 64 576 92.65 576 128V384C576 419.3 547.3 448 512 448H205.3C188.3 448 172 441.3 160 429.3L9.372 278.6C3.371 272.6 0 264.5 0 256C0 247.5 3.372 239.4 9.372 233.4L160 82.75C172 70.74 188.3 64 205.3 64L512 64zM528 128C528 119.2 520.8 112 512 112H205.3C201 112 196.9 113.7 193.9 116.7L54.63 256L193.9 395.3C196.9 398.3 201 400 205.3 400H512C520.8 400 528 392.8 528 384V128z"/>\n</symbol>\n\n<symbol id="svg-shift" viewBox="0 0 384 512">\n  <path d="M2.438 252.3C7.391 264.2 19.06 272 32 272h80v160c0 26.51 21.49 48 48 48h64C250.5 480 272 458.5 272 432v-160H352c12.94 0 24.61-7.797 29.56-19.75c4.953-11.97 2.219-25.72-6.938-34.88l-160-176C208.4 35.13 200.2 32 192 32S175.6 35.13 169.4 41.38l-160 176C.2188 226.5-2.516 240.3 2.438 252.3zM192 86.63L313.4 224H224v208H160V224H70.63L192 86.63z"/>\n</symbol>\n\n<symbol id="svg-commit" viewBox="0 0 512 512">\n  <path d="M135 432.1l-128-128C2.344 300.3 0 294.2 0 288s2.344-12.28 7.031-16.97l128-128c9.375-9.375 24.56-9.375 33.94 0s9.375 24.56 0 33.94L81.94 264H464v-208C464 42.75 474.8 32 488 32S512 42.75 512 56V288c0 13.25-10.75 24-24 24H81.94l87.03 87.03c9.375 9.375 9.375 24.56 0 33.94S144.4 442.3 135 432.1z"/>\n</symbol>\n\n<symbol id="svg-command" viewBox="0 0 640 512">\n  <path d="M34.495 36.465l211.051 211.05c4.686 4.686 4.686 12.284 0 16.971L34.495 475.535c-4.686 4.686-12.284 4.686-16.97 0l-7.071-7.07c-4.686-4.686-4.686-12.284 0-16.971L205.947 256 10.454 60.506c-4.686-4.686-4.686-12.284 0-16.971l7.071-7.07c4.686-4.687 12.284-4.687 16.97 0zM640 468v-10c0-6.627-5.373-12-12-12H300c-6.627 0-12 5.373-12 12v10c0 6.627 5.373 12 12 12h328c6.627 0 12-5.373 12-12z"/>\n</symbol>\n\n<symbol id="svg-undo" viewBox="0 0 512 512">\n  <path d="M20 8h10c6.627 0 12 5.373 12 12v110.625C85.196 57.047 165.239 7.715 256.793 8.001 393.18 8.428 504.213 120.009 504 256.396 503.786 393.181 392.834 504 256 504c-63.926 0-122.202-24.187-166.178-63.908-5.113-4.618-5.354-12.561-.482-17.433l7.069-7.069c4.503-4.503 11.749-4.714 16.482-.454C150.782 449.238 200.935 470 256 470c117.744 0 214-95.331 214-214 0-117.744-95.331-214-214-214-82.862 0-154.737 47.077-190.289 116H180c6.627 0 12 5.373 12 12v10c0 6.627-5.373 12-12 12H20c-6.627 0-12-5.373-12-12V20c0-6.627 5.373-12 12-12z"/>\n</symbol>\n<symbol id="svg-redo" viewBox="0 0 512 512">\n  <path d="M492 8h-10c-6.627 0-12 5.373-12 12v110.625C426.804 57.047 346.761 7.715 255.207 8.001 118.82 8.428 7.787 120.009 8 256.396 8.214 393.181 119.166 504 256 504c63.926 0 122.202-24.187 166.178-63.908 5.113-4.618 5.354-12.561.482-17.433l-7.069-7.069c-4.503-4.503-11.749-4.714-16.482-.454C361.218 449.238 311.065 470 256 470c-117.744 0-214-95.331-214-214 0-117.744 95.331-214 214-214 82.862 0 154.737 47.077 190.289 116H332c-6.627 0-12 5.373-12 12v10c0 6.627 5.373 12 12 12h160c6.627 0 12-5.373 12-12V20c0-6.627-5.373-12-12-12z"/>\n</symbol>\n<symbol id="svg-arrow-left" viewBox="0 0 320 512">\n  <path d="M206.7 464.6l-183.1-191.1C18.22 267.1 16 261.1 16 256s2.219-11.97 6.688-16.59l183.1-191.1c9.152-9.594 24.34-9.906 33.9-.7187c9.625 9.125 9.938 24.37 .7187 33.91L73.24 256l168 175.4c9.219 9.5 8.906 24.78-.7187 33.91C231 474.5 215.8 474.2 206.7 464.6z"/>\n</symbol>\n<symbol id="svg-arrow-right" viewBox="0 0 320 512">\n  <path d="M113.3 47.41l183.1 191.1c4.469 4.625 6.688 10.62 6.688 16.59s-2.219 11.97-6.688 16.59l-183.1 191.1c-9.152 9.594-24.34 9.906-33.9 .7187c-9.625-9.125-9.938-24.38-.7187-33.91l168-175.4L78.71 80.6c-9.219-9.5-8.906-24.78 .7187-33.91C88.99 37.5 104.2 37.82 113.3 47.41z"/>\n</symbol>\n<symbol id="svg-tab" viewBox="0 0 448 512">\n  <path d="M32 217.1c0-8.8 7.2-16 16-16h144v-93.9c0-7.1 8.6-10.7 13.6-5.7l143.5 143.1c6.3 6.3 6.3 16.4 0 22.7L205.6 410.4c-5 5-13.6 1.5-13.6-5.7v-93.9H48c-8.8 0-16-7.2-16-16v-77.7m-32 0v77.7c0 26.5 21.5 48 48 48h112v61.9c0 35.5 43 53.5 68.2 28.3l143.6-143c18.8-18.8 18.8-49.2 0-68L228.2 78.9c-25.1-25.1-68.2-7.3-68.2 28.3v61.9H48c-26.5 0-48 21.6-48 48zM436 64h-8c-6.6 0-12 5.4-12 12v360c0 6.6 5.4 12 12 12h8c6.6 0 12-5.4 12-12V76c0-6.6-5.4-12-12-12z"/>\n</symbol>\n<symbol id="svg-paste" viewBox="0 0 512 512"><path d="M160 32c11.6 0 21.3 8.2 23.5 19.2C185 58.6 191.6 64 199.2 64H208c8.8 0 16 7.2 16 16V96H96V80c0-8.8 7.2-16 16-16h8.8c7.6 0 14.2-5.4 15.7-12.8C138.7 40.2 148.4 32 160 32zM64 64h2.7C65 69 64 74.4 64 80V96c0 17.7 14.3 32 32 32H224c17.7 0 32-14.3 32-32V80c0-5.6-1-11-2.7-16H256c17.7 0 32 14.3 32 32h32c0-35.3-28.7-64-64-64H210.6c-9-18.9-28.3-32-50.6-32s-41.6 13.1-50.6 32H64C28.7 32 0 60.7 0 96V384c0 35.3 28.7 64 64 64H192V416H64c-17.7 0-32-14.3-32-32V96c0-17.7 14.3-32 32-32zM288 480c-17.7 0-32-14.3-32-32V192c0-17.7 14.3-32 32-32h96v56c0 22.1 17.9 40 40 40h56V448c0 17.7-14.3 32-32 32H288zM416 165.3L474.7 224H424c-4.4 0-8-3.6-8-8V165.3zM448 512c35.3 0 64-28.7 64-64V235.9c0-12.7-5.1-24.9-14.1-33.9l-59.9-59.9c-9-9-21.2-14.1-33.9-14.1H288c-35.3 0-64 28.7-64 64V448c0 35.3 28.7 64 64 64H448z"/></symbol>\n<symbol id="svg-cut" viewBox="0 0 512 512"><path d="M485.6 444.2L333.6 314.9C326.9 309.2 326.1 299.1 331.8 292.4C337.5 285.6 347.6 284.8 354.4 290.5L506.4 419.8C513.1 425.5 513.9 435.6 508.2 442.4C502.5 449.1 492.4 449.9 485.6 444.2zM485.7 67.76C492.5 62.07 502.5 62.94 508.2 69.69C513.9 76.45 513.1 86.55 506.3 92.24L208.5 343.1C218.3 359.7 224 379.2 224 400C224 461.9 173.9 512 112 512C50.14 512 0 461.9 0 400C0 338.1 50.14 288 112 288C141.5 288 168.4 299.4 188.4 318.1L262.2 256L188.4 193.9C168.4 212.6 141.5 224 112 224C50.14 224 0 173.9 0 112C0 50.14 50.14 0 112 0C173.9 0 224 50.14 224 112C224 132.8 218.3 152.3 208.5 168.9L287 235.1L485.7 67.76zM32 112C32 156.2 67.82 192 112 192C156.2 192 192 156.2 192 112C192 67.82 156.2 32 112 32C67.82 32 32 67.82 32 112zM112 480C156.2 480 192 444.2 192 400C192 355.8 156.2 320 112 320C67.82 320 32 355.8 32 400C32 444.2 67.82 480 112 480z"/></symbol>\n<symbol id="svg-copy" viewBox="0 0 512 512"><path d="M272 416C263.2 416 256 423.2 256 432V448c0 17.67-14.33 32-32 32H64c-17.67 0-32-14.33-32-32V192c0-17.67 14.33-32 32-32h112C184.8 160 192 152.8 192 144C192 135.2 184.8 128 176 128H63.99c-35.35 0-64 28.65-64 64l.0098 256C0 483.3 28.65 512 64 512h160c35.35 0 64-28.65 64-64v-16C288 423.2 280.8 416 272 416zM502.6 86.63l-77.25-77.25C419.4 3.371 411.2 0 402.7 0H288C252.7 0 224 28.65 224 64v256c0 35.35 28.65 64 64 64h160c35.35 0 64-28.65 64-64V109.3C512 100.8 508.6 92.63 502.6 86.63zM416 45.25L466.7 96H416V45.25zM480 320c0 17.67-14.33 32-32 32h-160c-17.67 0-32-14.33-32-32V64c0-17.67 14.33-32 32-32h96l.0026 64c0 17.67 14.33 32 32 32H480V320z"/>\n</symbol>\n<symbol id="svg-angle-double-right" viewBox="0 0 512 512"><path d="M470.6 278.6c12.5-12.5 12.5-32.8 0-45.3l-160-160c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L402.7 256 265.4 393.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0l160-160zm-352 160l160-160c12.5-12.5 12.5-32.8 0-45.3l-160-160c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L210.7 256 73.4 393.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0z"/>\n</symbol>\n<symbol id="svg-angle-double-left" viewBox="0 0 512 512"><path d="M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256 246.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160zm352-160l-160 160c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L301.3 256 438.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0z"/>\n</symbol>\n<symbol id="svg-trash" viewBox="0 0 448 512">\n  <path d="M336 64l-33.6-44.8C293.3 7.1 279.1 0 264 0h-80c-15.1 0-29.3 7.1-38.4 19.2L112 64H24C10.7 64 0 74.7 0 88v2c0 3.3 2.7 6 6 6h26v368c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48V96h26c3.3 0 6-2.7 6-6v-2c0-13.3-10.7-24-24-24h-88zM184 32h80c5 0 9.8 2.4 12.8 6.4L296 64H152l19.2-25.6c3-4 7.8-6.4 12.8-6.4zm200 432c0 8.8-7.2 16-16 16H80c-8.8 0-16-7.2-16-16V96h320v368zm-176-44V156c0-6.6 5.4-12 12-12h8c6.6 0 12 5.4 12 12v264c0 6.6-5.4 12-12 12h-8c-6.6 0-12-5.4-12-12zm-80 0V156c0-6.6 5.4-12 12-12h8c6.6 0 12 5.4 12 12v264c0 6.6-5.4 12-12 12h-8c-6.6 0-12-5.4-12-12zm160 0V156c0-6.6 5.4-12 12-12h8c6.6 0 12 5.4 12 12v264c0 6.6-5.4 12-12 12h-8c-6.6 0-12-5.4-12-12z"/>\n</symbol>\n<symbol id="svg-keyboard-down" viewBox="0 0 576 512"><path d="M64 48c-8.8 0-16 7.2-16 16V240c0 8.8 7.2 16 16 16H512c8.8 0 16-7.2 16-16V64c0-8.8-7.2-16-16-16H64zM0 64C0 28.7 28.7 0 64 0H512c35.3 0 64 28.7 64 64V240c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64V64zM159 359c9.4-9.4 24.6-9.4 33.9 0l95 95 95-95c9.4-9.4 24.6-9.4 33.9 0s9.4 24.6 0 33.9L305 505c-4.5 4.5-10.6 7-17 7s-12.5-2.5-17-7L159 393c-9.4-9.4-9.4-24.6 0-33.9zm1-167c0-8.8 7.2-16 16-16H400c8.8 0 16 7.2 16 16v16c0 8.8-7.2 16-16 16H176c-8.8 0-16-7.2-16-16V192zM120 88h16c8.8 0 16 7.2 16 16v16c0 8.8-7.2 16-16 16H120c-8.8 0-16-7.2-16-16V104c0-8.8 7.2-16 16-16zm64 16c0-8.8 7.2-16 16-16h16c8.8 0 16 7.2 16 16v16c0 8.8-7.2 16-16 16H200c-8.8 0-16-7.2-16-16V104zm96-16h16c8.8 0 16 7.2 16 16v16c0 8.8-7.2 16-16 16H280c-8.8 0-16-7.2-16-16V104c0-8.8 7.2-16 16-16zm64 16c0-8.8 7.2-16 16-16h16c8.8 0 16 7.2 16 16v16c0 8.8-7.2 16-16 16H360c-8.8 0-16-7.2-16-16V104zm96-16h16c8.8 0 16 7.2 16 16v16c0 8.8-7.2 16-16 16H440c-8.8 0-16-7.2-16-16V104c0-8.8 7.2-16 16-16z"/></symbol>\n</svg>'+keyboard.normalizedLayouts.map((function(x,i){return function(keyboard,layout,index){var markup=[];if(!("layers"in layout))return"";var _step117,_iterator117=_createForOfIteratorHelper(layout.layers);try{for(_iterator117.s();!(_step117=_iterator117.n()).done;){var layer=_step117.value;markup.push('<div tabindex="-1" class="MLK__layer" id="'.concat(layer.id,'">')),(keyboard.normalizedLayouts.length>1||layout.displayEditToolbar)&&(markup.push("<div class='MLK__toolbar' role='toolbar'>"),markup.push(makeLayoutsToolbar(keyboard,index)),layout.displayEditToolbar&&markup.push('<div class="ML__edit-toolbar right"></div>'),markup.push("</div>")),markup.push(makeLayer(keyboard,layer)),markup.push("</div>")}}catch(err){_iterator117.e(err)}finally{_iterator117.f()}return markup.join("")}(keyboard,x,i)})).join(""));var backdrop=document.createElement("div");backdrop.className="MLK__backdrop",backdrop.appendChild(plate),result.appendChild(backdrop),result.addEventListener("pointerdown",handlePointerDown,{passive:!1});var toolbars=result.querySelectorAll(".ML__edit-toolbar");if(toolbars){var _step115,_iterator115=_createForOfIteratorHelper(toolbars);try{for(_iterator115.s();!(_step115=_iterator115.n()).done;)_step115.value.addEventListener("click",(function(ev){for(var _a3,_b3,target=ev.target,command="";target&&!command;)command=null!=(_a3=null==target?void 0:target.getAttribute("data-command"))?_a3:"",target=null!=(_b3=null==target?void 0:target.parentElement)?_b3:null;command&&keyboard.executeCommand(JSON.parse(command))}))}catch(err){_iterator115.e(err)}finally{_iterator115.f()}}!function(elementList){var _step114,_iterator114=_createForOfIteratorHelper(elementList);try{for(_iterator114.s();!(_step114=_iterator114.n()).done;)makeSyntheticKeycap(_step114.value)}catch(err){_iterator114.e(err)}finally{_iterator114.f()}}(result.querySelectorAll(".MLK__keycap, .action, .fnbutton, .bigfnbutton"));var layerElements=result.querySelectorAll(".MLK__layer");console.assert(layerElements.length>0,"No virtual keyboards available");var _step116,_iterator116=_createForOfIteratorHelper(layerElements);try{for(_iterator116.s();!(_step116=_iterator116.n()).done;)_step116.value.addEventListener("pointerdown",(function(evt){return evt.preventDefault()}))}catch(err){_iterator116.e(err)}finally{_iterator116.f()}return keyboard.currentLayer=keyboard.latentLayer,result}function makeLayer(keyboard,layer){if("string"==typeof layer)return layer;var layerMarkup="";if("string"==typeof layer.style?layerMarkup+="<style>".concat(layer.style,"</style>"):"object"===_typeof(layer.style)&&(layerMarkup+="<style>".concat(jsonToCss(layer.style),"</style>")),layer.backdrop&&(layerMarkup+="<div class='".concat(layer.backdrop,"'>")),layer.container&&(layerMarkup+="<div class='".concat(layer.container,"'>")),layer.rows){layerMarkup+="<div class='MLK__rows'>";var _step118,_iterator118=_createForOfIteratorHelper(layer.rows);try{for(_iterator118.s();!(_step118=_iterator118.n()).done;){var row=_step118.value;layerMarkup+="<div class=row>";var _step119,_iterator119=_createForOfIteratorHelper(row);try{for(_iterator119.s();!(_step119=_iterator119.n()).done;){var keycap=_step119.value;if(keycap){var keycapId=keyboard.registerKeycap(keycap),_renderKeycap6=_slicedToArray(renderKeycap(keycap),2),markup=_renderKeycap6[0],cls=_renderKeycap6[1];/(^|\s)separator/.test(cls)?layerMarkup+='<div class="'.concat(cls,'"'):layerMarkup+='<div tabindex="-1" id="'.concat(keycapId,'" class="').concat(cls,'"'),keycap.tooltip&&(layerMarkup+=' data-tooltip="'.concat(keycap.tooltip,'"')),layerMarkup+=">".concat(markup,"</div>")}}}catch(err){_iterator119.e(err)}finally{_iterator119.f()}layerMarkup+="</div>"}}catch(err){_iterator118.e(err)}finally{_iterator118.f()}layerMarkup+="</div>"}else layer.markup&&(layerMarkup+=layer.markup);return layer.container&&(layerMarkup+="</div>"),layer.backdrop&&(layerMarkup+="</div>"),layerMarkup}function renderKeycap(keycap){var _a3,_b3,_c2,_d2,_e,_f,_g,shiftLabel,options=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{shifted:!1},markup="",cls=null!=(_a3=keycap.class)?_a3:"";(options.shifted&&isShiftKey(keycap)&&(cls+=" is-active"),options.shifted&&"shift"in keycap)?("string"==typeof keycap.shift?markup=latexToMarkup2(keycap.shift):"object"===_typeof(keycap.shift)&&(markup=keycap.shift.label?keycap.shift.label:null!=(_b3=latexToMarkup2(keycap.shift.latex||keycap.shift.insert||"")||keycap.shift.key)?_b3:""),"object"===_typeof(keycap.shift)&&(cls=null!=(_d2=null!=(_c2=keycap.shift.class)?_c2:keycap.class)?_d2:"")):(markup=keycap.label?keycap.label:null!=(_e=latexToMarkup2(keycap.latex||keycap.insert||"")||keycap.key)?_e:"",keycap.shift&&(shiftLabel="string"==typeof keycap.shift?latexToMarkup2(keycap.shift):keycap.shift.label?keycap.shift.label:null!=(_f=latexToMarkup2(keycap.shift.latex||keycap.shift.insert||"")||keycap.shift.key)?_f:"",markup+='<span class="MLK__shift">'.concat(shiftLabel,"</span>")),keycap.aside&&(markup+="<aside>".concat(keycap.aside,"</aside>")));return keycap.layer&&!/layer-switch/.test(cls)&&(cls+=" layer-switch"),/(^|\s)(separator|action|shift|fnbutton|bigfnbutton)($|\s)/.test(cls)||(cls+=" MLK__keycap"),!/\bw[0-9]+\b/.test(cls)&&keycap.width&&(cls+=null!=(_g={0:" w0",.5:" w5",1.5:" w15",2:" w20",5:" w50"}[keycap.width])?_g:""),[markup,cls||"MLK__keycap"]}var pressAndHoldTimer,KEYCAP_SHORTCUTS={"[left]":{class:"action hide-shift",label:"<svg class=svg-glyph><use xlink:href=#svg-arrow-left /></svg>",command:["performWithFeedback","moveToPreviousChar"],shift:{label:"<svg class=svg-glyph><use xlink:href=#svg-angle-double-left /></svg>",command:["performWithFeedback","extendSelectionBackward"]}},"[right]":{class:"action hide-shift",label:"<svg class=svg-glyph><use xlink:href=#svg-arrow-right /></svg>",command:["performWithFeedback","moveToNextChar"],shift:{label:"<svg class=svg-glyph><use xlink:href=#svg-angle-double-right /></svg>",command:["performWithFeedback","extendSelectionForward"]}},"[return]":{class:"action",command:["performWithFeedback","commit"],width:1.5,label:"<svg class=svg-glyph><use xlink:href=#svg-commit /></svg>"},"[action]":{class:"action",command:["performWithFeedback","commit"],width:1.5,label:"<svg class=svg-glyph><use xlink:href=#svg-commit /></svg>"},"[hr]":{class:"separator horizontal-rule"},"[hide-keyboard]":{class:"action",command:["performWithFeedback","hideVirtualKeyboard"],width:1.5,label:"<svg class=svg-glyph-lg><use xlink:href=#svg-keyboard-down /></svg>"},"[.]":{variants:".",command:"insertDecimalSeparator",shift:",",class:"big-op hide-shift"},"[+]":{variants:[{latex:"\\sum_{#0}^{#0}",class:"small"},"\\oplus"],latex:"+",label:"+",class:"big-op hide-shift",shift:{latex:"\\sum",insert:"\\sum_{#?}^{#?}",class:"small"}},"[-]":{variants:["\\pm","\\ominus"],latex:"-",label:"&#x2212;",shift:"\\pm",class:"big-op hide-shift"},"[/]":{class:"big-op hide-shift",shift:{class:"",latex:"\\frac{1}{#@}"},variants:["/","\\div","\\%","\\oslash"],latex:"\\frac{#@}{#?}",label:"&divide;"},"[*]":{variants:[{latex:"\\prod_{#0}^{#0}",class:"small"},"\\otimes"],latex:"\\times",label:"&times;",shift:{latex:"\\prod",insert:"\\prod_{#?}^{#?}",class:"small"},class:"big-op hide-shift"},"[=]":{variants:["\\neq","\\equiv","\\varpropto","\\thickapprox","\\lt","\\gt","\\le","\\ge"],latex:"=",label:"=",shift:{label:"≠",latex:"\\ne"},class:"big-op hide-shift"},"[backspace]":{class:"action bottom right hide-shift",width:1.5,command:["performWithFeedback","deleteBackward"],label:"<svg class=svg-glyph><use xlink:href=#svg-delete-backward /></svg>",shift:{class:"action warning",label:"<svg class=svg-glyph><use xlink:href=#svg-trash /></svg>",command:"deleteAll"}},"[undo]":{class:"ghost if-can-undo",command:"undo",label:"<svg class=svg-glyph><use xlink:href=#svg-undo /></svg>",tooltip:localize("tooltip.undo")},"[redo]":{class:"ghost  if-can-redo",command:"redo",label:"<svg class=svg-glyph><use xlink:href=#svg-redo /></svg>",tooltip:localize("tooltip.redo")},"[(]":{variants:[{latex:"\\lbrack",key:"["},"\\langle","\\lfloor","\\lceil",{latex:"\\lbrace",key:"{"}],key:"(",label:"(",shift:{label:"[",key:"["},class:"hide-shift"},"[)]":{variants:[{latex:"\\rbrack",key:"]"},"\\rangle","\\rfloor","\\rceil",{latex:"\\rbrace",key:"]"}],key:")",label:")",shift:{label:"]",latex:"\\rbrack"},class:"hide-shift"},"[0]":{variants:"0",latex:"0",label:"0",shift:"\\infty",class:"hide-shift"},"[1]":{variants:"1",latex:"1",label:"1",shift:"#@^{-1}",class:"hide-shift"},"[2]":{variants:"2",latex:"2",label:"2",shift:"#@^2",class:"hide-shift"},"[3]":{variants:"3",latex:"3",label:"3",shift:"#@^3",class:"hide-shift"},"[4]":{variants:"4",latex:"4",label:"4",shift:"#@^4",class:"hide-shift"},"[5]":{variants:"5",latex:"5",label:"5",shift:"#@^5",class:"hide-shift"},"[6]":{variants:"6",latex:"6",label:"6",shift:"#@^6",class:"hide-shift"},"[7]":{variants:"7",latex:"7",label:"7",shift:"#@^7",class:"hide-shift"},"[8]":{variants:"8",latex:"8",label:"8",shift:"#@^8",class:"hide-shift"},"[9]":{variants:"9",latex:"9",label:"9",shift:"#@^9",class:"hide-shift"},"[separator-5]":{class:"separator",width:.5},"[separator]":{class:"separator"},"[separator-10]":{class:"separator"},"[separator-15]":{class:"separator",width:1.5},"[separator-20]":{class:"separator",width:2},"[separator-50]":{class:"separator",width:5},"[shift]":{class:"shift bottom left",width:1.5,label:"<span class=caps-lock-indicator></span><svg class=svg-glyph><use xlink:href=#svg-shift /></svg>"},"[foreground-color]":{variants:"foreground-color",command:["applyStyle",{color:"red"}],label:"<span style='border-radius: 50%;width:22px;height:22px; border: 3px solid #cc2428; box-sizing: border-box'>"},"[background-color]":{variants:"background-color",command:["applyStyle",{backgroundColor:"yellow"}],label:"<span style='border-radius: 50%;width:22px;height:22px; background:#fff590; box-sizing: border-box'></span>"}};function normalizeKeycap(keycap){var _a3;if("string"==typeof keycap){if(!KEYCAP_SHORTCUTS[keycap])return{latex:keycap};keycap={label:keycap}}var shortcut=void 0;return"label"in keycap&&keycap.label&&KEYCAP_SHORTCUTS[keycap.label]&&(shortcut=__spreadProps(__spreadValues(__spreadValues({},KEYCAP_SHORTCUTS[keycap.label]),keycap),{label:KEYCAP_SHORTCUTS[keycap.label].label})),"key"in keycap&&keycap.key&&KEYCAP_SHORTCUTS[keycap.key]&&(shortcut=__spreadProps(__spreadValues(__spreadValues({},KEYCAP_SHORTCUTS[keycap.key]),keycap),{key:KEYCAP_SHORTCUTS[keycap.key].key})),shortcut?("insertDecimalSeparator"===shortcut.command&&(shortcut.label=null!=(_a3=window.MathfieldElement.decimalSeparator)?_a3:"."),"[action]"===keycap.label&&(shortcut=__spreadValues(__spreadValues({},shortcut),window.mathVirtualKeyboard.actionKeycap)),"[shift]"===keycap.label&&(shortcut=__spreadValues(__spreadValues({},shortcut),window.mathVirtualKeyboard.shiftKeycap)),"[backspace]"===keycap.label&&(shortcut=__spreadValues(__spreadValues({},shortcut),window.mathVirtualKeyboard.backspaceKeycap)),"[tab]"===keycap.label&&(shortcut=__spreadValues(__spreadValues({},shortcut),window.mathVirtualKeyboard.tabKeycap)),shortcut):keycap}function handlePointerDown(ev){var _a3;if(0===ev.button){var keyboard=VirtualKeyboard.singleton;if(keyboard){for(var layerButton=ev.target;layerButton&&!layerButton.getAttribute("data-layer");)layerButton=layerButton.parentElement;if(layerButton)return keyboard.currentLayer=null!=(_a3=layerButton.getAttribute("data-layer"))?_a3:"",void ev.preventDefault();var target=parentKeycap(ev.target);if(null==target?void 0:target.id){var keycap=keyboard.getKeycap(target.id);if(keycap){console.assert("pointerdown"===ev.type);var controller=new AbortController;target.classList.add("is-pressed"),target.addEventListener("pointerenter",handleVirtualKeyboardEvent(controller),{capture:!0,signal:controller.signal}),target.addEventListener("pointerleave",handleVirtualKeyboardEvent(controller),{capture:!0,signal:controller.signal}),target.addEventListener("pointercancel",handleVirtualKeyboardEvent(controller),{signal:controller.signal}),target.addEventListener("pointerup",handleVirtualKeyboardEvent(controller),{signal:controller.signal}),isShiftKey(keycap)&&(target.classList.add("is-active"),keyboard.incrementShiftPress()),keycap.variants&&(pressAndHoldTimer&&clearTimeout(pressAndHoldTimer),pressAndHoldTimer=setTimeout((function(){target.classList.contains("is-pressed")&&(target.classList.remove("is-pressed"),target.classList.add("is-active"),ev.target&&"releasePointerCapture"in ev.target&&ev.target.releasePointerCapture(ev.pointerId),showVariantsPanel(target,(function(){controller.abort(),null==target||target.classList.remove("is-active")})))}),200)),ev.preventDefault()}}}}}function handleVirtualKeyboardEvent(controller){return function(ev){var target=parentKeycap(ev.target);if(null==target?void 0:target.id){var keyboard=VirtualKeyboard.singleton;if(keyboard){var keycap=keyboard.getKeycap(target.id);if(keycap)return"pointerenter"===ev.type&&ev.target===target&&ev.isPrimary&&target.classList.add("is-pressed"),"pointercancel"===ev.type?(target.classList.remove("is-pressed"),isShiftKey(keycap)&&(keyboard.decrementShiftPress(),target.classList.toggle("is-active",keyboard.isShifted)),void controller.abort()):"pointerleave"===ev.type&&ev.target===target?(target.classList.remove("is-pressed"),void(isShiftKey(keycap)&&(keyboard.decrementShiftPress(),target.classList.toggle("is-active",keyboard.isShifted)))):"pointerup"===ev.type?(pressAndHoldTimer&&clearTimeout(pressAndHoldTimer),isShiftKey(keycap)?target.classList.toggle("is-active",keyboard.isShifted):target.classList.contains("is-pressed")&&(target.classList.remove("is-pressed"),keyboard.isShifted&&keycap.shift?"string"==typeof keycap.shift?keyboard.executeCommand(["insert",keycap.shift,{focus:!0,feedback:!0,scrollIntoView:!0,mode:"math",format:"latex",resetStyle:!0}]):executeKeycapCommand(keycap.shift):executeKeycapCommand(keycap),1===keyboard.shiftPressCount&&keyboard.resetShiftPress()),controller.abort(),void ev.preventDefault()):void 0}}}}function executeKeycapCommand(keycap){var _a3,command=keycap.command;!command&&keycap.insert&&(command=["insert",keycap.insert,{focus:!0,feedback:!0,scrollIntoView:!0,mode:"math",format:"latex",resetStyle:!0}]),!command&&keycap.key&&(command=["typedText",keycap.key,{focus:!0,feedback:!0,simulateKeystroke:!0}]),!command&&keycap.latex&&(command=["insert",keycap.latex,{focus:!0,feedback:!0,scrollIntoView:!0,mode:"math",format:"latex",resetStyle:!0}]),command||(command=["typedText",keycap.label,{focus:!0,feedback:!0,simulateKeystroke:!0}]),null==(_a3=VirtualKeyboard.singleton)||_a3.executeCommand(command)}function isKeycapElement(el){if(1!==el.nodeType)return!1;var classes=el.classList;return classes.contains("MLK__keycap")||classes.contains("shift")||classes.contains("action")||classes.contains("fnbutton")||classes.contains("bigfnbutton")}function parentKeycap(el){if(el){for(var node=el;node&&!isKeycapElement(node);)node=node.parentElement;return null!=node?node:void 0}}function isShiftKey(k){return!!k.class&&/(^|\s)shift($|\s)/.test(k.class)}var VirtualKeyboard=function(){function VirtualKeyboard(){var _a3,_b3,_c2,_this28=this;_classCallCheck(this,VirtualKeyboard),this.originalContainerBottomPadding=null,this.keycapRegistry={},this._isCapslock=!1,this._shiftPressCount=0,this._isShifted=!1,this.targetOrigin=window.origin,this.originValidator="none",this._alphabeticLayout="auto",this._layouts=Object.freeze(["default"]),this._editToolbar="default",this._container=null!=(_b3=null==(_a3=window.document)?void 0:_a3.body)?_b3:null,this._visible=!1,this._rebuilding=!1,this.observer=new ResizeObserver((function(_entries){_this28.adjustBoundingRect(),_this28.dispatchEvent(new Event("geometrychange")),_this28.sendMessage("geometry-changed",{boundingRect:_this28.boundingRect})})),this.listeners={},null==(_c2=window.top)||_c2.addEventListener("message",this),document.body.addEventListener("focusin",(function(event){var _a4,target=event.target;if((null==target?void 0:target.isConnected)&&"math-field"===(null==(_a4=target.tagName)?void 0:_a4.toLowerCase())&&("matchMedia"in window?window.matchMedia("(any-pointer: coarse)").matches:"ontouchstart"in window||navigator.maxTouchPoints>0)){var mf=target;"auto"!==mf.mathVirtualKeyboardPolicy||mf.readOnly||_this28.show({animate:!0})}})),document.addEventListener("focusout",(function(evt){"manual"!==evt.target.mathVirtualKeyboardPolicy&&setTimeout((function(){for(var _a4,_b4,_c3,target2=document.activeElement,focusedMathfield=!1;target2;){if("math-field"===(null==(_a4=target2.tagName)?void 0:_a4.toLowerCase())){focusedMathfield=!0;break}target2=null!=(_c3=null==(_b4=target2.shadowRoot)?void 0:_b4.activeElement)?_c3:null}focusedMathfield||_this28.hide()}),300)}))}return _createClass(VirtualKeyboard,[{key:"currentLayer",get:function(){var _a3,_b3,_c2;return null!=(_c2=null==(_b3=null==(_a3=this._element)?void 0:_a3.querySelector(".MLK__layer.is-visible"))?void 0:_b3.id)?_c2:""},set:function(id){var _a3;if(this._element){var newActive=id?this._element.querySelector("#".concat(id,".MLK__layer")):null;newActive||(newActive=this._element.querySelector(".MLK__layer")),newActive&&(null==(_a3=this._element.querySelector(".MLK__layer.is-visible"))||_a3.classList.remove("is-visible"),newActive.classList.add("is-visible")),this.isShifted&&this.render()}else this.latentLayer=id}},{key:"isCapslock",get:function(){return this._isCapslock},set:function(val){var _a3;null==(_a3=this._element)||_a3.classList.toggle("is-caps-lock",2===this.shiftPressCount),val!==this._isCapslock&&(this._isCapslock=val,this.isShifted=val)}},{key:"shiftPressCount",get:function(){return this._shiftPressCount}},{key:"incrementShiftPress",value:function(){++this._shiftPressCount>2?this.resetShiftPress():this.isCapslock=!0}},{key:"decrementShiftPress",value:function(){this._shiftPressCount=Math.max(--this._shiftPressCount,0),0===this._shiftPressCount&&(this.isCapslock=!1)}},{key:"resetShiftPress",value:function(){this._shiftPressCount=0,this.isCapslock=!1}},{key:"isShifted",get:function(){return this._isShifted},set:function(shifted){this._isCapslock&&(shifted=!0),this._isShifted!==shifted&&(this._isShifted=shifted,this.render())}},{key:"resetKeycapRegistry",value:function(){this.keycapRegistry={}}},{key:"registerKeycap",value:function(keycap){var id="ML__k"+Date.now().toString(36).slice(-2)+Math.floor(1e5*Math.random()).toString(36);return this.keycapRegistry[id]=keycap,id}},{key:"getKeycap",value:function(id){return id?this.keycapRegistry[id]:void 0}},{key:"getLayer",value:function(id){var _step120,_iterator120=_createForOfIteratorHelper(this.normalizedLayouts);try{for(_iterator120.s();!(_step120=_iterator120.n()).done;){var _step121,_iterator121=_createForOfIteratorHelper(_step120.value.layers);try{for(_iterator121.s();!(_step121=_iterator121.n()).done;){var layer=_step121.value;if(layer.id===id)return layer}}catch(err){_iterator121.e(err)}finally{_iterator121.f()}}}catch(err){_iterator120.e(err)}finally{_iterator120.f()}}},{key:"alphabeticLayout",get:function(){return this._alphabeticLayout},set:function(value){this._alphabeticLayout=value,this.rebuild()}},{key:"actionKeycap",get:function(){return this._actionKeycap},set:function(value){this._actionKeycap="string"==typeof value?{label:value}:value}},{key:"shiftKeycap",get:function(){return this._shiftKeycap},set:function(value){this._shiftKeycap="string"==typeof value?{label:value}:value}},{key:"backspaceKeycap",get:function(){return this._backspaceKeycap},set:function(value){this._backspaceKeycap="string"==typeof value?{label:value}:value}},{key:"tabKeycap",get:function(){return this._tabKeycap},set:function(value){this._tabKeycap="string"==typeof value?{label:value}:value}},{key:"layouts",get:function(){return this._layouts},set:function(value){this.updateNormalizedLayouts(value),this.rebuild()}},{key:"updateNormalizedLayouts",value:function(value){var layouts=Array.isArray(value)?_toConsumableArray(value):[value],defaultIndex=layouts.findIndex((function(x){return"default"===x}));defaultIndex>=0&&layouts.splice(defaultIndex,1,"numeric","symbols","alphabetic","greek"),this._layouts=Object.freeze(layouts),this._normalizedLayouts=layouts.map((function(x){return normalizeLayout(x)}))}},{key:"normalizedLayouts",get:function(){return this._normalizedLayouts||this.updateNormalizedLayouts(this._layouts),this._normalizedLayouts}},{key:"editToolbar",get:function(){return this._editToolbar},set:function(value){this._editToolbar=value,this.rebuild()}},{key:"container",get:function(){return this._container},set:function(value){this._container=value,this.rebuild()}},{key:"style",get:function(){return this._style}},{key:"addEventListener",value:function(type,callback,_options){this.listeners[type]||(this.listeners[type]=new Set),this.listeners[type].has(callback)||this.listeners[type].add(callback)}},{key:"dispatchEvent",value:function(event){return!this.listeners[event.type]||0===this.listeners[event.type].size||(this.listeners[event.type].forEach((function(x){"function"==typeof x?x(event):null==x||x.handleEvent(event)})),!event.defaultPrevented)}},{key:"removeEventListener",value:function(type,callback,_options){this.listeners[type]&&this.listeners[type].delete(callback)}},{key:"element",get:function(){return this._element},set:function(val){var _a3;this._element!==val&&(null==(_a3=this._element)||_a3.remove(),this._element=val)}},{key:"visible",get:function(){return this._visible},set:function(val){val?this.show():this.hide()}},{key:"boundingRect",get:function(){var _a3;if(!this._visible)return new DOMRect;var plate=null==(_a3=this._element)?void 0:_a3.getElementsByClassName("MLK__plate")[0];return plate?plate.getBoundingClientRect():new DOMRect}},{key:"adjustBoundingRect",value:function(){var _a3,_b3,h=this.boundingRect.height;if(this.container===document.body){null==(_a3=this._element)||_a3.style.setProperty("--_keyboard-height","calc(".concat(h,"px + env(safe-area-inset-bottom, 0))"));var keyboardHeight=h-1;this.container.style.paddingBottom=this.originalContainerBottomPadding?"calc(".concat(this.originalContainerBottomPadding," + ").concat(keyboardHeight,"px)"):"".concat(keyboardHeight,"px")}else null==(_b3=this._element)||_b3.style.setProperty("--_keyboard-height","".concat(h,"px"))}},{key:"rebuild",value:function(){var _this29=this;if(!this._rebuilding&&this._element){this._rebuilding=!0;var currentLayerId=this.currentLayer;requestAnimationFrame((function(){_this29._rebuilding=!1,_this29._element&&(_this29._element.remove(),_this29._element=void 0),_this29.visible&&(_this29.buildAndAttachElement(),_this29.currentLayer=currentLayerId,_this29.render(),_this29.adjustBoundingRect(),_this29._element.classList.add("is-visible"))}))}}},{key:"render",value:function(){if(this._element){var layer=this.getLayer(this.currentLayer);this._element.classList.toggle("backdrop-is-transparent",Boolean(layer&&(layer.backdrop||layer.container)));var keycaps=this._element.querySelectorAll(".MLK__layer.is-visible .MLK__keycap, .MLK__layer.is-visible .action, .fnbutton, .MLK__layer.is-visible .bigfnbutton, .MLK__layer.is-visible .shift");if(keycaps){var _step122,_iterator122=_createForOfIteratorHelper(keycaps);try{for(_iterator122.s();!(_step122=_iterator122.n()).done;){var keycapElement=_step122.value,keycap=this.getKeycap(keycapElement.id);if(keycap){var _renderKeycap8=_slicedToArray(renderKeycap(keycap,{shifted:this.isShifted}),2),markup=_renderKeycap8[0],cls=_renderKeycap8[1];keycapElement.innerHTML=window.MathfieldElement.createHTML(markup),keycapElement.className=cls}}}catch(err){_iterator122.e(err)}finally{_iterator122.f()}}}}},{key:"show",value:function(options){var _a3,_this30=this;if(!this._visible){var container=this.container;if(container&&window.mathVirtualKeyboard&&this.stateWillChange(!0)){if(this._element||(this.buildAndAttachElement(),this.adjustBoundingRect()),!this._visible){var plate=this._element.getElementsByClassName("MLK__plate")[0];if(plate&&this.observer.observe(plate),container===window.document.body){var padding2=container.style.paddingBottom;this.originalContainerBottomPadding=padding2;var keyboardHeight=plate.offsetHeight-1;container.style.paddingBottom=padding2?"calc(".concat(padding2," + ").concat(keyboardHeight,"px)"):"".concat(keyboardHeight,"px")}window.addEventListener("mouseup",this),window.addEventListener("blur",this),window.addEventListener("keydown",this,{capture:!0}),window.addEventListener("keyup",this,{capture:!0}),this.currentLayer=this.latentLayer,this.render(),null==(_a3=this._element)||_a3.classList.toggle("is-caps-lock",2===this.shiftPressCount)}this._visible=!0,(null==options?void 0:options.animate)?requestAnimationFrame((function(){_this30._element&&(_this30._element.classList.add("animate"),_this30._element.addEventListener("transitionend",(function(){var _a4;return null==(_a4=_this30._element)?void 0:_a4.classList.remove("animate")}),{once:!0}),_this30._element.classList.add("is-visible"),_this30.stateChanged())})):(this._element.classList.add("is-visible"),this.stateChanged())}}}},{key:"hide",value:function(_options){var _a3,container=this.container;if(container&&this._visible&&this.stateWillChange(!1)){if(this._visible=!1,this._element){this.latentLayer=this.currentLayer;var plate=this._element.getElementsByClassName("MLK__plate")[0];plate&&this.observer.unobserve(plate),window.removeEventListener("mouseup",this),window.removeEventListener("blur",this),window.removeEventListener("keydown",this,{capture:!0}),window.removeEventListener("keyup",this,{capture:!0}),window.removeEventListener("contextmenu",this,{capture:!0}),hideVariantsPanel(),releaseStylesheet("core"),releaseStylesheet("virtual-keyboard"),null==(_a3=this._element)||_a3.remove(),this._element=void 0,null!==this.originalContainerBottomPadding&&(container.style.paddingBottom=this.originalContainerBottomPadding)}this.stateChanged()}}},{key:"height",get:function(){var _a3,_b3;return null!=(_b3=null==(_a3=this.element)?void 0:_a3.offsetHeight)?_b3:0}},{key:"buildAndAttachElement",value:function(){var _a3;console.assert(!this.element),this.element=makeKeyboardElement(this),window.addEventListener("contextmenu",this,{capture:!0}),this.element.addEventListener("contextmenu",(function(ev){ev.shiftKey||((ev.ctrlKey||2===ev.button)&&showVariantsPanel(ev.target),ev.preventDefault(),ev.stopPropagation())}),{capture:!0}),null==(_a3=this.container)||_a3.appendChild(this.element)}},{key:"handleEvent",value:function(evt){if(isVirtualKeyboardMessage(evt)){if(!validateOrigin(evt.origin,this.originValidator))throw new DOMException("Message from unknown origin (".concat(evt.origin,") cannot be handled"),"SecurityError");"disconnect"===evt.data.action?this.connectedMathfieldWindow=void 0:"update-setting"!==evt.data.action&&"proxy-created"!==evt.data.action&&"execute-command"!==evt.data.action&&(console.assert(void 0!==evt.source),this.connectedMathfieldWindow=evt.source),this.handleMessage(evt.data,evt.source)}if(this._element)switch(evt.type){case"mouseup":case"blur":document.body.style.userSelect="",this.isShifted=!1;break;case"contextmenu":2!==evt.button&&evt.preventDefault();break;case"keydown":"Shift"===evt.key&&this.incrementShiftPress();break;case"keyup":"Shift"!==evt.key&&1===this._shiftPressCount&&(this.isCapslock=!1,this._shiftPressCount=0)}}},{key:"handleMessage",value:function(msg,source){var action=msg.action;if("execute-command"!==action){if("connect"===action&&this.sendMessage("synchronize-proxy",{boundingRect:this.boundingRect,alphabeticLayout:this._alphabeticLayout,layouts:this._layouts,editToolbar:this._editToolbar},source),"disconnect"!==action&&window===window.top)if("show"!==action){if("hide"!==action)return"update-setting"===action?(msg.alphabeticLayout&&(this.alphabeticLayout=msg.alphabeticLayout),msg.layouts&&(this.layouts=msg.layouts),void(msg.editToolbar&&(this.editToolbar=msg.editToolbar))):void("proxy-created"!==action||this.sendMessage("synchronize-proxy",{boundingRect:this.boundingRect,alphabeticLayout:this._alphabeticLayout,layouts:this._layouts,editToolbar:this._editToolbar},source));void 0!==msg.animate?this.hide({animate:msg.animate}):this.hide()}else void 0!==msg.animate?this.show({animate:msg.animate}):this.show()}else{var command=msg.command;if("virtual-keyboard"!==getCommandTarget(command)&&window===window.parent)return;this.executeCommand(command)}}},{key:"sendMessage",value:function(action,payload,target){if(target||(target=this.connectedMathfieldWindow),null!==this.targetOrigin&&"null"!==this.targetOrigin&&target!==window){if(target)target.postMessage(__spreadValues({type:"mathlive#virtual-keyboard-message",action:action},payload),{targetOrigin:this.targetOrigin});else if("execute-command"===action&&Array.isArray(payload.command)&&"insert"===payload.command[0]){var _step123,_iterator123=_createForOfIteratorHelper(payload.command[1].split(""));try{for(_iterator123.s();!(_step123=_iterator123.n()).done;){var c=_step123.value;this.dispatchEvent(new KeyboardEvent("keydown",{key:c,bubbles:!0})),this.dispatchEvent(new KeyboardEvent("keyup",{key:c,bubbles:!0}))}}catch(err){_iterator123.e(err)}finally{_iterator123.f()}}}else window.dispatchEvent(new MessageEvent("message",{source:window,data:__spreadValues({type:"mathlive#virtual-keyboard-message",action:action},payload)}))}},{key:"stateWillChange",value:function(visible){return this.dispatchEvent(new CustomEvent("before-virtual-keyboard-toggle",{detail:{visible:visible},bubbles:!0,cancelable:!0,composed:!0}))}},{key:"stateChanged",value:function(){this.dispatchEvent(new Event("virtual-keyboard-toggle")),this.sendMessage("geometry-changed",{boundingRect:this.boundingRect})}},{key:"focus",value:function(){this.sendMessage("focus",{})}},{key:"blur",value:function(){this.sendMessage("blur",{})}},{key:"updateToolbar",value:function(mf){var el=this._element;if(el){el.classList.toggle("can-undo",mf.canUndo),el.classList.toggle("can-redo",mf.canRedo),el.classList.toggle("can-copy",!mf.selectionIsCollapsed),el.classList.toggle("can-copy",!mf.selectionIsCollapsed),el.classList.toggle("can-paste",!0);var toolbars=el.querySelectorAll(".ML__edit-toolbar");if(toolbars){var _step124,_iterator124=_createForOfIteratorHelper(toolbars);try{for(_iterator124.s();!(_step124=_iterator124.n()).done;)_step124.value.innerHTML=makeEditToolbar(this,mf)}catch(err){_iterator124.e(err)}finally{_iterator124.f()}}}}},{key:"update",value:function(mf){this._style=mf.style,this.updateToolbar(mf)}},{key:"connect",value:function(){this.connectedMathfieldWindow=window}},{key:"disconnect",value:function(){this.connectedMathfieldWindow=void 0}},{key:"executeCommand",value:function(command){var _COMMANDS$selector3,selector,args=[];return isArray(command)?(selector=command[0],args=command.slice(1)):selector=command,selector=selector.replace(/-\w/g,(function(m){return m[1].toUpperCase()})),"virtual-keyboard"===getCommandTarget(command)?(_COMMANDS$selector3=COMMANDS[selector]).fn.apply(_COMMANDS$selector3,_toConsumableArray(args)):(this.sendMessage("execute-command",{command:command}),!1)}},{key:"dispose",value:function(){window.removeEventListener("mouseup",this),window.removeEventListener("blur",this),window.removeEventListener("message",this)}}],[{key:"singleton",get:function(){if(void 0===this._singleton)try{this._singleton=new VirtualKeyboard}catch(e){this._singleton=null}return this._singleton}}]),VirtualKeyboard}();if(isBrowser()&&!("mathVirtualKeyboard"in window))if(window===window.top){var kbd=VirtualKeyboard.singleton;Object.defineProperty(window,"mathVirtualKeyboard",{get:function(){return kbd}})}else Object.defineProperty(window,"mathVirtualKeyboard",{get:function(){return VirtualKeyboardProxy.singleton},configurable:!0});function update(updates){for(var result={},_i21=0,_Object$keys11=Object.keys(updates);_i21<_Object$keys11.length;_i21++){var key=_Object$keys11[_i21];switch(key){case"scriptDepth":if(isArray(updates.scriptDepth))result.scriptDepth=[updates.scriptDepth[0],updates.scriptDepth[1]];else{if("number"!=typeof updates.scriptDepth)throw new TypeError("Unexpected value for scriptDepth");result.scriptDepth=[updates.scriptDepth,updates.scriptDepth]}break;case"mathVirtualKeyboardPolicy":var keyboardPolicy=updates.mathVirtualKeyboardPolicy.toLowerCase();"sandboxed"===keyboardPolicy&&(window!==window.top&&function(){var kbd=VirtualKeyboard.singleton;Object.defineProperty(window,"mathVirtualKeyboard",{get:function(){return kbd}})}(),keyboardPolicy="manual"),result.mathVirtualKeyboardPolicy=keyboardPolicy;break;case"letterShapeStyle":"auto"===updates.letterShapeStyle?l10n.locale.startsWith("fr")?result.letterShapeStyle="french":result.letterShapeStyle="tex":result.letterShapeStyle=updates.letterShapeStyle;break;case"defaultMode":["text","math","inline-math"].includes(updates.defaultMode)?result.defaultMode=updates.defaultMode:(console.error('MathLive 0.94.6:  valid values for defaultMode are "text", "math" or "inline-math"'),result.defaultMode="math");break;case"macros":result.macros=normalizeMacroDictionary(updates.macros);break;default:isArray(updates[key])?result[key]=_toConsumableArray(updates[key]):"object"!==_typeof(updates[key])||updates[key]instanceof Element||"computeEngine"===key?result[key]=updates[key]:result[key]=__spreadValues({},updates[key])}}return result}function get(config,keys){var _step125,result={},_iterator125=_createForOfIteratorHelper("string"==typeof keys?[keys]:void 0===keys?Object.keys(config):keys);try{for(_iterator125.s();!(_step125=_iterator125.n()).done;){var x=_step125.value;null===config[x]?result[x]=null:isArray(config[x])?result[x]=_toConsumableArray(config[x]):"object"!==_typeof(config[x])||config[x]instanceof Element||"computeEngine"===x?result[x]=config[x]:result[x]=__spreadValues({},config[x])}}catch(err){_iterator125.e(err)}finally{_iterator125.f()}return"string"==typeof keys?result[keys]:result}function getDefault(){return{readOnly:!1,defaultMode:"math",macros:{},registers:{},colorMap:defaultColorMap,backgroundColorMap:defaultBackgroundColorMap,letterShapeStyle:l10n.locale.startsWith("fr")?"french":"tex",minFontScale:0,smartMode:!1,smartFence:!0,smartSuperscript:!0,scriptDepth:[1/0,1/0],removeExtraneousParentheses:!0,mathModeSpace:"",placeholderSymbol:"▢",popoverPolicy:"auto",keybindings:DEFAULT_KEYBINDINGS,inlineShortcuts:INLINE_SHORTCUTS,inlineShortcutTimeout:0,mathVirtualKeyboardPolicy:"auto",virtualKeyboardTargetOrigin:null==window?void 0:window.origin,originValidator:"none",onInlineShortcut:function(){return""},onScrollIntoView:null,onExport:defaultExportHook,value:""}}function effectiveMode(options){return"inline-math"===options.defaultMode?"math":options.defaultMode}function isOffset(value){return"number"==typeof value&&!Number.isNaN(value)}function isRange(value){return Array.isArray(value)&&2===value.length}function isSelection(value){return null!=value&&"object"===_typeof(value)&&"ranges"in value&&Array.isArray(value.ranges)}function xmlEscape(string){return string.replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function makeID(id,options){return id&&options.generateID?' extid="'.concat(id,'"'):""}function scanIdentifier(stream,final,options){var _a3,_b3,_c2,_d2,_e,_f,_g,_h,_i,result=!1;final=null!=final?final:stream.atoms.length;var mathML="",body="",atom=stream.atoms[stream.index],variant=null!=(_b3=null==(_a3=atom.style)?void 0:_a3.variant)?_b3:"",variantStyle=null!=(_d2=null==(_c2=atom.style)?void 0:_c2.variantStyle)?_d2:"",variantProp="";(variant||variantStyle)&&(variantProp=null!=(_e={upnormal:"normal",boldnormal:"bold",italicmain:"italic",bolditalicmain:"bold-italic","double-struck":"double-struck",boldfraktur:"bold-fraktur",calligraphic:"script",upcalligraphic:"script",script:"script",boldscript:"bold-script",boldcalligraphic:"bold-script",fraktur:"fraktur","upsans-serif":"sans-serif","boldsans-serif":"bold-sans-serif","italicsans-serif":"sans-serif-italic","bolditalicsans-serif":"sans-serif-bold-italic",monospace:"monospace"}[variantStyle+variant])?_e:"",variantProp='mathvariant="'.concat(variantProp,'"'));var SPECIAL_IDENTIFIERS2={"\\exponentialE":"&#x02147;","\\imaginaryI":"&#x2148;","\\differentialD":"&#x2146;","\\capitalDifferentialD":"&#x2145;","\\alpha":"&#x03b1;","\\pi":"&#x03c0;","\\infty":"&#x221e;","\\forall":"&#x2200;","\\nexists":"&#x2204;","\\exists":"&#x2203;","\\hbar":"ℏ","\\cdotp":"⋅","\\ldots":"…","\\cdots":"⋯","\\ddots":"⋱","\\vdots":"⋮","\\ldotp":"."};if(SPECIAL_IDENTIFIERS2[atom.command]){stream.index+=1;var mathML2="<mi".concat(makeID(atom.id,options)).concat(variantProp,">").concat(SPECIAL_IDENTIFIERS2[atom.command],"</mi>");return"mi"!==stream.lastType&&"mn"!==stream.lastType&&"mtext"!==stream.lastType&&"fence"!==stream.lastType||(mathML2="<mo>&#8290;</mo>"+mathML2),parseSubsup(mathML2,stream,options)||(stream.mathML+=mathML2,stream.lastType="mi"),!0}if("\\operatorname"===atom.command)body=toString2(atom.body),stream.index+=1;else if(variant||variantStyle)for(;stream.index<final&&("mord"===atom.type||"macro"===atom.type)&&!atom.isDigit()&&variant===(null!=(_g=null==(_f=atom.style)?void 0:_f.variant)?_g:"")&&variantStyle===(null!=(_i=null==(_h=atom.style)?void 0:_h.variantStyle)?_i:"");)body+=toString2([atom]),stream.index+=1,atom=stream.atoms[stream.index];else"mord"!==atom.type&&"macro"!==atom.type||atom.isDigit()||(body+=toString2([atom]),stream.index+=1);if(body.length>0){result=!0,mathML="<mi".concat(variantProp,">").concat(body,"</mi>");var lastType=stream.lastType;mathML.endsWith(">f</mi>")||mathML.endsWith(">g</mi>")?(mathML+="<mo>&#x2061;</mo>",stream.lastType="applyfunction"):stream.lastType=/^<mo>(.*)<\/mo>$/.test(mathML)?"mo":"mi",parseSubsup(mathML,stream,options)||("mi"!==lastType&&"mn"!==lastType&&"mtext"!==lastType&&"fence"!==lastType||(mathML="<mo>&#8290;</mo>"+mathML),stream.mathML+=mathML)}return result}function parseSubsup(base,stream,options){var _a3,atom=stream.atoms[stream.index-1];if(!atom)return!1;if(!atom.superscript&&!atom.subscript){if("subsup"!==(null==(_a3=stream.atoms[stream.index])?void 0:_a3.type))return!1;atom=stream.atoms[stream.index],stream.index+=1}var lastType=stream.lastType;stream.lastType="";var superscript=toMathML(atom.superscript,options);stream.lastType="";var subscript=toMathML(atom.subscript,options);if(stream.lastType=lastType,!superscript&&!subscript)return!1;var mathML="";return superscript&&subscript?mathML="<msubsup>".concat(base).concat(subscript).concat(superscript,"</msubsup>"):superscript?mathML="<msup>".concat(base).concat(superscript,"</msup>"):subscript&&(mathML="<msub>".concat(base).concat(subscript,"</msub>")),stream.mathML+=mathML,stream.lastType="",!0}function scanText(stream,final,options){final=null!=final?final:stream.atoms.length;for(var initial=stream.index,mathML="";stream.index<final&&"text"===stream.atoms[stream.index].mode;)mathML+=stream.atoms[stream.index].value?stream.atoms[stream.index].value:" ",stream.index+=1;return mathML.length>0&&(stream.mathML+="<mtext ".concat(makeID(stream.atoms[initial].id,options),"\n      >").concat(mathML,"</mtext>"),stream.lastType="mtext",!0)}function scanNumber(stream,final,options){final=null!=final?final:stream.atoms.length;var initial=stream.index,mathML="",superscript=function(stream){for(var result=-1,i=stream.index,done=!1,found=!1;i<stream.atoms.length&&!done&&!found;){var atom=stream.atoms[i];found=!(done=!atom.isDigit())&&void 0!==atom.superscript,i++}return found&&(result=i-1),result}(stream);for(superscript>=0&&superscript<final&&(final=superscript);stream.index<final&&stream.atoms[stream.index].isDigit();)mathML+=stream.atoms[stream.index].asDigit(),stream.index+=1;return!(mathML.length<=0||(mathML="<mn"+makeID(stream.atoms[initial].id,options)+">"+mathML+"</mn>",superscript<0&&function(stream){return stream.index<stream.atoms.length&&stream.atoms[stream.index].superscript&&"subsup"===stream.atoms[stream.index].type}(stream)&&(superscript=stream.index,stream.index+=1),parseSubsup(mathML,stream,options)||(stream.mathML+=mathML,stream.lastType="mn"),0))}function scanFence(stream,final,options){var result=!1;final=null!=final?final:stream.atoms.length;var mathML="",lastType="";if(stream.index<final&&"mopen"===stream.atoms[stream.index].type){for(var found=!1,depth=0,openIndex=stream.index,closeIndex=-1,index=openIndex+1;index<final&&!found;)"mopen"===stream.atoms[index].type?depth+=1:"mclose"===stream.atoms[index].type&&(depth-=1),-1===depth&&(found=!0,closeIndex=index),index+=1;found&&(mathML="<mrow>",mathML+=toMo(stream.atoms[openIndex],options),mathML+=toMathML(stream.atoms,options,openIndex+1,closeIndex),mathML+=toMo(stream.atoms[closeIndex],options),mathML+="</mrow>",stream.index=closeIndex+1,"mi"!==stream.lastType&&"mn"!==stream.lastType&&"mfrac"!==stream.lastType&&"fence"!==stream.lastType||(stream.mathML+="<mo>&#8290;</mo>"),parseSubsup(mathML,stream,options)&&(result=!0,stream.lastType="",mathML=""),lastType="fence")}return mathML.length>0&&(result=!0,stream.mathML+=mathML,stream.lastType=lastType),result}function scanOperator(stream,final,options){var result=!1;final=null!=final?final:stream.atoms.length;var mathML="",lastType="",atom=stream.atoms[stream.index],SPECIAL_OPERATORS2={"\\ne":"&ne;","\\neq":"&neq;","\\pm":"&#177;","\\times":"&#215;","\\colon":":","\\vert":"|","\\Vert":"∥","\\mid":"∣","\\lbrace":"{","\\rbrace":"}","\\lparen":"(","\\rparen":")","\\langle":"⟨","\\rangle":"⟩","\\lfloor":"⌊","\\rfloor":"⌋","\\lceil":"⌈","\\rceil":"⌉"};if(SPECIAL_OPERATORS2[atom.command]){stream.index+=1;var mathML2="<mo".concat(makeID(atom.id,options),">").concat(SPECIAL_OPERATORS2[atom.command],"</mo>");return parseSubsup(mathML2,stream,options)||(stream.mathML+=mathML2,stream.lastType="mo"),!0}if(stream.index<final&&("mbin"===atom.type||"mrel"===atom.type))mathML+=atomToMathML(stream.atoms[stream.index],options),stream.index+=1,lastType="mo";else if(stream.index<final&&"mop"===atom.type){if("over-under"===atom.subsupPlacement&&(atom.superscript||atom.subscript)){var op=toMo(atom,options);atom.superscript&&atom.subscript?(mathML+="<munderover>"+op,mathML+=toMathML(atom.subscript,options),mathML+=toMathML(atom.superscript,options),mathML+="</munderover>"):atom.superscript?(mathML+="<mover>"+op,mathML+=toMathML(atom.superscript,options),mathML+="</mover>"):atom.subscript&&(mathML+="<munder>"+op,mathML+=toMathML(atom.subscript,options),mathML+="</munder>"),lastType="mo"}else{var atom2=stream.atoms[stream.index],isUnit="\\operatorname"===atom2.value,_op=isUnit?'<mi class="MathML-Unit"'+makeID(atom2.id,options)+">"+toString2(atom2.value)+"</mi>":toMo(atom2,options);mathML+=_op,isUnit||/^<mo>(.*)<\/mo>$/.test(_op)?lastType=isUnit?"mi":"mo":(mathML+="<mo>&#x2061;</mo>",lastType="applyfunction")}"mi"!==stream.lastType&&"mn"!==stream.lastType||/^<mo>(.*)<\/mo>$/.test(mathML)||(mathML="<mo>&#8290;</mo>"+mathML),stream.index+=1}return mathML.length>0&&(result=!0,parseSubsup(mathML,stream,options)||(stream.mathML+=mathML,stream.lastType=lastType)),result}function toMathML(input,options,initial,final){null!=options||(options={});var result={atoms:[],index:null!=initial?initial:0,mathML:"",lastType:""};if("number"==typeof input||"boolean"==typeof input)result.mathML=input.toString();else if("string"==typeof input)result.mathML=input;else if(input instanceof Atom)result.mathML=atomToMathML(input,options);else if(Array.isArray(input)){result.atoms=input;var count=0;for(final=final||(input?input.length:0);result.index<final;)if(scanText(result,final,options)||scanNumber(result,final,options)||scanIdentifier(result,final,options)||scanOperator(result,final,options)||scanFence(result,final,options))count+=1;else if(result.index<final){var mathML=atomToMathML(result.atoms[result.index],options);"mn"===result.lastType&&mathML.length>0&&"genfrac"===result.atoms[result.index].type&&(mathML="<mo>&#x2064;</mo>"+mathML),"genfrac"===result.atoms[result.index].type?result.lastType="mfrac":result.lastType="",result.index+=1,parseSubsup(mathML,result,options)?count+=1:mathML.length>0&&(result.mathML+=mathML,count+=1)}count>1&&(result.mathML="<mrow>"+result.mathML+"</mrow>")}return result.mathML}function toMo(atom,options){var result="",body=toString2(atom.value);return body&&(result="<mo"+makeID(atom.id,options)+">"+body+"</mo>"),result}function toString2(atoms){if(!atoms)return"";if("string"==typeof atoms)return xmlEscape(atoms);if(!Array.isArray(atoms)&&"string"==typeof atoms.body)return xmlEscape(atoms.body);var _step126,result="",_iterator126=_createForOfIteratorHelper(atoms);try{for(_iterator126.s();!(_step126=_iterator126.n()).done;){var atom=_step126.value;"string"==typeof atom.value&&(result+=atom.value)}}catch(err){_iterator126.e(err)}finally{_iterator126.f()}return xmlEscape(result)}function atomToMathML(atom,options){var _a3,_b3,_c2,_d2,_e,_f,_g,_h,_i,_j,_k,_l,_m,_n,_o,_p,_q,_r,_s,_t,_u,_v;if("text"===atom.mode)return"<mi".concat(makeID(atom.id,options),">").concat(atom.value,"</mi>");var col,row,i,underscript,overscript,body,SVG_CODE_POINTS={widehat:"^",widecheck:"ˇ",widetilde:"~",utilde:"~",overleftarrow:"←",underleftarrow:"←",xleftarrow:"←",longleftarrow:"←",overrightarrow:"→",underrightarrow:"→",xrightarrow:"→",longrightarrow:"→",underbrace:"⏟",overbrace:"⏞",overgroup:"⏠",undergroup:"⏡",overleftrightarrow:"↔",underleftrightarrow:"↔",xleftrightarrow:"↔",Overrightarrow:"⇒",xRightarrow:"⇒",overleftharpoon:"↼",xleftharpoonup:"↼",overrightharpoon:"⇀",xrightharpoonup:"⇀",xLeftarrow:"⇐",xLeftrightarrow:"⇔",xhookleftarrow:"↩",xhookrightarrow:"↪",xmapsto:"↦",xrightharpoondown:"⇁",xleftharpoondown:"↽",xrightleftharpoons:"⇌",longrightleftharpoons:"⇌",xleftrightharpoons:"⇋",xtwoheadleftarrow:"↞",xtwoheadrightarrow:"↠",xlongequal:"=",xtofrom:"⇄",xleftrightarrows:"⇄",xRightleftharpoons:"⇌",longRightleftharpoons:"⇌",xLeftrightharpoons:"⇋",longLeftrightharpoons:"⇋"},result="",sep="",command=atom.command;if("\\error"===atom.command)return"<merror".concat(makeID(atom.id,options),">").concat(toMathML(atom.body,options),"</merror>");var SPECIAL_DELIMS={"\\vert":"|","\\Vert":"∥","\\mid":"∣","\\lbrace":"{","\\rbrace":"}","\\lparen":"(","\\rparen":")","\\langle":"⟨","\\rangle":"⟩","\\lfloor":"⌊","\\rfloor":"⌋","\\lceil":"⌈","\\rceil":"⌉"};switch(atom.type){case"first":case"line":case"overlap":case"subsup":case"phantom":case"composition":case"rule":case"chem":break;case"group":case"root":result=toMathML(atom.body,options);break;case"array":if((atom.leftDelim&&"."!==atom.leftDelim||atom.rightDelim&&"."!==atom.rightDelim)&&(result+="<mrow>",atom.leftDelim&&"."!==atom.leftDelim&&(result+="<mo>"+(SPECIAL_DELIMS[atom.leftDelim]||atom.leftDelim)+"</mo>")),result+="<mtable",atom.colFormat){for(result+=' columnalign="',i=0;i<atom.colFormat.length;i++)atom.colFormat[i].align&&(result+={l:"left",c:"center",r:"right"}[atom.colFormat[i].align]+" ");result+='"'}for(result+=">",row=0;row<atom.array.length;row++){for(result+="<mtr>",col=0;col<atom.array[row].length;col++)result+="<mtd>"+toMathML(atom.array[row][col],options)+"</mtd>";result+="</mtr>"}result+="</mtable>",(atom.leftDelim&&"."!==atom.leftDelim||atom.rightDelim&&"."!==atom.rightDelim)&&(atom.rightDelim&&"."!==atom.rightDelim&&(result+="<mo>"+(SPECIAL_DELIMS[atom.leftDelim]||atom.rightDelim)+"</mo>"),result+="</mrow>");break;case"genfrac":(atom.leftDelim||atom.rightDelim)&&(result+="<mrow>"),atom.leftDelim&&"."!==atom.leftDelim&&(result+="<mo"+makeID(atom.id,options)+">"+(SPECIAL_DELIMS[atom.leftDelim]||atom.leftDelim)+"</mo>"),atom.hasBarLine?(result+="<mfrac>",result+=toMathML(atom.above,options)||"<mi>&nbsp;</mi>",result+=toMathML(atom.below,options)||"<mi>&nbsp;</mi>",result+="</mfrac>"):(result+="<mtable"+makeID(atom.id,options)+">",result+="<mtr>"+toMathML(atom.above,options)+"</mtr>",result+="<mtr>"+toMathML(atom.below,options)+"</mtr>",result+="</mtable>"),atom.rightDelim&&"."!==atom.rightDelim&&(result+="<mo"+makeID(atom.id,options)+">"+(SPECIAL_DELIMS[atom.rightDelim]||atom.rightDelim)+"</mo>"),(atom.leftDelim||atom.rightDelim)&&(result+="</mrow>");break;case"surd":atom.hasEmptyBranch("above")?(result+="<msqrt"+makeID(atom.id,options)+">",result+=toMathML(atom.body,options),result+="</msqrt>"):(result+="<mroot"+makeID(atom.id,options)+">",result+=toMathML(atom.body,options),result+=toMathML(atom.above,options),result+="</mroot>");break;case"leftright":result="<mrow>",atom.leftDelim&&"."!==atom.leftDelim&&(result+="<mo".concat(makeID(atom.id,options)).concat(null!=(_a3=SPECIAL_DELIMS[atom.leftDelim])?_a3:atom.leftDelim,"</mo>")),atom.body&&(result+=toMathML(atom.body,options)),atom.rightDelim&&"."!==atom.rightDelim&&(result+="<mo".concat(makeID(atom.id,options),">").concat(null!=(_b3=SPECIAL_DELIMS[atom.rightDelim])?_b3:atom.rightDelim,"</mo>")),result+="</mrow>";break;case"sizeddelim":case"delim":result+="<mo".concat(makeID(atom.id,options),">").concat(SPECIAL_DELIMS[atom.delim]||atom.delim,"</mo>");break;case"accent":result+='<mover accent="true"'+makeID(atom.id,options)+">",result+=toMathML(atom.body,options),result+="<mo>"+({"\\vec":"&#x20d7;","\\acute":"&#x00b4;","\\grave":"&#x0060;","\\dot":"&#x02d9;","\\ddot":"&#x00a8;","\\tilde":"&#x007e;","\\bar":"&#x00af;","\\breve":"&#x02d8;","\\check":"&#x02c7;","\\hat":"&#x005e;"}[command]||atom.accent)+"</mo>",result+="</mover>";break;case"overunder":overscript=atom.above,underscript=atom.below,(atom.svgAbove||overscript)&&(atom.svgBelow||underscript)?body=atom.body:overscript&&overscript.length>0?(body=atom.body,(null==(_d2=null==(_c2=atom.body)?void 0:_c2[0])?void 0:_d2.below)?(underscript=atom.body[0].below,body=atom.body[0].body):"first"===(null==(_f=null==(_e=atom.body)?void 0:_e[0])?void 0:_f.type)&&(null==(_h=null==(_g=atom.body)?void 0:_g[1])?void 0:_h.below)&&(underscript=atom.body[1].below,body=atom.body[1].body)):underscript&&underscript.length>0&&(body=atom.body,(null==(_j=null==(_i=atom.body)?void 0:_i[0])?void 0:_j.above)?(overscript=atom.body[0].above,body=atom.body[0].body):"first"===(null==(_l=null==(_k=atom.body)?void 0:_k[0])?void 0:_l.type)&&(null==(_n=null==(_m=atom.body)?void 0:_m[1])?void 0:_n.above)&&(overscript=atom.body[1].overscript,body=atom.body[1].body)),(atom.svgAbove||overscript)&&(atom.svgBelow||underscript)?(result+="<munderover ".concat(makeID(atom.id,options),">"),result+=null!=(_o=SVG_CODE_POINTS[atom.svgBody])?_o:toMathML(body,options),result+=null!=(_p=SVG_CODE_POINTS[atom.svgBelow])?_p:toMathML(underscript,options),result+=null!=(_q=SVG_CODE_POINTS[atom.svgAbove])?_q:toMathML(overscript,options),result+="</munderover>"):atom.svgAbove||overscript?(result+="<mover ".concat(makeID(atom.id,options),">")+(null!=(_r=SVG_CODE_POINTS[atom.svgBody])?_r:toMathML(body,options)),result+=null!=(_s=SVG_CODE_POINTS[atom.svgAbove])?_s:toMathML(overscript,options),result+="</mover>"):(atom.svgBelow||underscript)&&(result+="<munder ".concat(makeID(atom.id,options),">")+(null!=(_t=SVG_CODE_POINTS[atom.svgBody])?_t:toMathML(body,options)),result+=null!=(_u=SVG_CODE_POINTS[atom.svgBelow])?_u:toMathML(underscript,options),result+="</munder>");break;case"placeholder":result+="?";break;case"mord":result="string"==typeof atom.value?atom.value:command;var m=command?command.match(/{?\\char"([\dabcdefABCDEF]*)}?/):null;m?result="&#x"+m[1]+";":result.length>0&&result.startsWith("\\")&&("string"==typeof atom.value&&atom.value.charCodeAt(0)>255?result="&#x"+("000000"+atom.value.charCodeAt(0).toString(16)).slice(-4)+";":"string"==typeof atom.value?result=atom.value.charAt(0):(console.error("Did not expect this"),result=""));var tag=/\d/.test(result)?"mn":"mi";result="<".concat(tag).concat(makeID(atom.id,options),">").concat(xmlEscape(result),"</").concat(tag,">");break;case"mbin":case"mrel":case"minner":result=toMo(atom,options);break;case"mpunct":result='<mo separator="true"'+makeID(atom.id,options)+">"+command+"</mo>";break;case"mop":"​"!==atom.body&&(result="<mo"+makeID(atom.id,options)+">",result+="\\operatorname"===command?atom.body:command||atom.body,result+="</mo>");break;case"box":result='<menclose notation="box"',atom.backgroundcolor&&(result+=' mathbackground="'+atom.backgroundcolor+'"'),result+=makeID(atom.id,options)+">"+toMathML(atom.body,options)+"</menclose>";break;case"spacing":result+='<mspace width="'+(null!=(_v={"\\!":-3/18,"\\ ":6/18,"\\,":3/18,"\\:":4/18,"\\;":5/18,"\\enspace":.5,"\\quad":1,"\\qquad":2,"\\enskip":.5}[command])?_v:0)+'em"/>';break;case"enclose":for(var notation in result='<menclose notation="',atom.notation)Object.prototype.hasOwnProperty.call(atom.notation,notation)&&atom.notation[notation]&&(result+=sep+notation,sep=" ");result+=makeID(atom.id,options)+'">'+toMathML(atom.body,options)+"</menclose>";break;case"prompt":result='<menclose notation="roundexbox""">'+toMathML(atom.body,options)+"</menclose>";break;case"space":result+="&nbsp;";break;case"mopen":case"mclose":result+=toMo(atom,options);break;case"macro":var body2=atom.command+toString2(atom.macroArgs);body2&&(result+="<mo ".concat(makeID(atom.id,options),">").concat(body2,"</mo>"));break;case"latexgroup":case"tooltip":result+=toMathML(atom.body,options);break;case"latex":result+="<mtext"+makeID(atom.id,options)+">"+atom.value+"</mtext>";break;default:console.log("MathML, unknown type : ",atom)}return result}var SPECIAL_IDENTIFIERS={"\\ne":"≠","\\neq":"≠","−":"-","-":"-","\\alpha":"alpha","\\beta":"beta","\\gamma":"gamma","\\delta":"delta","\\epsilon":"epsilon","\\varepsilon":"varepsilon","\\zeta":"zeta","\\eta":"eta","\\theta":"theta","\\vartheta":"vartheta","\\iota":"iota","\\kappa":"kappa","\\lambda":"lambda","\\mu":"mu","\\nu":"nu","\\xi":"xi","\\pi":"pi","\\rho":"rho","\\sigma":"sigma","\\tau":"tau","\\upsilon":"upsilon","\\phi":"phi","\\varphi":"varphi","\\chi":"chi","\\psi":"psi","\\omega":"omega","\\Gamma":"Gamma","\\Delta":"Delta","\\Theta":"Theta","\\Lambda":"Lambda","\\Xi":"Xi","\\Pi":"Pi","\\Sigma":"Sigma","\\Phi":"Phi","\\Psi":"Psi","\\Omega":"Omega","\\exponentialE":"e","\\imaginaryI":"i","\\imaginaryJ":"j","\\!":" ","\\,":" ","\\:":" ","\\;":" ","\\enskip":" ","\\enspace":" ","\\qquad":" ","\\quad":" "},SPECIAL_OPERATORS={"\\pm":"+-","\\times":"xx","\\colon":":","\\vert":"|","\\Vert":"||","\\mid":"|","\\lbrace":"{","\\rbrace":"}","\\lparen":"(","\\rparen":")","\\langle":"(:","\\rangle":":)"};function atomToAsciiMath(atom){var _a3,_b3,_c2,_d2,_e,_f,_g,_h,_i,_j,_k,_l,_m;if(!atom)return"";if(isArray(atom)){if(0===atom.length)return"";if("first"===atom[0].type&&(atom=atom.slice(1)),0===atom.length)return"";var result2="";if("latex"===atom[0].mode){var _step127,_iterator127=_createForOfIteratorHelper(atom);try{for(_iterator127.s();!(_step127=_iterator127.n()).done;)result2+=atomToAsciiMath(_step127.value)}catch(err){_iterator127.e(err)}finally{_iterator127.f()}}else if("text"===atom[0].mode){var i=0;for(result2='"';"text"===(null==(_a3=atom[i])?void 0:_a3.mode);)result2+=atom[i].body?atomToAsciiMath(atom[i].body):atom[i].value,i++;result2+='"'+atomToAsciiMath(atom.slice(i))}else if("math"===atom[0].mode){for(var _i22=0;atom[_i22]&&"math"===atom[_i22].mode;)result2+=atomToAsciiMath(atom[_i22]),_i22++;result2+=atomToAsciiMath(atom.slice(_i22))}else console.warn("toASCIIMath: Unexpected mode");return result2.trim()}if("text"===atom.mode)return'"'+atom.value+'"';var m,result="",command=atom.command;if("\\placeholder"===command)return"(".concat(atomToAsciiMath(atom.body),")");switch(atom.type){case"first":return"";case"group":case"root":result=null!=(_b3=SPECIAL_IDENTIFIERS[command])?_b3:atomToAsciiMath(atom.body);break;case"genfrac":var genfracAtom=atom;(genfracAtom.leftDelim||genfracAtom.rightDelim)&&(result+="."!==genfracAtom.leftDelim&&genfracAtom.leftDelim?genfracAtom.leftDelim:"{:"),genfracAtom.hasBarLine?(result+="(",result+=atomToAsciiMath(genfracAtom.above),result+=")/(",result+=atomToAsciiMath(genfracAtom.below),result+=")"):(result+="("+atomToAsciiMath(genfracAtom.above)+"),",result+="("+atomToAsciiMath(genfracAtom.below)+")"),(genfracAtom.leftDelim||genfracAtom.rightDelim)&&(result+="."!==genfracAtom.rightDelim&&genfracAtom.rightDelim?genfracAtom.rightDelim:"{:");break;case"surd":result+=atom.hasEmptyBranch("above")?"sqrt("+atomToAsciiMath(atom.body)+")":"root("+atomToAsciiMath(atom.above)+")("+atomToAsciiMath(atom.body)+")";break;case"latex":result=atom.value;break;case"leftright":var leftrightAtom=atom;result+="."!==leftrightAtom.leftDelim&&leftrightAtom.leftDelim?leftrightAtom.leftDelim:"{:",result+=atomToAsciiMath(leftrightAtom.body),result+="."!==leftrightAtom.rightDelim&&leftrightAtom.rightDelim?leftrightAtom.rightDelim:":}";break;case"sizeddelim":case"delim":case"overlap":case"overunder":case"box":break;case"mord":(result=null!=(_d2=null!=(_c2=SPECIAL_IDENTIFIERS[command])?_c2:command)?_d2:"string"==typeof atom.value?atom.value:"").startsWith("\\")&&(result+=" "),(m=command?command.match(/{?\\char"([\dabcdefABCDEF]*)}?/):null)?result=String.fromCodePoint(Number.parseInt("0x"+m[1])):result.length>0&&result.startsWith("\\")&&(result="string"==typeof atom.value?atom.value.charAt(0):atom.command);break;case"mbin":case"mrel":case"minner":result=null!=(_f=null!=(_e=SPECIAL_IDENTIFIERS[command])?_e:SPECIAL_OPERATORS[command])?_f:atom.value;break;case"mopen":case"mclose":result+=atom.value;break;case"mpunct":result=null!=(_g=SPECIAL_OPERATORS[command])?_g:command;break;case"mop":"​"!==atom.value&&(result="",result+="\\operatorname"===command?atomToAsciiMath(atom.body):null!=(_h=atom.value)?_h:command,result+=" ");break;case"array":var _step128,array=atom.array,environment=atom.environmentName,rowDelim=null!=(_i={bmatrix:["[","]"],"bmatrix*":["[","]"]}[environment])?_i:["(",")"],rows=[],_iterator128=_createForOfIteratorHelper(array);try{for(_iterator128.s();!(_step128=_iterator128.n()).done;){var _step129,row=_step128.value,cells=[],_iterator129=_createForOfIteratorHelper(row);try{for(_iterator129.s();!(_step129=_iterator129.n()).done;){var cell=_step129.value;cells.push(rowDelim[0]+atomToAsciiMath(cell)+rowDelim[1])}}catch(err){_iterator129.e(err)}finally{_iterator129.f()}rows.push(cells.join(","))}}catch(err){_iterator128.e(err)}finally{_iterator128.f()}var delim=null!=(_j={bmatrix:["[","]"],"bmatrix*":["[","]"],cases:["{",":}"]}[environment])?_j:["(",")"];result=delim[0]+rows.join(",")+delim[1];break;case"spacing":result=null!=(_k=SPECIAL_IDENTIFIERS[command])?_k:" ";break;case"enclose":result="("+atomToAsciiMath(atom.body)+")";break;case"space":result=" ";break;case"subsup":result="";break;case"macro":result=null!=(_m=null!=(_l=SPECIAL_IDENTIFIERS[command])?_l:SPECIAL_OPERATORS[command])?_m:atomToAsciiMath(atom.body)}if(!atom.hasEmptyBranch("subscript")){result+="_";var arg=atomToAsciiMath(atom.subscript);result+=arg.length>1?"("+arg+")":arg}if(!atom.hasEmptyBranch("superscript")){result+="^";var _arg=atomToAsciiMath(atom.superscript);result+=_arg.length>1?"("+_arg+")":_arg}return result}var PRONUNCIATION={"\\alpha":"alpha ","\\mu":"mew ","\\sigma":"sigma ","\\pi":"pie ","\\imaginaryI":"eye ","\\sum":"Summation ","\\prod":"Product ","+":"plus ","-":"minus ",";":'<break time="150ms"/> semi-colon <break time="150ms"/>',",":'<break time="150ms"/> comma  <break time="150ms"/>',"|":'<break time="150ms"/>Vertical bar<break time="150ms"/>',"(":'<break time="150ms"/>Open paren. <break time="150ms"/>',")":'<break time="150ms"/> Close paren. <break time="150ms"/>',"=":"equals ","<":"is less than ","\\lt":"is less than ","<=":"is less than or equal to ","\\le":"is less than or equal to ","\\gt":"is greater than ",">":"is greater than ","\\pm":"plus or minus","\\mp":"minus or plus","\\ge":"is greater than or equal to ","\\geq":"is greater than or equal to ","\\leq":"is less than or equal to ","!":"factorial ","\\sin":"sine ","\\cos":"cosine ","​":"","−":"minus ",":":'<break time="150ms"/> such that <break time="200ms"/> ',"\\colon":'<break time="150ms"/> such that <break time="200ms"/> ',"\\hbar":"etch bar ","\\iff":'<break time="200ms"/>if, and only if, <break time="200ms"/>',"\\Longleftrightarrow":'<break time="200ms"/>if, and only if, <break time="200ms"/>',"\\land":"and ","\\lor":"or ","\\neg":"not ","\\div":"divided by ","\\forall":"for all ","\\exists":"there exists ","\\nexists":"there does not exists ","\\in":"element of ","\\N":'the set <break time="150ms"/><say-as interpret-as="character">n</say-as>',"\\C":'the set <break time="150ms"/><say-as interpret-as="character">c</say-as>',"\\Z":'the set <break time="150ms"/><say-as interpret-as="character">z</say-as>',"\\Q":'the set <break time="150ms"/><say-as interpret-as="character">q</say-as>',"\\infty":"infinity ","\\nabla":"nabla ","\\partial":"partial derivative of ","\\cdot":"times ","\\cdots":"dot dot dot ","\\Rightarrow":"implies ","\\lparen":'<break time="150ms"/>open paren<break time="150ms"/>',"\\rparen":'<break time="150ms"/>close paren<break time="150ms"/>',"\\lbrace":'<break time="150ms"/>open brace<break time="150ms"/>',"\\{":'<break time="150ms"/>open brace<break time="150ms"/>',"\\rbrace":'<break time="150ms"/>close brace<break time="150ms"/>',"\\}":'<break time="150ms"/>close brace<break time="150ms"/>',"\\langle":'<break time="150ms"/>left angle bracket<break time="150ms"/>',"\\rangle":'<break time="150ms"/>right angle bracket<break time="150ms"/>',"\\lfloor":'<break time="150ms"/>open floor<break time="150ms"/>',"\\rfloor":'<break time="150ms"/>close floor<break time="150ms"/>',"\\lceil":'<break time="150ms"/>open ceiling<break time="150ms"/>',"\\rceil":'<break time="150ms"/>close ceiling<break time="150ms"/>',"\\vert":'<break time="150ms"/>vertical bar<break time="150ms"/>',"\\mvert":'<break time="150ms"/>divides<break time="150ms"/>',"\\lvert":'<break time="150ms"/>left vertical bar<break time="150ms"/>',"\\rvert":'<break time="150ms"/>right vertical bar<break time="150ms"/>',"\\lbrack":'<break time="150ms"/> open square bracket <break time="150ms"/>',"\\rbrack":'<break time="150ms"/> close square bracket <break time="150ms"/>',mm:"millimeters",cm:"centimeters",km:"kilometers",kg:"kilograms"},ENVIRONMENTS_NAMES={array:"array",matrix:"matrix",pmatrix:"parenthesis matrix",bmatrix:"square brackets matrix",Bmatrix:"braces matrix",vmatrix:"bars matrix",Vmatrix:"double bars matrix","matrix*":"matrix",smallmatrix:"small matrix"};function isAtomic(atoms){var count=0;if(isArray(atoms)){var _step130,_iterator130=_createForOfIteratorHelper(atoms);try{for(_iterator130.s();!(_step130=_iterator130.n()).done;)"first"!==_step130.value.type&&(count+=1)}catch(err){_iterator130.e(err)}finally{_iterator130.f()}}return 1===count}function atomicValue(atoms){var result="";if(isArray(atoms)){var _step132,_iterator132=_createForOfIteratorHelper(atoms);try{for(_iterator132.s();!(_step132=_iterator132.n()).done;){var atom=_step132.value;"first"!==atom.type&&"string"==typeof atom.value&&(result+=atom.value)}}catch(err){_iterator132.e(err)}finally{_iterator132.f()}}return result}function atomToSpeakableFragment(mode,atom){var _a3,_b3,_c2,_d2,_e;function emph(s){return"<emphasis>"+s+"</emphasis>"}if(!atom)return"";var atoms,c,result="";if(isArray(atom))for(var isInDigitRun=!1,isInTextRun=!1,i=0;i<atom.length;i++)"first"!==atom[i].type&&("text"!==atom[i].mode&&(isInTextRun=!1),i<atom.length-2&&"mopen"===atom[i].type&&"mclose"===atom[i+2].type&&"mord"===atom[i+1].type?(result+=" of ",result+=emph(atomToSpeakableFragment(mode,atom[i+1])),i+=2):"text"===atom[i].mode?isInTextRun?result+=null!=(_a3=atom[i].value)?_a3:" ":(isInTextRun=!0,result+=atomToSpeakableFragment("text",atom[i])):atom[i].isDigit()?isInDigitRun?result+=atom[i].asDigit():(isInDigitRun=!0,result+=atomToSpeakableFragment(mode,atom[i])):(isInDigitRun=!1,result+=atomToSpeakableFragment(mode,atom[i])));else if("text"===atom.mode)atom.id&&"math"===mode&&(result+='<mark name="'+atom.id.toString()+'"/>'),result+=atom.value;else{atom.id&&"math"===mode&&(result+='<mark name="'+atom.id.toString()+'"/>');var numer="",denom="",body="",supsubHandled=!1,command=atom.command;switch(command){case"\\vec":return"vector "+atomToSpeakableFragment(mode,atom.body);case"\\acute":return atomToSpeakableFragment(mode,atom.body)+" acute";case"\\grave":return atomToSpeakableFragment(mode,atom.body)+" grave";case"\\dot":return"dot over"+atomToSpeakableFragment(mode,atom.body);case"\\ddot":return"double dot over"+atomToSpeakableFragment(mode,atom.body);case"\\mathring":return"ring over"+atomToSpeakableFragment(mode,atom.body);case"\\tilde":case"\\widetilde":return"tilde over"+atomToSpeakableFragment(mode,atom.body);case"\\bar":return atomToSpeakableFragment(mode,atom.body)+" bar";case"\\breve":return atomToSpeakableFragment(mode,atom.body)+" breve";case"\\check":case"\\widecheck":return"check over "+atomToSpeakableFragment(mode,atom.body);case"\\hat":case"\\widehat":return"hat over"+atomToSpeakableFragment(mode,atom.body);case"\\overarc":case"\\overparen":case"\\wideparen":return"arc over "+atomToSpeakableFragment(mode,atom.body);case"\\underarc":case"\\underparen":return"arc under "+atomToSpeakableFragment(mode,atom.body)}switch(atom.type){case"prompt":result+=' <break time="300ms"/> '+(atom.body.length>1?'start input . <break time="500ms"/> '+atomToSpeakableFragment(mode,atom.body)+'. <break time="500ms"/> end input':"blank")+'. <break time="700ms"/>'+(null!=(_b3=atom.correctness)?_b3:"")+' . <break time="700ms"/> ';break;case"array":var array=atom.array,environment=atom.environmentName;if(Object.keys(ENVIRONMENTS_NAMES).includes(environment)){result+=" begin ".concat(ENVIRONMENTS_NAMES[environment]," ");for(var _i23=0;_i23<array.length;_i23++){_i23>0&&(result+=","),result+=" row ".concat(_i23+1," ");for(var j=0;j<array[_i23].length;j++)j>0&&(result+=","),result+=" column ".concat(j+1,": "),result+=atomToSpeakableFragment("math",array[_i23][j])}result+=" end ".concat(ENVIRONMENTS_NAMES[environment]," ")}break;case"group":"\\ne"===command?result+=" not equal ":"\\not"===command?(result+=" not ",result+=atomToSpeakableFragment("math",atom.body)):result+=atomToSpeakableFragment("math",atom.body);break;case"root":result+=atomToSpeakableFragment("math",atom.body);break;case"genfrac":if(numer=atomToSpeakableFragment("math",atom.above),denom=atomToSpeakableFragment("math",atom.below),isAtomic(atom.above)&&isAtomic(atom.below)){var commonFraction={"1/2":" half ","1/3":" one third ","2/3":" two third","1/4":" one quarter ","3/4":" three quarter ","1/5":" one fifth ","2/5":" two fifths ","3/5":" three fifths ","4/5":" four fifths ","1/6":" one sixth ","5/6":" five sixths ","1/8":" one eight ","3/8":" three eights ","5/8":" five eights ","7/8":" seven eights ","1/9":" one ninth ","2/9":" two ninths ","4/9":" four ninths ","5/9":" five ninths ","7/9":" seven ninths ","8/9":" eight ninths "}[atomicValue(atom.above)+"/"+atomicValue(atom.below)];commonFraction?result=commonFraction:result+=numer+" over "+denom}else result+=' the fraction <break time="150ms"/>'+numer+' over <break time="150ms"/>'+denom+'.<break time="150ms"/> End fraction.<break time="150ms"/>';break;case"surd":if(body=atomToSpeakableFragment("math",atom.body),atom.hasEmptyBranch("above"))result+=isAtomic(atom.body)?" the square root of "+body+" , ":' the square root of <break time="200ms"/>'+body+'. <break time="200ms"/> End square root';else{var index=atomToSpeakableFragment("math",atom.above),index2=(index=index.trim()).replace(/<mark([^/]*)\/>/g,"");result+="3"===index2?' the cube root of <break time="200ms"/>'+body+'. <break time="200ms"/> End cube root':"n"===index2?' the nth root of <break time="200ms"/>'+body+'. <break time="200ms"/> End root':' the root with index: <break time="200ms"/>'+index+', of <break time="200ms"/>'+body+'. <break time="200ms"/> End root'}break;case"leftright":var delimAtom=atom;result+=null!=(_c2=delimAtom.leftDelim?PRONUNCIATION[delimAtom.leftDelim]:void 0)?_c2:delimAtom.leftDelim,result+=atomToSpeakableFragment("math",atom.body),result+=null!=(_d2=delimAtom.rightDelim?PRONUNCIATION[delimAtom.rightDelim]:void 0)?_d2:delimAtom.rightDelim;break;case"rule":case"overunder":case"overlap":case"space":case"spacing":break;case"macro":var macroName=command.replace(/^\\/g,""),macro=getMacros()[macroName];macro&&((null==macro?void 0:macro.expand)?result+=atomToSpeakableFragment("math",atom.body):result+="".concat(macroName," "));break;case"placeholder":result+="placeholder ";break;case"delim":case"sizeddelim":case"mord":case"minner":case"mbin":case"mrel":case"mpunct":case"mopen":case"mclose":if("\\mathbin"===command||"\\mathrel"===command||"\\mathopen"===command||"\\mathclose"===command||"\\mathpunct"===command||"\\mathord"===command||"\\mathinner"===command){result=atomToSpeakableFragment(mode,atom.body);break}var atomValue=atom.isDigit()?atom.asDigit():atom.value,latexValue=atom.command;if("delim"!==atom.type&&"sizeddelim"!==atom.type||(atomValue=latexValue=atom.value),"text"===mode)result+=atomValue;else{if("mbin"===atom.type&&(result+='<break time="150ms"/>'),atomValue){var value=PRONUNCIATION[atomValue]||(latexValue?PRONUNCIATION[latexValue.trim()]:"");if(value)result+=" "+value;else{var spokenName=latexValue?function(latex){var result="";return latex.startsWith("\\")&&(result=" "+latex.replace("\\","")+" "),result}(latexValue.trim()):"";result+=spokenName||(c=atomValue,window.MathfieldElement.textToSpeechMarkup?/[a-z]/.test(c)?' <say-as interpret-as="character">'.concat(c,"</say-as>"):/[A-Z]/.test(c)?'capital <say-as interpret-as="character">'.concat(c.toLowerCase(),"</say-as>"):c:/[a-z]/.test(c)?" '"+c.toUpperCase()+"'":/[A-Z]/.test(c)?" 'capital "+c.toUpperCase()+"'":c)}}else result+=atomToSpeakableFragment("math",atom.body);"mbin"===atom.type&&(result+='<break time="150ms"/>')}break;case"mop":if("​"!==atom.value){var trimLatex=atom.command;if("\\sum"===trimLatex)if(atom.hasEmptyBranch("superscript")||atom.hasEmptyBranch("subscript"))if(atom.hasEmptyBranch("subscript"))result+=" the summation of";else{var _sub=atomToSpeakableFragment("math",atom.subscript);result+=' the summation from <break time="200ms"/>'+(_sub=_sub.trim())+'<break time="200ms"/> of <break time="150ms"/>',supsubHandled=!0}else{var sup=atomToSpeakableFragment("math",atom.superscript);sup=sup.trim();var sub=atomToSpeakableFragment("math",atom.subscript);result+=' the summation from <break time="200ms"/>'+(sub=sub.trim())+'<break time="200ms"/> to  <break time="200ms"/>'+sup+'<break time="200ms"/> of <break time="150ms"/>',supsubHandled=!0}else if("\\prod"===trimLatex)if(atom.hasEmptyBranch("superscript")||atom.hasEmptyBranch("subscript"))if(atom.hasEmptyBranch("subscript"))result+=" the product  of ";else{var _sub3=atomToSpeakableFragment("math",atom.subscript);result+=' the product from <break time="200ms"/>'+(_sub3=_sub3.trim())+'<break time="200ms"/> of <break time="150ms"/>',supsubHandled=!0}else{var _sup=atomToSpeakableFragment("math",atom.superscript);_sup=_sup.trim();var _sub2=atomToSpeakableFragment("math",atom.subscript);result+=' the product from <break time="200ms"/>'+(_sub2=_sub2.trim())+'<break time="200ms"/> to <break time="200ms"/>'+_sup+'<break time="200ms"/> of <break time="150ms"/>',supsubHandled=!0}else if("\\int"===trimLatex)if(atom.hasEmptyBranch("superscript")||atom.hasEmptyBranch("subscript"))result+=' the integral of <break time="200ms"/> ';else{var _sup2=atomToSpeakableFragment("math",atom.superscript);_sup2=_sup2.trim();var _sub4=atomToSpeakableFragment("math",atom.subscript);result+=' the integral from <break time="200ms"/>'+emph(_sub4=_sub4.trim())+'<break time="200ms"/> to <break time="200ms"/>'+emph(_sup2)+' <break time="200ms"/> of ',supsubHandled=!0}else if("string"==typeof atom.value){var _value=null!=(_e=PRONUNCIATION[atom.value])?_e:atom.command?PRONUNCIATION[atom.command]:void 0;result+=_value||" "+atom.value}else atom.command&&("\\mathop"===atom.command?result+=atomToSpeakableFragment("math",atom.body):"\\operatorname"===atom.command?result+=(atoms=atom.body)?atoms.map((function(atom){return atom.value})).join(""):"":result+=atom.command.startsWith("\\")?" "+atom.command.slice(1):" "+atom.command)}break;case"enclose":result+=" crossed out "+(body=atomToSpeakableFragment("math",atom.body))+". End crossed out."}if(!supsubHandled&&!atom.hasEmptyBranch("superscript")){var _sup3=atomToSpeakableFragment(mode,atom.superscript),sup2=(_sup3=_sup3.trim()).replace(/<[^>]*>/g,"");if(isAtomic(atom.superscript)){if("math"===mode){var id=function(atoms){if(isArray(atoms)){var _step131,_iterator131=_createForOfIteratorHelper(atoms);try{for(_iterator131.s();!(_step131=_iterator131.n()).done;){var atom=_step131.value;if("first"!==atom.type&&atom.id)return atom.id.toString()}}catch(err){_iterator131.e(err)}finally{_iterator131.f()}}return""}(atom.superscript);id&&(result+='<mark name="'+id+'"/>')}"′"===sup2?result+=" prime ":"2"===sup2?result+=" squared ":"3"===sup2?result+=" cubed ":Number.isNaN(Number.parseInt(sup2))?result+=" to the "+_sup3+"; ":result+=' to the <say-as interpret-as="ordinal">'+sup2+"</say-as> power; "}else Number.isNaN(Number.parseInt(sup2))?result+=" raised to the "+_sup3+"; ":result+=' raised to the <say-as interpret-as="ordinal">'+sup2+"</say-as> power; "}if(!supsubHandled&&!atom.hasEmptyBranch("subscript")){var _sub5=atomToSpeakableFragment("math",atom.subscript);_sub5=_sub5.trim(),result+=isAtomic(atom.subscript)?" sub "+_sub5:" subscript "+_sub5+". End subscript. "}}return result}function atomToSpeakableText(atoms){var _a3,_b3;if("sre"===window.MathfieldElement.textToSpeechRules&&("sre"in window||"SRE"in window)){var mathML=toMathML(atoms);if(mathML){window.MathfieldElement.textToSpeechMarkup&&(window.MathfieldElement.textToSpeechRulesOptions=null!=(_a3=window.MathfieldElement.textToSpeechRulesOptions)?_a3:{},window.MathfieldElement.textToSpeechRulesOptions.markup=window.MathfieldElement.textToSpeechMarkup,"ssml"===window.MathfieldElement.textToSpeechRulesOptions.markup&&(window.MathfieldElement.textToSpeechRulesOptions.markup="ssml_step"),window.MathfieldElement.textToSpeechRulesOptions.rate=window.MathfieldElement.speechEngineRate);var SRE=null!=(_b3=window.SRE)?_b3:window.sre.System.getInstance();window.MathfieldElement.textToSpeechRulesOptions&&SRE.setupEngine(window.MathfieldElement.textToSpeechRulesOptions);var result2="";try{result2=SRE.toSpeech(mathML)}catch(e){console.error("MathLive 0.94.6: `SRE.toSpeech()` runtime error",e)}return result2}return""}var result=atomToSpeakableFragment("math",atoms);if("ssml"===window.MathfieldElement.textToSpeechMarkup){var prosody="";window.MathfieldElement.speechEngineRate&&(prosody='<prosody rate="'+window.MathfieldElement.speechEngineRate+'">'),result='<?xml version="1.0"?><speak version="1.1" xmlns="http://www.w3.org/2001/10/synthesis" xml:lang="en-US"><amazon:auto-breaths>'+prosody+"<p><s>"+result+"</s></p>"+(prosody?"</prosody>":"")+"</amazon:auto-breaths></speak>"}else result="mac"===window.MathfieldElement.textToSpeechMarkup&&"macos"===osPlatform()?result.replace(/<mark([^/]*)\/>/g,"").replace(/<emphasis>/g,"[[emph+]]").replace(/<\/emphasis>/g,"").replace(/<break time="(\d*)ms"\/>/g,"[[slc $1]]").replace(/<say-as[^>]*>/g,"").replace(/<\/say-as>/g,""):result.replace(/<[^>]*>/g,"").replace(/\s{2,}/g," ");return result}function speakableText(prefix,atoms){return prefix+atomToSpeakableText(atoms)}function relationName(atom){var _a3,result=void 0;if("prompt"===atom.parent.type)"body"===atom.parentBranch&&(result="prompt");else if("body"===atom.parentBranch)result=atom.type&&null!=(_a3={enclose:"cross out",leftright:"delimiter",surd:"square root",root:"math field",mop:"operator",first:"first"}[atom.type])?_a3:"parent";else if("genfrac"===atom.parent.type){if("above"===atom.parentBranch)return"numerator";if("below"===atom.parentBranch)return"denominator"}else"surd"===atom.parent.type?"above"===atom.parentBranch&&(result="index"):"superscript"===atom.parentBranch?result="superscript":"subscript"===atom.parentBranch&&(result="subscript");return result||console.log("unknown relationship"),null!=result?result:"parent"}function defaultAnnounceHook(mathfield,action,previousPosition,atoms){var liveText="";if("plonk"===action)window.MathfieldElement.playSound("plonk"),mathfield.flushInlineShortcutBuffer();else if("delete"===action)liveText=speakableText("deleted: ",atoms);else if("focus"===action||action.includes("move"))liveText=function(model,previousOffset){if(Number.isNaN(previousOffset))return"";var previous=model.at(previousOffset);if(!previous)return"";if(previous.treeDepth<=model.at(model.position).treeDepth)return"";for(var result="",ancestor=previous.parent,newParent=model.at(model.position).parent;ancestor!==model.root&&ancestor!==newParent;)result+="out of ".concat(relationName(ancestor),";"),ancestor=ancestor.parent;return result}(mathfield.model,previousPosition)+(mathfield.model.selectionIsCollapsed?"":"selected: ")+function(model){if(!model.selectionIsCollapsed)return speakableText("",model.getAtoms(model.selection));var result="",cursor=model.at(model.position),relation=relationName(cursor);return cursor.isFirstSibling&&(result=(relation?"start of "+relation:"unknown")+": "),cursor.isLastSibling?cursor.isFirstSibling||(result+=relation?"end of "+relation:"unknown"):result+=speakableText("",cursor),result}(mathfield.model);else if("replacement"===action)liveText=speakableText("",mathfield.model.at(mathfield.model.position));else if("line"===action){var label=speakableText("",mathfield.model.root);mathfield.keyboardDelegate.setAriaLabel(label)}else liveText=atoms?speakableText(action+" ",atoms):action;if(liveText){var ariaLiveChangeHack=mathfield.ariaLiveText.textContent.includes(" ")?"   ":"   ";mathfield.ariaLiveText.textContent=liveText+ariaLiveChangeHack}}register2({speak:function(mathfield,scope,options){return function(mathfield,scope,speakOptions){var _a3,_b3;speakOptions=null!=speakOptions?speakOptions:{withHighlighting:!1};var model=mathfield.model;function getAtoms(scope2){var result=null;switch(scope2){case"all":default:result=model.root;break;case"selection":result=model.getAtoms(model.selection);break;case"left":result=model.getAtoms(model.offsetOf(model.at(model.position).leftSibling),model.position);break;case"right":result=model.getAtoms(model.position,model.offsetOf(model.at(model.position).rightSibling));break;case"group":result=model.getAtoms(model.getSiblingsRange(model.position));break;case"parent":var parent=model.at(model.position).parent;result=(null==parent?void 0:parent.parent)?parent:model.root}return result}function getFailedSpeech(scope2){var result="";switch(scope2){case"all":console.log("Internal failure: speak all failed");break;case"selection":result="no selection";break;case"left":result="at start";break;case"right":result="at end";break;case"group":console.log("Internal failure: speak group failed");break;case"parent":result="no parent";break;default:console.log('unknown speak_ param value: "'+scope2+'"')}return result}var atoms=getAtoms(scope);if(null===atoms)return null==(_b3=(_a3=window.MathfieldElement).speakHook)||_b3.call(_a3,getFailedSpeech(scope)),!1;(speakOptions.withHighlighting||"amazon"===window.MathfieldElement.speechEngine)&&(window.MathfieldElement.textToSpeechMarkup=window.sre&&"sre"===window.MathfieldElement.textToSpeechRules?"ssml_step":"ssml");var text=atomToSpeakableText(atoms);return isBrowser()&&speakOptions.withHighlighting?(_globalMathLive().readAloudMathField=mathfield,render(mathfield,{forHighlighting:!0}),window.MathfieldElement.readAloudHook&&window.MathfieldElement.readAloudHook(mathfield.field,text)):window.MathfieldElement.speakHook&&window.MathfieldElement.speakHook(text),!1}(mathfield,scope,options)}},{target:"mathfield"});var ModelPrivate=function(){function ModelPrivate(target,mode,root,listeners){_classCallCheck(this,ModelPrivate),this.mathfield=target,this.mode=mode,this.silenceNotifications=!1,this.listeners=listeners,this._selection={ranges:[[0,0]],direction:"none"},this._anchor=0,this._position=0,this.root=root}return _createClass(ModelPrivate,[{key:"dispose",value:function(){this.mathfield=void 0,this.listeners.onSelectionDidChange=void 0,this.listeners.onContentWillChange=void 0}},{key:"getState",value:function(){var selection={ranges:_toConsumableArray(this._selection.ranges)};return this.selection.direction&&"none"!==this.selection.direction&&(selection.direction=this.selection.direction),{content:this.root.toJson(),selection:selection,mode:this.mode}}},{key:"setState",value:function(state,options){var _a3,wasSuppressing=this.silenceNotifications;this.silenceNotifications=null==(_a3=null==options?void 0:options.silenceNotifications)||_a3;var changeOption={};if("undo"===(null==options?void 0:options.type)&&(changeOption={inputType:"historyUndo"}),"redo"===(null==options?void 0:options.type)&&(changeOption={inputType:"historyRedo"}),contentWillChange(this,changeOption)){var didSuppress=this.silenceNotifications;this.silenceNotifications=!0,this.mode=state.mode,this.root=_fromJson(state.content),this.selection=state.selection,this.silenceNotifications=didSuppress,contentDidChange(this,changeOption)}this.silenceNotifications=wasSuppressing}},{key:"atoms",get:function(){return this.root.children}},{key:"selection",get:function(){return this._selection},set:function(value){this.setSelection(value)}},{key:"setSelection",value:function(arg1,arg2){var _this31=this;return!(!this.mathfield.contentEditable&&"none"===this.mathfield.userSelect)&&this.deferNotifications({selection:!0},(function(){var _a3,_b3,_c2,value=_this31.normalizeSelection(arg1,arg2);if(void 0===value)throw new TypeError("Invalid selection");if(1===value.ranges.length&&value.ranges[0][0]===value.ranges[0][1]){var pos=value.ranges[0][0];return _this31.mathfield.dirty||(null==(_a3=_this31.at(pos))?void 0:_a3.parentPrompt)||!_this31.mathfield.hasEditablePrompts?(_this31._anchor=pos,_this31._position=pos,_this31._selection=value,!1):(null==(_b3=_this31.at(pos-1))?void 0:_b3.parentPrompt)?(_this31._anchor=_this31.normalizeOffset(pos-1),_this31._position=_this31._anchor,_this31._selection=_this31.normalizeSelection(_this31._anchor),!0):(null==(_c2=_this31.at(pos+1))?void 0:_c2.parentPrompt)?(_this31._anchor=_this31.normalizeOffset(pos+1),_this31._position=_this31._anchor,_this31._selection=_this31.normalizeSelection(_this31._anchor),!0):(_this31._anchor=0,_this31._position=0,_this31._selection={ranges:[[0,0]]},!1)}var selRange=range(value);if("backward"===value.direction){var _selRange=_slicedToArray(selRange,2);_this31._position=_selRange[0],_this31._anchor=_selRange[1]}else{var _selRange2=_slicedToArray(selRange,2);_this31._anchor=_selRange2[0],_this31._position=_selRange2[1]}var first=_this31.at(selRange[0]+1),last=_this31.at(selRange[1]),commonAncestor=Atom.commonAncestor(first,last);return"array"===(null==commonAncestor?void 0:commonAncestor.type)&&first.parent===commonAncestor&&last.parent,_this31._selection={ranges:[selRange],direction:value.direction},console.assert(_this31._position>=0&&_this31._position<=_this31.lastOffset),!1}))}},{key:"setPositionHandlingPlaceholder",value:function(pos){var _a3,atom=this.at(pos);"placeholder"===(null==atom?void 0:atom.type)?this.setSelection(pos-1,pos):"placeholder"===(null==(_a3=null==atom?void 0:atom.rightSibling)?void 0:_a3.type)?this.setSelection(pos,pos+1):this.position=pos,atom instanceof LatexAtom&&atom.isSuggestion&&(atom.isSuggestion=!1),this.mathfield.stopCoalescingUndo()}},{key:"position",get:function(){return this._position},set:function(value){this.setSelection(value,value)}},{key:"anchor",get:function(){return this._anchor}},{key:"selectionIsCollapsed",get:function(){return this._anchor===this._position}},{key:"selectionIsPlaceholder",get:function(){return 1===Math.abs(this._anchor-this._position)&&"placeholder"===this.at(Math.max(this._anchor,this._position)).type}},{key:"collapseSelection",value:function(){var direction=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"forward";return this._anchor!==this._position&&(this.position="backward"===direction?Math.min(this._anchor,this._position):Math.max(this._anchor,this._position),!0)}},{key:"lastOffset",get:function(){return this.atoms.length-1}},{key:"at",value:function(index){return this.atoms[index]}},{key:"offsetOf",value:function(atom){return this.atoms.indexOf(atom)}},{key:"getSiblingsRange",value:function(offset){var atom=this.at(offset);if(!atom.parent)return[0,this.lastOffset];var branch=atom.parent.branch(atom.parentBranch);return[this.offsetOf(branch[0]),this.offsetOf(branch[branch.length-1])]}},{key:"getBranchRange",value:function(offset,branchName){var branch=this.at(offset).branch(branchName);return[this.offsetOf(branch[0]),this.offsetOf(branch[branch.length-1])]}},{key:"getAtoms",value:function(arg1,arg2,arg3){var start,end,_this32=this,options=null!=arg3?arg3:{};if(isSelection(arg1)){if(options=null!=arg2?arg2:{},arg1.ranges.length>1)return arg1.ranges.reduce((function(acc,range2){return[].concat(_toConsumableArray(acc),_toConsumableArray(_this32.getAtoms(range2,options)))}),[]);arg1=arg1.ranges[0]}if(isOffset(arg1)){if(start=arg1,!isOffset(arg2))return[];end=arg2}else{var _arg3=_slicedToArray(arg1,2);start=_arg3[0],end=_arg3[1],options=null!=arg2?arg2:{}}if(!Number.isFinite(start))return[];void 0===options.includeChildren&&(options.includeChildren=!1),start<0&&(start=this.lastOffset-start+1),end<0&&(end=this.lastOffset-end+1);var first=Math.min(start,end)+1,last=Math.max(start,end);if(!options.includeChildren&&1===first&&last===this.lastOffset)return[this.root];for(var result=[],i=first;i<=last;i++){var atom=this.atoms[i];atomIsInRange(this,atom,first,last)&&result.push(atom)}return options.includeChildren||(result=result.filter((function(atom){for(var ancestorIncluded=!1,parent=atom.parent;parent&&!ancestorIncluded;)ancestorIncluded=atomIsInRange(_this32,parent,first,last),parent=parent.parent;return!ancestorIncluded}))),result}},{key:"getAllAtoms",value:function(){for(var startingIndex=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,result=[],last=this.lastOffset,i=startingIndex;i<=last;i++)result.push(this.atoms[i]);for(var _i24=0;_i24<startingIndex;_i24++)result.push(this.atoms[_i24]);return result}},{key:"findAtom",value:function(filter){var startingIndex=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,direction=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"forward";if("forward"!==direction){for(var _i26=startingIndex;_i26>=0;_i26--)if(filter(this.atoms[_i26]))return this.atoms[_i26];for(var _i27=this.lastOffset;_i27<startingIndex;_i27--)if(filter(this.atoms[_i27]))return this.atoms[_i27]}else{for(var last=this.lastOffset,i=startingIndex;i<=last;i++)if(filter(this.atoms[i]))return this.atoms[i];for(var _i25=0;_i25<startingIndex;_i25++)if(filter(this.atoms[_i25]))return this.atoms[_i25]}}},{key:"extractAtoms",value:function(range2){var result=this.getAtoms(range2);if(1===result.length&&!result[0].parent){if("root"!==result[0].type)return result=this.root.cells.flat(),this.root=new Atom({type:"root",body:[]}),result;(result=_toConsumableArray(result[0].body)).shift()}var _step133,_iterator133=_createForOfIteratorHelper(result);try{for(_iterator133.s();!(_step133=_iterator133.n()).done;){var child=_step133.value;child.parent.removeChild(child)}}catch(err){_iterator133.e(err)}finally{_iterator133.f()}return result}},{key:"deleteAtoms",value:function(range2){this.extractAtoms(range2),this.position=range2[0]}},{key:"atomToString",value:function(atom,inFormat){var format=null!=inFormat?inFormat:"latex";if(format.startsWith("latex"))return Atom.serialize([atom],{expandMacro:"latex-expanded"===format,skipStyles:"latex-unstyled"===format,defaultMode:this.mathfield.options.defaultMode});if("math-ml"===format)return toMathML(atom);if("spoken"===format)return atomToSpeakableText(atom);if("spoken-text"===format){var saveTextToSpeechMarkup=window.MathfieldElement.textToSpeechMarkup;window.MathfieldElement.textToSpeechMarkup="";var result=atomToSpeakableText(atom);return window.MathfieldElement.textToSpeechMarkup=saveTextToSpeechMarkup,result}if("spoken-ssml"===format||"spoken-ssml-with-highlighting"===format){var _saveTextToSpeechMarkup=window.MathfieldElement.textToSpeechMarkup;window.MathfieldElement.textToSpeechMarkup="ssml";var _result4=atomToSpeakableText(atom);return window.MathfieldElement.textToSpeechMarkup=_saveTextToSpeechMarkup,_result4}return"ascii-math"===format?atomToAsciiMath(atom):(console.error('MathLive 0.94.6: Unexpected format "'.concat(format)),"")}},{key:"getValue",value:function(arg1,arg2,arg3){var ranges,format,_this33=this;if(void 0===arg1)return this.atomToString(this.root,"latex");if("string"==typeof arg1&&"math-json"!==arg1)return this.atomToString(this.root,arg1);if(isOffset(arg1)&&isOffset(arg2)?(ranges=[this.normalizeRange([arg1,arg2])],format=null!=arg3?arg3:"latex"):isRange(arg1)?(ranges=[this.normalizeRange(arg1)],format=arg2):isSelection(arg1)?(ranges=arg1.ranges,format=arg2):(ranges=[this.normalizeRange([0,-1])],format=null!=arg1?arg1:"latex"),"math-json"===format){if(!window.MathfieldElement.computeEngine)return window[Symbol.for("io.cortexjs.compute-engine")]||console.error('The CortexJS Compute Engine library is not available.\nLoad the library, for example with:\nimport "https://unpkg.com/@cortex-js/compute-engine?module"'),'["Error", "compute-engine-not-available"]';var latex=this.getValue({ranges:ranges},"latex-unstyled");try{var expr=window.MathfieldElement.computeEngine.parse(latex);return JSON.stringify(expr.json)}catch(e){return JSON.stringify(["Error","'".concat(e.toString(),"'")])}}if(format.startsWith("latex")){var options={expandMacro:"latex-expanded"===format,skipStyles:"latex-unstyled"===format,defaultMode:this.mathfield.options.defaultMode};return joinLatex(ranges.map((function(range2){return Atom.serialize(_this33.getAtoms(range2),options)})))}return ranges.map((function(range2){return _this33.getAtoms(range2).map((function(atom){return _this33.atomToString(atom,format)})).join("")})).join("")}},{key:"extendSelectionTo",value:function(anchor,position){var _this34=this;return!(!this.mathfield.contentEditable&&"none"===this.mathfield.userSelect)&&this.deferNotifications({selection:!0},(function(){var _range2=_slicedToArray(_this34.normalizeRange([anchor,position]),2),start=_range2[0],end=_range2[1],parent=_this34.at(end).parent;if(parent&&("genfrac"===parent.type||"subsup"===parent.type))for(;parent!==_this34.root&&childrenInRange(_this34,parent,[start,end]);)end=_this34.offsetOf(parent),parent=parent.parent;for(parent=_this34.at(start).parent;parent!==_this34.root&&childrenInRange(_this34,parent,[start,end]);)start=_this34.offsetOf(parent.leftSibling),parent=parent.parent;if("genfrac"===(null==(parent=_this34.at(end).parent)?void 0:parent.type))for(;parent!==_this34.root&&childrenInRange(_this34,parent,[start,end]);)end=_this34.offsetOf(parent),console.assert(end>=0),parent=parent.parent;_this34._position=_this34.normalizeOffset(position),_this34._selection={ranges:[[start,end]],direction:"none"}}))}},{key:"announce",value:function(command,previousPosition){var _a3,_b3,atoms=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],result=null==(_b3=null==(_a3=this.mathfield.host)?void 0:_a3.dispatchEvent(new CustomEvent("announce",{detail:{command:command,previousPosition:previousPosition,atoms:atoms},cancelable:!0,bubbles:!0,composed:!0})))||_b3;result&&defaultAnnounceHook(this.mathfield,command,previousPosition,atoms)}},{key:"deferNotifications",value:function(options,f){var oldSelection=this._selection,oldAnchor=this._anchor,oldPosition=this._position,saved=this.silenceNotifications;this.silenceNotifications=!0;var previousCounter=this.root.changeCounter;f();var contentChanged=this.root.changeCounter!==previousCounter,selectionChanged=oldAnchor!==this._anchor||oldPosition!==this._position||"different"===function(a,b){if(a.direction===b.direction){var l=a.ranges.length;if(b.ranges.length===l){for(var i=0;i<l&&"equal"===compareRange(a.ranges[i],b.ranges[i]);)i++;return i===l?"equal":"different"}}return"different"}(this._selection,oldSelection);return this.silenceNotifications=saved,options.content&&contentChanged&&contentDidChange(this,{inputType:options.type}),options.selection&&selectionChanged&&selectionDidChange(this),contentChanged||selectionChanged}},{key:"normalizeOffset",value:function(value){return value>0?value=Math.min(value,this.lastOffset):value<0&&(value=this.lastOffset+value+1),value}},{key:"normalizeRange",value:function(range2){var _range3=_slicedToArray(range2,2),start=_range3[0],end=_range3[1];return(start=this.normalizeOffset(start))<(end=this.normalizeOffset(end))?[start,end]:[end,start]}},{key:"normalizeSelection",value:function(value,value2){var _a3,_this35=this,result=void 0;if(isOffset(value)){var offset=this.normalizeOffset(value);if(isOffset(value2)){var offset2=this.normalizeOffset(value2);result=offset<=offset2?{ranges:[[offset,offset2]],direction:"none"}:{ranges:[[offset2,offset]],direction:"backward"}}else result={ranges:[[offset,offset]],direction:"none"}}else if(isRange(value)){var start=this.normalizeOffset(value[0]),end=this.normalizeOffset(value[1]);result=start<=end?{ranges:[[start,end]],direction:"none"}:{ranges:[[end,start]],direction:"backward"}}else isSelection(value)&&(result={ranges:value.ranges.map((function(x){return _this35.normalizeRange(x)})),direction:null!=(_a3=value.direction)?_a3:"none"});return console.assert(void 0!==result),result}},{key:"parentEnvironment",get:function(){var parent=this.at(this.position).parent;if(parent){for(;parent.parent&&"array"!==parent.type;)parent=parent.parent;if("array"===parent.type)return parent}}}]),ModelPrivate}();function atomIsInRange(model,atom,first,last){var offset=model.offsetOf(atom);if(offset<first||offset>last)return!1;if(!atom.hasChildren)return!0;var firstOffset=model.offsetOf(atom.firstChild);if(firstOffset>=first&&firstOffset<=last){var lastOffset=model.offsetOf(atom.lastChild);if(lastOffset>=first&&lastOffset<=last)return!0}return!1}function childrenInRange(model,atom,range2){if(!(null==atom?void 0:atom.hasChildren))return!1;var _range4=_slicedToArray(range2,2),start=_range4[0],end=_range4[1],first=model.offsetOf(atom.firstChild),last=model.offsetOf(atom.lastChild);return first>=start&&first<=end&&last>=first&&last<=end}function isContentEmpty(array){var _step134,_iterator134=_createForOfIteratorHelper(array);try{for(_iterator134.s();!(_step134=_iterator134.n()).done;){var _step135,_iterator135=_createForOfIteratorHelper(_step134.value);try{for(_iterator135.s();!(_step135=_iterator135.n()).done;)if(_step135.value.length>0)return!1}catch(err){_iterator135.e(err)}finally{_iterator135.f()}}}catch(err){_iterator134.e(err)}finally{_iterator134.f()}return!0}function defaultContent(array){var count=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return isContentEmpty(array)?Array(count).fill([[new Atom({type:"first"}),new PlaceholderAtom]]):array.map((function(row){return 0===row.length?[[new Atom({type:"first"})]]:row.map((function(cell){return 0===cell.length?[new Atom({type:"first"})]:("first"!==cell[0].type&&cell.unshift(new Atom({type:"first"})),cell)}))}))}function makeEnvironment(name){var content=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[[[]]],rowGaps=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],args=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];switch(content=defaultContent(content,["split","align","align*","aligned","eqnarray"].includes(name)?2:1),name){case"math":case"displaymath":return new ArrayAtom(name,content,rowGaps,{mathstyleName:"textstyle"});case"center":return new ArrayAtom(name,content,rowGaps,{columns:[{align:"c"}]});case"multline":case"multline*":return new ArrayAtom(name,content,rowGaps,{columns:[{align:"m"}],leftDelim:".",rightDelim:"."});case"split":return new ArrayAtom(name,content,rowGaps,{columns:[{align:"r"},{align:"l"}],minColumns:2});case"gather":case"gathered":return new ArrayAtom(name,content,rowGaps,{columns:[{gap:.25},{align:"c"},{gap:0}]});case"pmatrix":case"pmatrix*":return new ArrayAtom(name,content,rowGaps,{mathstyleName:"textstyle",leftDelim:"(",rightDelim:")",columns:defaultColumns(args[0])});case"bmatrix":case"bmatrix*":return new ArrayAtom(name,content,rowGaps,{mathstyleName:"textstyle",leftDelim:"[",rightDelim:"]",columns:defaultColumns(args[0])});case"Bmatrix":case"Bmatrix*":return new ArrayAtom(name,content,rowGaps,{mathstyleName:"textstyle",leftDelim:"\\lbrace",rightDelim:"\\rbrace",columns:defaultColumns(args[0])});case"vmatrix":case"vmatrix*":return new ArrayAtom(name,content,rowGaps,{mathstyleName:"textstyle",leftDelim:"\\vert",rightDelim:"\\vert",columns:defaultColumns(args[0])});case"Vmatrix":case"Vmatrix*":return new ArrayAtom(name,content,rowGaps,{mathstyleName:"textstyle",leftDelim:"\\Vert",rightDelim:"\\Vert",columns:defaultColumns(args[0])});case"matrix":case"matrix*":return new ArrayAtom(name,content,rowGaps,{mathstyleName:"textstyle",leftDelim:".",rightDelim:".",columns:defaultColumns(null==args?void 0:args[0])});case"smallmatrix":case"smallmatrix*":return new ArrayAtom(name,content,rowGaps,{mathstyleName:"scriptstyle",columns:defaultColumns(null==args?void 0:args[0]),colSeparationType:"small",arraystretch:.5});case"cases":case"dcases":return new ArrayAtom(name,content,rowGaps,{mathstyleName:"dcases"===name?"displaystyle":"textstyle",arraystretch:1.2,leftDelim:"\\lbrace",rightDelim:".",columns:[{align:"l"},{gap:1},{align:"l"}]});case"rcases":return new ArrayAtom(name,content,rowGaps,{arraystretch:1.2,leftDelim:".",rightDelim:"\\rbrace",columns:[{align:"l"},{gap:1},{align:"l"}]});case"lines":return new ArrayAtom(name,content,rowGaps,{leftDelim:".",rightDelim:".",columns:[{align:"l"}]});case"align":case"align*":case"aligned":case"eqnarray":var _step136,colCount=0,_iterator136=_createForOfIteratorHelper(content);try{for(_iterator136.s();!(_step136=_iterator136.n()).done;){var row=_step136.value;colCount=Math.max(colCount,row.length)}}catch(err){_iterator136.e(err)}finally{_iterator136.f()}for(var columns=[{gap:0},{align:"r"},{gap:.25},{align:"l"}],i=2;i<colCount;)columns.push({gap:1},{align:"r"},{gap:.25},{align:"l"}),i+=2;return columns.push({gap:0}),new ArrayAtom(name,content,rowGaps,{arraycolsep:0,columns:columns,minColumns:2})}return new ArrayAtom(name,content,rowGaps,{mathstyleName:"textstyle"})}function defaultColumns(args){return null!=args?args:[{align:"c"},{align:"c"},{align:"c"},{align:"c"},{align:"c"},{align:"c"},{align:"c"},{align:"c"},{align:"c"},{align:"c"}]}function isPlaceholderCell(array,row,column){var cell=array.getCell(row,column);return!(!cell||2!==cell.length)&&"placeholder"===cell[1].type}function selectCell(model,array,row,column){var range2=function(model,array,row,column){var cell=array.getCell(row,column);return cell?[model.offsetOf(cell[0]),model.offsetOf(cell[cell.length-1])]:-1}(model,array,row,column);"number"!=typeof range2&&model.setSelection(range2)}function setPositionInCell(model,array,row,column,pos){var cell=array.getCell(row,column);cell&&model.setPositionHandlingPlaceholder(model.offsetOf(cell["start"===pos?0:cell.length-1]))}function addCell(model,where){var _parentArray=function(model,where){for(var atom=model.at(model.position);atom&&!(atom.parent instanceof ArrayAtom);)atom=atom.parent;if(atom&&"array"===atom.type&&atom.environmentName,!(atom&&atom.parent instanceof ArrayAtom)){var cursor=model.at(model.position);if(!(atom=cursor).parent.parent){var _array,secondCell=model.extractAtoms([model.position,model.lastOffset]),firstCell=model.extractAtoms([0,model.position]);return 0===firstCell.length&&(firstCell=placeholderCell()),0===secondCell.length&&(secondCell=placeholderCell()),where.endsWith("column")?(_array=makeEnvironment("split",[[firstCell,secondCell]]),model.root=_array,isPlaceholderCell(_array,0,0)?selectCell(model,_array,0,0):isPlaceholderCell(_array,0,1)?selectCell(model,_array,0,1):model.position=model.offsetOf(cursor)):(_array=makeEnvironment("lines",[[firstCell],[secondCell]]),model.root=_array,isPlaceholderCell(_array,0,0)?selectCell(model,_array,0,0):isPlaceholderCell(_array,1,0)?selectCell(model,_array,1,0):model.position=model.offsetOf(cursor)),[void 0,[0,0]]}if(atom.parent instanceof LeftRightAtom){var parent=atom.parent,_secondCell=model.extractAtoms([model.position,model.offsetOf(parent.lastChild)]),_firstCell=model.extractAtoms([model.offsetOf(parent.firstChild),model.position]);0===_firstCell.length&&(_firstCell=placeholderCell()),0===_secondCell.length&&(_secondCell=placeholderCell());var envName="pmatrix",lDelim=parent.leftDelim,rDelim=parent.rightDelim;"("!==lDelim||")"!==rDelim&&"?"!==rDelim?"["!==lDelim&&"\\lbrack"!==lDelim||"]"!==rDelim&&"\\rbrack"!==rDelim&&"?"!==rDelim?"\\vert"===lDelim&&"\\vert"===rDelim?envName="vmatrix":"\\Vert"===lDelim&&"\\Vert"===rDelim?envName="Vmatrix":"{"!==lDelim&&"\\lbrace"!==lDelim||"."!==rDelim&&"?"!==rDelim||(envName="cases"):envName="bmatrix":envName="pmatrix";var _array2=makeEnvironment(envName,where.endsWith("column")?[[_firstCell,_secondCell]]:[[_firstCell],[_secondCell]]);return parent.parent.addChildBefore(_array2,parent),parent.parent.removeChild(parent),isPlaceholderCell(_array2,0,0)?selectCell(model,_array2,0,0):where.endsWith("column")?isPlaceholderCell(_array2,0,1)?selectCell(model,_array2,0,1):model.position=model.offsetOf(atom):isPlaceholderCell(_array2,1,0)?selectCell(model,_array2,1,0):model.position=model.offsetOf(atom),[void 0,[0,0]]}}return atom&&atom.parent instanceof ArrayAtom?[atom.parent,atom.parentBranch]:[void 0,[0,0]]}(model,where),_parentArray2=_slicedToArray(_parentArray,2),arrayAtom=_parentArray2[0],_parentArray2$=_slicedToArray(_parentArray2[1],2),row=_parentArray2$[0],column=_parentArray2$[1];if(arrayAtom)switch(where){case"after row":arrayAtom.addRowAfter(row),setPositionInCell(model,arrayAtom,row+1,0,"end");break;case"after column":if(arrayAtom.maxColumns<=arrayAtom.colCount)return void model.announce("plonk");arrayAtom.addColumnAfter(column),setPositionInCell(model,arrayAtom,row,column+1,"end");break;case"before row":arrayAtom.addRowBefore(row),setPositionInCell(model,arrayAtom,row,0,"start");break;case"before column":if(arrayAtom.maxColumns<=arrayAtom.colCount)return void model.announce("plonk");arrayAtom.addColumnBefore(column),setPositionInCell(model,arrayAtom,row,column,"start")}}function addRowAfter(model){return!!contentWillChange(model,{inputType:"insertText"})&&(addCell(model,"after row"),contentDidChange(model,{inputType:"insertText"}),!0)}function addColumnAfter(model){return!!contentWillChange(model,{inputType:"insertText"})&&(addCell(model,"after column"),contentDidChange(model,{inputType:"insertText"}),!0)}function removeCell(model,where){for(var atom=model.at(model.position);atom&&!(Array.isArray(atom.parentBranch)&&atom.parent instanceof ArrayAtom);)atom=atom.parent;if(Array.isArray(null==atom?void 0:atom.parentBranch)&&(null==atom?void 0:atom.parent)instanceof ArrayAtom){var pos,arrayAtom=atom.parent,treeBranch=atom.parentBranch;switch(where){case"row":if(arrayAtom.rowCount>1){arrayAtom.removeRow(treeBranch[0]);var cell=arrayAtom.getCell(Math.max(0,treeBranch[0]-1),treeBranch[1]);pos=model.offsetOf(cell[cell.length-1])}break;case"column":if(arrayAtom.colCount>arrayAtom.minColumns){arrayAtom.removeColumn(treeBranch[1]);var _cell2=arrayAtom.getCell(treeBranch[0],Math.max(0,treeBranch[1]-1));pos=model.offsetOf(_cell2[_cell2.length-1])}}pos&&model.setPositionHandlingPlaceholder(pos)}}function placeholderCell(){return[new PlaceholderAtom]}function onDelete(model,direction,atom,branch){var _a3,_b3,_c2,_d2,_e,_f,parent=atom.parent;if(parent&&atom instanceof LeftRightAtom){var atStart=!branch&&"forward"===direction||"body"===branch&&"backward"===direction,pos=atStart?model.offsetOf(atom.firstChild):model.offsetOf(atom.lastChild);return atStart?"?"!==atom.rightDelim&&"."!==atom.rightDelim?(atom.leftDelim=".",atom.isDirty=!0):(parent.addChildrenAfter(atom.removeBranch("body"),atom),parent.removeChild(atom),pos--):"?"!==atom.leftDelim&&"."!==atom.leftDelim?(atom.rightDelim=".",atom.isDirty=!0):(parent.addChildrenAfter(atom.removeBranch("body"),atom),parent.removeChild(atom),pos--),model.position=pos,!0}if(parent&&"surd"===atom.type){if("forward"===direction&&!branch||"backward"===direction&&"body"===branch){var _pos=atom.leftSibling;atom.hasChildren&&parent.addChildrenAfter(atom.removeBranch("body"),atom),parent.removeChild(atom),model.position=model.offsetOf(_pos)}else"forward"===direction&&"body"===branch?model.position=model.offsetOf(atom):branch||"backward"!==direction?"above"===branch&&(atom.hasEmptyBranch("above")&&atom.removeBranch("above"),model.position="backward"===direction?model.offsetOf(atom.leftSibling):model.offsetOf(atom.body[0])):atom.hasChildren?model.position=model.offsetOf(atom.lastChild):(model.position=Math.max(0,model.offsetOf(atom)-1),parent.removeChild(atom));return!0}if(parent&&("box"===atom.type||"enclose"===atom.type)){var _pos2=branch&&"backward"===direction||!branch&&"forward"===direction?atom.leftSibling:atom.lastChild;return parent.addChildrenAfter(atom.removeBranch("body"),atom),parent.removeChild(atom),model.position=model.offsetOf(_pos2),!0}if("genfrac"===atom.type||"overunder"===atom.type){if(!branch)return!("overunder"===atom.type&&atom.hasEmptyBranch("body")||"genfrac"===atom.type&&atom.hasEmptyBranch("below")&&atom.hasEmptyBranch("above")||(model.position=model.offsetOf("forward"===direction?atom.firstChild:atom.lastChild),0));var firstBranch="numerator-denominator"===mathfield_element_default.fractionNavigationOrder?"above":"below",secondBranch="above"===firstBranch?"below":"above";if(parent&&("forward"===direction&&branch===firstBranch||"backward"===direction&&branch===secondBranch)){var first=atom.removeBranch(firstBranch),second=atom.removeBranch(secondBranch);return parent.addChildrenAfter([].concat(_toConsumableArray(first),_toConsumableArray(second)),atom),parent.removeChild(atom),model.position=model.offsetOf(first.length>0?first[first.length-1]:second[0]),!0}return model.position="backward"===direction?model.offsetOf(atom.leftSibling):model.offsetOf(atom),!0}if(atom.isExtensibleSymbol||"subsup"===atom.type){if(!branch&&"forward"===direction)return!1;if(!branch){if(atom.subscript||atom.superscript){var _pos3="forward"===direction?null!=(_c2=null==(_a3=atom.superscript)?void 0:_a3[0])?_c2:null==(_b3=atom.subscript)?void 0:_b3[0]:null!=(_f=null==(_d2=atom.subscript)?void 0:_d2[0].lastSibling)?_f:null==(_e=atom.superscript)?void 0:_e[0].lastSibling;return _pos3&&(model.position=model.offsetOf(_pos3)),!0}return!1}if(branch&&atom.hasEmptyBranch(branch)&&atom.removeBranch(branch),!atom.hasChildren){var _pos4="forward"===direction?model.offsetOf(atom):Math.max(0,model.offsetOf(atom)-1);return atom.parent.removeChild(atom),model.position=_pos4,!0}if("superscript"===branch)if("backward"===direction){var _pos5=model.offsetOf(atom.firstChild)-1;console.assert(_pos5>=0),model.position=_pos5}else atom.subscript?model.position=model.offsetOf(atom.subscript[0]):model.position=model.offsetOf(atom);else"subscript"===branch&&("backward"===direction&&atom.superscript?model.position=model.offsetOf(atom.superscript[0].lastSibling):model.position="backward"===direction?model.offsetOf(atom.firstChild)-1:model.offsetOf(atom));return!0}if("genfrac"===(null==parent?void 0:parent.type)&&!branch&&"first"!==atom.type){var _pos6=model.offsetOf(atom.leftSibling);return parent.removeChild(atom),parent.hasEmptyBranch("above")&&parent.hasEmptyBranch("below")?(_pos6=model.offsetOf(parent.leftSibling),parent.parent.removeChild(parent),model.announce("delete",void 0,[parent]),model.position=_pos6,!0):(model.announce("delete",void 0,[atom]),model.position=_pos6,!0)}return!1}function deleteRange(model,range2,type){var result=model.getAtoms(range2);if(result.length>0&&result[0].parent){var firstChild=result[0].parent.firstChild;"first"===firstChild.type&&(firstChild=firstChild.rightSibling);var lastChild=result[result.length-1].parent.lastChild,firstSelected=result[0];"first"===firstSelected.type&&(firstSelected=firstSelected.rightSibling);var lastSelected=result[result.length-1];if(firstSelected===firstChild&&lastSelected===lastChild){var parent=result[0].parent;parent.parent&&"prompt"!==parent.type&&(range2=[model.offsetOf(parent.leftSibling),model.offsetOf(parent)])}if(1===result.length&&"placeholder"===result[0].type&&"genfrac"===result[0].parent.type){var genfrac=result[0].parent,branch="below"===result[0].parentBranch?"above":"below",pos=model.offsetOf(genfrac.leftSibling);return model.deferNotifications({content:!0,selection:!0,type:type},(function(){var _a3,_b3,numer=genfrac.removeBranch(branch);if(1!==numer.length||"placeholder"!==numer[0].type){var lastAtom=genfrac.parent.addChildrenAfter(numer,genfrac);null==(_a3=genfrac.parent)||_a3.removeChild(genfrac),model.position=model.offsetOf(lastAtom)}else null==(_b3=genfrac.parent)||_b3.removeChild(genfrac),model.position=Math.max(0,pos)}))}}return model.deferNotifications({content:!0,selection:!0,type:type},(function(){return model.deleteAtoms(range2)}))}function getMode(model,offset){var result,atom=model.at(offset);if(atom){result=atom.mode;for(var ancestor=atom.parent;!result&&ancestor;)ancestor&&(result=ancestor.mode),ancestor=ancestor.parent}return result}function applyStyleToUnstyledAtoms(atom,style){atom&&style&&(isArray(atom)?atom.forEach((function(x){return applyStyleToUnstyledAtoms(x,style)})):"object"===_typeof(atom)&&(atom.style.color||atom.style.backgroundColor||atom.style.fontFamily||atom.style.fontShape||atom.style.fontSeries||atom.style.fontSize||atom.style.variant||atom.style.variantStyle||(atom.applyStyle(style),applyStyleToUnstyledAtoms(atom.body,style),applyStyleToUnstyledAtoms(atom.above,style),applyStyleToUnstyledAtoms(atom.below,style),applyStyleToUnstyledAtoms(atom.subscript,style),applyStyleToUnstyledAtoms(atom.superscript,style))))}function _applyStyle(model,range2,style,options){function everyStyle(property,value){var _step137,_iterator137=_createForOfIteratorHelper(atoms);try{for(_iterator137.s();!(_step137=_iterator137.n()).done;)if(_step137.value.style[property]!==value)return!1}catch(err){_iterator137.e(err)}finally{_iterator137.f()}return!0}if((range2=model.normalizeRange(range2))[0]===range2[1])return!1;var atoms=model.getAtoms(range2,{includeChildren:!0});"toggle"===options.operation&&(style.color&&everyStyle("color",style.color)&&(style.color="none",delete style.verbatimColor),style.backgroundColor&&everyStyle("backgroundColor",style.backgroundColor)&&(style.backgroundColor="none",delete style.verbatimBackgroundColor),style.fontFamily&&everyStyle("fontFamily",style.fontFamily)&&(style.fontFamily="none"),style.fontSeries&&everyStyle("fontSeries",style.fontSeries)&&(style.fontSeries="auto"),style.fontShape&&everyStyle("fontShape",style.fontShape)&&(style.fontShape="auto"),style.fontSize&&everyStyle("fontSize",style.fontSize)&&(style.fontSize=5));var _step138,_iterator138=_createForOfIteratorHelper(atoms);try{for(_iterator138.s();!(_step138=_iterator138.n()).done;)_step138.value.applyStyle(style)}catch(err){_iterator138.e(err)}finally{_iterator138.f()}return!0}defineEnvironment(["math","displaymath"],makeEnvironment),defineEnvironment("center",makeEnvironment),defineTabularEnvironment("array","{columns:colspec}",(function(name,array,rowGaps,args){return new ArrayAtom(name,defaultContent(array),rowGaps,{columns:args[0],mathstyleName:"textstyle"})})),defineTabularEnvironment(["equation","equation*","subequations"],"",(function(name,array,rowGaps){return new ArrayAtom(name,defaultContent(array),rowGaps,{columns:[{align:"c"}]})})),defineTabularEnvironment(["multline","multline*"],"",makeEnvironment),defineTabularEnvironment(["align","align*","aligned","eqnarray"],"",makeEnvironment),defineTabularEnvironment("split","",makeEnvironment),defineTabularEnvironment(["gather","gathered"],"",makeEnvironment),defineTabularEnvironment(["matrix","pmatrix","bmatrix","Bmatrix","vmatrix","Vmatrix","matrix*","pmatrix*","bmatrix*","Bmatrix*","vmatrix*","Vmatrix*"],"[columns:colspec]",makeEnvironment),defineTabularEnvironment(["smallmatrix","smallmatrix*"],"[columns:colspec]",makeEnvironment),defineTabularEnvironment(["cases","dcases","rcases"],"",makeEnvironment),register2({addRowAfter:addRowAfter,addColumnAfter:addColumnAfter,addRowBefore:function(model){return!!contentWillChange(model,{inputType:"insertText"})&&(addCell(model,"before row"),contentDidChange(model,{inputType:"insertText"}),!0)},addColumnBefore:function(model){return!!contentWillChange(model,{inputType:"insertText"})&&(addCell(model,"before column"),contentDidChange(model,{inputType:"insertText"}),!0)},removeRow:function(model){return!!contentWillChange(model,{inputType:"deleteContent"})&&(removeCell(model,"row"),contentDidChange(model,{inputType:"deleteContent"}),!0)},removeColumn:function(model){return!!contentWillChange(model,{inputType:"deleteContent"})&&(removeCell(model,"column"),contentDidChange(model,{inputType:"deleteContent"}),!0)},setEnvironment:function(model,environment){if(!contentWillChange(model,{}))return!1;model.mathfield.snapshot();var leftDelim=".",rightDelim=".";switch(environment){case"pmatrix":case"pmatrix*":leftDelim="(",rightDelim=")";break;case"bmatrix":case"bmatrix*":leftDelim="[",rightDelim="]";break;case"Bmatrix":case"Bmatrix*":leftDelim="\\lbrace",rightDelim="\\rbrace";break;case"vmatrix":case"vmatrix*":leftDelim="\\vert",rightDelim="\\vert";break;case"Vmatrix":case"Vmatrix*":leftDelim="\\Vert",rightDelim="\\Vert";break;case"matrix":case"matrix*":leftDelim=".",rightDelim=".";break;case"cases":case"dcases":leftDelim="\\lbrace";break;case"rcases":rightDelim="\\rbrace"}var arrayAtom=model.parentEnvironment;return arrayAtom.environmentName=environment,arrayAtom.leftDelim=leftDelim,arrayAtom.rightDelim=rightDelim,contentDidChange(model,{}),!0}},{target:"model",canUndo:!0,changeContent:!0,changeSelection:!0});var PRINTABLE_KEYCODE=new Set(["Backquote","Digit0","Digit1","Digit2","Digit3","Digit4","Digit5","Digit6","Digit7","Digit8","Digit9","Minus","Equal","IntlYen","KeyQ","KeyW","KeyE","KeyR","KeyT","KeyY","KeyU","KeyI","KeyO","KeyP","BracketLeft","BracketRight","Backslash","KeyA","KeyS","KeyD","KeyF","KeyG","KeyH","KeyJ","KeyK","KeyL","Semicolon","Quote","IntlBackslash","KeyZ","KeyX","KeyC","KeyV","KeyB","KeyN","KeyM","Comma","Period","Slash","IntlRo","Space","Numpad0","Numpad1","Numpad2","Numpad3","Numpad4","Numpad5","Numpad6","Numpad7","Numpad8","Numpad9","NumpadAdd","NumpadComma","NumpadDecimal","NumpadDivide","NumpadEqual","NumpadHash","NumpadMultiply","NumpadParenLeft","NumpadParenRight","NumpadStar","NumpadSubstract"]);function mightProducePrintableCharacter(evt){return!evt.ctrlKey&&!evt.metaKey&&!["Dead","Process"].includes(evt.key)&&(""===evt.code||PRINTABLE_KEYCODE.has(evt.code))}function keyboardEventToString(evt){var modifiers=[];return(evt=function(evt){if(evt.code)return evt;for(var mapping=Object.entries(getActiveKeyboardLayout().mapping),altKey=!1,shiftKey=!1,code="",index=0;index<4;index++){var _step89,_iterator89=_createForOfIteratorHelper(mapping);try{for(_iterator89.s();!(_step89=_iterator89.n()).done;){var _step89$value=_slicedToArray(_step89.value,2),key=_step89$value[0];if(_step89$value[1][index]===evt.key){code=key,3===index?(altKey=!0,shiftKey=!0):2===index?altKey=!0:1===index&&(shiftKey=!0);break}}}catch(err){_iterator89.e(err)}finally{_iterator89.f()}if(code)break}return new KeyboardEvent(evt.type,__spreadProps(__spreadValues({},evt),{altKey:altKey,shiftKey:shiftKey,code:code}))}(evt)).ctrlKey&&modifiers.push("ctrl"),evt.metaKey&&modifiers.push("meta"),evt.altKey&&modifiers.push("alt"),evt.shiftKey&&modifiers.push("shift"),0===modifiers.length?"[".concat(evt.code,"]"):(modifiers.push("[".concat(evt.code,"]")),modifiers.join("+"))}function delegateKeyboardEvents(keyboardSink,element,delegate){var keydownEvent=null,keypressEvent=null,compositionInProgress=!1,focusInProgress=!1,blurInProgress=!1,controller=new AbortController,signal=controller.signal;return keyboardSink.addEventListener("keydown",(function(event){compositionInProgress||"Process"===event.key||"CapsLock"===event.code||/(Control|Meta|Alt|Shift)(Left|Right)/.test(event.code)?keydownEvent=null:(keydownEvent=event,keypressEvent=null,delegate.onKeystroke(keyboardEventToString(event),event)?keyboardSink.textContent="":keydownEvent=null)}),{capture:!0,signal:signal}),keyboardSink.addEventListener("keypress",(function(event){compositionInProgress||(keydownEvent&&keypressEvent&&delegate.onKeystroke(keyboardEventToString(keydownEvent),keydownEvent),keypressEvent=event)}),{capture:!0,signal:signal}),keyboardSink.addEventListener("compositionstart",(function(event){keyboardSink.textContent="",compositionInProgress=!0,delegate.onCompositionStart(event.data)}),{capture:!0,signal:signal}),keyboardSink.addEventListener("compositionupdate",(function(ev){compositionInProgress&&delegate.onCompositionUpdate(ev.data)}),{capture:!0,signal:signal}),keyboardSink.addEventListener("compositionend",(function(ev){keyboardSink.textContent="",compositionInProgress&&(compositionInProgress=!1,delegate.onCompositionEnd(ev.data))}),{capture:!0,signal:signal}),keyboardSink.addEventListener("beforeinput",(function(ev){return ev.stopImmediatePropagation()}),{signal:signal}),keyboardSink.addEventListener("input",(function(ev){var _a3;if(!compositionInProgress&&(keyboardSink.textContent="","insertCompositionText"!==ev.inputType)){if("insertFromPaste"===ev.inputType)return ev.preventDefault(),void ev.stopPropagation();delegate.onInput(null!=(_a3=ev.data)?_a3:""),ev.preventDefault(),ev.stopPropagation()}}),{signal:signal}),keyboardSink.addEventListener("paste",(function(event){keyboardSink.focus({preventScroll:!0}),keyboardSink.textContent="",delegate.onPaste(event)||event.preventDefault(),event.stopImmediatePropagation()}),{signal:signal}),keyboardSink.addEventListener("cut",(function(ev){return delegate.onCut(ev)}),{capture:!0,signal:signal}),keyboardSink.addEventListener("copy",(function(ev){return delegate.onCopy(ev)}),{capture:!0,signal:signal}),keyboardSink.addEventListener("blur",(function(event){var _a3,_b3,_c2;if((null==(_b3=null==(_a3=event.relatedTarget)?void 0:_a3._mathfield)?void 0:_b3.element)===element)return keyboardSink.focus({preventScroll:!0}),event.preventDefault(),void event.stopPropagation();var scrimState=null==(_c2=Scrim.scrim)?void 0:_c2.state;return"open"===scrimState||"opening"===scrimState||event.relatedTarget===event.target.getRootNode().host?(event.preventDefault(),void event.stopPropagation()):void(blurInProgress||focusInProgress||(blurInProgress=!0,keydownEvent=null,keypressEvent=null,delegate.onBlur(),blurInProgress=!1))}),{capture:!0,signal:signal}),keyboardSink.addEventListener("focus",(function(_evt){blurInProgress||focusInProgress||(focusInProgress=!0,delegate.onFocus(),focusInProgress=!1)}),{capture:!0,signal:signal}),{dispose:function(){return controller.abort()},cancelComposition:function(){compositionInProgress&&(keyboardSink.blur(),requestAnimationFrame((function(){return keyboardSink.focus({preventScroll:!0})})))},blur:function(){"function"==typeof keyboardSink.blur&&keyboardSink.blur()},focus:function(){focusInProgress||"function"!=typeof keyboardSink.focus||keyboardSink.focus({preventScroll:!0})},hasFocus:function(){return function(){for(var _a3,a=document.activeElement;null==(_a3=null==a?void 0:a.shadowRoot)?void 0:_a3.activeElement;)a=a.shadowRoot.activeElement;return a}()===keyboardSink},setAriaLabel:function(value){return keyboardSink.setAttribute("aria-label",value)},setValue:function(value){var _a3;keyboardSink.textContent=value,keyboardSink.style.left="-1000px",null==(_a3=window.getSelection())||_a3.selectAllChildren(keyboardSink)},moveTo:function(x,y){keyboardSink.style.top="".concat(y,"px"),keyboardSink.style.left="".concat(x,"px")}}}function keyboardEventToChar(evt){var _a3,result;return evt&&mightProducePrintableCharacter(evt)?("Unidentified"===evt.key&&evt.target&&(result=evt.target.value),result=null!=(_a3=null!=result?result:evt.key)?_a3:evt.code,/^(Dead|Return|Enter|Tab|Escape|Delete|PageUp|PageDown|Home|End|Help|ArrowLeft|ArrowRight|ArrowUp|ArrowDown)$/.test(result)&&(result=""),result):""}var UndoManager=function(){function _UndoManager(model){_classCallCheck(this,_UndoManager),this.recording=!1,this.model=model,this.reset()}return _createClass(_UndoManager,[{key:"reset",value:function(){this.stack=[],this.index=-1,this.lastOp=""}},{key:"startRecording",value:function(){this.recording=!0}},{key:"stopRecording",value:function(){this.recording=!1}},{key:"canUndo",value:function(){return this.index-1>=0}},{key:"canRedo",value:function(){return this.stack.length-1>this.index}},{key:"stopCoalescing",value:function(selection){selection&&this.index>=0&&(this.stack[this.index].selection=selection),this.lastOp=""}},{key:"undo",value:function(){return!!this.canUndo()&&(this.model.setState(this.stack[this.index-1],{silenceNotifications:!1,type:"undo"}),this.index-=1,this.lastOp="",!0)}},{key:"redo",value:function(){return!!this.canRedo()&&(this.index+=1,this.model.setState(this.stack[this.index],{silenceNotifications:!1,type:"redo"}),this.lastOp="",!0)}},{key:"pop",value:function(){this.canUndo()&&(this.stack.splice(this.index,this.stack.length-this.index),this.index-=1)}},{key:"snapshot",value:function(op){return!!this.recording&&(op&&op===this.lastOp&&this.pop(),this.stack.splice(this.index+1,this.stack.length-this.index-1),this.stack.push(this.model.getState()),this.index+=1,this.stack.length>_UndoManager.maximumDepth&&(this.stack.shift(),this.index-=1),this.lastOp=null!=op?op:"",!0)}}]),_UndoManager}();function _moveAfterParent(model){var previousPosition=model.position,parent=model.at(previousPosition).parent;return(null==parent?void 0:parent.parent)?(model.position=model.offsetOf(parent),model.mathfield.stopCoalescingUndo(),model.announce("move",previousPosition),!0):(model.announce("plonk"),!1)}function _moveToSuperscript(model){var _a3;if(model.collapseSelection(),function(model){for(var result=0,atom=model.at(model.position),wasSuperscript=!1;atom;)atom.hasEmptyBranch("superscript")&&atom.hasEmptyBranch("subscript")||(result+=1),atom.hasEmptyBranch("superscript")?atom.hasEmptyBranch("subscript")||(wasSuperscript=!1):wasSuperscript=!0,atom=atom.parent;return wasSuperscript?result:0}(model)>=model.mathfield.options.scriptDepth[1])return model.announce("plonk"),!1;var target=model.at(model.position);return void 0===target.subsupPlacement&&("subsup"!==(null==(_a3=target.rightSibling)?void 0:_a3.type)&&target.parent.addChildAfter(new SubsupAtom({style:target.computedStyle}),target),target=target.rightSibling),target.createBranch("superscript"),model.setSelection(model.getSiblingsRange(model.offsetOf(target.superscript[0]))),!0}function _moveToSubscript(model){var _a3;if(model.collapseSelection(),function(model){for(var result=0,atom=model.at(model.position),wasSubscript=!1;atom;)atom.hasEmptyBranch("superscript")&&atom.hasEmptyBranch("subscript")||(result+=1),atom.hasEmptyBranch("superscript")?atom.hasEmptyBranch("subscript")||(wasSubscript=!0):wasSubscript=!1,atom=atom.parent;return wasSubscript?result:0}(model)>=model.mathfield.options.scriptDepth[0])return model.announce("plonk"),!1;var target=model.at(model.position);return void 0===target.subsupPlacement&&("subsup"!==(null==(_a3=model.at(model.position+1))?void 0:_a3.type)&&target.parent.addChildAfter(new SubsupAtom({style:model.at(model.position).computedStyle}),target),target=model.at(model.position+1)),target.createBranch("subscript"),model.setSelection(model.getSiblingsRange(model.offsetOf(target.subscript[0]))),!0}function getTabbableElements(){function isNodeMatchingSelectorTabbable(element){return!((node=element).disabled||"hidden"===node.type&&"INPUT"===node.tagName.toUpperCase()||function(element){if(!isBrowser()||element===document.activeElement||element.contains(document.activeElement))return!1;if("hidden"===getComputedStyle(element).visibility)return!0;var bounds=element.getBoundingClientRect();if(0===bounds.width||0===bounds.height)return!0;for(;element;){if("none"===getComputedStyle(element).display)return!0;element=element.parentElement}return!1}(node)||function(node){return"INPUT"===node.tagName.toUpperCase()&&"radio"===node.type&&!function(node){var _a3;if(!node.name)return!0;var checked=function(nodes,form){var _step139,_iterator139=_createForOfIteratorHelper(nodes);try{for(_iterator139.s();!(_step139=_iterator139.n()).done;){var node=_step139.value;if(node.checked&&node.form===form)return node}}catch(err){_iterator139.e(err)}finally{_iterator139.f()}return null}((null!=(_a3=node.form)?_a3:node.ownerDocument).querySelectorAll('input[type="radio"][name="'+node.name+'"]'),node.form);return!checked||checked===node}(node)}(element)||getTabindex(element)<0);var node}function getTabindex(node){var _a3,tabindexAttr=Number.parseInt(null!=(_a3=node.getAttribute("tabindex"))?_a3:"NaN",10);return Number.isNaN(tabindexAttr)?"true"===node.contentEditable?0:"AUDIO"!==node.nodeName&&"VIDEO"!==node.nodeName||null!==node.getAttribute("tabindex")?node.tabIndex:0:tabindexAttr}return isBrowser()?(element=document.body,regularTabbables=[],orderedTabbables=[],_toConsumableArray(element.querySelectorAll('input, select, textarea, a[href], button,\n        [tabindex], audio[controls], video[controls],\n        [contenteditable]:not([contenteditable="false"]), details>summary')).filter(isNodeMatchingSelectorTabbable).forEach((function(candidate,i){var candidateTabindex=getTabindex(candidate);0===candidateTabindex?regularTabbables.push(candidate):orderedTabbables.push({documentOrder:i,tabIndex:candidateTabindex,node:candidate})})),orderedTabbables.sort((function(a,b){return a.tabIndex===b.tabIndex?a.documentOrder-b.documentOrder:a.tabIndex-b.tabIndex})).map((function(a){return a.node})).concat(regularTabbables)):[];var element,regularTabbables,orderedTabbables}function leap(model,dir){var _a3,_b3,origin,callHooks=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],dist="forward"===dir?1:-1;"placeholder"===model.at(model.anchor).type&&move(model,dir);var parentPrompt=model.at(model.anchor).parentPrompt;origin=parentPrompt?"forward"===dir?model.offsetOf(parentPrompt)+1:model.offsetOf(parentPrompt.leftSibling):Math.max(model.position+dist,0);var target=model.findAtom((function(atom){return"placeholder"===atom.type||"prompt"===atom.type||!model.mathfield.readOnly&&atom.treeDepth>2&&atom.isFirstSibling&&atom.isLastSibling}),origin,dir);if(!target||"forward"===dir&&model.offsetOf(target)<origin||"backward"===dir&&model.offsetOf(target)>origin){var handled=!callHooks||!(null==(_b3=null==(_a3=model.mathfield.host)?void 0:_a3.dispatchEvent(new CustomEvent("move-out",{detail:{direction:dir},cancelable:!0,bubbles:!0,composed:!0})))||_b3);if(handled)return model.announce("plonk"),!1;var tabbable=getTabbableElements();if(!document.activeElement||tabbable.length<=1)return model.announce("plonk"),!1;var index=tabbable.indexOf(document.activeElement)+dist;return index<0&&(index=tabbable.length-1),index>=tabbable.length&&(index=0),tabbable[index].focus(),model.mathfield.stopCoalescingUndo(),!0}var previousPosition=model.position;if("prompt"===target.type)model.setSelection(model.offsetOf(target.firstChild),model.offsetOf(target.lastChild));else{var newPosition=model.offsetOf(target);"placeholder"===target.type?model.setSelection(newPosition-1,newPosition):model.position=newPosition}return model.announce("move",previousPosition),model.mathfield.stopCoalescingUndo(),!0}function convertLastAtomsToText(model,count,until){"function"==typeof count&&(until=count,count=1/0),void 0===count&&(count=1/0);for(var i=model.position,done=!1,text="";!done;){var atom=model.at(i);(done=0===count||void 0===atom||"math"!==atom.mode||!(atom.type&&/mord|mpunct/.test(atom.type)||"mop"===atom.type&&/[a-zA-Z]+/.test(atom.value))||!atom.hasEmptyBranch("superscript")||!atom.hasEmptyBranch("subscript")||"function"==typeof until&&!until(atom))||(atom.mode="text",atom.command=atom.value,atom.verbatimLatex=void 0,text+=atom.value),i-=1,count-=1}contentDidChange(model,{data:text,inputType:"insertText"})}function convertLastAtomsToMath(model,count,until){"function"==typeof count&&(until=count,count=1/0),void 0===count&&(count=1/0);for(var i=model.position,done=!1,data=[];!done;){var atom=model.at(i);(done=0===count||!atom||atom.isFirstSibling||"text"!==atom.mode||" "===atom.value||until&&!until(atom))||(data.push(Atom.serialize([atom],{defaultMode:"math"})),atom.mode="math"),i-=1,count-=1}removeIsolatedSpace(model),contentDidChange(model,{data:joinLatex(data),inputType:"insertText"})}function removeIsolatedSpace(model){for(var _a3,i=model.position-1;i>=0&&"math"===(null==(_a3=model.at(i))?void 0:_a3.mode);)i-=1;if(!(i<0)&&"text"===model.at(i).mode&&" "===model.at(i).value&&"math"===model.at(i-1).mode){model.at(i-1).parent.removeChild(model.at(i-1));var save=model.silenceNotifications;model.silenceNotifications=!0,model.position-=1,model.silenceNotifications=save,contentDidChange(model,{inputType:"deleteContent"})}}function createKeystrokeCaption(){var panel=document.getElementById("mathlive-keystroke-caption-panel");return panel||(injectStylesheet("keystroke-caption"),injectStylesheet("core"),getSharedElement("mathlive-keystroke-caption-panel"))}function _onKeystroke(mathfield,keystroke,evt){var _a3,_b3,_c2,_d2,shortcut,model=mathfield.model;if(evt.isTrusted){!function(evt){var _a3,_b3;if(evt&&"Unidentified"!==evt.key&&"Dead"!==evt.key){var _step90,index=evt.shiftKey&&evt.altKey?3:evt.altKey?2:evt.shiftKey?1:0,_iterator90=_createForOfIteratorHelper(gKeyboardLayouts);try{for(_iterator90.s();!(_step90=_iterator90.n()).done;){var layout=_step90.value;(null==(_a3=layout.mapping[evt.code])?void 0:_a3[index])===evt.key?layout.score+=1:(null==(_b3=layout.mapping[evt.code])?void 0:_b3[index])&&(layout.score=0)}}catch(err){_iterator90.e(err)}finally{_iterator90.f()}gKeyboardLayouts.sort((function(a,b){return b.score-a.score}))}}(evt);var activeLayout=getActiveKeyboardLayout();mathfield.keyboardLayout!==activeLayout.id&&(mathfield.keyboardLayout=activeLayout.id,mathfield._keybindings=void 0)}if(clearTimeout(mathfield.inlineShortcutBufferFlushTimer),mathfield.inlineShortcutBufferFlushTimer=0,function(mathfield,keystroke){if(mathfield.isSelectionEditable&&mathfield.keystrokeCaptionVisible){var vb=createKeystrokeCaption(),bounds=mathfield.element.getBoundingClientRect();vb.style.left="".concat(bounds.left,"px"),vb.style.top="".concat(bounds.top-64,"px"),vb.innerHTML=window.MathfieldElement.createHTML("<span>"+(getKeybindingMarkup(keystroke)||keystroke)+"</span>"+vb.innerHTML),vb.style.visibility="visible",setTimeout((function(){vb.childNodes.length>0&&vb.childNodes[vb.childNodes.length-1].remove(),0===vb.childNodes.length&&(vb.style.visibility="hidden")}),3e3)}}(mathfield,keystroke),evt.isTrusted&&evt.defaultPrevented)return mathfield.flushInlineShortcutBuffer(),!1;if(model.mathfield.smartFence){if(insertSmartFence(model,keyboardEventToChar(evt),mathfield.style))return mathfield.flushInlineShortcutBuffer(),mathfield.dirty=!0,mathfield.scrollIntoView(),evt.preventDefault&&evt.preventDefault(),!1}else{var parent2=model.at(model.position).parent;if(parent2 instanceof LeftRightAtom&&"?"===parent2.rightDelim&&model.at(model.position).isLastSibling&&/^[)}\]|]$/.test(keystroke))return mathfield.snapshot(),parent2.isDirty=!0,parent2.rightDelim=keystroke,model.position+=1,selectionDidChange(model),contentDidChange(model,{data:keyboardEventToChar(evt),inputType:"insertText"}),mathfield.snapshot("insert-fence"),mathfield.dirty=!0,mathfield.scrollIntoView(),evt.preventDefault&&evt.preventDefault(),!1;if(!model.selectionIsCollapsed){var fence=keyboardEventToChar(evt);if("("===fence||"{"===fence||"["===fence){var lDelim={"(":"(","{":"\\lbrace","[":"\\lbrack"}[fence],rDelim={"(":")","{":"\\rbrace","[":"\\rbrack"}[fence],_range6=_slicedToArray(range(model.selection),2),start=_range6[0],end=_range6[1];return mathfield.snapshot(),model.position=end,ModeEditor.insert(model,rDelim,{format:"latex"}),model.position=start,ModeEditor.insert(model,lDelim,{format:"latex"}),model.setSelection(start+1,end+1),contentDidChange(model,{data:fence,inputType:"insertText"}),mathfield.snapshot("insert-fence"),mathfield.dirty=!0,mathfield.scrollIntoView(),evt.preventDefault&&evt.preventDefault(),!1}}}var stateIndex,selector="",buffer=mathfield.inlineShortcutBuffer;if(mathfield.isSelectionEditable){if("math"===model.mode)if("[Backspace]"===keystroke)buffer.pop(),mathfield.flushInlineShortcutBuffer({defer:!0});else if(mightProducePrintableCharacter(evt)){var c=keyboardEventToChar(evt),keystrokes=[].concat(_toConsumableArray(null!=(_b3=null==(_a3=buffer[buffer.length-1])?void 0:_a3.keystrokes)?_b3:[]),[c]);buffer.push({state:model.getState(),keystrokes:keystrokes,leftSiblings:getLeftSiblings(mathfield)});for(var i=0,candidate="";!shortcut&&i<keystrokes.length;)stateIndex=buffer.length-(keystrokes.length-i),candidate=keystrokes.slice(i).join(""),!(shortcut=getInlineShortcut(buffer[stateIndex].leftSiblings,candidate,mathfield.options.inlineShortcuts))&&/^[a-zA-Z][a-zA-Z0-9]+?([_\^][a-zA-Z0-9\*\+\-]+?)?$/.test(candidate)&&(shortcut=mathfield.options.onInlineShortcut(mathfield,candidate)),i+=1;mathfield.flushInlineShortcutBuffer({defer:!0})}else mathfield.flushInlineShortcutBuffer();if(mathfield.options.smartMode){var previousMode=model.mode;shortcut?model.mode="math":function(mathfield,keystroke,evt){if(mathfield.smartModeSuppressed)return!1;var model=mathfield.model;if(!model.at(model.position).isLastSibling)return!1;if(!evt||!mightProducePrintableCharacter(evt))return!1;var c=keyboardEventToChar(evt);if(!model.selectionIsCollapsed)return!("text"!==mathfield.model.mode||!/[/_^]/.test(c));var context=function(model){for(var result="",i=model.position,done=!1;!done;){var atom=model.at(i);(done=!(atom&&("text"===atom.mode||"math"===atom.mode&&atom.type&&/mord|mpunct/.test(atom.type))))||(result=atom.value+result),i-=1}return result}(model)+c;if("text"===mathfield.model.mode){if("Esc"===keystroke||/[/\\]/.test(c))return!0;if(/[\^_]/.test(c))return/(^|\s)[a-zA-Z][^_]$/.test(context)&&convertLastAtomsToMath(model,1),!0;var lFence={")":"(","}":"{","]":"["}[c],parent=model.at(model.position).parent;if(lFence&&parent instanceof LeftRightAtom&&parent.leftDelim===lFence)return!0;if(/(^|[^a-zA-Z])(a|I) $/.test(context))return!1;if(/[\$\xA2-\xA5\u0E3F\u20A1\u20A4\u20A7-\u20A9\u20AC\u20B1\u20B9\u20BA]/.test(c))return!0;if(/(^|[^a-zA-Z'’])[a-zA-Z] $/.test(context))return convertLastAtomsToMath(model,1),!1;if(/\D\.[^\d\s]$/.test(context)){convertLastAtomsToMath(model,1);var atom=model.at(model.position);return atom.value="⋅",atom.style.variant="normal",atom.command="\\cdot",atom.verbatimLatex=void 0,contentDidChange(model,{data:"\\cdot",inputType:"insertText"}),!0}if(/(^|\s)[a-zA-Z][^a-zA-Z]$/.test(context))return convertLastAtomsToMath(model,1),!0;if(/\.\d$/.test(context))return convertLastAtomsToMath(model,1),!0;if(/\([\d+\-.]$/.test(context))return convertLastAtomsToMath(model,1),!0;if(/\([a-z][,;]$/.test(context))return convertLastAtomsToMath(model,2),!0;if(/[\d+\-=><*|]$/.test(c))return removeIsolatedSpace(model),!0}else{if("[Space]"===keystroke)return convertLastAtomsToText(model,void 0,(function(a){return/[a-z][:,;.]$/.test(a.value)})),!0;if(/[a-zA-Z]{3,}$/.test(context)&&!/(dxd|abc|xyz|uvw)$/.test(context))return convertLastAtomsToText(model,void 0,(function(a){return/[a-zA-Z]/.test(a.value)})),!0;if(/(^|\W)(if)$/i.test(context))return convertLastAtomsToText(model,1),!0;if(/(\u0393|\u0394|\u0398|\u039B|\u039E|\u03A0|\u03A3|\u03A5|\u03A6|\u03A8|\u03A9|[\u03B1-\u03C9]|\u03D1|\u03D5|\u03D6|\u03F1|\u03F5){3,}$/.test(context)&&!/(αβγ)$/.test(context))return convertLastAtomsToText(model,void 0,(function(a){return/(:|,|;|(?:[\0-\t\x0B\f\x0E-\u2027\u202A-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])|\u0393|\u0394|\u0398|\u039B|\u039E|\u03A0|\u03A3|\u03A5|\u03A6|\u03A8|\u03A9|[\u03B1-\u03C9]|\u03D1|\u03D5|\u03D6|\u03F1|\u03F5)/.test(a.value)})),!0;if("?"===c)return!0;if("."===c&&!/[\d-+]\.$/.test(context))return!0}return!1}(mathfield,keystroke,evt)&&(model.mode={math:"text",text:"math"}[model.mode],selector=""),model.mode!==previousMode&&((null==(_c2=mathfield.host)?void 0:_c2.dispatchEvent(new Event("mode-change",{bubbles:!0,composed:!0,cancelable:!0})))||(model.mode=previousMode))}}if(!shortcut){if(selector||(selector=function(keybindings,mode,inKeystroke){if(0===keybindings.length)return"";for(var keystroke=keystrokeModifiersToString(keystrokeModifiersFromString(inKeystroke)),i=keybindings.length-1;i>=0;i--)if(keybindings[i].key===keystroke&&(!keybindings[i].ifMode||keybindings[i].ifMode===mode))return keybindings[i].command;return""}(mathfield.keybindings,model.mode,keystroke)),!selector&&("[Enter]"===keystroke||"[Return]"===keystroke)){var result=!1;return contentWillChange(model,{inputType:"insertLineBreak"})&&(mathfield.host&&(result=!mathfield.host.dispatchEvent(new Event("change",{bubbles:!0,composed:!0}))),result||evt.preventDefault&&(evt.preventDefault(),evt.stopPropagation()),contentDidChange(model,{inputType:"insertLineBreak"})),result}if((!selector||"[Space]"===keystroke)&&"math"===model.mode){if("[Space]"===keystroke){if(mathfield.adoptStyle="none",mathfield.flushInlineShortcutBuffer(),mathfield.options.mathModeSpace)return ModeEditor.insert(model,mathfield.options.mathModeSpace,{format:"latex",mode:"math"}),mathfield.snapshot("insert-space"),selector="",mathfield.dirty=!0,mathfield.scrollIntoView(),evt.preventDefault&&(evt.preventDefault(),evt.stopPropagation()),!1;var nextSibling=model.at(model.position+1),previousSibling=model.at(model.position-1);if("text"===(null==nextSibling?void 0:nextSibling.mode)||"text"===(null==previousSibling?void 0:previousSibling.mode))return ModeEditor.insert(model," ",{mode:"text"}),mathfield.snapshot("insert-space"),mathfield.dirty=!0,mathfield.scrollIntoView(),!1}(null==(_d2=model.at(model.position))?void 0:_d2.isDigit())&&","===window.MathfieldElement.decimalSeparator&&","===keyboardEventToChar(evt)&&(selector="insertDecimalSeparator")}}if(!shortcut&&!selector)return!0;var child=model.at(Math.max(model.position,model.anchor)),parent=child.parent;if("moveAfterParent"===selector&&"leftright"===(null==parent?void 0:parent.type)&&child.isLastSibling&&mathfield.options.smartFence&&insertSmartFence(model,".",mathfield.style)&&(selector="",requestUpdate(mathfield)),mathfield.keyboardDelegate.cancelComposition(),selector)mathfield.executeCommand(selector);else if(shortcut){var style=__spreadValues(__spreadValues({},model.at(model.position).computedStyle),mathfield.style);model.setState(buffer[stateIndex].state);var _step140,_iterator140=_createForOfIteratorHelper(buffer[buffer.length-1].keystrokes);try{for(_iterator140.s();!(_step140=_iterator140.n()).done;){var _c4=_step140.value;ModeEditor.insert(model,_c4,{silenceNotifications:!0,style:style})}}catch(err){_iterator140.e(err)}finally{_iterator140.f()}mathfield.snapshot("insert-shortcut"),model.setState(buffer[stateIndex].state),model.deferNotifications({content:!0,selection:!0,data:shortcut,type:"insertText"},(function(){return ModeEditor.insert(model,shortcut,{format:"latex",style:style}),removeIsolatedSpace(mathfield.model),shortcut.endsWith(" ")&&(model.mode="text",ModeEditor.insert(model," ",{style:style,mode:"text"})),mathfield.snapshot(),model.selectionIsCollapsed||mathfield.flushInlineShortcutBuffer(),!0})),mathfield.dirty=!0,model.announce("replacement")}return mathfield.scrollIntoView(),evt.preventDefault&&evt.preventDefault(),!1}function _onInput(mathfield,text,options){var model=mathfield.model;if(mathfield.isSelectionEditable){null!=options||(options={}),options.focus&&mathfield.focus(),options.feedback&&window.MathfieldElement.playSound("keypress"),"string"==typeof options.mode&&(mathfield.switchMode(options.mode),mathfield.snapshot());var graphemes=splitGraphemes(text),keyboard=window.mathVirtualKeyboard;if((null==keyboard?void 0:keyboard.visible)&&keyboard.isShifted&&(graphemes="string"==typeof graphemes?graphemes.toUpperCase():graphemes.map((function(c){return c.toUpperCase()}))),options.simulateKeystroke){var _step141,handled=!0,_iterator141=_createForOfIteratorHelper(graphemes);try{for(_iterator141.s();!(_step141=_iterator141.n()).done;){var c=_step141.value;_onKeystroke(mathfield,c,new KeyboardEvent("keypress",{key:c}))&&(handled=!1)}}catch(err){_iterator141.e(err)}finally{_iterator141.f()}if(handled)return}var atom=model.at(model.position),style=__spreadValues(__spreadValues({},atom.computedStyle),mathfield.style);if(model.selectionIsCollapsed||(model.deleteAtoms(range(model.selection)),mathfield.snapshot("delete")),"latex"===model.mode)model.deferNotifications({content:!0,selection:!0,data:text,type:"insertText"},(function(){removeSuggestion(mathfield);var _step142,_iterator142=_createForOfIteratorHelper(graphemes);try{for(_iterator142.s();!(_step142=_iterator142.n()).done;){var _c5=_step142.value;ModeEditor.insert(model,_c5)}}catch(err){_iterator142.e(err)}finally{_iterator142.f()}mathfield.snapshot("insert-latex"),updateAutocomplete(mathfield)}));else if("text"===model.mode){var _step143,_iterator143=_createForOfIteratorHelper(graphemes);try{for(_iterator143.s();!(_step143=_iterator143.n()).done;){var _c6=_step143.value;ModeEditor.insert(model,_c6,{style:style})}}catch(err){_iterator143.e(err)}finally{_iterator143.f()}mathfield.snapshot("insert-text")}else if("math"===model.mode){var _step144,_iterator144=_createForOfIteratorHelper(graphemes);try{for(_iterator144.s();!(_step144=_iterator144.n()).done;){var _c7=_step144.value;insertMathModeChar(mathfield,_c7,style,atom)}}catch(err){_iterator144.e(err)}finally{_iterator144.f()}}mathfield.dirty=!0,mathfield.scrollIntoView()}else model.announce("plonk")}function getLeftSiblings(mf){for(var model=mf.model,result=[],atom=model.at(Math.min(model.position,model.anchor));"first"!==atom.type;)result.push(atom),atom=atom.leftSibling;return result}function insertMathModeChar(mathfield,c,style,atom){var _a3,model=mathfield.model,selector={"^":"moveToSuperscript",_:"moveToSubscript"," ":"moveAfterParent"}[c];if(" "===c&&mathfield.options.mathModeSpace&&(selector=["insert",mathfield.options.mathModeSpace]),selector)mathfield.executeCommand(selector);else{if(/\d/.test(c)&&mathfield.options.smartSuperscript&&"superscript"===atom.parentBranch&&"mop"!==(null==(_a3=atom.parent)?void 0:_a3.type)&&atom.hasNoSiblings)return function(model){model.selectionIsCollapsed||(model.deleteAtoms(range(model.selection)),model.mathfield.snapshot("delete"))}(model),ModeEditor.insert(model,c,{style:style}),mathfield.snapshot(),_moveAfterParent(model),void mathfield.snapshot();if("none"!==mathfield.adoptStyle){var sibling="left"===mathfield.adoptStyle?atom:atom.parent?atom.rightSibling:null;"mord"===(null==sibling?void 0:sibling.type)&&/[a-zA-Z0-9]/.test(sibling.value)&&/[a-zA-Z0-9]/.test(c)&&(style=__spreadValues({},style),sibling.style.variant&&(style.variant=sibling.style.variant),sibling.style.variantStyle&&(style.variantStyle=sibling.style.variantStyle))}ModeEditor.insert(model,c,{style:style}),mathfield.snapshot("insert-".concat(model.at(model.position).type))}}function insertSmartFence(model,key,style){if(!key)return!1;if("math"!==model.mode)return!1;var atom=model.at(model.position),parent=atom.parent,fence={"(":"(",")":")","{":"\\lbrace","}":"\\rbrace","[":"\\lbrack","]":"\\rbrack","|":"|"}[key];if(!fence)return!1;var lDelim=LEFT_DELIM[fence],rDelim=RIGHT_DELIM[fence];if(!model.selectionIsCollapsed){model.mathfield.snapshot();var _range8=_slicedToArray(range(model.selection),2),start=_range8[0],end=_range8[1],body=model.extractAtoms([start,end]),atom2=parent.addChildrenAfter([new LeftRightAtom("left...right",body,{leftDelim:fence,rightDelim:rDelim})],model.at(start));return model.setSelection(model.offsetOf(atom2.firstChild),model.offsetOf(atom2.lastChild)),model.mathfield.snapshot("insert-fence"),contentDidChange(model,{data:fence,inputType:"insertText"}),!0}if("|"===fence){var delims=parent instanceof LeftRightAtom?parent.leftDelim+parent.rightDelim:"";if("\\lbrace\\rbrace"===delims||"\\{\\}"===delims||"\\lbrace?"===delims)return model.mathfield.snapshot(),ModeEditor.insert(model,"\\,\\middle\\vert\\,",{format:"latex",style:style}),model.mathfield.snapshot("insert-fence"),contentDidChange(model,{data:fence,inputType:"insertText"}),!0}if(rDelim){if(parent instanceof LeftRightAtom&&parent.firstChild===atom&&("?"===parent.leftDelim||"."===parent.leftDelim))return parent.leftDelim=fence,parent.isDirty=!0,model.mathfield.snapshot(),contentDidChange(model,{data:fence,inputType:"insertText"}),model.mathfield.snapshot("insert-fence"),!0;if(!(parent instanceof LeftRightAtom)){for(var sibling=atom;sibling&&("mclose"!==sibling.type||sibling.value!==rDelim);)sibling=sibling.rightSibling;if(sibling){model.mathfield.snapshot();var _body=model.extractAtoms([model.offsetOf(atom),model.offsetOf(sibling)]);return _body.pop(),parent.addChildrenAfter([new LeftRightAtom("left...right",_body,{leftDelim:fence,rightDelim:rDelim})],atom),model.position=model.offsetOf(parent.firstChild)+1,contentDidChange(model,{data:fence,inputType:"insertText"}),model.mathfield.snapshot("insert-fence"),!0}}var i,lastSibling=model.offsetOf(atom.lastSibling);for(i=model.position;i<=lastSibling;i++){var _atom8=model.at(i);if(_atom8 instanceof LeftRightAtom&&("?"===_atom8.leftDelim||"."===_atom8.leftDelim)&&isValidOpen(fence,_atom8.rightDelim))break}var match=model.at(i);if(i<=lastSibling&&match instanceof LeftRightAtom){match.leftDelim=fence,model.mathfield.snapshot();var extractedAtoms=model.extractAtoms([model.position,i-1]);return extractedAtoms=extractedAtoms.filter((function(value){return"first"!==value.type})),match.addChildren(extractedAtoms,match.parentBranch),model.position+=1,contentDidChange(model,{data:fence,inputType:"insertText"}),model.mathfield.snapshot("insert-fence"),!0}if(parent instanceof LeftRightAtom&&("?"===parent.leftDelim||"."===parent.leftDelim)&&isValidOpen(fence,parent.rightDelim)){parent.isDirty=!0,parent.leftDelim=fence,model.mathfield.snapshot();var _step145,_iterator145=_createForOfIteratorHelper(model.extractAtoms([model.offsetOf(atom.firstSibling),model.position]));try{for(_iterator145.s();!(_step145=_iterator145.n()).done;){var extractedAtom=_step145.value;parent.parent.addChildBefore(extractedAtom,parent)}}catch(err){_iterator145.e(err)}finally{_iterator145.f()}return contentDidChange(model,{data:fence,inputType:"insertText"}),model.mathfield.snapshot("insert-fence"),!0}if(!(parent instanceof LeftRightAtom&&"|"===parent.leftDelim)){if(model.mathfield.snapshot(),ModeEditor.insert(model,"\\left".concat(fence,"\\right?"),{format:"latex",style:style}),"first"!==atom.lastSibling.type){var lastSiblingOffset=model.offsetOf(atom.lastSibling),content=model.extractAtoms([model.position,lastSiblingOffset]);model.at(model.position).body=content,model.position-=1}return model.mathfield.snapshot("insert-fence"),!0}}if(lDelim){for(var _sibling=atom;_sibling;){if("mopen"===_sibling.type&&_sibling.value===lDelim){model.mathfield.snapshot();var insertAfter=_sibling.leftSibling,_body2=model.extractAtoms([model.offsetOf(_sibling.leftSibling),model.offsetOf(atom)]);_body2.shift();var result=new LeftRightAtom("left...right",_body2,{leftDelim:lDelim,rightDelim:fence});return parent.addChildrenAfter([result],insertAfter),model.position=model.offsetOf(result),contentDidChange(model,{data:fence,inputType:"insertText"}),model.mathfield.snapshot("insert-fence"),!0}_sibling=_sibling.leftSibling}if(parent instanceof LeftRightAtom&&atom.isLastSibling&&isValidClose(parent.leftDelim,fence))return model.mathfield.snapshot(),parent.isDirty=!0,parent.rightDelim=fence,model.position+=1,contentDidChange(model,{data:fence,inputType:"insertText"}),model.mathfield.snapshot("insert-fence"),!0;var _i28,firstSibling=model.offsetOf(atom.firstSibling);for(_i28=model.position;_i28>=firstSibling;_i28--){var _atom9=model.at(_i28);if(_atom9 instanceof LeftRightAtom&&("?"===_atom9.rightDelim||"."===_atom9.rightDelim)&&isValidClose(_atom9.leftDelim,fence))break}var _match2=model.at(_i28);if(_i28>=firstSibling&&_match2 instanceof LeftRightAtom)return model.mathfield.snapshot(),_match2.rightDelim=fence,_match2.addChildren(model.extractAtoms([_i28,model.position]),_match2.parentBranch),contentDidChange(model,{data:fence,inputType:"insertText"}),model.mathfield.snapshot("insert-fence"),!0;if(parent instanceof LeftRightAtom&&("?"===parent.rightDelim||"."===parent.rightDelim)&&isValidClose(parent.leftDelim,fence))return model.mathfield.snapshot(),parent.isDirty=!0,parent.rightDelim=fence,parent.parent.addChildren(model.extractAtoms([model.position,model.offsetOf(atom.lastSibling)]),parent.parentBranch),model.position=model.offsetOf(parent),contentDidChange(model,{data:fence,inputType:"insertText"}),model.mathfield.snapshot("insert-fence"),!0;var grandparent=parent.parent;return!(!(grandparent instanceof LeftRightAtom)||"?"!==grandparent.rightDelim&&"."!==grandparent.rightDelim||!model.at(model.position).isLastSibling)&&(model.position=model.offsetOf(grandparent),insertSmartFence(model,fence,style))}return!1}function isValidClose(open,close){return!open||(["(","{","[","\\lbrace","\\lparen","\\{","\\lbrack"].includes(open)?[")","}","]","\\rbrace","\\rparen","\\}","\\rbrack"].includes(close):RIGHT_DELIM[open]===close)}function isValidOpen(open,close){return!close||([")","}","]","\\rbrace","\\rparen","\\}","\\rbrack"].includes(close)?["(","{","[","\\lbrace","\\lparen","\\{","\\lbrack"].includes(open):LEFT_DELIM[close]===open)}UndoManager.maximumDepth=1e3,register2({moveToOpposite:function(model){var cursor=model.at(model.position),parent=cursor.parent;if(!parent)return model.announce("plonk"),!1;var oppositeRelation,relation=cursor.parentBranch;if("string"==typeof relation&&(oppositeRelation={superscript:"subscript",subscript:"superscript",above:"below",below:"above"}[relation]),!oppositeRelation){var result2=cursor.subsupPlacement?_moveToSubscript(model):_moveToSuperscript(model);return model.mathfield.stopCoalescingUndo(),result2}parent.branch(oppositeRelation)||parent.createBranch(oppositeRelation);var result=model.setSelection(model.getBranchRange(model.offsetOf(parent),oppositeRelation));return model.mathfield.stopCoalescingUndo(),result},moveBeforeParent:function(model){var parent=model.at(model.position).parent;return parent?(model.position=model.offsetOf(parent),model.mathfield.stopCoalescingUndo(),!0):(model.announce("plonk"),!1)},moveAfterParent:function(model){return _moveAfterParent(model)},moveToNextChar:function(model){return move(model,"forward")},moveToPreviousChar:function(model){return move(model,"backward")},moveUp:function(model){return move(model,"upward")},moveDown:function(model){return move(model,"downward")},moveToNextWord:function(model){return skip(model,"forward")},moveToPreviousWord:function(model){return skip(model,"backward")},moveToGroupStart:function(model){var pos=model.offsetOf(model.at(model.position).firstSibling);return pos===model.position?(model.announce("plonk"),!1):(model.position=pos,model.mathfield.stopCoalescingUndo(),!0)},moveToGroupEnd:function(model){var pos=model.offsetOf(model.at(model.position).lastSibling);return pos===model.position?(model.announce("plonk"),!1):(model.position=pos,model.mathfield.stopCoalescingUndo(),!0)},moveToNextGroup:function(model){var atom=model.at(model.position),mode=atom.mode;if("text"===mode){for(;atom&&"text"===atom.mode;)atom=atom.rightSibling;return atom?(model.position=model.offsetOf(atom.leftSibling),!0):leap(model,"forward")}if("math"===mode){var parent=atom.parent;if(parent){if("superscript"===atom.parentBranch&&parent.subscript)return model.position=model.offsetOf(parent.subscript[0]),!0;if("above"===atom.parentBranch&&parent.below)return model.position=model.offsetOf(parent.below[0]),!0;if("subscript"===atom.parentBranch||"below"===atom.parentBranch)return model.position=model.offsetOf(parent),!0}}return leap(model,"forward")},moveToPreviousGroup:function(model){var atom=model.at(model.position),mode=atom.mode;if("text"===mode){for(;atom&&"text"===atom.mode;)atom=atom.leftSibling;return atom?(model.position=model.offsetOf(atom),!0):leap(model,"backward")}if("math"===mode){var parent=atom.parent;if(parent){if("subscript"===atom.parentBranch&&parent.superscript)return model.position=model.offsetOf(parent.superscript[0]),!0;if("below"===atom.parentBranch&&parent.above)return model.position=model.offsetOf(parent.above[0]),!0;if("superscript"===atom.parentBranch||"above"===atom.parentBranch)return model.position=model.offsetOf(parent.leftSibling),!0}}return leap(model,"backward")},moveToMathfieldStart:function(model){return 0===model.position?(model.announce("plonk"),!1):(model.position=0,model.mathfield.stopCoalescingUndo(),!0)},moveToMathfieldEnd:function(model){return model.position===model.lastOffset?(model.announce("plonk"),!1):(model.position=model.lastOffset,model.mathfield.stopCoalescingUndo(),!0)},moveToSuperscript:function(model){return _moveToSuperscript(model)},moveToSubscript:function(model){return _moveToSubscript(model)}},{target:"model",changeSelection:!0}),register2({moveToNextPlaceholder:function(model){return leap(model,"forward")},moveToPreviousPlaceholder:function(model){return leap(model,"backward")}},{target:"model",changeSelection:!0,audioFeedback:"return"});var ACCENTS={acute:714,grave:715,dot:729,ddot:168,mathring:730,tilde:126,bar:713,breve:728,check:711,hat:94,vec:8407};defineFunction(Object.keys(ACCENTS),"{body:auto}",{createAtom:function(options){return new AccentAtom(__spreadProps(__spreadValues({},options),{body:argAtoms(options.args[0]),accentChar:ACCENTS[options.command.slice(1)]}))}}),defineFunction(["widehat","widecheck","widetilde"],"{body:auto}",{createAtom:function(options){var baseString=parseArgAsString(argAtoms(options.args[0]));return new AccentAtom(__spreadProps(__spreadValues({},options),{body:argAtoms(options.args[0]),svgAccent:options.command.slice(1)+(baseString.length>5?"4":["1","1","2","2","3","3"][baseString.length])}))}}),defineFunction(["overarc","overparen","wideparen"],"{body:auto}",{createAtom:function(options){return new AccentAtom(__spreadProps(__spreadValues({},options),{body:argAtoms(options.args[0]),svgAccent:"overarc"}))}}),defineFunction(["underarc","underparen"],"{body:auto}",{createAtom:function(options){return new OverunderAtom(__spreadProps(__spreadValues({},options),{body:argAtoms(options.args[0]),svgBelow:"underarc"}))}}),defineFunction("utilde","{body:auto}",{createAtom:function(options){var body=argAtoms(options.args[0]),baseString=parseArgAsString(body),accent="widetilde"+(baseString.length>5?"4":["1","1","2","2","3","3"][baseString.length]);return new OverunderAtom(__spreadProps(__spreadValues({},options),{body:body,svgBelow:accent,boxType:atomsBoxType(body)}))}}),defineFunction("^","{:string}",{createAtom:function(options){var _a3;return new Atom(__spreadProps(__spreadValues({},options),{type:"mord",isFunction:!1,limits:"adjacent",value:options.args[0]&&null!=(_a3={a:"â",e:"ê",i:"î",o:"ô",u:"û",A:"Â",E:"Ê",I:"Î",O:"Ô",U:"Û"}[options.args[0]])?_a3:"^"}))}}),defineFunction("`","{:string}",{createAtom:function(options){var _a3;return new Atom(__spreadProps(__spreadValues({},options),{type:"mord",isFunction:!1,limits:"adjacent",value:options.args[0]&&null!=(_a3={a:"à",e:"è",i:"ì",o:"ò",u:"ù",A:"À",E:"È",I:"Ì",O:"Ò",U:"Ù"}[options.args[0]])?_a3:"`"}))}}),defineFunction("'","{:string}",{createAtom:function(options){var _a3;return new Atom(__spreadProps(__spreadValues({},options),{type:"mord",isFunction:!1,limits:"adjacent",value:options.args[0]&&null!=(_a3={a:"á",e:"é",i:"í",o:"ó",u:"ú",A:"Á",E:"É",I:"Í",O:"Ó",U:"Ú"}[options.args[0]])?_a3:"^"}))}}),defineFunction("~","{:string}",{createAtom:function(options){var _a3;return new Atom(__spreadProps(__spreadValues({type:"mord"},options),{isFunction:!1,limits:"adjacent",value:options.args[0]&&null!=(_a3={n:"ñ",N:"Ñ",a:"ã",o:"õ",A:"Ã",O:"Õ"}[options.args[0]])?_a3:"´"}))}}),defineFunction("c","{:string}",{createAtom:function(options){var _a3;return new Atom(__spreadProps(__spreadValues({},options),{type:"mord",isFunction:!1,limits:"adjacent",value:options.args[0]&&null!=(_a3={c:"ç",C:"Ç"}[options.args[0]])?_a3:""}))}}),defineFunction("enclose","{notation:string}[style:string]{body:auto}",{createAtom:function(atomOptions){var _a3,_b3,args=atomOptions.args,options={strokeColor:"currentColor",strokeWidth:"",strokeStyle:"solid",backgroundcolor:"transparent",padding:"auto",shadow:"auto",svgStrokeStyle:void 0,borderStyle:void 0,style:null!=(_a3=atomOptions.style)?_a3:{}};if(args[1]){var _step146,_iterator146=_createForOfIteratorHelper(args[1].split(/,(?![^(]*\)(?:(?:[^(]*\)){2})*[^"]*$)/));try{for(_iterator146.s();!(_step146=_iterator146.n()).done;){var s=_step146.value,shorthand=s.match(/\s*(\S+)\s+(\S+)\s+(.*)/);if(shorthand)options.strokeWidth=shorthand[1],options.strokeStyle=shorthand[2],options.strokeColor=shorthand[3];else{var attribute=s.match(/\s*([a-z]*)\s*=\s*"(.*)"/);attribute&&("mathbackground"===attribute[1]?options.backgroundcolor=attribute[2]:"mathcolor"===attribute[1]?options.strokeColor=attribute[2]:"padding"===attribute[1]?options.padding=attribute[2]:"shadow"===attribute[1]&&(options.shadow=attribute[2]))}}}catch(err){_iterator146.e(err)}finally{_iterator146.f()}"dashed"===options.strokeStyle?options.svgStrokeStyle="5,5":"dotted"===options.strokeStyle&&(options.svgStrokeStyle="1,5")}options.borderStyle="".concat(options.strokeWidth," ").concat(options.strokeStyle," ").concat(options.strokeColor);var notation={};return(null!=(_b3=args[0])?_b3:"").split(/[, ]/).filter((function(v){return v.length>0})).forEach((function(x){notation[x.toLowerCase()]=!0})),new EncloseAtom(atomOptions.command,argAtoms(args[2]),notation,options)}}),defineFunction("cancel","{body:auto}",{createAtom:function(options){var _a3;return new EncloseAtom(options.command,argAtoms(options.args[0]),{updiagonalstrike:!0},{strokeColor:"currentColor",strokeWidth:"",strokeStyle:"solid",borderStyle:"1px solid currentColor",backgroundcolor:"transparent",padding:"auto",shadow:"auto",style:null!=(_a3=options.style)?_a3:{}})}}),defineFunction("bcancel","{body:auto}",{createAtom:function(options){var _a3;return new EncloseAtom(options.command,argAtoms(options.args[0]),{downdiagonalstrike:!0},{strokeColor:"currentColor",strokeWidth:"",strokeStyle:"solid",borderStyle:"1px solid currentColor",backgroundcolor:"transparent",padding:"auto",shadow:"auto",style:null!=(_a3=options.style)?_a3:{}})}}),defineFunction("xcancel","{body:auto}",{createAtom:function(options){var _a3;return new EncloseAtom(options.command,argAtoms(options.args[0]),{updiagonalstrike:!0,downdiagonalstrike:!0},{strokeColor:"currentColor",strokeWidth:"",strokeStyle:"solid",borderStyle:"1px solid currentColor",backgroundcolor:"transparent",padding:"auto",shadow:"auto",style:null!=(_a3=options.style)?_a3:{}})}}),defineFunction(["overrightarrow","overleftarrow","Overrightarrow","overleftharpoon","overrightharpoon","overleftrightarrow","overlinesegment","overgroup"],"{:auto}",{createAtom:function(options){var _a3;return new OverunderAtom(__spreadProps(__spreadValues({},options),{body:argAtoms(null==(_a3=options.args)?void 0:_a3[0]),skipBoundary:!1,supsubPlacement:"over-under",paddedBody:!0,boxType:"rel",svgAbove:options.command.slice(1)}))}}),defineFunction("overbrace","{:auto}",{createAtom:function(options){return new OverunderAtom(__spreadProps(__spreadValues({},options),{body:argAtoms(options.args[0]),skipBoundary:!1,supsubPlacement:"over-under",paddedBody:!0,boxType:"ord",svgAbove:options.command.slice(1)}))}}),defineFunction(["underrightarrow","underleftarrow","underleftrightarrow","underlinesegment","undergroup"],"{:auto}",{createAtom:function(options){return new OverunderAtom(__spreadProps(__spreadValues({},options),{body:argAtoms(options.args[0]),skipBoundary:!1,supsubPlacement:"over-under",paddedBody:!0,boxType:"rel",svgBelow:options.command.slice(1)}))}}),defineFunction(["underbrace"],"{:auto}",{createAtom:function(options){return new OverunderAtom(__spreadProps(__spreadValues({},options),{body:argAtoms(options.args[0]),skipBoundary:!1,supsubPlacement:"over-under",paddedBody:!0,boxType:"ord",svgBelow:options.command.slice(1)}))}}),defineFunction(["xrightarrow","longrightarrow","xleftarrow","longleftarrow","xRightarrow","xLeftarrow","xleftharpoonup","xleftharpoondown","xrightharpoonup","xrightharpoondown","xlongequal","xtwoheadleftarrow","xtwoheadrightarrow","xleftrightarrow","longleftrightarrow","xLeftrightarrow","xrightleftharpoons","longrightleftharpoons","xleftrightharpoons","xhookleftarrow","xhookrightarrow","xmapsto","xtofrom","xleftrightarrows","longleftrightarrows","xRightleftharpoons","longRightleftharpoons","xLeftrightharpoons","longLeftrightharpoons"],"[:auto]{:auto}",{createAtom:function(options){var _a3,_b3,_c2,_d2,_e;return new OverunderAtom(__spreadProps(__spreadValues({},options),{svgBody:options.command.slice(1),above:0===(null==(_b3=argAtoms(null==(_a3=options.args)?void 0:_a3[1]))?void 0:_b3.length)?void 0:argAtoms(null==(_c2=options.args)?void 0:_c2[1]),below:null!=(_e=argAtoms(null==(_d2=options.args)?void 0:_d2[0]))?_e:null,skipBoundary:!1,supsubPlacement:"over-under",paddedBody:!0,paddedLabels:!0,boxType:"rel"}))},serialize:function(atom,options){return atom.command+(atom.hasEmptyBranch("below")?"":"[".concat(atom.belowToLatex(options),"]"))+"{".concat(atom.aboveToLatex(options),"}").concat(atom.supsubToLatex(options))}}),defineFunction(["arccos","arcsin","arctan","arctg","arcctg","arg","ch","cos","cosh","cot","cotg","coth","ctg","cth","csc","cosec","dim","exp","hom","inf","ker","lb","lg","ln","log","Pr","sec","sh","sin","sinh","sup","tan","tanh","tg","th","arcsec","arccsc","arsinh","arcosh","artanh","arcsech","arccsch"],"",{isFunction:!0,ifMode:"math",createAtom:function(options){return new OperatorAtom(options.command.slice(1),__spreadProps(__spreadValues({},options),{limits:"adjacent",isFunction:!0,variant:"main",variantStyle:"up"}))}}),defineFunction(["liminf","limsup"],"",{ifMode:"math",createAtom:function(options){return new OperatorAtom({"\\liminf":"lim inf","\\limsup":"lim sup"}[options.command],__spreadProps(__spreadValues({},options),{limits:"over-under",variant:"main"}))}}),defineFunction(["lim","mod"],"",{ifMode:"math",createAtom:function(options){return new OperatorAtom(options.command.slice(1),__spreadProps(__spreadValues({},options),{limits:"over-under",variant:"main"}))}}),defineFunction(["det","max","min"],"",{ifMode:"math",isFunction:!0,createAtom:function(options){return new OperatorAtom(options.command.slice(1),__spreadProps(__spreadValues({},options),{limits:"over-under",isFunction:!0,variant:"main"}))}}),defineFunction(["ang"],"{:math}",{ifMode:"math",createAtom:function(options){return new Atom(__spreadProps(__spreadValues({},options),{body:argAtoms(options.args[0])}))},serialize:function(atom,options){return"\\ang{".concat(atom.bodyToLatex(options),"}")},render:function(atom,context){var box=atom.createBox(context),caret=box.caret;box.caret=void 0;var deg=new Box("°",{style:__spreadProps(__spreadValues({},atom.style),{variant:"normal",variantStyle:"up"})});return new Box([box,deg],{type:"inner",isSelected:atom.isSelected,caret:caret})}}),defineFunction("sqrt","[index:auto]{radicand:expression}",{ifMode:"math",createAtom:function(options){return new SurdAtom(__spreadProps(__spreadValues({},options),{body:argAtoms(options.args[1]),index:options.args[0]?argAtoms(options.args[0]):void 0}))}}),defineFunction(["frac","dfrac","tfrac","cfrac","binom","dbinom","tbinom"],"{:expression}{:expression}",{ifMode:"math",createAtom:function(options){var genfracOptions=__spreadValues({},options),command=options.command,args=options.args;switch(command){case"\\dfrac":case"\\frac":case"\\tfrac":genfracOptions.hasBarLine=!0;break;case"\\atopfrac":genfracOptions.hasBarLine=!1;break;case"\\dbinom":case"\\binom":case"\\tbinom":genfracOptions.hasBarLine=!1,genfracOptions.leftDelim="(",genfracOptions.rightDelim=")";break;case"\\cfrac":genfracOptions.hasBarLine=!0,genfracOptions.continuousFraction=!0}switch(command){case"\\dfrac":case"\\dbinom":genfracOptions.mathstyleName="displaystyle";break;case"\\tfrac":case"\\tbinom":genfracOptions.mathstyleName="textstyle"}return new GenfracAtom(args[0]?argAtoms(args[0]):[new PlaceholderAtom],args[1]?argAtoms(args[1]):[new PlaceholderAtom],genfracOptions)},serialize:function(atom,options){var numer=atom.aboveToLatex(options),denom=atom.belowToLatex(options);return/^[0-9]$/.test(numer)&&/^[0-9]$/.test(denom)?"".concat(atom.command).concat(numer).concat(denom):latexCommand(atom.command,numer,denom)}}),defineFunction(["brace","brack"],"",{infix:!0,createAtom:function(options){return new GenfracAtom(argAtoms(options.args[0]),argAtoms(options.args[1]),__spreadProps(__spreadValues({},options),{hasBarLine:!1,leftDelim:"\\brace"===options.command?"\\lbrace":"\\lbrack",rightDelim:"\\brace"===options.command?"\\rbrace":"\\rbrack"}))},serialize:function(atom,options){return joinLatex([atom.aboveToLatex(options),atom.command,atom.belowToLatex(options)])}}),defineFunction(["over","atop","choose"],"",{infix:!0,createAtom:function(options){var leftDelim=void 0,rightDelim=void 0,args=options.args;return"\\choose"===options.command&&(leftDelim="(",rightDelim=")"),new GenfracAtom(argAtoms(args[0]),argAtoms(args[1]),__spreadProps(__spreadValues({},options),{hasBarLine:"\\over"===options.command,leftDelim:leftDelim,rightDelim:rightDelim}))},serialize:function(atom,options){return joinLatex([atom.aboveToLatex(options),atom.command,atom.belowToLatex(options)])}}),defineFunction(["overwithdelims","atopwithdelims"],"{numer:auto}{denom:auto}{left-delim:delim}{right-delim:delim}",{infix:!0,createAtom:function(options){var _a3,_b3,args=options.args;return new GenfracAtom(argAtoms(args[0]),argAtoms(args[1]),__spreadProps(__spreadValues({},options),{leftDelim:null!=(_a3=args[2])?_a3:".",rightDelim:null!=(_b3=args[3])?_b3:".",hasBarLine:!1}))},serialize:function(atom,options){return"".concat(atom.aboveToLatex(options)," ").concat(atom.command).concat(atom.leftDelim).concat(atom.rightDelim).concat(atom.belowToLatex(options))}}),defineFunction("pdiff","{numerator}{denominator}",{ifMode:"math",createAtom:function(options){return new GenfracAtom(argAtoms(options.args[0]),argAtoms(options.args[1]),__spreadProps(__spreadValues({},options),{hasBarLine:!0,numerPrefix:"∂",denomPrefix:"∂"}))}}),defineFunction(["sum","prod","bigcup","bigcap","coprod","bigvee","bigwedge","biguplus","bigotimes","bigoplus","bigodot","bigsqcup","intop"],"",{ifMode:"math",createAtom:function(options){return new OperatorAtom({coprod:"∐",bigvee:"⋁",bigwedge:"⋀",biguplus:"⨄",bigcap:"⋂",bigcup:"⋃",intop:"∫",prod:"∏",sum:"∑",bigotimes:"⨂",bigoplus:"⨁",bigodot:"⨀",bigsqcup:"⨆",smallint:"∫"}[options.command.slice(1)],__spreadProps(__spreadValues({},options),{isExtensibleSymbol:!0,limits:"auto",variant:"main"}))}}),defineFunction("smallint","",{ifMode:"math",createAtom:function(options){return new OperatorAtom("∫",__spreadProps(__spreadValues({},options),{limits:"adjacent",isExtensibleSymbol:!1,variant:"main"}))}});var EXTENSIBLE_SYMBOLS={int:"∫",iint:"∬",iiint:"∭",oint:"∮",oiint:"∯",oiiint:"∰",intclockwise:"∱",varointclockwise:"∲",ointctrclockwise:"∳",intctrclockwise:"⨑",sqcup:"⊔",sqcap:"⊓",uplus:"⊎",wr:"≀",amalg:"⨿",Cap:"⋒",Cup:"⋓",doublecap:"⋒",doublecup:"⋓"};defineFunction(Object.keys(EXTENSIBLE_SYMBOLS),"",{ifMode:"math",createAtom:function(options){var command=options.command,symbol=EXTENSIBLE_SYMBOLS[command.slice(1)];return new OperatorAtom(symbol,__spreadProps(__spreadValues({},options),{limits:"adjacent",isExtensibleSymbol:!0,variant:{"⋒":"ams","⋓":"ams"}[symbol]}))}}),defineFunction(["Re","Im"],"",{ifMode:"math",createAtom:function(options){return new OperatorAtom({"\\Re":"ℜ","\\Im":"ℑ"}[options.command],__spreadProps(__spreadValues({},options),{limits:"adjacent",isFunction:!0,variant:"fraktur"}))}}),defineFunction("middle","{:delim}",{ifMode:"math",createAtom:function(options){var _a3;return new MiddleDelimAtom(__spreadProps(__spreadValues({},options),{delim:null!=(_a3=options.args[0])?_a3:"|",size:1}))}}),defineFunction("the","{:value}",{createAtom:function(options){return new Atom(__spreadProps(__spreadValues({},options),{captureSelection:!0,verbatimLatex:null}))},render:function(atom,parent){var _a3,ctx=new Context({parent:parent},atom.style),classes="";atom.isSelected&&(classes+=" ML__selected");var arg=ctx.evaluate(atom.args[0]);return new Box((null!=(_a3=serializeLatexValue(arg))?_a3:"").split("").map((function(x){return new Box(x,{type:"ord",classes:classes,mode:atom.mode,isSelected:atom.isSelected,style:__spreadValues({variant:"main"},atom.style)})})),{type:"lift",style:atom.style,caret:atom.caret,isSelected:atom.isSelected,classes:classes}).wrap(ctx)},serialize:function(atom){var _a3;return"\\the".concat(null!=(_a3=serializeLatexValue(atom.args[0]))?_a3:"\\relax")}}),defineFunction("mathtip","{:auto}{:math}",{createAtom:function(options){return new TooltipAtom(__spreadProps(__spreadValues({},options),{body:argAtoms(options.args[0]),tooltip:argAtoms(options.args[1]),content:"math"}))},serialize:function(atom,options){return options.skipStyles?atom.bodyToLatex(options):"\\texttip{".concat(atom.bodyToLatex(options),"}{").concat(Atom.serialize([atom.tooltip],__spreadProps(__spreadValues({},options),{defaultMode:"math"})),"}")}}),defineFunction("texttip","{:auto}{:text}",{createAtom:function(options){return new TooltipAtom(__spreadProps(__spreadValues({},options),{body:argAtoms(options.args[0]),tooltip:argAtoms(options.args[1]),content:"text"}))},serialize:function(atom,options){return options.skipStyles?atom.bodyToLatex(options):"\\texttip{".concat(atom.bodyToLatex(options),"}{").concat(Atom.serialize([atom.tooltip],__spreadProps(__spreadValues({},options),{defaultMode:"text"})),"}")}}),defineFunction("error","{:math}",{createAtom:function(options){return new Atom(__spreadProps(__spreadValues({},options),{body:argAtoms(options.args[0])}))},serialize:function(atom,options){return"\\error{".concat(atom.bodyToLatex(options),"}")},render:function(atom,context){return atom.createBox(context,{classes:"ML__error"})}}),defineFunction("ensuremath","{:math}",{createAtom:function(options){return new Atom(__spreadProps(__spreadValues({},options),{body:argAtoms(options.args[0])}))},serialize:function(atom,options){return"".concat(atom.command,"{").concat(atom.bodyToLatex(__spreadProps(__spreadValues({},options),{defaultMode:"math"})),"}")}}),defineFunction("color","{:value}",{applyStyle:function(_name,args,context){var _a3,_b3;return{verbatimColor:null!=(_a3=serializeLatexValue(args[0]))?_a3:void 0,color:context.toColor(null!=(_b3=args[0])?_b3:{string:"red"})}}}),defineFunction("textcolor","{:value}{content:auto*}",{applyStyle:function(_name,args,context){var _a3,_b3;return{verbatimColor:null!=(_a3=serializeLatexValue(args[0]))?_a3:void 0,color:context.toColor(null!=(_b3=args[0])?_b3:{string:"red"})}}}),defineFunction("boxed","{content:math}",{createAtom:function(options){return new BoxAtom(__spreadProps(__spreadValues({},options),{body:argAtoms(options.args[0]),framecolor:{string:"black"}}))}}),defineFunction("colorbox","{:value}{:text*}",{applyStyle:function(_name,args,context){var _a3,_b3;return{verbatimBackgroundColor:null!=(_a3=serializeLatexValue(args[0]))?_a3:void 0,backgroundColor:context.toBackgroundColor(null!=(_b3=args[0])?_b3:{string:"yellow"})}}}),defineFunction("fcolorbox","{frame-color:value}{background-color:value}{content:text}",{applyMode:"text",createAtom:function(options){var _a3,_b3;return new BoxAtom(__spreadProps(__spreadValues({},options),{body:argAtoms(options.args[2]),framecolor:null!=(_a3=options.args[0])?_a3:{string:"blue"},backgroundcolor:null!=(_b3=options.args[1])?_b3:{string:"yellow"}}))},serialize:function(atom,options){var _a3,_b3;return options.skipStyles?atom.bodyToLatex(__spreadProps(__spreadValues({},options),{defaultMode:"text"})):latexCommand(atom.command,null!=(_a3=serializeLatexValue(atom.framecolor))?_a3:"",null!=(_b3=serializeLatexValue(atom.backgroundcolor))?_b3:"",atom.bodyToLatex(__spreadProps(__spreadValues({},options),{defaultMode:"text"})))}}),defineFunction("bbox","[:bbox]{body:auto}",{createAtom:function(options){var _a3,arg=options.args[0],body=argAtoms(options.args[1]);return new BoxAtom(__spreadProps(__spreadValues({},options),arg?{body:body,padding:arg.padding,border:arg.border,backgroundcolor:null!=(_a3=arg.backgroundcolor)?_a3:void 0}:{body:body}))},serialize:function(atom,options){var _a3,_b3;if(options.skipStyles)return atom.bodyToLatex(options);var result=atom.command;if(Number.isFinite(atom.padding)||void 0!==atom.border||void 0!==atom.backgroundcolor){var bboxParameters=[];atom.padding&&bboxParameters.push(null!=(_a3=serializeLatexValue(atom.padding))?_a3:""),atom.border&&bboxParameters.push("border: ".concat(atom.border)),atom.backgroundcolor&&bboxParameters.push(null!=(_b3=serializeLatexValue(atom.backgroundcolor))?_b3:""),result+="[".concat(bboxParameters.join(","),"]")}return latexCommand(result,atom.bodyToLatex(options))}}),defineFunction(["displaystyle","textstyle","scriptstyle","scriptscriptstyle"],"{:rest}",{createAtom:function(options){return new Atom(__spreadProps(__spreadValues({},options),{body:argAtoms(options.args[0])}))},render:function(atom,context){var ctx=new Context({parent:context,mathstyle:atom.command.slice(1)},atom.style),box=Atom.createBox(ctx,atom.body,{type:"lift"});return atom.caret&&(box.caret=atom.caret),atom.bind(context,box)},serialize:function(atom,options){return options.skipStyles?atom.bodyToLatex(options):"{".concat(joinLatex([atom.command,atom.bodyToLatex(options)]),"}")}}),defineFunction(["tiny","scriptsize","footnotesize","small","normalsize","large","Large","LARGE","huge","Huge"],"",{applyStyle:function(name){return{fontSize:{"\\tiny":1,"\\scriptsize":2,"\\footnotesize":3,"\\small":4,"\\normalsize":5,"\\large":6,"\\Large":7,"\\LARGE":8,"\\huge":9,"\\Huge":10}[name]}}}),defineFunction("fontseries","{:string}",{ifMode:"text",applyStyle:function(_name,args){var _a3;return{fontSeries:null!=(_a3=args[0])?_a3:"auto"}}}),defineFunction("fontshape","{:string}",{ifMode:"text",applyStyle:function(_name,args){var _a3;return{fontShape:null!=(_a3=args[0])?_a3:"auto"}}}),defineFunction("fontfamily","{:string}",{ifMode:"text",applyStyle:function(_name,args){var _a3;return{fontFamily:null!=(_a3=args[0])?_a3:"roman"}}}),defineFunction("selectfont","",{ifMode:"text",applyStyle:function(){return{}}}),defineFunction("bf","{:rest}",{applyStyle:function(){return{fontSeries:"b",fontShape:"n",fontFamily:"roman"}}}),defineFunction(["boldsymbol","bm"],"{:math}",{applyMode:"math",createAtom:function(options){return new Atom(__spreadProps(__spreadValues({},options),{body:argAtoms(options.args[0])}))},serialize:function(atom,options){return"".concat(atom.command,"{").concat(atom.bodyToLatex(options),"}")},render:function(atom,context){return atom.createBox(context,{classes:"ML__boldsymbol"})}}),defineFunction("bold","{:math*}",{applyMode:"math",applyStyle:function(){return{variantStyle:"bold"}}}),defineFunction("bfseries","{:rest}",{applyMode:"text",applyStyle:function(){return{fontSeries:"b"}}}),defineFunction("mdseries","{:rest}",{applyMode:"text",applyStyle:function(){return{fontSeries:"m"}}}),defineFunction("upshape","{:rest}",{applyMode:"text",applyStyle:function(){return{fontShape:"n"}}}),defineFunction("slshape","{:rest}",{applyMode:"text",applyStyle:function(){return{fontShape:"sl"}}}),defineFunction("scshape","{:rest}",{applyMode:"text",applyStyle:function(){return{fontShape:"sc"}}}),defineFunction("textbf","{:text*}",{applyMode:"text",applyStyle:function(){return{fontSeries:"b"}}}),defineFunction("textmd","{:text*}",{applyMode:"text",applyStyle:function(){return{fontSeries:"m"}}}),defineFunction("textup","{:text*}",{applyMode:"text",applyStyle:function(){return{fontShape:"n"}}}),defineFunction("textnormal","{:text*}",{applyMode:"text",applyStyle:function(){return{fontShape:"n",fontSeries:"m"}}}),defineFunction("textsl","{:text*}",{applyMode:"text",applyStyle:function(){return{fontShape:"sl"}}}),defineFunction("textit","{:text*}",{applyMode:"text",applyStyle:function(){return{fontShape:"it"}}}),defineFunction("textsc","{:text*}",{applyMode:"text",applyStyle:function(){return{fontShape:"sc"}}}),defineFunction("textrm","{:text*}",{applyMode:"text",applyStyle:function(){return{fontFamily:"roman"}}}),defineFunction("textsf","{:text*}",{applyMode:"text",applyStyle:function(){return{fontFamily:"sans-serif"}}}),defineFunction("texttt","{:text*}",{applyMode:"text",applyStyle:function(){return{fontFamily:"monospace"}}}),defineFunction("mathbf","{:math*}",{applyMode:"math",applyStyle:function(){return{variant:"normal",variantStyle:"bold"}}}),defineFunction("mathit","{:math*}",{applyMode:"math",applyStyle:function(){return{variant:"main",variantStyle:"italic"}}}),defineFunction("mathnormal","{:math*}",{applyMode:"math",applyStyle:function(){return{variant:"normal",variantStyle:"italic"}}}),defineFunction("mathbfit","{:math*}",{applyMode:"math",applyStyle:function(){return{variant:"main",variantStyle:"bolditalic"}}}),defineFunction("mathrm","{:math*}",{applyMode:"math",applyStyle:function(){return{variant:"normal",variantStyle:"up"}}}),defineFunction("mathsf","{:math*}",{applyMode:"math",applyStyle:function(){return{variant:"sans-serif",variantStyle:"up"}}}),defineFunction("mathtt","{:math*}",{applyMode:"math",applyStyle:function(){return{variant:"monospace",variantStyle:"up"}}}),defineFunction("it","{:rest}",{applyStyle:function(){return{fontSeries:"m",fontShape:"it",fontFamily:"roman",variantStyle:"italic"}}}),defineFunction("rmfamily","",{applyStyle:function(){return{fontFamily:"roman"}}}),defineFunction("sffamily","",{applyStyle:function(){return{fontFamily:"sans-serif"}}}),defineFunction("ttfamily","",{applyStyle:function(){return{fontFamily:"monospace"}}}),defineFunction(["Bbb","mathbb"],"{:math*}",{applyStyle:function(){return{variant:"double-struck",variantStyle:"up"}}}),defineFunction(["frak","mathfrak"],"{:math*}",{applyStyle:function(){return{variant:"fraktur",variantStyle:"up"}}}),defineFunction("mathcal","{:math*}",{applyStyle:function(){return{variant:"calligraphic",variantStyle:"up"}}}),defineFunction("mathscr","{:math*}",{applyStyle:function(){return{variant:"script",variantStyle:"up"}}}),defineFunction("mbox","{:text}",{ifMode:"math",createAtom:function(options){return new Atom(__spreadProps(__spreadValues({},options),{type:"mord",body:argAtoms(options.args[0]),mode:"math"}))},serialize:function(atom,options){return latexCommand("\\mbox",atom.bodyToLatex(__spreadProps(__spreadValues({},options),{defaultMode:"text"})))}}),defineFunction("text","{:text}",{ifMode:"math",applyMode:"text"}),defineFunction(["class","htmlClass"],"{name:string}{content:auto}",{createAtom:function(options){return new Atom(__spreadProps(__spreadValues({},options),{body:argAtoms(options.args[1])}))},serialize:function(atom,options){return!atom.args[0]||options.skipStyles?atom.bodyToLatex(options):"".concat(atom.command,"{").concat(atom.args[0],"}{").concat(atom.bodyToLatex(options),"}")},render:function(atom,context){var _a3;return atom.createBox(context,{classes:null!=(_a3=atom.args[0])?_a3:""})}}),defineFunction(["cssId","htmlId"],"{id:string}{content:auto}",{createAtom:function(options){return new Atom(__spreadProps(__spreadValues({},options),{body:argAtoms(options.args[1])}))},serialize:function(atom,options){var _a3;return!(null==(_a3=atom.args)?void 0:_a3[0])||options.skipStyles?atom.bodyToLatex(options):"".concat(atom.command,"{").concat(atom.args[0],"}{").concat(atom.bodyToLatex(options),"}")},render:function(atom,context){var _a3,box=atom.createBox(context);return box.cssId=null!=(_a3=atom.args[0])?_a3:"",box}}),defineFunction("htmlData","{data:string}{content:auto}",{createAtom:function(options){return new Atom(__spreadProps(__spreadValues({},options),{body:argAtoms(options.args[1])}))},serialize:function(atom,options){var _a3;return!(null==(_a3=atom.args)?void 0:_a3[0])||options.skipStyles?atom.bodyToLatex(options):"\\htmlData{".concat(atom.args[0],"}{").concat(atom.bodyToLatex(options),"}")},render:function(atom,context){var _a3,box=atom.createBox(context);return box.htmlData=null!=(_a3=atom.args[0])?_a3:"",box}}),defineFunction(["style","htmlStyle"],"{data:string}{content:auto}",{createAtom:function(options){return new Atom(__spreadProps(__spreadValues({},options),{body:argAtoms(options.args[1])}))},serialize:function(atom,options){var _a3;return!(null==(_a3=atom.args)?void 0:_a3[0])||options.skipStyles?atom.bodyToLatex(options):"".concat(atom.command,"{").concat(atom.args[0],"}{").concat(atom.bodyToLatex(options),"}")},render:function(atom,context){var _a3,box=atom.createBox(context);return box.htmlStyle=null!=(_a3=atom.args[0])?_a3:"",box}}),defineFunction("em","{:rest}",{createAtom:function(options){return new Atom(__spreadProps(__spreadValues({},options),{body:argAtoms(options.args[0])}))},serialize:function(atom,options){return options.skipStyles?atom.bodyToLatex(options):"{\\em ".concat(atom.bodyToLatex(options),"}")},render:function(atom,context){return atom.createBox(context,{classes:"ML__emph",boxType:"lift"})}}),defineFunction("emph","{:auto}",{createAtom:function(options){return new Atom(__spreadProps(__spreadValues({},options),{body:argAtoms(options.args[1])}))},serialize:function(atom,options){return options.skipStyles?atom.bodyToLatex(options):"\\emph{".concat(atom.bodyToLatex(options),"}")},render:function(atom,context){return atom.createBox(context,{classes:"ML__emph",boxType:"lift"})}});var DELIMITER_SIZES={"\\bigl":{mclass:"mopen",size:1},"\\Bigl":{mclass:"mopen",size:2},"\\biggl":{mclass:"mopen",size:3},"\\Biggl":{mclass:"mopen",size:4},"\\bigr":{mclass:"mclose",size:1},"\\Bigr":{mclass:"mclose",size:2},"\\biggr":{mclass:"mclose",size:3},"\\Biggr":{mclass:"mclose",size:4},"\\bigm":{mclass:"mrel",size:1},"\\Bigm":{mclass:"mrel",size:2},"\\biggm":{mclass:"mrel",size:3},"\\Biggm":{mclass:"mrel",size:4},"\\big":{mclass:"mord",size:1},"\\Big":{mclass:"mord",size:2},"\\bigg":{mclass:"mord",size:3},"\\Bigg":{mclass:"mord",size:4}};function validateStyle(mathfield,style){var _a3,_b3,_c2,_d2,_e,_f,result={};"string"==typeof style.color&&(result.verbatimColor=style.color,result.color=null!=(_a3=mathfield.colorMap(style.color))?_a3:"none"),"string"==typeof style.backgroundColor&&(result.verbatimBackgroundColor=style.backgroundColor,result.backgroundColor=null!=(_b3=mathfield.backgroundColorMap(style.backgroundColor))?_b3:"none"),"string"==typeof style.fontFamily&&(result.fontFamily=style.fontFamily),"string"==typeof style.series&&(result.fontSeries=style.series),"string"==typeof style.fontSeries&&(result.fontSeries=style.fontSeries.toLowerCase()),result.fontSeries&&(result.fontSeries=null!=(_c2={bold:"b",medium:"m",normal:"m"}[result.fontSeries])?_c2:result.fontSeries),"string"==typeof style.shape&&(result.fontShape=style.shape),"string"==typeof style.fontShape&&(result.fontShape=style.fontShape.toLowerCase()),result.fontShape&&(result.fontShape=null!=(_d2={italic:"it",up:"n",upright:"n",normal:"n"}[result.fontShape])?_d2:result.fontShape);var size=null!=(_e=style.size)?_e:style.fontSize;return"number"==typeof size?result.fontSize=Math.max(1,Math.min(10,size)):"string"==typeof size&&(result.fontSize=null!=(_f={size1:1,size2:2,size3:3,size4:4,size5:5,size6:6,size7:7,size8:8,size9:9,size10:10}[size.toLowerCase()])?_f:{tiny:1,scriptsize:2,footnotesize:3,small:4,normal:5,normalsize:5,large:6,Large:7,LARGE:8,huge:9,Huge:10}[size]),result}function _selectGroup(model){var _a3,_b3,_c2,_d2,_e,_f;if("text"===getMode(model,model.position)){for(var _range10=_slicedToArray(range(model.selection),2),start=_range10[0],end=_range10[1],done=!1;!done&&start>0;){var atom=model.at(start);"text"===atom.mode&&LETTER_AND_DIGITS.test(atom.value)?start-=1:done=!0}for(done=!1;!done&&end<=model.lastOffset;){var _atom10=model.at(end);"text"===_atom10.mode&&LETTER_AND_DIGITS.test(_atom10.value)?end+=1:done=!0}if(done&&(end-=1),start>=end)return model.setSelection(end-1,end),!0;model.setSelection(start,end)}else{var _atom11=model.at(model.position);if(_atom11.isDigit()){for(var _range12=_slicedToArray(range(model.selection),2),_start=_range12[0],_end=_range12[1];null==(_a3=model.at(_start))?void 0:_a3.isDigit();)_start-=1;for(;null==(_b3=model.at(_end))?void 0:_b3.isDigit();)_end+=1;model.setSelection(_start,_end-1)}else if(_atom11.style.variant||_atom11.style.variantStyle){for(var _range14=_slicedToArray(range(model.selection),2),_start2=_range14[0],_end2=_range14[1],x=null==(_c2=model.at(_start2))?void 0:_c2.style;x&&x.variant===_atom11.style.variant&&x.variantStyle===_atom11.style.variantStyle;)_start2-=1,x=null==(_d2=model.at(_start2))?void 0:_d2.style;for(x=null==(_e=model.at(_end2))?void 0:_e.style;x&&x.variant===_atom11.style.variant&&x.variantStyle===_atom11.style.variantStyle;)_end2+=1,x=null==(_f=model.at(_end2))?void 0:_f.style;model.setSelection(_start2,_end2-1)}else model.setSelection(model.offsetOf(_atom11.firstSibling),model.offsetOf(_atom11.lastSibling))}return!0}defineFunction(["bigl","Bigl","biggl","Biggl","bigr","Bigr","biggr","Biggr","bigm","Bigm","biggm","Biggm","big","Big","bigg","Bigg"],"{:delim}",{createAtom:function(options){var _a3;return new SizedDelimAtom(__spreadProps(__spreadValues({},options),{delim:null!=(_a3=options.args[0])?_a3:".",size:DELIMITER_SIZES[options.command].size,delimType:DELIMITER_SIZES[options.command].mclass}))}}),defineFunction(["hspace","hspace*"],"{width:value}",{createAtom:function(options){var _a3;return new SpacingAtom(__spreadProps(__spreadValues({},options),{width:null!=(_a3=options.args[0])?_a3:{dimension:0}}))}}),defineFunction(["mkern","kern","mskip","hskip","mspace"],"{width:value}",{createAtom:function(options){var _a3;return new SpacingAtom(__spreadProps(__spreadValues({},options),{width:null!=(_a3=options.args[0])?_a3:{dimension:0}}))}}),defineFunction("mathchoice","{:math}{:math}{:math}{:math}",{createAtom:function(options){return new Atom(options)},render:function(atom,context){var i=0,d=context.mathstyle.id;5!==d&&4!==d||(i=1),3!==d&&2!==d||(i=2),1!==d&&0!==d||(i=3);var body=argAtoms(atom.args[i]);return Atom.createBox(context,body)},serialize:function(atom,options){return"\\mathchoice{".concat(Atom.serialize(atom.args[0],options),"}{").concat(Atom.serialize(atom.args[1],options),"}{").concat(Atom.serialize(atom.args[2],options),"}{").concat(Atom.serialize(atom.args[3],options),"}")}}),defineFunction("mathop","{:auto}",{createAtom:function(options){return new Atom(__spreadProps(__spreadValues({},options),{type:"mop",body:argAtoms(options.args[0]),limits:"over-under",isFunction:!0,captureSelection:!0}))},render:function(atom,context){var _a3,base=Atom.createBox(context,atom.body);if(atom.superscript||atom.subscript){var limits=null!=(_a3=atom.subsupPlacement)?_a3:"auto";base="over-under"===limits||"auto"===limits&&context.isDisplayStyle?atom.attachLimits(context,{base:base}):atom.attachSupsub(context,{base:base})}return new Box(atom.bind(context,base),{type:"op",isSelected:atom.isSelected,classes:"op-group"})},serialize:function(atom,options){var result=[latexCommand(atom.command,atom.bodyToLatex(options))];return atom.explicitSubsupPlacement&&("over-under"===atom.subsupPlacement&&result.push("\\limits"),"adjacent"===atom.subsupPlacement&&result.push("\\nolimits"),"auto"===atom.subsupPlacement&&result.push("\\displaylimits")),result.push(atom.supsubToLatex(options)),joinLatex(result)}}),defineFunction(["mathbin","mathrel","mathopen","mathclose","mathpunct","mathord","mathinner"],"{:auto}",{createAtom:function(options){return new Atom(__spreadProps(__spreadValues({},options),{type:{"\\mathbin":"mbin","\\mathrel":"mrel","\\mathopen":"mopen","\\mathclose":"mclose","\\mathpunct":"mpunct","\\mathord":"mord","\\mathinner":"minner"}[options.command],body:argAtoms(options.args[0]),captureSelection:!0}))}}),defineFunction(["operatorname","operatorname*"],"{operator:math}",{createAtom:function(options){var body=argAtoms(options.args[0]).map((function(x){var _a3;return"first"!==x.type&&(x.type="mord",x.value=null!=(_a3={"∗":"*","−":"-"}[x.value])?_a3:x.value,x.isFunction=!1,x.style.variant||x.style.variantStyle||(x.style.variant="main",x.style.variantStyle="up")),x}));return new Atom(__spreadProps(__spreadValues({},options),{type:"mop",body:body,isFunction:!0,limits:"\\operatorname"===options.command?"adjacent":"over-under"}))},render:function(atom,context){var _a3,base=Atom.createBox(context,atom.body);if(atom.superscript||atom.subscript){var limits=null!=(_a3=atom.subsupPlacement)?_a3:"auto";base="over-under"===limits||"auto"===limits&&context.isDisplayStyle?atom.attachLimits(context,{base:base}):atom.attachSupsub(context,{base:base})}return new Box(atom.bind(context,base),{type:"op",isSelected:atom.isSelected,classes:"op-group"})},serialize:function(atom,options){var result=[latexCommand(atom.command,atom.bodyToLatex(options))];return atom.explicitSubsupPlacement&&("over-under"===atom.subsupPlacement&&result.push("\\limits"),"adjacent"===atom.subsupPlacement&&result.push("\\nolimits"),"auto"===atom.subsupPlacement&&result.push("\\displaylimits")),result.push(atom.supsubToLatex(options)),joinLatex(result)}}),defineFunction(["char","unicode"],"{charcode:value}",{createAtom:function(options){return new Atom(__spreadProps(__spreadValues({},options),{type:"text"===options.mode?"text":"mord"}))},serialize:function(atom){var _a3;return"".concat(atom.command).concat(serializeLatexValue(null!=(_a3=atom.args[0])?_a3:{number:10067,base:"hexadecimal"}))},render:function(atom,context){var value=context.evaluate(atom.args[0]);return value&&"number"in value||(value={number:10067,base:"hexadecimal"}),atom.value=String.fromCodePoint(value.number),atom.createBox(context)}}),defineFunction("rule","[raise:value]{width:value}{thickness:value}",{createAtom:function(options){return new Atom(options)},render:function(atom,context){var _a3,_b3,_c2,ctx=new Context({parent:context,mathstyle:"textstyle"},atom.style),shift=ctx.toEm(null!=(_a3=atom.args[0])?_a3:{dimension:0}),width=ctx.toEm(null!=(_b3=atom.args[1])?_b3:{dimension:10}),height=ctx.toEm(null!=(_c2=atom.args[2])?_c2:{dimension:10}),result=new Box(null,{classes:"rule",type:"ord",width:width,height:height+shift,depth:-shift});return result.setStyle("border-right-width",width,"em"),result.setStyle("border-top-width",height,"em"),result.setStyle("border-color",atom.style.color),result.setStyle("vertical-align",shift,"em"),atom.isSelected&&result.setStyle("opacity","50%"),atom.bind(ctx,result),atom.caret&&(result.caret=atom.caret),result.wrap(context)},serialize:function(atom){return"\\rule".concat(atom.args[0]?"[".concat(serializeLatexValue(atom.args[0]),"]"):"","{").concat(serializeLatexValue(atom.args[1]),"}{").concat(serializeLatexValue(atom.args[2]),"}")}}),defineFunction(["overline","underline"],"{:auto}",{createAtom:function(options){return new Atom(options)},render:function(atom,parentContext){var position=atom.command.substring(1),context=new Context({parent:parentContext,mathstyle:"cramp"},atom.style),inner=Atom.createBox(context,atom.body);if(!inner)return null;var stack,ruleWidth=context.metrics.defaultRuleThickness/context.scalingFactor,line=new Box(null,{classes:position+"-line"});return line.height=ruleWidth,line.maxFontSize=1.125*ruleWidth*context.scalingFactor,stack=new VBox("overline"===position?{shift:0,children:[{box:inner},3*ruleWidth,{box:line},ruleWidth]}:{top:inner.height,children:[ruleWidth,{box:line},3*ruleWidth,{box:inner}]}),atom.caret&&(stack.caret=atom.caret),new Box(stack,{classes:position,type:"ignore"})}}),defineFunction("overset","{:auto}{base:auto}",{createAtom:function(options){var body=argAtoms(options.args[1]);return new OverunderAtom(__spreadProps(__spreadValues({},options),{above:argAtoms(options.args[0]),body:body,skipBoundary:!1,boxType:atomsBoxType(body)}))},serialize:function(atom,options){return latexCommand(atom.command,atom.aboveToLatex(options),atom.bodyToLatex(options))}}),defineFunction("underset","{:auto}{base:auto}",{createAtom:function(options){var body=argAtoms(options.args[1]);return new OverunderAtom(__spreadProps(__spreadValues({},options),{below:argAtoms(options.args[0]),body:body,skipBoundary:!1,boxType:atomsBoxType(body)}))},serialize:function(atom,options){return latexCommand(atom.command,atom.belowToLatex(options),atom.bodyToLatex(options))}}),defineFunction("overunderset","{above:auto}{below:auto}{base:auto}",{createAtom:function(options){var body=argAtoms(options.args[2]);return new OverunderAtom(__spreadProps(__spreadValues({},options),{above:argAtoms(options.args[0]),below:argAtoms(options.args[1]),body:body,skipBoundary:!1,boxType:atomsBoxType(body)}))},serialize:function(atom,options){return latexCommand(atom.command,atom.belowToLatex(options),atom.bodyToLatex(options))}}),defineFunction(["stackrel","stackbin"],"[below:auto]{above:auto}{base:auto}",{createAtom:function(options){return new OverunderAtom(__spreadProps(__spreadValues({},options),{body:argAtoms(options.args[2]),above:argAtoms(options.args[1]),below:argAtoms(options.args[0]),skipBoundary:!1,boxType:"\\stackrel"===options.command?"rel":"bin"}))},serialize:function(atom,options){return latexCommand(atom.command,atom.aboveToLatex(options),atom.bodyToLatex(options))}}),defineFunction("smash","[:string]{:auto}",{createAtom:function(options){var _a3,_b3,_c2,_d2;return new PhantomAtom(__spreadProps(__spreadValues({},options),{body:argAtoms(options.args[1]),smashHeight:null==(_b3=null==(_a3=options.args[0])?void 0:_a3.includes("t"))||_b3,smashDepth:null==(_d2=null==(_c2=options.args[0])?void 0:_c2.includes("b"))||_d2}))}}),defineFunction(["vphantom"],"{:auto}",{createAtom:function(options){return new PhantomAtom(__spreadProps(__spreadValues({},options),{body:argAtoms(options.args[0]),isInvisible:!0,smashWidth:!0}))}}),defineFunction(["hphantom"],"{:auto}",{createAtom:function(options){return new PhantomAtom(__spreadProps(__spreadValues({},options),{body:argAtoms(options.args[0]),isInvisible:!0,smashHeight:!0,smashDepth:!0}))}}),defineFunction(["phantom"],"{:auto}",{createAtom:function(options){return new PhantomAtom(__spreadProps(__spreadValues({},options),{body:argAtoms(options.args[0]),isInvisible:!0}))}}),defineFunction("not","{:math}",{createAtom:function(options){var body=argAtoms(options.args[0]);return 0===body.length?new Atom(__spreadProps(__spreadValues({},options),{type:"mrel",value:""})):new Atom(__spreadProps(__spreadValues({},options),{body:[new OverlapAtom(__spreadProps(__spreadValues({},options),{body:"",align:"right"}))].concat(_toConsumableArray(body)),captureSelection:!0}))},serialize:function(atom,options){var arg=atom.args[0],isGroup=arg&&"object"===_typeof(arg)&&"group"in arg;return""!==atom.value?isGroup?"\\not{".concat(Atom.serialize(arg.group,options),"}"):"\\not".concat(Atom.serialize(arg,options)):isGroup?"\\not{}":"\\not"},render:function(atom,context){if(atom.value)return atom.createBox(context);var type=atom.args[0]&&"object"===_typeof(atom.args[0])&&"group"in atom.args[0]?"ord":atomsBoxType(argAtoms(atom.args[0])),box=Atom.createBox(context,atom.body,{type:type});return atom.caret&&(box.caret=atom.caret),atom.bind(context,box)}}),defineFunction(["ne","neq"],"",{createAtom:function(options){return new Atom(__spreadProps(__spreadValues({},options),{type:"mrel",body:[new OverlapAtom(__spreadProps(__spreadValues({},options),{body:"",align:"right",boxType:"rel"})),new Atom(__spreadProps(__spreadValues({},options),{value:"="}))],captureSelection:!0}))},serialize:function(atom){return atom.command}}),defineFunction("rlap","{:auto}",{createAtom:function(options){return new OverlapAtom(__spreadProps(__spreadValues({},options),{body:argAtoms(options.args[0]),align:"right"}))}}),defineFunction("llap","{:auto}",{createAtom:function(options){return new OverlapAtom(__spreadProps(__spreadValues({},options),{body:argAtoms(options.args[0]),align:"left"}))}}),defineFunction("mathrlap","{:math}",{createAtom:function(options){return new OverlapAtom(__spreadProps(__spreadValues({},options),{body:argAtoms(options.args[0]),align:"left"}))}}),defineFunction("mathllap","{:math}",{createAtom:function(options){return new OverlapAtom(__spreadProps(__spreadValues({},options),{body:argAtoms(options.args[0]),align:"left"}))}}),defineFunction("raisebox","{:value}{:text}",{createAtom:function(options){var _a3;return new BoxAtom(__spreadProps(__spreadValues({},options),{body:argAtoms(options.args[1]),padding:{dimension:0},offset:null!=(_a3=options.args[0])?_a3:{dimension:0}}))},serialize:function(atom,options){var _a3;return latexCommand("\\raisebox",null!=(_a3=serializeLatexValue(atom.offset))?_a3:"0pt",atom.bodyToLatex(options))}}),defineFunction("raise","{:value}{:auto}",{createAtom:function(options){var _a3;return new BoxAtom(__spreadProps(__spreadValues({},options),{body:argAtoms(options.args[1]),padding:{dimension:0},offset:null!=(_a3=options.args[0])?_a3:{dimension:0}}))},serialize:function(atom,options){var _a3;return latexCommand("\\raise",null!=(_a3=serializeLatexValue(atom.offset))?_a3:"0pt",atom.bodyToLatex(options))}}),defineFunction("lower","{:value}{:auto}",{createAtom:function(options){var _a3;return new BoxAtom(__spreadProps(__spreadValues({},options),{body:argAtoms(options.args[1]),padding:{dimension:0},offset:null!=(_a3=multiplyLatexValue(options.args[0],-1))?_a3:{dimension:0}}))},serialize:function(atom,options){var _a3,_b3;return latexCommand("\\lower",null!=(_b3=serializeLatexValue(multiplyLatexValue(null!=(_a3=atom.offset)?_a3:{dimension:0},-1)))?_b3:"0pt",atom.bodyToLatex(options))}}),newSymbols("0123456789/@.?!"),newSymbolRange(65,90),newSymbolRange(97,122),newSymbols([["\\forall",8704],["\\exists",8707],["\\nexists",8708,"mord","ams"],["\\mid",8739,"mrel"],["\\top",8868],["\\bot",8869]]),newSymbols([["\\sharp",9839],["\\flat",9837],["\\natural",9838],["\\#",35],["\\&",38],["\\clubsuit",9827],["\\heartsuit",9825],["\\spadesuit",9824],["\\diamondsuit",9826],["\\parallelogram",9649]]),newSymbols([["\\backslash",92],["\\nabla",8711],["\\partial",8706],["\\ell",8467],["\\hbar",8463],["\\Q",81,"mord","double-struck"],["\\C",67,"mord","double-struck"],["\\P",80,"mord","double-struck"],["\\pounds",163],["\\euro",8364]]),newSymbols([["\\rightarrow",8594],["\\to",8594],["\\leftarrow",8592],["\\gets",8592],["\\Rightarrow",8658],["\\Leftarrow",8656],["\\longrightarrow",10230],["\\longleftarrow",10229],["\\Longrightarrow",10233],["\\implies",10233],["\\Longleftarrow",10232],["\\impliedby",10232],["\\longleftrightarrow",10231],["\\biconditional",10231],["\\Longleftrightarrow",10234],["\\mapsto",8614],["\\longmapsto",10236],["\\uparrow",8593],["\\downarrow",8595],["\\Uparrow",8657],["\\Downarrow",8659],["\\updownarrow",8597],["\\Updownarrow",8661],["\\hookrightarrow",8618],["\\hookleftarrow",8617],["\\rightharpoonup",8640],["\\leftharpoonup",8636],["\\rightharpoondown",8641],["\\leftharpoondown",8637],["\\searrow",8600],["\\nearrow",8599],["\\swarrow",8601],["\\nwarrow",8598],["\\originalof",8886],["\\laplace",8886],["\\imageof",8887],["\\Laplace",8887]],"mrel"),newSymbols([["\\lbrace",123,"mopen"],["\\rbrace",125,"mclose"],["\\lparen",40,"mopen"],["\\rparen",41,"mclose"],["\\langle",10216,"mopen"],["\\rangle",10217,"mclose"],["\\lfloor",8970,"mopen"],["\\rfloor",8971,"mclose"],["\\lceil",8968,"mopen"],["\\rceil",8969,"mclose"],["\\vert",8739],["\\lvert",8739,"mopen"],["\\rvert",8739,"mclose"],["\\|",8741],["\\Vert",8741],["\\mVert",8741],["\\lVert",8741,"mopen"],["\\rVert",8741,"mclose"],["\\lbrack",91,"mopen"],["\\rbrack",93,"mclose"],["\\{",123,"mopen"],["\\}",125,"mclose"],["(",40,"mopen"],[")",41,"mclose"],["[",91,"mopen"],["]",93,"mclose"],["\\ulcorner",9484,"mopen","ams"],["\\urcorner",9488,"mclose","ams"],["\\llcorner",9492,"mopen","ams"],["\\lrcorner",9496,"mclose","ams"],["\\lgroup",10222,"mopen"],["\\rgroup",10223,"mclose"],["\\lmoustache",9136,"mopen"],["\\rmoustache",9137,"mclose"]]),newSymbols([["\\dashrightarrow",8674],["\\dashleftarrow",8672],["\\Rrightarrow",8667],["\\Lleftarrow",8666],["\\leftrightarrows",8646],["\\rightleftarrows",8644],["\\curvearrowright",8631],["\\curvearrowleft",8630],["\\rightrightarrows",8649],["\\leftleftarrows",8647],["\\upuparrows",8648],["\\downdownarrows",8650],["\\vartriangle",9651],["\\triangleq",8796],["\\vartriangleleft",8882],["\\trianglelefteq",8884],["\\ntriangleleft",8938],["\\ntrianglelefteq",8940],["\\vartriangleright",8883],["\\trianglerighteq",8885],["\\ntriangleright",8939],["\\ntrianglerighteq",8941],["\\blacktriangleleft",9664],["\\blacktriangleright",9654],["\\leftarrowtail",8610],["\\rightarrowtail",8611],["\\looparrowright",8620],["\\looparrowleft",8619],["\\twoheadleftarrow",8606],["\\twoheadrightarrow",8608],["\\twoheadrightarrowtail",10518],["\\rightleftharpoons",8652],["\\leftrightharpoons",8651],["\\Rsh",8625],["\\Lsh",8624],["\\circlearrowright",8635],["\\circlearrowleft",8634],["\\restriction",8638],["\\upharpoonright",8638],["\\upharpoonleft",8639],["\\downharpoonright",8642],["\\downharpoonleft",8643],["\\rightsquigarrow",8669],["\\leadsto",8669],["\\leftrightsquigarrow",8621],["\\multimap",8888],["\\nleftarrow",8602],["\\nrightarrow",8603],["\\nRightarrow",8655],["\\nLeftarrow",8653],["\\nleftrightarrow",8622],["\\nLeftrightarrow",8654],["\\nvrightarrow",8696],["\\nvtwoheadrightarrow",10496],["\\nvrightarrowtail",10516],["\\nvtwoheadrightarrowtail",10519],["\\shortparallel",8741],["\\nless",8814],["\\nleqslant",57360],["\\lneq",10887],["\\lneqq",8808],["\\nleqq",57361],["\\lvertneqq",57356],["\\lnsim",8934],["\\lnapprox",10889],["\\nprec",8832],["\\npreceq",8928],["\\precnsim",8936],["\\precnapprox",10937],["\\nsim",8769],["\\nshortmid",57350],["\\nmid",8740],["\\nvdash",8876],["\\nvDash",8877],["\\ngtr",8815],["\\ngeqslant",57359],["\\ngeqq",57358],["\\gneq",10888],["\\gneqq",8809],["\\gvertneqq",57357],["\\gnsim",8935],["\\gnapprox",10890],["\\nsucc",8833],["\\nsucceq",8929],["\\succnsim",8937],["\\succnapprox",10938],["\\ncong",8774],["\\nshortparallel",57351],["\\nparallel",8742],["\\nVDash",8879],["\\nsupseteqq",57368],["\\supsetneq",8843],["\\varsupsetneq",57371],["\\supsetneqq",10956],["\\varsupsetneqq",57369],["\\nVdash",8878],["\\precneqq",10933],["\\succneqq",10934],["\\nsubseteqq",57366],["\\leqslant",10877],["\\geqslant",10878],["\\gtrsim",8819],["\\approxeq",8778],["\\thickapprox",8776],["\\lessapprox",10885],["\\gtrapprox",10886],["\\precapprox",10935],["\\succapprox",10936],["\\thicksim",8764],["\\succsim",8831],["\\precsim",8830],["\\backsim",8765],["\\eqsim",8770],["\\backsimeq",8909],["\\lesssim",8818],["\\nleq",8816],["\\ngeq",8817],["\\smallsmile",8995],["\\smallfrown",8994],["\\leqq",8806],["\\eqslantless",10901],["\\lll",8920],["\\lessgtr",8822],["\\lesseqgtr",8922],["\\lesseqqgtr",10891],["\\risingdotseq",8787],["\\fallingdotseq",8786],["\\subseteqq",10949],["\\Subset",8912],["\\sqsubset",8847],["\\preccurlyeq",8828],["\\curlyeqprec",8926],["\\vDash",8872],["\\Vvdash",8874],["\\bumpeq",8783],["\\Bumpeq",8782],["\\geqq",8807],["\\eqslantgtr",10902],["\\ggg",8921],["\\gtrless",8823],["\\gtreqless",8923],["\\gtreqqless",10892],["\\supseteqq",10950],["\\Supset",8913],["\\sqsupset",8848],["\\succcurlyeq",8829],["\\curlyeqsucc",8927],["\\Vdash",8873],["\\shortmid",8739],["\\between",8812],["\\pitchfork",8916],["\\varpropto",8733],["\\backepsilon",8717],["\\llless",8920],["\\gggtr",8921],["\\doteqdot",8785],["\\Doteq",8785],["\\eqcirc",8790],["\\circeq",8791],["\\therefore",8756],["\\because",8757]],"mrel","ams"),newSymbols([["+",43],["-",8722],["−",8722],["\\pm",177],["\\mp",8723],["*",8727],["\\times",215],["\\div",247],["\\divides",8739],["\\cdot",8901],["\\cap",8745],["\\cup",8746],["\\setminus",8726],["\\land",8743],["\\wedge",8743],["\\lor",8744],["\\vee",8744],["\\circ",8728],["\\bigcirc",9711],["\\bullet",8729],["\\oplus",8853],["\\ominus",8854],["\\otimes",8855],["\\odot",8857],["\\oslash",8856],["\\bigtriangleup",9651],["\\bigtriangledown",9661],["\\triangleleft",9667],["\\triangleright",9657],["\\And",38],["\\dagger",8224],["\\dag",8224],["\\ddag",8225],["\\ddagger",8225],["\\ast",8727],["\\star",8902],["\\bigstar",9733],["\\diamond",8900]],"mbin"),newSymbols([["\\lhd",8882],["\\rhd",8883],["\\lessdot",8918],["\\gtrdot",8919],["\\ltimes",8905],["\\rtimes",8906],["\\leftthreetimes",8907],["\\rightthreetimes",8908],["\\intercal",8890],["\\dotplus",8724],["\\doublebarwedge",10846],["\\divideontimes",8903],["\\centerdot",8901],["\\smallsetminus",8726],["\\barwedge",8892],["\\veebar",8891],["\\nor",8891],["\\curlywedge",8911],["\\curlyvee",8910],["\\boxminus",8863],["\\boxplus",8862],["\\boxtimes",8864],["\\boxdot",8865],["\\circleddash",8861],["\\circledast",8859],["\\circledcirc",8858],["\\unlhd",8884],["\\unrhd",8885]],"mbin","ams"),newSymbols([["\\surd",8730],["\\infty",8734],["\\prime",8242],["\\doubleprime",8243],["\\angle",8736],["`",8216],["\\$",36],["\\%",37],["\\_",95],["\\alpha",945],["\\beta",946],["\\gamma",947],["\\delta",948],["\\epsilon",1013],["\\varepsilon",949],["\\zeta",950],["\\eta",951],["\\theta",952],["\\vartheta",977],["\\iota",953],["\\kappa",954],["\\varkappa",1008,"mord","ams"],["\\lambda",955],["\\mu",956],["\\nu",957],["\\xi",958],["\\omicron",111],["\\pi",960],["\\varpi",982],["\\rho",961],["\\varrho",1009],["\\sigma",963],["\\varsigma",962],["\\tau",964],["\\phi",981],["\\varphi",966],["\\upsilon",965],["\\chi",967],["\\psi",968],["\\omega",969],["\\Gamma",915],["\\Delta",916],["\\Theta",920],["\\Lambda",923],["\\Xi",926],["\\Pi",928],["\\Sigma",931],["\\Upsilon",933],["\\Phi",934],["\\Psi",936],["\\Omega",937],["\\digamma",989,"mord","ams"],["\\emptyset",8709]]),newSymbols([["=",61],["<",60],["\\lt",60],[">",62],["\\gt",62],["\\le",8804],["\\leq",8804],["\\ge",8805],["\\geq",8805],["\\ll",8810],["\\gg",8811],["\\coloneq",8788],["\\measeq",8797],["\\eqdef",8798],["\\questeq",8799],[":",58],["\\cong",8773],["\\equiv",8801],["\\prec",8826],["\\preceq",10927],["\\succ",8827],["\\succeq",10928],["\\perp",8869],["\\propto",8733],["\\Colon",8759],["\\smile",8995],["\\frown",8994],["\\sim",8764],["\\doteq",8784],["\\bowtie",8904],["\\Join",8904],["\\asymp",8781],["\\sqsubseteq",8849],["\\sqsupseteq",8850],["\\approx",8776],["\\~",126],["\\leftrightarrow",8596],["\\Leftrightarrow",8660],["\\models",8872],["\\vdash",8866],["\\dashv",8867],["\\roundimplies",10608],["\\in",8712],["\\notin",8713],["\\ni",8715],["\\owns",8715],["\\subset",8834],["\\supset",8835],["\\subseteq",8838],["\\supseteq",8839],["\\differencedelta",8710],["\\mvert",8739],["\\parallel",8741],["\\simeq",8771]],"mrel"),newSymbols([["\\lnot",172],["\\neg",172],["\\triangle",9651],["\\subsetneq",8842],["\\varsubsetneq",57370],["\\subsetneqq",10955],["\\varsubsetneqq",57367],["\\nsubset",8836],["\\nsupset",8837],["\\nsubseteq",8840],["\\nsupseteq",8841]],"mrel","ams"),newSymbols([["\\wp",8472],["\\aleph",8501]]),newSymbols([["\\blacktriangle",9650],["\\hslash",8463],["\\Finv",8498],["\\Game",8513],["\\eth",240],["\\mho",8487],["\\Bbbk",107],["\\yen",165],["\\square",9633],["\\Box",9633],["\\blacksquare",9632],["\\circledS",9416],["\\circledR",174],["\\triangledown",9661],["\\blacktriangledown",9660],["\\checkmark",10003],["\\diagup",9585],["\\measuredangle",8737],["\\sphericalangle",8738],["\\backprime",8245],["\\backdoubleprime",8246],["\\Diamond",9674],["\\lozenge",9674],["\\blacklozenge",10731],["\\varnothing",8709],["\\complement",8705],["\\maltese",10016],["\\beth",8502],["\\daleth",8504],["\\gimel",8503]],"mord","ams"),newSymbols([["\\ ",160],["~",160]],"space"),defineFunction(["!",",",":",";","enskip","enspace","quad","qquad"],"",{createAtom:function(options){return new SpacingAtom(options)}}),defineFunction("space","",{createAtom:function(options){return new SpacingAtom(options)}}),newSymbols([["\\colon",58],["\\cdotp",8901],["\\vdots",8942,"mord"],["\\ldotp",46],[",",44],[";",59]],"mpunct"),newSymbols([["\\cdots",8943],["\\ddots",8945],["\\ldots",8230],["\\mathellipsis",8230]],"minner"),newSymbols([["\\/",47],["|",8739,"mord"],["\\imath",305],["\\jmath",567],["\\degree",176],["'",8242],['"',8221]]),register2({undo:function(mathfield){return mathfield.undo(),!0},redo:function(mathfield){return mathfield.redo(),!0},scrollIntoView:function(mathfield){return mathfield.scrollIntoView(),!0},scrollToStart:function(mathfield){return mathfield.field.scroll(0,0),!0},scrollToEnd:function(mathfield){var fieldBounds=mathfield.field.getBoundingClientRect();return mathfield.field.scroll(fieldBounds.left-window.scrollX,0),!0},toggleKeystrokeCaption:function(mathfield){return mathfield.keystrokeCaptionVisible=!mathfield.keystrokeCaptionVisible,mathfield.keystrokeCaptionVisible?createKeystrokeCaption().innerHTML="":getSharedElement("mathlive-keystroke-caption-panel").style.visibility="hidden",!1},plonk:function(mathfield){return mathfield.model.announce("plonk"),!0},switchMode:function(mathfield,mode,prefix,suffix){return mathfield.switchMode(mode,prefix,suffix),!0},insert:function(mathfield,s,options){return mathfield.insert(s,options)},typedText:function(mathfield,text,options){return _onInput(mathfield,text,options),!0},insertDecimalSeparator:function(mathfield){var model=mathfield.model;return"math"===model.mode&&","===window.MathfieldElement.decimalSeparator&&model.at(Math.max(model.position,model.anchor)).isDigit()?(mathfield.insert("{,}",{format:"latex"}),mathfield.snapshot("insert-mord"),!0):(mathfield.insert("."),!0)},commit:function(mathfield){var _a3;return contentWillChange(mathfield.model,{inputType:"insertLineBreak"})&&(null==(_a3=mathfield.host)||_a3.dispatchEvent(new Event("change",{bubbles:!0,composed:!0})),contentDidChange(mathfield.model,{inputType:"insertLineBreak"})),!0},insertPrompt:function(mathfield,id,options){for(var promptIds=mathfield.getPrompts(),prospectiveId="prompt-"+Date.now().toString(36).slice(-2)+Math.floor(1e5*Math.random()).toString(36),i=0;promptIds.includes(prospectiveId)&&i<100;){if(99===i)return console.error("could not find a unique ID after 100 tries"),!1;prospectiveId="prompt-"+Date.now().toString(36).slice(-2)+Math.floor(1e5*Math.random()).toString(36),i++}return mathfield.insert("\\placeholder[".concat(null!=id?id:prospectiveId,"]{}"),options),!0}}),register2({copyToClipboard:function(mathfield){return mathfield.focus(),mathfield.model.selectionIsCollapsed&&mathfield.select(),"queryCommandSupported"in document&&document.queryCommandSupported("copy")?document.execCommand("copy"):mathfield.element.querySelector(".ML__keyboard-sink").dispatchEvent(new ClipboardEvent("copy",{bubbles:!0,composed:!0})),!1}},{target:"mathfield"}),register2({cutToClipboard:function(mathfield){return mathfield.focus(),"queryCommandSupported"in document&&document.queryCommandSupported("cut")?document.execCommand("cut"):mathfield.element.querySelector(".ML__keyboard-sink").dispatchEvent(new ClipboardEvent("cut",{bubbles:!0,composed:!0})),!0},pasteFromClipboard:function(mathfield){return mathfield.focus(),"queryCommandSupported"in document&&document.queryCommandSupported("paste")?(document.execCommand("paste"),!0):(navigator.clipboard.readText().then((function(text){text&&contentWillChange(mathfield.model,{inputType:"insertFromPaste",data:text})?(mathfield.stopCoalescingUndo(),mathfield.stopRecording(),mathfield.insert(text,{mode:mathfield.model.mode})&&(updateAutocomplete(mathfield),mathfield.startRecording(),mathfield.snapshot("paste"),contentDidChange(mathfield.model,{inputType:"insertFromPaste"}),requestUpdate(mathfield))):mathfield.model.announce("plonk"),mathfield.startRecording()})),!0)}},{target:"mathfield",canUndo:!0,changeContent:!0,changeSelection:!0}),register2({applyStyle:function(mathfield,inStyle){mathfield.flushInlineShortcutBuffer(),mathfield.stopCoalescingUndo();var style=validateStyle(mathfield,inStyle),model=mathfield.model;return model.selectionIsCollapsed?(mathfield.style.fontSeries&&style.fontSeries===mathfield.style.fontSeries&&(style.fontSeries="auto"),style.fontShape&&style.fontShape===mathfield.style.fontShape&&(style.fontShape="auto"),style.color&&style.color===mathfield.style.color&&(style.color="none"),style.backgroundColor&&style.backgroundColor===mathfield.style.backgroundColor&&(style.backgroundColor="none"),style.fontSize&&style.fontSize===mathfield.style.fontSize&&(style.fontSize="auto"),mathfield.style=__spreadValues(__spreadValues({},mathfield.style),style)):mathfield.model.deferNotifications({content:!0,type:"insertText"},(function(){model.selection.ranges.forEach((function(range2){return _applyStyle(model,range2,style,{operation:"toggle"})})),mathfield.snapshot("style-change")})),!0}},{target:"mathfield",canUndo:!0,changeContent:!0}),register2({selectGroup:function(model){var result=_selectGroup(model);return result||model.announce("plonk"),result},selectAll:function(model){return model.setSelection(0,model.lastOffset)},extendSelectionForward:function(model){return move(model,"forward",{extend:!0})},extendSelectionBackward:function(model){return move(model,"backward",{extend:!0})},extendToNextWord:function(model){return skip(model,"forward",{extend:!0})},extendToPreviousWord:function(model){return skip(model,"backward",{extend:!0})},extendSelectionUpward:function(model){return move(model,"upward",{extend:!0})},extendSelectionDownward:function(model){return move(model,"downward",{extend:!0})},extendToNextBoundary:function(model){return skip(model,"forward",{extend:!0})},extendToPreviousBoundary:function(model){return skip(model,"backward",{extend:!0})},extendToGroupStart:function(model){var result=model.setSelection(model.anchor,model.offsetOf(model.at(model.position).firstSibling));return result||model.announce("plonk"),result},extendToGroupEnd:function(model){var result=model.setSelection(model.anchor,model.offsetOf(model.at(model.position).lastSibling));return result||model.announce("plonk"),result},extendToMathFieldStart:function(model){var result=model.setSelection(model.anchor,0);return result||model.announce("plonk"),result},extendToMathFieldEnd:function(model){var result=model.setSelection(model.anchor,model.lastOffset);return result||model.announce("plonk"),result}},{target:"model",changeSelection:!0});var gLastTap=null,gTapCount=0;function isPointerEvent(evt){return evt instanceof PointerEvent}function onPointerDown(mathfield,evt){var _a3;mathfield.atomBoundsCache=new Map;var anchor,that=mathfield,trackingPointer=!1,dirty="none";if(!(evt.buttons>1)){var scrollLeft=!1,scrollRight=!1,anchorX=evt.clientX,anchorY=evt.clientY,anchorTime=Date.now(),field=that.field,scrollInterval=setInterval((function(){scrollLeft?field.scroll({top:0,left:field.scrollLeft-16}):scrollRight&&field.scroll({top:0,left:field.scrollLeft+16})}),32);gLastTap&&Math.abs(gLastTap.x-anchorX)<5&&Math.abs(gLastTap.y-anchorY)<5&&Date.now()<gLastTap.time+500?(gTapCount+=1,gLastTap.time=anchorTime):(gLastTap={x:anchorX,y:anchorY,time:anchorTime},gTapCount=1);var bounds=field.getBoundingClientRect();if(anchorX>=bounds.left&&anchorX<=bounds.right&&anchorY>=bounds.top&&anchorY<=bounds.bottom){if(mathfield.hasFocus()||(dirty="none",mathfield.focus({preventScroll:!0})),mathfield.flushInlineShortcutBuffer(),mathfield.smartModeSuppressed=!1,mathfield.adoptStyle="left",(anchor=_offsetFromPoint(mathfield,anchorX,anchorY,{bias:0}))>=0){if(mathfield.element.classList.add("tracking"),evt.shiftKey){var wasCollapsed=mathfield.model.selectionIsCollapsed;mathfield.model.extendSelectionTo(mathfield.model.anchor,anchor),dirty=acceptCommandSuggestion(mathfield.model)||wasCollapsed?"all":"selection"}else"placeholder"===mathfield.model.at(anchor).type?(mathfield.model.setSelection(anchor-1,anchor),dirty="selection"):"placeholder"===(null==(_a3=mathfield.model.at(anchor).rightSibling)?void 0:_a3.type)?(mathfield.model.setSelection(anchor,anchor+1),dirty="selection"):(mathfield.model.position=anchor,dirty=acceptCommandSuggestion(mathfield.model)?"all":"selection");mathfield.style={},3===evt.detail||gTapCount>2?(endPointerTracking(evt),3!==evt.detail&&3!==gTapCount||(mathfield.model.selection={ranges:[[0,mathfield.model.lastOffset]]},dirty="all")):trackingPointer||(trackingPointer=!0,"PointerEvent"in window?(on(field,"pointermove",onPointerMove),on(field,"pointerup pointercancel",endPointerTracking),evt instanceof PointerEvent&&field.setPointerCapture(evt.pointerId)):(on(window,"blur",endPointerTracking),on(window,"mousemove",onPointerMove),on(window,"mouseup",endPointerTracking)),2!==evt.detail&&2!==gTapCount||(_selectGroup(mathfield.model),dirty="all"))}}else gLastTap=null;mathfield.stopCoalescingUndo(),"none"!==dirty&&(mathfield.model.selectionIsCollapsed&&(dirty="all"),requestUpdate(mathfield)),evt.preventDefault()}function endPointerTracking(evt2){"PointerEvent"in window?(off(field,"pointermove",onPointerMove),off(field,"pointerup pointercancel",endPointerTracking),evt2 instanceof PointerEvent&&field.releasePointerCapture(evt2.pointerId)):(off(window,"mousemove",onPointerMove),off(window,"mouseup blur",endPointerTracking)),trackingPointer=!1,clearInterval(scrollInterval),mathfield.element.classList.remove("tracking"),evt2&&evt2.preventDefault()}function onPointerMove(evt2){if(that.hasFocus()){var x=evt2.clientX,y=evt2.clientY,hysteresis=isPointerEvent(evt2)&&"touch"===evt2.pointerType?20:5;if(Date.now()<anchorTime+500&&Math.abs(anchorX-x)<hysteresis&&Math.abs(anchorY-y)<hysteresis)return evt2.preventDefault(),void evt2.stopPropagation();var fieldBounds=field.getBoundingClientRect();scrollRight=x>fieldBounds.right,scrollLeft=x<fieldBounds.left;var actualAnchor=anchor;isPointerEvent(evt2)&&(evt2.isPrimary||(actualAnchor=_offsetFromPoint(that,evt2.clientX,evt2.clientY,{bias:0})));var focus=_offsetFromPoint(that,x,y,{bias:x<=anchorX?x===anchorX?0:-1:1});actualAnchor>=0&&focus>=0&&(that.model.extendSelectionTo(actualAnchor,focus),requestUpdate(mathfield)),evt2.preventDefault(),evt2.stopPropagation()}else endPointerTracking(null)}}function distance(x,y,r){if(x>=r.left&&x<=r.right&&y>=r.top&&y<=r.bottom)return 0;var dx=x-(r.left+r.right)/2,dy=y-(r.top+r.bottom)/2;return dx*dx+dy*dy}function nearestAtomFromPointRecursive(mathfield,cache,atom,x,y){if(!atom.id)return[1/0,null];if(cache.has(atom.id))return cache.get(atom.id);var bounds=getAtomBounds(mathfield,atom);if(!bounds)return[1/0,null];var result=[1/0,null];if(atom.hasChildren&&!atom.captureSelection&&x>=bounds.left&&x<=bounds.right){var _step147,_iterator147=_createForOfIteratorHelper(atom.children);try{for(_iterator147.s();!(_step147=_iterator147.n()).done;){var r=nearestAtomFromPointRecursive(mathfield,cache,_step147.value,x,y);r[0]<=result[0]&&(result=r)}}catch(err){_iterator147.e(err)}finally{_iterator147.f()}}return result[1]||(result=[distance(x,y,bounds),atom]),cache.set(atom.id,result),result}function nearestAtomFromPoint(mathfield,x,y){return _slicedToArray(nearestAtomFromPointRecursive(mathfield,new Map,mathfield.model.root,x,y),2)[1]}function _offsetFromPoint(mathfield,x,y,options){var _a3,_b3,bounds=null==(_a3=mathfield.fieldContent)?void 0:_a3.getBoundingClientRect();if(!bounds)return 0;if(x>bounds.right||y>bounds.bottom+8)return mathfield.model.lastOffset;if(x<bounds.left||y<bounds.top-8)return 0;(options=null!=options?options:{}).bias=null!=(_b3=options.bias)?_b3:0;for(var atom=nearestAtomFromPoint(mathfield,x,y),parents=[],parent=atom;parent;)parents.unshift(parent),parent=parent.parent;for(var _i29=0,_parents=parents;_i29<_parents.length;_i29++){var x2=_parents[_i29];if(x2.captureSelection){atom=x2;break}}var result=mathfield.model.offsetOf(atom);if(result<0)return-1;if(atom.leftSibling)if(0===options.bias&&"placeholder"!==atom.type){var bounds2=getAtomBounds(mathfield,atom);bounds2&&x<(bounds2.left+bounds2.right)/2&&(result=mathfield.model.offsetOf(atom.leftSibling))}else options.bias<0&&(result=mathfield.model.offsetOf(atom.leftSibling));return result}function removeParen(atoms){if(!atoms)return null;if(console.assert("first"===atoms[0].type),atoms.length>1)return null;var atom=atoms[0];return atom instanceof LeftRightAtom&&"("===atom.leftDelim&&")"===atom.rightDelim?atom.removeBranch("body"):null}function simplifyParen(atoms){if(atoms){for(var i=0;atoms[i];i++){var atom=atoms[i];if(atom instanceof LeftRightAtom&&"("===atom.leftDelim){for(var genFracCount=0,genFracIndex=0,nonGenFracCount=0,j=0;atom.body[j];j++)"genfrac"===atom.body[j].type&&(genFracCount++,genFracIndex=j),nonGenFracCount++;0===nonGenFracCount&&1===genFracCount&&(atoms[i]=atom.body[genFracIndex])}}var _step149,_iterator149=_createForOfIteratorHelper(atoms);try{for(_iterator149.s();!(_step149=_iterator149.n()).done;){var _step150,_atom12=_step149.value,_iterator150=_createForOfIteratorHelper(_atom12.branches);try{for(_iterator150.s();!(_step150=_iterator150.n()).done;){var branch=_step150.value;if(!_atom12.hasEmptyBranch(branch)){simplifyParen(_atom12.branch(branch));var newChildren=removeParen(_atom12.branch(branch));newChildren&&_atom12.setChildren(newChildren,branch)}}}catch(err){_iterator150.e(err)}finally{_iterator150.f()}if(_atom12 instanceof ArrayAtom){var _step151,_iterator151=_createForOfIteratorHelper(_atom12.cells);try{for(_iterator151.s();!(_step151=_iterator151.n()).done;)simplifyParen(_step151.value)}catch(err){_iterator151.e(err)}finally{_iterator151.f()}}}}catch(err){_iterator149.e(err)}finally{_iterator149.f()}}}function isImplicitArg(atom){return!(!atom.isDigit()&&(!atom.type||!/^(mord|surd|msubsup|leftright|mop|mclose)$/.test(atom.type)||atom.isExtensibleSymbol||atom.isFunction))}new(function(_ModeEditor3){_inherits(MathModeEditor,_ModeEditor3);var _super34=_createSuper(MathModeEditor);function MathModeEditor(){return _classCallCheck(this,MathModeEditor),_super34.call(this,"math")}return _createClass(MathModeEditor,[{key:"onPaste",value:function(mathfield,data){if(!data)return!1;if(!contentWillChange(mathfield.model,{data:"string"==typeof data?data:null,dataTransfer:"string"==typeof data?null:data,inputType:"insertFromPaste"}))return!1;var text="",format="auto",json="string"!=typeof data?data.getData("application/json+mathlive"):"";if(json)try{var atomJson=JSON.parse(json);if(atomJson&&Array.isArray(atomJson)){mathfield.snapshot();var atoms=_fromJson(atomJson),model=mathfield.model;model.selectionIsCollapsed||model.deleteAtoms(range(model.selection));var cursor=model.at(model.position);if(cursor.parent instanceof ArrayAtom){console.assert(void 0!==cursor.parentBranch);var columns=[],buffer=[];"first"===atoms[0].type&&atoms.shift(),"first"===atoms[atoms.length-1].type&&atoms.pop();var _step148,_iterator148=_createForOfIteratorHelper(atoms);try{for(_iterator148.s();!(_step148=_iterator148.n()).done;){var atom=_step148.value;"first"===atom.type&&buffer.length>0?(columns.push(buffer),buffer=[atom]):buffer.push(atom)}}catch(err){_iterator148.e(err)}finally{_iterator148.f()}buffer.length>0&&columns.push(buffer);for(var currentRow=Number(cursor.parentBranch[0]),currentColumn=Number(cursor.parentBranch[1]),maxColumns=cursor.parent.maxColumns;cursor.parent.colCount-currentColumn<columns.length&&cursor.parent.colCount<maxColumns;)cursor.parent.addColumn();cursor.parent.addChildrenAfter(columns[0],cursor);for(var i=1;i<columns.length;i++)++currentColumn>=maxColumns&&(currentColumn=0,cursor.parent.addRowAfter(currentRow),currentRow++),cursor.parent.setCell(currentRow,currentColumn,columns[i])}else cursor.parent.addChildrenAfter(atoms.filter((function(a){return"first"!==a.type})),cursor);return model.position=model.offsetOf(atoms[atoms.length-1]),contentDidChange(model,{inputType:"insertFromPaste"}),requestUpdate(mathfield),!0}}catch(e){}if((json="string"!=typeof data?data.getData("application/json"):"")&&window.MathfieldElement.computeEngine)try{var expr=JSON.parse(json);if("object"===_typeof(expr)&&"latex"in expr&&expr.latex&&(text=expr.latex),!text){var box=window.MathfieldElement.computeEngine.box(expr);box&&!box.has("Error")&&(text=box.latex)}text||(format="latex")}catch(e){}if(text||"string"==typeof data||(text=data.getData("application/x-latex"))&&(format="latex"),text||(text="string"==typeof data?data:data.getData("text/plain")),text){var wasLatex,_trimModeShiftCommand4=_slicedToArray(trimModeShiftCommand(text),2);return wasLatex=_trimModeShiftCommand4[0],text=_trimModeShiftCommand4[1],"auto"===format&&wasLatex&&(format="latex"),mathfield.stopCoalescingUndo(),mathfield.stopRecording(),this.insert(mathfield.model,text,{format:format})&&(mathfield.startRecording(),mathfield.snapshot("paste"),requestUpdate(mathfield)),mathfield.startRecording(),!0}return!1}},{key:"insert",value:function(model,input,options){var _a3,_b3,data="string"==typeof input?input:null!=(_b3=null==(_a3=window.MathfieldElement.computeEngine)?void 0:_a3.box(input).latex)?_b3:"";if(!options.silenceNotifications&&!contentWillChange(model,{data:data,inputType:"insertText"}))return!1;options.insertionMode||(options.insertionMode="replaceSelection"),options.selectionMode||(options.selectionMode="placeholder"),options.format||(options.format="auto");var silenceNotifications=model.silenceNotifications;options.silenceNotifications&&(model.silenceNotifications=!0);var contentWasChanging=model.silenceNotifications;model.silenceNotifications=!0;var args={};if(args[0]="replaceAll"===options.insertionMode?"":model.getValue(model.selection,"latex-unstyled"),args["?"]="\\placeholder{}",args["@"]=args["?"],"replaceSelection"!==options.insertionMode||model.selectionIsCollapsed?"replaceAll"===options.insertionMode?(model.root.setChildren([],"body"),model.position=0):"insertBefore"===options.insertionMode?model.collapseSelection("backward"):"insertAfter"===options.insertionMode&&model.collapseSelection("forward"):model.deleteAtoms(range(model.selection)),model.at(model.position).isLastSibling||"placeholder"!==model.at(model.position+1).type?"placeholder"===model.at(model.position).type&&model.deleteAtoms([model.position-1,model.position]):model.deleteAtoms([model.position,model.position+1]),args[0])args["@"]=args[0];else if("string"==typeof input&&/(^|[^\\])#@/.test(input)){var offset=function(model){var atom=model.at(model.position);if("text"===atom.mode){for(;!atom.isFirstSibling&&"text"===atom.mode;)atom=atom.leftSibling;return model.offsetOf(atom)}var atomAtCursor=atom,afterDelim=!1;if("mclose"===atom.type){for(var delim=LEFT_DELIM[atom.value];!atom.isFirstSibling&&("mopen"!==atom.type||atom.value!==delim);)atom=atom.leftSibling;atom.isFirstSibling||(atom=atom.leftSibling),afterDelim=!0}else"leftright"===atom.type&&(atom=atom.leftSibling,afterDelim=!0);if(afterDelim)for(;!atom.isFirstSibling&&(atom.isFunction||isImplicitArg(atom));)atom=atom.leftSibling;else for(var delimiterStack=[];!atom.isFirstSibling&&(isImplicitArg(atom)||delimiterStack.length>0);)"mclose"===atom.type&&delimiterStack.unshift(atom.value),"mopen"===atom.type&&delimiterStack.length>0&&atom.value===LEFT_DELIM[delimiterStack[0]]&&delimiterStack.shift(),atom=atom.leftSibling;return atomAtCursor===atom?-1:model.offsetOf(atom)}(model);offset>=0&&(args["@"]=model.getValue(offset,model.position,"latex-unstyled"),model.deleteAtoms([offset,model.position]))}args[0]||(args[0]=args["?"]);var usedArg=!1,_convertStringToAtoms=function(model,s,args,options){var _a3,format=void 0,result=[];if("string"!=typeof s||"math-json"===options.format){var ce=window.MathfieldElement.computeEngine;if(!ce)return["math-json",[]];var _ref6=["latex",ce.box(s).latex];format=_ref6[0],result=parseLatex(s=_ref6[1],{context:model.mathfield.context})}else if("string"==typeof s&&"ascii-math"===options.format){var _parseMathString2=_slicedToArray(parseMathString(s,{format:"ascii-math",inlineShortcuts:model.mathfield.options.inlineShortcuts}),2);format=_parseMathString2[0],result=parseLatex(s=_parseMathString2[1],{context:model.mathfield.context}),"latex"!==format&&model.mathfield.options.removeExtraneousParentheses&&simplifyParen(result)}else if("auto"===options.format||(null==(_a3=options.format)?void 0:_a3.startsWith("latex"))){if("auto"===options.format){var _parseMathString4=_slicedToArray(parseMathString(s,{format:"auto",inlineShortcuts:model.mathfield.options.inlineShortcuts}),2);format=_parseMathString4[0],s=_parseMathString4[1]}"latex"===options.format&&(s=_slicedToArray(trimModeShiftCommand(s),2)[1]),result=parseLatex(s,{context:model.mathfield.context,args:args}),"latex"!==options.format&&model.mathfield.options.removeExtraneousParentheses&&simplifyParen(result)}return applyStyleToUnstyledAtoms(result,options.style),[null!=format?format:"latex",result]}(model,input,(function(arg){return usedArg=!0,args[arg]}),options),_convertStringToAtoms2=_slicedToArray(_convertStringToAtoms,2),format=_convertStringToAtoms2[0],newAtoms=_convertStringToAtoms2[1];if(!newAtoms)return!1;var parent=model.at(model.position).parent;if("latex"!==format&&model.mathfield.options.removeExtraneousParentheses&&parent instanceof LeftRightAtom&&"("===parent.leftDelim&&parent.hasEmptyBranch("body")&&1===newAtoms.length&&"genfrac"===newAtoms[0].type){var newParent=parent.parent,branch=parent.parentBranch;newParent.removeChild(parent),newParent.setChildren(newAtoms,branch)}var hadEmptyBody=parent.hasEmptyBranch("body"),cursor=model.at(model.position);cursor.parent.addChildrenAfter(newAtoms,cursor),"latex"===format&&"string"==typeof input&&(parent.parent||!hadEmptyBody||usedArg||(parent.verbatimLatex=input)),model.silenceNotifications=contentWasChanging;var lastNewAtom=newAtoms[newAtoms.length-1];if("placeholder"===options.selectionMode){var placeholder=newAtoms.flatMap((function(x){return[x].concat(_toConsumableArray(x.children))})).find((function(x){return"placeholder"===x.type}));if(placeholder){var placeholderOffset=model.offsetOf(placeholder);model.setSelection(placeholderOffset-1,placeholderOffset),model.announce("move")}else lastNewAtom&&(model.position=model.offsetOf(lastNewAtom))}else"before"===options.selectionMode||("after"===options.selectionMode?lastNewAtom&&(model.position=model.offsetOf(lastNewAtom)):"item"===options.selectionMode&&model.setSelection(model.anchor,model.offsetOf(lastNewAtom)));return contentDidChange(model,{data:data,inputType:"insertText"}),model.silenceNotifications=silenceNotifications,!0}}]),MathModeEditor}(ModeEditor));var TextModeEditor=function(_ModeEditor4){_inherits(TextModeEditor,_ModeEditor4);var _super35=_createSuper(TextModeEditor);function TextModeEditor(){return _classCallCheck(this,TextModeEditor),_super35.call(this,"text")}return _createClass(TextModeEditor,[{key:"onPaste",value:function(mathfield,data){if(!data)return!1;var text="string"==typeof data?data:data.getData("text/plain");return!(!text||!contentWillChange(mathfield.model,{inputType:"insertFromPaste",data:text})||(mathfield.stopCoalescingUndo(),mathfield.stopRecording(),this.insert(mathfield.model,text)&&(contentDidChange(mathfield.model,{inputType:"insertFromPaste"}),mathfield.startRecording(),mathfield.snapshot("paste"),requestUpdate(mathfield)),mathfield.startRecording(),0))}},{key:"insert",value:function(model,text){var options=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!contentWillChange(model,{data:text,inputType:"insertText"}))return!1;options.insertionMode||(options.insertionMode="replaceSelection"),options.selectionMode||(options.selectionMode="placeholder"),options.format||(options.format="auto");var silenceNotifications=model.silenceNotifications;options.silenceNotifications&&(model.silenceNotifications=!0);var contentWasChanging=model.silenceNotifications;model.silenceNotifications=!0,"replaceSelection"!==options.insertionMode||model.selectionIsCollapsed?"replaceAll"===options.insertionMode?(model.root.setChildren([],"body"),model.position=0):"insertBefore"===options.insertionMode?model.collapseSelection("backward"):"insertAfter"===options.insertionMode&&model.collapseSelection("forward"):model.deleteAtoms(range(model.selection));var newAtoms=convertStringToAtoms2(text,model.mathfield.context);if(applyStyleToUnstyledAtoms(newAtoms,options.style),!newAtoms)return!1;var cursor=model.at(model.position),lastNewAtom=cursor.parent.addChildrenAfter(newAtoms,cursor);return model.silenceNotifications=contentWasChanging,"before"===options.selectionMode||("item"===options.selectionMode?model.setSelection(model.anchor,model.offsetOf(lastNewAtom)):lastNewAtom&&(model.position=model.offsetOf(lastNewAtom))),contentDidChange(model,{data:text,inputType:"insertText"}),model.silenceNotifications=silenceNotifications,!0}}]),TextModeEditor}(ModeEditor);function convertStringToAtoms2(s,context){return parseLatex(s=(s=(s=(s=(s=(s=(s=(s=(s=(s=(s=s.replace(/\\/g,"\\textbackslash ")).replace(/#/g,"\\#")).replace(/\$/g,"\\$")).replace(/%/g,"\\%")).replace(/&/g,"\\&")).replace(/_/g,"\\_")).replace(/{/g,"\\textbraceleft ")).replace(/}/g,"\\textbraceright ")).replace(/\^/g,"\\textasciicircum ")).replace(/~/g,"\\textasciitilde ")).replace(/£/g,"\\textsterling "),{context:context,parseMode:"text"})}new TextModeEditor;var newPlus=function(x,y){return'\n  <line x1="'.concat(x+20,'" y1="').concat(y+20,'" \n    x2="').concat(x>y?x+20:180,'" \n    y2="').concat(x<y?y+20:180,'"/>\n  <svg id="plus" viewBox="0 0 40 40" x="').concat(x,'" y="').concat(y,'" width="40" height="40">\n    <circle class="cls-2" cx="20" cy="20" r="20"/>\n    <path class="font" d="m33.33,20c0,1.84-1.49,3.34-3.33,3.34h-6.67v6.66c0,1.84-1.49,3.34-3.33,3.34s-3.34-1.5-3.34-3.34v-6.66h-6.66c-1.84,0-3.34-1.5-3.34-3.34s1.5-3.33,3.34-3.33h6.66v-6.67c0-1.84,1.5-3.33,3.34-3.33s3.33,1.49,3.33,3.33v6.67h6.67c1.84,0,3.33,1.49,3.33,3.33Z"/>\n  </svg>')},newMinus=function(x,y){return'\n  <line x1="'.concat(x+20,'" y1="').concat(y+20,'" \n    x2="').concat(x>y?x+20:180,'" \n    y2="').concat(x<y?y+20:180,'"/>\n  <svg id="minus" viewBox="0 0 40 40" x="').concat(x,'" y="').concat(y,'" width="40" height="40">\n    <circle class="cls-2" cx="20" cy="20" r="20"/>\n    <path class="font" d="m33.33,20c0,1.84-1.49,3.33-3.33,3.33H10c-1.84,0-3.34-1.49-3.34-3.33s1.5-3.34,3.34-3.34h20c1.84,0,3.33,1.5,3.33,3.34Z"/>\n  </svg>')},newArrow=function(x,y,theta){return'\n  <svg id="arrow" viewBox="0 0 40 40" x="'.concat(x,'" y="').concat(y,'" width="40" height="40">\n    <circle class="cls-2" cx="20" cy="20" r="20"/>\n    <g transform="rotate(').concat(theta,')" transform-origin="20 20">\n      <path class="font" d="m17.7,7.23h4.6c.52,0,.94.42.94.94v13.82c0,.52.42.94.94.94h3.39c.83,0,1.25,1.01.66,1.6l-7.56,7.56c-.37.37-.96.37-1.32,0l-7.56-7.56c-.59-.59-.17-1.6.66-1.6h3.39c.52,0,.94-.42.94-.94v-13.82c0-.52.42-.94.94-.94Z"/>\n    </g>  \n  </svg>')},controllerSvg='\n<svg class="MLEP__array-buttons" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" \nviewBox=\n"-2 -2 '.concat(205," ").concat(205,'">\n  <rect \n      class="MLEP__array-insert-background rows"\n      x="0" \n      y="').concat(52,'" \n      height="').concat(144,'" \n      width="').concat(48,'" \n      rx="').concat(24,'"/>\n      <rect \n      class="MLEP__array-insert-background columns"\n      x="').concat(52,'" \n      y="0" \n      height="').concat(48,'" \n      width="').concat(144,'" \n      rx="').concat(24,'"/>\n  <g data-command=\'"moveDown"\'>\n  ').concat(newArrow(104,152,0),"\n  </g>\n  <g data-command='\"moveUp\"'>\n  ").concat(newArrow(104,56,180),"\n  </g>\n  <g data-command='\"moveToNextWord\"'>\n  ").concat(newArrow(152,104,-90),"\n  </g>\n  <g data-command='\"moveToPreviousWord\"'>\n  ").concat(newArrow(56,104,90),"\n  </g>\n  <g>\n\n  <g data-command='\"addColumnBefore\"'>\n  ").concat(newPlus(56,4),"\n  </g>\n  <g data-command='\"removeColumn\"'>\n  ").concat(newMinus(104,4),"\n  </g>\n  <g data-command='\"addColumnAfter\"'>\n  ").concat(newPlus(152,4),"\n  </g>\n  <g data-command='\"addRowBefore\"'>\n  ").concat(newPlus(4,56),"\n  </g>\n  <g data-command='\"removeRow\"'>\n  ").concat(newMinus(4,104),"\n  </g>\n  <g data-command='\"addRowAfter\"'>\n    ").concat(newPlus(4,152),"\n  </g>\n</svg>"),Bmatrix=function(className){return'\n<svg id="Bmatrix" class="'.concat(className,'" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 28 24" \n  data-command=\'["setEnvironment","Bmatrix"]\'>\n  <rect class="cls-1" width="28" height="24"/>\n  <path class="cls-2" d="m6,4c-1.1,0-2,.9-2,2v3c0,1.66-.9,3-2,3,1.1,0,2,1.34,2,3v3c0,1.1.9,2,2,2"/>\n  <path class="cls-2" d="m22,4c1.1,0,2,.9,2,2v3c0,1.66.9,3,2,3-1.1,0-2,1.34-2,3v3c0,1.1-.9,2-2,2"/>\n  <circle cx="10" cy="8" r="1"/>\n  <circle cx="14" cy="12" r="1"/>\n  <circle cx="18" cy="16" r="1"/>\n</svg>')},matrixButtons={matrix:function(className){return'\n<svg id="matrix" class="'.concat(className,'" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 28 24" \n  data-command=\'["setEnvironment","matrix"]\'>\n  <rect class="cls-1" width="28" height="24"/>\n  <circle cx="10" cy="8" r="1"/>\n  <circle cx="14" cy="12" r="1"/>\n  <circle cx="18" cy="16" r="1"/></svg>')},pmatrix:function(className){return'\n<svg id="pmatrix" class="'.concat(className,'" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 28 24" \ndata-command=\'["setEnvironment","pmatrix"]\'>\n  <rect class="cls-1" width="28" height="24"/>\n  <path class="cls-2" d="m6,4c-3.96,4.6-3.96,11.4,0,16"/>\n  <path class="cls-2" d="m22,4c3.96,4.6,3.96,11.4,0,16"/>\n  <circle cx="10" cy="8" r="1"/>\n  <circle cx="14" cy="12" r="1"/>\n  <circle cx="18" cy="16" r="1"/></svg>')},bmatrix:function(className){return'\n<svg id="bmatrix" class="'.concat(className,'" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 28 24" \n  data-command=\'["setEnvironment","bmatrix"]\'>\n  <rect class="cls-1" width="28" height="24"/>\n  <path class="cls-2" d="m6,4h-3v16h3"/>\n  <path class="cls-2" d="m22,4h3v16h-3"/>\n  <circle cx="10" cy="8" r="1"/>\n  <circle cx="14" cy="12" r="1"/>\n  <circle cx="18" cy="16" r="1"/>\n</svg>')},Bmatrix:Bmatrix,vmatrix:function(className){return'\n<svg id="vmatrix" class="'.concat(className,'" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 28 24" \n  data-command=\'["setEnvironment","vmatrix"]\'>\n  <rect class="cls-1" width="28" height="24"/>\n  <circle cx="10" cy="8" r="1"/>\n  <circle cx="14" cy="12" r="1"/>\n  <circle cx="18" cy="16" r="1"/>\n  <line class="cls-2" x1="4" y1="4" x2="4" y2="20"/>\n  <line class="cls-2" x1="24" y1="4" x2="24" y2="20"/>\n</svg>')},Vmatrix:function(className){return'\n<svg id="Vmatrix" class="'.concat(className,'" xmlns="http://www.w3.org/2000/svg" viewBox="-3.5 -3 35 30" \n  data-command=\'["setEnvironment","Vmatrix"]\'>\n  <rect class="cls-1" width="28" height="24"/>\n  <circle cx="10" cy="8" r="1"/>\n  <circle cx="14" cy="12" r="1"/>\n  <circle cx="18" cy="16" r="1"/>\n  <line class="cls-2" x1="6" y1="4" x2="6" y2="20"/>\n  <line class="cls-2" x1="22" y1="4" x2="22" y2="20"/>\n  <line class="cls-2" x1="2" y1="4" x2="2" y2="20"/>\n  <line class="cls-2" x1="26" y1="4" x2="26" y2="20"/>\n</svg>')}},casesButtons={cases:function(className){return'\n<svg id="cases" class="'.concat(className,'" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 28 24" \n  data-command=\'["setEnvironment","cases"]\'>\n  <rect class="cls-1" width="28" height="24"/>\n  <path class="cls-2" d="m10,4c-1.1,0-2,.9-2,2v3c0,1.66-.9,3-2,3,1.1,0,2,1.34,2,3v3c0,1.1.9,2,2,2"/>\n  <circle cx="13" cy="8" r="1"/>\n  <circle cx="13" cy="16" r="1"/>\n  <circle cx="21" cy="8" r="1"/>\n  <circle cx="21" cy="16" r="1"/>\n</svg>')},rcases:function(className){return'\n<svg id="rcases" class="'.concat(className,'" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 28 24" \n  data-command=\'["setEnvironment","rcases"]\'>\n  <rect class="cls-1" width="28" height="24"/>\n  <path class="cls-2" d="m18,20c1.1,0,2-.9,2-2v-3c0-1.66.9-3,2-3-1.1,0-2-1.34-2-3v-3c0-1.1-.9-2-2-2"/>\n  <circle cx="15" cy="8" r="1"/>\n  <circle cx="15" cy="16" r="1"/>\n  <circle cx="7" cy="8" r="1"/>\n  <circle cx="7" cy="16" r="1"/>\n</svg>')},Bmatrix:Bmatrix};function showEnvironmentPopover(mf){var _a3,_d2,array=null==(_a3=mf.model.parentEnvironment)?void 0:_a3.array;if(array){var columnCount=0;array.forEach((function(column){(!columnCount||column.length>columnCount)&&(columnCount=column.length)}));var flexbox,panel=document.getElementById("mathlive-environment-popover");panel||(panel=getSharedElement("mathlive-environment-popover"),injectStylesheet("environment-popover"),injectStylesheet("core"),panel.setAttribute("aria-hidden","true"));var possiblyExistentFlexbox=panel.querySelector(".MLEP__environment-controls");possiblyExistentFlexbox?flexbox=possiblyExistentFlexbox:(flexbox=document.createElement("div"),panel.innerHTML="",panel.appendChild(flexbox)),flexbox.className="MLEP__environment-controls",flexbox.style.display="flex",flexbox.style.width="100%",flexbox.style.height="100%",flexbox.style.boxSizing="border-box",flexbox.innerHTML=controllerSvg;var delimiterOptions=[],activeDelimeter="",environment=mf.model.parentEnvironment.environmentName;if(isMatrixEnvironment(environment)){var normalizedEnvironment=function(environment){return environment.replace("*","")}(environment);activeDelimeter=matrixButtons[normalizedEnvironment]("active");var _b3=matrixButtons,filteredDelimeters=(_b3[normalizedEnvironment],__objRest(_b3,[__restKey(normalizedEnvironment)]));delimiterOptions=Object.values(filteredDelimeters).map((function(f){return f("inactive")}))}else if(function(environment){return cases.includes(environment)}(environment)){var _normalizedEnvironment=function(environment){return"dcases"===environment?"cases":environment}(environment);activeDelimeter=casesButtons[_normalizedEnvironment]("active");var _c2=casesButtons,_filteredDelimeters=(_c2[_normalizedEnvironment],__objRest(_c2,[__restKey(_normalizedEnvironment)]));delimiterOptions=Object.values(_filteredDelimeters).map((function(f){return f("inactive")}))}else(function(environment){return align.includes(environment)})(environment)&&(activeDelimeter=matrixButtons.matrix("active"),delimiterOptions=Object.values(casesButtons).map((function(f){return f("inactive")})));var delimiterControls=document.createElement("div");delimiterControls.className="MLEP__environment-delimiter-controls",delimiterControls.style.display="flex",delimiterControls.style.flexDirection="column",delimiterControls.innerHTML="\n  <div class='MLEP__array-delimiter-options'>\n  ".concat(activeDelimeter,"\n  ").concat(delimiterOptions.join(""),"\n  </div>"),activeDelimeter&&flexbox.appendChild(delimiterControls),flexbox.querySelectorAll("[data-command]").forEach((function(control){var commandString=control.dataset.command,command=commandString;try{command=JSON.parse(commandString)}catch(e){}control.addEventListener("mousedown",(function(ev){return ev.preventDefault()})),command&&control.addEventListener("click",(function(){return mf.executeCommand(command)}))}));var position=null==(_d2=mf.field)?void 0:_d2.getBoundingClientRect();position&&(panel.style.top="".concat(window.scrollY+(position.top-panel.clientHeight-15),"px"),panel.style.left="".concat(position.left+20,"px"),panel.classList.add("is-visible"))}}function hideEnvironmentPopover(){var panel=document.getElementById("mathlive-environment-popover");null==panel||panel.classList.remove("is-visible")}function updateEnvironmentPopover(mf){if(mf.hasFocus()){var environment,visible=!1;if("math"===mf.model.mode&&window.mathVirtualKeyboard.visible){var env=mf.model.parentEnvironment;visible=!!(null==env?void 0:env.array)&&(environment=env.environmentName,otherTabular.concat(align).concat(cases).concat(matrices).includes(environment))}visible?showEnvironmentPopover(mf):hideEnvironmentPopover()}}var MathfieldPrivate=function(){function MathfieldPrivate(element,options){var _a3,_b3,_c2,_this36=this;_classCallCheck(this,MathfieldPrivate),this.focusBlurInProgress=!1,this.options=__spreadValues(__spreadProps(__spreadValues({},getDefault()),{macros:getMacros(),registers:getDefaultRegisters()}),update(options)),this.eventController=new AbortController,options.eventSink&&(this.host=options.eventSink),this.element=element,element.mathfield=this,this.blurred=!0,this.keystrokeCaptionVisible=!1,this.suggestionIndex=0,this.inlineShortcutBuffer=[],this.inlineShortcutBufferFlushTimer=0,this.style={},this.adoptStyle="left","inline-math"===this.options.defaultMode?this.element.classList.add("ML__is-inline"):this.element.classList.remove("ML__is-inline"),this.dirty=!1;var elementText=null!=(_b3=null!=(_a3=options.value)?_a3:this.element.textContent)?_b3:"";elementText=elementText.trim();var mode=effectiveMode(this.options),root=new Atom({type:"root",mode:mode,body:parseLatex(elementText,{context:this.context})});this.model=new ModelPrivate(this,mode,root,{onSelectionDidChange:function(){return _this36.onSelectionDidChange()},onContentWillChange:function(options2){return _this36.onContentWillChange(options2)}}),this.smartModeSuppressed=!1,this.undoManager=new UndoManager(this.model);var locale,markup=[];markup.push("<span contenteditable=true aria-multiline=false part=keyboard-sink class=ML__keyboard-sink autocapitalize=off autocomplete=off autocorrect=off spellcheck=false inputmode=none tabindex=0></span>"),markup.push('<span part=container class=ML__container aria-hidden=true  style="visibility:hidden">'),markup.push("<span part=content class=ML__content>"),markup.push(contentMarkup(this)),markup.push("</span>"),window.mathVirtualKeyboard&&(markup.push("<div part=virtual-keyboard-toggle class=ML__virtual-keyboard-toggle role=button ".concat(this.hasEditableContent?"":'style="display:none;"','data-ML__tooltip="').concat(localize("tooltip.toggle virtual keyboard"),'">')),markup.push('<svg style="width: 21px;" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path d="M528 64H48C21.49 64 0 85.49 0 112v288c0 26.51 21.49 48 48 48h480c26.51 0 48-21.49 48-48V112c0-26.51-21.49-48-48-48zm16 336c0 8.823-7.177 16-16 16H48c-8.823 0-16-7.177-16-16V112c0-8.823 7.177-16 16-16h480c8.823 0 16 7.177 16 16v288zM168 268v-24c0-6.627-5.373-12-12-12h-24c-6.627 0-12 5.373-12 12v24c0 6.627 5.373 12 12 12h24c6.627 0 12-5.373 12-12zm96 0v-24c0-6.627-5.373-12-12-12h-24c-6.627 0-12 5.373-12 12v24c0 6.627 5.373 12 12 12h24c6.627 0 12-5.373 12-12zm96 0v-24c0-6.627-5.373-12-12-12h-24c-6.627 0-12 5.373-12 12v24c0 6.627 5.373 12 12 12h24c6.627 0 12-5.373 12-12zm96 0v-24c0-6.627-5.373-12-12-12h-24c-6.627 0-12 5.373-12 12v24c0 6.627 5.373 12 12 12h24c6.627 0 12-5.373 12-12zm-336 80v-24c0-6.627-5.373-12-12-12H84c-6.627 0-12 5.373-12 12v24c0 6.627 5.373 12 12 12h24c6.627 0 12-5.373 12-12zm384 0v-24c0-6.627-5.373-12-12-12h-24c-6.627 0-12 5.373-12 12v24c0 6.627 5.373 12 12 12h24c6.627 0 12-5.373 12-12zM120 188v-24c0-6.627-5.373-12-12-12H84c-6.627 0-12 5.373-12 12v24c0 6.627 5.373 12 12 12h24c6.627 0 12-5.373 12-12zm96 0v-24c0-6.627-5.373-12-12-12h-24c-6.627 0-12 5.373-12 12v24c0 6.627 5.373 12 12 12h24c6.627 0 12-5.373 12-12zm96 0v-24c0-6.627-5.373-12-12-12h-24c-6.627 0-12 5.373-12 12v24c0 6.627 5.373 12 12 12h24c6.627 0 12-5.373 12-12zm96 0v-24c0-6.627-5.373-12-12-12h-24c-6.627 0-12 5.373-12 12v24c0 6.627 5.373 12 12 12h24c6.627 0 12-5.373 12-12zm96 0v-24c0-6.627-5.373-12-12-12h-24c-6.627 0-12 5.373-12 12v24c0 6.627 5.373 12 12 12h24c6.627 0 12-5.373 12-12zm-96 152v-8c0-6.627-5.373-12-12-12H180c-6.627 0-12 5.373-12 12v8c0 6.627 5.373 12 12 12h216c6.627 0 12-5.373 12-12z"/></svg>'),markup.push("</div>")),markup.push("</span>"),markup.push("<span class=ML__sr-only>"),markup.push("<span role=status aria-live=assertive aria-atomic=true></span>"),markup.push("</span>"),this.element.innerHTML=window.MathfieldElement.createHTML(markup.join("")),this.element.children?(this.field=this.element.querySelector("[part=content]"),this.field.addEventListener("click",(function(evt){return evt.stopImmediatePropagation()}),{capture:!1,signal:this.eventController.signal}),this.field.addEventListener("wheel",this,{passive:!1,signal:this.eventController.signal}),"PointerEvent"in window?this.field.addEventListener("pointerdown",this,{signal:this.eventController.signal}):this.field.addEventListener("mousedown",this,{signal:this.eventController.signal}),null==(_c2=this.element.querySelector("[part=virtual-keyboard-toggle]"))||_c2.addEventListener("click",(function(){window.mathVirtualKeyboard.visible?window.mathVirtualKeyboard.hide():(window.mathVirtualKeyboard.show({animate:!0}),window.mathVirtualKeyboard.update(makeProxy(_this36)))}),{signal:this.eventController.signal}),this.ariaLiveText=this.element.querySelector("[role=status]"),this.keyboardDelegate=delegateKeyboardEvents(this.element.querySelector(".ML__keyboard-sink"),this.element,this),window.addEventListener("resize",this,{signal:this.eventController.signal}),document.addEventListener("scroll",this,{signal:this.eventController.signal}),window.mathVirtualKeyboard.addEventListener("virtual-keyboard-toggle",this),gKeyboardLayout&&!l10n.locale.startsWith(gKeyboardLayout.locale)&&(locale=l10n.locale,gKeyboardLayout=gKeyboardLayouts.find((function(x){return locale.startsWith(x.locale)}))),"ready"!==gFontsState&&document.fonts.ready.then((function(){return renderSelection(_this36)})),element.querySelector(".ML__container").style.removeProperty("visibility"),this.undoManager.startRecording(),this.undoManager.snapshot("set-value")):console.error("%cMathLive 0.94.6: Something went wrong and the mathfield could not be created.%c\nIf you are using Vue, this may be because you are using the runtime-only build of Vue. Make sure to include `runtimeCompiler: true` in your Vue configuration. There may a warning from Vue in the log above.","color:red;font-family:system-ui;font-size:1.2rem;font-weight:bold","color:inherit;font-family:system-ui;font-size:inherit;font-weight:inherit")}return _createClass(MathfieldPrivate,[{key:"connectToVirtualKeyboard",value:function(){this.connectedToVirtualKeyboard||(this.connectedToVirtualKeyboard=!0,window.addEventListener("message",this,{signal:this.eventController.signal}),window.mathVirtualKeyboard.connect(),window.mathVirtualKeyboard.visible&&window.mathVirtualKeyboard.update(makeProxy(this)),updateEnvironmentPopover(this))}},{key:"disconnectFromVirtualKeyboard",value:function(){this.connectedToVirtualKeyboard&&(window.removeEventListener("message",this),window.mathVirtualKeyboard.disconnect(),this.connectedToVirtualKeyboard=!1,hideEnvironmentPopover())}},{key:"colorMap",get:function(){var _this37=this;return function(name){var _a3,_b3,_c2;return null!=(_c2=null==(_b3=(_a3=_this37.options).colorMap)?void 0:_b3.call(_a3,name))?_c2:defaultColorMap(name)}}},{key:"backgroundColorMap",get:function(){var _this38=this;return function(name){var _a3,_b3,_c2,_d2,_e,_f;return null!=(_f=null!=(_e=null==(_b3=(_a3=_this38.options).backgroundColorMap)?void 0:_b3.call(_a3,name))?_e:null==(_d2=(_c2=_this38.options).colorMap)?void 0:_d2.call(_c2,name))?_f:defaultBackgroundColorMap(name)}}},{key:"smartFence",get:function(){var _a3;return null!=(_a3=this.options.smartFence)&&_a3}},{key:"readOnly",get:function(){var _a3;return null!=(_a3=this.options.readOnly)&&_a3}},{key:"disabled",get:function(){var _a3,_b3;return null!=(_b3=null==(_a3=this.host)?void 0:_a3.disabled)&&_b3}},{key:"contentEditable",get:function(){var _a3;return"false"!==(null==(_a3=this.host)?void 0:_a3.getAttribute("contenteditable"))}},{key:"userSelect",get:function(){if(!this.host)return"";var style=getComputedStyle(this.host);return style.getPropertyValue("user-select")||style.getPropertyValue("-webkit-user-select")}},{key:"hasEditableContent",get:function(){return!(this.disabled||!this.contentEditable)&&(!this.readOnly||this.hasEditablePrompts)}},{key:"hasEditablePrompts",get:function(){return this.readOnly&&!this.disabled&&this.contentEditable&&void 0!==this.model.findAtom((function(a){return"prompt"===a.type&&!a.locked}))}},{key:"isSelectionEditable",get:function(){if(this.disabled||!this.contentEditable)return!1;if(!this.readOnly)return!0;var anchor=this.model.at(this.model.anchor),cursor=this.model.at(this.model.position),ancestor=Atom.commonAncestor(anchor,cursor);return!("prompt"!==(null==ancestor?void 0:ancestor.type)&&!(null==ancestor?void 0:ancestor.parentPrompt))}},{key:"letterShapeStyle",get:function(){var _a3;return null!=(_a3=this.options.letterShapeStyle)?_a3:"tex"}},{key:"minFontScale",get:function(){return this.options.minFontScale}},{key:"selectionStyle",get:function(){if(this.model.selectionIsCollapsed){var previousAtom=this.model.at(this.model.selection.ranges[0][0]),siblingToAdopt="right"===this.adoptStyle?previousAtom.rightSibling:previousAtom;if(!siblingToAdopt)return{};if("group"===siblingToAdopt.type){var branch=siblingToAdopt.branch("body");return!branch||branch.length<2?{}:"right"===this.adoptStyle?branch[1].style:branch[branch.length-1].style}return siblingToAdopt.style}var selectedAtoms=this.model.getAtoms(this.model.selection);if(0===selectedAtoms.length)return{};var style=__spreadValues({},selectedAtoms[0].style);return selectedAtoms.forEach((function(a){for(var _i30=0,_Object$entries2=Object.entries(a.style);_i30<_Object$entries2.length;_i30++){var _Object$entries2$_i=_slicedToArray(_Object$entries2[_i30],2),key=_Object$entries2$_i[0],value=_Object$entries2$_i[1];style[key]&&style[key]===value||(style[key]=void 0)}})),style}},{key:"keybindings",get:function(){var _a3,_b3;if(this._keybindings)return this._keybindings;var _normalizeKeybindings=function(keybindings,layout){var _step93,result=[],errors=[],_iterator93=_createForOfIteratorHelper(keybindings);try{for(_iterator93.s();!(_step93=_iterator93.n()).done;){var x=_step93.value;try{!function(){var keybinding=normalizeKeybinding(x,layout);if(keybinding){var matches=result.filter((function(x2){return x2.key===keybinding.key&&x2.ifMode===keybinding.ifMode}));if(matches.length>0)throw new Error("Ambiguous key binding ".concat(x.key," (").concat(selectorToString(x.command),") matches ").concat(matches[0].key," (").concat(selectorToString(matches[0].command),") with the ").concat(layout.displayName," keyboard layout"));result.push(keybinding)}}()}catch(error){error instanceof Error&&errors.push(error.message)}}}catch(err){_iterator93.e(err)}finally{_iterator93.f()}return[result,errors]}(this.options.keybindings,null!=(_a3=getActiveKeyboardLayout())?_a3:DEFAULT_KEYBOARD_LAYOUT),_normalizeKeybindings2=_slicedToArray(_normalizeKeybindings,2),keybindings=_normalizeKeybindings2[0],errors=_normalizeKeybindings2[1];return(null==(_b3=getActiveKeyboardLayout())?void 0:_b3.score)>0&&(this._keybindings=keybindings,errors.length>0&&console.error("MathLive 0.94.6: Invalid keybindings for current keyboard layout",errors)),keybindings}},{key:"setOptions",value:function(config){this.options=__spreadValues(__spreadValues({},this.options),update(config)),this._keybindings=void 0,"inline-math"===this.options.defaultMode?this.element.classList.add("ML__is-inline"):this.element.classList.remove("ML__is-inline"),this.options.readOnly&&this.hasFocus()&&window.mathVirtualKeyboard.visible&&this.executeCommand("hideVirtualKeyboard");var content=Atom.serialize([this.model.root],{expandMacro:!1,defaultMode:this.options.defaultMode});("macros"in config||this.model.getValue()!==content)&&ModeEditor.insert(this.model,content,{insertionMode:"replaceAll",selectionMode:"after",format:"latex",silenceNotifications:!0,mode:"math"}),("value"in config||"macros"in config||"registers"in config||"colorMap"in config||"backgroundColorMap"in config||"letterShapeStyle"in config||"minFontScale"in config||"readOnly"in config||"placeholderSymbol"in config)&&requestUpdate(this)}},{key:"getOptions",value:function(keys){return get(this.options,keys)}},{key:"getOption",value:function(key){return get(this.options,key)}},{key:"handleEvent",value:function(evt){var _a3,_this39=this;if(isValidMathfield(this))if(isVirtualKeyboardMessage(evt)){if(!validateOrigin(evt.origin,null!=(_a3=this.options.originValidator)?_a3:"none"))throw new DOMException("Message from unknown origin (".concat(evt.origin,") cannot be handled"),"SecurityError");var action=evt.data.action;if("execute-command"===action){var command=evt.data.command;if("virtual-keyboard"===getCommandTarget(command))return;this.executeCommand(command)}else"update-state"===action||("focus"===action?this.focus({preventScroll:!0}):"blur"===action&&this.blur())}else switch(evt.type){case"focus":this.onFocus();break;case"blur":this.onBlur();break;case"mousedown":case"pointerdown":onPointerDown(this,evt);break;case"virtual-keyboard-toggle":this.hasFocus()&&updateEnvironmentPopover(this);break;case"resize":case"scroll":this.geometryChangeTimer&&cancelAnimationFrame(this.geometryChangeTimer),this.geometryChangeTimer=requestAnimationFrame((function(){return isValidMathfield(_this39)&&_this39.onGeometryChange()}));break;case"wheel":this.onWheel(evt);break;default:console.warn("Unexpected event type",evt.type)}}},{key:"dispose",value:function(){isValidMathfield(this)&&(this.keyboardDelegate.dispose(),this.keyboardDelegate=void 0,this.eventController.abort(),window.mathVirtualKeyboard.removeEventListener("virtual-keyboard-toggle",this),this.disconnectFromVirtualKeyboard(),this.model.dispose(),delete this.element.mathfield,this.element=void 0,this.host=void 0,this.field=void 0,this.fieldContent=void 0,this.ariaLiveText=void 0,document.getElementById("mathlive-keystroke-caption-panel")&&(releaseSharedElement("mathlive-keystroke-caption-panel"),releaseStylesheet("core"),releaseStylesheet("keystroke-caption")),document.getElementById("mathlive-suggestion-popover")&&(releaseSharedElement("mathlive-suggestion-popover"),releaseStylesheet("suggestion-popover"),releaseStylesheet("core")),document.getElementById("mathlive-environment-popover")&&(releaseSharedElement("mathlive-environment-popover"),releaseStylesheet("environment-popover"),releaseStylesheet("core")))}},{key:"flushInlineShortcutBuffer",value:function(options){var _this40=this;if(null!=options||(options={defer:!1}),!options.defer)return this.inlineShortcutBuffer=[],clearTimeout(this.inlineShortcutBufferFlushTimer),void(this.inlineShortcutBufferFlushTimer=0);this.options.inlineShortcutTimeout>0&&(clearTimeout(this.inlineShortcutBufferFlushTimer),this.inlineShortcutBufferFlushTimer=setTimeout((function(){return _this40.flushInlineShortcutBuffer()}),this.options.inlineShortcutTimeout))}},{key:"executeCommand",value:function(command){var _this41=this;return"virtual-keyboard"===getCommandTarget(command)?(this.focus({preventScroll:!0}),window.mathVirtualKeyboard.executeCommand(command),requestAnimationFrame((function(){return window.mathVirtualKeyboard.update(makeProxy(_this41))})),!1):function(mathfield,command){var _a3,selector;if(!command)return!1;var args=[],handled=!1,dirty=!1;isArray(command)?(selector=command[0],args=command.slice(1)):selector=command,selector=selector.replace(/-\w/g,(function(m){return m[1].toUpperCase()}));var info=COMMANDS[selector],commandTarget=null==info?void 0:info.target;if("model"===commandTarget){var _COMMANDS$selector;if(!mathfield.isSelectionEditable&&(null==info?void 0:info.changeContent))return mathfield.model.announce("plonk"),!1;/^(delete|add)/.test(selector)&&("deleteBackward"!==selector&&mathfield.flushInlineShortcutBuffer(),mathfield.snapshot(selector)),/^complete/.test(selector)||removeSuggestion(mathfield),(_COMMANDS$selector=COMMANDS[selector]).fn.apply(_COMMANDS$selector,[mathfield.model].concat(_toConsumableArray(args))),updateAutocomplete(mathfield),dirty=!0,handled=!0}else if("virtual-keyboard"===commandTarget)dirty=null!=(_a3=window.mathVirtualKeyboard.executeCommand(command))&&_a3,handled=!0;else{if(!COMMANDS[selector])throw new Error('Unknown command "'.concat(selector,'"'));var _COMMANDS$selector2;if(!mathfield.isSelectionEditable&&(null==info?void 0:info.changeContent))return mathfield.model.announce("plonk"),!1;/^(undo|redo)/.test(selector)&&mathfield.flushInlineShortcutBuffer(),dirty=(_COMMANDS$selector2=COMMANDS[selector]).fn.apply(_COMMANDS$selector2,[mathfield].concat(_toConsumableArray(args))),handled=!0}return"virtual-keyboard"!==commandTarget&&(mathfield.model.selectionIsCollapsed&&!(null==info?void 0:info.changeSelection)||(mathfield.flushInlineShortcutBuffer(),(null==info?void 0:info.changeContent)||mathfield.stopCoalescingUndo(),mathfield.style={})),dirty&&requestUpdate(mathfield),handled}(this,command)}},{key:"errors",get:function(){return validateLatex(this.model.getValue(),{context:this.context})}},{key:"getValue",value:function(arg1,arg2,arg3){return this.model.getValue(arg1,arg2,arg3)}},{key:"setValue",value:function(value,options){var _a3;void 0===(options=null!=options?options:{mode:"math"}).insertionMode&&(options.insertionMode="replaceAll"),void 0!==options.format&&"auto"!==options.format||(options.format="latex"),void 0!==options.mode&&"auto"!==options.mode||(options.mode=null!=(_a3=getMode(this.model,this.model.position))?_a3:"math"),ModeEditor.insert(this.model,value,options)&&(requestUpdate(this),this.undoManager.snapshot("set-value"))}},{key:"expression",get:function(){var ce=window.MathfieldElement.computeEngine;return ce?ce.box(ce.parse(this.model.getValue("latex-unstyled"))):(console.error("MathLive 0.94.6:  no compute engine available. Make sure the Compute Engine library is loaded."),null)}},{key:"scrollIntoView",value:function(){var _a3;if(this.element){if(this.host)if(this.options.onScrollIntoView)this.options.onScrollIntoView(this);else if(this.host.scrollIntoView({block:"nearest",inline:"nearest"}),window.mathVirtualKeyboard.visible&&window.mathVirtualKeyboard.container===window.document.body){var kbdBounds=window.mathVirtualKeyboard.boundingRect,mathfieldBounds=this.host.getBoundingClientRect();mathfieldBounds.bottom>kbdBounds.top&&(null==(_a3=window.document.scrollingElement)||_a3.scrollBy(0,mathfieldBounds.bottom-kbdBounds.top+8))}this.dirty&&render(this,{interactive:!0});var fieldBounds=this.field.getBoundingClientRect(),caretPoint=null;if(this.model.selectionIsCollapsed)caretPoint=_getCaretPoint(this.field);else{var selectionBounds=getSelectionBounds(this);if(selectionBounds.length>0){var _step152,maxRight=-1/0,minTop=-1/0,_iterator152=_createForOfIteratorHelper(selectionBounds);try{for(_iterator152.s();!(_step152=_iterator152.n()).done;){var r=_step152.value;r.right>maxRight&&(maxRight=r.right),r.top<minTop&&(minTop=r.top)}}catch(err){_iterator152.e(err)}finally{_iterator152.f()}caretPoint={x:maxRight+fieldBounds.left-this.field.scrollLeft,y:minTop+fieldBounds.top-this.field.scrollTop,height:0}}}if(this.host&&caretPoint){var hostBounds=this.host.getBoundingClientRect(),y=caretPoint.y,top=this.host.scrollTop;y<hostBounds.top?top=y-hostBounds.top+this.host.scrollTop:y>hostBounds.bottom&&(top=y-hostBounds.bottom+this.host.scrollTop+caretPoint.height),this.host.scroll({top:top,left:0})}if(caretPoint){var x=caretPoint.x-window.scrollX,left=this.field.scrollLeft;x<fieldBounds.left?left=x-fieldBounds.left+this.field.scrollLeft-20:x>fieldBounds.right&&(left=x-fieldBounds.right+this.field.scrollLeft+20),this.field.scroll({top:this.field.scrollTop,left:left})}}}},{key:"insert",value:function(s,options){if("string"!=typeof s)return!1;if(0===s.length&&("insertBefore"===(null==options?void 0:options.insertionMode)||"insertAfter"===(null==options?void 0:options.insertionMode)))return!1;if(0===s.length&&this.model.selectionIsCollapsed)return!1;if(this.flushInlineShortcutBuffer(),(options=null!=options?options:{mode:"math"}).focus&&this.focus(),options.feedback&&(window.MathfieldElement.keypressVibration&&canVibrate()&&navigator.vibrate(3),window.MathfieldElement.playSound("keypress")),options.scrollIntoView&&this.scrollIntoView(),"\\\\"===s)addRowAfter(this.model);else if("&"===s)addColumnAfter(this.model);else{var savedStyle=this.style;this.model.selectionIsCollapsed?ModeEditor.insert(this.model,s,__spreadValues({style:this.model.at(this.model.position).computedStyle},options)):ModeEditor.insert(this.model,s,options),options.resetStyle&&(this.style=savedStyle)}return this.snapshot("insert-".concat(this.model.at(this.model.position).type)),requestUpdate(this),!0}},{key:"switchMode",value:function(mode){var _a3,_this42=this,prefix=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",suffix=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";if(this.model.mode!==mode&&this.hasEditableContent&&this.contentEditable&&!this.disabled&&(null==(_a3=this.host)?void 0:_a3.dispatchEvent(new Event("mode-change",{bubbles:!0,composed:!0,cancelable:!0})))){var currentMode=this.model.mode,model=this.model;model.deferNotifications({content:Boolean(suffix)||Boolean(prefix),selection:!0,type:"insertText"},(function(){var contentChanged=!1;if(_this42.flushInlineShortcutBuffer(),_this42.stopCoalescingUndo(),_this42.smartModeSuppressed=/text|math/.test(_this42.model.mode)&&/text|math/.test(mode),prefix&&"latex"!==mode){var atoms=parseLatex(prefix,{context:_this42.context,parseMode:mode});model.collapseSelection("forward");var cursor=model.at(model.position);model.position=model.offsetOf(cursor.parent.addChildrenAfter(atoms,cursor)),contentChanged=!0}if(_this42.model.mode=mode,"latex"===mode){var latex,wasCollapsed=model.selectionIsCollapsed;complete(_this42,"accept");var _cursor=model.at(model.position);if(wasCollapsed)latex="\\";else{var selRange=range(model.selection);latex=_this42.model.getValue(selRange,"latex");var extractedAtoms=_this42.model.extractAtoms(selRange);1===extractedAtoms.length&&"placeholder"===extractedAtoms[0].type&&(latex=prefix,wasCollapsed=!0),_cursor=model.at(selRange[0])}var atom=new LatexGroupAtom(latex);_cursor.parent.addChildAfter(atom,_cursor),wasCollapsed?model.position=model.offsetOf(atom.lastChild):model.setSelection(model.offsetOf(atom.firstChild),model.offsetOf(atom.lastChild))}else getLatexGroupBody(model).forEach((function(x){x.isError=!1}));if(suffix){var _atoms3=parseLatex(suffix,{context:_this42.context,parseMode:currentMode});model.collapseSelection("forward");var _cursor2=model.at(model.position);model.position=model.offsetOf(_cursor2.parent.addChildrenAfter(_atoms3,_cursor2)),contentChanged=!0}return requestUpdate(_this42),_this42.undoManager.snapshot("latex"===mode?"insert-latex":"insert"),contentChanged})),this.model.mode=mode}}},{key:"hasFocus",value:function(){return!this.blurred}},{key:"focus",value:function(options){this.hasFocus()||(this.keyboardDelegate.focus(),this.connectToVirtualKeyboard(),this.model.announce("line")),(null==options?void 0:options.preventScroll)||this.scrollIntoView()}},{key:"blur",value:function(){this.disconnectFromVirtualKeyboard(),this.hasFocus()&&this.keyboardDelegate.blur()}},{key:"select",value:function(){this.model.selection={ranges:[[0,this.model.lastOffset]]}}},{key:"applyStyle",value:function(inStyle){var _a3,_b3,_this43=this,inOptions=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},options={operation:"set",silenceNotifications:!1};isRange(inOptions)?options.range=inOptions:(options.range=inOptions.range,options.silenceNotifications=null!=(_a3=inOptions.silenceNotifications)&&_a3);var style=validateStyle(this,inStyle),operation=null!=(_b3=options.operation)?_b3:"set";this.model.deferNotifications({content:!options.silenceNotifications,type:"insertText"},(function(){if(void 0===options.range){var _step153,_iterator153=_createForOfIteratorHelper(_this43.model.selection.ranges);try{for(_iterator153.s();!(_step153=_iterator153.n()).done;){var range2=_step153.value;_applyStyle(_this43.model,range2,style,{operation:operation})}}catch(err){_iterator153.e(err)}finally{_iterator153.f()}}else _applyStyle(_this43.model,options.range,style,{operation:operation})})),requestUpdate(this)}},{key:"getCaretPoint",value:function(){var caretOffset=_getCaretPoint(this.field);return caretOffset?{x:caretOffset.x,y:caretOffset.y}:null}},{key:"setCaretPoint",value:function(x,y){var newPosition=_offsetFromPoint(this,x,y,{bias:0});if(newPosition<0)return!1;var previousPosition=this.model.position;return this.model.position=newPosition,this.model.announce("move",previousPosition),requestUpdate(this),!0}},{key:"getPrompt",value:function(id){var prompt=this.model.findAtom((function(a){return"prompt"===a.type&&a.placeholderId===id}));return console.assert(void 0!==prompt,"MathLive 0.94.6:  no prompts with matching ID found"),prompt}},{key:"getPromptValue",value:function(id,format){var prompt=this.getPrompt(id);if(!prompt)return console.error("MathLive 0.94.6: unknown prompt ".concat(id)),"";var first=this.model.offsetOf(prompt.firstChild),last=this.model.offsetOf(prompt.lastChild);return this.model.getValue(first,last,format)}},{key:"getPrompts",value:function(filter){return this.model.getAllAtoms().filter((function(a){return!("prompt"!==a.type||filter&&(filter.id&&a.placeholderId!==filter.id||filter.locked&&a.locked!==filter.locked||"undefined"===filter.correctness&&a.correctness||filter.correctness&&a.correctness!==filter.correctness))})).map((function(a){return a.placeholderId}))}},{key:"setPromptValue",value:function(id,value,insertOptions){if(void 0!==value){var prompt=this.getPrompt(id);if(!prompt)return void console.error("MathLive 0.94.6: unknown prompt ".concat(id));var branchRange=this.model.getBranchRange(this.model.offsetOf(prompt),"body");this.model.setSelection(branchRange),this.insert(value,__spreadProps(__spreadValues({},insertOptions),{insertionMode:"replaceSelection"}))}(null==insertOptions?void 0:insertOptions.silenceNotifications)&&(this.valueOnFocus=this.getValue()),requestUpdate(this)}},{key:"setPromptState",value:function(id,state,locked){var prompt=this.getPrompt(id);prompt?("undefined"===state?prompt.correctness=void 0:"string"==typeof state&&(prompt.correctness=state),"boolean"==typeof locked&&(prompt.locked=locked,prompt.captureSelection=locked),requestUpdate(this)):console.error("MathLive 0.94.6: unknown prompt ".concat(id))}},{key:"stripPromptContent",value:function(filter){var _this44=this,matchingPrompts=this.model.getAllAtoms().filter((function(a){return!("prompt"!==a.type||filter&&(filter.id&&a.placeholderId!==filter.id||filter.locked&&a.locked!==filter.locked||"undefined"===filter.correctness&&a.correctness||filter.correctness&&a.correctness!==filter.correctness))})),promptStates={};return matchingPrompts.forEach((function(prompt){var id=prompt.placeholderId;promptStates[id]=_this44.getPromptValue(id),_this44.setPromptValue(id,"")})),promptStates}},{key:"getPromptState",value:function(id){var prompt=this.getPrompt(id);return prompt?[prompt.correctness,prompt.locked]:(console.error("MathLive 0.94.6: unknown prompt ".concat(id)),[void 0,!0])}},{key:"canUndo",value:function(){return this.undoManager.canUndo()}},{key:"canRedo",value:function(){return this.undoManager.canRedo()}},{key:"popUndoStack",value:function(){this.undoManager.pop()}},{key:"snapshot",value:function(op){var _a3;this.undoManager.snapshot(op)&&(window.mathVirtualKeyboard.visible&&window.mathVirtualKeyboard.update(makeProxy(this)),null==(_a3=this.host)||_a3.dispatchEvent(new CustomEvent("undo-state-change",{bubbles:!0,composed:!0,detail:{type:"snapshot"}})))}},{key:"stopCoalescingUndo",value:function(){this.undoManager.stopCoalescing(this.model.selection)}},{key:"stopRecording",value:function(){this.undoManager.stopRecording()}},{key:"startRecording",value:function(){this.undoManager.startRecording()}},{key:"undo",value:function(){var _a3;this.undoManager.undo()&&(window.mathVirtualKeyboard.visible&&window.mathVirtualKeyboard.update(makeProxy(this)),null==(_a3=this.host)||_a3.dispatchEvent(new CustomEvent("undo-state-change",{bubbles:!0,composed:!0,detail:{type:"undo"}})))}},{key:"redo",value:function(){var _a3;this.undoManager.redo()&&(window.mathVirtualKeyboard.visible&&window.mathVirtualKeyboard.update(makeProxy(this)),null==(_a3=this.host)||_a3.dispatchEvent(new CustomEvent("undo-state-change",{bubbles:!0,composed:!0,detail:{type:"undo"}})))}},{key:"resetUndo",value:function(){var _a3;null==(_a3=this.undoManager)||_a3.reset()}},{key:"onSelectionDidChange",value:function(){var _a3,_b3,model=this.model;this.keyboardDelegate.setValue(model.getValue(this.model.selection,"latex-expanded"));var cursor=model.at(model.position),newMode=null!=(_a3=cursor.mode)?_a3:effectiveMode(this.options);this.model.mode!==newMode&&("latex"===this.model.mode?(complete(this,"accept",{mode:newMode}),model.position=model.offsetOf(cursor)):this.switchMode(newMode)),null==(_b3=this.host)||_b3.dispatchEvent(new Event("selection-change",{bubbles:!0,composed:!0})),window.mathVirtualKeyboard.visible&&window.mathVirtualKeyboard.update(makeProxy(this)),updateEnvironmentPopover(this)}},{key:"onContentWillChange",value:function(options){var _a3,_b3,_c2;return null==(_c2=null==(_b3=this.host)?void 0:_b3.dispatchEvent(new InputEvent("beforeinput",__spreadProps(__spreadValues({},options),{data:options.data?options.data:null!=(_a3=options.inputType)?_a3:"",cancelable:!0,bubbles:!0,composed:!0}))))||_c2}},{key:"onFocus",value:function(){!this.focusBlurInProgress&&this.blurred&&(this.focusBlurInProgress=!0,this.blurred=!1,this.keyboardDelegate.focus(),this.stopCoalescingUndo(),render(this,{interactive:!0}),this.valueOnFocus=this.model.getValue(),this.hasEditablePrompts&&!this.model.at(this.model.anchor).parentPrompt&&this.executeCommand("moveToNextPlaceholder"),this.focusBlurInProgress=!1)}},{key:"onBlur",value:function(){var _a3,_b3,_c2,_this45=this;if(!this.focusBlurInProgress&&!this.blurred){this.focusBlurInProgress=!0,this.stopCoalescingUndo(),this.blurred=!0,this.ariaLiveText.textContent="",complete(this,"accept"),this.model.getValue()!==this.valueOnFocus&&(null==(_a3=this.host)||_a3.dispatchEvent(new Event("change",{bubbles:!0,composed:!0}))),this.disconnectFromVirtualKeyboard(),null==(_b3=this.host)||_b3.dispatchEvent(new Event("blur",{bubbles:!1,composed:!0})),null==(_c2=this.host)||_c2.dispatchEvent(new UIEvent("focusout",{bubbles:!0,composed:!0})),requestUpdate(this),this.focusBlurInProgress=!1,hideEnvironmentPopover();var controller=new AbortController,signal=controller.signal;document.addEventListener("visibilitychange",(function(){"hidden"===document.visibilityState&&document.addEventListener("visibilitychange",(function(){isValidMathfield(_this45)&&"visible"===document.visibilityState&&_this45.focus({preventScroll:!0})}),{once:!0})}),{once:!0,signal:signal}),setTimeout((function(){return controller.abort()}),100)}}},{key:"onInput",value:function(text){_onInput(this,text)}},{key:"onKeystroke",value:function(keystroke,evt){return _onKeystroke(this,keystroke,evt)}},{key:"onCompositionStart",value:function(_composition){var _this46=this;this.model.deleteAtoms(range(this.model.selection));var caretPoint=_getCaretPoint(this.field);caretPoint&&requestAnimationFrame((function(){render(_this46),_this46.keyboardDelegate.moveTo(caretPoint.x,caretPoint.y-caretPoint.height)}))}},{key:"onCompositionUpdate",value:function(composition){!function(model,s){var cursor=model.at(model.position);if("composition"===cursor.type)cursor.value=s;else{var caret=cursor.caret;cursor.caret=void 0;var atom=new CompositionAtom(s,{mode:cursor.mode});atom.caret=caret,cursor.parent.addChildAfter(atom,cursor),model.position+=1}}(this.model,composition),requestUpdate(this)}},{key:"onCompositionEnd",value:function(composition){var model,cursor;model=this.model,"composition"===(cursor=model.at(model.position)).type&&(cursor.parent.removeChild(cursor),model.position-=1),_onInput(this,composition,{simulateKeystroke:!0})}},{key:"onCut",value:function(ev){this.isSelectionEditable?contentWillChange(this.model,{inputType:"deleteByCut"})&&(this.stopCoalescingUndo(),ModeEditor.onCopy(this,ev),deleteRange(this.model,range(this.model.selection),"deleteByCut"),this.snapshot("cut"),requestUpdate(this)):this.model.announce("plonk")}},{key:"onCopy",value:function(ev){ModeEditor.onCopy(this,ev)}},{key:"onPaste",value:function(ev){var result=this.isSelectionEditable;return result&&(result=ModeEditor.onPaste(this.model.at(this.model.position).mode,this,ev.clipboardData)),result||this.model.announce("plonk"),ev.preventDefault(),ev.stopPropagation(),result}},{key:"onGeometryChange",value:function(){updateSuggestionPopoverPosition(this),updateEnvironmentPopover(this)}},{key:"onWheel",value:function(ev){var wheelDelta=5*ev.deltaX;if(Number.isFinite(wheelDelta)&&0!==wheelDelta){var field=this.field;wheelDelta<0&&0===field.scrollLeft||wheelDelta>0&&field.offsetWidth+field.scrollLeft>=field.scrollWidth||(field.scrollBy({top:0,left:wheelDelta}),ev.preventDefault(),ev.stopPropagation())}}},{key:"getHTMLElement",value:function(atom){for(var target=atom;!target.id&&target.hasChildren;)target=atom.children[0];return this.fieldContent.querySelector('[data-atom-id="'.concat(target.id,'"]'))}},{key:"context",get:function(){var _a3,_b3,_this47=this;return{registers:null!=(_a3=this.options.registers)?_a3:{},smartFence:this.smartFence,letterShapeStyle:this.letterShapeStyle,minFontScale:this.minFontScale,placeholderSymbol:null!=(_b3=this.options.placeholderSymbol)?_b3:"▢",colorMap:function(name){return _this47.colorMap(name)},backgroundColorMap:function(name){return _this47.backgroundColorMap(name)},getMacro:function(token){return getMacroDefinition(token,_this47.options.macros)},atomIdsSettings:{seed:"random",groupNumbers:!1}}}}]),MathfieldPrivate}();function wordBoundaryOffset(model,offset,direction){if("text"!==model.at(offset).mode)return offset;var result,dir="backward"===direction?-1:1;if(LETTER_AND_DIGITS.test(model.at(offset).value)){var match,i=offset;do{match="text"===model.at(i).mode&&LETTER_AND_DIGITS.test(model.at(i).value),i+=dir}while(model.at(i)&&match);result=model.at(i)?i-2*dir:i-dir}else if(/\s/.test(model.at(offset).value)){for(var _i31=offset;model.at(_i31)&&"text"===model.at(_i31).mode&&/\s/.test(model.at(_i31).value);)_i31+=dir;if(model.at(_i31)){var _match3=!0;do{_match3="text"===model.at(_i31).mode&&!/\s/.test(model.at(_i31).value),_i31+=dir}while(model.at(_i31)&&_match3);result=model.at(_i31)?_i31-2*dir:_i31-dir}else result=_i31-dir}else{for(var _i32=offset;model.at(_i32)&&"text"===model.at(_i32).mode&&!/\s/.test(model.at(_i32).value);)_i32+=dir;result=model.at(_i32)?_i32:_i32-dir;for(var _match4=!0;model.at(_i32)&&_match4;)(_match4="text"===model.at(_i32).mode&&/\s/.test(model.at(_i32).value))&&(result=_i32),_i32+=dir;result=model.at(_i32)?_i32-2*dir:_i32-dir}return result-(dir>0?0:1)}function skip(model,direction,options){var _a3,_b3,_c2,_d2,_e,_f,_g,previousPosition=model.position;null!=(_a3=null==options?void 0:options.extend)&&_a3||model.collapseSelection(direction);var atom=model.at(model.position);if("forward"===direction&&("subsup"===atom.type&&(atom=atom.rightSibling)||(atom=model.at(model.position+1))),!atom)return model.announce("plonk"),!1;var offset=model.offsetOf(atom);if(atom instanceof TextAtom)offset=wordBoundaryOffset(model,offset,direction);else if(atom instanceof LatexAtom)if(atom.isSuggestion)for(console.assert("forward"===direction);atom&&atom instanceof LatexAtom;)atom.isSuggestion=!1,offset=model.offsetOf(atom),atom=atom.rightSibling;else if("forward"===direction){if(!((atom=atom.rightSibling)&&atom instanceof LatexAtom))return model.announce("plonk"),!1;for(;atom&&atom instanceof LatexAtom&&/[a-zA-Z\*]/.test(atom.value);)offset=model.offsetOf(atom),atom=atom.rightSibling}else{if(!((atom=atom.leftSibling)&&atom instanceof LatexAtom))return model.announce("plonk"),!1;for(;atom&&atom instanceof LatexAtom&&/[a-zA-Z\*]/.test(atom.value);)offset=model.offsetOf(atom),atom=atom.leftSibling}else if("forward"===direction&&"mopen"===atom.type){var level=0;do{"mopen"===atom.type?level+=1:"mclose"===atom.type&&(level-=1),atom=atom.rightSibling}while(!atom.isLastSibling&&0!==level);offset=model.offsetOf(atom.leftSibling)}else if("backward"===direction&&"mclose"===atom.type){var _level=0;do{"mopen"===atom.type?_level+=1:"mclose"===atom.type&&(_level-=1),atom=atom.leftSibling}while(!atom.isFirstSibling&&0!==_level);offset=model.offsetOf(atom)}else if("backward"===direction)if("first"===atom.type)for(;offset>0&&"first"===atom.type;)offset-=1,atom=model.at(offset);else{var type=atom.type;"subsup"===atom.type&&(offset=model.offsetOf(model.at(offset).leftSibling)),offset-=1;for(var nextType=null==(_b3=model.at(offset))?void 0:_b3.type;offset>=0&&nextType===type;)"subsup"===(null==(_c2=model.at(offset))?void 0:_c2.type)?offset=model.offsetOf(model.at(offset).leftSibling):offset-=1,nextType=model.at(offset).type}else{for(var _type=atom.type,_nextType=null==(_d2=model.at(offset))?void 0:_d2.type,lastOffset=model.lastOffset;offset<=lastOffset&&(_nextType===_type||"subsup"===_nextType);){for(;"subsup"===(null==(_e=model.at(offset).rightSibling)?void 0:_e.type);)offset=model.offsetOf(model.at(offset).rightSibling);offset+=1,_nextType=null==(_f=model.at(offset))?void 0:_f.type}offset-=1}if(null!=(_g=null==options?void 0:options.extend)&&_g){if(!model.setSelection(model.anchor,offset))return model.announce("plonk"),!1}else{if(offset===model.position)return model.announce("plonk"),!1;model.position=offset}return model.announce("move",previousPosition),model.mathfield.stopCoalescingUndo(),!0}function move(model,direction,options){var _a3,_b3;if(options=null!=options?options:{extend:!1},model.mathfield.adoptStyle="backward"===direction?"right":"left","forward"!==direction){var _getCommandSuggestion4=_slicedToArray(getCommandSuggestionRange(model),2),from=_getCommandSuggestion4[0],to=_getCommandSuggestion4[1];void 0!==from&&void 0!==to&&model.deleteAtoms([from,to])}if("upward"===direction)return function(model,options){var _a3,_b3,extend=null!=(_a3=null==options?void 0:options.extend)&&_a3;extend||model.collapseSelection("backward");for(var handleDeadEnd=function(){var _a4,_b4,result=!0;return model.silenceNotifications||(result=null==(_b4=null==(_a4=model.mathfield.host)?void 0:_a4.dispatchEvent(new CustomEvent("move-out",{detail:{direction:"upward"},cancelable:!0,bubbles:!0,composed:!0})))||_b4),model.announce(result?"plonk":"line"),result},baseAtom=model.at(model.position),atom=baseAtom;atom&&"below"!==atom.parentBranch&&!(Array.isArray(atom.parentBranch)&&atom.parent instanceof ArrayAtom);)atom=atom.parent;if(Array.isArray(null==atom?void 0:atom.parentBranch)&&atom.parent instanceof ArrayAtom){var arrayAtom=atom.parent;if(atom.parentBranch[0]<1)return handleDeadEnd();var rowAbove=atom.parentBranch[0]-1,aboveCell=arrayAtom.array[rowAbove][atom.parentBranch[1]];if(!aboveCell.some((function(a){return"prompt"===a.type&&!a.captureSelection}))&&model.mathfield.hasEditablePrompts)return handleDeadEnd();moveToClosestAtomVertically(model,baseAtom,aboveCell,extend,"up")}else{if(!atom)return handleDeadEnd();var branch=null!=(_b3=atom.parent.branch("above"))?_b3:atom.parent.createBranch("above");if(!branch.some((function(a){return"prompt"===a.type&&a.placeholderId}))&&model.mathfield.hasEditablePrompts)return handleDeadEnd();moveToClosestAtomVertically(model,baseAtom,branch,extend,"up")}return model.mathfield.stopCoalescingUndo(),!0}(model,options);if("downward"===direction)return function(model,options){var _a3,_b3,extend=null!=(_a3=null==options?void 0:options.extend)&&_a3;extend||model.collapseSelection("forward");for(var handleDeadEnd=function(){var _a4,_b4,result=!0;return model.silenceNotifications||(result=null==(_b4=null==(_a4=model.mathfield.host)?void 0:_a4.dispatchEvent(new CustomEvent("move-out",{detail:{direction:"downward"},cancelable:!0,bubbles:!0,composed:!0})))||_b4),model.announce(result?"plonk":"line"),result},baseAtom=model.at(model.position),atom=baseAtom;atom&&"above"!==atom.parentBranch&&!(Array.isArray(atom.parentBranch)&&atom.parent instanceof ArrayAtom);)atom=atom.parent;if(Array.isArray(null==atom?void 0:atom.parentBranch)&&atom.parent instanceof ArrayAtom){var arrayAtom=atom.parent;if(atom.parentBranch[0]+1>arrayAtom.array.length-1)return handleDeadEnd();var rowBelow=atom.parentBranch[0]+1,belowCell=arrayAtom.array[rowBelow][atom.parentBranch[1]];if(!belowCell.some((function(a){return"prompt"===a.type&&!a.captureSelection}))&&model.mathfield.hasEditablePrompts)return handleDeadEnd();moveToClosestAtomVertically(model,baseAtom,belowCell,extend,"down")}else{if(!atom)return handleDeadEnd();var branch=null!=(_b3=atom.parent.branch("below"))?_b3:atom.parent.createBranch("below");if(!branch.some((function(a){return"prompt"===a.type}))&&model.mathfield.hasEditablePrompts)return handleDeadEnd();moveToClosestAtomVertically(model,baseAtom,branch,extend,"down")}return!0}(model,options);if(options.extend){var pos2=nextValidPosition(model,model.position,direction);pos2<0&&(pos2=0),pos2>model.lastOffset&&(pos2=model.lastOffset);var result=model.setSelection(model.anchor,pos2);return model.mathfield.stopCoalescingUndo(),result}if(model.selectionIsPlaceholder){model.collapseSelection(direction);var _result5=move(model,direction);return model.mathfield.stopCoalescingUndo(),_result5}var pos=model.position,previousPosition=pos;if(model.collapseSelection(direction)&&isValidPosition(model,pos=model.position)||(pos=nextValidPosition(model,pos,direction)),pos<0||pos>model.lastOffset){var _result6=!0;return model.silenceNotifications||(_result6=null==(_b3=null==(_a3=model.mathfield.host)?void 0:_a3.dispatchEvent(new CustomEvent("move-out",{detail:{direction:direction},cancelable:!0,bubbles:!0,composed:!0})))||_b3),_result6&&model.announce("plonk"),_result6}return model.setPositionHandlingPlaceholder(pos),model.mathfield.stopCoalescingUndo(),model.announce("move",previousPosition),!0}function nextValidPosition(model,pos,direction){return(pos+="forward"===direction?1:-1)<0||pos>model.lastOffset||isValidPosition(model,pos)?pos:nextValidPosition(model,pos,direction)}function isValidPosition(model,pos){for(var _a3,atom=model.at(pos),parent=atom.parent;parent&&!parent.inCaptureSelection;)parent=parent.parent;if(null==parent?void 0:parent.inCaptureSelection)return!1;if(null==(_a3=atom.parent)?void 0:_a3.skipBoundary){if(!atom.isFirstSibling&&atom.isLastSibling)return!1;if("first"===atom.type)return!1}return!(model.mathfield.hasEditablePrompts&&!atom.parentPrompt)}function moveToClosestAtomVertically(model,fromAtom,toAtoms,extend,direction){var hasEditablePrompts=model.mathfield.hasEditablePrompts,editableAtoms=hasEditablePrompts?toAtoms.filter((function(a){return"prompt"===a.type&&!a.captureSelection})):toAtoms,fromX=getLocalDOMRect(model.mathfield.getHTMLElement(fromAtom)).right,targetSelection=model.offsetOf(function(mathfield,search,x){for(var prevX=1/0,i=0;i<search.length;i++){var toX=getLocalDOMRect(mathfield.getHTMLElement(search[i])).right,abs=Math.abs(x-toX);if(!(abs<=prevX))break;prevX=abs}return search[i-1]}(model.mathfield,editableAtoms,fromX))-(hasEditablePrompts?1:0);if(extend){var newSelection,_model$selection$rang=_slicedToArray(model.selection.ranges[0],2),left=_model$selection$rang[0],right=_model$selection$rang[1];newSelection=targetSelection<("up"===direction?left:right)?{ranges:[[targetSelection,right]],direction:"backward"}:{ranges:[[left,targetSelection]],direction:"forward"},model.setSelection(newSelection)}else model.setPositionHandlingPlaceholder(targetSelection);model.announce("move ".concat(direction))}function removeHighlight(element){if(element&&(element.classList.remove("ML__highlight"),element.children)){var _step154,_iterator154=_createForOfIteratorHelper(element.children);try{for(_iterator154.s();!(_step154=_iterator154.n()).done;)removeHighlight(_step154.value)}catch(err){_iterator154.e(err)}finally{_iterator154.f()}}}function highlightAtomID(element,atomID){var _a3;element&&(atomID&&(null==(_a3=element.dataset)?void 0:_a3.atomId)!==atomID?(element.classList.remove("ML__highlight"),element.children&&element.children.length>0&&_toConsumableArray(element.children).forEach((function(x){x instanceof HTMLElement&&highlightAtomID(x,atomID)}))):(element.classList.add("ML__highlight"),element.children&&element.children.length>0&&_toConsumableArray(element.children).forEach((function(x){x instanceof HTMLElement&&highlightAtomID(x)}))))}register2({deleteAll:function(model){return contentWillChange(model,{inputType:"deleteContent"})&&deleteRange(model,[0,-1],"deleteContent")},deleteForward:function(model){return function(model){return!!model.mathfield.isSelectionEditable&&!!contentWillChange(model,{inputType:"deleteContentForward"})&&(model.selectionIsCollapsed?model.deferNotifications({content:!0,selection:!0,type:"deleteContentForward"},(function(){var _a3,_b3,target=model.at(model.position).rightSibling;if(!target||!onDelete(model,"forward",target)){if(target){if(model.at(model.position).isLastSibling&&onDelete(model,"forward",target.parent,target.parentBranch))return}else{if((target=model.at(model.position)).isLastSibling&&onDelete(model,"forward",target.parent,target.parentBranch))return;target=void 0}if(model.position!==model.lastOffset&&target){target.parent.removeChild(target);for(var sibling=null==(_a3=model.at(model.position))?void 0:_a3.rightSibling;"subsup"===(null==sibling?void 0:sibling.type);)sibling.parent.removeChild(sibling),sibling=null==(_b3=model.at(model.position))?void 0:_b3.rightSibling;model.announce("delete",void 0,[target])}else model.announce("plonk")}})):deleteRange(model,range(model.selection),"deleteContentForward"))}(model)},deleteBackward:function(model){return function(model){return!!model.mathfield.isSelectionEditable&&!!contentWillChange(model,{inputType:"deleteContentBackward"})&&(model.selectionIsCollapsed?model.deferNotifications({content:!0,selection:!0,type:"deleteContentBackward"},(function(){var target=model.at(model.position);if(!target||!onDelete(model,"backward",target)){if(null==target?void 0:target.isFirstSibling){if(onDelete(model,"backward",target.parent,target.parentBranch))return;target=null}target?(model.position=model.offsetOf(target.leftSibling),target.parent.removeChild(target),model.announce("delete",void 0,[target])):model.announce("plonk")}})):deleteRange(model,range(model.selection),"deleteContentBackward"))}(model)},deleteNextWord:function(model){return contentWillChange(model,{inputType:"deleteWordForward"})&&deleteRange(model,[model.anchor,wordBoundaryOffset(model,model.position,"forward")],"deleteWordForward")},deletePreviousWord:function(model){return contentWillChange(model,{inputType:"deleteWordBackward"})&&deleteRange(model,[model.anchor,wordBoundaryOffset(model,model.position,"backward")],"deleteWordBackward")},deleteToGroupStart:function(model){return contentWillChange(model,{inputType:"deleteSoftLineBackward"})&&deleteRange(model,[model.anchor,model.offsetOf(model.at(model.position).firstSibling)],"deleteSoftLineBackward")},deleteToGroupEnd:function(model){return contentWillChange(model,{inputType:"deleteSoftLineForward"})&&deleteRange(model,[model.anchor,model.offsetOf(model.at(model.position).lastSibling)],"deleteSoftLineForward")},deleteToMathFieldStart:function(model){return contentWillChange(model,{inputType:"deleteHardLineBackward"})&&deleteRange(model,[model.anchor,0],"deleteHardLineBackward")},deleteToMathFieldEnd:function(model){return contentWillChange(model,{inputType:"deleteHardLineForward"})&&deleteRange(model,[model.anchor,-1],"deleteHardLineForward")}},{target:"model",audioFeedback:"delete",canUndo:!0,changeContent:!0,changeSelection:!0}),isBrowser()||console.error('MathLive 0.94.6: this version of the MathLive library is for use in the browser. A subset of the API is available on the server side in the "mathlive-ssr" library. If using server side rendering (with React for example) you may want to do a dynamic import of the MathLive library inside a `useEffect()` call.');var gDeferredState=new WeakMap,DEPRECATED_OPTIONS={letterShapeStyle:"mf.letterShapeStyle = ...",horizontalSpacingScale:'Removed. Use `"thinmuskip"`, `"medmuskip"`, and `"thickmuskip"` registers ',macros:"mf.macros = ...",registers:"mf.registers = ...",backgroundColorMap:"mf.backgroundColorMap = ...",colorMap:"mf.colorMap = ...",enablePopover:"mf.popoverPolicy = ...",mathModeSpace:"mf.mathModeSpace = ...",placeholderSymbol:"mf.placeholderSymbol = ...",readOnly:"mf.readOnly = ...",removeExtraneousParentheses:"mf.removeExtraneousParentheses = ...",scriptDepth:"mf.scriptDepth = ...",smartFence:"mf.smartFence = ...",smartMode:"mf.smartMode = ...",smartSuperscript:"mf.smartSuperscript = ...",inlineShortcutTimeout:"mf.inlineShortcutTimeout = ...",inlineShortcuts:"mf.inlineShortcuts = ...",keybindings:"mf.keybindings = ...",virtualKeyboardMode:"mf.mathVirtualKeyboardPolicy = ...",customVirtualKeyboardLayers:"mathVirtualKeyboard.layers = ...",customVirtualKeyboards:"mathVirtualKeyboard.layouts = ...",keypressSound:"mathVirtualKeyboard.keypressSound = ...",keypressVibration:"mathVirtualKeyboard.keypressVibration = ...",plonkSound:"mathVirtualKeyboard.plonkSound = ...",virtualKeyboardContainer:"mathVirtualKeyboard.container = ...",virtualKeyboardLayout:"mathVirtualKeyboard.alphabeticLayout = ...",virtualKeyboardTheme:"No longer supported",virtualKeyboardToggleGlyph:"No longer supported",virtualKeyboardToolbar:"mathVirtualKeyboard.editToolbar = ...",virtualKeyboards:"Use `mathVirtualKeyboard.layouts`",speechEngine:"`MathfieldElement.speechEngine`",speechEngineRate:"`MathfieldElement.speechEngineRate`",speechEngineVoice:"`MathfieldElement.speechEngineVoice`",textToSpeechMarkup:"`MathfieldElement.textToSpeechMarkup`",textToSpeechRules:"`MathfieldElement.textToSpeechRules`",textToSpeechRulesOptions:"`MathfieldElement.textToSpeechRulesOptions`",readAloudHook:"`MathfieldElement.readAloudHook`",speakHook:"`MathfieldElement.speakHook`",computeEngine:"`MathfieldElement.computeEngine`",fontsDirectory:"`MathfieldElement.fontsDirectory`",soundsDirectory:"`MathfieldElement.soundsDirectory`",createHTML:"`MathfieldElement.createHTML`",onExport:"`MathfieldElement.onExport`",onInlineShortcut:"`MathfieldElement.onInlineShortcut`",onScrollIntoView:"`MathfieldElement.onScrollIntoView`",locale:"MathfieldElement.locale = ...",strings:"MathfieldElement.strings = ...",decimalSeparator:"MathfieldElement.decimalSeparator = ...",fractionNavigationOrder:"MathfieldElement.fractionNavigationOrder = ..."},_MathfieldElement=function(_HTMLElement){_inherits(_MathfieldElement,_wrapNativeSuper(HTMLElement));var _playSound,_loadSound,_super36=_createSuper(_MathfieldElement);function _MathfieldElement(options){var _this48;if(_classCallCheck(this,_MathfieldElement),_this48=_super36.call(this),options){for(var warnings=[],_i33=0,_Object$keys12=Object.keys(options);_i33<_Object$keys12.length;_i33++){var key=_Object$keys12[_i33];if(DEPRECATED_OPTIONS[key])if(DEPRECATED_OPTIONS[key].startsWith("mf."))if(DEPRECATED_OPTIONS[key].startsWith("mf.".concat(key)))warnings.push("Option `".concat(key,"` cannot be used as a constructor option. Use ").concat(DEPRECATED_OPTIONS[key]));else{var newName=DEPRECATED_OPTIONS[key].match(/([a-zA-Z]+) =/);warnings.push("Option `".concat(key,"` has been renamed `").concat(newName[1],"`"))}else warnings.push("Option `".concat(key,"` cannot be used as a constructor option. Use ").concat(DEPRECATED_OPTIONS[key]))}if(warnings.length>0){console.group("%cMathLive 0.94.6: %cInvalid Options","color:#12b; font-size: 1.1rem","color:#db1111; font-size: 1.1rem"),console.warn("Some of the options passed to `new MathFieldElement(...)` are invalid. \n          See https://cortexjs.io/mathlive/changelog/ for details.");var _step157,_iterator157=_createForOfIteratorHelper(warnings);try{for(_iterator157.s();!(_step157=_iterator157.n()).done;){var warning=_step157.value;console.warn(warning)}}catch(err){_iterator157.e(err)}finally{_iterator157.f()}console.groupEnd()}}return isElementInternalsSupported()&&(_this48._internals=_this48.attachInternals(),_this48._internals.role="math",_this48._internals.ariaLabel="math input field",_this48._internals.ariaMultiLine="false"),_this48.attachShadow({mode:"open",delegatesFocus:!0}),_this48.shadowRoot.adoptedStyleSheets=[getStylesheet("core"),getStylesheet("mathfield"),getStylesheet("mathfield-element")],_this48.shadowRoot.innerHTML='<span style="pointer-events:auto"></span><slot style="display:none"></slot>',options&&_this48._setOptions(options),_this48}return _createClass(_MathfieldElement,[{key:"onPointerDown",value:function(){var _this49=this;window.addEventListener("pointerup",(function(evt){var _a3;evt.target!==_this49||(null==(_a3=_this49._mathfield)?void 0:_a3.disabled)||_this49.dispatchEvent(new MouseEvent("click",{altKey:evt.altKey,button:evt.button,buttons:evt.buttons,clientX:evt.clientX,clientY:evt.clientY,ctrlKey:evt.ctrlKey,metaKey:evt.metaKey,movementX:evt.movementX,movementY:evt.movementY,relatedTarget:evt.relatedTarget,screenX:evt.screenX,screenY:evt.screenY,shiftKey:evt.shiftKey}))}),{once:!0})}},{key:"getPromptValue",value:function(placeholderId,format){var _a3,_b3;return null!=(_b3=null==(_a3=this._mathfield)?void 0:_a3.getPromptValue(placeholderId,format))?_b3:""}},{key:"getPrompts",value:function(filter){var _a3,_b3;return null!=(_b3=null==(_a3=this._mathfield)?void 0:_a3.getPrompts(filter))?_b3:[]}},{key:"form",get:function(){var _a3;return null==(_a3=this._internals)?void 0:_a3.form}},{key:"name",get:function(){var _a3;return null!=(_a3=this.getAttribute("name"))?_a3:""}},{key:"type",get:function(){return this.localName}},{key:"mode",get:function(){var _a3,_b3;return null!=(_b3=null==(_a3=this._mathfield)?void 0:_a3.model.mode)?_b3:"math"},set:function(value){this._mathfield&&(this._mathfield.model.mode=value)}},{key:"expression",get:function(){if(this._mathfield)return window[Symbol.for("io.cortexjs.compute-engine")]||console.error('MathLive 0.94.6: The CortexJS Compute Engine library is not available.\n        \n        Load the library, for example with:\n        \n        import "https://unpkg.com/@cortex-js/compute-engine?module"'),this._mathfield.expression},set:function(mathJson){var _a3,_b3;if(this._mathfield){var latex=null!=(_b3=null==(_a3=_MathfieldElement.computeEngine)?void 0:_a3.box(mathJson).latex)?_b3:null;null!==latex&&this._mathfield.setValue(latex),window[Symbol.for("io.cortexjs.compute-engine")]||console.error('MathLive 0.94.6: The CortexJS Compute Engine library is not available.\n        \n        Load the library, for example with:\n        \n        import "https://unpkg.com/@cortex-js/compute-engine?module"')}}},{key:"errors",get:function(){var _a3,_b3;return null!=(_b3=null==(_a3=this._mathfield)?void 0:_a3.errors)?_b3:[]}},{key:"_getOptions",value:function(keys){return this._mathfield?get(this._mathfield.options,keys):gDeferredState.has(this)?__spreadValues({},get(__spreadValues(__spreadValues({},getDefault()),update(gDeferredState.get(this).options)),keys)):null}},{key:"getOptions",value:function(keys){return console.warn("%cMathLive 0.94.6: %cDeprecated Usage%c\n      `mf.getOptions()` is deprecated. Read the property directly on the mathfield instead.\n      See https://cortexjs.io/mathlive/changelog/ for details.","color:#12b; font-size: 1.1rem","color:#db1111; font-size: 1.1rem","color: inherit, font-size: 1rem"),this._mathfield?get(this._mathfield.options,keys):gDeferredState.has(this)?get(__spreadValues(__spreadValues({},getDefault()),update(gDeferredState.get(this).options)),keys):null}},{key:"reflectAttributes",value:function(){var _this50=this,defaultOptions=getDefault(),options=this._getOptions();Object.keys(_MathfieldElement.optionsAttributes).forEach((function(x){var prop=toCamelCase(x);"on/off"===_MathfieldElement.optionsAttributes[x]?defaultOptions[prop]!==options[prop]?_this50.setAttribute(x,options[prop]?"on":"off"):_this50.removeAttribute(x):defaultOptions[prop]!==options[prop]&&("boolean"===_MathfieldElement.optionsAttributes[x]?options[prop]?_this50.setAttribute(x,""):_this50.removeAttribute(x):"string"!=typeof options[prop]&&"number"!=typeof options[prop]||_this50.setAttribute(x,options[prop].toString()))}))}},{key:"getOption",value:function(key){return console.warn("%cMathLive 0.94.6: %cDeprecated Usage%c\n      `mf.getOption()` is deprecated. Read the property directly on the mathfield instead.\n      See https://cortexjs.io/mathlive/changelog/ for details.","color:#12b; font-size: 1.1rem","color:#db1111; font-size: 1.1rem","color: inherit, font-size: 1rem"),this._getOptions([key])[key]}},{key:"_getOption",value:function(key){return this._getOptions([key])[key]}},{key:"_setOptions",value:function(options){if(this._mathfield)this._mathfield.setOptions(options);else if(gDeferredState.has(this)){var mergedOptions=__spreadValues(__spreadValues({},gDeferredState.get(this).options),options);gDeferredState.set(this,__spreadProps(__spreadValues({},gDeferredState.get(this)),{selection:{ranges:mergedOptions.readOnly?[[0,0]]:[[0,-1]]},options:mergedOptions}))}else gDeferredState.set(this,{value:void 0,selection:{ranges:[[0,0]]},options:options});this.reflectAttributes()}},{key:"setOptions",value:function(options){console.group("%cMathLive 0.94.6: %cDeprecated Usage","color:#12b; font-size: 1.1rem","color:#db1111; font-size: 1.1rem"),console.warn(" `mf.setOptions()` is deprecated. Set the property directly on the mathfield instead.\n      See https://cortexjs.io/mathlive/changelog/ for details.");for(var _i34=0,_Object$keys13=Object.keys(options);_i34<_Object$keys13.length;_i34++){var key=_Object$keys13[_i34];DEPRECATED_OPTIONS[key]&&console.warn("`mf.setOptions({".concat(key,":...})` -> ").concat(DEPRECATED_OPTIONS[key]))}console.groupEnd(),this._setOptions(options)}},{key:"executeCommand",value:function(command){var _a3,_b3;return null!=(_b3=null==(_a3=this._mathfield)?void 0:_a3.executeCommand(command))&&_b3}},{key:"getValue",value:function(arg1,arg2,arg3){var _a3,_b3;if(this._mathfield)return this._mathfield.model.getValue(arg1,arg2,arg3);if(gDeferredState.has(this)){var start,end,format=void 0;if(isSelection(arg1)){var _arg1$ranges$=_slicedToArray(arg1.ranges[0],2);start=_arg1$ranges$[0],end=_arg1$ranges$[1],format=arg2}else if(isRange(arg1)){var _arg4=_slicedToArray(arg1,2);start=_arg4[0],end=_arg4[1],format=arg2}else isOffset(arg1)&&isOffset(arg2)?(start=arg1,end=arg2,format=arg3):(start=0,end=-1,format=arg1);if((void 0===format||"latex"===format)&&0===start&&-1===end)return null!=(_b3=null!=(_a3=gDeferredState.get(this).value)?_a3:this.textContent)?_b3:""}return""}},{key:"setValue",value:function(value,options){if(this._mathfield&&void 0!==value)return null!=options||(options={silenceNotifications:!0,mode:"math"}),void this._mathfield.setValue(value,options);if(gDeferredState.has(this)){var options2=gDeferredState.get(this).options;gDeferredState.set(this,{value:value,selection:{ranges:options2.readOnly?[[0,0]]:[[0,-1]],direction:"forward"},options:options2})}else{var attrOptions=getOptionsFromAttributes(this);gDeferredState.set(this,{value:value,selection:{ranges:attrOptions.readOnly?[[0,0]]:[[0,-1]],direction:"forward"},options:attrOptions})}}},{key:"hasFocus",value:function(){var _a3,_b3;return null!=(_b3=null==(_a3=this._mathfield)?void 0:_a3.hasFocus())&&_b3}},{key:"focus",value:function(){var _a3;null==(_a3=this._mathfield)||_a3.focus()}},{key:"blur",value:function(){var _a3;null==(_a3=this._mathfield)||_a3.blur()}},{key:"select",value:function(){var _a3;null==(_a3=this._mathfield)||_a3.select()}},{key:"insert",value:function(s,options){var _a3,_b3;return null!=(_b3=null==(_a3=this._mathfield)?void 0:_a3.insert(s,options))&&_b3}},{key:"applyStyle",value:function(style,options){var _a3;return null==(_a3=this._mathfield)?void 0:_a3.applyStyle(style,options)}},{key:"caretPoint",get:function(){var _a3,_b3;return null!=(_b3=null==(_a3=this._mathfield)?void 0:_a3.getCaretPoint())?_b3:null},set:function(point){var _a3;point&&(null==(_a3=this._mathfield)||_a3.setCaretPoint(point.x,point.y))}},{key:"setCaretPoint",value:function(x,y){var _a3,_b3;return null!=(_b3=null==(_a3=this._mathfield)?void 0:_a3.setCaretPoint(x,y))&&_b3}},{key:"offsetFromPoint",value:function(x,y,options){return this._mathfield?_offsetFromPoint(this._mathfield,x,y,options):-1}},{key:"hitboxFromOffset",value:function(offset){if(!this._mathfield)return null;var atom=this._mathfield.model.at(offset);if(!atom)return null;var bounds=getAtomBounds(this._mathfield,atom);return bounds?new DOMRect(bounds.left,bounds.top,bounds.right-bounds.left,bounds.bottom-bounds.top):null}},{key:"resetUndo",value:function(){var _a3;null==(_a3=this._mathfield)||_a3.resetUndo()}},{key:"canUndo",value:function(){return!!this._mathfield&&this._mathfield.canUndo()}},{key:"canRedo",value:function(){return!!this._mathfield&&this._mathfield.canRedo()}},{key:"handleEvent",value:function(evt){var _a3,_b3;"pointerdown"===evt.type&&this.onPointerDown(),"focus"===evt.type&&(null==(_a3=this._mathfield)||_a3.focus()),"blur"===evt.type&&(null==(_b3=this._mathfield)||_b3.blur())}},{key:"connectedCallback",value:function(){var _a3,_b3,_c2,_this51=this;this.shadowRoot.host.addEventListener("pointerdown",this,!0),this.shadowRoot.host.addEventListener("focus",this,!0),this.shadowRoot.host.addEventListener("blur",this,!0),isElementInternalsSupported()||(this.hasAttribute("role")||this.setAttribute("role","math"),this.hasAttribute("aria-label")||this.setAttribute("aria-label","math input field"),this.setAttribute("aria-multiline","false")),this.hasAttribute("contenteditable")||this.setAttribute("contenteditable","true"),this.hasAttribute("tabindex")||this.setAttribute("tabindex","0");var slot=this.shadowRoot.querySelector("slot:not([name])"),value="";if(value=this.hasAttribute("value")?null!=(_a3=this.getAttribute("value"))?_a3:"":null!=(_b3=null==slot?void 0:slot.assignedNodes().map((function(x){return 3===x.nodeType?x.textContent:""})).join("").trim())?_b3:"",this._mathfield=new MathfieldPrivate(this.shadowRoot.querySelector(":host > span"),__spreadProps(__spreadValues({},gDeferredState.has(this)?gDeferredState.get(this).options:getOptionsFromAttributes(this)),{eventSink:this,value:value})),!gDeferredState.has(this)){this.upgradeProperty("disabled"),this.upgradeProperty("readonly");for(var _i35=0,_Object$keys14=Object.keys(_MathfieldElement.optionsAttributes);_i35<_Object$keys14.length;_i35++){var attr=_Object$keys14[_i35];this.upgradeProperty(toCamelCase(attr))}}(null==(_c2=this._mathfield)?void 0:_c2.model)?(gDeferredState.has(this)&&this._mathfield.model.deferNotifications({content:!1,selection:!1},(function(){var value2=gDeferredState.get(_this51).value;void 0!==value2&&_this51._mathfield.setValue(value2),_this51._mathfield.model.selection=gDeferredState.get(_this51).selection,gDeferredState.delete(_this51)})),window.queueMicrotask((function(){_this51.isConnected&&_this51.dispatchEvent(new Event("mount",{cancelable:!1,bubbles:!0,composed:!0}))})),loadFonts()):this._mathfield=null}},{key:"disconnectedCallback",value:function(){var _this52=this;if(this.shadowRoot.host.removeEventListener("pointerdown",this,!0),this._mathfield){window.queueMicrotask((function(){return _this52.dispatchEvent(new Event("unmount",{cancelable:!1,bubbles:!0,composed:!0}))}));var options=get(this._mathfield.options,Object.keys(_MathfieldElement.optionsAttributes).map((function(x){return toCamelCase(x)})));gDeferredState.set(this,{value:this._mathfield.getValue(),selection:this._mathfield.model.selection,options:options}),this._mathfield.dispose(),this._mathfield=null}}},{key:"upgradeProperty",value:function(prop){if(this.hasOwnProperty(prop)){var value=this[prop];delete this[prop],"readonly"!==prop&&"read-only"!==prop||(prop="readOnly"),this[prop]=value}}},{key:"attributeChangedCallback",value:function(name,oldValue,newValue){if(oldValue!==newValue){var hasValue=null!==newValue;switch(name){case"contenteditable":this._mathfield&&requestUpdate(this._mathfield);break;case"disabled":this.disabled=hasValue;break;case"read-only":case"readonly":this.readOnly=hasValue}}}},{key:"readonly",get:function(){return this.hasAttribute("readonly")||this.hasAttribute("read-only")},set:function(value){var isReadonly=Boolean(value);isReadonly?(this.setAttribute("readonly",""),isElementInternalsSupported()?this._internals.ariaReadOnly="true":this.setAttribute("aria-readonly","true"),this.setAttribute("aria-readonly","true")):(isElementInternalsSupported()?this._internals.ariaReadOnly="false":this.removeAttribute("aria-readonly"),this.removeAttribute("readonly"),this.removeAttribute("read-only")),this._setOptions({readOnly:isReadonly})}},{key:"disabled",get:function(){return this.hasAttribute("disabled")},set:function(value){var _a3,isDisabled=Boolean(value);isDisabled?this.setAttribute("disabled",""):this.removeAttribute("disabled"),isElementInternalsSupported()?this._internals.ariaDisabled=isDisabled?"true":"false":this.setAttribute("aria-disabled",isDisabled?"true":"false"),isDisabled&&(null==(_a3=this._mathfield)?void 0:_a3.hasFocus)&&window.mathVirtualKeyboard.visible&&this._mathfield.executeCommand("hideVirtualKeyboard")}},{key:"value",get:function(){return this.getValue()},set:function(value){this.setValue(value)}},{key:"defaultMode",get:function(){return this._getOption("defaultMode")},set:function(value){this._setOptions({defaultMode:value})}},{key:"macros",get:function(){return this._getOption("macros")},set:function(value){this._setOptions({macros:value})}},{key:"registers",get:function(){return this._getOption("registers")},set:function(value){this._setOptions({registers:value})}},{key:"colorMap",get:function(){return this._getOption("colorMap")},set:function(value){this._setOptions({colorMap:value})}},{key:"backgroundColorMap",get:function(){return this._getOption("backgroundColorMap")},set:function(value){this._setOptions({backgroundColorMap:value})}},{key:"letterShapeStyle",get:function(){return this._getOption("letterShapeStyle")},set:function(value){this._setOptions({letterShapeStyle:value})}},{key:"minFontScale",get:function(){return this._getOption("minFontScale")},set:function(value){this._setOptions({minFontScale:value})}},{key:"smartMode",get:function(){return this._getOption("smartMode")},set:function(value){this._setOptions({smartMode:value})}},{key:"smartFence",get:function(){return this._getOption("smartFence")},set:function(value){this._setOptions({smartFence:value})}},{key:"smartSuperscript",get:function(){return this._getOption("smartSuperscript")},set:function(value){this._setOptions({smartSuperscript:value})}},{key:"scriptDepth",get:function(){return this._getOption("scriptDepth")},set:function(value){this._setOptions({scriptDepth:value})}},{key:"removeExtraneousParentheses",get:function(){return this._getOption("removeExtraneousParentheses")},set:function(value){this._setOptions({removeExtraneousParentheses:value})}},{key:"mathModeSpace",get:function(){return this._getOption("mathModeSpace")},set:function(value){this._setOptions({mathModeSpace:value})}},{key:"placeholderSymbol",get:function(){return this._getOption("placeholderSymbol")},set:function(value){this._setOptions({placeholderSymbol:value})}},{key:"popoverPolicy",get:function(){return this._getOption("popoverPolicy")},set:function(value){this._setOptions({popoverPolicy:value})}},{key:"mathVirtualKeyboardPolicy",get:function(){return this._getOption("mathVirtualKeyboardPolicy")},set:function(value){this._setOptions({mathVirtualKeyboardPolicy:value})}},{key:"inlineShortcuts",get:function(){return this._getOption("inlineShortcuts")},set:function(value){this._setOptions({inlineShortcuts:value})}},{key:"inlineShortcutTimeout",get:function(){return this._getOption("inlineShortcutTimeout")},set:function(value){this._setOptions({inlineShortcutTimeout:value})}},{key:"keybindings",get:function(){return this._getOption("keybindings")},set:function(value){this._setOptions({keybindings:value})}},{key:"onInlineShortcut",get:function(){return this._getOption("onInlineShortcut")},set:function(value){this._setOptions({onInlineShortcut:value})}},{key:"onScrollIntoView",get:function(){return this._getOption("onScrollIntoView")},set:function(value){this._setOptions({onScrollIntoView:value})}},{key:"onExport",get:function(){return this._getOption("onExport")},set:function(value){this._setOptions({onExport:value})}},{key:"readOnly",get:function(){return this._getOption("readOnly")},set:function(value){this._setOptions({readOnly:value})}},{key:"isSelectionEditable",get:function(){var _a3,_b3;return null!=(_b3=null==(_a3=this._mathfield)?void 0:_a3.isSelectionEditable)&&_b3}},{key:"setPromptState",value:function(id,state,locked){var _a3;null==(_a3=this._mathfield)||_a3.setPromptState(id,state,locked)}},{key:"getPromptState",value:function(id){var _a3,_b3;return null!=(_b3=null==(_a3=this._mathfield)?void 0:_a3.getPromptState(id))?_b3:[void 0,!0]}},{key:"setPromptContent",value:function(id,content,insertOptions){var _a3;null==(_a3=this._mathfield)||_a3.setPromptValue(id,content,insertOptions)}},{key:"stripPromptContent",value:function(filter){var _a3,_b3;return null!=(_b3=null==(_a3=this._mathfield)?void 0:_a3.stripPromptContent(filter))?_b3:{}}},{key:"virtualKeyboardTargetOrigin",get:function(){return this._getOption("virtualKeyboardTargetOrigin")},set:function(value){this._setOptions({virtualKeyboardTargetOrigin:value})}},{key:"selection",get:function(){return this._mathfield?this._mathfield.model.selection:gDeferredState.has(this)?gDeferredState.get(this).selection:{ranges:[[0,0]],direction:"forward"}},set:function(sel){"number"==typeof sel&&(sel={ranges:[[sel,sel]]}),this._mathfield?this._mathfield.model.selection=sel:gDeferredState.has(this)?gDeferredState.set(this,__spreadProps(__spreadValues({},gDeferredState.get(this)),{selection:sel})):gDeferredState.set(this,{value:void 0,selection:sel,options:getOptionsFromAttributes(this)})}},{key:"selectionIsCollapsed",get:function(){var selection=this.selection;return 1===selection.ranges.length&&selection.ranges[0][0]===selection.ranges[0][1]}},{key:"position",get:function(){return this._mathfield?this._mathfield.model.position:gDeferredState.has(this)?gDeferredState.get(this).selection.ranges[0][0]:0},set:function(offset){this._mathfield&&(this._mathfield.model.position=offset),gDeferredState.has(this)?gDeferredState.set(this,__spreadProps(__spreadValues({},gDeferredState.get(this)),{selection:{ranges:[[offset,offset]]}})):gDeferredState.set(this,{value:void 0,selection:{ranges:[[offset,offset]]},options:getOptionsFromAttributes(this)})}},{key:"getOffsetDepth",value:function(offset){var _a3;return this._mathfield?(null==(_a3=this._mathfield.model.at(offset))?void 0:_a3.treeDepth)-2:0}},{key:"lastOffset",get:function(){var _a3,_b3;return null!=(_b3=null==(_a3=this._mathfield)?void 0:_a3.model.lastOffset)?_b3:-1}}],[{key:"formAssociated",get:function(){return isElementInternalsSupported()}},{key:"optionsAttributes",get:function(){return{"default-mode":"string","letter-shape-style":"string","min-font-scale":"number","popover-policy":"string","math-mode-space":"string","read-only":"boolean","remove-extraneous-parentheses":"on/off","smart-fence":"on/off","smart-mode":"on/off","smart-superscript":"on/off","inline-shortcut-timeout":"string","script-depth":"string","virtual-keyboard-target-origin":"string","math-virtual-keyboard-policy":"string"}}},{key:"observedAttributes",get:function(){return[].concat(_toConsumableArray(Object.keys(this.optionsAttributes)),["contenteditable","disabled","readonly","read-only"])}},{key:"fontsDirectory",get:function(){return this._fontsDirectory},set:function(value){value!==this._fontsDirectory&&(this._fontsDirectory=value,function(){_reloadFonts.apply(this,arguments)}())}},{key:"soundsDirectory",get:function(){return this._soundsDirectory},set:function(value){this._soundsDirectory=value,this.audioBuffers={}}},{key:"keypressSound",get:function(){return this._keypressSound},set:function(value){var _a3,_b3,_c2;this.audioBuffers={},null===value?this._keypressSound={spacebar:null,return:null,delete:null,default:null}:"string"==typeof value?this._keypressSound={spacebar:value,return:value,delete:value,default:value}:"object"===_typeof(value)&&"default"in value&&(this._keypressSound={spacebar:null!=(_a3=value.spacebar)?_a3:value.default,return:null!=(_b3=value.return)?_b3:value.default,delete:null!=(_c2=value.delete)?_c2:value.default,default:value.default})}},{key:"plonkSound",get:function(){return this._plonkSound},set:function(value){this.audioBuffers={},this._plonkSound=value}},{key:"audioContext",get:function(){return this._audioContext||(this._audioContext=new AudioContext),this._audioContext}},{key:"speechEngine",get:function(){return this._speechEngine},set:function(value){this._speechEngine=value}},{key:"speechEngineRate",get:function(){return this._speechEngineRate},set:function(value){this._speechEngineRate=value}},{key:"speechEngineVoice",get:function(){return this._speechEngineVoice},set:function(value){this._speechEngineVoice=value}},{key:"textToSpeechMarkup",get:function(){return this._textToSpeechMarkup},set:function(value){this._textToSpeechMarkup=value}},{key:"textToSpeechRules",get:function(){return this._textToSpeechRules},set:function(value){this._textToSpeechRules=value}},{key:"textToSpeechRulesOptions",get:function(){return this._textToSpeechRulesOptions},set:function(value){this._textToSpeechRulesOptions=value}},{key:"locale",get:function(){return l10n.locale},set:function(value){"auto"===value&&(value=navigator.language.slice(0,5)),l10n.locale=value}},{key:"decimalSeparator",get:function(){return this._decimalSeparator},set:function(value){this._decimalSeparator=value,this._computeEngine&&(this._computeEngine.latexOptions.decimalMarker=","===this.decimalSeparator?"{,}":".")}},{key:"strings",get:function(){return l10n.strings},set:function(value){l10n.merge(value)}},{key:"computeEngine",get:function(){var _a3,_b3;if(void 0===this._computeEngine){var ComputeEngineCtor=null==(_a3=window[Symbol.for("io.cortexjs.compute-engine")])?void 0:_a3.ComputeEngine;ComputeEngineCtor?this._computeEngine=new ComputeEngineCtor:console.error('MathLive 0.94.6: The CortexJS Compute Engine library is not available.\n          \n          Load the library, for example with:\n          \n          import "https://unpkg.com/@cortex-js/compute-engine?module"'),this._computeEngine&&","===this.decimalSeparator&&(this._computeEngine.latexOptions.decimalMarker="{,}")}return null!=(_b3=this._computeEngine)?_b3:null},set:function(value){this._computeEngine=value}},{key:"loadSound",value:(_loadSound=_asyncToGenerator(regeneratorRuntime.mark((function _callee(sound){var soundFile,soundsDirectory,response,arrayBuffer,audioBuffer;return regeneratorRuntime.wrap((function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:delete this.audioBuffers[sound],soundFile="",_context3.t0=sound,_context3.next="keypress"===_context3.t0?5:"return"===_context3.t0?7:"spacebar"===_context3.t0?9:"delete"===_context3.t0?11:"plonk"===_context3.t0?13:15;break;case 5:return soundFile=this._keypressSound.default,_context3.abrupt("break",15);case 7:return soundFile=this._keypressSound.return,_context3.abrupt("break",15);case 9:return soundFile=this._keypressSound.spacebar,_context3.abrupt("break",15);case 11:return soundFile=this._keypressSound.delete,_context3.abrupt("break",15);case 13:return soundFile=this.plonkSound,_context3.abrupt("break",15);case 15:if("string"==typeof soundFile){_context3.next=17;break}return _context3.abrupt("return");case 17:if(soundFile=soundFile.trim(),null!=(soundsDirectory=this.soundsDirectory)&&"null"!==soundsDirectory&&"none"!==soundFile&&"null"!==soundFile){_context3.next=21;break}return _context3.abrupt("return");case 21:return _context3.prev=21,_context3.t1=fetch,_context3.next=25,resolveUrl("".concat(soundsDirectory,"/").concat(soundFile));case 25:return _context3.t2=_context3.sent,_context3.next=28,(0,_context3.t1)(_context3.t2);case 28:return response=_context3.sent,_context3.next=31,response.arrayBuffer();case 31:return arrayBuffer=_context3.sent,_context3.next=34,this.audioContext.decodeAudioData(arrayBuffer);case 34:audioBuffer=_context3.sent,this.audioBuffers[sound]=audioBuffer,_context3.next=40;break;case 38:_context3.prev=38,_context3.t3=_context3.catch(21);case 40:case"end":return _context3.stop()}}),_callee,this,[[21,38]])}))),function(_x5){return _loadSound.apply(this,arguments)})},{key:"playSound",value:(_playSound=_asyncToGenerator(regeneratorRuntime.mark((function _callee2(name){var soundSource,gainNode;return regeneratorRuntime.wrap((function(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:if("suspended"!==this.audioContext.state&&"interrupted"!==this.audioContext.state){_context4.next=3;break}return _context4.next=3,this.audioContext.resume();case 3:if(this.audioBuffers[name]){_context4.next=6;break}return _context4.next=6,this.loadSound(name);case 6:if(this.audioBuffers[name]){_context4.next=8;break}return _context4.abrupt("return");case 8:(soundSource=this.audioContext.createBufferSource()).buffer=this.audioBuffers[name],(gainNode=this.audioContext.createGain()).gain.value=.5,soundSource.connect(gainNode).connect(this.audioContext.destination),soundSource.start();case 14:case"end":return _context4.stop()}}),_callee2,this)}))),function(_x6){return _playSound.apply(this,arguments)})}]),_MathfieldElement}(),_MathfieldElement2=_MathfieldElement;function toCamelCase(s){return s.replace(/[^a-zA-Z\d]+(.)/g,(function(_m,c){return c.toUpperCase()}))}function getOptionsFromAttributes(mfe){var result={readOnly:!1},attribs=_MathfieldElement2.optionsAttributes;return Object.keys(attribs).forEach((function(x){if(mfe.hasAttribute(x)){var value=mfe.getAttribute(x);"boolean"===attribs[x]?result[toCamelCase(x)]=!0:"on/off"===attribs[x]?result[toCamelCase(x)]="on"===value||"off"!==value&&void 0:"number"===attribs[x]?result[toCamelCase(x)]=Number.parseFloat(null!=value?value:"0"):result[toCamelCase(x)]=value}})),result}function isElementInternalsSupported(){return!(!("ElementInternals"in window)||!HTMLElement.prototype.attachInternals)&&"role"in window.ElementInternals.prototype}_MathfieldElement2.version="0.94.6",_MathfieldElement2._fontsDirectory="./fonts",_MathfieldElement2._soundsDirectory="./sounds",_MathfieldElement2.keypressVibration=!0,_MathfieldElement2._keypressSound={spacebar:"keypress-spacebar.wav",return:"keypress-return.wav",delete:"keypress-delete.wav",default:"keypress-standard.wav"},_MathfieldElement2._plonkSound="plonk.wav",_MathfieldElement2.audioBuffers={},_MathfieldElement2.createHTML=function(x){return x},_MathfieldElement2._speechEngineRate="100%",_MathfieldElement2._speechEngineVoice="Joanna",_MathfieldElement2._textToSpeechMarkup="",_MathfieldElement2._textToSpeechRules="mathlive",_MathfieldElement2._textToSpeechRulesOptions={},_MathfieldElement2.speakHook=function(text){var _a3,_b3;if(isBrowser())if(window.MathfieldElement.speechEngine&&"local"!==window.MathfieldElement.speechEngine)if("amazon"===window.MathfieldElement.speechEngine)if("AWS"in window){var polly=new window.AWS.Polly({apiVersion:"2016-06-10"}),parameters={OutputFormat:"mp3",VoiceId:null!=(_a3=window.MathfieldElement.speechEngineVoice)?_a3:"Joanna",Engine:["Amy","Emma","Brian","Ivy","Joanna","Kendra","Kimberly","Salli","Joey","Justin","Matthew"].includes(null!=(_b3=window.MathfieldElement.speechEngineVoice)?_b3:"Joanna")?"neural":"standard",Text:text,TextType:"ssml"};polly.synthesizeSpeech(parameters,(function(err,data){if(err)console.trace("MathLive 0.94.6: `polly.synthesizeSpeech()` error: ".concat(err));else if(null==data?void 0:data.AudioStream){var uInt8Array=new Uint8Array(data.AudioStream),blob=new Blob([uInt8Array.buffer],{type:"audio/mpeg"}),url=URL.createObjectURL(blob);new Audio(url).play().catch((function(error){return console.log(error)}))}else console.log("polly.synthesizeSpeech():",data)}))}else console.error("MathLive 0.94.6: AWS SDK not loaded. See https://www.npmjs.com/package/aws-sdk");else"google"===window.MathfieldElement.speechEngine&&console.error("MathLive 0.94.6: The Google speech engine is not supported yet. Please come again.");else{var utterance=new SpeechSynthesisUtterance(text);window.speechSynthesis.speak(utterance)}else console.log("Speak:",text)},_MathfieldElement2.readAloudHook=function(element,text){var _a3;if(isBrowser()){if("amazon"!==window.MathfieldElement.speechEngine)return console.error("MathLive 0.94.6: Use Amazon TTS Engine for synchronized highlighting"),void("function"==typeof window.MathfieldElement.speakHook&&window.MathfieldElement.speakHook(text));if(window.AWS){var polly=new window.AWS.Polly({apiVersion:"2016-06-10"}),parameters={OutputFormat:"json",VoiceId:null!=(_a3=window.MathfieldElement.speechEngineVoice)?_a3:"Joanna",Engine:"standard",Text:text,TextType:"ssml",SpeechMarkTypes:["ssml"]};_globalMathLive().readAloudElement=element,polly.synthesizeSpeech(parameters,(function(err,data){if(err)console.trace("MathLive 0.94.6: `polly.synthesizeSpeech()` error: ".concat(err));else if(null==data?void 0:data.AudioStream){var response=new TextDecoder("utf-8").decode(new Uint8Array(data.AudioStream));_globalMathLive().readAloudMarks=response.split("\n").map((function(x){return x?JSON.parse(x):{}})),_globalMathLive().readAloudTokens=[];var _step155,_iterator155=_createForOfIteratorHelper(_globalMathLive().readAloudMarks);try{for(_iterator155.s();!(_step155=_iterator155.n()).done;){var mark=_step155.value;mark.value&&_globalMathLive().readAloudTokens.push(mark.value)}}catch(err){_iterator155.e(err)}finally{_iterator155.f()}_globalMathLive().readAloudCurrentMark="",parameters.OutputFormat="mp3",parameters.SpeechMarkTypes=[],polly.synthesizeSpeech(parameters,(function(err2,data2){if(err2)console.trace('MathLive 0.94.6: `polly.synthesizeSpeech("'.concat(text,'") error:').concat(err2));else if(null==data2?void 0:data2.AudioStream){var uInt8Array=new Uint8Array(data2.AudioStream),blob=new Blob([uInt8Array.buffer],{type:"audio/mpeg"}),url=URL.createObjectURL(blob),global=_globalMathLive();global.readAloudAudio?global.readAloudAudio.pause():(global.readAloudAudio=new Audio,global.readAloudAudio.addEventListener("ended",(function(){var mathfield=global.readAloudMathField;global.readAloudStatus="ended",document.body.dispatchEvent(new Event("read-aloud-status-change",{bubbles:!0,composed:!0})),mathfield?(render(mathfield),global.readAloudElement=null,global.readAloudMathField=null,global.readAloudTokens=[],global.readAloudMarks=[],global.readAloudCurrentMark=""):removeHighlight(global.readAloudElement)})),global.readAloudAudio.addEventListener("timeupdate",(function(){var _step156,value="",target=1e3*global.readAloudAudio.currentTime+100,_iterator156=_createForOfIteratorHelper(global.readAloudMarks);try{for(_iterator156.s();!(_step156=_iterator156.n()).done;){var mark=_step156.value;mark.time<target&&(value=mark.value)}}catch(err){_iterator156.e(err)}finally{_iterator156.f()}global.readAloudCurrentMark!==value&&(global.readAloudCurrentToken=value,value&&value===global.readAloudFinalToken?global.readAloudAudio.pause():(global.readAloudCurrentMark=value,highlightAtomID(global.readAloudElement,global.readAloudCurrentMark)))}))),global.readAloudAudio.src=url,global.readAloudStatus="playing",document.body.dispatchEvent(new Event("read-aloud-status-change",{bubbles:!0,composed:!0})),global.readAloudAudio.play()}}))}else console.log("polly.synthesizeSpeech():",data)}))}else console.error("MathLive 0.94.6: AWS SDK not loaded. See https://www.npmjs.com/package/aws-sdk")}},_MathfieldElement2._decimalSeparator=".",_MathfieldElement2.fractionNavigationOrder="numerator-denominator";var _a2,_b2,_d,gComputeEngine,mathfield_element_default=_MathfieldElement2;function _convertLatexToMarkup(text,options){var _a3,_b3;null!=options||(options={}),options.mathstyle=null!=(_a3=options.mathstyle)?_a3:"displaystyle";var context=new Context({from:__spreadProps(__spreadValues({},getDefaultContext()),{renderPlaceholder:function(){return new Box(160,{maxFontSize:1})},letterShapeStyle:null!=(_b3=null==options?void 0:options.letterShapeStyle)?_b3:"tex"}),mathstyle:options.mathstyle}),box=new Atom({mode:"math",type:"root",body:parseLatex(text,{context:context,parseMode:"math",mathstyle:options.mathstyle})}).render(context);return box?(coalesce(applyInterBoxSpacing(box,context)),makeStruts(box,{classes:"ML__mathlive"}).toMarkup()):""}function validateLatex2(s){return validateLatex(s,{context:getDefaultContext()})}function _convertLatexToMathMl(latex){var options=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return toMathML(parseLatex(latex,{parseMode:"math",args:function(){return""},mathstyle:"displaystyle"}),options)}function _convertLatexToSpeakableText(latex){return atomToSpeakableText(parseLatex(latex,{parseMode:"math",mathstyle:"displaystyle"}))}function _serializeMathJsonToLatex(json){var _a3,_b3;if(!gComputeEngine){var ComputeEngineCtor=null==(_a3=globalThis[Symbol.for("io.cortexjs.compute-engine")])?void 0:_a3.ComputeEngine;ComputeEngineCtor?gComputeEngine=new ComputeEngineCtor:console.error('MathLive 0.94.6: The CortexJS Compute Engine library is not available.\n        \n        Load the library, for example with:\n        \n        import "https://unpkg.com/@cortex-js/compute-engine?module"')}return null!=(_b3=null==gComputeEngine?void 0:gComputeEngine.box(json).latex)?_b3:""}function _convertLatexToAsciiMath(latex){var parseMode=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"math";return atomToAsciiMath(new Atom({type:"root",body:parseLatex(latex,{parseMode:parseMode})}))}function _convertAsciiMathToLatex(ascii){return parseMathString(ascii,{format:"ascii-math"})[1]}function findEndOfMath(delimiter,text,startIndex){for(var index=startIndex,braceLevel=0,delimLength=delimiter.length;index<text.length;){var character=text[index];if(braceLevel<=0&&text.slice(index,index+delimLength)===delimiter)return index;"\\"===character?index++:"{"===character?braceLevel++:"}"===character&&braceLevel--,index++}return-1}function splitAtDelimiters(startData,leftDelim,rightDelim,mathstyle){var _step158,format=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"latex",finalData=[],_iterator158=_createForOfIteratorHelper(startData);try{for(_iterator158.s();!(_step158=_iterator158.n()).done;){var startDatum=_step158.value;if("text"===startDatum.type){var text=startDatum.data,lookingForLeft=!0,currIndex=0,nextIndex=void 0;-1!==(nextIndex=text.indexOf(leftDelim))&&((currIndex=nextIndex)>0&&finalData.push({type:"text",data:text.slice(0,currIndex)}),lookingForLeft=!1);for(var done=!1;!done;){if(lookingForLeft){if(-1===(nextIndex=text.indexOf(leftDelim,currIndex))){done=!0;break}currIndex!==nextIndex&&finalData.push({type:"text",data:text.slice(currIndex,nextIndex)}),currIndex=nextIndex}else{if(-1===(nextIndex=findEndOfMath(rightDelim,text,currIndex+leftDelim.length))){done=!0;break}var formula=text.slice(currIndex+leftDelim.length,nextIndex);if("ascii-math"===format){var _parseMathString5=parseMathString(formula,{format:"ascii-math"}),_parseMathString6=_slicedToArray(_parseMathString5,2);formula=_parseMathString6[1]}finalData.push({type:"math",data:formula,rawData:text.slice(currIndex,nextIndex+rightDelim.length),mathstyle:mathstyle}),currIndex=nextIndex+rightDelim.length}lookingForLeft=!lookingForLeft}currIndex<text.length&&finalData.push({type:"text",data:text.slice(currIndex)})}else finalData.push(startDatum)}}catch(err){_iterator158.e(err)}finally{_iterator158.f()}return finalData}function splitWithDelimiters(text,texDelimiters,mathAsciiDelimiters){var data=[{type:"text",data:text}];return(null==texDelimiters?void 0:texDelimiters.inline)&&texDelimiters.inline.forEach((function(_ref7){var _ref8=_slicedToArray(_ref7,2),openDelim=_ref8[0],closeDelim=_ref8[1];data=splitAtDelimiters(data,openDelim,closeDelim,"textstyle")})),(null==texDelimiters?void 0:texDelimiters.display)&&texDelimiters.display.forEach((function(_ref9){var _ref10=_slicedToArray(_ref9,2),openDelim=_ref10[0],closeDelim=_ref10[1];data=splitAtDelimiters(data,openDelim,closeDelim,"displaystyle")})),(null==mathAsciiDelimiters?void 0:mathAsciiDelimiters.inline)&&mathAsciiDelimiters.inline.forEach((function(_ref11){var _ref12=_slicedToArray(_ref11,2),openDelim=_ref12[0],closeDelim=_ref12[1];data=splitAtDelimiters(data,openDelim,closeDelim,"textstyle","ascii-math")})),(null==mathAsciiDelimiters?void 0:mathAsciiDelimiters.display)&&mathAsciiDelimiters.display.forEach((function(_ref13){var _ref14=_slicedToArray(_ref13,2),openDelim=_ref14[0],closeDelim=_ref14[1];data=splitAtDelimiters(data,openDelim,closeDelim,"displaystyle","ascii-math")})),data}function createAccessibleMarkupPair(latex,mathstyle,options,createNodeOnFailure){var _a3,markupNode=function(text,options,mathstyle,createNodeOnFailure){try{var html=options.renderToMarkup(text,{mathstyle:mathstyle,format:"html"}),element=document.createElement("span");return element.style.display="displaystyle"===mathstyle?"flex":"inline-flex",element.setAttribute("aria-hidden","true"),element.innerHTML=window.MathfieldElement.createHTML(html),element}catch(error){if(console.error("Could not parse'"+text+"' with ",error),createNodeOnFailure)return document.createTextNode(text)}return null}(latex,options,mathstyle||"textstyle",createNodeOnFailure),accessibleContent=null!=(_a3=options.renderAccessibleContent)?_a3:"";if(markupNode&&/\b(mathml|speakable-text)\b/i.test(accessibleContent)){var fragment=document.createElement("span");if(/\bmathml\b/i.test(accessibleContent)&&options.renderToMathML&&fragment.append(function(latex,options){var span=document.createElement("span");try{var html="<math xmlns='http://www.w3.org/1998/Math/MathML'>"+options.renderToMathML(latex)+"</math>";span.innerHTML=window.MathfieldElement.createHTML(html)}catch(error){console.error('MathLive 0.94.6:  Could not convert "'.concat(latex,"\"' to MathML with ").concat(error)),span.textContent=latex}return span.className="ML__sr-only",span}(latex,options)),/\bspeakable-text\b/i.test(accessibleContent)&&options.renderToSpeakableText){var span=document.createElement("span"),html=options.renderToSpeakableText(latex);span.innerHTML=window.MathfieldElement.createHTML(html),span.className="ML__sr-only",fragment.append(span)}return fragment.append(markupNode),fragment}return markupNode}function scanText2(text,options){var _a3,_b3,_c2,fragment=null;if((null==(_a3=options.TeX)?void 0:_a3.processEnvironments)&&/^\s*\\begin/.test(text)){fragment=document.createDocumentFragment();var node=createAccessibleMarkupPair(text,"",options,!0);node&&fragment.appendChild(node)}else{if(!text.trim())return null;var data=splitWithDelimiters(text,null==(_b3=options.TeX)?void 0:_b3.delimiters,null==(_c2=options.asciiMath)?void 0:_c2.delimiters);if(1===data.length&&"text"===data[0].type)return null;fragment=document.createDocumentFragment();var _step159,_iterator159=_createForOfIteratorHelper(data);try{for(_iterator159.s();!(_step159=_iterator159.n()).done;){var datum=_step159.value;if("text"===datum.type)fragment.appendChild(document.createTextNode(datum.data));else{var _node=createAccessibleMarkupPair(datum.data,"textstyle"===datum.mathstyle?"textstyle":"displaystyle",options,!0);_node&&fragment.appendChild(_node)}}}catch(err){_iterator159.e(err)}finally{_iterator159.f()}}return fragment}function scanElement(element,options){var _a3,_b3,_c2,_d2,_e,_f,_g,_h,_i,_j,_k,_l,_m,_n,_o,_p;if(1===element.childNodes.length&&3===element.childNodes[0].nodeType){var text=null!=(_a3=element.childNodes[0].textContent)?_a3:"";if((null==(_b3=options.TeX)?void 0:_b3.processEnvironments)&&/^\s*\\begin/.test(text)){element.textContent="";var node=createAccessibleMarkupPair(text,"",options,!0);return void(node&&element.append(node))}var data=splitWithDelimiters(text,null==(_c2=options.TeX)?void 0:_c2.delimiters,null==(_d2=options.asciiMath)?void 0:_d2.delimiters);if(1===data.length&&"math"===data[0].type){element.textContent="";var _node2=createAccessibleMarkupPair(data[0].data,"textstyle"===data[0].mathstyle?"textstyle":"displaystyle",options,!0);return void(_node2&&element.append(_node2))}if(1===data.length&&"text"===data[0].type)return}for(var i=element.childNodes.length-1;i>=0;i--){var childNode=element.childNodes[i];if(3===childNode.nodeType){var frag=scanText2(null!=(_e=childNode.textContent)?_e:"",options);frag&&(i+=frag.childNodes.length-1,childNode.replaceWith(frag))}else if(1===childNode.nodeType){var el=childNode,tag=childNode.nodeName.toLowerCase();if("script"===tag){var scriptNode=childNode,textContent=void 0;if(null==(_f=options.processScriptTypePattern)?void 0:_f.test(scriptNode.type))textContent=null!=(_g=scriptNode.textContent)?_g:"";else if(null==(_h=options.processMathJSONScriptTypePattern)?void 0:_h.test(scriptNode.type))try{textContent=null==(_j=options.serializeToLatex)?void 0:_j.call(options,JSON.parse(null!=(_i=scriptNode.textContent)?_i:""))}catch(e){console.error(e)}if(textContent){var _step160,style="textstyle",_iterator160=_createForOfIteratorHelper(scriptNode.type.split(";"));try{for(_iterator160.s();!(_step160=_iterator160.n()).done;){var _l$toLowerCase$split2=_slicedToArray(_step160.value.toLowerCase().split("="),2),key=_l$toLowerCase$split2[0],value=_l$toLowerCase$split2[1];"mode"===key.trim()&&(style="display"===value.trim()?"displaystyle":"textstyle")}}catch(err){_iterator160.e(err)}finally{_iterator160.f()}var span=createAccessibleMarkupPair(textContent,style,options,!0);span&&scriptNode.parentNode.replaceChild(span,scriptNode)}}else if(null!=(_l=null==(_k=options.processClassPattern)?void 0:_k.test(el.className))&&_l||!(null!=(_n=null==(_m=options.skipTags)?void 0:_m.includes(tag))&&_n||null!=(_p=null==(_o=options.ignoreClassPattern)?void 0:_o.test(el.className))&&_p))if(1===element.childNodes.length&&3===element.childNodes[0].nodeType){var formula=element.textContent;element.textContent="";var _node3=createAccessibleMarkupPair(null!=formula?formula:"","displaystyle",options,!0);_node3&&element.append(_node3)}else scanElement(el,options)}}}isBrowser()&&!(null==(_a2=window.customElements)?void 0:_a2.get("math-field"))&&(null!=window[_b2=Symbol.for("io.cortexjs.mathlive")]||(window[_b2]={}),window[Symbol.for("io.cortexjs.mathlive")].version="0.94.6",window.MathfieldElement=_MathfieldElement2,null==(_d=window.customElements)||_d.define("math-field",_MathfieldElement2));var DEFAULT_AUTO_RENDER_OPTIONS={skipTags:["math-field","noscript","style","textarea","pre","code","annotation","annotation-xml"],processScriptType:"math/tex",processMathJSONScriptType:"math/json",ignoreClass:"tex2jax_ignore",processClass:"tex2jax_process",renderAccessibleContent:"mathml",asciiMath:{delimiters:{inline:[["`","`"]]}},TeX:{processEnvironments:!0,delimiters:{inline:[["\\(","\\)"]],display:[["$$","$$"],["\\[","\\]"]]}}};function _autoRenderMathInElement(element,options){var _a3,_b3,_c2,_d2;try{var optionsPrivate=__spreadValues(__spreadValues({},DEFAULT_AUTO_RENDER_OPTIONS),options);optionsPrivate.ignoreClassPattern=new RegExp(null!=(_a3=optionsPrivate.ignoreClass)?_a3:""),optionsPrivate.processClassPattern=new RegExp(null!=(_b3=optionsPrivate.processClass)?_b3:""),optionsPrivate.processScriptTypePattern=new RegExp(null!=(_c2=optionsPrivate.processScriptType)?_c2:""),optionsPrivate.processMathJSONScriptTypePattern=new RegExp(null!=(_d2=optionsPrivate.processMathJSONScriptType)?_d2:""),loadFonts(),injectStylesheet("core"),scanElement(element,optionsPrivate)}catch(error){error instanceof Error?console.error("renderMathInElement(): "+error.message):console.error("renderMathInElement(): Could not render math for element",element)}}function _globalMathLive(){var _a3;return null!=globalThis[_a3=Symbol.for("io.cortexjs.mathlive")]||(globalThis[_a3]={}),globalThis[Symbol.for("io.cortexjs.mathlive")]}function _makeSharedVirtualKeyboard(){return console.warn("%cMathLive 0.94.6: %cmakeSharedVirtualKeyboard() is deprecated. \n    Use `window.mathVirtualKeyboard` to access the virtual keyboard instance.\n    See https://cortexjs.io/mathlive/changelog/ for details.","color:#12b; font-size: 1.1rem","color:#db1111; font-size: 1.1rem"),window.mathVirtualKeyboard}function _renderMathInDocument(options){_renderMathInElement(document.body,options)}function _renderMathInElement(element,options){var el=function(element){if("string"==typeof element){var result=document.getElementById(element);if(null===result)throw new Error('The element with ID "'.concat(element,'" could not be found.'));return result}return"string"==typeof element?null:element}(element);if(el){var optionsPrivate=null!=options?options:{};null!=optionsPrivate.renderToMarkup||(optionsPrivate.renderToMarkup=_convertLatexToMarkup),null!=optionsPrivate.renderToMathML||(optionsPrivate.renderToMathML=_convertLatexToMathMl),null!=optionsPrivate.renderToSpeakableText||(optionsPrivate.renderToSpeakableText=_convertLatexToSpeakableText),null!=optionsPrivate.serializeToLatex||(optionsPrivate.serializeToLatex=_serializeMathJsonToLatex),_autoRenderMathInElement(el,optionsPrivate)}}register2({switchKeyboardLayer:function(layerName){var keyboard=VirtualKeyboard.singleton;return!!keyboard&&(keyboard.show(),hideVariantsPanel(),keyboard.currentLayer=layerName,keyboard.render(),keyboard.focus(),!0)},toggleVirtualKeyboard:function(){var kbd=window.mathVirtualKeyboard;return kbd.visible?kbd.hide({animate:!0}):kbd.show({animate:!0}),!1},hideVirtualKeyboard:function(){return window.mathVirtualKeyboard.hide({animate:!0}),!1},showVirtualKeyboard:function(){return window.mathVirtualKeyboard.show({animate:!0}),!1}},{target:"virtual-keyboard"});var mod,_version={mathlive:"0.94.6"};return mod=mathlive_exports,function(to,from,except,desc){if(from&&"object"===_typeof(from)||"function"==typeof from){var _step3,_iterator3=_createForOfIteratorHelper(__getOwnPropNames(from));try{var _loop=function(){var key=_step3.value;__hasOwnProp.call(to,key)||key===except||__defProp(to,key,{get:function(){return from[key]},enumerable:!(desc=__getOwnPropDesc(from,key))||desc.enumerable})};for(_iterator3.s();!(_step3=_iterator3.n()).done;)_loop()}catch(err){_iterator3.e(err)}finally{_iterator3.f()}}return to}(__defProp({},"__esModule",{value:!0}),mod)}();Object.assign(exports,MathLive),Object.defineProperty(exports,"__esModule",{value:!0})},"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module?factory(exports):"function"==typeof define&&define.amd?define("core_form/mathlive",["exports"],factory):factory((global="undefined"!=typeof globalThis?globalThis:global||self).MathLive={});

//# sourceMappingURL=mathlive.min.js.map