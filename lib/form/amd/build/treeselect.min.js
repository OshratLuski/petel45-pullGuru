define("core_form/treeselect",["jquery"],(function(jQuery){var $;$=jQuery,jQuery.fn.treeSelector=function(tree,defaultValues,onChange,params){$(window).off("click.treeSelector").on("click.treeSelector",(function(e){if($(e.target).closest(".treeSelector-container").length>0){var $container=$(e.target).closest(".treeSelector-container");if($container.length>0){var treeId=$container.attr("data-treeId");$("div.treeSelector-container:not([data-treeId="+treeId+"])").find("div.treeSelector-wrapper").removeClass("visible")}}else $("div.treeSelector-wrapper").removeClass("visible")}));var options=$.extend({checkWithParent:!1,titleWithParent:!1,notViewClickParentTitle:!1,disabled:!1,emptyOptonPlaceholder:"no options"},params),buildTree=function buildTree(node,level,randId){var hasChildren=node.children&&node.children.length>0,li=$(document.createElement("li"));li.addClass("treeSelector-li level-"+level+(hasChildren?" has-children":""));var liBox=$(document.createElement("div"));liBox.addClass("treeSelector-li-box");var liTitle=$(document.createElement("label"));liTitle.addClass("treeSelector-li-title-box");var nodeLiId="treeSelector-li-"+randId+"-"+node.id;liTitle.attr({for:nodeLiId,"data-value":node.value,"data-title":node.title});var liTitleCheckbox=$(document.createElement("input"));liTitleCheckbox.attr({type:"checkbox",id:nodeLiId,"data-value":node.value}),liTitle.append(liTitleCheckbox);var liTitleSpan=$(document.createElement("span"));if(liTitleSpan.addClass("treeSelector-li-title"),liTitleSpan.attr({"data-value":node.value}),liTitleSpan.text(node.title),liTitle.append(liTitleSpan),liBox.append(liTitle),hasChildren){for(var liChildUl=$(document.createElement("ul")),childrenLis=$(),k=0;k<node.children.length;k++)childrenLis=childrenLis.add(buildTree(node.children[k],level+1,randId));liChildUl.append(childrenLis),liBox.append(liChildUl)}else liBox.addClass("leaf");return li.append(liBox),li},getParentTitles=function getParentTitles($seletor,value){if(!value)return[];var titles=[],valueItem=$seletor.find(".treeSelector-li-title-box[data-value="+value+"]:first");if(valueItem&&valueItem.closest(".treeSelector-li").length>0){var closeLiBox=valueItem.closest(".treeSelector-li").closest(".treeSelector-li-box"),closeTitle=closeLiBox.find(">.treeSelector-li-title-box").attr("data-title");titles=getParentTitles($seletor,closeLiBox.find(">.treeSelector-li-title-box").attr("data-value")).slice().concat([closeTitle])}return titles.filter((function(e){return e}))},appendSelectedItems=function($selector,values){if($selector&&values&&Array.isArray(values)){for(var titleSpans=$(),k=0;k<values.length;k++){var value=values[k],item=$selector.find(".treeSelector-li-title[data-value="+value+"]:first");if(item){item.prev("input[type=checkbox]").prop("checked",!0);var titleItem=$(document.createElement("div"));titleItem.addClass("title-item"),titleItem.attr({"data-value":value});var itemSpan=$(document.createElement("span"));itemSpan.addClass("title");var title=item.text();options.titleWithParent&&(title=getParentTitles($selector,value).concat([title]).filter((function(e){return e})).join(" - ")),itemSpan.text(title);var faClose=$(document.createElement("span"));faClose.addClass("fa fa-times"),titleItem.append(faClose),titleItem.append(itemSpan),titleSpans=titleSpans.add(titleItem)}}$selector.find(".treeSelector-input-box:first").empty().append(titleSpans)}},uncheckParent=function uncheckParent(inputCheckbox){var closeUl=$(inputCheckbox).closest("ul");if(closeUl&&closeUl.length){var checkbox=closeUl.prev(".treeSelector-li-title-box").find("input[type=checkbox]:first");checkbox.prop("checked",!1),uncheckParent(checkbox.get(0))}},valueChangeEventView=function($selector,event){var values=function($selector){return $selector.find("input[type=checkbox]:checked").map((function(_index,elem){return $(elem).attr("data-value")})).toArray()}($selector);if(options.notViewClickParentTitle){for(var leafValues=[],k=0;k<values.length;k++){var value=values[k];if($selector.find(".treeSelector-li-box.leaf input[data-value="+value+"]").length>0)leafValues.push(value);else{var liBox=$("label.treeSelector-li-title-box[data-value="+value+"]:first");liBox.length>0&&liBox.next("ul").find("input[type=checkbox]:checked").length>0||leafValues.push(value)}}appendSelectedItems($selector,leafValues),onChange&&onChange(event,values)}else appendSelectedItems($selector,values),onChange&&onChange(event,values)};return $(this).each((function(){var selector=$(document.createElement("div")),randId=(new Date).valueOf()+parseInt(1e10*Math.random(),10);selector.addClass("treeSelector-container"),selector.attr("data-treeId",randId),options.disabled&&selector.addClass("disabled");var selectorInputBox=$(document.createElement("div"));selectorInputBox.addClass("treeSelector-input-box");var selectorWrapper=$(document.createElement("div"));selectorWrapper.addClass("treeSelector-wrapper");var $selector,selectorWrapperUl=$(document.createElement("ul"));if(selector.append(selectorInputBox),selector.append(selectorWrapper),tree&&tree.length)for(var j=0;j<tree.length;j++){var element=buildTree(tree[j],0,randId);selectorWrapperUl.append(element)}else selector.addClass("no-options"),selectorInputBox.text(options.emptyOptonPlaceholder);selectorWrapper.append(selectorWrapperUl),$(this).empty().append(selector),defaultValues&&defaultValues.length&&appendSelectedItems(selector,defaultValues),($selector=selector).on("change","input[type=checkbox]",(function(e){if(options.disabled)return!1;if(options.checkWithParent){var childrenBox=$(e.target).parent(".treeSelector-li-title-box").next("ul");e.target.checked||uncheckParent(e.target),childrenBox&&childrenBox.length>0&&childrenBox.find("input[type=checkbox]").prop("checked",e.target.checked)}valueChangeEventView($selector,e)})),$selector.on("click","span.fa.fa-times",(function(e){if(options.disabled)return!1;var value=$(e.target).parent(".title-item").attr("data-value"),input=$selector.find("input[type=checkbox][data-value="+value+"]:checked");return input&&input.length&&(input.prop("checked",!1),options.checkWithParent&&uncheckParent(input.get(0))),valueChangeEventView($selector,e),!1})),$selector.on("click",".treeSelector-input-box",(function(e){if(options.disabled||!tree||!tree.length)return!1;var $wrapper=$selector.find(".treeSelector-wrapper:first");$wrapper.hasClass("visible")||$wrapper.addClass("visible")}))}))}}));

//# sourceMappingURL=treeselect.min.js.map