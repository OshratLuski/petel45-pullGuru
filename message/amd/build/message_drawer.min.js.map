{"version":3,"file":"message_drawer.min.js","sources":["../src/message_drawer.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * Controls the message drawer.\r\n *\r\n * @module     core_message/message_drawer\r\n * @copyright  2018 Ryan Wyllie <ryan@moodle.com>\r\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\ndefine(\r\n[\r\n    'jquery',\r\n    'core/custom_interaction_events',\r\n    'core/pubsub',\r\n    'core_message/message_drawer_view_contact',\r\n    'core_message/message_drawer_view_contacts',\r\n    'core_message/message_drawer_view_conversation',\r\n    'core_message/message_drawer_view_group_info',\r\n    'core_message/message_drawer_view_overview',\r\n    'core_message/message_drawer_view_search',\r\n    'core_message/message_drawer_view_settings',\r\n    'core_message/message_drawer_router',\r\n    'core_message/message_drawer_routes',\r\n    'core_message/message_drawer_events',\r\n    'core_message/message_drawer_helper',\r\n    'core/pending',\r\n    'core/drawer',\r\n    'core/toast',\r\n    'core/str',\r\n    'core/config',\r\n    'core/ajax',\r\n    'core/local/aria/focuslock',\r\n    'core/modal_backdrop',\r\n    'core/templates',\r\n    'core/local/aria/selectors',\r\n],\r\nfunction(\r\n    $,\r\n    CustomEvents,\r\n    PubSub,\r\n    ViewContact,\r\n    ViewContacts,\r\n    ViewConversation,\r\n    ViewGroupInfo,\r\n    ViewOverview,\r\n    ViewSearch,\r\n    ViewSettings,\r\n    Router,\r\n    Routes,\r\n    Events,\r\n    Helper,\r\n    Pending,\r\n    Drawer,\r\n    Toast,\r\n    Str,\r\n    Config,\r\n    Ajax,\r\n    FocusLock,\r\n    ModalBackdrop,\r\n    Templates,\r\n    AriaSelectors,\r\n) {\r\n\r\n    var SELECTORS = {\r\n        DRAWER: '[data-region=\"right-hand-drawer\"]',\r\n        JUMPTO: '.popover-region [data-region=\"jumpto\"]',\r\n        PANEL_BODY_CONTAINER: '[data-region=\"panel-body-container\"]',\r\n        PANEL_HEADER_CONTAINER: '[data-region=\"panel-header-container\"]',\r\n        VIEW_CONTACT: '[data-region=\"view-contact\"]',\r\n        VIEW_CONTACTS: '[data-region=\"view-contacts\"]',\r\n        VIEW_CONVERSATION: '[data-region=\"view-conversation\"]',\r\n        VIEW_GROUP_INFO: '[data-region=\"view-group-info\"]',\r\n        VIEW_OVERVIEW: '[data-region=\"view-overview\"]',\r\n        VIEW_SEARCH: '[data-region=\"view-search\"]',\r\n        VIEW_SETTINGS: '[data-region=\"view-settings\"]',\r\n        ROUTES: '[data-route]',\r\n        ROUTES_BACK: '[data-route-back]',\r\n        HEADER_CONTAINER: '[data-region=\"header-container\"]',\r\n        BODY_CONTAINER: '[data-region=\"body-container\"]',\r\n        FOOTER_CONTAINER: '[data-region=\"footer-container\"]',\r\n        CLOSE_BUTTON: '[data-action=\"closedrawer\"]'\r\n    };\r\n\r\n    /**\r\n     * Get elements for route.\r\n     *\r\n     * @param {String} namespace Unique identifier for the Routes\r\n     * @param {Object} root The message drawer container.\r\n     * @param {string} selector The route container.\r\n     *\r\n     * @return {array} elements Found route container objects.\r\n     */\r\n    var getParametersForRoute = function(namespace, root, selector) {\r\n\r\n        var header = root.find(SELECTORS.HEADER_CONTAINER).find(selector);\r\n        if (!header.length) {\r\n            header = root.find(SELECTORS.PANEL_HEADER_CONTAINER).find(selector);\r\n        }\r\n        var body = root.find(SELECTORS.BODY_CONTAINER).find(selector);\r\n        if (!body.length) {\r\n            body = root.find(SELECTORS.PANEL_BODY_CONTAINER).find(selector);\r\n        }\r\n        var footer = root.find(SELECTORS.FOOTER_CONTAINER).find(selector);\r\n\r\n        return [\r\n            namespace,\r\n            header.length ? header : null,\r\n            body.length ? body : null,\r\n            footer.length ? footer : null\r\n        ];\r\n    };\r\n\r\n    var routes = [\r\n        [Routes.VIEW_CONTACT, SELECTORS.VIEW_CONTACT, ViewContact.show, ViewContact.description],\r\n        [Routes.VIEW_CONTACTS, SELECTORS.VIEW_CONTACTS, ViewContacts.show, ViewContacts.description],\r\n        [Routes.VIEW_CONVERSATION, SELECTORS.VIEW_CONVERSATION, ViewConversation.show, ViewConversation.description],\r\n        [Routes.VIEW_GROUP_INFO, SELECTORS.VIEW_GROUP_INFO, ViewGroupInfo.show, ViewGroupInfo.description],\r\n        [Routes.VIEW_OVERVIEW, SELECTORS.VIEW_OVERVIEW, ViewOverview.show, ViewOverview.description],\r\n        [Routes.VIEW_SEARCH, SELECTORS.VIEW_SEARCH, ViewSearch.show, ViewSearch.description],\r\n        [Routes.VIEW_SETTINGS, SELECTORS.VIEW_SETTINGS, ViewSettings.show, ViewSettings.description]\r\n    ];\r\n\r\n    /**\r\n     * Create routes.\r\n     *\r\n     * @param {String} namespace Unique identifier for the Routes\r\n     * @param {Object} root The message drawer container.\r\n     */\r\n    var createRoutes = function(namespace, root) {\r\n        routes.forEach(function(route) {\r\n            Router.add(namespace, route[0], getParametersForRoute(namespace, root, route[1]), route[2], route[3]);\r\n        });\r\n    };\r\n\r\n    let backdropPromise = null;\r\n\r\n    /**\r\n     * Set the focus on the drawer.\r\n     *\r\n     * This method also creates or destroy any necessary backdrop zone and focus trap.\r\n     *\r\n     * @param {Object} root The message drawer container.\r\n     * @param {Boolean} hasFocus Whether the drawer has focus or not.\r\n     */\r\n    var setFocus = function(root, hasFocus) {\r\n        var drawerRoot = Drawer.getDrawerRoot(root);\r\n        if (!drawerRoot.length) {\r\n            return;\r\n        }\r\n        if (!backdropPromise) {\r\n            backdropPromise = Templates.render('core/modal_backdrop', {})\r\n                .then(html => new ModalBackdrop(html));\r\n        }\r\n        const backdropWithAdjustments = backdropPromise.then(modalBackdrop => {\r\n            const messageDrawerZIndex = window.getComputedStyle(drawerRoot[0]).zIndex;\r\n            if (messageDrawerZIndex) {\r\n                modalBackdrop.setZIndex(messageDrawerZIndex - 1);\r\n            }\r\n            modalBackdrop.getAttachmentPoint().get(0).addEventListener('click', e => {\r\n                PubSub.publish(Events.HIDE, {});\r\n                e.preventDefault();\r\n            });\r\n            return modalBackdrop;\r\n        });\r\n        if (hasFocus) {\r\n            FocusLock.trapFocus(root[0]);\r\n            // eslint-disable-next-line promise/catch-or-return\r\n            backdropWithAdjustments.then(modalBackdrop => {\r\n                if (modalBackdrop) {\r\n                    modalBackdrop.show();\r\n                    const pageWrapper = document.getElementById('page');\r\n                    pageWrapper.style.overflow = 'hidden';\r\n                    // Set the focus on the close button so when we press enter, it closes the drawer as it did before\r\n                    var closeButton = root.find(SELECTORS.CLOSE_BUTTON);\r\n                    if (closeButton.length) {\r\n                        closeButton.focus();\r\n                    }\r\n                }\r\n                return modalBackdrop;\r\n            });\r\n        } else {\r\n            // eslint-disable-next-line promise/catch-or-return\r\n            backdropWithAdjustments.then(modalBackdrop => {\r\n                if (modalBackdrop) {\r\n                    FocusLock.untrapFocus();\r\n                    var button = $(SELECTORS.DRAWER).attr('data-origin');\r\n                    if (button) {\r\n                        $('#' + button).focus();\r\n                    }\r\n                    modalBackdrop.hide();\r\n                    const pageWrapper = document.getElementById('page');\r\n                    pageWrapper.style.overflow = 'visible';\r\n                }\r\n                return modalBackdrop;\r\n            });\r\n        }\r\n    };\r\n    /**\r\n     * Show the message drawer.\r\n     *\r\n     * @param {string} namespace The route namespace.\r\n     * @param {Object} root The message drawer container.\r\n     */\r\n    var show = function(namespace, root) {\r\n        if (!root.attr('data-shown')) {\r\n            Router.go(namespace, Routes.VIEW_OVERVIEW);\r\n            root.attr('data-shown', true);\r\n        }\r\n\r\n        var drawerRoot = Drawer.getDrawerRoot(root);\r\n        if (drawerRoot.length) {\r\n            setFocus(root, true);\r\n            Drawer.show(drawerRoot);\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Hide the message drawer.\r\n     *\r\n     * @param {Object} root The message drawer container.\r\n     */\r\n    var hide = function(root) {\r\n        var drawerRoot = Drawer.getDrawerRoot(root);\r\n        if (drawerRoot.length) {\r\n            setFocus(root, false);\r\n            Drawer.hide(drawerRoot);\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Check if the drawer is visible.\r\n     *\r\n     * @param {Object} root The message drawer container.\r\n     * @return {boolean}\r\n     */\r\n    var isVisible = function(root) {\r\n        var drawerRoot = Drawer.getDrawerRoot(root);\r\n        if (drawerRoot.length) {\r\n            return Drawer.isVisible(drawerRoot);\r\n        }\r\n        return true;\r\n    };\r\n\r\n    /**\r\n     * Set Jump from button\r\n     *\r\n     * @param {String} buttonid The originating button id\r\n     */\r\n    var setJumpFrom = function(buttonid) {\r\n        $(SELECTORS.DRAWER).attr('data-origin', buttonid);\r\n    };\r\n\r\n    /**\r\n     * Listen to and handle events for routing, showing and hiding the message drawer.\r\n     *\r\n     * @param {string} namespace The route namespace.\r\n     * @param {Object} root The message drawer container.\r\n     * @param {bool} alwaysVisible Is this messaging app always shown?\r\n     */\r\n    var registerEventListeners = function(namespace, root, alwaysVisible) {\r\n        CustomEvents.define(root, [CustomEvents.events.activate, CustomEvents.events.escape]);\r\n        var paramRegex = /^data-route-param-?(\\d*)$/;\r\n\r\n        root.on(CustomEvents.events.activate, SELECTORS.ROUTES, function(e, data) {\r\n            var element = $(e.target).closest(SELECTORS.ROUTES);\r\n            var route = element.attr('data-route');\r\n            var attributes = [];\r\n\r\n            for (var i = 0; i < element[0].attributes.length; i++) {\r\n                attributes.push(element[0].attributes[i]);\r\n            }\r\n\r\n            var paramAttributes = attributes.filter(function(attribute) {\r\n                var name = attribute.nodeName;\r\n                var match = paramRegex.test(name);\r\n                return match;\r\n            });\r\n            paramAttributes.sort(function(a, b) {\r\n                var aParts = paramRegex.exec(a.nodeName);\r\n                var bParts = paramRegex.exec(b.nodeName);\r\n                var aIndex = aParts.length > 1 ? aParts[1] : 0;\r\n                var bIndex = bParts.length > 1 ? bParts[1] : 0;\r\n\r\n                if (aIndex < bIndex) {\r\n                    return -1;\r\n                } else if (bIndex < aIndex) {\r\n                    return 1;\r\n                } else {\r\n                    return 0;\r\n                }\r\n            });\r\n\r\n            var params = paramAttributes.map(function(attribute) {\r\n                return attribute.nodeValue;\r\n            });\r\n\r\n            var routeParams = [namespace, route].concat(params);\r\n\r\n            Router.go.apply(null, routeParams);\r\n\r\n            data.originalEvent.preventDefault();\r\n        });\r\n\r\n        root.on(CustomEvents.events.activate, SELECTORS.ROUTES_BACK, function(e, data) {\r\n            Router.back(namespace);\r\n\r\n            data.originalEvent.preventDefault();\r\n        });\r\n\r\n        // Close the message drawer if the drawer is visible and the click happened outside the drawer and the toggle button.\r\n        $(document).on(CustomEvents.events.activate, e => {\r\n            var drawer = $(e.target).closest(SELECTORS.DRAWER);\r\n            var toggleButtonId = $(SELECTORS.DRAWER)?.attr('data-origin');\r\n            var toggleButton = '';\r\n            if (toggleButtonId !== undefined && toggleButtonId) {\r\n                toggleButton = $(e.target).closest(\"#\" + toggleButtonId);\r\n            }\r\n\r\n            if (!drawer.length && !toggleButton.length && isVisible(root)) {\r\n                // Determine if the element that was clicked is focusable.\r\n                var focusableElement = $(e.target).closest(AriaSelectors.elements.focusable);\r\n                if (focusableElement.length) {\r\n                    // We need to move the focus to the clicked element after the drawer is hidden,\r\n                    // so we need to clear the `data-origin` attribute first.\r\n                    $(SELECTORS.DRAWER).attr('data-origin', '');\r\n                }\r\n                // Hide the drawer.\r\n                hide(root);\r\n                // Move the focus to the clicked element if it is focusable.\r\n                if (focusableElement.length) {\r\n                    focusableElement.focus();\r\n                }\r\n            }\r\n        });\r\n\r\n        // These are theme-specific to help us fix random behat fails.\r\n        // These events target those events defined in BS3 and BS4 onwards.\r\n        root.on('hide.bs.collapse', '.collapse', function(e) {\r\n            var pendingPromise = new Pending();\r\n            $(e.target).one('hidden.bs.collapse', function() {\r\n                pendingPromise.resolve();\r\n            });\r\n        });\r\n\r\n        root.on('show.bs.collapse', '.collapse', function(e) {\r\n            var pendingPromise = new Pending();\r\n            $(e.target).one('shown.bs.collapse', function() {\r\n                pendingPromise.resolve();\r\n            });\r\n        });\r\n\r\n        $(document).keyup(function (e) {\r\n            if (e.key === \"Escape\") {\r\n                hide(root);\r\n            }\r\n        });\r\n\r\n        $(SELECTORS.JUMPTO).focus(function() {\r\n            var firstInput = root.find(SELECTORS.CLOSE_BUTTON);\r\n            if (firstInput.length) {\r\n                firstInput.focus();\r\n            } else {\r\n                $(SELECTORS.HEADER_CONTAINER).find(SELECTORS.ROUTES_BACK).focus();\r\n            }\r\n        });\r\n\r\n        $(SELECTORS.DRAWER).focus(function() {\r\n            var button = $(this).attr('data-origin');\r\n            if (button) {\r\n                $('#' + button).focus();\r\n            }\r\n        });\r\n\r\n        if (!alwaysVisible) {\r\n            PubSub.subscribe(Events.SHOW, function() {\r\n                show(namespace, root);\r\n            });\r\n\r\n            PubSub.subscribe(Events.HIDE, function() {\r\n                hide(root);\r\n            });\r\n\r\n            PubSub.subscribe(Events.TOGGLE_VISIBILITY, function(buttonid) {\r\n                const buttonElement = document.getElementById(buttonid);\r\n                if (isVisible(root)) {\r\n                    hide(root);\r\n                    buttonElement?.setAttribute('aria-expanded', false);\r\n                    $(SELECTORS.JUMPTO).attr('tabindex', -1);\r\n\r\n                    $(`#${buttonid}`).attr('aria-expanded', false);\r\n                    Str.get_string('togglemessagemenuclose', 'theme_petel').then(function(string) {\r\n                        $(`#${buttonid}`).attr('aria-label', string);\r\n                    });\r\n                } else {\r\n                    show(namespace, root);\r\n                    buttonElement?.setAttribute('aria-expanded', true);\r\n                    setJumpFrom(buttonid);\r\n                    $(SELECTORS.JUMPTO).attr('tabindex', 0);\r\n\r\n                    $(`#${buttonid}`).attr('aria-expanded', true);\r\n                    Str.get_string('togglemessagemenuopen', 'theme_petel').then(function(string) {\r\n                        $(`#${buttonid}`).attr('aria-label', string);\r\n                    });\r\n                }\r\n            });\r\n            root.on(CustomEvents.events.escape, function() {\r\n                PubSub.publish(Events.HIDE, {});\r\n            });\r\n        }\r\n\r\n        PubSub.subscribe(Events.SHOW_CONVERSATION, function(args) {\r\n            setJumpFrom(args.buttonid);\r\n            show(namespace, root);\r\n            Router.go(namespace, Routes.VIEW_CONVERSATION, args.conversationid);\r\n        });\r\n\r\n        var closebutton = root.find(SELECTORS.CLOSE_BUTTON);\r\n        closebutton.on(CustomEvents.events.activate, function(e, data) {\r\n            data.originalEvent.preventDefault();\r\n            setFocus(root, false);\r\n            var button = $(SELECTORS.DRAWER).attr('data-origin');\r\n            if (button) {\r\n                $('#' + button).focus();\r\n            }\r\n            PubSub.publish(Events.TOGGLE_VISIBILITY, button);\r\n        });\r\n\r\n        PubSub.subscribe(Events.CREATE_CONVERSATION_WITH_USER, function(args) {\r\n            setJumpFrom(args.buttonid);\r\n            show(namespace, root);\r\n            Router.go(namespace, Routes.VIEW_CONVERSATION, null, 'create', args.userid);\r\n        });\r\n\r\n        PubSub.subscribe(Events.SHOW_SETTINGS, function() {\r\n            show(namespace, root);\r\n            Router.go(namespace, Routes.VIEW_SETTINGS);\r\n        });\r\n\r\n        PubSub.subscribe(Events.PREFERENCES_UPDATED, function(preferences) {\r\n            var filteredPreferences = preferences.filter(function(preference) {\r\n                return preference.type == 'message_entertosend';\r\n            });\r\n            var enterToSendPreference = filteredPreferences.length ? filteredPreferences[0] : null;\r\n\r\n            if (enterToSendPreference) {\r\n                var viewConversationFooter = root.find(SELECTORS.FOOTER_CONTAINER).find(SELECTORS.VIEW_CONVERSATION);\r\n                viewConversationFooter.attr('data-enter-to-send', enterToSendPreference.value);\r\n            }\r\n        });\r\n    };\r\n\r\n    /**\r\n     * Initialise the message drawer.\r\n     *\r\n     * @param {Object} root The message drawer container.\r\n     * @param {String} uniqueId Unique identifier for the Routes\r\n     * @param {bool} alwaysVisible Should we show the app now, or wait for the user?\r\n     * @param {Object} route\r\n     */\r\n    var init = function(root, uniqueId, alwaysVisible, route) {\r\n        root = $(root);\r\n        createRoutes(uniqueId, root);\r\n        registerEventListeners(uniqueId, root, alwaysVisible);\r\n\r\n        if (alwaysVisible) {\r\n            show(uniqueId, root);\r\n\r\n            if (route) {\r\n                var routeParams = route.params || [];\r\n                routeParams = [uniqueId, route.path].concat(routeParams);\r\n                Router.go.apply(null, routeParams);\r\n            }\r\n        }\r\n\r\n        // Mark the drawer as ready.\r\n        Helper.markDrawerReady();\r\n    };\r\n\r\n    return {\r\n        init: init,\r\n    };\r\n});\r\n"],"names":["define","$","CustomEvents","PubSub","ViewContact","ViewContacts","ViewConversation","ViewGroupInfo","ViewOverview","ViewSearch","ViewSettings","Router","Routes","Events","Helper","Pending","Drawer","Toast","Str","Config","Ajax","FocusLock","ModalBackdrop","Templates","AriaSelectors","SELECTORS","routes","VIEW_CONTACT","show","description","VIEW_CONTACTS","VIEW_CONVERSATION","VIEW_GROUP_INFO","VIEW_OVERVIEW","VIEW_SEARCH","VIEW_SETTINGS","createRoutes","namespace","root","forEach","route","add","selector","header","find","length","body","footer","getParametersForRoute","backdropPromise","setFocus","hasFocus","drawerRoot","getDrawerRoot","render","then","html","backdropWithAdjustments","modalBackdrop","messageDrawerZIndex","window","getComputedStyle","zIndex","setZIndex","getAttachmentPoint","get","addEventListener","e","publish","HIDE","preventDefault","trapFocus","document","getElementById","style","overflow","closeButton","focus","untrapFocus","button","attr","hide","go","isVisible","setJumpFrom","buttonid","init","uniqueId","alwaysVisible","events","activate","escape","paramRegex","on","data","element","target","closest","attributes","i","push","paramAttributes","filter","attribute","name","nodeName","test","sort","a","b","aParts","exec","bParts","aIndex","bIndex","params","map","nodeValue","routeParams","concat","apply","originalEvent","back","_$","drawer","toggleButtonId","toggleButton","undefined","focusableElement","elements","focusable","pendingPromise","one","resolve","keyup","key","firstInput","this","subscribe","SHOW","TOGGLE_VISIBILITY","buttonElement","setAttribute","get_string","string","SHOW_CONVERSATION","args","conversationid","CREATE_CONVERSATION_WITH_USER","userid","SHOW_SETTINGS","PREFERENCES_UPDATED","preferences","filteredPreferences","preference","type","enterToSendPreference","value","registerEventListeners","path","markDrawerReady"],"mappings":"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"}