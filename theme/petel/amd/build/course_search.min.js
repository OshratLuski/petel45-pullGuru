/**
 * Javascript controller for the aside blocks.
 *
 * @module     theme_petel/course_search
 * @package
 * @copyright  2023 Devlion <info@devlion.co>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @since      3.7
 */
define("theme_petel/course_search",["jquery","core/ajax","core/str","core/notification","jqueryui"],(function($,Ajax,Str,Notification){let actimer,strnoresults,strfoundxresults;Str.get_strings([{key:"noresults",component:"theme_petel"},{key:"foundxresults",component:"theme_petel"}]).done((function(strings){strnoresults=strings[0],strfoundxresults=strings[1]})).fail(Notification.exception),$.widget("ui.autocomplete",$.ui.autocomplete,{options:{messages:{noResults:strnoresults,results:function(amount){return amount+strfoundxresults}}},__response:function(content){var message;this._superApply(arguments),this.options.disabled||this.cancelSearch||(message=content&&content.length?this.options.messages.results(content.length):this.options.messages.noResults,this.liveRegion.children().hide(),$("<div>").text(message).appendTo(this.liveRegion))}});$.ui.autocomplete;const Selector_SEARCH_INPUT="#course_activity_search-input",Selector_MENU_ITEM=".ui-menu-item-wrapper",Class_AUTOCOMPLETE="ui-autocomplete",Class_AUTOCOMPLETE_PETEL="ui-autocomplete-petel ml-auto",getData=function(request,response){const courseid=$(Selector_SEARCH_INPUT).data("courseid");Ajax.call([{methodname:"theme_petel_course_search",args:{courseid:courseid,term:request.term},done:function(r){const res=JSON.parse(r);res.response>0?response(res.data):Str.get_string("noresults","theme_petel").done((function(s){response([])}))},fail:Notification.exception}])};return{init:function(){$(Selector_SEARCH_INPUT).autocomplete({source:getData,minLength:2,classes:{[Class_AUTOCOMPLETE]:Class_AUTOCOMPLETE_PETEL},focus:function(){const menu=$(this).data("uiAutocomplete").menu.element,focusedElement=menu.find("a.ui-state-active");$(Selector_SEARCH_INPUT).attr("aria-activedescendant",focusedElement.attr("id")),menu.find(Selector_MENU_ITEM).attr("aria-selected","false"),focusedElement.attr("aria-selected","true")},create:function(){$(this).data(Class_AUTOCOMPLETE)._renderItem=function(ul,item){let row;if(ul.attr("role","listbox"),"#"!==item.url){const regexp=new RegExp(item.term,"i");row=$('<li class="border-bottom" role="presentation">').append('\n                                <div class="link-wrapper"\n                                <a href="'.concat(item.url,'" role = "option" aria-label="').concat(item.name,'">\n                                    ').concat(item.name.replace(regexp,(match=>"<b>".concat(match,"</b>"))),"\n                                </a>\n                                </div>\n                            ")).appendTo(ul)}else row=$('<li class="border-bottom" role = "presentation">').append('\n                                <div class="link-wrapper"    \n                                    <a href="#" role = "option" aria-label="'.concat(item.name,'">').concat(item.name,"</a>\n                                </div>")).appendTo(ul);return row}},select:function(event,ui){"#"!==ui.item.url&&(window.location.href=ui.item.url)},open:function(){$(".ui-autocomplete-petel").css("width",$("#course_activity_search").outerWidth())}}),$(Selector_SEARCH_INPUT).on("change keyup keydown",(function(){clearTimeout(actimer),$(Selector_SEARCH_INPUT).autocomplete("option","minLength",2),1===$(this).val().trim().length&&(actimer=setTimeout((function(){$(Selector_SEARCH_INPUT).autocomplete("option","minLength",1),$(Selector_SEARCH_INPUT).autocomplete("search")}),2e3))}))}}}));

//# sourceMappingURL=course_search.min.js.map