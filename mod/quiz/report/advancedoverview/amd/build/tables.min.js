define("quiz_advancedoverview/tables",["exports","core/notification","core/str","jquery","report/advancedoverview/js/tabulator.min.js","quiz_advancedoverview/main","quiz_advancedoverview/studentsTableActions"],(function(_exports,_notification,Str,_jquery,_tabulatorMin,Main,studentsTableActions){function _getRequireWildcardCache(e){if("function"!=typeof WeakMap)return null;var r=new WeakMap,t=new WeakMap;return(_getRequireWildcardCache=function(e){return e?t:r})(e)}function _interopRequireWildcard(e,r){if(!r&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=_getRequireWildcardCache(r);if(t&&t.has(e))return t.get(e);var n={__proto__:null},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in e)if("default"!==u&&{}.hasOwnProperty.call(e,u)){var i=a?Object.getOwnPropertyDescriptor(e,u):null;i&&(i.get||i.set)?Object.defineProperty(n,u,i):n[u]=e[u]}return n.default=e,t&&t.set(e,n),n}function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.translatedStrings=_exports.initstudentstable=_exports.initquestionstable=_exports.initdiagnosticquestionstable=_exports.hideLoadingIcon=_exports.TEMPCONFIG=_exports.TABLES=_exports.QLENGTH=void 0,_notification=_interopRequireDefault(_notification),Str=_interopRequireWildcard(Str),_jquery=_interopRequireDefault(_jquery),_tabulatorMin=_interopRequireDefault(_tabulatorMin),Main=_interopRequireWildcard(Main),studentsTableActions=_interopRequireWildcard(studentsTableActions);const locale=function(){let locale,lang=document.documentElement.getAttribute("lang");switch(lang){case"he":case"he-kids":locale="he-IL";break;case"en":locale="en-GB";break;default:locale=lang}return locale}();let QLENGTH=0;_exports.QLENGTH=QLENGTH;const SELECTORS={};let outerQuestions;_exports.TEMPCONFIG={};const TABLES={};_exports.TABLES=TABLES;_exports.translatedStrings={};const hideLoadingIcon=()=>{document.body.classList.remove("petel-loading")};_exports.hideLoadingIcon=hideLoadingIcon;_exports.initdiagnosticquestionstable=function(data,questions){let textDirection=(0,_jquery.default)("html").attr("dir");outerQuestions=questions;let tabledata=JSON.parse(data);_exports.QLENGTH=QLENGTH=tabledata.length;let content={headerSortElement:function(column,dir){switch(dir){case"asc":return"<i class='fas fa-sort-up'>";case"desc":return"<i class='fas fa-sort-down'>";default:return"<i class='fas fa-sort'>"}},locale:locale,data:tabledata,autoColumns:!0,movableRows:!1,maxHeight:280,textDirection:textDirection,layout:"fitColumns",autoColumnsDefinitions:function(definitions){return definitions.forEach(((column,i)=>{switch(i){case 0:column.maxWidth="50px";break;case 1:column.headerSort=!1,column.formatter="html",column.widthGrow=5,column.hozAlign="start",column.vertAlign="middle";break;case 2:column.maxWidth="80px";break;case 3:column.maxWidth="90px";break;case 4:column.maxWidth="120px";break;case 5:column.maxWidth="160px";break;case 6:column.maxWidth="140px";break;default:column.hozAlign="center",column.vertAlign="middle",column.widthGrow=0}})),definitions},rowFormatter:function(row){row.getElement().style.height="48px"},initialSort:[{column:"he-IL"===locale?"שגו":"Wrong",dir:"desc"}]};TABLES.diagnosticQuestionsTable=new _tabulatorMin.default("#diagnostic-table",content)};function question_table_number_sort(a,b){return(0,_jquery.default)(a).find(".numerical_value").text()-(0,_jquery.default)(b).find(".numerical_value").text()}_exports.initquestionstable=function(data,questions){SELECTORS.studentstableNavFilter=document.getElementById("studentstableNavFilter"),SELECTORS.studentsActionsCollapse=document.getElementById("studentsActionsCollapse");let textDirection=(0,_jquery.default)("html").attr("dir");outerQuestions=questions;let tabledata=JSON.parse(data);_exports.QLENGTH=QLENGTH=tabledata.length;let content={headerSortElement:function(column,dir){switch(dir){case"asc":return"<i class='fas fa-sort-up'>";case"desc":return"<i class='fas fa-sort-down'>";default:return"<i class='fas fa-sort'>"}},locale:locale,data:tabledata,autoColumns:!0,movableRows:!1,maxHeight:280,textDirection:textDirection,layout:"fitColumns",autoColumnsDefinitions:function(definitions){return definitions.forEach(((column,i)=>{switch(i){case 0:column.maxWidth="50px";break;case 1:column.headerSort=!1,column.formatter="html",column.widthGrow=5,column.hozAlign="start",column.vertAlign="middle";break;case 2:column.sorter=function(a,b,aRow,bRow,column,dir,sorterParams){return question_table_number_sort(a,b)},column.maxWidth="80px";break;case 3:column.sorter=function(a,b,aRow,bRow,column,dir,sorterParams){return question_table_number_sort(a,b)},column.maxWidth="90px";break;case 4:column.sorter=function(a,b,aRow,bRow,column,dir,sorterParams){return question_table_number_sort(a,b)},column.maxWidth="120px";break;case 5:column.sorter=function(a,b,aRow,bRow,column,dir,sorterParams){return question_table_number_sort(a,b)},column.maxWidth="160px";break;case 6:column.sorter=function(a,b,aRow,bRow,column,dir,sorterParams){return question_table_number_sort(a,b)},column.maxWidth="140px";break;default:column.hozAlign="center",column.vertAlign="middle",column.widthGrow=0}column.formatter=function(cell){return cell.getValue()}})),definitions},rowFormatter:function(row){row.getElement().style.height="48px"},initialSort:[{column:"he-IL"===locale?"שגו":"Wrong",dir:"desc"}]};TABLES.questionsTable=new _tabulatorMin.default("#questions-table",content)};_exports.initstudentstable=function(data){let summary=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";const self=this;Str.get_strings([{key:"viewingprofile",component:"quiz_advancedoverview"},{key:"passwordreset",component:"quiz_advancedoverview"},{key:"loginasthisstudent",component:"quiz_advancedoverview"},{key:"allcoursereport",component:"quiz_advancedoverview"},{key:"courseobservationreport",component:"quiz_advancedoverview"},{key:"sendingmessage",component:"quiz_advancedoverview"},{key:"recalculategrades",component:"quiz_advancedoverview"},{key:"fullname",component:"quiz_advancedoverview"},{key:"team",component:"quiz_advancedoverview"},{key:"state",component:"quiz_advancedoverview"},{key:"attempt_number",component:"quiz_advancedoverview"},{key:"grade",component:"quiz_advancedoverview"},{key:"starttime",component:"quiz_advancedoverview"},{key:"endtime",component:"quiz_advancedoverview"},{key:"duration",component:"quiz_advancedoverview"},{key:"empty",component:"quiz_advancedoverview"},{key:"pagetitle",component:"quiz_advancedoverview"},{key:"firsttitle",component:"quiz_advancedoverview"},{key:"lasttitle",component:"quiz_advancedoverview"},{key:"prevtitle",component:"quiz_advancedoverview"},{key:"nexttitle",component:"quiz_advancedoverview"},{key:"all",component:"quiz_advancedoverview"},{key:"firstname",component:"quiz_advancedoverview"},{key:"lastname",component:"quiz_advancedoverview"}]).done((function(str){self.translatedStrings.viewingprofile=str[0],self.translatedStrings.passwordreset=str[1],self.translatedStrings.loginasthisstudent=str[2],self.translatedStrings.allcoursereport=str[3],self.translatedStrings.courseobservationreport=str[4],self.translatedStrings.sendingmessage=str[5],self.translatedStrings.recalculategrades=str[6],self.translatedStrings.fullname=str[7],self.translatedStrings.team=str[8],self.translatedStrings.state=str[9],self.translatedStrings.attemptNumber=str[10],self.translatedStrings.grade=str[11],self.translatedStrings.starttime=str[12],self.translatedStrings.endtime=str[13],self.translatedStrings.duration=str[14],self.translatedStrings.emptyTable=str[15],self.translatedStrings.pageTitle=str[16],self.translatedStrings.firstTitle=str[17],self.translatedStrings.lastTitle=str[18],self.translatedStrings.prevTitle=str[19],self.translatedStrings.nextTitle=str[20],self.translatedStrings.all=str[21],self.translatedStrings.firstname=str[22],self.translatedStrings.lastname=str[23];const clickMenu=[{disabled:function(component){return!component.getData().userprofilelink},label:`<span>${self.translatedStrings.viewingprofile}</span>`,action:function(e,row){var link=row.getData().userprofilelink;window.open(link,"_blank")}},{disabled:function(component){return!component.getData().resetpasswordlink},label:`<span>${self.translatedStrings.passwordreset}</span>`,action:function(e,row){var link=row.getData().resetpasswordlink;window.open(link,"_blank")}},{disabled:function(component){return!component.getData().loginaslink},label:`<span>${self.translatedStrings.loginasthisstudent}</span>`,action:function(e,row){var link=row.getData().loginaslink;window.open(link,"_blank")}},{disabled:function(component){return!component.getData().completereportlink},label:`<span>${self.translatedStrings.allcoursereport}</span>`,action:function(e,row){var link=row.getData().completereportlink;window.open(link,"_blank")}},{disabled:function(component){return!component.getData().outlinereportlink},label:`<span>${self.translatedStrings.courseobservationreport}</span>`,action:function(e,row){var link=row.getData().outlinereportlink;window.open(link,"_blank")}},{separator:!0},{label:`<span>${self.translatedStrings.sendingmessage}</span>`,action:function(e,row){var userid=row.getData().userid;Main.showMessagePopup([userid])}},{disabled:function(component){return!component.getData().attemptid},label:`<span>${self.translatedStrings.recalculategrades}</span>`,action:function(e,row){var rowData=row.getData();Main.regradaAttemtps(+Main.TEMPDATA.cmid,+Main.TEMPDATA.courseid,+Main.TEMPDATA.quizid,rowData.attemptid)}}];let textDirection=(0,_jquery.default)("html").attr("dir"),tabledata=JSON.parse(data);const linkRegex=/<a[^>]*>([^<]+)<\/a>/;tabledata.map((el=>{const newGrade=linkRegex.exec(el.grade);return newGrade&&(el.grade=newGrade[1]),el}));let content={headerSortElement:function(column,dir){switch(dir){case"asc":return"<i class='fas fa-sort-up'>";case"desc":return"<i class='fas fa-sort-down'>";default:return"<i class='fas fa-sort'>"}},placeholder:self.translatedStrings.emptyTable,locale:locale,langs:{"he-IL":{pagination:{page_title:self.translatedStrings.pageTitle,first:self.translatedStrings.firstTitle,first_title:self.translatedStrings.firstTitle,last:self.translatedStrings.lastTitle,last_title:self.translatedStrings.lastTitle,prev:self.translatedStrings.prevTitle,prev_title:self.translatedStrings.prevTitle,next:self.translatedStrings.nextTitle,next_title:self.translatedStrings.nextTitle,all:self.translatedStrings.all}}},data:tabledata,autoColumns:!0,movableRows:!1,textDirection:textDirection,frozenRows:0,pagination:!1,paginationSize:20,rowHeight:48,dataTree:!0,dataTreeStartExpanded:!0,layout:"fitDataFill",autoColumnsDefinitions:function(definitions){return definitions.forEach(((column,i)=>{const fieldName=column.field;switch(column.formatter="html",column.topCalc=customTopCalc,column.topCalcParams={field:column.field},fieldName){case"checkbox":column.formatter="rowSelection",column.titleFormatter="rowSelection",column.titleFormatterParams={rowRange:"active"},column.headerSort=!1,column.hozAlign="center",column.download=!1;break;case"fullname":column.title=self.translatedStrings.fullname,column.headerSort=!1,column.cellStyle="border-right: none;";break;case"team":column.title=self.translatedStrings.team;break;case"state":column.title=self.translatedStrings.state;break;case"attempt_number":column.title=self.translatedStrings.attemptNumber,column.sorter="number",column.hozAlign="center",column.cssClass="justify-content-center";break;case"grade":column.title=self.translatedStrings.grade,column.sorter="number",column.hozAlign="center",column.cssClass="justify-content-center";break;case"starttime":column.title=self.translatedStrings.starttime,column.formatter=function(cell){var cellValue=cell.getValue();if("—"===cellValue){let wrappedValue=document.createElement("span");return wrappedValue.className="wrapped-value",wrappedValue.innerHTML=cellValue,wrappedValue}return cellValue};break;case"endtime":column.title=self.translatedStrings.endtime,column.formatter=function(cell){var cellValue=cell.getValue();if("—"===cellValue){let wrappedValue=document.createElement("span");return wrappedValue.className="wrapped-value",wrappedValue.innerHTML=cellValue,wrappedValue}return cellValue};break;case"duration":column.title=self.translatedStrings.duration,column.sorter=function(a,b,aRow,bRow,column,dir,sorterParams){function sortTime(el){let split=el.split("|");return Number(split[1])}return sortTime(a)-sortTime(b)},column.formatter=function(cell){let cellValue=cell.getValue().split("|")[0];if("—"===cellValue){let wrappedValue=document.createElement("span");return wrappedValue.className="wrapped-value",wrappedValue.innerHTML=cellValue,wrappedValue}return cellValue};break;case"usermenubtn":column.headerSort=!1,column.title="",column.formatter=function(cell){if(!1===cell.getValue())return"";{let dropdownBtn=document.createElement("button");return dropdownBtn.className="row-menu-btn btn",dropdownBtn.type="button",dropdownBtn.innerHTML='<i class="fa fa-ellipsis-v"></i>',dropdownBtn}},column.clickMenu=clickMenu,column.download=!1;break;case"attemptid":case"user_attempt_code":case"userid":case"resetpasswordlink":case"userprofilelink":case"loginaslink":case"completereportlink":case"outlinereportlink":case"lastname":case"firstname":case"_children":column.visible=!1;break;default:let resultText;if(outerQuestions&&outerQuestions.texts){let rawText=outerQuestions.texts[i-20].replace(/\&nbsp;/g,"");resultText=rawText.length>50?"..."+rawText.slice(0,49):rawText}column.headerTooltip=resultText,column.sorter=function(a,b,aRow,bRow,column,dir,sorterParams){function sortQuestion(el){let result=-3;if("—"===el[0])return result=-2,result;if("<"===el[0]&&el.includes("=numerical_value")){const pattern=/<div class=numerical_value>([\d.]+)<\/div>/,match=el.match(pattern);if(el.includes("=complete"))return result=100,result;if(el.includes("=incorrect"))return result=-1,result;result=match[1]}return result}return sortQuestion(b)-sortQuestion(a)},column.formatter=function(cell){var cellValue=cell.getValue();if("—"===cellValue){let wrappedValue=document.createElement("span");return wrappedValue.className="wrapped-value",wrappedValue.innerHTML=cellValue,wrappedValue}return cellValue}}i<=11&&(column.frozen=!0)})),definitions}};function customTopCalc(values,data,calcParams){const parsedSummary=JSON.parse(summary),fieldname=calcParams.field;return void 0!==parsedSummary[fieldname]&&!1!==parsedSummary[fieldname]?parsedSummary[fieldname]:""}tabledata.length>20&&(content.pagination=!0),self.TABLES.studentsTable=new _tabulatorMin.default("#students-table",content),self.TABLES.studentsTable.on("rowSelectionChanged",(function(data,rows){Main.TEMPDATA.rowData=data;let state=!(data.length>0);Main.changeStudentActionState(state);let len,lentable=self.TABLES.studentsTable.getData().length;len=rows.length===lentable?lentable-1:rows.length,Main.setSelectedStudentsStr(len)})),(0,_jquery.default)("#downloadXlsTable").off("click"),(0,_jquery.default)("#downloadXlsTable").on("click",(function(){var tableData=self.TABLES.studentsTable.getData(),td2=[];tableData.forEach((function(row){"summary"!==row.userid&&(row.hasOwnProperty("_children")?(td2.push(row),row._children.forEach((function(ch){td2.push(ch)})),delete row._children):td2.push(row))})),td2.forEach((function(row){for(var prop1 in delete row.checkbox,delete row.usermenubtn,delete row.attemptid,delete row.user_attempt_code,delete row.userid,delete row.resetpasswordlink,delete row.userprofilelink,delete row.loginaslink,delete row.completereportlink,delete row.outlinereportlink,delete row.fullname,row){if(row.hasOwnProperty(prop1)&&/^Q \d+ \/ \d+$/.test(prop1)){var match11=row[prop1].match(/<div.*>(\d+(?:\.\d+)?)<\/div>/);if(match11){var newValue11=match11[1];row[prop1]=newValue11}row[prop1]=(dirtyString=row[prop1],(new DOMParser).parseFromString(dirtyString,"text/html").body.textContent||"")}if(row.hasOwnProperty(prop1)&&("fullname"===prop1||"grade"===prop1)){var match12=row[prop1].toString().match(/<a[^>]*>([^<]*)<\/a>/i);if(match12){var newValue12=match12[1];row[prop1]=newValue12}}}var dirtyString;for(var prop2 in row)if(row.hasOwnProperty(prop2))switch(prop2){case"firstname":row[self.translatedStrings.firstname]=row[prop2],delete row[prop2];break;case"lastname":row[self.translatedStrings.lastname]=row[prop2],delete row[prop2];break;case"fullname":row[self.translatedStrings.fullname]=row[prop2],delete row[prop2];break;case"team":row[self.translatedStrings.team]=row[prop2],delete row[prop2];break;case"state":row[self.translatedStrings.state]=row[prop2],delete row[prop2];break;case"attempt_number":row[self.translatedStrings.attemptNumber]=row[prop2],delete row[prop2];break;case"grade":row[self.translatedStrings.grade]=row[prop2],delete row[prop2];break;case"starttime":row[self.translatedStrings.starttime]=row[prop2],delete row[prop2];break;case"endtime":row[self.translatedStrings.endtime]=row[prop2],delete row[prop2];break;case"duration":row[self.translatedStrings.duration]=row[prop2],delete row[prop2];break;default:var value=row[prop2];delete row[prop2],row[prop2]=value}}));var workbook=XLSX.utils.book_new(),worksheet=XLSX.utils.json_to_sheet(td2);XLSX.utils.book_append_sheet(workbook,worksheet,"Sheet1"),XLSX.writeFile(workbook,"table-data.xlsx")})),self.TABLES.studentsTable.on("tableBuilt",(function(){let tableData=self.TABLES.studentsTable.getSelectedData();Main.TEMPDATA.rowData=tableData;let state=!(tableData.length>0);function setActive(target){(0,_jquery.default)(target).closest(".tabulator-col-title").find("span").removeClass("active"),(0,_jquery.default)(target).addClass("active")}Main.changeStudentActionState(state),Main.setSelectedStudentsStr(tableData.length),(0,_jquery.default)("#students-table .tabulator-sortable.tabulator-col-sorter-element").on("click",(function(e){let target=(0,_jquery.default)(e.target);target.hasClass("fname")||target.hasClass("sname")||(0,_jquery.default)('[tabulator-field="fullname"]').find("span").removeClass("active")})),(0,_jquery.default)('[tabulator-field="fullname"]').on("click",".fname",(function(e){let resultSort="desc"===e.target.dataset.sort?"asc":"desc";e.target.setAttribute("data-sort",resultSort),setActive(e.target),self.TABLES.studentsTable.setSort("firstname",resultSort)})),(0,_jquery.default)('[tabulator-field="fullname"]').on("click",".lname",(function(e){let resultSort="desc"===e.target.dataset.sort?"asc":"desc";e.target.setAttribute("data-sort",resultSort),setActive(e.target),self.TABLES.studentsTable.setSort("lastname",resultSort)})),hideLoadingIcon()}))})).fail(_notification.default.exception)}}));

//# sourceMappingURL=tables.min.js.map