define("quiz_advancedoverview/main",["exports","jquery","core/str","core/modal_factory","core/modal_events","core/ajax","core/templates","core/notification","quiz_advancedoverview/studentsTableActions"],(function(_exports,_jquery,Str,_modal_factory,_modal_events,_ajax,_templates,_notification,studentsTableActions){function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!=typeof obj&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.submitSendMessage=_exports.showMessagePopup=_exports.setSelectedStudentsStr=_exports.renderDynamicBlock=_exports.regradaAttemtps=_exports.init=_exports.deleteAttemtps=_exports.closingResponseAttempts=_exports.changeStudentActionState=_exports.TEMPDATA=void 0,_jquery=_interopRequireDefault(_jquery),Str=_interopRequireWildcard(Str),_modal_factory=_interopRequireDefault(_modal_factory),_modal_events=_interopRequireDefault(_modal_events),_ajax=_interopRequireDefault(_ajax),_templates=_interopRequireDefault(_templates),_notification=_interopRequireDefault(_notification),studentsTableActions=_interopRequireWildcard(studentsTableActions);const SELECTORS_SelectGroupBtn="#advancedoverview_groupid",SELECTORS_dynamicBlock=".dynamic-block",SELECTORS_btns='#studentsActionsBlock button[type="button"]',SELECTORS_studentsActionsBtn="#studentsActionsBtn",SELECTORS_checkboxes='#studentsActionsCollapse input[type="checkbox"]',SELECTORS_sendMessage="#sendMessage",SELECTORS_recalculateGrades="#recalculateGrades",SELECTORS_deleteAttemtps="#deleteAttemtps",SELECTORS_closingResponseAttempts="#closingResponseAttempts",SELECTORS_zerostr="#zerostr",SELECTORS_counterstr="#counterstr";_exports.TEMPDATA={};_exports.init=function(cmid,courseid,quizid,defaultconfig){let self=this;self.TEMPDATA.cmid=cmid,self.TEMPDATA.courseid=courseid,self.TEMPDATA.quizid=quizid,studentsTableActions.changeConfig(JSON.parse(defaultconfig)),studentsTableActions.init(),(0,_jquery.default)(document).ready((function(){studentsTableActions.showPills(studentsTableActions.CONFIG)})),(0,_jquery.default)(SELECTORS_SelectGroupBtn).closest(".dropdown").find(".dropdown-item").on("click",(function(e){let value=(0,_jquery.default)(e.currentTarget).data("value"),name=(0,_jquery.default)(e.currentTarget).data("name");(0,_jquery.default)(SELECTORS_SelectGroupBtn).data("value",value),(0,_jquery.default)(SELECTORS_SelectGroupBtn).data("name",name),(0,_jquery.default)(SELECTORS_SelectGroupBtn).find("span").html(name),(0,_jquery.default)(SELECTORS_SelectGroupBtn).addClass("selected"),studentsTableActions.showLoadingIcon(),self.renderDynamicBlock(cmid,value)})),(0,_jquery.default)(document).on("click",SELECTORS_btns,(function(e){(target=>{let state="true"===target.getAttribute("aria-pressed")?"false":"true";target.setAttribute("aria-pressed",state),target.classList.toggle("active"),target.closest(".nav-tabs")&&target.closest(".nav-tabs").querySelectorAll('button[type="button"]').forEach((el=>{el!==target&&(el.classList.remove("active"),el.setAttribute("aria-pressed","false"))}))})(e.currentTarget)})),(0,_jquery.default)(SELECTORS_checkboxes).each((i=>{(0,_jquery.default)(SELECTORS_checkboxes)[i].checked=!1})),(0,_jquery.default)(document).on("click",SELECTORS_sendMessage,(function(){let users=[],data=self.TEMPDATA.rowData;data.length>0&&data.forEach((el=>{users.push(el.userid)})),self.showMessagePopup(users)})),(0,_jquery.default)(document).on("change","#scoreDisplayToggler",(function(){(0,_jquery.default)("#students-table").toggleClass("score-display")})),(0,_jquery.default)(document).on("click",'a[target="popup"]',(function(e){e.preventDefault(),e.stopPropagation();let link=e.currentTarget.href;open(link,"","scrollbars=no,resizable=no,status=no,location=no,toolbar=no,menubar=no,\n                        width=600,height=600,left=100,top=100")})),(0,_jquery.default)(document).on("click",SELECTORS_recalculateGrades,(function(){let attemptids="",data=self.TEMPDATA.rowData;data.length>0&&data.forEach((el=>{el.attemptid&&(attemptids+=el.attemptid+",")})),attemptids=attemptids.slice(0,-1),attemptids?self.regradaAttemtps(+self.TEMPDATA.cmid,+self.TEMPDATA.courseid,+self.TEMPDATA.quizid,attemptids):Str.get_strings([{key:"reportregrade",component:"quiz_advancedoverview"},{key:"selecteditemswrong",component:"quiz_advancedoverview"}]).done((function(strings){var modalPromise=_modal_factory.default.create({type:_modal_factory.default.types.CANCEL,title:strings[0],body:strings[1]});_jquery.default.when(modalPromise).then((function(fmodal){return fmodal})).done((function(modal){modal.show()})).fail(_notification.default.exception)}))})),(0,_jquery.default)(document).on("click",SELECTORS_deleteAttemtps,(function(){let attemptids="",data=self.TEMPDATA.rowData;data.length>0&&data.forEach((el=>{el.attemptid&&(attemptids+=el.attemptid+",")})),attemptids=attemptids.slice(0,-1),attemptids?self.deleteAttemtps(+self.TEMPDATA.cmid,+self.TEMPDATA.courseid,+self.TEMPDATA.quizid,attemptids):Str.get_strings([{key:"deletingattempts",component:"quiz_advancedoverview"},{key:"selecteditemswrong",component:"quiz_advancedoverview"}]).done((function(strings){var modalPromise=_modal_factory.default.create({type:_modal_factory.default.types.CANCEL,title:strings[0],body:strings[1]});_jquery.default.when(modalPromise).then((function(fmodal){return fmodal})).done((function(modal){modal.show()})).fail(_notification.default.exception)}))})),(0,_jquery.default)(document).on("click",SELECTORS_closingResponseAttempts,(function(){let attemptids="",data=self.TEMPDATA.rowData;data.length>0&&data.forEach((el=>{el.attemptid&&(attemptids+=el.attemptid+",")})),attemptids=attemptids.slice(0,-1),attemptids?self.closingResponseAttempts(+self.TEMPDATA.cmid,+self.TEMPDATA.courseid,+self.TEMPDATA.quizid,attemptids):Str.get_strings([{key:"closingresponseattempts",component:"quiz_advancedoverview"},{key:"selecteditemswrong",component:"quiz_advancedoverview"}]).done((function(strings){var modalPromise=_modal_factory.default.create({type:_modal_factory.default.types.CANCEL,title:strings[0],body:strings[1]});_jquery.default.when(modalPromise).then((function(fmodal){return fmodal})).done((function(modal){modal.show()})).fail(_notification.default.exception)}))})),(0,_jquery.default)(document).on("change","#extendedViewToggler",(function(){studentsTableActions.CONFIG.participants.full_view=(0,_jquery.default)(this).is(":checked")?1:0,studentsTableActions.showLoadingIcon()}))};_exports.renderDynamicBlock=function(cmid,groupid){_ajax.default.call([{methodname:"quiz_advancedoverview_render_dynamic_block",args:{cmid:cmid,groupid:groupid,config:JSON.stringify(studentsTableActions.CONFIG)},done:function(response){let data=JSON.parse(response);_templates.default.render("quiz_advancedoverview/dynamic_block",data).done((function(html,js){studentsTableActions.setStatesFromConfig(),_templates.default.replaceNodeContents(SELECTORS_dynamicBlock,html,js),studentsTableActions.showPills(studentsTableActions.CONFIG)})).fail(_notification.default.exception)},fail:_notification.default.exception}])};_exports.showMessagePopup=function(users){if(0===users.length)return _jquery.default.Deferred().resolve().promise();var titlePromise=null;return titlePromise=1===users.length?Str.get_string("sendbulkmessagesingle","core_message"):Str.get_string("sendbulkmessage","core_message",users.length),_jquery.default.when(_modal_factory.default.create({type:_modal_factory.default.types.SAVE_CANCEL,body:_templates.default.render("core_user/send_bulk_message",{})}),titlePromise).then(function(modal,title){this.modal=modal,this.modal.setTitle(title),this.modal.setSaveButtonText(title);let textarea=this.modal.getRoot().find("textarea"),submitBtn=this.modal.getRoot().find('.btn[data-action="save"]');return submitBtn.prop("disabled","true"),textarea.on("keypress",(()=>{submitBtn.prop("disabled",!(textarea.val().trim().length>0))})),this.modal.getRoot().on(_modal_events.default.hidden,function(){this.modal.getRoot().remove()}.bind(this)),this.modal.getRoot().on(_modal_events.default.shown,(function(){textarea.focus()})),this.modal.getRoot().on(_modal_events.default.save,this.submitSendMessage.bind(this,users)),this.modal.show(),this.modal}.bind(this))};_exports.submitSendMessage=function(users){var messageText=this.modal.getRoot().find("form textarea").val(),messages=[],i=0;for(i=0;i<users.length;i++)messages.push({touserid:users[i],text:messageText});return _ajax.default.call([{methodname:"core_message_send_instant_messages",args:{messages:messages}}])[0].then((function(messageIds){return 1===messageIds.length?Str.get_string("sendbulkmessagesentsingle","core_message"):Str.get_string("sendbulkmessagesent","core_message",messageIds.length)})).then((function(msg){return _notification.default.addNotification({message:msg,type:"success"}),!0})).catch(_notification.default.exception)};_exports.regradaAttemtps=function(cmid,courseid,quizid,attemptids){let self=this;Str.get_strings([{key:"reportregrade",component:"quiz_advancedoverview"},{key:"areyoushure",component:"quiz_advancedoverview"},{key:"execute",component:"quiz_advancedoverview"}]).done((function(strings){var modalPromise=_modal_factory.default.create({type:_modal_factory.default.types.SAVE_CANCEL,title:strings[0],body:strings[1]});_jquery.default.when(modalPromise).then((function(fmodal){return fmodal.setSaveButtonText(strings[2]),fmodal.getRoot().on(_modal_events.default.save,(function(){_ajax.default.call([{methodname:"quiz_advancedoverview_regrade_attempts",args:{cmid:cmid,courseid:courseid,quizid:quizid,attemptids:attemptids},done:function(response){response&&self.renderDynamicBlock(cmid,null)},fail:_notification.default.exception}])})),fmodal})).done((function(modal){modal.show()})).fail(_notification.default.exception)}))};_exports.deleteAttemtps=function(cmid,courseid,quizid,attemptids){let self=this;Str.get_strings([{key:"deletingattempts",component:"quiz_advancedoverview"},{key:"areyoushure",component:"quiz_advancedoverview"},{key:"execute",component:"quiz_advancedoverview"}]).done((function(strings){var modalPromise=_modal_factory.default.create({type:_modal_factory.default.types.SAVE_CANCEL,title:strings[0],body:strings[1]});_jquery.default.when(modalPromise).then((function(fmodal){return fmodal.setSaveButtonText(strings[2]),fmodal.getRoot().on(_modal_events.default.save,(function(){_ajax.default.call([{methodname:"quiz_advancedoverview_delete_attempts",args:{cmid:cmid,courseid:courseid,quizid:quizid,attemptids:attemptids},done:function(response){response&&self.renderDynamicBlock(cmid,null)},fail:_notification.default.exception}])})),fmodal})).done((function(modal){modal.show()})).fail(_notification.default.exception)}))};_exports.closingResponseAttempts=function(cmid,courseid,quizid,attemptids){let self=this;Str.get_strings([{key:"closingresponseattempts",component:"quiz_advancedoverview"},{key:"areyoushure",component:"quiz_advancedoverview"},{key:"execute",component:"quiz_advancedoverview"}]).done((function(strings){var modalPromise=_modal_factory.default.create({type:_modal_factory.default.types.SAVE_CANCEL,title:strings[0],body:strings[1]});_jquery.default.when(modalPromise).then((function(fmodal){return fmodal.setSaveButtonText(strings[2]),fmodal.getRoot().on(_modal_events.default.save,(function(){_ajax.default.call([{methodname:"quiz_advancedoverview_close_attempts",args:{cmid:cmid,courseid:courseid,quizid:quizid,attemptids:attemptids},done:function(response){response&&self.renderDynamicBlock(cmid,null)},fail:_notification.default.exception}])})),fmodal})).done((function(modal){modal.show()})).fail(_notification.default.exception)}))};_exports.changeStudentActionState=function(state){(0,_jquery.default)(SELECTORS_studentsActionsBtn)[0].disabled=state};_exports.setSelectedStudentsStr=function(numberOfRows){numberOfRows>0?((0,_jquery.default)(SELECTORS_zerostr).hide(),Str.get_string("selectedstudents","quiz_advancedoverview",numberOfRows).then((function(result){return(0,_jquery.default)(SELECTORS_counterstr)[0].innerHTML=result,result})).fail(_notification.default.exception),(0,_jquery.default)(SELECTORS_counterstr).show()):((0,_jquery.default)(SELECTORS_zerostr).show(),(0,_jquery.default)(SELECTORS_counterstr).hide())}}));

//# sourceMappingURL=main.min.js.map