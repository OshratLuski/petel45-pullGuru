define("quiz_advancedoverview/charts",["exports","core/str","jquery","report/advancedoverview/js/d3.v7.min.js"],(function(_exports,Str,_jquery,_d3V7Min){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.initcharts=_exports.initTooltip=_exports.createStateChart=_exports.createGradeChart=void 0,Str=function(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!=typeof obj&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}newObj.default=obj,cache&&cache.set(obj,newObj);return newObj}(Str),_jquery=_interopRequireDefault(_jquery),_d3V7Min=_interopRequireDefault(_d3V7Min);const chartParams={gradeColorScheme:["#b2b2b2","#003F5B","#003F5B","#003F5B","#003F5B","#003F5B","#003F5B"],stateColorScheme:["#003F5B","#FFBC00","#5175A8"]};_exports.createStateChart=function(parent){let parentCard=(0,_jquery.default)(parent).closest(".card");parentCard.find(".donut-сhart-legend-title").html(""),parentCard.find(".donut-сhart-legend-inner").html(""),parentCard.find(".donut-сhart").html("");const state_svg=_d3V7Min.default.select(parent).append("svg").attr("width",128).attr("height",128).append("g").attr("transform","translate(64 ,64)"),color=_d3V7Min.default.scaleOrdinal().range(chartParams.stateColorScheme),state_data=_d3V7Min.default.pie().value((d=>d[1].value))(Object.entries(chartParams.state));state_svg.selectAll("whatever").data(state_data).join("path").attr("d",_d3V7Min.default.arc().innerRadius(38.4).outerRadius(128/2.1)).attr("data-type","state").attr("data-index",(d=>d.data[0])).attr("data-label",(d=>d.data[1].label)).attr("data-value",(d=>d.data[1].value)).attr("fill",(d=>color(d.data[0]))).attr("stroke","white").style("stroke-width","1px");let usersSumm=0;chartParams.state.forEach(((element,index)=>{((index,label,value)=>{let template=`<div class="donut-сhart-legend-row" data-row-type="${label}">\n                        <div class="square" style="background-color: ${chartParams.stateColorScheme[index]}"></div>\n                        <div class="card-text">${value} ${label}</div>\n                </div>`;return(0,_jquery.default)(template)})(index,element.label,element.value).appendTo(".donut-сhart-legend-inner"),usersSumm+=+element.value}));var donutChartLegendTitle=Str.get_string("studentsintotal","quiz_advancedoverview",usersSumm);_jquery.default.when(donutChartLegendTitle).done((function(str){(0,_jquery.default)(".donut-сhart-legend-title").text(str)})),this.initTooltip(parent,state_svg)};_exports.createGradeChart=function(parent){(0,_jquery.default)(parent).closest(".card").find(".bar-сhart").html("");let height=96;const grade_svg=_d3V7Min.default.select(parent).append("svg").style("overflow","visible").attr("width",380).attr("height",height+30).append("g").attr("transform","translate(0, 30)");let grade_data=chartParams.grade;const color=_d3V7Min.default.scaleOrdinal().range(chartParams.gradeColorScheme),x=_d3V7Min.default.scaleBand().range([0,380]).domain(grade_data.map((d=>d.label))).padding(.2);grade_svg.append("g").attr("transform",`translate(0, ${height-24})`).call(_d3V7Min.default.axisBottom(x).ticks(8,"$.0f")).call(_d3V7Min.default.axisBottom(x).tickSize(0)).call((g=>g.select(".domain").remove())).selectAll("text").style("font-size","0.875rem").style("text-anchor","center").attr("transform",((d,i)=>i>0?"translate(14, 0)":"translate(0, 0)"));const max=_d3V7Min.default.max(grade_data,(function(d){return d.value}));0===max&&(height=0);const y=_d3V7Min.default.scaleLinear().domain([0,max]).range([height,0]);grade_svg.selectAll("mybar").data(grade_data).enter().append("rect").attr("x",((d,i)=>{let xPosition=x(d.label);return i>0&&(xPosition+=14),xPosition+11})).attr("y",(d=>y(d.value))).attr("width",x.bandwidth()-22).attr("height",(function(d){let value=height-y(d.value)-30;return value>0?value:0})).attr("fill",(d=>color(d))).attr("stroke","#707070").style("stroke-width","1px").attr("data-type","grade").attr("data-index",((d,i)=>i)).attr("data-label",(d=>d.label)).attr("data-value",(d=>d.value)),this.initTooltip(parent,grade_svg)};_exports.initTooltip=function(target,state_svg){var tooltip=_d3V7Min.default.select(target).append("div").attr("class","chart-tooltip").html('\n                <div class="chart-tooltip-header d-flex align-items-center justify-content-between">\n                    <button type="button" class="close-tooltip-btn mr-2">\n                        <i class="fa-regular fa-circle-xmark"></i>\n                    </button>\n                    <div class="chart-tooltip-title"></div>\n                </div>\n                <div class="inner">\n                    <div class="chart-tooltip-body p-2"></div>\n                </div>\n            ');state_svg.on("mouseover",(function(d){if("path"===d.target.localName||"rect"===d.target.localName){let title=`${d.target.dataset.value} ${d.target.dataset.label}`,type=d.target.dataset.type||"",index=d.target.dataset.index||"",users=chartParams[type][index].users||"",counter=0,usersList="";users&&users.forEach((el=>{var name,link;usersList+=(name=el.firstname+" "+el.lastname,link=el.link,el.disabled?`<span target=”_blank” class="tooltip-link d-block text-decoration-none ">${name}</span>`:`<a href="${link}" target=”_blank” class="tooltip-link d-block">${name}</a>`),counter+=1})),tooltip.select(".chart-tooltip-title").html(title),tooltip.select(".chart-tooltip-body").html(usersList).attr("class",counter>10?"chart-tooltip-body hascolumns":"chart-tooltip-body"),tooltip.style("display","block");let tooltipHeight=tooltip.node().offsetHeight;tooltip.style("top",d.layerY-8-tooltipHeight/2+"px").style("left",d.layerX+8+"px")}})),state_svg.on("mouseout",(function(){tooltip.style("display","none")})),tooltip.on("mouseover",(function(){tooltip.style("display","block")})),tooltip.on("mouseout",(function(){tooltip.style("display","none")})),tooltip.select(".close-tooltip-btn").on("click",(function(){tooltip.style("display","none")}))};_exports.initcharts=function(charts){charts=JSON.parse(charts);let lang=(0,_jquery.default)("html")[0].lang;chartParams.textDirection="ltr","he"===lang&&(chartParams.textDirection="rtl"),chartParams.average=charts.average,chartParams.state=charts.state,chartParams.grade=charts.grade[0].values,this.createStateChart("#charts_state .donut-сhart"),this.createGradeChart("#charts_grade .bar-сhart")}}));

//# sourceMappingURL=charts.min.js.map