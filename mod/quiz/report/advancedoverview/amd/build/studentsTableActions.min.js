define("quiz_advancedoverview/studentsTableActions",["exports","jquery","quiz_advancedoverview/tables","core/ajax","core/notification","quiz_advancedoverview/charts","./tables"],(function(_exports,_jquery,Tables,_ajax,_notification,Charts,_tables2){function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!=typeof obj&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.showPills=_exports.showLoadingIcon=_exports.setStatesFromConfig=_exports.regenerateTable=_exports.init=_exports.changeConfig=_exports.anonymousmodestate=_exports.CONFIG=void 0,_jquery=_interopRequireDefault(_jquery),Tables=_interopRequireWildcard(Tables),_ajax=_interopRequireDefault(_ajax),_notification=_interopRequireDefault(_notification),Charts=_interopRequireWildcard(Charts);_exports.anonymousmodestate=0;let PILLS={},CONFIG={participants:new Proxy({},{set:(target,key,value)=>(target[key]=value,regenerateTable(),!0)}),anonymous_mode:0};_exports.CONFIG=CONFIG;_exports.changeConfig=newConfig=>{const participantsProxy=new Proxy(newConfig.participants,{set:(target,key,value)=>(target[key]=value,regenerateTable(),!0)});newConfig.participants=participantsProxy,_exports.CONFIG=CONFIG=newConfig};const showLoadingIcon=()=>{document.body.classList.add("petel-loading")};_exports.showLoadingIcon=showLoadingIcon;const regenerateTable=function(){let callback=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const cmid=(0,_jquery.default)("#datacmid").data("cmid"),groupid=(0,_jquery.default)("#datagroupid").data("groupid");_ajax.default.call([{methodname:"quiz_advancedoverview_render_dynamic_block",args:{cmid:cmid,groupid:groupid,config:JSON.stringify(CONFIG)},done:function(response){const data=JSON.parse(response),dataTableAccordingStudents=data.data_table_according_students,dataTableStudentsSummary=data.data_table_students_summary,anon=CONFIG.anonymous_mode;Tables.default.initstudentstable(dataTableAccordingStudents,dataTableStudentsSummary,anon),Charts.initcharts(data.charts),callback&&callback(),(0,_tables2.hideLoadingIcon)()},fail:_notification.default.exception}])};_exports.regenerateTable=regenerateTable;const setStatesFromConfig=function(){const state=CONFIG.anonymous_mode;if(document.getElementById("anonymousStripe")||createAnonymousStripe(),1==+state){(0,_jquery.default)("#anonymousStripe").removeClass("hidden"),(0,_jquery.default)("#anonymousStripe").attr("style","top:"+(0,_jquery.default)("nav.navbar-petel").outerHeight()+"px");let stateText=(0,_jquery.default)("#anonymousmodeToggler1").closest(".advancedoverview_report-toggle").data("texton");(0,_jquery.default)(".advancedoverview_report-toggle.anonymousmode").each((function(index){(0,_jquery.default)(".advancedoverview_report-toggle.anonymousmode").eq(index).find(".link-btn-text").html(stateText)})),(0,_jquery.default)("#anonymousmodeToggler1, #anonymousmodeToggler2, #anonymousmodeToggler3").prop("checked",!0)}else{(0,_jquery.default)("#anonymousStripe").addClass("hidden");let stateText=(0,_jquery.default)("#anonymousmodeToggler1").closest(".advancedoverview_report-toggle").data("textoff");(0,_jquery.default)(".advancedoverview_report-toggle.anonymousmode").each((function(index){(0,_jquery.default)(".advancedoverview_report-toggle.anonymousmode").eq(index).find(".link-btn-text").html(stateText)})),(0,_jquery.default)("#anonymousmodeToggler1, #anonymousmodeToggler2, #anonymousmodeToggler3").prop("checked",!1)}CONFIG.participants.states?(0,_jquery.default)("#studentstableNavFilter").find(`[data-name="${CONFIG.participants.states[0]}"]`).addClass("active").attr("aria-pressed","true"):(0,_jquery.default)("#studentstableNavFilter").find(".nav.nav-tabs .nav-link").first().addClass("active").attr("aria-pressed","true");const fullViewState=0!==CONFIG.participants.full_view;(0,_jquery.default)("#extendedViewToggler")[0].checked=fullViewState};_exports.setStatesFromConfig=setStatesFromConfig;const createAnonymousStripe=()=>{if(!document.getElementById("anonymousStripe")){const stripeContent='\n            <div class="d-flex align-items-center advancedoverview_report-toggle anonymousmode">\n                <input type="checkbox" id="anonymousmodeToggler3" class="toggle-btn d-none">\n                <label for="anonymousmodeToggler3" class="mb-0 anonymousmodeToggler d-none"> </label>\n                <span class="link-btn-text ml-3"></span>\n            </div>\n            <i class="fas fa-user-secret ml-4"></i>\n            ',navbar=document.querySelector("nav.navbar"),stripeElement=document.createElement("div");stripeElement.classList.add("sticky-stripe","align-items-center","justify-content-center","yellow","hidden"),stripeElement.id="anonymousStripe",stripeElement.innerHTML=stripeContent,navbar.insertAdjacentElement("afterbegin",stripeElement)}},addPill=(data,target)=>{const template=document.createElement("a");template.innerHTML=data.text,template.classList.add("pill","badge","badge-light","m-1","p-2"),template.setAttribute("id","pill"+data.id),template.setAttribute("data-id",data.id),template.setAttribute("role","button"),template.setAttribute("data-pilltype",data.type);const closeIcon=document.createElement("i");closeIcon.classList.add("fa","fa-times","pl-2"),closeIcon.setAttribute("data-id",data.id),closeIcon.setAttribute("aria-hidden","true"),template.appendChild(closeIcon),target[0].appendChild(template),(0,_jquery.default)("#clearPillsArea").show()},removePill=(id,pilltype)=>{const element=document.querySelector(`[data-id="${id}"]`);(0,_jquery.default)('#studentsActionsCollapse input[type="checkbox"]').each((i=>{(0,_jquery.default)('#studentsActionsCollapse input[type="checkbox"]')[i].id===id&&(void 0!==pilltype?((0,_jquery.default)('#studentsActionsCollapse input[type="checkbox"]')[i].checked=!0,(0,_jquery.default)('#studentsActionsCollapse input[type="checkbox"]').eq(i).trigger("click")):((0,_jquery.default)('#studentsActionsCollapse input[type="checkbox"]')[i].checked=!1,element.remove(),delete PILLS[id]),CONFIG.pills=PILLS)})),"helper_cells"===pilltype&&(element.remove(),delete PILLS[id],Object.keys(PILLS).length>0?(0,_jquery.default)("#clearPillsArea").show():(0,_jquery.default)("#clearPillsArea").hide(),showLoadingIcon(),CONFIG.pills=PILLS,CONFIG.participants.helper_cells=[])};_exports.showPills=confObj=>{const pillsObj=confObj.pills;if(pillsObj&&Object.keys(pillsObj).length>0){PILLS=confObj.pills;let pillsId=[];for(const pill in pillsObj){const pillData=pillsObj[pill].pilldata;pillsId.push(pillData.id),addPill(pillData,(0,_jquery.default)("#pillsAreaInner"))}Object.keys(PILLS).length>0?(0,_jquery.default)("#clearPillsArea").show():(0,_jquery.default)("#clearPillsArea").hide(),pillsId.forEach((id=>{document.querySelectorAll('#studentsActionsCollapse input[type="checkbox"]').forEach((el=>{el.id===id&&(el.setAttribute("checked",!0),el.checked=!0)}))})),(0,_jquery.default)("#studentsActionsCollapse").collapse("show")}},(0,_jquery.default)(document).on("change",'#studentsActionsCollapse input[type="checkbox"]',(function(e){const data={text:e.target.dataset.label,id:e.target.id,type:e.target.dataset.type};PILLS[data.id]?removePill(data.id):(PILLS[data.id]={},PILLS[data.id].type=data.type,PILLS[data.id].text=data.text,PILLS[data.id].pilldata={text:e.target.dataset.label,id:e.target.id,type:e.target.dataset.type},addPill(data,(0,_jquery.default)("#pillsAreaInner"))),Object.keys(PILLS).length>0?(0,_jquery.default)("#clearPillsArea").show():(0,_jquery.default)("#clearPillsArea").hide(),CONFIG.pills=PILLS})),(0,_jquery.default)(document).on("click","#pillsAreaInner",(function(e){(target=>{if(target.classList.contains("pill")||target.closest(".pill.badge")){let id=target.dataset.id||target.closest(".pill.badge").dataset.id,pilltype=target.dataset.pilltype||target.closest(".pill.badge").dataset.pilltype;removePill(id,pilltype)}})(e.target)})),(0,_jquery.default)(document).on("click","#clearPillsArea",(function(e){(e=>{e.preventDefault();for(const key in PILLS)delete PILLS[key];(0,_jquery.default)('#studentsActionsCollapse input[type="checkbox"]').each((i=>{(0,_jquery.default)('#studentsActionsCollapse input[type="checkbox"]')[i].checked=!1})),(0,_jquery.default)("#pillsAreaInner").empty(),(0,_jquery.default)("#clearPillsArea").hide();let oldConfig=CONFIG,currentConfig={states:oldConfig.participants.states,full_view:oldConfig.participants.full_view,show_score:oldConfig.participants.show_score};_exports.CONFIG=CONFIG={participants:new Proxy(currentConfig,{set:(target,key,value)=>(target[key]=value,regenerateTable(),!0)}),anonymous_mode:oldConfig.anonymous_mode},CONFIG.pills=PILLS,showLoadingIcon(),regenerateTable()})(e)}));_exports.init=function(){createAnonymousStripe(),(0,_jquery.default)(document).on("click","#studentstableNavFilter .nav-link",(function(e){let name=(0,_jquery.default)(e.currentTarget).data("name");CONFIG.participants.states=[name],showLoadingIcon()})),(0,_jquery.default)(document).on("change",'#studentsActionsCollapse .custom-control-input[data-type="score_ranges"]',(function(e){let target=(0,_jquery.default)(e.currentTarget).closest(".col"),score_ranges=[],checkboxes=target.find("input:checked");checkboxes.each((i=>score_ranges.push(checkboxes[i].value))),CONFIG.participants.score_ranges=score_ranges,showLoadingIcon()})),(0,_jquery.default)(document).on("change",'#studentsActionsCollapse .custom-control-input[data-type="attempts_range"]',(function(e){let target=(0,_jquery.default)(e.currentTarget).closest(".col"),attempts_range=[],checkboxes=target.find("input:checked");checkboxes.each((i=>attempts_range.push(checkboxes[i].value))),CONFIG.participants.attempts_range=attempts_range,showLoadingIcon()})),setTimeout((function(){(0,_jquery.default)(document).on("click",'#questions-table [data-action="helper-cells"]',(function(e){let oldConfig=CONFIG,currentConfig={states:oldConfig.participants.states,full_view:oldConfig.participants.full_view,show_score:oldConfig.participants.show_score};_exports.CONFIG=CONFIG={participants:new Proxy(currentConfig,{set:(target,key,value)=>(target[key]=value,regenerateTable(),!0)}),anonymous_mode:oldConfig.anonymous_mode};for(const key in PILLS)delete PILLS[key];CONFIG.pills=PILLS;let type=(0,_jquery.default)(e.currentTarget).data("type"),questionid=(0,_jquery.default)(e.currentTarget).data("questionid"),title=(0,_jquery.default)(e.currentTarget).data("title"),helper_cells=[];helper_cells.push({type:type,questionid:questionid}),CONFIG.participants.helper_cells=helper_cells,showLoadingIcon(),(0,_jquery.default)('#studentsActionsCollapse input[type="checkbox"]').each((i=>{(0,_jquery.default)('#studentsActionsCollapse input[type="checkbox"]')[i].checked=!1})),(0,_jquery.default)("#pillsAreaInner").empty(),(0,_jquery.default)("#clearPillsArea").hide();const data={text:title,id:"helper_cells_1",type:"helper_cells"};PILLS[data.id]?removePill(data.id):(PILLS[data.id]={},PILLS[data.id].type=data.type,PILLS[data.id].text=data.text,PILLS[data.id].pilldata={text:data.text,id:data.id,type:data.type},addPill(data,(0,_jquery.default)("#pillsAreaInner"))),Object.keys(PILLS).length>0?(0,_jquery.default)("#clearPillsArea").show():(0,_jquery.default)("#clearPillsArea").hide(),setTimeout((function(){document.getElementById("pillsArea").scrollIntoView()}),500)}))}),3e3),(0,_jquery.default)(document).on("keyup","#searchinput",(function(){let searchValue=(0,_jquery.default)(this).val().trim();(searchValue.length>=1||""===searchValue)&&(CONFIG.participants.search=searchValue,showLoadingIcon())})),(0,_jquery.default)(document).on("change","#anonymousmodeToggler1, #anonymousmodeToggler2, #anonymousmodeToggler3",(function(){const state=(0,_jquery.default)(this).prop("checked");(0,_jquery.default)("#anonymousmodeToggler1, #anonymousmodeToggler2, #anonymousmodeToggler3").prop("checked",state),CONFIG.anonymous_mode=state?1:0,showLoadingIcon(),regenerateTable(),setStatesFromConfig(),localStorage.setItem("anonymousState",state?"1":"0")})),window.addEventListener("storage",(event=>{if("anonymousState"===event.key){const isAnonymous="1"===event.newValue;updateUIForAnonymousState(isAnonymous)}}));const updateUIForAnonymousState=isAnonymous=>{if((0,_jquery.default)("#anonymousmodeToggler1, #anonymousmodeToggler2, #anonymousmodeToggler3").prop("checked",isAnonymous),CONFIG.anonymous_mode=isAnonymous?1:0,showLoadingIcon(),regenerateTable(),document.getElementById("anonymousStripe")||createAnonymousStripe(),1==isAnonymous){(0,_jquery.default)("#anonymousStripe").removeClass("hidden"),(0,_jquery.default)("#anonymousStripe").attr("style","top:"+(0,_jquery.default)("nav.navbar-petel").outerHeight()+"px");let stateText=(0,_jquery.default)("#anonymousmodeToggler1").closest(".advancedoverview_report-toggle").data("texton");(0,_jquery.default)(".advancedoverview_report-toggle.anonymousmode").each((function(index){(0,_jquery.default)(".advancedoverview_report-toggle.anonymousmode").eq(index).find(".link-btn-text").html(stateText)})),(0,_jquery.default)("#anonymousmodeToggler1, #anonymousmodeToggler2, #anonymousmodeToggler3").prop("checked",!0)}else{(0,_jquery.default)("#anonymousStripe").addClass("hidden");let stateText=(0,_jquery.default)("#anonymousmodeToggler1").closest(".advancedoverview_report-toggle").data("textoff");(0,_jquery.default)(".advancedoverview_report-toggle.anonymousmode").each((function(index){(0,_jquery.default)(".advancedoverview_report-toggle.anonymousmode").eq(index).find(".link-btn-text").html(stateText)})),(0,_jquery.default)("#anonymousmodeToggler1, #anonymousmodeToggler2, #anonymousmodeToggler3").prop("checked",!1)}};setStatesFromConfig()}}));

//# sourceMappingURL=studentsTableActions.min.js.map