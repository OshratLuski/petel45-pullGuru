{"version":3,"file":"preview.min.js","sources":["../src/preview.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * Javascript for lazy load of statuses.\r\n *\r\n * @package\r\n * @copyright  2020 Devlion <info@devlion.co>\r\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\n\r\ndefine(\r\n    [\r\n        'jquery',\r\n        'core/ajax',\r\n        'quiz_assessmentdiscussion/inview',\r\n        'core/notification'\r\n    ],\r\n    function($, Ajax, inView, Notification) {\r\n        var courseid = null;\r\n\r\n        let getPreview = function(attempts) {\r\n\r\n            if (attempts.length > 0) {\r\n\r\n                Ajax.call([{\r\n                    methodname: 'quiz_assessmentdiscussion_preview',\r\n                    args: {\r\n                        attempts: JSON.stringify(attempts),\r\n                    },\r\n                    done: function(resp) {\r\n                        let response = JSON.parse(resp.data);\r\n                        response.forEach(function(item) {\r\n                            $('#preview_answer_block_' + item.attemptid).html(item.html);\r\n                            $('#preview_overlay_block_' + item.attemptid).html(item.html);\r\n                        });\r\n                    },\r\n                    fail: Notification.exception\r\n                }]);\r\n            }\r\n\r\n        };\r\n        let inview = function() {\r\n            let attempts = [];\r\n            inView('.inview_preview')\r\n                .on('enter', function(e) {\r\n\r\n                    if (!$(e).hasClass('inview-done')) {\r\n\r\n                        let tmp = {\r\n                            'attemptid': $(e).attr(\"data-attemptid\"),\r\n                            'qid': $(e).attr(\"data-qid\"),\r\n                            'cmid': $(e).attr(\"data-cmid\"),\r\n                            'slot': $(e).attr(\"data-slot\"),\r\n                        };\r\n\r\n                        attempts.push(tmp);\r\n\r\n                        $(e).addClass('inview-done');\r\n\r\n                        let spinner = '<div class=\"spinner-border\" style=\"display: block; margin-left: auto; margin-right: auto;\" role=\"status\">' +\r\n                            '<span class=\"sr-only\"></span></div>';\r\n                        $(e).html(spinner);\r\n\r\n                    }\r\n                });\r\n\r\n            setInterval(function() {\r\n                if (attempts.length > 0) {\r\n                    getPreview(attempts);\r\n                    attempts = [];\r\n                }\r\n            }, 500);\r\n\r\n        };\r\n        return {\r\n            inview: inview,\r\n        };\r\n    });\r\n"],"names":["define","$","Ajax","inView","Notification","inview","attempts","on","e","hasClass","tmp","attr","push","addClass","spinner","html","setInterval","length","call","methodname","args","JSON","stringify","done","resp","parse","data","forEach","item","attemptid","fail","exception","getPreview"],"mappings":";;;;;;;AAuBAA,2CACI,CACI,SACA,YACA,mCACA,sBAEJ,SAASC,EAAGC,KAAMC,OAAQC,oBAyDf,CACHC,OAlCS,eACLC,SAAW,GACfH,OAAO,mBACFI,GAAG,SAAS,SAASC,OAEbP,EAAEO,GAAGC,SAAS,eAAgB,KAE3BC,IAAM,WACOT,EAAEO,GAAGG,KAAK,sBAChBV,EAAEO,GAAGG,KAAK,iBACTV,EAAEO,GAAGG,KAAK,kBACVV,EAAEO,GAAGG,KAAK,cAGtBL,SAASM,KAAKF,KAEdT,EAAEO,GAAGK,SAAS,mBAEVC,QAAU,+IAEdb,EAAEO,GAAGO,KAAKD,aAKtBE,aAAY,WACJV,SAASW,OAAS,KA/Cb,SAASX,UAElBA,SAASW,OAAS,GAElBf,KAAKgB,KAAK,CAAC,CACPC,WAAY,oCACZC,KAAM,CACFd,SAAUe,KAAKC,UAAUhB,WAE7BiB,KAAM,SAASC,MACIH,KAAKI,MAAMD,KAAKE,MACtBC,SAAQ,SAASC,MACtB3B,EAAE,yBAA2B2B,KAAKC,WAAWd,KAAKa,KAAKb,MACvDd,EAAE,0BAA4B2B,KAAKC,WAAWd,KAAKa,KAAKb,UAGhEe,KAAM1B,aAAa2B,aAgCnBC,CAAW1B,UACXA,SAAW,MAEhB"}