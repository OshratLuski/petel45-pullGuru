{"version":3,"file":"overlay.min.js","sources":["../src/overlay.js"],"sourcesContent":["/* eslint-disable no-console */\r\n/* eslint-disable no-unused-vars */\r\ndefine([\r\n    'jquery',\r\n    'core/ajax',\r\n    'core/notification',\r\n    'core/modal_factory',\r\n    'core/modal_events',\r\n    'core/str',\r\n    'quiz_assessmentdiscussion/preset',\r\n    'quiz_assessmentdiscussion/render',\r\n    'quiz_assessmentdiscussion/loading',\r\n],\r\n    function ($, Ajax, Notification, ModalFactory, ModalEvents, Str, Preset, Render, Loading) {\r\n\r\n        const mainBlock = document.querySelector(`body`);\r\n\r\n        return {\r\n\r\n            'scriptsForPage': function () {\r\n\r\n                // Back button.\r\n                $('.answerOverlayBackBtn').on('click', (e) => {\r\n                    const anonymousState = $(e.target).closest('.answeroverlay')\r\n                        .find('.assessmentdiscussion_report-toggle input')[0].checked;\r\n                    $('.answeroverlay').remove();\r\n\r\n                    $('#anonymousmodeToggler')[0].checked = anonymousState;\r\n\r\n                    Loading.show();\r\n                    Render.attempts_area(function (data) {\r\n                        Loading.remove();\r\n                    });\r\n                });\r\n            },\r\n\r\n            'init': function (def) {\r\n\r\n                // Set default preset.\r\n                def = JSON.parse(def);\r\n                Preset.setDefault(def);\r\n\r\n                mainBlock.addEventListener(`click`, function (event) {\r\n                    let target = event.target;\r\n                    while (target !== mainBlock) {\r\n\r\n                        if (target === null) {\r\n                            break;\r\n                        }\r\n                        // Handle overlay dashboard.\r\n                        if (target.dataset.handler === `open_overlay`) {\r\n                            Loading.show();\r\n\r\n                            Preset.set('overlay_qid', target.dataset.qid);\r\n\r\n                            // Set default.\r\n                            Preset.set('overlay_show_answers', def.overlay_show_answers);\r\n                            Preset.set('overlay_tab', def.overlay_tab);\r\n                            Preset.set('overlay_view_list', def.overlay_view_list);\r\n\r\n                            // Set anonymous mode.\r\n                            Preset.set('anonymous_mode', 1);\r\n\r\n                            Render.overlay_dashboard(function (data) {\r\n                                Loading.remove();\r\n                            });\r\n\r\n                            return;\r\n                        }\r\n\r\n                        // Handle overlay change question.\r\n                        if (target.dataset.handler === `overlay_change_question`) {\r\n                            Loading.show();\r\n\r\n                            Preset.set('overlay_qid', target.dataset.qid);\r\n\r\n                            // Set default.\r\n                            Preset.set('overlay_tab', def.overlay_tab);\r\n                            Preset.set('overlay_view_list', def.overlay_view_list);\r\n\r\n                            Render.overlay_dashboard(function (data) {\r\n                                Loading.remove();\r\n                            });\r\n\r\n                            return;\r\n                        }\r\n\r\n                        // Handle change anonymous on overlay.\r\n                        if (target.dataset.handler === `overlay_anonymous`) {\r\n\r\n                            let checked = 0;\r\n                            if ($(target).is(':checked')) {\r\n                                checked = 1;\r\n                            }\r\n\r\n                            if (!checked) {\r\n                                var reqStrings = [\r\n                                    {key: 'changedisplaymodemodaltitle', component: 'quiz_assessmentdiscussion'},\r\n                                    {key: 'changedisplaymodemodaltext', component: 'quiz_assessmentdiscussion'},\r\n                                    {key: 'ok', component: 'quiz_assessmentdiscussion'},\r\n                                ];\r\n\r\n                                var stringsPromise = Str.get_strings(reqStrings);\r\n                                var modalPromise = ModalFactory.create({ type: ModalFactory.types.SAVE_CANCEL });\r\n\r\n                                // eslint-disable-next-line no-loop-func\r\n                                $.when(stringsPromise, modalPromise).then(function (strings, modal) {\r\n                                    modal.setTitle(strings[0]);\r\n                                    modal.setBody(strings[1]);\r\n                                    modal.setSaveButtonText(strings[2]);\r\n                                    modal.getRoot().on(ModalEvents.shown, function () {\r\n                                        modal.getRoot()[0].setAttribute('style', 'z-index: 99999999;');\r\n                                    });\r\n                                    modal.getRoot().on(ModalEvents.save, function () {\r\n                                        Loading.show();\r\n\r\n                                        let checked = 0;\r\n                                        if ($(target).is(':checked')) {\r\n                                            checked = 1;\r\n                                        }\r\n                                        Preset.set('anonymous_mode', checked);\r\n\r\n                                        Render.overlay_dashboard(function (data) {\r\n                                            Loading.remove();\r\n                                        });\r\n                                    });\r\n                                    modal.show();\r\n                                    return modal;\r\n                                }).fail(Notification.exception);\r\n                            } else {\r\n                                Loading.show();\r\n\r\n                                let checked = 0;\r\n                                if ($(target).is(':checked')) {\r\n                                    checked = 1;\r\n                                }\r\n                                Preset.set('anonymous_mode', checked);\r\n\r\n                                Render.overlay_dashboard(function (data) {\r\n                                    Loading.remove();\r\n                                });\r\n                            }\r\n\r\n                        }\r\n\r\n                        // Handle overlay tab.\r\n                        if (target.dataset.handler === `overlay_tab`) {\r\n                            Loading.show();\r\n\r\n                            Preset.set('overlay_tab', target.dataset.id);\r\n\r\n                            Render.overlay_dashboard(function (data) {\r\n                                Loading.remove();\r\n                            });\r\n                            return;\r\n                        }\r\n\r\n                        // Handle overlay button list view.\r\n                        if (target.dataset.handler === `overlay_button_list_view`) {\r\n                            Loading.show();\r\n\r\n                            Preset.set('overlay_view_list', target.dataset.id);\r\n\r\n                            Render.overlay_dashboard(function (data) {\r\n                                Loading.remove();\r\n                            });\r\n                            return;\r\n                        }\r\n\r\n                        // Handle overlay button hide state.\r\n                        if (target.dataset.handler === `overlay_hide_state`) {\r\n\r\n                            $(target).toggleClass('active');\r\n                            $('.answeroverlay-content').toggleClass('blured');\r\n\r\n                            if ($(target).hasClass('active')) {\r\n                                Preset.set('overlay_show_answers', 1);\r\n                            } else {\r\n                                Preset.set('overlay_show_answers', 0);\r\n                            }\r\n                        }\r\n\r\n                        target = target.parentNode;\r\n                    }\r\n                });\r\n                return true;\r\n            }\r\n        };\r\n    });\r\n"],"names":["define","$","Ajax","Notification","ModalFactory","ModalEvents","Str","Preset","Render","Loading","mainBlock","document","querySelector","on","e","anonymousState","target","closest","find","checked","remove","show","attempts_area","data","def","JSON","parse","setDefault","addEventListener","event","dataset","handler","set","qid","overlay_show_answers","overlay_tab","overlay_view_list","overlay_dashboard","is","stringsPromise","get_strings","key","component","modalPromise","create","type","types","SAVE_CANCEL","when","then","strings","modal","setTitle","setBody","setSaveButtonText","getRoot","shown","setAttribute","save","fail","exception","id","toggleClass","hasClass","parentNode"],"mappings":"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"}