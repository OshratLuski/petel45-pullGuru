define("quiz_assessmentdiscussion/main",["jquery","core/ajax","core/notification","core/str","quiz_assessmentdiscussion/preset","quiz_assessmentdiscussion/render","quiz_assessmentdiscussion/loading"],(function($,Ajax,Notification,Str,Preset,Render,Loading){const mainBlock=document.querySelector("#region-main .block_assessmentdiscussion_report"),dashboardSort=document.querySelector("#region-main .block_assessmentdiscussion_report #questionSortingDropdown"),dashboardGroup=document.querySelector("#region-main .block_assessmentdiscussion_report #questionGroupDropdown"),answerSort=document.querySelector("#region-main .block_assessmentdiscussion_report #answersSortingDropdown"),changeQuestionListIcon=(qid,state)=>{$(".question-block-item").each((function(){let currentqid=$(this).data("qid");Number(currentqid)===Number(qid)&&(!0===state?$(this).find(".question-block-title-icon").removeClass("d-none"):$(this).find(".question-block-title-icon").addClass("d-none"))}))},changeQuestionInfoIcon=(qid,state)=>{let obj=$(".question-head").find(".discussion-state-btn");obj.data("qid");!0===state?obj.addClass("active"):obj.removeClass("active")},createBootstrapAlert=(message,dismissText)=>{const alert=document.createElement("div");alert.className="grade-area-block-alert alert alert-warning alert-block fade in show d-flex alert-dismissible border-0 position-absolute",alert.setAttribute("role","alert"),alert.setAttribute("data-aria-autofocus","true"),alert.innerHTML=`\n                <div class="alert-color-stripe bg-orange"></div>\n                <div class="alert-inner d-flex align-items-center p-2">\n                    <i class="alert-icon text-body fa-light fa-triangle-exclamation"></i>\n                    <div class="alert-text text-body p-1">\n                        ${message}\n                    </div>\n                    <button type="button" class="close" data-dismiss="alert">\n                        <i class="fa-light fa-circle-xmark text-body"></i>\n                        <span class="sr-only">${dismissText}</span>\n                    </button>\n                </div>\n            `,$(".grade-area-block").after(alert)},changeUrl=()=>{let preset=Preset.get(),url="?id="+preset.cmid+"&mode=assessmentdiscussion&qid="+preset.qid;window.history.pushState("","",url)};return{init:function(def){return def=JSON.parse(def),Preset.setDefault(def),changeUrl(),Loading.show(),Render.answers_area(!0,(function(data){Loading.remove()})),mainBlock.addEventListener("click",(function(event){let target=event.target;for(;target!==mainBlock;){if("dashboard_tab"===target.dataset.handler)return Loading.show(),Preset.set("dashboard_tab",target.dataset.id),void Render.dashboard((function(data){Preset.set("qid",data.activeqid),changeUrl(),Render.answers_area(!0,(function(data){Loading.remove()}))}));if("dashboard_group"===target.dataset.handler){let value=target.dataset.value,name=target.dataset.name;return $(dashboardGroup).data("value",value),$(dashboardGroup).data("name",name),$("#questionGroupDropdown").find("span").html(name),$(dashboardGroup).addClass("selected"),Loading.show(),Preset.set("groupid",value),void Render.dashboard((function(data){Preset.set("qid",data.activeqid),changeUrl(),Render.answers_area(!0,(function(data){Loading.remove()}))}))}if("dashboard_sort"===target.dataset.handler){let value=target.dataset.value,name=target.dataset.name;return $(dashboardSort).data("value",value),$(dashboardSort).data("name",name),$("#questionSortingDropdown").find("span").html(name),$(dashboardSort).addClass("selected"),Loading.show(),Preset.set("sort_question",value),void Render.aside_questions((function(data){Preset.set("qid",data.activeqid),changeUrl(),Render.answers_area(!0,(function(data){Loading.remove()}))}))}if("dashboard_anonymous"===target.dataset.handler){Loading.show();let checked=0;$(target).is(":checked")&&(checked=1),Preset.set("anonymous_mode",checked),Render.attempts_area((function(data){Loading.remove()}))}if("dashboard_change_grades"===target.dataset.handler){let targetgrades=target;Str.get_strings([{key:"buttonenablegrades",component:"quiz_assessmentdiscussion"},{key:"buttondisablegrades",component:"quiz_assessmentdiscussion"}]).done((function(strings){Loading.show();let state=targetgrades.dataset.action;"enable"===targetgrades.dataset.action?(targetgrades.dataset.action="disable",$(targetgrades).html(strings[1]),$(targetgrades).removeClass("btn-primary").addClass("btn-secondary")):(targetgrades.dataset.action="enable",$(targetgrades).html(strings[0]),$(targetgrades).removeClass("btn-secondary").addClass("btn-primary"));let preset=Preset.get();Ajax.call([{methodname:"quiz_assessmentdiscussion_change_grades",args:{cmid:preset.cmid,state:state},done:function(response){JSON.parse(response.data);Loading.remove()},fail:function(response){Loading.remove(),Notification.exception(response)}}])}))}if("select_question"===target.dataset.handler)return Loading.show(),$(".question-block-wrapper .question-block-item").each((function(){$(this).removeClass("active"),$(this).attr("data-handler","select_question")})),$(target).addClass("active"),$(target).attr("data-handler","disable"),Preset.set("qid",target.dataset.qid),changeUrl(),void Render.answers_area(!0,(function(data){Loading.remove()}));if("answers_tab"===target.dataset.handler){Loading.show();let preset=Preset.get();return Preset.set("sort_answers",preset.sort_answers_default),Preset.set("answers_tab",target.dataset.id),void Render.attempts_area((function(data){Loading.remove()}))}if("answers_sort"===target.dataset.handler){let value=target.dataset.value,name=target.dataset.name;return $(answerSort).data("value",value),$(answerSort).data("name",name),$("#answersSortingDropdown").find("span").html(name),$(answerSort).addClass("selected"),Loading.show(),Preset.set("sort_answers",value),void Render.attempts_area((function(data){Loading.remove()}))}if("change_question_discussion"===target.dataset.handler){Loading.show(),$(target).hasClass("active")?$(target).removeClass("active"):$(target).addClass("active");let preset=Preset.get();return void Ajax.call([{methodname:"quiz_assessmentdiscussion_change_discussion",args:{cmid:preset.cmid,groupid:preset.groupid,qid:target.dataset.qid},done:function(response){let res=JSON.parse(response.data);preset.dashboard_tab_discussion_value===preset.dashboard_tab?Render.dashboard((function(data){Preset.set("qid",data.activeqid),changeUrl(),Render.answers_area(!0,(function(data){Loading.remove()}))})):Render.dashboard_tabs((function(data){Render.answers_tabs((function(data){changeQuestionListIcon(target.dataset.qid,res.question_enable),!1===res.question_enable&&($(document.querySelectorAll('[data-handler="change_answer_discussion"]')).each((function(index,item){$(item).removeClass("active")})),$(document.querySelectorAll('[data-handler="change_attempt_discussion"]')).each((function(index,item){$(item).removeClass("active")}))),Loading.remove()}))}))},fail:function(response){Loading.remove(),Notification.exception(response)}}])}if("change_answer_discussion"===target.dataset.handler){Loading.show();let preset=Preset.get(),button=$(target);Ajax.call([{methodname:"quiz_assessmentdiscussion_change_discussion",args:{cmid:preset.cmid,groupid:preset.groupid,qid:preset.qid,userid:target.dataset.userid},done:function(response){let res=JSON.parse(response.data);preset.answer_tab_discussion_value===preset.answers_tab?Render.dashboard_tabs((function(data){Render.answers_tabs((function(data){Render.answers_area(!1,(function(data){changeQuestionListIcon(preset.qid,res.question_enable),changeQuestionInfoIcon(preset.qid,res.question_enable),Loading.remove()}))}))})):Render.dashboard_tabs((function(data){Render.answers_tabs((function(data){if(changeQuestionListIcon(preset.qid,res.question_enable),changeQuestionInfoIcon(preset.qid,res.question_enable),!1===res.answer_enable){let objs=button.parent().parent().find('[data-handler="change_attempt_discussion"]');$(objs).each((function(index,item){$(item).removeClass("active")}))}button.hasClass("active")?button.removeClass("active"):button.addClass("active"),Loading.remove()}))}))},fail:function(response){Loading.remove(),Notification.exception(response)}}])}if("change_attempt_discussion"===target.dataset.handler){Loading.show();let preset=Preset.get(),button=$(target);Ajax.call([{methodname:"quiz_assessmentdiscussion_change_discussion",args:{cmid:preset.cmid,groupid:preset.groupid,qid:preset.qid,userid:target.dataset.userid,attemptid:target.dataset.attemptid},done:function(response){let res=JSON.parse(response.data);preset.answer_tab_discussion_value===preset.answers_tab?Render.dashboard_tabs((function(data){Render.answers_tabs((function(data){Render.answers_area(!1,(function(data){changeQuestionListIcon(preset.qid,res.question_enable),changeQuestionInfoIcon(preset.qid,res.question_enable),Loading.remove()}))}))})):Render.dashboard_tabs((function(data){Render.answers_tabs((function(data){changeQuestionListIcon(preset.qid,res.question_enable),changeQuestionInfoIcon(preset.qid,res.question_enable),button.hasClass("active")?button.removeClass("active"):button.addClass("active");let answerbutton=button.parent().parent().parent().find(".discussion-state-btn");answerbutton.removeClass("active"),!0===res.question_enable&&answerbutton.addClass("active"),Loading.remove()}))}))},fail:function(response){Loading.remove(),Notification.exception(response)}}])}if("submit_grade"===target.dataset.handler){let form=$(target).parent().parent(),formdata=form.serializeArray(),tmp=(form.find(".alert"),{});$(formdata).each((function(index,item){tmp[item.name]=item.value})),tmp.comment=window.tinyMCE.get(tmp.uniqueid).getContent(),delete tmp.uniqueid;let grade=tmp.grade.trim();if(0===grade.length||grade>tmp.maxmark||grade<0){const reqStrings=[{key:"notpossibletoenterascore",component:"quiz_assessmentdiscussion"},{key:"dismissnotification",component:"core"}],stringsPromise=Str.get_strings(reqStrings);return void $.when(stringsPromise).then((function(strings){return createBootstrapAlert(strings[0],strings[1]),setTimeout((()=>{$(".grade-area-block .alert-warning").alert("close")}),1e3)})).fail(Notification.exception)}Loading.show();let data=[];data.push(tmp);let preset=Preset.get();Ajax.call([{methodname:"quiz_assessmentdiscussion_save_grades",args:{cmid:preset.cmid,qid:preset.qid,grades:data},done:function(response){Render.dashboard_tabs((function(data){Render.answers_tabs((function(data){Render.attempts_area((function(data){Loading.remove()}))}))}))},fail:function(response){Loading.remove(),Notification.exception(response)}}])}if("submit_all_grades"===target.dataset.handler){let data=[];$(".grade-area-block").each((function(index,item){let formdata=$(this).serializeArray(),tmp={};$(formdata).each((function(index,item){tmp[item.name]=item.value})),tmp.comment=window.tinyMCE.get(tmp.uniqueid).getContent(),delete tmp.uniqueid,data.push(tmp)})),Loading.show();let preset=Preset.get();Ajax.call([{methodname:"quiz_assessmentdiscussion_save_grades",args:{cmid:preset.cmid,qid:preset.qid,grades:data},done:function(response){Render.dashboard_tabs((function(data){Render.answers_tabs((function(data){Render.attempts_area((function(data){Loading.remove()}))}))}))},fail:function(response){Loading.remove(),Notification.exception(response)}}])}target=target.parentNode}})),!0},createAlert:function(){const stringsPromise=Str.get_strings([{key:"notpossibletoenterascore",component:"quiz_assessmentdiscussion"},{key:"dismissnotification",component:"core"}]);$.when(stringsPromise).then((function(strings){return createBootstrapAlert(strings[0],strings[1]),setTimeout((()=>{$(".grade-area-block-alert").remove()}),8e3)})).fail(Notification.exception)}}}));

//# sourceMappingURL=main.min.js.map