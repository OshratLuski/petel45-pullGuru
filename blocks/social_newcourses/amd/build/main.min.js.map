{"version":3,"file":"main.min.js","sources":["../src/main.js"],"sourcesContent":["/**\n * Javascript to initialise the myoverview block.\n *\n * @package    block_social_newcourses\n * @copyright  2018 Bas Brands <bas@moodle.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine([\n        'jquery',\n        'core/ajax',\n        'core/notification',\n        'local_petel/inview'\n    ],\n    function ($, Ajax, Notification, inView) {\n        `use strict`;\n\n        var selector = {\n            wrapper: '#block-social_newcourses-selectSort',\n            mainBlock: '.block-social_newcourses-content-courses',\n            selectItems: '#block-social_newcourses-selectSort .dropdown-item',\n            spinner: '#block-social_newcourses-selectSort .spinner-border',\n            button: '.social_newcourses-btn',\n            page: '#block-social_newcourses-page',\n        };\n\n        const toggleSpinner = (status) => {\n            var spinner = $(selector.spinner);\n            var borderColor = status ? '' : 'transparent';\n            spinner.css('border-color', borderColor);\n        };\n\n        const renderBlock = (perpage) => {\n\n            $(selector.page).val(perpage);\n            toggleSpinner(true);\n\n            Ajax.call([{\n                methodname: 'block_social_newcourses_render_courses_block',\n                args: {\n                    perpage: perpage\n                },\n                done: function (response) {\n                    toggleSpinner(false);\n                    if (response.status) {\n                        $(selector.mainBlock).html(response.content);\n                        $(selector.button).on('click', btnClassClick);\n                    }\n                },\n                fail: Notification.exception\n            }]);\n        };\n\n        const btnClassClick = (event) => {\n\n            // handle public course and send single course\n            if (event.target.dataset.handler === `send_followed_single_course`) {\n                var ids = [];\n                let courseid = event.target.dataset.courseid;\n                ids.push(courseid);\n\n                var page_userid = event.target.dataset.page_userid;\n                var current_userid = event.target.dataset.current_userid;\n\n                toggleSpinner(true);\n                send_followed_courses(page_userid, current_userid, ids, function () {\n                    var page = $(selector.page).val();\n                    renderBlock(page);\n                    toggleSpinner(false);\n                });\n\n                return;\n            }\n        };\n\n        const send_followed_courses = (page_userid, current_userid, ids, callback) => {\n            Ajax.call([{\n                methodname: 'community_social_send_followed_courses',\n                args: {\n                    page_userid: Number(page_userid),\n                    current_userid: Number(current_userid),\n                    ids: JSON.stringify(ids)\n                },\n                done: function () {\n                    callback();\n                },\n                fail: Notification.exception\n            }]);\n        };\n\n        return {\n\n            init: function () {\n\n                var root = $(selector.wrapper);\n\n                // First run.\n                inView('.block-social-newcourses-inview')\n                    .on('enter', function (e){\n                        if(!$(e).hasClass('inview-done')){\n                            $(e).addClass('inview-done');\n\n                            var perpage = $('#block-social_newcourses-selectSort .dropdown-menu .active').data('value');\n                            renderBlock(perpage);\n                        }\n                    })\n                    .on('exit', el => {\n                    });\n\n                root.on('click', function (e) {\n                    var target = $(e.target);\n                    while ($.contains(root[0], target[0])) {\n                        if (target.data('handler') === 'setPerpage') {\n\n                            $(selector.selectItems).removeClass('active');\n                            $(target).addClass('active');\n\n                            renderBlock(target.data('value'));\n                            return;\n                        }\n\n                        target = target.parent();\n                    }\n                });\n\n                $(selector.button).on('click', btnClassClick);\n            }\n        };\n    });\n"],"names":["define","$","Ajax","Notification","inView","selector","toggleSpinner","status","borderColor","css","renderBlock","perpage","val","call","methodname","args","done","response","html","content","on","btnClassClick","fail","exception","event","target","dataset","handler","ids","courseid","push","page_userid","current_userid","send_followed_courses","page","callback","Number","JSON","stringify","init","root","e","hasClass","addClass","data","el","contains","removeClass","parent"],"mappings":";;;;;;;AAQAA,sCAAO,CACC,SACA,YACA,oBACA,uBAEJ,SAAUC,EAAGC,KAAMC,aAAcC,YAGzBC,iBACS,sCADTA,mBAEW,2CAFXA,qBAGa,qDAHbA,iBAIS,sDAJTA,gBAKQ,yBALRA,cAMM,gCAGJC,cAAgB,SAACC,YAEfC,YAAcD,OAAS,GAAK,cADlBN,EAAEI,kBAERI,IAAI,eAAgBD,cAG1BE,YAAc,SAACC,SAEjBV,EAAEI,eAAeO,IAAID,SACrBL,eAAc,GAEdJ,KAAKW,KAAK,CAAC,CACPC,WAAY,+CACZC,KAAM,CACFJ,QAASA,SAEbK,KAAM,SAAUC,UACZX,eAAc,GACVW,SAASV,SACTN,EAAEI,oBAAoBa,KAAKD,SAASE,SACpClB,EAAEI,iBAAiBe,GAAG,QAASC,iBAGvCC,KAAMnB,aAAaoB,cAIrBF,cAAgB,SAACG,0CAGfA,MAAMC,OAAOC,QAAQC,QAA2C,KAC5DC,IAAM,GACNC,SAAWL,MAAMC,OAAOC,QAAQG,SACpCD,IAAIE,KAAKD,cAELE,YAAcP,MAAMC,OAAOC,QAAQK,YACnCC,eAAiBR,MAAMC,OAAOC,QAAQM,sBAE1C1B,eAAc,QACd2B,sBAAsBF,YAAaC,eAAgBJ,KAAK,eAChDM,KAAOjC,EAAEI,eAAeO,MAC5BF,YAAYwB,MACZ5B,eAAc,QAOpB2B,sBAAwB,SAACF,YAAaC,eAAgBJ,IAAKO,UAC7DjC,KAAKW,KAAK,CAAC,CACPC,WAAY,yCACZC,KAAM,CACFgB,YAAaK,OAAOL,aACpBC,eAAgBI,OAAOJ,gBACvBJ,IAAKS,KAAKC,UAAUV,MAExBZ,KAAM,WACFmB,YAEJb,KAAMnB,aAAaoB,oBAIpB,CAEHgB,KAAM,eAEEC,KAAOvC,EAAEI,kBAGbD,OAAO,mCACFgB,GAAG,SAAS,SAAUqB,OACfxC,EAAEwC,GAAGC,SAAS,eAAe,CAC7BzC,EAAEwC,GAAGE,SAAS,mBAEVhC,QAAUV,EAAE,8DAA8D2C,KAAK,SACnFlC,YAAYC,aAGnBS,GAAG,QAAQ,SAAAyB,QAGhBL,KAAKpB,GAAG,SAAS,SAAUqB,WACnBhB,OAASxB,EAAEwC,EAAEhB,QACVxB,EAAE6C,SAASN,KAAK,GAAIf,OAAO,KAAK,IACJ,eAA3BA,OAAOmB,KAAK,kBAEZ3C,EAAEI,sBAAsB0C,YAAY,UACpC9C,EAAEwB,QAAQkB,SAAS,eAEnBjC,YAAYe,OAAOmB,KAAK,UAI5BnB,OAASA,OAAOuB,aAIxB/C,EAAEI,iBAAiBe,GAAG,QAASC,gBAG1C"}