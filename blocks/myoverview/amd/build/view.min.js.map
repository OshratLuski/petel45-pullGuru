{"version":3,"file":"view.min.js","sources":["../src/view.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle. If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * Manage the courses view for the overview block.\r\n *\r\n * @copyright  2018 Bas Brands <bas@moodle.com>\r\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\n\r\nimport $ from 'jquery';\r\nimport * as Repository from 'block_myoverview/repository';\r\nimport * as PagedContentFactory from 'core/paged_content_factory';\r\nimport * as PubSub from 'core/pubsub';\r\nimport * as CustomEvents from 'core/custom_interaction_events';\r\nimport * as Notification from 'core/notification';\r\nimport * as Templates from 'core/templates';\r\nimport * as CourseEvents from 'core_course/events';\r\nimport * as ModalFactory from 'core/modal_factory';\r\nimport * as ModalEventForm from 'core_calendar/modal_event_form';\r\nimport * as Message from 'block_myoverview/message';\r\nimport SELECTORS from 'block_myoverview/selectors';\r\nimport * as PagedContentEvents from 'core/paged_content_events';\r\nimport * as Aria from 'core/aria';\r\nimport {debounce} from 'core/utils';\r\nimport {setUserPreference} from 'core_user/repository';\r\n\r\nconst TEMPLATES = {\r\n    COURSES_CARDS: 'block_myoverview/view-cards',\r\n    COURSES_LIST: 'block_myoverview/view-list',\r\n    COURSES_SUMMARY: 'block_myoverview/view-summary',\r\n    NOCOURSES: 'core_course/no-courses',\r\n    COURSES_PETEL: 'block_myoverview/view-petel'\r\n};\r\n\r\nconst GROUPINGS = {\r\n    GROUPING_ALLINCLUDINGHIDDEN: 'allincludinghidden',\r\n    GROUPING_ALL: 'all',\r\n    GROUPING_INPROGRESS: 'inprogress',\r\n    GROUPING_FUTURE: 'future',\r\n    GROUPING_PAST: 'past',\r\n    GROUPING_FAVOURITES: 'favourites',\r\n    GROUPING_HIDDEN: 'hidden'\r\n};\r\n\r\nconst NUMCOURSES_PERPAGE = [12, 24, 48, 96, 0];\r\n\r\nlet loadedPages = [];\r\n\r\nlet courseOffset = 0;\r\n\r\nlet lastPage = 0;\r\n\r\nlet lastLimit = 0;\r\n\r\nlet namespace = null;\r\n\r\n/**\r\n * Whether the summary display has been loaded.\r\n *\r\n * If true, this means that courses have been loaded with the summary text.\r\n * Otherwise, switching to the summary display mode will require course data to be fetched with the summary text.\r\n *\r\n * @type {boolean}\r\n */\r\nlet summaryDisplayLoaded = false;\r\n\r\n/**\r\n * Get filter values from DOM.\r\n *\r\n * @param {object} root The root element for the courses view.\r\n * @return {filters} Set filters.\r\n */\r\nconst getFilterValues = root => {\r\n    const courseRegion = root.find(SELECTORS.courseView.region);\r\n    return {\r\n        display: courseRegion.attr('data-display'),\r\n        grouping: courseRegion.attr('data-grouping'),\r\n        sort: courseRegion.attr('data-sort'),\r\n        displaycategories: courseRegion.attr('data-displaycategories'),\r\n        customfieldname: courseRegion.attr('data-customfieldname'),\r\n        customfieldvalue: courseRegion.attr('data-customfieldvalue'),\r\n    };\r\n};\r\n\r\n// We want the paged content controls below the paged content area.\r\n// and the controls should be ignored while data is loading.\r\nconst DEFAULT_PAGED_CONTENT_CONFIG = {\r\n    ignoreControlWhileLoading: true,\r\n    controlPlacementBottom: true,\r\n    persistentLimitKey: 'block_myoverview_user_paging_preference'\r\n};\r\n\r\n/**\r\n * Get enrolled courses from backend.\r\n *\r\n * @param {object} filters The filters for this view.\r\n * @param {int} limit The number of courses to show.\r\n * @return {promise} Resolved with an array of courses.\r\n */\r\nconst getMyCourses = (filters, limit) => {\r\n    const params = {\r\n        offset: courseOffset,\r\n        limit: limit,\r\n        classification: filters.grouping,\r\n        sort: filters.sort,\r\n        customfieldname: filters.customfieldname,\r\n        customfieldvalue: filters.customfieldvalue,\r\n    };\r\n    if (filters.display === 'summary') {\r\n        params.requiredfields = Repository.SUMMARY_REQUIRED_FIELDS;\r\n        summaryDisplayLoaded = true;\r\n    } else {\r\n        params.requiredfields = Repository.CARDLIST_REQUIRED_FIELDS;\r\n    }\r\n    return Repository.getEnrolledCoursesByTimeline(params);\r\n};\r\n\r\n/**\r\n * Search for enrolled courses from backend.\r\n *\r\n * @param {object} filters The filters for this view.\r\n * @param {int} limit The number of courses to show.\r\n * @param {string} searchValue What does the user want to search within their courses.\r\n * @return {promise} Resolved with an array of courses.\r\n */\r\nconst getSearchMyCourses = (filters, limit, searchValue) => {\r\n    const params = {\r\n        offset: courseOffset,\r\n        limit: limit,\r\n        classification: 'search',\r\n        sort: filters.sort,\r\n        customfieldname: filters.customfieldname,\r\n        customfieldvalue: filters.customfieldvalue,\r\n        searchvalue: searchValue,\r\n    };\r\n    if (filters.display === 'summary') {\r\n        params.requiredfields = Repository.SUMMARY_REQUIRED_FIELDS;\r\n        summaryDisplayLoaded = true;\r\n    } else {\r\n        params.requiredfields = Repository.CARDLIST_REQUIRED_FIELDS;\r\n        summaryDisplayLoaded = false;\r\n    }\r\n    return Repository.getEnrolledCoursesByTimeline(params);\r\n};\r\n\r\n/**\r\n * Get the container element for the favourite icon.\r\n *\r\n * @param {Object} root The course overview container\r\n * @param {Number} courseId Course id number\r\n * @return {Object} The favourite icon container\r\n */\r\nconst getFavouriteIconContainer = (root, courseId) => {\r\n    return root.find(SELECTORS.FAVOURITE_ICON + '[data-course-id=\"' + courseId + '\"]');\r\n};\r\n\r\n/**\r\n * Get the paged content container element.\r\n *\r\n * @param {Object} root The course overview container\r\n * @param {Number} index Rendered page index.\r\n * @return {Object} The rendered paged container.\r\n */\r\nconst getPagedContentContainer = (root, index) => {\r\n    return root.find('[data-region=\"paged-content-page\"][data-page=\"' + index + '\"]');\r\n};\r\n\r\n/**\r\n * Get the course id from a favourite element.\r\n *\r\n * @param {Object} root The favourite icon container element.\r\n * @return {Number} Course id.\r\n */\r\nconst getCourseId = root => {\r\n    return root.attr('data-course-id');\r\n};\r\n\r\n/**\r\n * Hide the favourite icon.\r\n *\r\n * @param {Object} root The favourite icon container element.\r\n * @param {Number} courseId Course id number.\r\n */\r\nconst hideFavouriteIcon = (root, courseId) => {\r\n    const iconContainer = getFavouriteIconContainer(root, courseId);\r\n\r\n    const isFavouriteIcon = iconContainer.find(SELECTORS.ICON_IS_FAVOURITE);\r\n    isFavouriteIcon.addClass('hidden');\r\n    Aria.hide(isFavouriteIcon);\r\n\r\n    const notFavourteIcon = iconContainer.find(SELECTORS.ICON_NOT_FAVOURITE);\r\n    notFavourteIcon.removeClass('hidden');\r\n    Aria.unhide(notFavourteIcon);\r\n};\r\n\r\n/**\r\n * Show the favourite icon.\r\n *\r\n * @param {Object} root The course overview container.\r\n * @param {Number} courseId Course id number.\r\n */\r\nconst showFavouriteIcon = (root, courseId) => {\r\n    const iconContainer = getFavouriteIconContainer(root, courseId);\r\n\r\n    const isFavouriteIcon = iconContainer.find(SELECTORS.ICON_IS_FAVOURITE);\r\n    isFavouriteIcon.removeClass('hidden');\r\n    Aria.unhide(isFavouriteIcon);\r\n\r\n    const notFavourteIcon = iconContainer.find(SELECTORS.ICON_NOT_FAVOURITE);\r\n    notFavourteIcon.addClass('hidden');\r\n    Aria.hide(notFavourteIcon);\r\n};\r\n\r\n/**\r\n * Get the action menu item\r\n *\r\n * @param {Object} root The course overview container\r\n * @param {Number} courseId Course id.\r\n * @return {Object} The add to favourite menu item.\r\n */\r\nconst getAddFavouriteMenuItem = (root, courseId) => {\r\n    return root.find('[data-action=\"add-favourite\"][data-course-id=\"' + courseId + '\"]');\r\n};\r\n\r\n/**\r\n * Get the action menu item\r\n *\r\n * @param {Object} root The course overview container\r\n * @param {Number} courseId Course id.\r\n * @return {Object} The remove from favourites menu item.\r\n */\r\nconst getRemoveFavouriteMenuItem = (root, courseId) => {\r\n    return root.find('[data-action=\"remove-favourite\"][data-course-id=\"' + courseId + '\"]');\r\n};\r\n\r\n/**\r\n * Add course to favourites\r\n *\r\n * @param {Object} root The course overview container\r\n * @param {Number} courseId Course id number\r\n */\r\nconst addToFavourites = (root, courseId) => {\r\n    const removeAction = getRemoveFavouriteMenuItem(root, courseId);\r\n    const addAction = getAddFavouriteMenuItem(root, courseId);\r\n\r\n    setCourseFavouriteState(courseId, true).then(success => {\r\n        if (success) {\r\n            PubSub.publish(CourseEvents.favourited, courseId);\r\n            removeAction.removeClass('hidden');\r\n            addAction.addClass('hidden');\r\n            showFavouriteIcon(root, courseId);\r\n        } else {\r\n            Notification.alert('Starring course failed', 'Could not change favourite state');\r\n        }\r\n        return;\r\n    }).catch(Notification.exception);\r\n};\r\n\r\n/**\r\n * Remove course from favourites\r\n *\r\n * @param {Object} root The course overview container\r\n * @param {Number} courseId Course id number\r\n */\r\nconst removeFromFavourites = (root, courseId) => {\r\n    const removeAction = getRemoveFavouriteMenuItem(root, courseId);\r\n    const addAction = getAddFavouriteMenuItem(root, courseId);\r\n\r\n    setCourseFavouriteState(courseId, false).then(success => {\r\n        if (success) {\r\n            PubSub.publish(CourseEvents.unfavorited, courseId);\r\n            removeAction.addClass('hidden');\r\n            addAction.removeClass('hidden');\r\n            hideFavouriteIcon(root, courseId);\r\n        } else {\r\n            Notification.alert('Starring course failed', 'Could not change favourite state');\r\n        }\r\n        return;\r\n    }).catch(Notification.exception);\r\n};\r\n\r\n/**\r\n * Get the action menu item\r\n *\r\n * @param {Object} root The course overview container\r\n * @param {Number} courseId Course id.\r\n * @return {Object} The hide course menu item.\r\n */\r\nconst getHideCourseMenuItem = (root, courseId) => {\r\n    return root.find('[data-action=\"hide-course\"][data-course-id=\"' + courseId + '\"]');\r\n};\r\n\r\n/**\r\n * Get the action menu item\r\n *\r\n * @param {Object} root The course overview container\r\n * @param {Number} courseId Course id.\r\n * @return {Object} The show course menu item.\r\n */\r\nconst getShowCourseMenuItem = (root, courseId) => {\r\n    return root.find('[data-action=\"show-course\"][data-course-id=\"' + courseId + '\"]');\r\n};\r\n\r\n/**\r\n * Hide course\r\n *\r\n * @param {Object} root The course overview container\r\n * @param {Number} courseId Course id number\r\n */\r\nconst hideCourse = (root, courseId) => {\r\n    const hideAction = getHideCourseMenuItem(root, courseId);\r\n    const showAction = getShowCourseMenuItem(root, courseId);\r\n    const filters = getFilterValues(root);\r\n\r\n    setCourseHiddenState(courseId, true);\r\n\r\n    // Remove the course from this view as it is now hidden and thus not covered by this view anymore.\r\n    // Do only if we are not in \"All (including archived)\" view mode where really all courses are shown.\r\n    if (filters.grouping !== GROUPINGS.GROUPING_ALLINCLUDINGHIDDEN) {\r\n        hideElement(root, courseId);\r\n    }\r\n\r\n    hideAction.addClass('hidden');\r\n    showAction.removeClass('hidden');\r\n};\r\n\r\n/**\r\n * Show course\r\n *\r\n * @param {Object} root The course overview container\r\n * @param {Number} courseId Course id number\r\n */\r\nconst showCourse = (root, courseId) => {\r\n    const hideAction = getHideCourseMenuItem(root, courseId);\r\n    const showAction = getShowCourseMenuItem(root, courseId);\r\n    const filters = getFilterValues(root);\r\n\r\n    setCourseHiddenState(courseId, null);\r\n\r\n    // Remove the course from this view as it is now shown again and thus not covered by this view anymore.\r\n    // Do only if we are not in \"All (including archived)\" view mode where really all courses are shown.\r\n    if (filters.grouping !== GROUPINGS.GROUPING_ALLINCLUDINGHIDDEN) {\r\n        hideElement(root, courseId);\r\n    }\r\n\r\n    hideAction.removeClass('hidden');\r\n    showAction.addClass('hidden');\r\n};\r\n\r\n/**\r\n * Set the courses hidden status and push to repository\r\n *\r\n * @param {Number} courseId Course id to favourite.\r\n * @param {Boolean} status new hidden status.\r\n * @return {Promise} Repository promise.\r\n */\r\nconst setCourseHiddenState = (courseId, status) => {\r\n\r\n    // If the given status is not hidden, the preference has to be deleted with a null value.\r\n    if (status === false) {\r\n        status = null;\r\n    }\r\n\r\n    return setUserPreference(`block_myoverview_hidden_course_${courseId}`, status)\r\n        .catch(Notification.exception);\r\n};\r\n\r\n/**\r\n * Reset the loadedPages dataset to take into account the hidden element\r\n *\r\n * @param {Object} root The course overview container\r\n * @param {Number} id The course id number\r\n */\r\nconst hideElement = (root, id) => {\r\n    const pagingBar = root.find('[data-region=\"paging-bar\"]');\r\n    const jumpto = parseInt(pagingBar.attr('data-active-page-number'));\r\n\r\n    // Get a reduced dataset for the current page.\r\n    const courseList = loadedPages[jumpto];\r\n    let reducedCourse = courseList.courses.reduce((accumulator, current) => {\r\n        if (+id !== +current.id) {\r\n            accumulator.push(current);\r\n        }\r\n        return accumulator;\r\n    }, []);\r\n\r\n    // Get the next page's data if loaded and pop the first element from it.\r\n    if (typeof (loadedPages[jumpto + 1]) !== 'undefined') {\r\n        const newElement = loadedPages[jumpto + 1].courses.slice(0, 1);\r\n\r\n        // Adjust the dataset for the reset of the pages that are loaded.\r\n        loadedPages.forEach((courseList, index) => {\r\n            if (index > jumpto) {\r\n                let popElement = [];\r\n                if (typeof (loadedPages[index + 1]) !== 'undefined') {\r\n                    popElement = loadedPages[index + 1].courses.slice(0, 1);\r\n                }\r\n                loadedPages[index].courses = [...loadedPages[index].courses.slice(1), ...popElement];\r\n            }\r\n        });\r\n\r\n        reducedCourse = [...reducedCourse, ...newElement];\r\n    }\r\n\r\n    // Check if the next page is the last page and if it still has data associated to it.\r\n    if (lastPage === jumpto + 1 && loadedPages[jumpto + 1].courses.length === 0) {\r\n        const pagedContentContainer = root.find('[data-region=\"paged-content-container\"]');\r\n        PagedContentFactory.resetLastPageNumber($(pagedContentContainer).attr('id'), jumpto);\r\n    }\r\n\r\n    loadedPages[jumpto].courses = reducedCourse;\r\n\r\n    // Reduce the course offset.\r\n    courseOffset--;\r\n\r\n    // Render the paged content for the current.\r\n    const pagedContentPage = getPagedContentContainer(root, jumpto);\r\n    renderCourses(root, loadedPages[jumpto]).then((html, js) => {\r\n        return Templates.replaceNodeContents(pagedContentPage, html, js);\r\n    }).catch(Notification.exception);\r\n\r\n    // Delete subsequent pages in order to trigger the callback.\r\n    loadedPages.forEach((courseList, index) => {\r\n        if (index > jumpto) {\r\n            const page = getPagedContentContainer(root, index);\r\n            page.remove();\r\n        }\r\n    });\r\n};\r\n\r\n/**\r\n * Set the courses favourite status and push to repository\r\n *\r\n * @param {Number} courseId Course id to favourite.\r\n * @param {boolean} status new favourite status.\r\n * @return {Promise} Repository promise.\r\n */\r\nconst setCourseFavouriteState = (courseId, status) => {\r\n\r\n    return Repository.setFavouriteCourses({\r\n        courses: [\r\n            {\r\n                'id': courseId,\r\n                'favourite': status\r\n            }\r\n        ]\r\n    }).then(result => {\r\n        if (result.warnings.length === 0) {\r\n            loadedPages.forEach(courseList => {\r\n                courseList.courses.forEach((course, index) => {\r\n                    if (course.id == courseId) {\r\n                        courseList.courses[index].isfavourite = status;\r\n                    }\r\n                });\r\n            });\r\n            return true;\r\n        } else {\r\n            return false;\r\n        }\r\n    }).catch(Notification.exception);\r\n};\r\n\r\n/**\r\n * Given there are no courses to render provide the rendered template.\r\n *\r\n * @param {object} root The root element for the courses view.\r\n * @return {promise} jQuery promise resolved after rendering is complete.\r\n */\r\nconst noCoursesRender = root => {\r\n    const nocoursesimg = root.find(SELECTORS.courseView.region).attr('data-nocoursesimg');\r\n    const newcourseurl = root.find(SELECTORS.courseView.region).attr('data-newcourseurl');\r\n    return Templates.render(TEMPLATES.NOCOURSES, {\r\n        nocoursesimg: nocoursesimg,\r\n        newcourseurl: newcourseurl\r\n    });\r\n};\r\n\r\n/**\r\n * Render the dashboard courses.\r\n *\r\n * @param {object} root The root element for the courses view.\r\n * @param {array} coursesData containing array of returned courses.\r\n * @return {promise} jQuery promise resolved after rendering is complete.\r\n */\r\nconst renderCourses = (root, coursesData) => {\r\n\r\n    const filters = getFilterValues(root);\r\n\r\n    let currentTemplate = '';\r\n    if (filters.display === 'card') {\r\n        currentTemplate = TEMPLATES.COURSES_CARDS;\r\n    } else if (filters.display === 'list') {\r\n        currentTemplate = TEMPLATES.COURSES_LIST;\r\n    } else if (filters.display === 'petel') {\r\n        currentTemplate = TEMPLATES.COURSES_PETEL;\r\n    } else {\r\n        currentTemplate = TEMPLATES.COURSES_SUMMARY;\r\n    }\r\n\r\n    if (!coursesData) {\r\n        return noCoursesRender(root);\r\n    } else {\r\n        // Sometimes we get weird objects coming after a failed search, cast to ensure typing functions.\r\n        if (Array.isArray(coursesData.courses) === false) {\r\n            coursesData.courses = Object.values(coursesData.courses);\r\n        }\r\n        // Whether the course category should be displayed in the course item.\r\n        coursesData.courses = coursesData.courses.map(course => {\r\n            course.showcoursecategory = filters.displaycategories === 'on';\r\n            return course;\r\n        });\r\n        if (coursesData.courses.length) {\r\n            return Templates.render(currentTemplate, {\r\n                courses: coursesData.courses,\r\n            });\r\n        } else {\r\n            return noCoursesRender(root);\r\n        }\r\n    }\r\n};\r\n\r\n/**\r\n * Return the callback to be passed to the subscribe event\r\n *\r\n * @param {object} root The root element for the courses view\r\n * @return {function} Partially applied function that'll execute when passed a limit\r\n */\r\nconst setLimit = root => {\r\n    // @param {Number} limit The paged limit that is passed through the event.\r\n    return limit => root.find(SELECTORS.courseView.region).attr('data-paging', limit);\r\n};\r\n\r\n/**\r\n * Intialise the paged list and cards views on page load.\r\n * Returns an array of paged contents that we would like to handle here\r\n *\r\n * @param {object} root The root element for the courses view\r\n * @param {string} namespace The namespace for all the events attached\r\n */\r\nconst registerPagedEventHandlers = (root, namespace) => {\r\n    const event = namespace + PagedContentEvents.SET_ITEMS_PER_PAGE_LIMIT;\r\n    PubSub.subscribe(event, setLimit(root));\r\n};\r\n\r\n/**\r\n * Figure out how many items are going to be allowed to be rendered in the block.\r\n *\r\n * @param  {Number} pagingLimit How many courses to display\r\n * @param  {Object} root The course overview container\r\n * @return {Number[]} How many courses will be rendered\r\n */\r\nconst itemsPerPageFunc = (pagingLimit, root) => {\r\n    let itemsPerPage = NUMCOURSES_PERPAGE.map(value => {\r\n        let active = false;\r\n        if (value === pagingLimit) {\r\n            active = true;\r\n        }\r\n\r\n        return {\r\n            value: value,\r\n            active: active\r\n        };\r\n    });\r\n\r\n    // Filter out all pagination options which are too large for the amount of courses user is enrolled in.\r\n    const totalCourseCount = parseInt(root.find(SELECTORS.courseView.region).attr('data-totalcoursecount'), 10);\r\n    return itemsPerPage.filter(pagingOption => {\r\n        if (pagingOption.value === 0 && totalCourseCount > 100) {\r\n            // To minimise performance issues, do not show the \"All\" option if the user is enrolled in more than 100 courses.\r\n            return false;\r\n        }\r\n        return pagingOption.value < totalCourseCount;\r\n    });\r\n};\r\n\r\n/**\r\n * Mutates and controls the loadedPages array and handles the bootstrapping.\r\n *\r\n * @param {Array|Object} coursesData Array of all of the courses to start building the page from\r\n * @param {Number} currentPage What page are we currently on?\r\n * @param {Object} pageData Any current page information\r\n * @param {Object} actions Paged content helper\r\n * @param {null|boolean} activeSearch Are we currently actively searching and building up search results?\r\n */\r\nconst pageBuilder = (coursesData, currentPage, pageData, actions, activeSearch = null) => {\r\n    // If the courseData comes in an object then get the value otherwise it is a pure array.\r\n    let courses = coursesData.courses ? coursesData.courses : coursesData;\r\n    let nextPageStart = 0;\r\n    let pageCourses = [];\r\n\r\n    // If current page's data is loaded make sure we max it to page limit.\r\n    if (typeof (loadedPages[currentPage]) !== 'undefined') {\r\n        pageCourses = loadedPages[currentPage].courses;\r\n        const currentPageLength = pageCourses.length;\r\n        if (currentPageLength < pageData.limit) {\r\n            nextPageStart = pageData.limit - currentPageLength;\r\n            pageCourses = {...loadedPages[currentPage].courses, ...courses.slice(0, nextPageStart)};\r\n        }\r\n    } else {\r\n        // When the page limit is zero, there is only one page of courses, no start for next page.\r\n        nextPageStart = pageData.limit || false;\r\n        pageCourses = (pageData.limit > 0) ? courses.slice(0, pageData.limit) : courses;\r\n    }\r\n\r\n    // Finished setting up the current page.\r\n    loadedPages[currentPage] = {\r\n        courses: pageCourses\r\n    };\r\n\r\n    // Set up the next page (if there is more than one page).\r\n    const remainingCourses = nextPageStart !== false ? courses.slice(nextPageStart, courses.length) : [];\r\n    if (remainingCourses.length) {\r\n        loadedPages[currentPage + 1] = {\r\n            courses: remainingCourses\r\n        };\r\n    }\r\n\r\n    // Set the last page to either the current or next page.\r\n    if (loadedPages[currentPage].courses.length < pageData.limit || !remainingCourses.length) {\r\n        lastPage = currentPage;\r\n        if (activeSearch === null) {\r\n            actions.allItemsLoaded(currentPage);\r\n        }\r\n    } else if (typeof (loadedPages[currentPage + 1]) !== 'undefined'\r\n        && loadedPages[currentPage + 1].courses.length < pageData.limit) {\r\n        lastPage = currentPage + 1;\r\n    }\r\n\r\n    courseOffset = coursesData.nextoffset;\r\n};\r\n\r\n/**\r\n * In cases when switching between regular rendering and search rendering we need to reset some variables.\r\n */\r\nconst resetGlobals = () => {\r\n    courseOffset = 0;\r\n    loadedPages = [];\r\n    lastPage = 0;\r\n    lastLimit = 0;\r\n};\r\n\r\n/**\r\n * The default functionality of fetching paginated courses without special handling.\r\n *\r\n * @return {function(Object, Object, Object, Object, Object, Promise, Number): void}\r\n */\r\nconst standardFunctionalityCurry = () => {\r\n    resetGlobals();\r\n    return (filters, currentPage, pageData, actions, root, promises, limit) => {\r\n        const pagePromise = getMyCourses(\r\n            filters,\r\n            limit\r\n        ).then(coursesData => {\r\n            pageBuilder(coursesData, currentPage, pageData, actions);\r\n            return renderCourses(root, loadedPages[currentPage]);\r\n        }).catch(Notification.exception);\r\n\r\n        promises.push(pagePromise);\r\n    };\r\n};\r\n\r\n/**\r\n * Initialize the searching functionality so we can call it when required.\r\n *\r\n * @return {function(Object, Number, Object, Object, Object, Promise, Number, String): void}\r\n */\r\nconst searchFunctionalityCurry = () => {\r\n    resetGlobals();\r\n    return (filters, currentPage, pageData, actions, root, promises, limit, inputValue) => {\r\n        const searchingPromise = getSearchMyCourses(\r\n            filters,\r\n            limit,\r\n            inputValue\r\n        ).then(coursesData => {\r\n            pageBuilder(coursesData, currentPage, pageData, actions);\r\n            return renderCourses(root, loadedPages[currentPage]);\r\n        }).catch(Notification.exception);\r\n\r\n        promises.push(searchingPromise);\r\n    };\r\n};\r\n\r\n/**\r\n * Initialise the courses list and cards views on page load.\r\n *\r\n * @param {object} root The root element for the courses view.\r\n * @param {function} promiseFunction How do we fetch the courses and what do we do with them?\r\n * @param {null | string} inputValue What to search for\r\n */\r\nconst initializePagedContent = (root, promiseFunction, inputValue = null) => {\r\n    const pagingLimit = parseInt(root.find(SELECTORS.courseView.region).attr('data-paging'), 10);\r\n    let itemsPerPage = itemsPerPageFunc(pagingLimit, root);\r\n\r\n    const config = {...{}, ...DEFAULT_PAGED_CONTENT_CONFIG};\r\n    config.eventNamespace = namespace;\r\n\r\n    const pagedContentPromise = PagedContentFactory.createWithLimit(\r\n        itemsPerPage,\r\n        (pagesData, actions) => {\r\n            let promises = [];\r\n            pagesData.forEach(pageData => {\r\n                const currentPage = pageData.pageNumber;\r\n                let limit = (pageData.limit > 0) ? pageData.limit : 0;\r\n\r\n                // Reset local variables if limits have changed.\r\n                if (+lastLimit !== +limit) {\r\n                    loadedPages = [];\r\n                    courseOffset = 0;\r\n                    lastPage = 0;\r\n                }\r\n\r\n                if (lastPage === currentPage) {\r\n                    // If we are on the last page and have it's data then load it from cache.\r\n                    actions.allItemsLoaded(lastPage);\r\n                    promises.push(renderCourses(root, loadedPages[currentPage]));\r\n                    return;\r\n                }\r\n\r\n                lastLimit = limit;\r\n\r\n                // Get 2 pages worth of data as we will need it for the hidden functionality.\r\n                if (typeof (loadedPages[currentPage + 1]) === 'undefined') {\r\n                    if (typeof (loadedPages[currentPage]) === 'undefined') {\r\n                        limit *= 2;\r\n                    }\r\n                }\r\n\r\n                // Get the current applied filters.\r\n                const filters = getFilterValues(root);\r\n\r\n                // Call the curried function that'll handle the course promise and any manipulation of it.\r\n                promiseFunction(filters, currentPage, pageData, actions, root, promises, limit, inputValue);\r\n            });\r\n            return promises;\r\n        },\r\n        config\r\n    );\r\n\r\n    pagedContentPromise.then((html, js) => {\r\n        registerPagedEventHandlers(root, namespace);\r\n\r\n        if($('.block_myoverview').data('myoverview_loaded') === undefined){\r\n            $('.block_myoverview').data('myoverview_loaded', 'loaded' );\r\n            var event = new Event('loadmyoverview');\r\n            document.dispatchEvent(event);\r\n        }\r\n\r\n        return Templates.replaceNodeContents(root.find(SELECTORS.courseView.region), html, js);\r\n    }).catch(Notification.exception);\r\n};\r\n\r\n/**\r\n * Listen to, and handle events for the myoverview block.\r\n *\r\n * @param {Object} root The myoverview block container element.\r\n * @param {HTMLElement} page The whole HTMLElement for our block.\r\n */\r\nconst registerEventListeners = (root, page) => {\r\n\r\n    CustomEvents.define(root, [\r\n        CustomEvents.events.activate\r\n    ]);\r\n\r\n    root.on(CustomEvents.events.activate, SELECTORS.ACTION_ADD_FAVOURITE, (e, data) => {\r\n        const favourite = $(e.target).closest(SELECTORS.ACTION_ADD_FAVOURITE);\r\n        const courseId = getCourseId(favourite);\r\n        addToFavourites(root, courseId);\r\n        data.originalEvent.preventDefault();\r\n    });\r\n\r\n    root.on(CustomEvents.events.activate, SELECTORS.ACTION_REMOVE_FAVOURITE, (e, data) => {\r\n        const favourite = $(e.target).closest(SELECTORS.ACTION_REMOVE_FAVOURITE);\r\n        const courseId = getCourseId(favourite);\r\n        removeFromFavourites(root, courseId);\r\n        data.originalEvent.preventDefault();\r\n    });\r\n\r\n    root.on(CustomEvents.events.activate, SELECTORS.FAVOURITE_ICON, (e, data) => {\r\n        data.originalEvent.preventDefault();\r\n    });\r\n\r\n    root.on(CustomEvents.events.activate, SELECTORS.ACTION_HIDE_COURSE, (e, data) => {\r\n        const target = $(e.target).closest(SELECTORS.ACTION_HIDE_COURSE);\r\n        const courseId = getCourseId(target);\r\n        hideCourse(root, courseId);\r\n        data.originalEvent.preventDefault();\r\n    });\r\n\r\n    root.on(CustomEvents.events.activate, SELECTORS.ACTION_SHOW_COURSE, (e, data) => {\r\n        const target = $(e.target).closest(SELECTORS.ACTION_SHOW_COURSE);\r\n        const courseId = getCourseId(target);\r\n        showCourse(root, courseId);\r\n        data.originalEvent.preventDefault();\r\n    });\r\n\r\n    root.on(CustomEvents.events.activate, SELECTORS.ACTION_SEND_MESSAGE, (e, data) => {\r\n        var target = $(e.target).parents(SELECTORS.COURSE_ITEM);\r\n        var id = getCourseId(target);\r\n\r\n        var message = new Message.init();\r\n        message.openForm(id, 'class');\r\n    });\r\n\r\n    root.on(CustomEvents.events.activate, SELECTORS.ACTION_SEND_MESSAGE_TEACHER, (e, data) => {\r\n        var target = $(e.target).parents(SELECTORS.COURSE_ITEM);\r\n        var id = getCourseId(target);\r\n\r\n        var message = new Message.init();\r\n        message.openForm(id, 'teacher');\r\n    });\r\n\r\n    root.on(CustomEvents.events.activate, SELECTORS.ACTION_NEW_EVENT, (e, data) => {\r\n        var target = $(e.target).parents(SELECTORS.COURSE_ITEM);\r\n        var id = getCourseId(target);\r\n\r\n        var contextId = $('#context_'+id).val();\r\n\r\n        var eventFormPromise = ModalFactory.create({\r\n            type: ModalEventForm.TYPE,\r\n            large: true\r\n        });\r\n\r\n        eventFormPromise.then(function(modal) {\r\n            modal.setContextId(contextId);\r\n            modal.setCourseId(id);\r\n            modal.show();\r\n            return;\r\n        })\r\n            .fail(Notification.exception);\r\n\r\n        //e.preventDefault();\r\n        data.originalEvent.preventDefault();\r\n    });\r\n\r\n    // Searching functionality event handlers.\r\n    const input = page.querySelector(SELECTORS.region.searchInput);\r\n    const clearIcon = page.querySelector(SELECTORS.region.clearIcon);\r\n\r\n    clearIcon.addEventListener('click', () => {\r\n        input.value = '';\r\n        input.focus();\r\n        clearSearch(clearIcon, root);\r\n    });\r\n\r\n    input.addEventListener('input', debounce(() => {\r\n        if (input.value === '') {\r\n            clearSearch(clearIcon, root);\r\n        } else {\r\n            activeSearch(clearIcon);\r\n            initializePagedContent(root, searchFunctionalityCurry(), input.value.trim());\r\n        }\r\n    }, 1000));\r\n};\r\n\r\n/**\r\n * Reset the search icon and trigger the init for the block.\r\n *\r\n * @param {HTMLElement} clearIcon Our closing icon to manipulate.\r\n * @param {Object} root The myoverview block container element.\r\n */\r\nexport const clearSearch = (clearIcon, root) => {\r\n    clearIcon.classList.add('d-none');\r\n    init(root);\r\n};\r\n\r\n/**\r\n * Change the searching icon to its' active state.\r\n *\r\n * @param {HTMLElement} clearIcon Our closing icon to manipulate.\r\n */\r\nconst activeSearch = (clearIcon) => {\r\n    clearIcon.classList.remove('d-none');\r\n};\r\n\r\n/**\r\n * Intialise the courses list and cards views on page load.\r\n *\r\n * @param {object} root The root element for the courses view.\r\n */\r\nexport const init = root => {\r\n    root = $(root);\r\n    loadedPages = [];\r\n    lastPage = 0;\r\n    courseOffset = 0;\r\n\r\n    if (!root.attr('data-init')) {\r\n        const page = document.querySelector(SELECTORS.region.selectBlock);\r\n        registerEventListeners(root, page);\r\n        namespace = \"block_myoverview_\" + root.attr('id') + \"_\" + Math.random();\r\n        root.attr('data-init', true);\r\n    }\r\n\r\n    initializePagedContent(root, standardFunctionalityCurry());\r\n};\r\n\r\n/**\r\n * Reset the courses views to their original\r\n * state on first page load.courseOffset\r\n *\r\n * This is called when configuration has changed for the event lists\r\n * to cause them to reload their data.\r\n *\r\n * @param {Object} root The root element for the timeline view.\r\n */\r\nexport const reset = root => {\r\n    if (loadedPages.length > 0) {\r\n        const filters = getFilterValues(root);\r\n        // If the display mode is changed to 'summary' but the summary display has not been loaded yet,\r\n        // we need to re-fetch the courses to include the course summary text.\r\n        if (filters.display === 'summary' && !summaryDisplayLoaded) {\r\n            const page = document.querySelector(SELECTORS.region.selectBlock);\r\n            const input = page.querySelector(SELECTORS.region.searchInput);\r\n            if (input.value !== '') {\r\n                initializePagedContent(root, searchFunctionalityCurry(), input.value.trim());\r\n            } else {\r\n                initializePagedContent(root, standardFunctionalityCurry());\r\n            }\r\n        } else {\r\n            loadedPages.forEach((courseList, index) => {\r\n                let pagedContentPage = getPagedContentContainer(root, index);\r\n                renderCourses(root, courseList).then((html, js) => {\r\n                    return Templates.replaceNodeContents(pagedContentPage, html, js);\r\n                }).catch(Notification.exception);\r\n            });\r\n        }\r\n    } else {\r\n        init(root);\r\n    }\r\n};\r\n"],"names":["TEMPLATES","GROUPINGS","NUMCOURSES_PERPAGE","loadedPages","courseOffset","lastPage","lastLimit","namespace","summaryDisplayLoaded","getFilterValues","root","courseRegion","find","SELECTORS","courseView","region","display","attr","grouping","sort","displaycategories","customfieldname","customfieldvalue","DEFAULT_PAGED_CONTENT_CONFIG","ignoreControlWhileLoading","controlPlacementBottom","persistentLimitKey","getFavouriteIconContainer","courseId","FAVOURITE_ICON","getPagedContentContainer","index","getCourseId","getAddFavouriteMenuItem","getRemoveFavouriteMenuItem","addToFavourites","removeAction","addAction","setCourseFavouriteState","then","success","PubSub","publish","CourseEvents","favourited","removeClass","addClass","iconContainer","isFavouriteIcon","ICON_IS_FAVOURITE","Aria","unhide","notFavourteIcon","ICON_NOT_FAVOURITE","hide","showFavouriteIcon","Notification","alert","catch","exception","removeFromFavourites","unfavorited","hideFavouriteIcon","getHideCourseMenuItem","getShowCourseMenuItem","setCourseHiddenState","status","hideElement","id","pagingBar","jumpto","parseInt","reducedCourse","courses","reduce","accumulator","current","push","newElement","slice","forEach","courseList","popElement","length","pagedContentContainer","PagedContentFactory","resetLastPageNumber","pagedContentPage","renderCourses","html","js","Templates","replaceNodeContents","remove","Repository","setFavouriteCourses","result","warnings","course","isfavourite","noCoursesRender","nocoursesimg","newcourseurl","render","coursesData","filters","currentTemplate","Array","isArray","Object","values","map","showcoursecategory","registerPagedEventHandlers","event","PagedContentEvents","SET_ITEMS_PER_PAGE_LIMIT","subscribe","limit","setLimit","itemsPerPageFunc","pagingLimit","itemsPerPage","value","active","totalCourseCount","filter","pagingOption","pageBuilder","currentPage","pageData","actions","activeSearch","nextPageStart","pageCourses","currentPageLength","remainingCourses","allItemsLoaded","nextoffset","resetGlobals","standardFunctionalityCurry","promises","pagePromise","params","offset","classification","requiredfields","SUMMARY_REQUIRED_FIELDS","CARDLIST_REQUIRED_FIELDS","getEnrolledCoursesByTimeline","getMyCourses","searchFunctionalityCurry","inputValue","searchingPromise","searchValue","searchvalue","getSearchMyCourses","initializePagedContent","promiseFunction","config","eventNamespace","pagedContentPromise","createWithLimit","pagesData","pageNumber","undefined","data","Event","document","dispatchEvent","registerEventListeners","page","CustomEvents","define","events","activate","on","ACTION_ADD_FAVOURITE","e","favourite","target","closest","originalEvent","preventDefault","ACTION_REMOVE_FAVOURITE","ACTION_HIDE_COURSE","hideAction","showAction","hideCourse","ACTION_SHOW_COURSE","showCourse","ACTION_SEND_MESSAGE","parents","COURSE_ITEM","Message","init","openForm","ACTION_SEND_MESSAGE_TEACHER","ACTION_NEW_EVENT","contextId","val","ModalFactory","create","type","ModalEventForm","TYPE","large","modal","setContextId","setCourseId","show","fail","input","querySelector","searchInput","clearIcon","addEventListener","focus","clearSearch","trim","classList","add","selectBlock","Math","random"],"mappings":"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"}