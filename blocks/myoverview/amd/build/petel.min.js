/**
 * Javascript to initialise the myoverview block.
 *
 * @package    block_myoverview
 * @copyright  2018 Bas Brands <bas@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("block_myoverview/petel",["jquery","core/ajax","local_petel/inview","core/notification"],(function($,Ajax,inView,Notification){return{main:function(numberitems,time){null==numberitems&&(numberitems=1),null==time&&(time=3e3);var courses=[];let tmp=[],count=0,count_all=0,length=$(".block-myoverview-listitem").length;$(".block-myoverview-listitem").each((function(index){let courseid=$(this).attr("data-course-id");count<numberitems&&(tmp.push(courseid),count++,count_all++,count==numberitems&&(tmp.length>0&&courses.push(tmp),tmp=[],count=0),count_all==length&&(tmp.length>0&&courses.push(tmp),tmp=[],count=0))})),this.ajax(courses,time)},inview:function(time){null==time&&(time=3e3);let stack=[],self=this;inView(".selector-inview").on("enter",(function(e){if(!$(e).hasClass("inview-done")){$(e).addClass("inview-done");let courseid=$(e).attr("data-course-id");stack.push(courseid)}})).on("exit",(el=>{})),setInterval((function(){if(stack.length>0){let courses=[];courses.push(stack),stack=[],self.ajax(courses,0)}}),time)},ajax:function(courses,time){courses.forEach((function(course,i){setTimeout((function(){Ajax.call([{methodname:"block_myoverview_get_custom_info_by_course",args:{courseids:JSON.stringify(course)},done:function(response){JSON.parse(response.result).forEach((element=>{let courseid=element.courseid,obj=$('.type-petel[data-course-id="'+courseid+'"]'),data=JSON.parse(element.links);$(obj).find(".course-action-menu").html(data),data_events=JSON.parse(element.events),data_activities=JSON.parse(element.activities),data_noactivity=JSON.parse(element.noactivity),0!=data_events.length?$(obj).find(".myoverview-events").html(data_events):0!=data_activities?$(obj).find(".myoverview-events").html(data_activities):$(obj).find(".myoverview-events").html(data_noactivity),data=JSON.parse(element.grademe),data.text.length>0&&$(obj).find(".myoverview-events").append(data.text),data=JSON.parse(element.quickaccesslink),$(obj).find(".quickaccesslink").html(data.text),1!=element.isteacher?$(obj).find(".progress-bar-student").show():$(obj).find(".progress-bar-student").hide()}))},fail:Notification.exception}])}),(i+1)*time)}))}}}));

//# sourceMappingURL=petel.min.js.map