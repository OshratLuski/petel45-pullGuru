{"version":3,"file":"petel.min.js","sources":["../src/petel.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * Javascript to initialise the myoverview block.\r\n *\r\n * @package    block_myoverview\r\n * @copyright  2018 Bas Brands <bas@moodle.com>\r\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\n\r\ndefine(\r\n    [\r\n        'jquery',\r\n        'core/ajax',\r\n        'local_petel/inview',\r\n        'core/notification'\r\n    ],\r\n    function ($, Ajax, inView, Notification) {\r\n\r\n        var main = function (numberitems, time) {\r\n\r\n            if (numberitems == undefined) {\r\n                numberitems = 1;\r\n            }\r\n\r\n            if (time == undefined) {\r\n                time = 3000;\r\n            }\r\n\r\n            var courses = [];\r\n            let tmp = [];\r\n            let count = 0;\r\n            let count_all = 0;\r\n            let length = $('.block-myoverview-listitem').length;\r\n\r\n            $('.block-myoverview-listitem').each(function (index) {\r\n                let courseid = $(this).attr(\"data-course-id\");\r\n\r\n                if (count < numberitems) {\r\n                    tmp.push(courseid);\r\n                    count++;\r\n                    count_all++;\r\n\r\n                    if (count == numberitems) {\r\n                        if (tmp.length > 0) {\r\n                            courses.push(tmp);\r\n                        }\r\n\r\n                        tmp = [];\r\n                        count = 0;\r\n                    }\r\n\r\n                    if (count_all == length) {\r\n                        if (tmp.length > 0) {\r\n                            courses.push(tmp);\r\n                        }\r\n\r\n                        tmp = [];\r\n                        count = 0;\r\n                    }\r\n                }\r\n            })\r\n\r\n            this.ajax(courses, time);\r\n        };\r\n\r\n        var inview = function (time) {\r\n\r\n            if (time == undefined) {\r\n                time = 3000;\r\n            }\r\n\r\n            let stack = [];\r\n            let self = this;\r\n\r\n            inView('.selector-inview')\r\n                .on('enter', function (e){\r\n                    if(!$(e).hasClass('inview-done')){\r\n                        $(e).addClass('inview-done');\r\n\r\n                        let courseid = $(e).attr(\"data-course-id\");\r\n                        stack.push(courseid);\r\n                    }\r\n                })\r\n                .on('exit', el => {\r\n                    //el.style.opacity = 0.5;\r\n                });\r\n\r\n            setInterval(function(){\r\n\r\n                if(stack.length > 0){\r\n                    let courses = [];\r\n                    courses.push(stack);\r\n\r\n                    stack = [];\r\n                    self.ajax(courses, 0);\r\n                }\r\n\r\n            }, time);\r\n\r\n        };\r\n\r\n        var ajax = function (courses, time) {\r\n\r\n            courses.forEach(function (course, i) {\r\n\r\n                setTimeout(function () {\r\n\r\n                    Ajax.call([{\r\n                        methodname: 'block_myoverview_get_custom_info_by_course',\r\n                        args: {\r\n                            courseids: JSON.stringify(course)\r\n                        },\r\n                        done: function (response) {\r\n\r\n                            JSON.parse(response.result).forEach((element) => {\r\n\r\n                                let courseid = element.courseid;\r\n                                let obj = $('.type-petel[data-course-id=\"' + courseid + '\"]');\r\n\r\n                                let data = JSON.parse(element.links);\r\n                                $(obj).find('.course-action-menu').html(data);\r\n\r\n                                data_events = JSON.parse(element.events);\r\n                                data_activities = JSON.parse(element.activities);\r\n                                data_noactivity = JSON.parse(element.noactivity);\r\n\r\n                                if (data_events.length != 0) {\r\n                                    $(obj).find('.myoverview-events').html(data_events);\r\n                                } else {\r\n                                    if (data_activities != 0) {\r\n                                        $(obj).find('.myoverview-events').html(data_activities);\r\n                                    } else {\r\n                                        $(obj).find('.myoverview-events').html(data_noactivity);\r\n                                    }\r\n                                }\r\n\r\n                                data = JSON.parse(element.grademe);\r\n                                if (data.text.length > 0) {\r\n                                    $(obj).find('.myoverview-events').append(data.text);\r\n                                }\r\n\r\n                                data = JSON.parse(element.quickaccesslink);\r\n                                $(obj).find('.quickaccesslink').html(data.text);\r\n\r\n                                if (element.isteacher != 1) {\r\n                                    $(obj).find('.progress-bar-student').show();\r\n                                } else {\r\n                                    $(obj).find('.progress-bar-student').hide();\r\n                                }\r\n                            })\r\n                        },\r\n                        fail: Notification.exception\r\n                    }]);\r\n                }, (i + 1) * time);\r\n\r\n\r\n            });\r\n        };\r\n\r\n        return {\r\n            main: main,\r\n            inview: inview,\r\n            ajax: ajax\r\n        };\r\n    });\r\n"],"names":["define","$","Ajax","inView","Notification","main","numberitems","time","undefined","courses","tmp","count","count_all","length","each","index","courseid","this","attr","push","ajax","inview","stack","self","on","e","hasClass","addClass","el","setInterval","forEach","course","i","setTimeout","call","methodname","args","courseids","JSON","stringify","done","response","parse","result","element","obj","data","links","find","html","data_events","events","data_activities","activities","data_noactivity","noactivity","grademe","text","append","quickaccesslink","isteacher","show","hide","fail","exception"],"mappings":";;;;;;;AAuBAA,gCACI,CACI,SACA,YACA,qBACA,sBAEJ,SAAUC,EAAGC,KAAMC,OAAQC,oBA+IhB,CACHC,KA9IO,SAAUC,YAAaC,MAEXC,MAAfF,cACAA,YAAc,GAGNE,MAARD,OACAA,KAAO,SAGPE,QAAU,OACVC,IAAM,GACNC,MAAQ,EACRC,UAAY,EACZC,OAASZ,EAAE,8BAA8BY,OAE7CZ,EAAE,8BAA8Ba,MAAK,SAAUC,WACvCC,SAAWf,EAAEgB,MAAMC,KAAK,kBAExBP,MAAQL,cACRI,IAAIS,KAAKH,UACTL,QACAC,YAEID,OAASL,cACLI,IAAIG,OAAS,GACbJ,QAAQU,KAAKT,KAGjBA,IAAM,GACNC,MAAQ,GAGRC,WAAaC,SACTH,IAAIG,OAAS,GACbJ,QAAQU,KAAKT,KAGjBA,IAAM,GACNC,MAAQ,YAKfS,KAAKX,QAASF,OAmGnBc,OAhGS,SAAUd,MAEPC,MAARD,OACAA,KAAO,SAGPe,MAAQ,GACRC,KAAON,KAEXd,OAAO,oBACFqB,GAAG,SAAS,SAAUC,OACfxB,EAAEwB,GAAGC,SAAS,eAAe,CAC7BzB,EAAEwB,GAAGE,SAAS,mBAEVX,SAAWf,EAAEwB,GAAGP,KAAK,kBACzBI,MAAMH,KAAKH,cAGlBQ,GAAG,QAAQI,SAIhBC,aAAY,cAELP,MAAMT,OAAS,EAAE,KACZJ,QAAU,GACdA,QAAQU,KAAKG,OAEbA,MAAQ,GACRC,KAAKH,KAAKX,QAAS,MAGxBF,OAiEHa,KA7DO,SAAUX,QAASF,MAE1BE,QAAQqB,SAAQ,SAAUC,OAAQC,GAE9BC,YAAW,WAEP/B,KAAKgC,KAAK,CAAC,CACPC,WAAY,6CACZC,KAAM,CACFC,UAAWC,KAAKC,UAAUR,SAE9BS,KAAM,SAAUC,UAEZH,KAAKI,MAAMD,SAASE,QAAQb,SAASc,cAE7B5B,SAAW4B,QAAQ5B,SACnB6B,IAAM5C,EAAE,+BAAiCe,SAAW,MAEpD8B,KAAOR,KAAKI,MAAME,QAAQG,OAC9B9C,EAAE4C,KAAKG,KAAK,uBAAuBC,KAAKH,MAExCI,YAAcZ,KAAKI,MAAME,QAAQO,QACjCC,gBAAkBd,KAAKI,MAAME,QAAQS,YACrCC,gBAAkBhB,KAAKI,MAAME,QAAQW,YAEX,GAAtBL,YAAYrC,OACZZ,EAAE4C,KAAKG,KAAK,sBAAsBC,KAAKC,aAEhB,GAAnBE,gBACAnD,EAAE4C,KAAKG,KAAK,sBAAsBC,KAAKG,iBAEvCnD,EAAE4C,KAAKG,KAAK,sBAAsBC,KAAKK,iBAI/CR,KAAOR,KAAKI,MAAME,QAAQY,SACtBV,KAAKW,KAAK5C,OAAS,GACnBZ,EAAE4C,KAAKG,KAAK,sBAAsBU,OAAOZ,KAAKW,MAGlDX,KAAOR,KAAKI,MAAME,QAAQe,iBAC1B1D,EAAE4C,KAAKG,KAAK,oBAAoBC,KAAKH,KAAKW,MAEjB,GAArBb,QAAQgB,UACR3D,EAAE4C,KAAKG,KAAK,yBAAyBa,OAErC5D,EAAE4C,KAAKG,KAAK,yBAAyBc,WAIjDC,KAAM3D,aAAa4D,gBAEvBhC,EAAI,GAAKzB"}