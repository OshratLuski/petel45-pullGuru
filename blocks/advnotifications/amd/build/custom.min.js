/**
 * @package    block_advnotifications
 * @copyright  2019 onwards LearningWorks Ltd {@link https://learningworks.co.nz/}
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @author     Zander Potgieter <zander.potgieter@learningworks.co.nz>
 */
define("block_advnotifications/custom",["jquery"],(function($){return{initialise:function(){$(document).ready((function(){var mainregion=$("#region-main"),addregion=$("#add_notification_wrapper_id"),strings={save:"Save",update:"Update",req:"Required...",preview:"Preview",title:"Title",message:"Message"};mainregion.on("click",".notifications_table tr > td > form > button[type=submit]",(function(e){e.preventDefault();var senddata={call:"ajax",purpose:"",tableaction:"",blockid:""},eattr=$(this).closest("form").attr("data-edit"),dattr=$(this).closest("form").attr("data-delete");if(senddata.blockid=$(this).closest("form").find("[name=blockid]")[0].value,refreshRequired(),void 0!==eattr&&!1!==eattr){senddata.purpose="edit",senddata.tableaction=eattr;var savebutton=$("#add_notification_save");savebutton.addClass("update"),savebutton.val(strings.update)}else void 0!==dattr&&!1!==dattr&&(senddata.purpose="delete",senddata.tableaction=dattr);var callpath=M.cfg.wwwroot+"/blocks/advnotifications/pages/process.php?sesskey="+M.cfg.sesskey;$.post(callpath,senddata).fail((function(){console.error("No 'manage' response received.")})).done((function(data){if(data=JSON.parse(data),parseInt(data.done,10)>0)$("#tr"+senddata.purpose+data.done).closest("tr").fadeOut(250,(function(){$(this).remove(),clearForm(),refreshPreview()}));else if("edit"===senddata.purpose){for(var i in data)if(data.hasOwnProperty(i)){if("id"===i){var form=$("#add_notification_form");$("#add_notification_id").remove(),form.prepend('<input type="hidden" id="add_notification_id" name="id" value="'+data[i]+'"/>'),$("#add_notification_purpose").val("update")}var affectelement=$("#add_notification_wrapper_id").find("#add_notification_"+i);"enabled"!==i&&"global"!==i&&"dismissible"!==i&&"aicon"!==i||1!=data[i]?"enabled"!==i&&"global"!==i&&"dismissible"!==i&&"aicon"!==i||0!=data[i]?affectelement.val(data[i]):affectelement.prop("checked",!1):affectelement.prop("checked",!0)}reloadPreview()}}))})),mainregion.on("click",".notifications_restore_table tr > td > form > button[type=submit]",(function(e){e.preventDefault();var senddata={call:"ajax",purpose:"",tableaction:"",blockid:""},rattr=$(this).closest("form").attr("data-restore"),pdattr=$(this).closest("form").attr("data-permdelete");senddata.blockid=$(this).closest("form").find("[name=blockid]")[0].value,void 0!==rattr&&!1!==rattr?(senddata.purpose="restore",senddata.tableaction=rattr):void 0!==pdattr&&!1!==pdattr&&(senddata.purpose="permdelete",senddata.tableaction=pdattr);var callpath=M.cfg.wwwroot+"/blocks/advnotifications/pages/process.php?sesskey="+M.cfg.sesskey;$.post(callpath,senddata).fail((function(){console.error("No 'restore/permdelete' response received.")})).done((function(data){data=JSON.parse(data),parseInt(data.done,10)>0&&$("#tr"+senddata.purpose+data.done).closest("tr").fadeOut(250,(function(){$(this).remove()}))}))})),addregion.on("click","#add_notification_cancel",(function(e){e.preventDefault(),clearForm()})),mainregion.on("submit","#add_notification_form",(function(e){e.preventDefault();var status=$("#add_notification_status"),form=$("#add_notification_form");if(refreshRequired(),checkRequired()){status.show();var senddata=$(this).serialize(),callpath=M.cfg.wwwroot+"/blocks/advnotifications/pages/process.php";$.post(callpath,senddata).fail((function(data){console.error("No 'add' response received.");var error=data.responseJSON.error;for(var i in error)if(error.hasOwnProperty(i)){var sfield=form.find("select[name="+error[i]+"]");sfield.addClass("requiredfield"),$('<strong class="requiredfield"><em>'+strings.req+"</em></strong>").insertAfter(sfield[0].nextSibling)}status.hide()})).done((function(){status.find(".saving").hide(),status.find(".done").show(),clearForm(),setTimeout((function(){status.fadeOut((function(){status.find(".done").hide(),status.find(".saving").show()}))}),1500),$("#advnotifications_table_wrapper").load("# #advnotifications_table_wrapper > *")}))}})),addregion.on("input propertychange paste","#add_notification_title, #add_notification_message",(function(){reloadPreview()})),$("#add_notification_type").on("change",(function(){reloadPreview()})),$("#add_notification_dismissible").on("change",(function(){reloadPreview()})),$("#add_notification_aicon").on("change",(function(){reloadPreview()}));var senddata,callpath,reloadPreview=function(){var titleText=addregion.find("#add_notification_title").val().trim();let title=addregion.find("h4.alert-title");titleText.length>0?(title.show(),title.html(titleText)):0==titleText.length?title.hide():(title.show(),title.html(strings.title));var message=addregion.find("#add_notification_message");let previewMessage=addregion.find(".alert-text").children().first();message.val().length>0?previewMessage.html(message.val()):previewMessage.html(strings.message);var alerttype=$("#add_notification_type").val(),previewalert=$(".notification-block-wrapper");previewalert.removeClass("alert-info alert-success alert-danger alert-warning announcement"),"announcement"===alerttype&&(previewalert.addClass(alerttype),alerttype="info"),"info"!==alerttype&&"success"!==alerttype&&"warning"!==alerttype&&"danger"!==alerttype&&(alerttype="info"),previewalert.addClass("alert-"+alerttype);const icon=previewalert.find(".icon-wrapper");if("warning"===alerttype&&icon.html('<i class=" fal fa-exclamation-triangle mt-1"></i>'),"danger"!==alerttype&&"info"!==alerttype||icon.html('<i class=" fal fa-exclamation-circle mt-1"></i>'),"success"===alerttype&&icon.html('<i class=" fal fa-check-circle mt-1"></i>'),$("#add_notification_dismissible")[0].checked?($(".notification-block-close").show(),previewalert.addClass("dismissible")):($(".notification-block-close").hide(),previewalert.removeClass("dismissible")),$("#add_notification_aicon")[0].checked){$(".icon-wrapper").show(),previewalert.addClass("aicon");let icon='<i class="fal fa-exclamation-circle mt-1"></i>';"warning"===alerttype&&(icon='<i class="fal fa-exclamation-triangle mt-1"></i>'),"success"===alerttype&&(icon='<i class="fal fa-check-circle mt-1"></i>'),previewalert.find(".icon-wrapper").html(""),$(icon).appendTo(previewalert.find(".icon-wrapper"))}else $(".icon-wrapper").hide(),previewalert.removeClass("aicon")},refreshPreview=function(){var previewelem=$("#notification_preview_wrapper");const previewdom="\n                        <strong>".concat(strings.preview,'</strong>\n                        <div id="notification_preview_wrapper" class="notification-block-wrapper alert-preview dismissible limitedtimes aicon d-flex mb-3 p-0 alert alert-info">\n                            <div class="alert-colorblock"></div>\n                            <div class="alert-inner d-flex flex-no-wrap align-items-start">\n                                <div class="icon-wrapper" style="display: none;"></div>\n                                <div class="alert-wrapper">\n                                    <h4 class="alert-title mb-0">').concat(strings.title,'</h4>\n                                    <div class="m-0 alert-text">').concat(strings.message,'</div>\n                                </div>\n                                <div class="notification-block-close ml-auto mt-1" style="display: none;">\n                                    <i class="fal fa-times-circle"></i>\n                                </div>\n                            </div>            \n                        </div>');previewelem.length>0?(previewelem.parent().find("strong").remove(),previewelem.remove(),$(previewdom).prependTo($(addregion))):$(previewdom).prependTo($(addregion)).hide().slideDown()},checkRequired=function(){var disselopt=$("#add_notification_form select option:selected:disabled");for(var opt in disselopt)if(disselopt.hasOwnProperty(opt)&&$(disselopt[opt]).prop("disabled"))return $(disselopt[opt]).closest("select").addClass("requiredfield"),$('<strong class="requiredfield"><em>'+strings.req+"</em></strong>").insertAfter($(disselopt[opt]).closest("select")[0].nextSibling),!1;return!0},refreshRequired=function(){$("select.requiredfield").removeClass("requiredfield"),$("strong.requiredfield").remove()},clearForm=function(){$("#add_notification_form")[0].reset(),refreshRequired(),refreshPreview();var savebutton=$("#add_notification_save");savebutton.removeClass("update"),$("#add_notification_id").remove(),$("#add_notification_purpose").val("add"),savebutton.val(strings.save)};senddata={call:"ajax",purpose:"strings"},callpath=M.cfg.wwwroot+"/blocks/advnotifications/pages/process.php?sesskey="+M.cfg.sesskey,$.post(callpath,senddata).fail((function(){console.error("No 'strings' response received.")})).done((function(data){strings=data})).always((function(){refreshPreview()})),$("#add_notification_form").append('<input type="hidden" id="add_notification_call" name="call" value="ajax"/>')}))}}}));

//# sourceMappingURL=custom.min.js.map