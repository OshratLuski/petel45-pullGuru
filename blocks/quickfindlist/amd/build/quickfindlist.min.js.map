{"version":3,"file":"quickfindlist.min.js","sources":["../src/quickfindlist.js"],"sourcesContent":["define(\n    ['jquery', 'core/str'],\n    function($, Str) {\n        var priv = {\n            sesskey: null,\n            instances: []\n        };\n\n        var t = {\n            init: function(roleid, userfields, url, courseformat, courseid, sesskey) {\n                priv.sesskey = sesskey;\n\n                var instance = {\n                    'roleid': roleid,\n                    'userfields': userfields,\n                    'url': url,\n                    'courseformat': courseformat,\n                    'courseid': courseid,\n                    'progress': $('#quickfindprogress'+roleid),\n                    'listcontainer': $('#quickfindlist'+roleid),\n                    'xhr': null\n                };\n                priv.instances[roleid] = instance;\n                $('#quickfindlistsearch'+roleid).on('keyup', t.search_on_type);\n                $('#quickfindform'+roleid).on('submit', t.search_on_submit);\n            },\n\n            search_on_type: function(e) {\n                var target = $(e.target);\n                var searchstring = target.val();\n                var roleid = /[\\-0-9]+/.exec(target.attr('id'))[0];\n                t.search(searchstring, roleid);\n                M.util.js_pending('quickfindlist' + roleid);\n            },\n\n            search_on_submit: function(e) {\n                e.preventDefault();\n                var target = $(e.target);\n                var roleid = /[\\-0-9]+/.exec(target.attr('id'))[0];\n                var searchstring = target.find('#quickfindlistsearch'+roleid).val();\n                t.search(searchstring, roleid);\n                M.util.js_pending('quickfindlist' + roleid);\n            },\n\n\n            search: function(searchstring, roleid) {\n\n                var instance = priv.instances[roleid];\n\n                var url = M.cfg.wwwroot+'/blocks/quickfindlist/quickfind.php';\n                var urlloginas = M.cfg.wwwroot+'/course/loginas.php?id=1&sesskey='+M.cfg.sesskey;\n\n                Str.get_strings([\n                    {key: 'loginas'},\n                ]).done(function (strings) {\n\n                    if (instance.xhr !== null) {\n                        instance.xhr.abort();\n                    }\n                    instance.progress.css('visibility', 'visible');\n                    instance.xhr = $.ajax({\n                        url: url,\n                        data: {\n                            role: roleid,\n                            name: searchstring,\n                            courseformat: instance.courseformat,\n                            courseid: instance.courseid,\n                            sesskey: priv.sesskey\n                        }\n                    }).done(function(response) {\n                        var list = $('<ul />');\n                        for (var p in response.people) {\n                            var userstring = instance.userfields.replace('[[firstname]]', response.people[p].firstname);\n                            userstring = userstring.replace('[[lastname]]', response.people[p].lastname);\n                            userstring = userstring.replace('[[username]]', response.people[p].username);\n\n                            // PTL-9892.\n                            var li = '';\n                            if (response.people[p].loginas) {\n                                li = $('<li class=\"d-flex\"><a class=\"mr-3\" href=\"' + instance.url+'&id='+response.people[p].id +'\">'\n                                    + userstring + '</a>' + '<a href=\"' + urlloginas + '&user=' + response.people[p].id + '\">'\n                                    + '<i class=\"fa-light fa-right-to-bracket\" title=\"' + strings[0] + '\"></i></a></li>');\n                            } else {\n                                li = $('<li><a href=\"' + instance.url + '&id=' + response.people[p].id + '\">'\n                                    + userstring + '</a></li>');\n                            }\n\n                            list.append(li);\n                        }\n                        $('#quickfindlist' + roleid).replaceWith(list);\n                        list.attr('id', 'quickfindlist' + roleid);\n                    }).fail(function(jqXHR, status) {\n                        if (status !== 'abort') {\n                            if (status !== undefined) {\n                                instance.listcontainer.html(status);\n                            }\n                        }\n                    }).always(function() {\n                        instance.progress.css('visibility', 'hidden');\n                        M.util.js_complete('quickfindlist' + roleid);\n                    });\n                });\n            }\n        };\n\n        return t;\n    }\n);\n"],"names":["define","$","Str","priv","sesskey","instances","t","init","roleid","userfields","url","courseformat","courseid","instance","on","search_on_type","search_on_submit","e","target","searchstring","val","exec","attr","search","M","util","js_pending","preventDefault","find","cfg","wwwroot","urlloginas","get_strings","key","done","strings","xhr","abort","progress","css","ajax","data","role","name","response","list","p","people","userstring","replace","firstname","lastname","username","li","loginas","id","append","replaceWith","fail","jqXHR","status","undefined","listcontainer","html","always","js_complete"],"mappings":"AAAAA,2CACI,CAAC,SAAU,aACX,SAASC,EAAGC,SACJC,KAAO,CACPC,QAAS,KACTC,UAAW,IAGXC,EAAI,CACJC,KAAM,SAASC,OAAQC,WAAYC,IAAKC,aAAcC,SAAUR,SAC5DD,KAAKC,QAAUA,YAEXS,SAAW,QACDL,kBACIC,eACPC,iBACSC,sBACJC,kBACAX,EAAE,qBAAqBO,sBAClBP,EAAE,iBAAiBO,YAC7B,MAEXL,KAAKE,UAAUG,QAAUK,SACzBZ,EAAE,uBAAuBO,QAAQM,GAAG,QAASR,EAAES,gBAC/Cd,EAAE,iBAAiBO,QAAQM,GAAG,SAAUR,EAAEU,mBAG9CD,eAAgB,SAASE,OACjBC,OAASjB,EAAEgB,EAAEC,QACbC,aAAeD,OAAOE,MACtBZ,OAAS,WAAWa,KAAKH,OAAOI,KAAK,OAAO,GAChDhB,EAAEiB,OAAOJ,aAAcX,QACvBgB,EAAEC,KAAKC,WAAW,gBAAkBlB,SAGxCQ,iBAAkB,SAASC,GACvBA,EAAEU,qBACET,OAASjB,EAAEgB,EAAEC,QACbV,OAAS,WAAWa,KAAKH,OAAOI,KAAK,OAAO,GAC5CH,aAAeD,OAAOU,KAAK,uBAAuBpB,QAAQY,MAC9Dd,EAAEiB,OAAOJ,aAAcX,QACvBgB,EAAEC,KAAKC,WAAW,gBAAkBlB,SAIxCe,OAAQ,SAASJ,aAAcX,YAEvBK,SAAWV,KAAKE,UAAUG,QAE1BE,IAAMc,EAAEK,IAAIC,QAAQ,sCACpBC,WAAaP,EAAEK,IAAIC,QAAQ,oCAAoCN,EAAEK,IAAIzB,QAEzEF,IAAI8B,YAAY,CACZ,CAACC,IAAK,aACPC,MAAK,SAAUC,SAEO,OAAjBtB,SAASuB,KACTvB,SAASuB,IAAIC,QAEjBxB,SAASyB,SAASC,IAAI,aAAc,WACpC1B,SAASuB,IAAMnC,EAAEuC,KAAK,CAClB9B,IAAKA,IACL+B,KAAM,CACFC,KAAMlC,OACNmC,KAAMxB,aACNR,aAAcE,SAASF,aACvBC,SAAUC,SAASD,SACnBR,QAASD,KAAKC,WAEnB8B,MAAK,SAASU,cACTC,KAAO5C,EAAE,cACR,IAAI6C,KAAKF,SAASG,OAAQ,KACvBC,WAAanC,SAASJ,WAAWwC,QAAQ,gBAAiBL,SAASG,OAAOD,GAAGI,WAEjFF,YADAA,WAAaA,WAAWC,QAAQ,eAAgBL,SAASG,OAAOD,GAAGK,WAC3CF,QAAQ,eAAgBL,SAASG,OAAOD,GAAGM,cAG/DC,GAAK,GAELA,GADAT,SAASG,OAAOD,GAAGQ,QACdrD,EAAE,4CAA8CY,SAASH,IAAI,OAAOkC,SAASG,OAAOD,GAAGS,GAAI,KAC1FP,WADC,gBACmCjB,WAAa,SAAWa,SAASG,OAAOD,GAAGS,GAD9E,oDAEmDpB,QAAQ,GAAK,mBAElElC,EAAE,gBAAkBY,SAASH,IAAM,OAASkC,SAASG,OAAOD,GAAGS,GAAK,KACnEP,WAAa,aAGvBH,KAAKW,OAAOH,IAEhBpD,EAAE,iBAAmBO,QAAQiD,YAAYZ,MACzCA,KAAKvB,KAAK,KAAM,gBAAkBd,WACnCkD,MAAK,SAASC,MAAOC,QACL,UAAXA,aACeC,IAAXD,QACA/C,SAASiD,cAAcC,KAAKH,WAGrCI,QAAO,WACNnD,SAASyB,SAASC,IAAI,aAAc,UACpCf,EAAEC,KAAKwC,YAAY,gBAAkBzD,uBAM9CF"}