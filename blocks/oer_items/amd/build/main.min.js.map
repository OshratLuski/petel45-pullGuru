{"version":3,"file":"main.min.js","sources":["../src/main.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Javascript to initialise the myoverview block.\n *\n * @package    block_oer_items\n * @copyright  2018 Bas Brands <bas@moodle.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine([\n        'jquery',\n        'core/ajax',\n        'core/notification',\n        'local_petel/inview',\n        'core/templates',\n    ],\n    function($, Ajax, Notification, inView, Templates) {\n\n        return {\n            selector: {\n                wrapper: '#selectCourse',\n                language: '#selectLanguage',\n                blocks: '.block_oer_items',\n                mainBlock: '.content-oer-activities',\n                selectedCourse: '#selectedCourse',\n                exampleCourse: 'button.example',\n                selectItems: '#selectCourse .dropdown-item',\n                spinner: '#selectCourse .spinner-border',\n            },\n\n            /**\n             * Initialise all of the modules for the overview block.\n             *\n             * @param {object} courseids The root element for the overview block.\n             */\n            init: function() {\n\n                var root = $(this.selector.wrapper),\n                    self = this;\n\n                // First run.\n                inView('.block-oer-items-inview')\n                    .on('enter', function(e) {\n                        if (!$(e).hasClass('inview-done')) {\n                            $(e).addClass('inview-done');\n\n                            self.renderBlock();\n                        }\n                    })\n                    .on('exit', el => {\n                    });\n\n                root.on('click', function(e) {\n                    var target = $(e.target);\n                    while ($.contains(root[0], target[0])) {\n                        if (target.data('handler') === 'setCourse') {\n                            self.setCourse(target);\n                            return;\n                        }\n                        if (target.data('handler') === 'removeCourse') {\n                            self.removeCourse(target);\n                            return;\n                        }\n                        target = target.parent();\n                    }\n                });\n\n                $(this.selector.language).change(function() {\n                    self.renderBlock();\n                });\n\n            },\n\n            setCourse: function(target) {\n                var courseid = target.attr('data-courseid');\n\n                if (target.hasClass('active')) {\n                    target.removeClass('active');\n                    this.removeCourse(target);\n                    this.renderBlock();\n                    return;\n                }\n\n                if (courseid === '0') {\n                    $(this.selector.selectItems).removeClass('active');\n                    $(this.selector.selectedCourse + ' button').each(function() {\n                        if (!$(this).hasClass('example')) {\n                            $(this).remove();\n                        }\n                    });\n                } else {\n                    $(this.selector.selectItems).parent()\n                        .find('[data-courseid=0]').removeClass('active');\n                    $(this.selector.selectedCourse)\n                        .find('[data-courseid=0]').remove();\n                }\n\n                var btnCourse = $(this.selector.exampleCourse).clone(),\n                    wrapper = $(this.selector.selectedCourse),\n                    name = target.attr('data-name');\n\n                btnCourse.attr('data-courseid', courseid);\n                btnCourse.find('span').text(name);\n                btnCourse.removeClass('d-none example');\n                wrapper.append(btnCourse);\n                target.toggleClass('active');\n\n                this.renderBlock();\n            },\n\n            removeCourse: function(target) {\n                var courseid = target.attr('data-courseid');\n                $(this.selector.selectItems).parent()\n                    .find('[data-courseid=' + courseid + ']')\n                    .removeClass('active');\n                $(this.selector.selectedCourse)\n                    .find('[data-courseid=' + courseid + ']')\n                    .remove();\n                this.renderBlock();\n            },\n\n            renderBlock: function() {\n                var allCourses = $(this.selector.selectItems),\n                    self = this,\n                    selectedCoures = [];\n\n                this.toggleSpinner(true);\n\n                allCourses.each(function() {\n                    if ($(this).hasClass('active')) {\n                        selectedCoures.push($(this).attr('data-courseid'));\n                    }\n                });\n\n                Ajax.call([{\n                    methodname: 'block_oer_items_render_activity_block',\n                    args: {\n                        courseids: JSON.stringify(selectedCoures),\n                        language: $(this.selector.language).val()\n                    },\n                    done: function(response) {\n                        self.toggleSpinner(false);\n\n                        Templates.render('block_oer_items/content-activities', JSON.parse(response))\n                            .done(function(html, js) {\n                                Templates.replaceNodeContents(self.selector.mainBlock, html, js);\n                            })\n                            .fail(Notification.exception);\n                    },\n                    fail: Notification.exception\n                }]);\n            },\n\n            toggleSpinner: function(status) {\n                var spinner = $(this.selector.spinner);\n                var borderColor = status ? 'currentColor' : 'transparent';\n                spinner.css('border-color', borderColor);\n            }\n        };\n    });\n"],"names":["define","$","Ajax","Notification","inView","Templates","selector","wrapper","language","blocks","mainBlock","selectedCourse","exampleCourse","selectItems","spinner","init","root","this","self","on","e","hasClass","addClass","renderBlock","el","target","contains","data","setCourse","removeCourse","parent","change","courseid","attr","removeClass","each","remove","find","btnCourse","clone","name","text","append","toggleClass","allCourses","selectedCoures","toggleSpinner","push","call","methodname","args","courseids","JSON","stringify","val","done","response","render","parse","html","js","replaceNodeContents","fail","exception","status","borderColor","css"],"mappings":";;;;;;;AAuBAA,8BAAO,CACC,SACA,YACA,oBACA,qBACA,mBAEJ,SAASC,EAAGC,KAAMC,aAAcC,OAAQC,iBAE7B,CACHC,SAAU,CACNC,QAAS,gBACTC,SAAU,kBACVC,OAAQ,mBACRC,UAAW,0BACXC,eAAgB,kBAChBC,cAAe,iBACfC,YAAa,+BACbC,QAAS,iCAQbC,KAAM,eAEEC,KAAOf,EAAEgB,KAAKX,SAASC,SACvBW,KAAOD,KAGXb,OAAO,2BACFe,GAAG,SAAS,SAASC,GACbnB,EAAEmB,GAAGC,SAAS,iBACfpB,EAAEmB,GAAGE,SAAS,eAEdJ,KAAKK,kBAGZJ,GAAG,QAAQ,SAAAK,QAGhBR,KAAKG,GAAG,SAAS,SAASC,WAClBK,OAASxB,EAAEmB,EAAEK,QACVxB,EAAEyB,SAASV,KAAK,GAAIS,OAAO,KAAK,IACJ,cAA3BA,OAAOE,KAAK,uBACZT,KAAKU,UAAUH,WAGY,iBAA3BA,OAAOE,KAAK,uBACZT,KAAKW,aAAaJ,QAGtBA,OAASA,OAAOK,aAIxB7B,EAAEgB,KAAKX,SAASE,UAAUuB,QAAO,WAC7Bb,KAAKK,kBAKbK,UAAW,SAASH,YACZO,SAAWP,OAAOQ,KAAK,oBAEvBR,OAAOJ,SAAS,iBAChBI,OAAOS,YAAY,eACdL,aAAaJ,kBACbF,cAIQ,MAAbS,UACA/B,EAAEgB,KAAKX,SAASO,aAAaqB,YAAY,UACzCjC,EAAEgB,KAAKX,SAASK,eAAiB,WAAWwB,MAAK,WACxClC,EAAEgB,MAAMI,SAAS,YAClBpB,EAAEgB,MAAMmB,cAIhBnC,EAAEgB,KAAKX,SAASO,aAAaiB,SACxBO,KAAK,qBAAqBH,YAAY,UAC3CjC,EAAEgB,KAAKX,SAASK,gBACX0B,KAAK,qBAAqBD,cAG/BE,UAAYrC,EAAEgB,KAAKX,SAASM,eAAe2B,QAC3ChC,QAAUN,EAAEgB,KAAKX,SAASK,gBAC1B6B,KAAOf,OAAOQ,KAAK,aAEvBK,UAAUL,KAAK,gBAAiBD,UAChCM,UAAUD,KAAK,QAAQI,KAAKD,MAC5BF,UAAUJ,YAAY,kBACtB3B,QAAQmC,OAAOJ,WACfb,OAAOkB,YAAY,eAEdpB,eAGTM,aAAc,SAASJ,YACfO,SAAWP,OAAOQ,KAAK,iBAC3BhC,EAAEgB,KAAKX,SAASO,aAAaiB,SACxBO,KAAK,kBAAoBL,SAAW,KACpCE,YAAY,UACjBjC,EAAEgB,KAAKX,SAASK,gBACX0B,KAAK,kBAAoBL,SAAW,KACpCI,cACAb,eAGTA,YAAa,eACLqB,WAAa3C,EAAEgB,KAAKX,SAASO,aAC7BK,KAAOD,KACP4B,eAAiB,QAEhBC,eAAc,GAEnBF,WAAWT,MAAK,WACRlC,EAAEgB,MAAMI,SAAS,WACjBwB,eAAeE,KAAK9C,EAAEgB,MAAMgB,KAAK,qBAIzC/B,KAAK8C,KAAK,CAAC,CACPC,WAAY,wCACZC,KAAM,CACFC,UAAWC,KAAKC,UAAUR,gBAC1BrC,SAAUP,EAAEgB,KAAKX,SAASE,UAAU8C,OAExCC,KAAM,SAASC,UACXtC,KAAK4B,eAAc,GAEnBzC,UAAUoD,OAAO,qCAAsCL,KAAKM,MAAMF,WAC7DD,MAAK,SAASI,KAAMC,IACjBvD,UAAUwD,oBAAoB3C,KAAKZ,SAASI,UAAWiD,KAAMC,OAEhEE,KAAK3D,aAAa4D,YAE3BD,KAAM3D,aAAa4D,cAI3BjB,cAAe,SAASkB,YAEhBC,YAAcD,OAAS,eAAiB,cAD9B/D,EAAEgB,KAAKX,SAASQ,SAEtBoD,IAAI,eAAgBD,cAGvC"}